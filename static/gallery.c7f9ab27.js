import{U as UniformsUtils,n as MeshDepthMaterial,o as RGBADepthPacking,p as MeshDistanceMaterial,q as ShaderChunk,r as Mesh,F as FrontSide,j as Color,V as Vector2,s as Texture,L as LinearFilter,I as InstancedBufferGeometry,t as Sphere,v as Box3,B as BackSide,D as DoubleSide,w as InstancedBufferAttribute,k as Vector4,x as Matrix3,y as MeshBasicMaterial,m as Matrix4,c as Vector3,z as PlaneGeometry,A as BufferGeometry,G as Float32BufferAttribute,a as useThree,H as suspend,_ as _extends,i as REVISION,e as extend,S as ShaderMaterial,J as Uniform,N as NoBlending,W as WebGLRenderTarget,K as HalfFloatType,X as Scene,Y as Camera,Z as BufferAttribute,$ as MeshStandardMaterial,h as Plane,P as PerspectiveCamera,a0 as DepthTexture,a1 as DepthFormat,a2 as UnsignedShortType,u as useFrame,C as Canvas,Q as Quaternion}from"./react-three-fiber.esm.07616458.js";import{r as reactExports,R as React}from"./index.499fac84.js";import{e as easing}from"./easing-3be59c6d.esm.112ed87a.js";import{c as commonjsGlobal,g as getDefaultExportFromCjs}from"./_commonjsHelpers.de833af9.js";import{j as jsxRuntimeExports}from"./jsx-runtime.b792ae09.js";import{s as shaderMaterial}from"./shaderMaterial.479532a7.js";import{u as useTexture}from"./useTexture.ba2e18f8.js";function useCursor(s,o="pointer",g="auto",v=document.body){reactExports.useEffect(()=>{if(s)return v.style.cursor=o,()=>void(v.style.cursor=g)},[s])}function mergeRefs(s){return function(o){s.forEach(function(g){typeof g=="function"?g(o):g!=null&&(g.current=o)})}}function workerBootstrap(){var s=Object.create(null);function o(i,a){var f=i.id,c=i.name,d=i.dependencies;d===void 0&&(d=[]);var x=i.init;x===void 0&&(x=function(){});var y=i.getTransferables;if(y===void 0&&(y=null),!s[f])try{d=d.map(function(S){return S&&S.isWorkerModule&&(o(S,function(b){if(b instanceof Error)throw b}),S=s[S.id].value),S}),x=v("<"+c+">.init",x),y&&(y=v("<"+c+">.getTransferables",y));var _=null;typeof x=="function"?_=x.apply(void 0,d):console.error("worker module init function failed to rehydrate"),s[f]={id:f,value:_,getTransferables:y},a(_)}catch(S){S&&S.noLog||console.error(S),a(S)}}function g(i,a){var f,c=i.id,d=i.args;(!s[c]||typeof s[c].value!="function")&&a(new Error("Worker module "+c+": not found or its 'init' did not return a function"));try{var x=(f=s[c]).value.apply(f,d);x&&typeof x.then=="function"?x.then(y,function(_){return a(_ instanceof Error?_:new Error(""+_))}):y(x)}catch(_){a(_)}function y(_){try{var S=s[c].getTransferables&&s[c].getTransferables(_);(!S||!Array.isArray(S)||!S.length)&&(S=void 0),a(_,S)}catch(b){console.error(b),a(b)}}}function v(i,a){var f=void 0;self.troikaDefine=function(d){return f=d};var c=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+a+`
)`],{type:"application/javascript"}));try{importScripts(c)}catch(d){console.error(d)}return URL.revokeObjectURL(c),delete self.troikaDefine,f}self.addEventListener("message",function(i){var a=i.data,f=a.messageId,c=a.action,d=a.data;try{c==="registerModule"&&o(d,function(x){x instanceof Error?postMessage({messageId:f,success:!1,error:x.message}):postMessage({messageId:f,success:!0,result:{isCallable:typeof x=="function"}})}),c==="callModule"&&g(d,function(x,y){x instanceof Error?postMessage({messageId:f,success:!1,error:x.message}):postMessage({messageId:f,success:!0,result:x},y||void 0)})}catch(x){postMessage({messageId:f,success:!1,error:x.stack})}})}function defineMainThreadModule(s){var o=function(){for(var g=[],v=arguments.length;v--;)g[v]=arguments[v];return o._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,g);throw new Error("Worker module function was called but `init` did not return a callable function")})};return o._getInitResult=function(){var g=s.dependencies,v=s.init;g=Array.isArray(g)?g.map(function(a){return a&&a._getInitResult?a._getInitResult():a}):[];var i=Promise.all(g).then(function(a){return v.apply(null,a)});return o._getInitResult=function(){return i},i},o}var supportsWorkers=function(){var s=!1;if(typeof window<"u"&&typeof window.document<"u")try{var o=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));o.terminate(),s=!0}catch(g){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+g.message+"]")}return supportsWorkers=function(){return s},s},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),registeredModules=Object.create(null),openRequests=Object.create(null);function defineWorkerModule(s){if((!s||typeof s.init!="function")&&!_allowInitAsString)throw new Error("requires `options.init` function");var o=s.dependencies,g=s.init,v=s.getTransferables,i=s.workerId;if(!supportsWorkers())return defineMainThreadModule(s);i==null&&(i="#default");var a="workerModule"+ ++_workerModuleId,f=s.name||a,c=null;o=o&&o.map(function(x){return typeof x=="function"&&!x.workerModuleData&&(_allowInitAsString=!0,x=defineWorkerModule({workerId:i,name:"<"+f+"> function dependency: "+x.name,init:`function(){return (
`+stringifyFunction(x)+`
)}`}),_allowInitAsString=!1),x&&x.workerModuleData&&(x=x.workerModuleData),x});function d(){for(var x=[],y=arguments.length;y--;)x[y]=arguments[y];if(!c){c=callWorker(i,"registerModule",d.workerModuleData);var _=function(){c=null,registeredModules[i].delete(_)};(registeredModules[i]||(registeredModules[i]=new Set)).add(_)}return c.then(function(S){var b=S.isCallable;if(b)return callWorker(i,"callModule",{id:a,args:x});throw new Error("Worker module function was called but `init` did not return a callable function")})}return d.workerModuleData={isWorkerModule:!0,id:a,name:f,dependencies:o,init:stringifyFunction(g),getTransferables:v&&stringifyFunction(v)},d}function terminateWorker(s){registeredModules[s]&&registeredModules[s].forEach(function(o){o()}),workers[s]&&(workers[s].terminate(),delete workers[s])}function stringifyFunction(s){var o=s.toString();return!/^function/.test(o)&&/^\w+\s*\(/.test(o)&&(o="function "+o),o}function getWorker(s){var o=workers[s];if(!o){var g=stringifyFunction(workerBootstrap);o=workers[s]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+s.replace(/\*/g,"")+` **/

;(`+g+")()"],{type:"application/javascript"}))),o.onmessage=function(v){var i=v.data,a=i.messageId,f=openRequests[a];if(!f)throw new Error("WorkerModule response with empty or unknown messageId");delete openRequests[a],f(i)}}return o}function callWorker(s,o,g){return new Promise(function(v,i){var a=++_messageId;openRequests[a]=function(f){f.success?v(f.result):i(new Error("Error in worker "+o+" call: "+f.error))},getWorker(s).postMessage({messageId:a,action:o,data:g})})}function SDFGenerator(){var s=function(o){function g(j,Q,U,C,N,V,G,Z){var H=1-G;Z.x=H*H*j+2*H*G*U+G*G*N,Z.y=H*H*Q+2*H*G*C+G*G*V}function v(j,Q,U,C,N,V,G,Z,H,z){var te=1-H;z.x=te*te*te*j+3*te*te*H*U+3*te*H*H*N+H*H*H*G,z.y=te*te*te*Q+3*te*te*H*C+3*te*H*H*V+H*H*H*Z}function i(j,Q){for(var U=/([MLQCZ])([^MLQCZ]*)/g,C,N,V,G,Z;C=U.exec(j);){var H=C[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(z){return parseFloat(z)});switch(C[1]){case"M":G=N=H[0],Z=V=H[1];break;case"L":(H[0]!==G||H[1]!==Z)&&Q("L",G,Z,G=H[0],Z=H[1]);break;case"Q":{Q("Q",G,Z,G=H[2],Z=H[3],H[0],H[1]);break}case"C":{Q("C",G,Z,G=H[4],Z=H[5],H[0],H[1],H[2],H[3]);break}case"Z":(G!==N||Z!==V)&&Q("L",G,Z,N,V);break}}}function a(j,Q,U){U===void 0&&(U=16);var C={x:0,y:0};i(j,function(N,V,G,Z,H,z,te,le,re){switch(N){case"L":Q(V,G,Z,H);break;case"Q":{for(var W=V,Fe=G,be=1;be<U;be++)g(V,G,z,te,Z,H,be/(U-1),C),Q(W,Fe,C.x,C.y),W=C.x,Fe=C.y;break}case"C":{for(var ae=V,ue=G,ye=1;ye<U;ye++)v(V,G,z,te,le,re,Z,H,ye/(U-1),C),Q(ae,ue,C.x,C.y),ae=C.x,ue=C.y;break}}})}var f="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",c="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",d=new WeakMap,x={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function y(j,Q){var U=j.getContext?j.getContext("webgl",x):j,C=d.get(U);if(!C){let te=function(ae){var ue=V[ae];if(!ue&&(ue=V[ae]=U.getExtension(ae),!ue))throw new Error(ae+" not supported");return ue},le=function(ae,ue){var ye=U.createShader(ue);return U.shaderSource(ye,ae),U.compileShader(ye),ye},re=function(ae,ue,ye,K){if(!G[ae]){var de={},ie={},X=U.createProgram();U.attachShader(X,le(ue,U.VERTEX_SHADER)),U.attachShader(X,le(ye,U.FRAGMENT_SHADER)),U.linkProgram(X),G[ae]={program:X,transaction:function(se){U.useProgram(X),se({setUniform:function(oe,Ae){for(var Ee=[],he=arguments.length-2;he-- >0;)Ee[he]=arguments[he+2];var Se=ie[Ae]||(ie[Ae]=U.getUniformLocation(X,Ae));U["uniform"+oe].apply(U,[Se].concat(Ee))},setAttribute:function(oe,Ae,Ee,he,Se){var we=de[oe];we||(we=de[oe]={buf:U.createBuffer(),loc:U.getAttribLocation(X,oe),data:null}),U.bindBuffer(U.ARRAY_BUFFER,we.buf),U.vertexAttribPointer(we.loc,Ae,U.FLOAT,!1,0,0),U.enableVertexAttribArray(we.loc),N?U.vertexAttribDivisor(we.loc,he):te("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(we.loc,he),Se!==we.data&&(U.bufferData(U.ARRAY_BUFFER,Se,Ee),we.data=Se)}})}}}G[ae].transaction(K)},W=function(ae,ue){H++;try{U.activeTexture(U.TEXTURE0+H);var ye=Z[ae];ye||(ye=Z[ae]=U.createTexture(),U.bindTexture(U.TEXTURE_2D,ye),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.NEAREST),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.NEAREST)),U.bindTexture(U.TEXTURE_2D,ye),ue(ye,H)}finally{H--}},Fe=function(ae,ue,ye){var K=U.createFramebuffer();z.push(K),U.bindFramebuffer(U.FRAMEBUFFER,K),U.activeTexture(U.TEXTURE0+ue),U.bindTexture(U.TEXTURE_2D,ae),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,ae,0);try{ye(K)}finally{U.deleteFramebuffer(K),U.bindFramebuffer(U.FRAMEBUFFER,z[--z.length-1]||null)}},be=function(){V={},G={},Z={},H=-1,z.length=0};var N=typeof WebGL2RenderingContext<"u"&&U instanceof WebGL2RenderingContext,V={},G={},Z={},H=-1,z=[];U.canvas.addEventListener("webglcontextlost",function(ae){be(),ae.preventDefault()},!1),d.set(U,C={gl:U,isWebGL2:N,getExtension:te,withProgram:re,withTexture:W,withTextureFramebuffer:Fe,handleContextLoss:be})}Q(C)}function _(j,Q,U,C,N,V,G,Z){G===void 0&&(G=15),Z===void 0&&(Z=null),y(j,function(H){var z=H.gl,te=H.withProgram,le=H.withTexture;le("copy",function(re,W){z.texImage2D(z.TEXTURE_2D,0,z.RGBA,N,V,0,z.RGBA,z.UNSIGNED_BYTE,Q),te("copy",f,c,function(Fe){var be=Fe.setUniform,ae=Fe.setAttribute;ae("aUV",2,z.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),be("1i","image",W),z.bindFramebuffer(z.FRAMEBUFFER,Z||null),z.disable(z.BLEND),z.colorMask(G&8,G&4,G&2,G&1),z.viewport(U,C,N,V),z.scissor(U,C,N,V),z.drawArrays(z.TRIANGLES,0,3)})})})}function S(j,Q,U){var C=j.width,N=j.height;y(j,function(V){var G=V.gl,Z=new Uint8Array(C*N*4);G.readPixels(0,0,C,N,G.RGBA,G.UNSIGNED_BYTE,Z),j.width=Q,j.height=U,_(G,Z,0,0,C,N)})}var b=Object.freeze({__proto__:null,withWebGLContext:y,renderImageData:_,resizeWebGLCanvasWithoutClearing:S});function w(j,Q,U,C,N,V){V===void 0&&(V=1);var G=new Uint8Array(j*Q),Z=C[2]-C[0],H=C[3]-C[1],z=[];a(U,function(ae,ue,ye,K){z.push({x1:ae,y1:ue,x2:ye,y2:K,minX:Math.min(ae,ye),minY:Math.min(ue,K),maxX:Math.max(ae,ye),maxY:Math.max(ue,K)})}),z.sort(function(ae,ue){return ae.maxX-ue.maxX});for(var te=0;te<j;te++)for(var le=0;le<Q;le++){var re=Fe(C[0]+Z*(te+.5)/j,C[1]+H*(le+.5)/Q),W=Math.pow(1-Math.abs(re)/N,V)/2;re<0&&(W=1-W),W=Math.max(0,Math.min(255,Math.round(W*255))),G[le*j+te]=W}return G;function Fe(ae,ue){for(var ye=1/0,K=1/0,de=z.length;de--;){var ie=z[de];if(ie.maxX+K<=ae)break;if(ae+K>ie.minX&&ue-K<ie.maxY&&ue+K>ie.minY){var X=I(ae,ue,ie.x1,ie.y1,ie.x2,ie.y2);X<ye&&(ye=X,K=Math.sqrt(ye))}}return be(ae,ue)&&(K=-K),K}function be(ae,ue){for(var ye=0,K=z.length;K--;){var de=z[K];if(de.maxX<=ae)break;var ie=de.y1>ue!=de.y2>ue&&ae<(de.x2-de.x1)*(ue-de.y1)/(de.y2-de.y1)+de.x1;ie&&(ye+=de.y1<de.y2?1:-1)}return ye!==0}}function T(j,Q,U,C,N,V,G,Z,H,z){V===void 0&&(V=1),Z===void 0&&(Z=0),H===void 0&&(H=0),z===void 0&&(z=0),E(j,Q,U,C,N,V,G,null,Z,H,z)}function E(j,Q,U,C,N,V,G,Z,H,z,te){V===void 0&&(V=1),H===void 0&&(H=0),z===void 0&&(z=0),te===void 0&&(te=0);for(var le=w(j,Q,U,C,N,V),re=new Uint8Array(le.length*4),W=0;W<le.length;W++)re[W*4+te]=le[W];_(G,re,H,z,j,Q,1<<3-te,Z)}function I(j,Q,U,C,N,V){var G=N-U,Z=V-C,H=G*G+Z*Z,z=H?Math.max(0,Math.min(1,((j-U)*G+(Q-C)*Z)/H)):0,te=j-(U+z*G),le=Q-(C+z*Z);return te*te+le*le}var F=Object.freeze({__proto__:null,generate:w,generateIntoCanvas:T,generateIntoFramebuffer:E}),M="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",O="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",R="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",D=new Float32Array([0,0,2,0,0,2]),P=null,B=!1,ee={},ne=new WeakMap;function ce(j){if(!B&&!J(j))throw new Error("WebGL generation not supported")}function A(j,Q,U,C,N,V,G){if(V===void 0&&(V=1),G===void 0&&(G=null),!G&&(G=P,!G)){var Z=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!Z)throw new Error("OffscreenCanvas or DOM canvas not supported");G=P=Z.getContext("webgl",{depth:!1})}ce(G);var H=new Uint8Array(j*Q*4);y(G,function(re){var W=re.gl,Fe=re.withTexture,be=re.withTextureFramebuffer;Fe("readable",function(ae,ue){W.texImage2D(W.TEXTURE_2D,0,W.RGBA,j,Q,0,W.RGBA,W.UNSIGNED_BYTE,null),be(ae,ue,function(ye){L(j,Q,U,C,N,V,W,ye,0,0,0),W.readPixels(0,0,j,Q,W.RGBA,W.UNSIGNED_BYTE,H)})})});for(var z=new Uint8Array(j*Q),te=0,le=0;te<H.length;te+=4)z[le++]=H[te];return z}function Y(j,Q,U,C,N,V,G,Z,H,z){V===void 0&&(V=1),Z===void 0&&(Z=0),H===void 0&&(H=0),z===void 0&&(z=0),L(j,Q,U,C,N,V,G,null,Z,H,z)}function L(j,Q,U,C,N,V,G,Z,H,z,te){V===void 0&&(V=1),H===void 0&&(H=0),z===void 0&&(z=0),te===void 0&&(te=0),ce(G);var le=[];a(U,function(re,W,Fe,be){le.push(re,W,Fe,be)}),le=new Float32Array(le),y(G,function(re){var W=re.gl,Fe=re.isWebGL2,be=re.getExtension,ae=re.withProgram,ue=re.withTexture,ye=re.withTextureFramebuffer,K=re.handleContextLoss;if(ue("rawDistances",function(de,ie){(j!==de._lastWidth||Q!==de._lastHeight)&&W.texImage2D(W.TEXTURE_2D,0,W.RGBA,de._lastWidth=j,de._lastHeight=Q,0,W.RGBA,W.UNSIGNED_BYTE,null),ae("main",M,O,function(X){var pe=X.setAttribute,se=X.setUniform,ve=!Fe&&be("ANGLE_instanced_arrays"),oe=!Fe&&be("EXT_blend_minmax");pe("aUV",2,W.STATIC_DRAW,0,D),pe("aLineSegment",4,W.DYNAMIC_DRAW,1,le),se.apply(void 0,["4f","uGlyphBounds"].concat(C)),se("1f","uMaxDistance",N),se("1f","uExponent",V),ye(de,ie,function(Ae){W.enable(W.BLEND),W.colorMask(!0,!0,!0,!0),W.viewport(0,0,j,Q),W.scissor(0,0,j,Q),W.blendFunc(W.ONE,W.ONE),W.blendEquationSeparate(W.FUNC_ADD,Fe?W.MAX:oe.MAX_EXT),W.clear(W.COLOR_BUFFER_BIT),Fe?W.drawArraysInstanced(W.TRIANGLES,0,3,le.length/4):ve.drawArraysInstancedANGLE(W.TRIANGLES,0,3,le.length/4)})}),ae("post",f,R,function(X){X.setAttribute("aUV",2,W.STATIC_DRAW,0,D),X.setUniform("1i","tex",ie),W.bindFramebuffer(W.FRAMEBUFFER,Z),W.disable(W.BLEND),W.colorMask(te===0,te===1,te===2,te===3),W.viewport(H,z,j,Q),W.scissor(H,z,j,Q),W.drawArrays(W.TRIANGLES,0,3)})}),W.isContextLost())throw K(),new Error("webgl context lost")})}function J(j){var Q=!j||j===P?ee:j.canvas||j,U=ne.get(Q);if(U===void 0){B=!0;var C=null;try{var N=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],V=A(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,j);U=V&&N.length===V.length&&V.every(function(G,Z){return G===N[Z]}),U||(C="bad trial run results",console.info(N,V))}catch(G){U=!1,C=G.message}C&&console.warn("WebGL SDF generation not supported:",C),B=!1,ne.set(Q,U)}return U}var $=Object.freeze({__proto__:null,generate:A,generateIntoCanvas:Y,generateIntoFramebuffer:L,isSupported:J});function xe(j,Q,U,C,N,V){N===void 0&&(N=Math.max(C[2]-C[0],C[3]-C[1])/2),V===void 0&&(V=1);try{return A.apply($,arguments)}catch(G){return console.info("WebGL SDF generation failed, falling back to JS",G),w.apply(F,arguments)}}function me(j,Q,U,C,N,V,G,Z,H,z){N===void 0&&(N=Math.max(C[2]-C[0],C[3]-C[1])/2),V===void 0&&(V=1),Z===void 0&&(Z=0),H===void 0&&(H=0),z===void 0&&(z=0);try{return Y.apply($,arguments)}catch(te){return console.info("WebGL SDF generation failed, falling back to JS",te),T.apply(F,arguments)}}return o.forEachPathCommand=i,o.generate=xe,o.generateIntoCanvas=me,o.javascript=F,o.pathToLineSegments=a,o.webgl=$,o.webglUtils=b,Object.defineProperty(o,"__esModule",{value:!0}),o}({});return s}function bidiFactory(){var s=function(o){var g={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},v={},i={};v.L=1,i[1]="L",Object.keys(g).forEach(function(K,de){v[K]=1<<de+1,i[v[K]]=K}),Object.freeze(v);var a=v.LRI|v.RLI|v.FSI,f=v.L|v.R|v.AL,c=v.B|v.S|v.WS|v.ON|v.FSI|v.LRI|v.RLI|v.PDI,d=v.BN|v.RLE|v.LRE|v.RLO|v.LRO|v.PDF,x=v.S|v.WS|v.B|a|v.PDI|d,y=null;function _(){if(!y){y=new Map;var K=function(ie){if(g.hasOwnProperty(ie)){var X=0;g[ie].split(",").forEach(function(pe){var se=pe.split("+"),ve=se[0],oe=se[1];ve=parseInt(ve,36),oe=oe?parseInt(oe,36):0,y.set(X+=ve,v[ie]);for(var Ae=0;Ae<oe;Ae++)y.set(++X,v[ie])})}};for(var de in g)K(de)}}function S(K){return _(),y.get(K.codePointAt(0))||v.L}function b(K){return i[S(K)]}var w={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function T(K,de){var ie=36,X=0,pe=new Map,se=de&&new Map,ve;return K.split(",").forEach(function oe(Ae){if(Ae.indexOf("+")!==-1)for(var Ee=+Ae;Ee--;)oe(ve);else{ve=Ae;var he=Ae.split(">"),Se=he[0],we=he[1];Se=String.fromCodePoint(X+=parseInt(Se,ie)),we=String.fromCodePoint(X+=parseInt(we,ie)),pe.set(Se,we),de&&se.set(we,Se)}}),{map:pe,reverseMap:se}}var E,I,F;function M(){if(!E){var K=T(w.pairs,!0),de=K.map,ie=K.reverseMap;E=de,I=ie,F=T(w.canonical,!1).map}}function O(K){return M(),E.get(K)||null}function R(K){return M(),I.get(K)||null}function D(K){return M(),F.get(K)||null}var P=v.L,B=v.R,ee=v.EN,ne=v.ES,ce=v.ET,A=v.AN,Y=v.CS,L=v.B,J=v.S,$=v.ON,xe=v.BN,me=v.NSM,j=v.AL,Q=v.LRO,U=v.RLO,C=v.LRE,N=v.RLE,V=v.PDF,G=v.LRI,Z=v.RLI,H=v.FSI,z=v.PDI;function te(K,de){for(var ie=125,X=new Uint32Array(K.length),pe=0;pe<K.length;pe++)X[pe]=S(K[pe]);var se=new Map;function ve(ze,et){var Xe=X[ze];X[ze]=et,se.set(Xe,se.get(Xe)-1),Xe&c&&se.set(c,se.get(c)-1),se.set(et,(se.get(et)||0)+1),et&c&&se.set(c,(se.get(c)||0)+1)}for(var oe=new Uint8Array(K.length),Ae=new Map,Ee=[],he=null,Se=0;Se<K.length;Se++)he||Ee.push(he={start:Se,end:K.length-1,level:de==="rtl"?1:de==="ltr"?0:Sr(Se,!1)}),X[Se]&L&&(he.end=Se,he=null);for(var we=N|C|U|Q|a|z|V|L,Ie=function(ze){return ze+(ze&1?1:2)},_e=function(ze){return ze+(ze&1?2:1)},Me=0;Me<Ee.length;Me++){he=Ee[Me];var Te=[{_level:he.level,_override:0,_isolate:0}],ge=void 0,Re=0,ke=0,Ge=0;se.clear();for(var Ue=he.start;Ue<=he.end;Ue++){var De=X[Ue];if(ge=Te[Te.length-1],se.set(De,(se.get(De)||0)+1),De&c&&se.set(c,(se.get(c)||0)+1),De&we)if(De&(N|C)){oe[Ue]=ge._level;var We=(De===N?_e:Ie)(ge._level);We<=ie&&!Re&&!ke?Te.push({_level:We,_override:0,_isolate:0}):Re||ke++}else if(De&(U|Q)){oe[Ue]=ge._level;var rt=(De===U?_e:Ie)(ge._level);rt<=ie&&!Re&&!ke?Te.push({_level:rt,_override:De&U?B:P,_isolate:0}):Re||ke++}else if(De&a){De&H&&(De=Sr(Ue+1,!0)===1?Z:G),oe[Ue]=ge._level,ge._override&&ve(Ue,ge._override);var st=(De===Z?_e:Ie)(ge._level);st<=ie&&Re===0&&ke===0?(Ge++,Te.push({_level:st,_override:0,_isolate:1,_isolInitIndex:Ue})):Re++}else if(De&z){if(Re>0)Re--;else if(Ge>0){for(ke=0;!Te[Te.length-1]._isolate;)Te.pop();var nt=Te[Te.length-1]._isolInitIndex;nt!=null&&(Ae.set(nt,Ue),Ae.set(Ue,nt)),Te.pop(),Ge--}ge=Te[Te.length-1],oe[Ue]=ge._level,ge._override&&ve(Ue,ge._override)}else De&V?(Re===0&&(ke>0?ke--:!ge._isolate&&Te.length>1&&(Te.pop(),ge=Te[Te.length-1])),oe[Ue]=ge._level):De&L&&(oe[Ue]=he.level);else oe[Ue]=ge._level,ge._override&&De!==xe&&ve(Ue,ge._override)}for(var Ke=[],Ve=null,Be=he.start;Be<=he.end;Be++){var dt=X[Be];if(!(dt&d)){var Pe=oe[Be],Oe=dt&a,Ze=dt===z;Ve&&Pe===Ve._level?(Ve._end=Be,Ve._endsWithIsolInit=Oe):Ke.push(Ve={_start:Be,_end:Be,_level:Pe,_startsWithPDI:Ze,_endsWithIsolInit:Oe})}}for(var Ye=[],Ce=0;Ce<Ke.length;Ce++){var He=Ke[Ce];if(!He._startsWithPDI||He._startsWithPDI&&!Ae.has(He._start)){for(var Qe=[Ve=He],Ne=void 0;Ve&&Ve._endsWithIsolInit&&(Ne=Ae.get(Ve._end))!=null;)for(var Le=Ce+1;Le<Ke.length;Le++)if(Ke[Le]._start===Ne){Qe.push(Ve=Ke[Le]);break}for(var je=[],at=0;at<Qe.length;at++)for(var qe=Qe[at],lt=qe._start;lt<=qe._end;lt++)je.push(lt);for(var Ur=oe[je[0]],rr=he.level,Ft=je[0]-1;Ft>=0;Ft--)if(!(X[Ft]&d)){rr=oe[Ft];break}var It=je[je.length-1],Fr=oe[It],nr=he.level;if(!(X[It]&a)){for(var Tt=It+1;Tt<=he.end;Tt++)if(!(X[Tt]&d)){nr=oe[Tt];break}}Ye.push({_seqIndices:je,_sosType:Math.max(rr,Ur)%2?B:P,_eosType:Math.max(nr,Fr)%2?B:P})}}for(var Gt=0;Gt<Ye.length;Gt++){var Lt=Ye[Gt],fe=Lt._seqIndices,vt=Lt._sosType,Tr=Lt._eosType,ut=oe[fe[0]]&1?B:P;if(se.get(me))for(var Et=0;Et<fe.length;Et++){var ar=fe[Et];if(X[ar]&me){for(var Ht=vt,wt=Et-1;wt>=0;wt--)if(!(X[fe[wt]]&d)){Ht=X[fe[wt]];break}ve(ar,Ht&(a|z)?$:Ht)}}if(se.get(ee))for(var At=0;At<fe.length;At++){var or=fe[At];if(X[or]&ee)for(var Rt=At-1;Rt>=-1;Rt--){var ir=Rt===-1?vt:X[fe[Rt]];if(ir&f){ir===j&&ve(or,A);break}}}if(se.get(j))for(var Nt=0;Nt<fe.length;Nt++){var sr=fe[Nt];X[sr]&j&&ve(sr,B)}if(se.get(ne)||se.get(Y))for(var pt=1;pt<fe.length-1;pt++){var Wt=fe[pt];if(X[Wt]&(ne|Y)){for(var ft=0,jt=0,zt=pt-1;zt>=0&&(ft=X[fe[zt]],!!(ft&d));zt--);for(var Xt=pt+1;Xt<fe.length&&(jt=X[fe[Xt]],!!(jt&d));Xt++);ft===jt&&(X[Wt]===ne?ft===ee:ft&(ee|A))&&ve(Wt,ft)}}if(se.get(ee))for(var tt=0;tt<fe.length;tt++){var Er=fe[tt];if(X[Er]&ee){for(var Ct=tt-1;Ct>=0&&X[fe[Ct]]&(ce|d);Ct--)ve(fe[Ct],ee);for(tt++;tt<fe.length&&X[fe[tt]]&(ce|d|ee);tt++)X[fe[tt]]!==ee&&ve(fe[tt],ee)}}if(se.get(ce)||se.get(ne)||se.get(Y))for(var mt=0;mt<fe.length;mt++){var lr=fe[mt];if(X[lr]&(ce|ne|Y)){ve(lr,$);for(var kt=mt-1;kt>=0&&X[fe[kt]]&d;kt--)ve(fe[kt],$);for(var Mt=mt+1;Mt<fe.length&&X[fe[Mt]]&d;Mt++)ve(fe[Mt],$)}}if(se.get(ee))for(var Vt=0,ur=vt;Vt<fe.length;Vt++){var fr=fe[Vt],Yt=X[fr];Yt&ee?ur===P&&ve(fr,P):Yt&f&&(ur=Yt)}if(se.get(c)){var gt=B|ee|A,cr=gt|P,Dt=[];{for(var ct=[],ht=0;ht<fe.length;ht++)if(X[fe[ht]]&c){var xt=K[fe[ht]],hr=void 0;if(O(xt)!==null)if(ct.length<63)ct.push({char:xt,seqIndex:ht});else break;else if((hr=R(xt))!==null)for(var yt=ct.length-1;yt>=0;yt--){var Jt=ct[yt].char;if(Jt===hr||Jt===R(D(xt))||O(D(Jt))===xt){Dt.push([ct[yt].seqIndex,ht]),ct.length=yt;break}}}Dt.sort(function(ze,et){return ze[0]-et[0]})}for(var Kt=0;Kt<Dt.length;Kt++){for(var dr=Dt[Kt],Bt=dr[0],Qt=dr[1],vr=!1,$e=0,Zt=Bt+1;Zt<Qt;Zt++){var pr=fe[Zt];if(X[pr]&cr){vr=!0;var mr=X[pr]&gt?B:P;if(mr===ut){$e=mr;break}}}if(vr&&!$e){$e=vt;for(var qt=Bt-1;qt>=0;qt--){var gr=fe[qt];if(X[gr]&cr){var xr=X[gr]&gt?B:P;xr!==ut?$e=xr:$e=ut;break}}}if($e){if(X[fe[Bt]]=X[fe[Qt]]=$e,$e!==ut){for(var _t=Bt+1;_t<fe.length;_t++)if(!(X[fe[_t]]&d)){S(K[fe[_t]])&me&&(X[fe[_t]]=$e);break}}if($e!==ut){for(var St=Qt+1;St<fe.length;St++)if(!(X[fe[St]]&d)){S(K[fe[St]])&me&&(X[fe[St]]=$e);break}}}}for(var ot=0;ot<fe.length;ot++)if(X[fe[ot]]&c){for(var yr=ot,$t=ot,er=vt,bt=ot-1;bt>=0;bt--)if(X[fe[bt]]&d)yr=bt;else{er=X[fe[bt]]&gt?B:P;break}for(var _r=Tr,Ut=ot+1;Ut<fe.length;Ut++)if(X[fe[Ut]]&(c|d))$t=Ut;else{_r=X[fe[Ut]]&gt?B:P;break}for(var tr=yr;tr<=$t;tr++)X[fe[tr]]=er===_r?er:ut;ot=$t}}}for(var Je=he.start;Je<=he.end;Je++){var wr=oe[Je],Ot=X[Je];if(wr&1?Ot&(P|ee|A)&&oe[Je]++:Ot&B?oe[Je]++:Ot&(A|ee)&&(oe[Je]+=2),Ot&d&&(oe[Je]=Je===0?he.level:oe[Je-1]),Je===he.end||S(K[Je])&(J|L))for(var Pt=Je;Pt>=0&&S(K[Pt])&x;Pt--)oe[Pt]=he.level}}return{levels:oe,paragraphs:Ee};function Sr(ze,et){for(var Xe=ze;Xe<K.length;Xe++){var it=X[Xe];if(it&(B|j))return 1;if(it&(L|P)||et&&it===z)return 0;if(it&a){var br=Ar(Xe);Xe=br===-1?K.length:br}}return 0}function Ar(ze){for(var et=1,Xe=ze+1;Xe<K.length;Xe++){var it=X[Xe];if(it&L)break;if(it&z){if(--et===0)return Xe}else it&a&&et++}return-1}}var le="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",re;function W(){if(!re){var K=T(le,!0),de=K.map,ie=K.reverseMap;ie.forEach(function(X,pe){de.set(pe,X)}),re=de}}function Fe(K){return W(),re.get(K)||null}function be(K,de,ie,X){var pe=K.length;ie=Math.max(0,ie==null?0:+ie),X=Math.min(pe-1,X==null?pe-1:+X);for(var se=new Map,ve=ie;ve<=X;ve++)if(de[ve]&1){var oe=Fe(K[ve]);oe!==null&&se.set(ve,oe)}return se}function ae(K,de,ie,X){var pe=K.length;ie=Math.max(0,ie==null?0:+ie),X=Math.min(pe-1,X==null?pe-1:+X);var se=[];return de.paragraphs.forEach(function(ve){var oe=Math.max(ie,ve.start),Ae=Math.min(X,ve.end);if(oe<Ae){for(var Ee=de.levels.slice(oe,Ae+1),he=Ae;he>=oe&&S(K[he])&x;he--)Ee[he]=ve.level;for(var Se=ve.level,we=1/0,Ie=0;Ie<Ee.length;Ie++){var _e=Ee[Ie];_e>Se&&(Se=_e),_e<we&&(we=_e|1)}for(var Me=Se;Me>=we;Me--)for(var Te=0;Te<Ee.length;Te++)if(Ee[Te]>=Me){for(var ge=Te;Te+1<Ee.length&&Ee[Te+1]>=Me;)Te++;Te>ge&&se.push([ge+oe,Te+oe])}}}),se}function ue(K,de,ie,X){var pe=ye(K,de,ie,X),se=[].concat(K);return pe.forEach(function(ve,oe){se[oe]=(de.levels[ve]&1?Fe(K[ve]):null)||K[ve]}),se.join("")}function ye(K,de,ie,X){for(var pe=ae(K,de,ie,X),se=[],ve=0;ve<K.length;ve++)se[ve]=ve;return pe.forEach(function(oe){for(var Ae=oe[0],Ee=oe[1],he=se.slice(Ae,Ee+1),Se=he.length;Se--;)se[Ee-Se]=he[Se]}),se}return o.closingToOpeningBracket=R,o.getBidiCharType=S,o.getBidiCharTypeName=b,o.getCanonicalBracket=D,o.getEmbeddingLevels=te,o.getMirroredCharacter=Fe,o.getMirroredCharactersMap=be,o.getReorderSegments=ae,o.getReorderedIndices=ye,o.getReorderedString=ue,o.openingToClosingBracket=O,Object.defineProperty(o,"__esModule",{value:!0}),o}({});return s}const voidMainRegExp=/\bvoid\s+main\s*\(\s*\)\s*{/g;function expandShaderIncludes(s){const o=/^[ \t]*#include +<([\w\d./]+)>/gm;function g(v,i){let a=ShaderChunk[i];return a?expandShaderIncludes(a):v}return s.replace(o,g)}const _lut=[];for(let s=0;s<256;s++)_lut[s]=(s<16?"0":"")+s.toString(16);function generateUUID(){const s=Math.random()*4294967295|0,o=Math.random()*4294967295|0,g=Math.random()*4294967295|0,v=Math.random()*4294967295|0;return(_lut[s&255]+_lut[s>>8&255]+_lut[s>>16&255]+_lut[s>>24&255]+"-"+_lut[o&255]+_lut[o>>8&255]+"-"+_lut[o>>16&15|64]+_lut[o>>24&255]+"-"+_lut[g&63|128]+_lut[g>>8&255]+"-"+_lut[g>>16&255]+_lut[g>>24&255]+_lut[v&255]+_lut[v>>8&255]+_lut[v>>16&255]+_lut[v>>24&255]).toUpperCase()}const assign$1=Object.assign||function(){let s=arguments[0];for(let o=1,g=arguments.length;o<g;o++){let v=arguments[o];if(v)for(let i in v)Object.prototype.hasOwnProperty.call(v,i)&&(s[i]=v[i])}return s},epoch=Date.now(),CONSTRUCTOR_CACHE=new WeakMap,SHADER_UPGRADE_CACHE=new Map;let materialInstanceId=1e10;function createDerivedMaterial(s,o){const g=getKeyForOptions(o);let v=CONSTRUCTOR_CACHE.get(s);if(v||CONSTRUCTOR_CACHE.set(s,v=Object.create(null)),v[g])return new v[g];const i=`_onBeforeCompile${g}`,a=function(x,y){s.onBeforeCompile.call(this,x,y);const _=this.customProgramCacheKey()+"|"+x.vertexShader+"|"+x.fragmentShader;let S=SHADER_UPGRADE_CACHE[_];if(!S){const b=upgradeShaders(this,x,o,g);S=SHADER_UPGRADE_CACHE[_]=b}x.vertexShader=S.vertexShader,x.fragmentShader=S.fragmentShader,assign$1(x.uniforms,this.uniforms),o.timeUniform&&(x.uniforms[o.timeUniform]={get value(){return Date.now()-epoch}}),this[i]&&this[i](x)},f=function(){return c(o.chained?s:s.clone())},c=function(x){const y=Object.create(x,d);return Object.defineProperty(y,"baseMaterial",{value:s}),Object.defineProperty(y,"id",{value:materialInstanceId++}),y.uuid=generateUUID(),y.uniforms=assign$1({},x.uniforms,o.uniforms),y.defines=assign$1({},x.defines,o.defines),y.defines[`TROIKA_DERIVED_MATERIAL_${g}`]="",y.extensions=assign$1({},x.extensions,o.extensions),y._listeners=void 0,y},d={constructor:{value:f},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return s.customProgramCacheKey()+"|"+g}},onBeforeCompile:{get(){return a},set(x){this[i]=x}},copy:{writable:!0,configurable:!0,value:function(x){return s.copy.call(this,x),!s.isShaderMaterial&&!s.isDerivedMaterial&&(assign$1(this.extensions,x.extensions),assign$1(this.defines,x.defines),assign$1(this.uniforms,UniformsUtils.clone(x.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const x=new s.constructor;return c(x).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let x=this._depthMaterial;return x||(x=this._depthMaterial=createDerivedMaterial(s.isDerivedMaterial?s.getDepthMaterial():new MeshDepthMaterial({depthPacking:RGBADepthPacking}),o),x.defines.IS_DEPTH_MATERIAL="",x.uniforms=this.uniforms),x}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let x=this._distanceMaterial;return x||(x=this._distanceMaterial=createDerivedMaterial(s.isDerivedMaterial?s.getDistanceMaterial():new MeshDistanceMaterial,o),x.defines.IS_DISTANCE_MATERIAL="",x.uniforms=this.uniforms),x}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:x,_distanceMaterial:y}=this;x&&x.dispose(),y&&y.dispose(),s.dispose.call(this)}}};return v[g]=f,new f}function upgradeShaders(s,{vertexShader:o,fragmentShader:g},v,i){let{vertexDefs:a,vertexMainIntro:f,vertexMainOutro:c,vertexTransform:d,fragmentDefs:x,fragmentMainIntro:y,fragmentMainOutro:_,fragmentColorTransform:S,customRewriter:b,timeUniform:w}=v;if(a=a||"",f=f||"",c=c||"",x=x||"",y=y||"",_=_||"",(d||b)&&(o=expandShaderIncludes(o)),(S||b)&&(g=g.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),g=expandShaderIncludes(g)),b){let T=b({vertexShader:o,fragmentShader:g});o=T.vertexShader,g=T.fragmentShader}if(S){let T=[];g=g.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,E=>(T.push(E),"")),_=`${S}
${T.join(`
`)}
${_}`}if(w){const T=`
uniform float ${w};
`;a=T+a,x=T+x}return d&&(o=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${o}
`,a=`${a}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${d}
}
`,f=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${f}
`,o=o.replace(/\b(position|normal|uv)\b/g,(T,E,I,F)=>/\battribute\s+vec[23]\s+$/.test(F.substr(0,I))?E:`troika_${E}_${i}`),s.map&&s.map.channel>0||(o=o.replace(/\bMAP_UV\b/g,`troika_uv_${i}`))),o=injectIntoShaderCode(o,i,a,f,c),g=injectIntoShaderCode(g,i,x,y,_),{vertexShader:o,fragmentShader:g}}function injectIntoShaderCode(s,o,g,v,i){return(v||i||g)&&(s=s.replace(voidMainRegExp,`
${g}
void troikaOrigMain${o}() {`),s+=`
void main() {
  ${v}
  troikaOrigMain${o}();
  ${i}
}`),s}function optionsJsonReplacer(s,o){return s==="uniforms"?void 0:typeof o=="function"?o.toString():o}let _idCtr=0;const optionsHashesToIds=new Map;function getKeyForOptions(s){const o=JSON.stringify(s,optionsJsonReplacer);let g=optionsHashesToIds.get(o);return g==null&&optionsHashesToIds.set(o,g=++_idCtr),g}function createTypesetter(s,o,g){const{defaultFontURL:v}=g,i=Object.create(null),a=1/0,f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,c="[^\\S\\u00A0]",d=new RegExp(`${c}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function x(F,M){function O(){const R=D=>{console.error(`Failure loading font ${F}${F===v?"":"; trying fallback"}`,D),F!==v&&(F=v,O())};try{const D=new XMLHttpRequest;D.open("get",F,!0),D.responseType="arraybuffer",D.onload=function(){if(D.status>=400)R(new Error(D.statusText));else if(D.status>0)try{const P=s(D.response);M(P)}catch(P){R(P)}},D.onerror=R,D.send()}catch(D){R(D)}}O()}function y(F,M){F||(F=v);let O=i[F];O?O.pending?O.pending.push(M):M(O):(i[F]={pending:[M]},x(F,R=>{let D=i[F].pending;i[F]=R,D.forEach(P=>P(R))}))}function _({text:F="",font:M=v,sdfGlyphSize:O=64,fontSize:R=1,letterSpacing:D=0,lineHeight:P="normal",maxWidth:B=a,direction:ee,textAlign:ne="left",textIndent:ce=0,whiteSpace:A="normal",overflowWrap:Y="normal",anchorX:L=0,anchorY:J=0,includeCaretPositions:$=!1,chunkedBoundsSize:xe=8192,colorRanges:me=null},j,Q=!1){const U=T(),C={fontLoad:0,typesetting:0};F.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),F=F.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),R=+R,D=+D,B=+B,P=P||"normal",ce=+ce,y(M,N=>{const V=isFinite(B);let G=null,Z=null,H=null,z=null,te=null,le=null,re=null,W=0,Fe=0,be=A!=="nowrap";const{ascender:ae,descender:ue,unitsPerEm:ye,lineGap:K,capHeight:de,xHeight:ie}=N;C.fontLoad=T()-U;const X=T(),pe=R/ye;P==="normal"&&(P=(ae-ue+K)/ye),P=P*R;const se=(P-(ae-ue)*pe)/2,ve=-(ae*pe+se),oe=Math.min(P,(ae-ue)*pe),Ae=(ae+ue)/2*pe-oe/2;let Ee=ce,he=new E;const Se=[he];N.forEachGlyph(F,R,D,(_e,Me,Te)=>{const ge=F.charAt(Te),Re=_e.advanceWidth*pe,ke=he.count;let Ge;if("isEmpty"in _e||(_e.isWhitespace=!!ge&&new RegExp(c).test(ge),_e.canBreakAfter=!!ge&&d.test(ge),_e.isEmpty=_e.xMin===_e.xMax||_e.yMin===_e.yMax||f.test(ge)),!_e.isWhitespace&&!_e.isEmpty&&Fe++,be&&V&&!_e.isWhitespace&&Me+Re+Ee>B&&ke){if(he.glyphAt(ke-1).glyphObj.canBreakAfter)Ge=new E,Ee=-Me;else for(let De=ke;De--;)if(De===0&&Y==="break-word"){Ge=new E,Ee=-Me;break}else if(he.glyphAt(De).glyphObj.canBreakAfter){Ge=he.splitAt(De+1);const We=Ge.glyphAt(0).x;Ee-=We;for(let rt=Ge.count;rt--;)Ge.glyphAt(rt).x-=We;break}Ge&&(he.isSoftWrapped=!0,he=Ge,Se.push(he),W=B)}let Ue=he.glyphAt(he.count);Ue.glyphObj=_e,Ue.x=Me+Ee,Ue.width=Re,Ue.charIndex=Te,ge===`
`&&(he=new E,Se.push(he),Ee=-(Me+Re+D*R)+ce)}),Se.forEach(_e=>{for(let Me=_e.count;Me--;){let{glyphObj:Te,x:ge,width:Re}=_e.glyphAt(Me);if(!Te.isWhitespace){_e.width=ge+Re,_e.width>W&&(W=_e.width);return}}});let we=0,Ie=0;if(L&&(typeof L=="number"?we=-L:typeof L=="string"&&(we=-W*(L==="left"?0:L==="center"?.5:L==="right"?1:b(L)))),J){if(typeof J=="number")Ie=-J;else if(typeof J=="string"){let _e=Se.length*P;Ie=J==="top"?0:J==="top-baseline"?-ve:J==="top-cap"?-ve-de*pe:J==="top-ex"?-ve-ie*pe:J==="middle"?_e/2:J==="bottom"?_e:J==="bottom-baseline"?_e-se+ue*pe:b(J)*_e}}if(!Q){const _e=o.getEmbeddingLevels(F,ee);G=new Uint16Array(Fe),Z=new Float32Array(Fe*2),H={},le=[a,a,-a,-a],re=[];let Me=ve;$&&(te=new Float32Array(F.length*3)),me&&(z=new Uint8Array(Fe*3));let Te=0,ge=-1,Re=-1,ke,Ge;if(Se.forEach((Ue,De)=>{let{count:We,width:rt}=Ue;if(We>0){let st=0;for(let Pe=We;Pe--&&Ue.glyphAt(Pe).glyphObj.isWhitespace;)st++;let nt=0,Ke=0;if(ne==="center")nt=(W-rt)/2;else if(ne==="right")nt=W-rt;else if(ne==="justify"&&Ue.isSoftWrapped){let Pe=0;for(let Oe=We-st;Oe--;)Ue.glyphAt(Oe).glyphObj.isWhitespace&&Pe++;Ke=(W-rt)/Pe}if(Ke||nt){let Pe=0;for(let Oe=0;Oe<We;Oe++){let Ze=Ue.glyphAt(Oe);const Ye=Ze.glyphObj;Ze.x+=nt+Pe,Ke!==0&&Ye.isWhitespace&&Oe<We-st&&(Pe+=Ke,Ze.width+=Ke)}}const Ve=o.getReorderSegments(F,_e,Ue.glyphAt(0).charIndex,Ue.glyphAt(Ue.count-1).charIndex);for(let Pe=0;Pe<Ve.length;Pe++){const[Oe,Ze]=Ve[Pe];let Ye=1/0,Ce=-1/0;for(let He=0;He<We;He++)if(Ue.glyphAt(He).charIndex>=Oe){let Qe=He,Ne=He;for(;Ne<We;Ne++){let Le=Ue.glyphAt(Ne);if(Le.charIndex>Ze)break;Ne<We-st&&(Ye=Math.min(Ye,Le.x),Ce=Math.max(Ce,Le.x+Le.width))}for(let Le=Qe;Le<Ne;Le++){const je=Ue.glyphAt(Le);je.x=Ce-(je.x+je.width-Ye)}break}}let Be;const dt=Pe=>Be=Pe;for(let Pe=0;Pe<We;Pe++){let Oe=Ue.glyphAt(Pe);Be=Oe.glyphObj;const Ze=Be.index,Ye=_e.levels[Oe.charIndex]&1;if(Ye){const Ce=o.getMirroredCharacter(F[Oe.charIndex]);Ce&&N.forEachGlyph(Ce,0,0,dt)}if($){const{charIndex:Ce}=Oe,He=Oe.x+we,Qe=Oe.x+Oe.width+we;te[Ce*3]=Ye?Qe:He,te[Ce*3+1]=Ye?He:Qe,te[Ce*3+2]=Me+Ae+Ie;const Ne=Ce-ge;Ne>1&&w(te,ge,Ne),ge=Ce}if(me){const{charIndex:Ce}=Oe;for(;Ce>Re;)Re++,me.hasOwnProperty(Re)&&(Ge=me[Re])}if(!Be.isWhitespace&&!Be.isEmpty){const Ce=Te++;H[Ze]||(H[Ze]={path:Be.path,pathBounds:[Be.xMin,Be.yMin,Be.xMax,Be.yMax]});const He=Oe.x+we,Qe=Me+Ie;Z[Ce*2]=He,Z[Ce*2+1]=Qe;const Ne=He+Be.xMin*pe,Le=Qe+Be.yMin*pe,je=He+Be.xMax*pe,at=Qe+Be.yMax*pe;Ne<le[0]&&(le[0]=Ne),Le<le[1]&&(le[1]=Le),je>le[2]&&(le[2]=je),at>le[3]&&(le[3]=at),Ce%xe===0&&(ke={start:Ce,end:Ce,rect:[a,a,-a,-a]},re.push(ke)),ke.end++;const qe=ke.rect;if(Ne<qe[0]&&(qe[0]=Ne),Le<qe[1]&&(qe[1]=Le),je>qe[2]&&(qe[2]=je),at>qe[3]&&(qe[3]=at),G[Ce]=Ze,me){const lt=Ce*3;z[lt]=Ge>>16&255,z[lt+1]=Ge>>8&255,z[lt+2]=Ge&255}}}}Me-=P}),te){const Ue=F.length-ge;Ue>1&&w(te,ge,Ue)}}C.typesetting=T()-X,j({glyphIds:G,glyphPositions:Z,glyphData:H,caretPositions:te,caretHeight:oe,glyphColors:z,chunkedBounds:re,fontSize:R,unitsPerEm:ye,ascender:ae*pe,descender:ue*pe,capHeight:de*pe,xHeight:ie*pe,lineHeight:P,topBaseline:ve,blockBounds:[we,Ie-Se.length*P,we+W,Ie],visibleBounds:le,timings:C})})}function S(F,M){_(F,O=>{const[R,D,P,B]=O.blockBounds;M({width:P-R,height:B-D})},{metricsOnly:!0})}function b(F){let M=F.match(/^([\d.]+)%$/),O=M?parseFloat(M[1]):NaN;return isNaN(O)?0:O/100}function w(F,M,O){const R=F[M*3],D=F[M*3+1],P=F[M*3+2],B=(D-R)/O;for(let ee=0;ee<O;ee++){const ne=(M+ee)*3;F[ne]=R+B*ee,F[ne+1]=R+B*(ee+1),F[ne+2]=P}}function T(){return(self.performance||Date).now()}function E(){this.data=[]}const I=["glyphObj","x","width","charIndex"];return E.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/I.length)},glyphAt(F){let M=E.flyweight;return M.data=this.data,M.index=F,M},splitAt(F){let M=new E;return M.data=this.data.splice(F*I.length),M}},E.flyweight=I.reduce((F,M,O,R)=>(Object.defineProperty(F,M,{get(){return this.data[this.index*I.length+O]},set(D){this.data[this.index*I.length+O]=D}}),F),{data:null,index:0}),{typeset:_,measure:S,loadFont:y}}const now=()=>(self.performance||Date).now(),mainThreadGenerator=SDFGenerator();let warned;function generateSDF(s,o,g,v,i,a,f,c,d,x,y=!0){return y?generateSDF_GL(s,o,g,v,i,a,f,c,d,x).then(null,_=>(warned||(console.warn("WebGL SDF generation failed, falling back to JS",_),warned=!0),generateSDF_JS_Worker(s,o,g,v,i,a,f,c,d,x))):generateSDF_JS_Worker(s,o,g,v,i,a,f,c,d,x)}const queue=[],chunkTimeBudget=5;let timer=0;function nextChunk(){const s=now();for(;queue.length&&now()-s<chunkTimeBudget;)queue.shift()();timer=queue.length?setTimeout(nextChunk,0):0}const generateSDF_GL=(...s)=>new Promise((o,g)=>{queue.push(()=>{const v=now();try{mainThreadGenerator.webgl.generateIntoCanvas(...s),o({timing:now()-v})}catch(i){g(i)}}),timer||(timer=setTimeout(nextChunk,0))}),threadCount=4,idleTimeout=2e3,threads={};let callNum=0;function generateSDF_JS_Worker(s,o,g,v,i,a,f,c,d,x){const y="TroikaTextSDFGenerator_JS_"+callNum++%threadCount;let _=threads[y];return _||(_=threads[y]={workerModule:defineWorkerModule({name:y,workerId:y,dependencies:[SDFGenerator,now],init(S,b){const w=S().javascript.generate;return function(...T){const E=b();return{textureData:w(...T),timing:b()-E}}},getTransferables(S){return[S.textureData.buffer]}}),requests:0,idleTimer:null}),_.requests++,clearTimeout(_.idleTimer),_.workerModule(s,o,g,v,i,a).then(({textureData:S,timing:b})=>{const w=now(),T=new Uint8Array(S.length*4);for(let E=0;E<S.length;E++)T[E*4+x]=S[E];return mainThreadGenerator.webglUtils.renderImageData(f,T,c,d,s,o,1<<3-x),b+=now()-w,--_.requests===0&&(_.idleTimer=setTimeout(()=>{terminateWorker(y)},idleTimeout)),{timing:b}})}function warmUpSDFCanvas(s){s._warm||(mainThreadGenerator.webgl.isSupported(s),s._warm=!0)}const resizeWebGLCanvasWithoutClearing=mainThreadGenerator.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function typrFactory(){return typeof window>"u"&&(self.window=self),function(s){var o={parse:function(i){var a=o._bin,f=new Uint8Array(i);if(a.readASCII(f,0,4)=="ttcf"){var c=4;a.readUshort(f,c),c+=2,a.readUshort(f,c),c+=2;var d=a.readUint(f,c);c+=4;for(var x=[],y=0;y<d;y++){var _=a.readUint(f,c);c+=4,x.push(o._readFont(f,_))}return x}return[o._readFont(f,0)]},_readFont:function(i,a){var f=o._bin,c=a;f.readFixed(i,a),a+=4;var d=f.readUshort(i,a);a+=2,f.readUshort(i,a),a+=2,f.readUshort(i,a),a+=2,f.readUshort(i,a),a+=2;for(var x=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],y={_data:i,_offset:c},_={},S=0;S<d;S++){var b=f.readASCII(i,a,4);a+=4,f.readUint(i,a),a+=4;var w=f.readUint(i,a);a+=4;var T=f.readUint(i,a);a+=4,_[b]={offset:w,length:T}}for(S=0;S<x.length;S++){var E=x[S];_[E]&&(y[E.trim()]=o[E.trim()].parse(i,_[E].offset,_[E].length,y))}return y},_tabOffset:function(i,a,f){for(var c=o._bin,d=c.readUshort(i,f+4),x=f+12,y=0;y<d;y++){var _=c.readASCII(i,x,4);x+=4,c.readUint(i,x),x+=4;var S=c.readUint(i,x);if(x+=4,c.readUint(i,x),x+=4,_==a)return S}return 0}};o._bin={readFixed:function(i,a){return(i[a]<<8|i[a+1])+(i[a+2]<<8|i[a+3])/65540},readF2dot14:function(i,a){return o._bin.readShort(i,a)/16384},readInt:function(i,a){return o._bin._view(i).getInt32(a)},readInt8:function(i,a){return o._bin._view(i).getInt8(a)},readShort:function(i,a){return o._bin._view(i).getInt16(a)},readUshort:function(i,a){return o._bin._view(i).getUint16(a)},readUshorts:function(i,a,f){for(var c=[],d=0;d<f;d++)c.push(o._bin.readUshort(i,a+2*d));return c},readUint:function(i,a){return o._bin._view(i).getUint32(a)},readUint64:function(i,a){return 4294967296*o._bin.readUint(i,a)+o._bin.readUint(i,a+4)},readASCII:function(i,a,f){for(var c="",d=0;d<f;d++)c+=String.fromCharCode(i[a+d]);return c},readUnicode:function(i,a,f){for(var c="",d=0;d<f;d++){var x=i[a++]<<8|i[a++];c+=String.fromCharCode(x)}return c},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(i,a,f){var c=o._bin._tdec;return c&&a==0&&f==i.length?c.decode(i):o._bin.readASCII(i,a,f)},readBytes:function(i,a,f){for(var c=[],d=0;d<f;d++)c.push(i[a+d]);return c},readASCIIArray:function(i,a,f){for(var c=[],d=0;d<f;d++)c.push(String.fromCharCode(i[a+d]));return c},_view:function(i){return i._dataView||(i._dataView=i.buffer?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(new Uint8Array(i).buffer))}},o._lctf={},o._lctf.parse=function(i,a,f,c,d){var x=o._bin,y={},_=a;x.readFixed(i,a),a+=4;var S=x.readUshort(i,a);a+=2;var b=x.readUshort(i,a);a+=2;var w=x.readUshort(i,a);return a+=2,y.scriptList=o._lctf.readScriptList(i,_+S),y.featureList=o._lctf.readFeatureList(i,_+b),y.lookupList=o._lctf.readLookupList(i,_+w,d),y},o._lctf.readLookupList=function(i,a,f){var c=o._bin,d=a,x=[],y=c.readUshort(i,a);a+=2;for(var _=0;_<y;_++){var S=c.readUshort(i,a);a+=2;var b=o._lctf.readLookupTable(i,d+S,f);x.push(b)}return x},o._lctf.readLookupTable=function(i,a,f){var c=o._bin,d=a,x={tabs:[]};x.ltype=c.readUshort(i,a),a+=2,x.flag=c.readUshort(i,a),a+=2;var y=c.readUshort(i,a);a+=2;for(var _=x.ltype,S=0;S<y;S++){var b=c.readUshort(i,a);a+=2;var w=f(i,_,d+b,x);x.tabs.push(w)}return x},o._lctf.numOfOnes=function(i){for(var a=0,f=0;f<32;f++)i>>>f&1&&a++;return a},o._lctf.readClassDef=function(i,a){var f=o._bin,c=[],d=f.readUshort(i,a);if(a+=2,d==1){var x=f.readUshort(i,a);a+=2;var y=f.readUshort(i,a);a+=2;for(var _=0;_<y;_++)c.push(x+_),c.push(x+_),c.push(f.readUshort(i,a)),a+=2}if(d==2){var S=f.readUshort(i,a);for(a+=2,_=0;_<S;_++)c.push(f.readUshort(i,a)),a+=2,c.push(f.readUshort(i,a)),a+=2,c.push(f.readUshort(i,a)),a+=2}return c},o._lctf.getInterval=function(i,a){for(var f=0;f<i.length;f+=3){var c=i[f],d=i[f+1];if(i[f+2],c<=a&&a<=d)return f}return-1},o._lctf.readCoverage=function(i,a){var f=o._bin,c={};c.fmt=f.readUshort(i,a),a+=2;var d=f.readUshort(i,a);return a+=2,c.fmt==1&&(c.tab=f.readUshorts(i,a,d)),c.fmt==2&&(c.tab=f.readUshorts(i,a,3*d)),c},o._lctf.coverageIndex=function(i,a){var f=i.tab;if(i.fmt==1)return f.indexOf(a);if(i.fmt==2){var c=o._lctf.getInterval(f,a);if(c!=-1)return f[c+2]+(a-f[c])}return-1},o._lctf.readFeatureList=function(i,a){var f=o._bin,c=a,d=[],x=f.readUshort(i,a);a+=2;for(var y=0;y<x;y++){var _=f.readASCII(i,a,4);a+=4;var S=f.readUshort(i,a);a+=2;var b=o._lctf.readFeatureTable(i,c+S);b.tag=_.trim(),d.push(b)}return d},o._lctf.readFeatureTable=function(i,a){var f=o._bin,c=a,d={},x=f.readUshort(i,a);a+=2,x>0&&(d.featureParams=c+x);var y=f.readUshort(i,a);a+=2,d.tab=[];for(var _=0;_<y;_++)d.tab.push(f.readUshort(i,a+2*_));return d},o._lctf.readScriptList=function(i,a){var f=o._bin,c=a,d={},x=f.readUshort(i,a);a+=2;for(var y=0;y<x;y++){var _=f.readASCII(i,a,4);a+=4;var S=f.readUshort(i,a);a+=2,d[_.trim()]=o._lctf.readScriptTable(i,c+S)}return d},o._lctf.readScriptTable=function(i,a){var f=o._bin,c=a,d={},x=f.readUshort(i,a);a+=2,d.default=o._lctf.readLangSysTable(i,c+x);var y=f.readUshort(i,a);a+=2;for(var _=0;_<y;_++){var S=f.readASCII(i,a,4);a+=4;var b=f.readUshort(i,a);a+=2,d[S.trim()]=o._lctf.readLangSysTable(i,c+b)}return d},o._lctf.readLangSysTable=function(i,a){var f=o._bin,c={};f.readUshort(i,a),a+=2,c.reqFeature=f.readUshort(i,a),a+=2;var d=f.readUshort(i,a);return a+=2,c.features=f.readUshorts(i,a,d),c},o.CFF={},o.CFF.parse=function(i,a,f){var c=o._bin;(i=new Uint8Array(i.buffer,a,f))[a=0],i[++a],i[++a],i[++a],a++;var d=[];a=o.CFF.readIndex(i,a,d);for(var x=[],y=0;y<d.length-1;y++)x.push(c.readASCII(i,a+d[y],d[y+1]-d[y]));a+=d[d.length-1];var _=[];a=o.CFF.readIndex(i,a,_);var S=[];for(y=0;y<_.length-1;y++)S.push(o.CFF.readDict(i,a+_[y],a+_[y+1]));a+=_[_.length-1];var b=S[0],w=[];a=o.CFF.readIndex(i,a,w);var T=[];for(y=0;y<w.length-1;y++)T.push(c.readASCII(i,a+w[y],w[y+1]-w[y]));if(a+=w[w.length-1],o.CFF.readSubrs(i,a,b),b.CharStrings){a=b.CharStrings,w=[],a=o.CFF.readIndex(i,a,w);var E=[];for(y=0;y<w.length-1;y++)E.push(c.readBytes(i,a+w[y],w[y+1]-w[y]));b.CharStrings=E}if(b.ROS){a=b.FDArray;var I=[];for(a=o.CFF.readIndex(i,a,I),b.FDArray=[],y=0;y<I.length-1;y++){var F=o.CFF.readDict(i,a+I[y],a+I[y+1]);o.CFF._readFDict(i,F,T),b.FDArray.push(F)}a+=I[I.length-1],a=b.FDSelect,b.FDSelect=[];var M=i[a];if(a++,M!=3)throw M;var O=c.readUshort(i,a);for(a+=2,y=0;y<O+1;y++)b.FDSelect.push(c.readUshort(i,a),i[a+2]),a+=3}return b.Encoding&&(b.Encoding=o.CFF.readEncoding(i,b.Encoding,b.CharStrings.length)),b.charset&&(b.charset=o.CFF.readCharset(i,b.charset,b.CharStrings.length)),o.CFF._readFDict(i,b,T),b},o.CFF._readFDict=function(i,a,f){var c;for(var d in a.Private&&(c=a.Private[1],a.Private=o.CFF.readDict(i,c,c+a.Private[0]),a.Private.Subrs&&o.CFF.readSubrs(i,c+a.Private.Subrs,a.Private)),a)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(d)!=-1&&(a[d]=f[a[d]-426+35])},o.CFF.readSubrs=function(i,a,f){var c=o._bin,d=[];a=o.CFF.readIndex(i,a,d);var x,y=d.length;x=y<1240?107:y<33900?1131:32768,f.Bias=x,f.Subrs=[];for(var _=0;_<d.length-1;_++)f.Subrs.push(c.readBytes(i,a+d[_],d[_+1]-d[_]))},o.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],o.CFF.glyphByUnicode=function(i,a){for(var f=0;f<i.charset.length;f++)if(i.charset[f]==a)return f;return-1},o.CFF.glyphBySE=function(i,a){return a<0||a>255?-1:o.CFF.glyphByUnicode(i,o.CFF.tableSE[a])},o.CFF.readEncoding=function(i,a,f){o._bin;var c=[".notdef"],d=i[a];if(a++,d!=0)throw"error: unknown encoding format: "+d;var x=i[a];a++;for(var y=0;y<x;y++)c.push(i[a+y]);return c},o.CFF.readCharset=function(i,a,f){var c=o._bin,d=[".notdef"],x=i[a];if(a++,x==0)for(var y=0;y<f;y++){var _=c.readUshort(i,a);a+=2,d.push(_)}else{if(x!=1&&x!=2)throw"error: format: "+x;for(;d.length<f;){_=c.readUshort(i,a),a+=2;var S=0;for(x==1?(S=i[a],a++):(S=c.readUshort(i,a),a+=2),y=0;y<=S;y++)d.push(_),_++}}return d},o.CFF.readIndex=function(i,a,f){var c=o._bin,d=c.readUshort(i,a)+1,x=i[a+=2];if(a++,x==1)for(var y=0;y<d;y++)f.push(i[a+y]);else if(x==2)for(y=0;y<d;y++)f.push(c.readUshort(i,a+2*y));else if(x==3)for(y=0;y<d;y++)f.push(16777215&c.readUint(i,a+3*y-1));else if(d!=1)throw"unsupported offset size: "+x+", count: "+d;return(a+=d*x)-1},o.CFF.getCharString=function(i,a,f){var c=o._bin,d=i[a],x=i[a+1];i[a+2],i[a+3],i[a+4];var y=1,_=null,S=null;d<=20&&(_=d,y=1),d==12&&(_=100*d+x,y=2),21<=d&&d<=27&&(_=d,y=1),d==28&&(S=c.readShort(i,a+1),y=3),29<=d&&d<=31&&(_=d,y=1),32<=d&&d<=246&&(S=d-139,y=1),247<=d&&d<=250&&(S=256*(d-247)+x+108,y=2),251<=d&&d<=254&&(S=256*-(d-251)-x-108,y=2),d==255&&(S=c.readInt(i,a+1)/65535,y=5),f.val=S??"o"+_,f.size=y},o.CFF.readCharString=function(i,a,f){for(var c=a+f,d=o._bin,x=[];a<c;){var y=i[a],_=i[a+1];i[a+2],i[a+3],i[a+4];var S=1,b=null,w=null;y<=20&&(b=y,S=1),y==12&&(b=100*y+_,S=2),y!=19&&y!=20||(b=y,S=2),21<=y&&y<=27&&(b=y,S=1),y==28&&(w=d.readShort(i,a+1),S=3),29<=y&&y<=31&&(b=y,S=1),32<=y&&y<=246&&(w=y-139,S=1),247<=y&&y<=250&&(w=256*(y-247)+_+108,S=2),251<=y&&y<=254&&(w=256*-(y-251)-_-108,S=2),y==255&&(w=d.readInt(i,a+1)/65535,S=5),x.push(w??"o"+b),a+=S}return x},o.CFF.readDict=function(i,a,f){for(var c=o._bin,d={},x=[];a<f;){var y=i[a],_=i[a+1];i[a+2],i[a+3],i[a+4];var S=1,b=null,w=null;if(y==28&&(w=c.readShort(i,a+1),S=3),y==29&&(w=c.readInt(i,a+1),S=5),32<=y&&y<=246&&(w=y-139,S=1),247<=y&&y<=250&&(w=256*(y-247)+_+108,S=2),251<=y&&y<=254&&(w=256*-(y-251)-_-108,S=2),y==255)throw w=c.readInt(i,a+1)/65535,S=5,"unknown number";if(y==30){var T=[];for(S=1;;){var E=i[a+S];S++;var I=E>>4,F=15&E;if(I!=15&&T.push(I),F!=15&&T.push(F),F==15)break}for(var M="",O=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],R=0;R<T.length;R++)M+=O[T[R]];w=parseFloat(M)}y<=21&&(b=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][y],S=1,y==12&&(b=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][_],S=2)),b!=null?(d[b]=x.length==1?x[0]:x,x=[]):x.push(w),a+=S}return d},o.cmap={},o.cmap.parse=function(i,a,f){i=new Uint8Array(i.buffer,a,f),a=0;var c=o._bin,d={};c.readUshort(i,a),a+=2;var x=c.readUshort(i,a);a+=2;var y=[];d.tables=[];for(var _=0;_<x;_++){var S=c.readUshort(i,a);a+=2;var b=c.readUshort(i,a);a+=2;var w=c.readUint(i,a);a+=4;var T="p"+S+"e"+b,E=y.indexOf(w);if(E==-1){var I;E=d.tables.length,y.push(w);var F=c.readUshort(i,w);F==0?I=o.cmap.parse0(i,w):F==4?I=o.cmap.parse4(i,w):F==6?I=o.cmap.parse6(i,w):F==12?I=o.cmap.parse12(i,w):console.debug("unknown format: "+F,S,b,w),d.tables.push(I)}if(d[T]!=null)throw"multiple tables for one platform+encoding";d[T]=E}return d},o.cmap.parse0=function(i,a){var f=o._bin,c={};c.format=f.readUshort(i,a),a+=2;var d=f.readUshort(i,a);a+=2,f.readUshort(i,a),a+=2,c.map=[];for(var x=0;x<d-6;x++)c.map.push(i[a+x]);return c},o.cmap.parse4=function(i,a){var f=o._bin,c=a,d={};d.format=f.readUshort(i,a),a+=2;var x=f.readUshort(i,a);a+=2,f.readUshort(i,a),a+=2;var y=f.readUshort(i,a);a+=2;var _=y/2;d.searchRange=f.readUshort(i,a),a+=2,d.entrySelector=f.readUshort(i,a),a+=2,d.rangeShift=f.readUshort(i,a),a+=2,d.endCount=f.readUshorts(i,a,_),a+=2*_,a+=2,d.startCount=f.readUshorts(i,a,_),a+=2*_,d.idDelta=[];for(var S=0;S<_;S++)d.idDelta.push(f.readShort(i,a)),a+=2;for(d.idRangeOffset=f.readUshorts(i,a,_),a+=2*_,d.glyphIdArray=[];a<c+x;)d.glyphIdArray.push(f.readUshort(i,a)),a+=2;return d},o.cmap.parse6=function(i,a){var f=o._bin,c={};c.format=f.readUshort(i,a),a+=2,f.readUshort(i,a),a+=2,f.readUshort(i,a),a+=2,c.firstCode=f.readUshort(i,a),a+=2;var d=f.readUshort(i,a);a+=2,c.glyphIdArray=[];for(var x=0;x<d;x++)c.glyphIdArray.push(f.readUshort(i,a)),a+=2;return c},o.cmap.parse12=function(i,a){var f=o._bin,c={};c.format=f.readUshort(i,a),a+=2,a+=2,f.readUint(i,a),a+=4,f.readUint(i,a),a+=4;var d=f.readUint(i,a);a+=4,c.groups=[];for(var x=0;x<d;x++){var y=a+12*x,_=f.readUint(i,y+0),S=f.readUint(i,y+4),b=f.readUint(i,y+8);c.groups.push([_,S,b])}return c},o.glyf={},o.glyf.parse=function(i,a,f,c){for(var d=[],x=0;x<c.maxp.numGlyphs;x++)d.push(null);return d},o.glyf._parseGlyf=function(i,a){var f=o._bin,c=i._data,d=o._tabOffset(c,"glyf",i._offset)+i.loca[a];if(i.loca[a]==i.loca[a+1])return null;var x={};if(x.noc=f.readShort(c,d),d+=2,x.xMin=f.readShort(c,d),d+=2,x.yMin=f.readShort(c,d),d+=2,x.xMax=f.readShort(c,d),d+=2,x.yMax=f.readShort(c,d),d+=2,x.xMin>=x.xMax||x.yMin>=x.yMax)return null;if(x.noc>0){x.endPts=[];for(var y=0;y<x.noc;y++)x.endPts.push(f.readUshort(c,d)),d+=2;var _=f.readUshort(c,d);if(d+=2,c.length-d<_)return null;x.instructions=f.readBytes(c,d,_),d+=_;var S=x.endPts[x.noc-1]+1;for(x.flags=[],y=0;y<S;y++){var b=c[d];if(d++,x.flags.push(b),(8&b)!=0){var w=c[d];d++;for(var T=0;T<w;T++)x.flags.push(b),y++}}for(x.xs=[],y=0;y<S;y++){var E=(2&x.flags[y])!=0,I=(16&x.flags[y])!=0;E?(x.xs.push(I?c[d]:-c[d]),d++):I?x.xs.push(0):(x.xs.push(f.readShort(c,d)),d+=2)}for(x.ys=[],y=0;y<S;y++)E=(4&x.flags[y])!=0,I=(32&x.flags[y])!=0,E?(x.ys.push(I?c[d]:-c[d]),d++):I?x.ys.push(0):(x.ys.push(f.readShort(c,d)),d+=2);var F=0,M=0;for(y=0;y<S;y++)F+=x.xs[y],M+=x.ys[y],x.xs[y]=F,x.ys[y]=M}else{var O;x.parts=[];do{O=f.readUshort(c,d),d+=2;var R={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(x.parts.push(R),R.glyphIndex=f.readUshort(c,d),d+=2,1&O){var D=f.readShort(c,d);d+=2;var P=f.readShort(c,d);d+=2}else D=f.readInt8(c,d),d++,P=f.readInt8(c,d),d++;2&O?(R.m.tx=D,R.m.ty=P):(R.p1=D,R.p2=P),8&O?(R.m.a=R.m.d=f.readF2dot14(c,d),d+=2):64&O?(R.m.a=f.readF2dot14(c,d),d+=2,R.m.d=f.readF2dot14(c,d),d+=2):128&O&&(R.m.a=f.readF2dot14(c,d),d+=2,R.m.b=f.readF2dot14(c,d),d+=2,R.m.c=f.readF2dot14(c,d),d+=2,R.m.d=f.readF2dot14(c,d),d+=2)}while(32&O);if(256&O){var B=f.readUshort(c,d);for(d+=2,x.instr=[],y=0;y<B;y++)x.instr.push(c[d]),d++}}return x},o.GPOS={},o.GPOS.parse=function(i,a,f,c){return o._lctf.parse(i,a,f,c,o.GPOS.subt)},o.GPOS.subt=function(i,a,f,c){var d=o._bin,x=f,y={};if(y.fmt=d.readUshort(i,f),f+=2,a==1||a==2||a==3||a==7||a==8&&y.fmt<=2){var _=d.readUshort(i,f);f+=2,y.coverage=o._lctf.readCoverage(i,_+x)}if(a==1&&y.fmt==1){var S=d.readUshort(i,f);f+=2;var b=o._lctf.numOfOnes(S);S!=0&&(y.pos=o.GPOS.readValueRecord(i,f,S))}else if(a==2&&y.fmt>=1&&y.fmt<=2){S=d.readUshort(i,f),f+=2;var w=d.readUshort(i,f);f+=2,b=o._lctf.numOfOnes(S);var T=o._lctf.numOfOnes(w);if(y.fmt==1){y.pairsets=[];var E=d.readUshort(i,f);f+=2;for(var I=0;I<E;I++){var F=x+d.readUshort(i,f);f+=2;var M=d.readUshort(i,F);F+=2;for(var O=[],R=0;R<M;R++){var D=d.readUshort(i,F);F+=2,S!=0&&(A=o.GPOS.readValueRecord(i,F,S),F+=2*b),w!=0&&(Y=o.GPOS.readValueRecord(i,F,w),F+=2*T),O.push({gid2:D,val1:A,val2:Y})}y.pairsets.push(O)}}if(y.fmt==2){var P=d.readUshort(i,f);f+=2;var B=d.readUshort(i,f);f+=2;var ee=d.readUshort(i,f);f+=2;var ne=d.readUshort(i,f);for(f+=2,y.classDef1=o._lctf.readClassDef(i,x+P),y.classDef2=o._lctf.readClassDef(i,x+B),y.matrix=[],I=0;I<ee;I++){var ce=[];for(R=0;R<ne;R++){var A=null,Y=null;S!=0&&(A=o.GPOS.readValueRecord(i,f,S),f+=2*b),w!=0&&(Y=o.GPOS.readValueRecord(i,f,w),f+=2*T),ce.push({val1:A,val2:Y})}y.matrix.push(ce)}}}else{if(a==9&&y.fmt==1){var L=d.readUshort(i,f);f+=2;var J=d.readUint(i,f);if(f+=4,c.ltype==9)c.ltype=L;else if(c.ltype!=L)throw"invalid extension substitution";return o.GPOS.subt(i,c.ltype,x+J)}console.debug("unsupported GPOS table LookupType",a,"format",y.fmt)}return y},o.GPOS.readValueRecord=function(i,a,f){var c=o._bin,d=[];return d.push(1&f?c.readShort(i,a):0),a+=1&f?2:0,d.push(2&f?c.readShort(i,a):0),a+=2&f?2:0,d.push(4&f?c.readShort(i,a):0),a+=4&f?2:0,d.push(8&f?c.readShort(i,a):0),a+=8&f?2:0,d},o.GSUB={},o.GSUB.parse=function(i,a,f,c){return o._lctf.parse(i,a,f,c,o.GSUB.subt)},o.GSUB.subt=function(i,a,f,c){var d=o._bin,x=f,y={};if(y.fmt=d.readUshort(i,f),f+=2,a!=1&&a!=4&&a!=5&&a!=6)return null;if(a==1||a==4||a==5&&y.fmt<=2||a==6&&y.fmt<=2){var _=d.readUshort(i,f);f+=2,y.coverage=o._lctf.readCoverage(i,x+_)}if(a==1&&y.fmt>=1&&y.fmt<=2){if(y.fmt==1)y.delta=d.readShort(i,f),f+=2;else if(y.fmt==2){var S=d.readUshort(i,f);f+=2,y.newg=d.readUshorts(i,f,S),f+=2*y.newg.length}}else if(a==4){y.vals=[],S=d.readUshort(i,f),f+=2;for(var b=0;b<S;b++){var w=d.readUshort(i,f);f+=2,y.vals.push(o.GSUB.readLigatureSet(i,x+w))}}else if(a==5&&y.fmt==2){if(y.fmt==2){var T=d.readUshort(i,f);f+=2,y.cDef=o._lctf.readClassDef(i,x+T),y.scset=[];var E=d.readUshort(i,f);for(f+=2,b=0;b<E;b++){var I=d.readUshort(i,f);f+=2,y.scset.push(I==0?null:o.GSUB.readSubClassSet(i,x+I))}}}else if(a==6&&y.fmt==3){if(y.fmt==3){for(b=0;b<3;b++){S=d.readUshort(i,f),f+=2;for(var F=[],M=0;M<S;M++)F.push(o._lctf.readCoverage(i,x+d.readUshort(i,f+2*M)));f+=2*S,b==0&&(y.backCvg=F),b==1&&(y.inptCvg=F),b==2&&(y.ahedCvg=F)}S=d.readUshort(i,f),f+=2,y.lookupRec=o.GSUB.readSubstLookupRecords(i,f,S)}}else{if(a==7&&y.fmt==1){var O=d.readUshort(i,f);f+=2;var R=d.readUint(i,f);if(f+=4,c.ltype==9)c.ltype=O;else if(c.ltype!=O)throw"invalid extension substitution";return o.GSUB.subt(i,c.ltype,x+R)}console.debug("unsupported GSUB table LookupType",a,"format",y.fmt)}return y},o.GSUB.readSubClassSet=function(i,a){var f=o._bin.readUshort,c=a,d=[],x=f(i,a);a+=2;for(var y=0;y<x;y++){var _=f(i,a);a+=2,d.push(o.GSUB.readSubClassRule(i,c+_))}return d},o.GSUB.readSubClassRule=function(i,a){var f=o._bin.readUshort,c={},d=f(i,a),x=f(i,a+=2);a+=2,c.input=[];for(var y=0;y<d-1;y++)c.input.push(f(i,a)),a+=2;return c.substLookupRecords=o.GSUB.readSubstLookupRecords(i,a,x),c},o.GSUB.readSubstLookupRecords=function(i,a,f){for(var c=o._bin.readUshort,d=[],x=0;x<f;x++)d.push(c(i,a),c(i,a+2)),a+=4;return d},o.GSUB.readChainSubClassSet=function(i,a){var f=o._bin,c=a,d=[],x=f.readUshort(i,a);a+=2;for(var y=0;y<x;y++){var _=f.readUshort(i,a);a+=2,d.push(o.GSUB.readChainSubClassRule(i,c+_))}return d},o.GSUB.readChainSubClassRule=function(i,a){for(var f=o._bin,c={},d=["backtrack","input","lookahead"],x=0;x<d.length;x++){var y=f.readUshort(i,a);a+=2,x==1&&y--,c[d[x]]=f.readUshorts(i,a,y),a+=2*c[d[x]].length}return y=f.readUshort(i,a),a+=2,c.subst=f.readUshorts(i,a,2*y),a+=2*c.subst.length,c},o.GSUB.readLigatureSet=function(i,a){var f=o._bin,c=a,d=[],x=f.readUshort(i,a);a+=2;for(var y=0;y<x;y++){var _=f.readUshort(i,a);a+=2,d.push(o.GSUB.readLigature(i,c+_))}return d},o.GSUB.readLigature=function(i,a){var f=o._bin,c={chain:[]};c.nglyph=f.readUshort(i,a),a+=2;var d=f.readUshort(i,a);a+=2;for(var x=0;x<d-1;x++)c.chain.push(f.readUshort(i,a)),a+=2;return c},o.head={},o.head.parse=function(i,a,f){var c=o._bin,d={};return c.readFixed(i,a),a+=4,d.fontRevision=c.readFixed(i,a),a+=4,c.readUint(i,a),a+=4,c.readUint(i,a),a+=4,d.flags=c.readUshort(i,a),a+=2,d.unitsPerEm=c.readUshort(i,a),a+=2,d.created=c.readUint64(i,a),a+=8,d.modified=c.readUint64(i,a),a+=8,d.xMin=c.readShort(i,a),a+=2,d.yMin=c.readShort(i,a),a+=2,d.xMax=c.readShort(i,a),a+=2,d.yMax=c.readShort(i,a),a+=2,d.macStyle=c.readUshort(i,a),a+=2,d.lowestRecPPEM=c.readUshort(i,a),a+=2,d.fontDirectionHint=c.readShort(i,a),a+=2,d.indexToLocFormat=c.readShort(i,a),a+=2,d.glyphDataFormat=c.readShort(i,a),a+=2,d},o.hhea={},o.hhea.parse=function(i,a,f){var c=o._bin,d={};return c.readFixed(i,a),a+=4,d.ascender=c.readShort(i,a),a+=2,d.descender=c.readShort(i,a),a+=2,d.lineGap=c.readShort(i,a),a+=2,d.advanceWidthMax=c.readUshort(i,a),a+=2,d.minLeftSideBearing=c.readShort(i,a),a+=2,d.minRightSideBearing=c.readShort(i,a),a+=2,d.xMaxExtent=c.readShort(i,a),a+=2,d.caretSlopeRise=c.readShort(i,a),a+=2,d.caretSlopeRun=c.readShort(i,a),a+=2,d.caretOffset=c.readShort(i,a),a+=2,a+=8,d.metricDataFormat=c.readShort(i,a),a+=2,d.numberOfHMetrics=c.readUshort(i,a),a+=2,d},o.hmtx={},o.hmtx.parse=function(i,a,f,c){for(var d=o._bin,x={aWidth:[],lsBearing:[]},y=0,_=0,S=0;S<c.maxp.numGlyphs;S++)S<c.hhea.numberOfHMetrics&&(y=d.readUshort(i,a),a+=2,_=d.readShort(i,a),a+=2),x.aWidth.push(y),x.lsBearing.push(_);return x},o.kern={},o.kern.parse=function(i,a,f,c){var d=o._bin,x=d.readUshort(i,a);if(a+=2,x==1)return o.kern.parseV1(i,a-2,f,c);var y=d.readUshort(i,a);a+=2;for(var _={glyph1:[],rval:[]},S=0;S<y;S++){a+=2,f=d.readUshort(i,a),a+=2;var b=d.readUshort(i,a);a+=2;var w=b>>>8;if((w&=15)!=0)throw"unknown kern table format: "+w;a=o.kern.readFormat0(i,a,_)}return _},o.kern.parseV1=function(i,a,f,c){var d=o._bin;d.readFixed(i,a),a+=4;var x=d.readUint(i,a);a+=4;for(var y={glyph1:[],rval:[]},_=0;_<x;_++){d.readUint(i,a),a+=4;var S=d.readUshort(i,a);a+=2,d.readUshort(i,a),a+=2;var b=S>>>8;if((b&=15)!=0)throw"unknown kern table format: "+b;a=o.kern.readFormat0(i,a,y)}return y},o.kern.readFormat0=function(i,a,f){var c=o._bin,d=-1,x=c.readUshort(i,a);a+=2,c.readUshort(i,a),a+=2,c.readUshort(i,a),a+=2,c.readUshort(i,a),a+=2;for(var y=0;y<x;y++){var _=c.readUshort(i,a);a+=2;var S=c.readUshort(i,a);a+=2;var b=c.readShort(i,a);a+=2,_!=d&&(f.glyph1.push(_),f.rval.push({glyph2:[],vals:[]}));var w=f.rval[f.rval.length-1];w.glyph2.push(S),w.vals.push(b),d=_}return a},o.loca={},o.loca.parse=function(i,a,f,c){var d=o._bin,x=[],y=c.head.indexToLocFormat,_=c.maxp.numGlyphs+1;if(y==0)for(var S=0;S<_;S++)x.push(d.readUshort(i,a+(S<<1))<<1);if(y==1)for(S=0;S<_;S++)x.push(d.readUint(i,a+(S<<2)));return x},o.maxp={},o.maxp.parse=function(i,a,f){var c=o._bin,d={},x=c.readUint(i,a);return a+=4,d.numGlyphs=c.readUshort(i,a),a+=2,x==65536&&(d.maxPoints=c.readUshort(i,a),a+=2,d.maxContours=c.readUshort(i,a),a+=2,d.maxCompositePoints=c.readUshort(i,a),a+=2,d.maxCompositeContours=c.readUshort(i,a),a+=2,d.maxZones=c.readUshort(i,a),a+=2,d.maxTwilightPoints=c.readUshort(i,a),a+=2,d.maxStorage=c.readUshort(i,a),a+=2,d.maxFunctionDefs=c.readUshort(i,a),a+=2,d.maxInstructionDefs=c.readUshort(i,a),a+=2,d.maxStackElements=c.readUshort(i,a),a+=2,d.maxSizeOfInstructions=c.readUshort(i,a),a+=2,d.maxComponentElements=c.readUshort(i,a),a+=2,d.maxComponentDepth=c.readUshort(i,a),a+=2),d},o.name={},o.name.parse=function(i,a,f){var c=o._bin,d={};c.readUshort(i,a),a+=2;var x=c.readUshort(i,a);a+=2,c.readUshort(i,a);for(var y,_=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],S=a+=2,b=0;b<x;b++){var w=c.readUshort(i,a);a+=2;var T=c.readUshort(i,a);a+=2;var E=c.readUshort(i,a);a+=2;var I=c.readUshort(i,a);a+=2;var F=c.readUshort(i,a);a+=2;var M=c.readUshort(i,a);a+=2;var O,R=_[I],D=S+12*x+M;if(w==0)O=c.readUnicode(i,D,F/2);else if(w==3&&T==0)O=c.readUnicode(i,D,F/2);else if(T==0)O=c.readASCII(i,D,F);else if(T==1)O=c.readUnicode(i,D,F/2);else if(T==3)O=c.readUnicode(i,D,F/2);else{if(w!=1)throw"unknown encoding "+T+", platformID: "+w;O=c.readASCII(i,D,F),console.debug("reading unknown MAC encoding "+T+" as ASCII")}var P="p"+w+","+E.toString(16);d[P]==null&&(d[P]={}),d[P][R!==void 0?R:I]=O,d[P]._lang=E}for(var B in d)if(d[B].postScriptName!=null&&d[B]._lang==1033)return d[B];for(var B in d)if(d[B].postScriptName!=null&&d[B]._lang==0)return d[B];for(var B in d)if(d[B].postScriptName!=null&&d[B]._lang==3084)return d[B];for(var B in d)if(d[B].postScriptName!=null)return d[B];for(var B in d){y=B;break}return console.debug("returning name table with languageID "+d[y]._lang),d[y]},o["OS/2"]={},o["OS/2"].parse=function(i,a,f){var c=o._bin.readUshort(i,a);a+=2;var d={};if(c==0)o["OS/2"].version0(i,a,d);else if(c==1)o["OS/2"].version1(i,a,d);else if(c==2||c==3||c==4)o["OS/2"].version2(i,a,d);else{if(c!=5)throw"unknown OS/2 table version: "+c;o["OS/2"].version5(i,a,d)}return d},o["OS/2"].version0=function(i,a,f){var c=o._bin;return f.xAvgCharWidth=c.readShort(i,a),a+=2,f.usWeightClass=c.readUshort(i,a),a+=2,f.usWidthClass=c.readUshort(i,a),a+=2,f.fsType=c.readUshort(i,a),a+=2,f.ySubscriptXSize=c.readShort(i,a),a+=2,f.ySubscriptYSize=c.readShort(i,a),a+=2,f.ySubscriptXOffset=c.readShort(i,a),a+=2,f.ySubscriptYOffset=c.readShort(i,a),a+=2,f.ySuperscriptXSize=c.readShort(i,a),a+=2,f.ySuperscriptYSize=c.readShort(i,a),a+=2,f.ySuperscriptXOffset=c.readShort(i,a),a+=2,f.ySuperscriptYOffset=c.readShort(i,a),a+=2,f.yStrikeoutSize=c.readShort(i,a),a+=2,f.yStrikeoutPosition=c.readShort(i,a),a+=2,f.sFamilyClass=c.readShort(i,a),a+=2,f.panose=c.readBytes(i,a,10),a+=10,f.ulUnicodeRange1=c.readUint(i,a),a+=4,f.ulUnicodeRange2=c.readUint(i,a),a+=4,f.ulUnicodeRange3=c.readUint(i,a),a+=4,f.ulUnicodeRange4=c.readUint(i,a),a+=4,f.achVendID=[c.readInt8(i,a),c.readInt8(i,a+1),c.readInt8(i,a+2),c.readInt8(i,a+3)],a+=4,f.fsSelection=c.readUshort(i,a),a+=2,f.usFirstCharIndex=c.readUshort(i,a),a+=2,f.usLastCharIndex=c.readUshort(i,a),a+=2,f.sTypoAscender=c.readShort(i,a),a+=2,f.sTypoDescender=c.readShort(i,a),a+=2,f.sTypoLineGap=c.readShort(i,a),a+=2,f.usWinAscent=c.readUshort(i,a),a+=2,f.usWinDescent=c.readUshort(i,a),a+=2},o["OS/2"].version1=function(i,a,f){var c=o._bin;return a=o["OS/2"].version0(i,a,f),f.ulCodePageRange1=c.readUint(i,a),a+=4,f.ulCodePageRange2=c.readUint(i,a),a+=4},o["OS/2"].version2=function(i,a,f){var c=o._bin;return a=o["OS/2"].version1(i,a,f),f.sxHeight=c.readShort(i,a),a+=2,f.sCapHeight=c.readShort(i,a),a+=2,f.usDefault=c.readUshort(i,a),a+=2,f.usBreak=c.readUshort(i,a),a+=2,f.usMaxContext=c.readUshort(i,a),a+=2},o["OS/2"].version5=function(i,a,f){var c=o._bin;return a=o["OS/2"].version2(i,a,f),f.usLowerOpticalPointSize=c.readUshort(i,a),a+=2,f.usUpperOpticalPointSize=c.readUshort(i,a),a+=2},o.post={},o.post.parse=function(i,a,f){var c=o._bin,d={};return d.version=c.readFixed(i,a),a+=4,d.italicAngle=c.readFixed(i,a),a+=4,d.underlinePosition=c.readShort(i,a),a+=2,d.underlineThickness=c.readShort(i,a),a+=2,d},o==null&&(o={}),o.U==null&&(o.U={}),o.U.codeToGlyph=function(i,a){var f=i.cmap,c=-1;if(f.p0e4!=null?c=f.p0e4:f.p3e1!=null?c=f.p3e1:f.p1e0!=null?c=f.p1e0:f.p0e3!=null&&(c=f.p0e3),c==-1)throw"no familiar platform and encoding!";var d=f.tables[c];if(d.format==0)return a>=d.map.length?0:d.map[a];if(d.format==4){for(var x=-1,y=0;y<d.endCount.length;y++)if(a<=d.endCount[y]){x=y;break}return x==-1||d.startCount[x]>a?0:65535&(d.idRangeOffset[x]!=0?d.glyphIdArray[a-d.startCount[x]+(d.idRangeOffset[x]>>1)-(d.idRangeOffset.length-x)]:a+d.idDelta[x])}if(d.format==12){if(a>d.groups[d.groups.length-1][1])return 0;for(y=0;y<d.groups.length;y++){var _=d.groups[y];if(_[0]<=a&&a<=_[1])return _[2]+(a-_[0])}return 0}throw"unknown cmap table format "+d.format},o.U.glyphToPath=function(i,a){var f={cmds:[],crds:[]};if(i.SVG&&i.SVG.entries[a]){var c=i.SVG.entries[a];return c==null?f:(typeof c=="string"&&(c=o.SVG.toPath(c),i.SVG.entries[a]=c),c)}if(i.CFF){var d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:i.CFF.Private?i.CFF.Private.defaultWidthX:0,open:!1},x=i.CFF,y=i.CFF.Private;if(x.ROS){for(var _=0;x.FDSelect[_+2]<=a;)_+=2;y=x.FDArray[x.FDSelect[_+1]].Private}o.U._drawCFF(i.CFF.CharStrings[a],d,x,y,f)}else i.glyf&&o.U._drawGlyf(a,i,f);return f},o.U._drawGlyf=function(i,a,f){var c=a.glyf[i];c==null&&(c=a.glyf[i]=o.glyf._parseGlyf(a,i)),c!=null&&(c.noc>-1?o.U._simpleGlyph(c,f):o.U._compoGlyph(c,a,f))},o.U._simpleGlyph=function(i,a){for(var f=0;f<i.noc;f++){for(var c=f==0?0:i.endPts[f-1]+1,d=i.endPts[f],x=c;x<=d;x++){var y=x==c?d:x-1,_=x==d?c:x+1,S=1&i.flags[x],b=1&i.flags[y],w=1&i.flags[_],T=i.xs[x],E=i.ys[x];if(x==c)if(S){if(!b){o.U.P.moveTo(a,T,E);continue}o.U.P.moveTo(a,i.xs[y],i.ys[y])}else b?o.U.P.moveTo(a,i.xs[y],i.ys[y]):o.U.P.moveTo(a,(i.xs[y]+T)/2,(i.ys[y]+E)/2);S?b&&o.U.P.lineTo(a,T,E):w?o.U.P.qcurveTo(a,T,E,i.xs[_],i.ys[_]):o.U.P.qcurveTo(a,T,E,(T+i.xs[_])/2,(E+i.ys[_])/2)}o.U.P.closePath(a)}},o.U._compoGlyph=function(i,a,f){for(var c=0;c<i.parts.length;c++){var d={cmds:[],crds:[]},x=i.parts[c];o.U._drawGlyf(x.glyphIndex,a,d);for(var y=x.m,_=0;_<d.crds.length;_+=2){var S=d.crds[_],b=d.crds[_+1];f.crds.push(S*y.a+b*y.b+y.tx),f.crds.push(S*y.c+b*y.d+y.ty)}for(_=0;_<d.cmds.length;_++)f.cmds.push(d.cmds[_])}},o.U._getGlyphClass=function(i,a){var f=o._lctf.getInterval(a,i);return f==-1?0:a[f+2]},o.U.getPairAdjustment=function(i,a,f){var c=!1;if(i.GPOS)for(var d=i.GPOS,x=d.lookupList,y=d.featureList,_=[],S=0;S<y.length;S++){var b=y[S];if(b.tag=="kern"){c=!0;for(var w=0;w<b.tab.length;w++)if(!_[b.tab[w]]){_[b.tab[w]]=!0;for(var T=x[b.tab[w]],E=0;E<T.tabs.length;E++)if(T.tabs[E]!=null){var I,F=T.tabs[E];if((!F.coverage||(I=o._lctf.coverageIndex(F.coverage,a))!=-1)&&T.ltype!=1){if(T.ltype==2){var M=null;if(F.fmt==1){var O=F.pairsets[I];for(S=0;S<O.length;S++)O[S].gid2==f&&(M=O[S])}else if(F.fmt==2){var R=o.U._getGlyphClass(a,F.classDef1),D=o.U._getGlyphClass(f,F.classDef2);M=F.matrix[R][D]}if(M){var P=0;return M.val1&&M.val1[2]&&(P+=M.val1[2]),M.val2&&M.val2[0]&&(P+=M.val2[0]),P}}}}}}}if(i.kern&&!c){var B=i.kern.glyph1.indexOf(a);if(B!=-1){var ee=i.kern.rval[B].glyph2.indexOf(f);if(ee!=-1)return i.kern.rval[B].vals[ee]}}return 0},o.U._applySubs=function(i,a,f,c){for(var d=i.length-a-1,x=0;x<f.tabs.length;x++)if(f.tabs[x]!=null){var y,_=f.tabs[x];if(!_.coverage||(y=o._lctf.coverageIndex(_.coverage,i[a]))!=-1){if(f.ltype==1)i[a],_.fmt==1?i[a]=i[a]+_.delta:i[a]=_.newg[y];else if(f.ltype==4)for(var S=_.vals[y],b=0;b<S.length;b++){var w=S[b],T=w.chain.length;if(!(T>d)){for(var E=!0,I=0,F=0;F<T;F++){for(;i[a+I+(1+F)]==-1;)I++;w.chain[F]!=i[a+I+(1+F)]&&(E=!1)}if(E){for(i[a]=w.nglyph,F=0;F<T+I;F++)i[a+F+1]=-1;break}}}else if(f.ltype==5&&_.fmt==2)for(var M=o._lctf.getInterval(_.cDef,i[a]),O=_.cDef[M+2],R=_.scset[O],D=0;D<R.length;D++){var P=R[D],B=P.input;if(!(B.length>d)){for(E=!0,F=0;F<B.length;F++){var ee=o._lctf.getInterval(_.cDef,i[a+1+F]);if(M==-1&&_.cDef[ee+2]!=B[F]){E=!1;break}}if(E){var ne=P.substLookupRecords;for(b=0;b<ne.length;b+=2)ne[b],ne[b+1]}}}else if(f.ltype==6&&_.fmt==3){if(!o.U._glsCovered(i,_.backCvg,a-_.backCvg.length)||!o.U._glsCovered(i,_.inptCvg,a)||!o.U._glsCovered(i,_.ahedCvg,a+_.inptCvg.length))continue;var ce=_.lookupRec;for(D=0;D<ce.length;D+=2){M=ce[D];var A=c[ce[D+1]];o.U._applySubs(i,a+M,A,c)}}}}},o.U._glsCovered=function(i,a,f){for(var c=0;c<a.length;c++)if(o._lctf.coverageIndex(a[c],i[f+c])==-1)return!1;return!0},o.U.glyphsToPath=function(i,a,f){for(var c={cmds:[],crds:[]},d=0,x=0;x<a.length;x++){var y=a[x];if(y!=-1){for(var _=x<a.length-1&&a[x+1]!=-1?a[x+1]:0,S=o.U.glyphToPath(i,y),b=0;b<S.crds.length;b+=2)c.crds.push(S.crds[b]+d),c.crds.push(S.crds[b+1]);for(f&&c.cmds.push(f),b=0;b<S.cmds.length;b++)c.cmds.push(S.cmds[b]);f&&c.cmds.push("X"),d+=i.hmtx.aWidth[y],x<a.length-1&&(d+=o.U.getPairAdjustment(i,y,_))}}return c},o.U.P={},o.U.P.moveTo=function(i,a,f){i.cmds.push("M"),i.crds.push(a,f)},o.U.P.lineTo=function(i,a,f){i.cmds.push("L"),i.crds.push(a,f)},o.U.P.curveTo=function(i,a,f,c,d,x,y){i.cmds.push("C"),i.crds.push(a,f,c,d,x,y)},o.U.P.qcurveTo=function(i,a,f,c,d){i.cmds.push("Q"),i.crds.push(a,f,c,d)},o.U.P.closePath=function(i){i.cmds.push("Z")},o.U._drawCFF=function(i,a,f,c,d){for(var x=a.stack,y=a.nStems,_=a.haveWidth,S=a.width,b=a.open,w=0,T=a.x,E=a.y,I=0,F=0,M=0,O=0,R=0,D=0,P=0,B=0,ee=0,ne=0,ce={val:0,size:0};w<i.length;){o.CFF.getCharString(i,w,ce);var A=ce.val;if(w+=ce.size,A=="o1"||A=="o18")x.length%2!=0&&!_&&(S=x.shift()+c.nominalWidthX),y+=x.length>>1,x.length=0,_=!0;else if(A=="o3"||A=="o23")x.length%2!=0&&!_&&(S=x.shift()+c.nominalWidthX),y+=x.length>>1,x.length=0,_=!0;else if(A=="o4")x.length>1&&!_&&(S=x.shift()+c.nominalWidthX,_=!0),b&&o.U.P.closePath(d),E+=x.pop(),o.U.P.moveTo(d,T,E),b=!0;else if(A=="o5")for(;x.length>0;)T+=x.shift(),E+=x.shift(),o.U.P.lineTo(d,T,E);else if(A=="o6"||A=="o7")for(var Y=x.length,L=A=="o6",J=0;J<Y;J++){var $=x.shift();L?T+=$:E+=$,L=!L,o.U.P.lineTo(d,T,E)}else if(A=="o8"||A=="o24"){Y=x.length;for(var xe=0;xe+6<=Y;)I=T+x.shift(),F=E+x.shift(),M=I+x.shift(),O=F+x.shift(),T=M+x.shift(),E=O+x.shift(),o.U.P.curveTo(d,I,F,M,O,T,E),xe+=6;A=="o24"&&(T+=x.shift(),E+=x.shift(),o.U.P.lineTo(d,T,E))}else{if(A=="o11")break;if(A=="o1234"||A=="o1235"||A=="o1236"||A=="o1237")A=="o1234"&&(F=E,M=(I=T+x.shift())+x.shift(),ne=O=F+x.shift(),D=O,B=E,T=(P=(R=(ee=M+x.shift())+x.shift())+x.shift())+x.shift(),o.U.P.curveTo(d,I,F,M,O,ee,ne),o.U.P.curveTo(d,R,D,P,B,T,E)),A=="o1235"&&(I=T+x.shift(),F=E+x.shift(),M=I+x.shift(),O=F+x.shift(),ee=M+x.shift(),ne=O+x.shift(),R=ee+x.shift(),D=ne+x.shift(),P=R+x.shift(),B=D+x.shift(),T=P+x.shift(),E=B+x.shift(),x.shift(),o.U.P.curveTo(d,I,F,M,O,ee,ne),o.U.P.curveTo(d,R,D,P,B,T,E)),A=="o1236"&&(I=T+x.shift(),F=E+x.shift(),M=I+x.shift(),ne=O=F+x.shift(),D=O,P=(R=(ee=M+x.shift())+x.shift())+x.shift(),B=D+x.shift(),T=P+x.shift(),o.U.P.curveTo(d,I,F,M,O,ee,ne),o.U.P.curveTo(d,R,D,P,B,T,E)),A=="o1237"&&(I=T+x.shift(),F=E+x.shift(),M=I+x.shift(),O=F+x.shift(),ee=M+x.shift(),ne=O+x.shift(),R=ee+x.shift(),D=ne+x.shift(),P=R+x.shift(),B=D+x.shift(),Math.abs(P-T)>Math.abs(B-E)?T=P+x.shift():E=B+x.shift(),o.U.P.curveTo(d,I,F,M,O,ee,ne),o.U.P.curveTo(d,R,D,P,B,T,E));else if(A=="o14"){if(x.length>0&&!_&&(S=x.shift()+f.nominalWidthX,_=!0),x.length==4){var me=x.shift(),j=x.shift(),Q=x.shift(),U=x.shift(),C=o.CFF.glyphBySE(f,Q),N=o.CFF.glyphBySE(f,U);o.U._drawCFF(f.CharStrings[C],a,f,c,d),a.x=me,a.y=j,o.U._drawCFF(f.CharStrings[N],a,f,c,d)}b&&(o.U.P.closePath(d),b=!1)}else if(A=="o19"||A=="o20")x.length%2!=0&&!_&&(S=x.shift()+c.nominalWidthX),y+=x.length>>1,x.length=0,_=!0,w+=y+7>>3;else if(A=="o21")x.length>2&&!_&&(S=x.shift()+c.nominalWidthX,_=!0),E+=x.pop(),T+=x.pop(),b&&o.U.P.closePath(d),o.U.P.moveTo(d,T,E),b=!0;else if(A=="o22")x.length>1&&!_&&(S=x.shift()+c.nominalWidthX,_=!0),T+=x.pop(),b&&o.U.P.closePath(d),o.U.P.moveTo(d,T,E),b=!0;else if(A=="o25"){for(;x.length>6;)T+=x.shift(),E+=x.shift(),o.U.P.lineTo(d,T,E);I=T+x.shift(),F=E+x.shift(),M=I+x.shift(),O=F+x.shift(),T=M+x.shift(),E=O+x.shift(),o.U.P.curveTo(d,I,F,M,O,T,E)}else if(A=="o26")for(x.length%2&&(T+=x.shift());x.length>0;)I=T,F=E+x.shift(),T=M=I+x.shift(),E=(O=F+x.shift())+x.shift(),o.U.P.curveTo(d,I,F,M,O,T,E);else if(A=="o27")for(x.length%2&&(E+=x.shift());x.length>0;)F=E,M=(I=T+x.shift())+x.shift(),O=F+x.shift(),T=M+x.shift(),E=O,o.U.P.curveTo(d,I,F,M,O,T,E);else if(A=="o10"||A=="o29"){var V=A=="o10"?c:f;if(x.length==0)console.debug("error: empty stack");else{var G=x.pop(),Z=V.Subrs[G+V.Bias];a.x=T,a.y=E,a.nStems=y,a.haveWidth=_,a.width=S,a.open=b,o.U._drawCFF(Z,a,f,c,d),T=a.x,E=a.y,y=a.nStems,_=a.haveWidth,S=a.width,b=a.open}}else if(A=="o30"||A=="o31"){var H=x.length,z=(xe=0,A=="o31");for(xe+=H-(Y=-3&H);xe<Y;)z?(F=E,M=(I=T+x.shift())+x.shift(),E=(O=F+x.shift())+x.shift(),Y-xe==5?(T=M+x.shift(),xe++):T=M,z=!1):(I=T,F=E+x.shift(),M=I+x.shift(),O=F+x.shift(),T=M+x.shift(),Y-xe==5?(E=O+x.shift(),xe++):E=O,z=!0),o.U.P.curveTo(d,I,F,M,O,T,E),xe+=4}else{if((A+"").charAt(0)=="o")throw console.debug("Unknown operation: "+A,i),A;x.push(A)}}}a.x=T,a.y=E,a.nStems=y,a.haveWidth=_,a.width=S,a.open=b};var g=o,v={Typr:g};return s.Typr=g,s.default=v,Object.defineProperty(s,"__esModule",{value:!0}),s}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function woff2otfFactory(){return function(s){var o=Uint8Array,g=Uint16Array,v=Uint32Array,i=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(A,Y){for(var L=new g(31),J=0;J<31;++J)L[J]=Y+=1<<A[J-1];var $=new v(L[30]);for(J=1;J<30;++J)for(var xe=L[J];xe<L[J+1];++xe)$[xe]=xe-L[J]<<5|J;return[L,$]},d=c(i,2),x=d[0],y=d[1];x[28]=258,y[258]=28;for(var _=c(a,0)[0],S=new g(32768),b=0;b<32768;++b){var w=(43690&b)>>>1|(21845&b)<<1;w=(61680&(w=(52428&w)>>>2|(13107&w)<<2))>>>4|(3855&w)<<4,S[b]=((65280&w)>>>8|(255&w)<<8)>>>1}var T=function(A,Y,L){for(var J=A.length,$=0,xe=new g(Y);$<J;++$)++xe[A[$]-1];var me,j=new g(Y);for($=0;$<Y;++$)j[$]=j[$-1]+xe[$-1]<<1;if(L){me=new g(1<<Y);var Q=15-Y;for($=0;$<J;++$)if(A[$])for(var U=$<<4|A[$],C=Y-A[$],N=j[A[$]-1]++<<C,V=N|(1<<C)-1;N<=V;++N)me[S[N]>>>Q]=U}else for(me=new g(J),$=0;$<J;++$)A[$]&&(me[$]=S[j[A[$]-1]++]>>>15-A[$]);return me},E=new o(288);for(b=0;b<144;++b)E[b]=8;for(b=144;b<256;++b)E[b]=9;for(b=256;b<280;++b)E[b]=7;for(b=280;b<288;++b)E[b]=8;var I=new o(32);for(b=0;b<32;++b)I[b]=5;var F=T(E,9,1),M=T(I,5,1),O=function(A){for(var Y=A[0],L=1;L<A.length;++L)A[L]>Y&&(Y=A[L]);return Y},R=function(A,Y,L){var J=Y/8|0;return(A[J]|A[J+1]<<8)>>(7&Y)&L},D=function(A,Y){var L=Y/8|0;return(A[L]|A[L+1]<<8|A[L+2]<<16)>>(7&Y)},P=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],B=function(A,Y,L){var J=new Error(Y||P[A]);if(J.code=A,Error.captureStackTrace&&Error.captureStackTrace(J,B),!L)throw J;return J},ee=function(A,Y,L){var J=A.length;if(!J||L&&!L.l&&J<5)return Y||new o(0);var $=!Y||L,xe=!L||L.i;L||(L={}),Y||(Y=new o(3*J));var me,j=function(ge){var Re=Y.length;if(ge>Re){var ke=new o(Math.max(2*Re,ge));ke.set(Y),Y=ke}},Q=L.f||0,U=L.p||0,C=L.b||0,N=L.l,V=L.d,G=L.m,Z=L.n,H=8*J;do{if(!N){L.f=Q=R(A,U,1);var z=R(A,U+1,3);if(U+=3,!z){var te=A[(ie=((me=U)/8|0)+(7&me&&1)+4)-4]|A[ie-3]<<8,le=ie+te;if(le>J){xe&&B(0);break}$&&j(C+te),Y.set(A.subarray(ie,le),C),L.b=C+=te,L.p=U=8*le;continue}if(z==1)N=F,V=M,G=9,Z=5;else if(z==2){var re=R(A,U,31)+257,W=R(A,U+10,15)+4,Fe=re+R(A,U+5,31)+1;U+=14;for(var be=new o(Fe),ae=new o(19),ue=0;ue<W;++ue)ae[f[ue]]=R(A,U+3*ue,7);U+=3*W;var ye=O(ae),K=(1<<ye)-1,de=T(ae,ye,1);for(ue=0;ue<Fe;){var ie,X=de[R(A,U,K)];if(U+=15&X,(ie=X>>>4)<16)be[ue++]=ie;else{var pe=0,se=0;for(ie==16?(se=3+R(A,U,3),U+=2,pe=be[ue-1]):ie==17?(se=3+R(A,U,7),U+=3):ie==18&&(se=11+R(A,U,127),U+=7);se--;)be[ue++]=pe}}var ve=be.subarray(0,re),oe=be.subarray(re);G=O(ve),Z=O(oe),N=T(ve,G,1),V=T(oe,Z,1)}else B(1);if(U>H){xe&&B(0);break}}$&&j(C+131072);for(var Ae=(1<<G)-1,Ee=(1<<Z)-1,he=U;;he=U){var Se=(pe=N[D(A,U)&Ae])>>>4;if((U+=15&pe)>H){xe&&B(0);break}if(pe||B(2),Se<256)Y[C++]=Se;else{if(Se==256){he=U,N=null;break}var we=Se-254;if(Se>264){var Ie=i[ue=Se-257];we=R(A,U,(1<<Ie)-1)+x[ue],U+=Ie}var _e=V[D(A,U)&Ee],Me=_e>>>4;if(_e||B(3),U+=15&_e,oe=_[Me],Me>3&&(Ie=a[Me],oe+=D(A,U)&(1<<Ie)-1,U+=Ie),U>H){xe&&B(0);break}$&&j(C+131072);for(var Te=C+we;C<Te;C+=4)Y[C]=Y[C-oe],Y[C+1]=Y[C+1-oe],Y[C+2]=Y[C+2-oe],Y[C+3]=Y[C+3-oe];C=Te}}L.l=N,L.p=he,L.b=C,N&&(Q=1,L.m=G,L.d=V,L.n=Z)}while(!Q);return C==Y.length?Y:function(ge,Re,ke){(Re==null||Re<0)&&(Re=0),(ke==null||ke>ge.length)&&(ke=ge.length);var Ge=new(ge instanceof g?g:ge instanceof v?v:o)(ke-Re);return Ge.set(ge.subarray(Re,ke)),Ge}(Y,0,C)},ne=new o(0),ce=typeof TextDecoder<"u"&&new TextDecoder;try{ce.decode(ne,{stream:!0})}catch{}return s.convert_streams=function(A){var Y=new DataView(A),L=0;function J(){var re=Y.getUint16(L);return L+=2,re}function $(){var re=Y.getUint32(L);return L+=4,re}function xe(re){te.setUint16(le,re),le+=2}function me(re){te.setUint32(le,re),le+=4}for(var j={signature:$(),flavor:$(),length:$(),numTables:J(),reserved:J(),totalSfntSize:$(),majorVersion:J(),minorVersion:J(),metaOffset:$(),metaLength:$(),metaOrigLength:$(),privOffset:$(),privLength:$()},Q=0;Math.pow(2,Q)<=j.numTables;)Q++;Q--;for(var U=16*Math.pow(2,Q),C=16*j.numTables-U,N=12,V=[],G=0;G<j.numTables;G++)V.push({tag:$(),offset:$(),compLength:$(),origLength:$(),origChecksum:$()}),N+=16;var Z,H=new Uint8Array(12+16*V.length+V.reduce(function(re,W){return re+W.origLength+4},0)),z=H.buffer,te=new DataView(z),le=0;return me(j.flavor),xe(j.numTables),xe(U),xe(Q),xe(C),V.forEach(function(re){me(re.tag),me(re.origChecksum),me(N),me(re.origLength),re.outOffset=N,(N+=re.origLength)%4!=0&&(N+=4-N%4)}),V.forEach(function(re){var W,Fe=A.slice(re.offset,re.offset+re.compLength);if(re.compLength!=re.origLength){var be=new Uint8Array(re.origLength);W=new Uint8Array(Fe,2),ee(W,be)}else be=new Uint8Array(Fe);H.set(be,re.outOffset);var ae=0;(N=re.outOffset+re.origLength)%4!=0&&(ae=4-N%4),H.set(new Uint8Array(ae).buffer,re.outOffset+re.origLength),Z=N+ae}),z.slice(0,Z)},Object.defineProperty(s,"__esModule",{value:!0}),s}({}).convert_streams}function parserFactory(s,o){const g={M:2,L:2,Q:4,C:6,Z:0},v={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=1,a=2,f=4,c=8,d=16,x=32;let y;function _(R){if(!y){const D={R:a,L:i,D:f,C:d,U:x,T:c};y=new Map;for(let P in v){let B=0;v[P].split(",").forEach(ee=>{let[ne,ce]=ee.split("+");ne=parseInt(ne,36),ce=ce?parseInt(ce,36):0,y.set(B+=ne,D[P]);for(let A=ce;A--;)y.set(++B,D[P])})}}return y.get(R)||x}const S=1,b=2,w=3,T=4,E=[null,"isol","init","fina","medi"];function I(R){const D=new Uint8Array(R.length);let P=x,B=S,ee=-1;for(let ne=0;ne<R.length;ne++){const ce=R.codePointAt(ne);let A=_(ce)|0,Y=S;A&c||(P&(i|f|d)?A&(a|f|d)?(Y=w,(B===S||B===w)&&D[ee]++):A&(i|x)&&(B===b||B===T)&&D[ee]--:P&(a|x)&&(B===b||B===T)&&D[ee]--,B=D[ne]=Y,P=A,ee=ne,ce>65535&&ne++)}return D}function F(R,D){const P=[];for(let ee=0;ee<D.length;ee++){const ne=D.codePointAt(ee);ne>65535&&ee++,P.push(s.U.codeToGlyph(R,ne))}const B=R.GSUB;if(B){const{lookupList:ee,featureList:ne}=B;let ce;const A=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,Y=[];ne.forEach(L=>{if(A.test(L.tag))for(let J=0;J<L.tab.length;J++){if(Y[L.tab[J]])continue;Y[L.tab[J]]=!0;const $=ee[L.tab[J]],xe=/^(isol|init|fina|medi)$/.test(L.tag);xe&&!ce&&(ce=I(D));for(let me=0;me<P.length;me++)(!ce||!xe||E[ce[me]]===L.tag)&&s.U._applySubs(P,me,$,ee)}})}return P}function M(...R){for(let D=0;D<R.length;D++)if(typeof R[D]=="number")return R[D]}function O(R){const D=Object.create(null),P=R["OS/2"],B=R.hhea,ee=R.head.unitsPerEm,ne=M(P&&P.sTypoAscender,B&&B.ascender,ee),ce={unitsPerEm:ee,ascender:ne,descender:M(P&&P.sTypoDescender,B&&B.descender,0),capHeight:M(P&&P.sCapHeight,ne),xHeight:M(P&&P.sxHeight,ne),lineGap:M(P&&P.sTypoLineGap,B&&B.lineGap),forEachGlyph(A,Y,L,J){let $=0;const xe=1/ce.unitsPerEm*Y,me=F(R,A);let j=0,Q=-1;return me.forEach((U,C)=>{if(U!==-1){let N=D[U];if(!N){const{cmds:V,crds:G}=s.U.glyphToPath(R,U);let Z="",H=0;for(let W=0,Fe=V.length;W<Fe;W++){const be=g[V[W]];Z+=V[W];for(let ae=1;ae<=be;ae++)Z+=(ae>1?",":"")+G[H++]}let z,te,le,re;if(G.length){z=te=1/0,le=re=-1/0;for(let W=0,Fe=G.length;W<Fe;W+=2){let be=G[W],ae=G[W+1];be<z&&(z=be),ae<te&&(te=ae),be>le&&(le=be),ae>re&&(re=ae)}}else z=le=te=re=0;N=D[U]={index:U,advanceWidth:R.hmtx.aWidth[U],xMin:z,yMin:te,xMax:le,yMax:re,path:Z,pathCommandCount:V.length}}Q!==-1&&($+=s.U.getPairAdjustment(R,Q,U)*xe),J.call(null,N,$,j),N.advanceWidth&&($+=N.advanceWidth*xe),L&&($+=L*Y),Q=U}j+=A.codePointAt(j)>65535?2:1}),$}};return ce}return function(D){const P=new Uint8Array(D,0,4),B=s._bin.readASCII(P,0,4);if(B==="wOFF")D=o(D);else if(B==="wOF2")throw new Error("woff2 fonts not supported");return O(s.parse(D)[0])}}const workerModule=defineWorkerModule({name:"Typr Font Parser",dependencies:[typrFactory,woff2otfFactory,parserFactory],init(s,o,g){const v=s(),i=o();return g(v,i)}}),CONFIG={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},tempColor=new Color;function now$1(){return(self.performance||Date).now()}const atlases=Object.create(null);function getTextRenderInfo(s,o){s=assign({},s);const g=now$1();if(s.font=toAbsoluteURL(s.font||CONFIG.defaultFontURL),s.text=""+s.text,s.sdfGlyphSize=s.sdfGlyphSize||CONFIG.sdfGlyphSize,s.colorRanges!=null){let _={};for(let S in s.colorRanges)if(s.colorRanges.hasOwnProperty(S)){let b=s.colorRanges[S];typeof b!="number"&&(b=tempColor.set(b).getHex()),_[S]=b}s.colorRanges=_}Object.freeze(s);const{textureWidth:v,sdfExponent:i}=CONFIG,{sdfGlyphSize:a}=s,f=v/a*4;let c=atlases[a];if(!c){const _=document.createElement("canvas");_.width=v,_.height=a*256/f,c=atlases[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:_,sdfTexture:new Texture(_,void 0,void 0,void 0,LinearFilter,LinearFilter),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,initContextLossHandling(c)}const{sdfTexture:d,sdfCanvas:x}=c;let y=c.glyphsByFont.get(s.font);y||c.glyphsByFont.set(s.font,y=new Map),typesetInWorker(s).then(_=>{const{glyphIds:S,glyphPositions:b,fontSize:w,unitsPerEm:T,timings:E}=_,I=[],F=new Float32Array(S.length*4),M=w/T;let O=0,R=0;const D=now$1();S.forEach((ce,A)=>{let Y=y.get(ce);if(!Y){const{path:xe,pathBounds:me}=_.glyphData[ce],j=Math.max(me[2]-me[0],me[3]-me[1])/a*(CONFIG.sdfMargin*a+.5),Q=c.glyphCount++,U=[me[0]-j,me[1]-j,me[2]+j,me[3]+j];y.set(ce,Y={path:xe,atlasIndex:Q,sdfViewBox:U}),I.push(Y)}const{sdfViewBox:L}=Y,J=b[R++],$=b[R++];F[O++]=J+L[0]*M,F[O++]=$+L[1]*M,F[O++]=J+L[2]*M,F[O++]=$+L[3]*M,S[A]=Y.atlasIndex}),E.quads=(E.quads||0)+(now$1()-D);const P=now$1();E.sdf={};const B=x.height,ee=Math.ceil(c.glyphCount/f),ne=Math.pow(2,Math.ceil(Math.log2(ee*a)));ne>B&&(console.info(`Increasing SDF texture size ${B}->${ne}`),resizeWebGLCanvasWithoutClearing(x,v,ne),d.dispose()),Promise.all(I.map(ce=>generateGlyphSDF(ce,c,s.gpuAccelerateSDF).then(({timing:A})=>{E.sdf[ce.atlasIndex]=A}))).then(()=>{I.length&&!c.contextLost&&(safariPre15Workaround(c),d.needsUpdate=!0),E.sdfTotal=now$1()-P,E.total=now$1()-g,o(Object.freeze({parameters:s,sdfTexture:d,sdfGlyphSize:a,sdfExponent:i,glyphBounds:F,glyphAtlasIndices:S,glyphColors:_.glyphColors,caretPositions:_.caretPositions,caretHeight:_.caretHeight,chunkedBounds:_.chunkedBounds,ascender:_.ascender,descender:_.descender,lineHeight:_.lineHeight,capHeight:_.capHeight,xHeight:_.xHeight,topBaseline:_.topBaseline,blockBounds:_.blockBounds,visibleBounds:_.visibleBounds,timings:_.timings}))})}),Promise.resolve().then(()=>{c.contextLost||warmUpSDFCanvas(x)})}function generateGlyphSDF({path:s,atlasIndex:o,sdfViewBox:g},{sdfGlyphSize:v,sdfCanvas:i,contextLost:a},f){if(a)return Promise.resolve({timing:-1});const{textureWidth:c,sdfExponent:d}=CONFIG,x=Math.max(g[2]-g[0],g[3]-g[1]),y=Math.floor(o/4),_=y%(c/v)*v,S=Math.floor(y/(c/v))*v,b=o%4;return generateSDF(v,v,s,g,x,d,i,_,S,b,f)}function initContextLossHandling(s){const o=s.sdfCanvas;o.addEventListener("webglcontextlost",g=>{console.log("Context Lost",g),g.preventDefault(),s.contextLost=!0}),o.addEventListener("webglcontextrestored",g=>{console.log("Context Restored",g),s.contextLost=!1;const v=[];s.glyphsByFont.forEach(i=>{i.forEach(a=>{v.push(generateGlyphSDF(a,s,!0))})}),Promise.all(v).then(()=>{safariPre15Workaround(s),s.sdfTexture.needsUpdate=!0})})}function preloadFont({font:s,characters:o,sdfGlyphSize:g},v){let i=Array.isArray(o)?o.join(`
`):""+o;getTextRenderInfo({font:s,sdfGlyphSize:g,text:i},v)}function assign(s,o){for(let g in o)o.hasOwnProperty(g)&&(s[g]=o[g]);return s}let linkEl;function toAbsoluteURL(s){return linkEl||(linkEl=typeof document>"u"?{}:document.createElement("a")),linkEl.href=s,linkEl.href}function safariPre15Workaround(s){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:o,sdfTexture:g}=s,{width:v,height:i}=o,a=s.sdfCanvas.getContext("webgl");let f=g.image.data;(!f||f.length!==v*i*4)&&(f=new Uint8Array(v*i*4),g.image={width:v,height:i,data:f},g.flipY=!1,g.isDataTexture=!0),a.readPixels(0,0,v,i,a.RGBA,a.UNSIGNED_BYTE,f)}}const typesetterWorkerModule=defineWorkerModule({name:"Typesetter",dependencies:[CONFIG,workerModule,createTypesetter,bidiFactory],init(s,o,g,v){const{defaultFontURL:i}=s;return g(o,v(),{defaultFontURL:i})}}),typesetInWorker=defineWorkerModule({name:"Typesetter",dependencies:[typesetterWorkerModule],init(s){return function(o){return new Promise(g=>{s.typeset(o,g)})}},getTransferables(s){const o=[s.glyphPositions.buffer,s.glyphIds.buffer];return s.caretPositions&&o.push(s.caretPositions.buffer),s.glyphColors&&o.push(s.glyphColors.buffer),o}}),templateGeometries={};function getTemplateGeometry(s){let o=templateGeometries[s];if(!o){const g=new PlaneGeometry(1,1,s,s),v=g.clone(),i=g.attributes,a=v.attributes,f=new BufferGeometry,c=i.uv.count;for(let d=0;d<c;d++)a.position.array[d*3]*=-1,a.normal.array[d*3+2]*=-1;["position","normal","uv"].forEach(d=>{f.setAttribute(d,new Float32BufferAttribute([...i[d].array,...a[d].array],i[d].itemSize))}),f.setIndex([...g.index.array,...v.index.array.map(d=>d+c)]),f.translate(.5,.5,0),o=templateGeometries[s]=f}return o}const glyphBoundsAttrName="aTroikaGlyphBounds",glyphIndexAttrName="aTroikaGlyphIndex",glyphColorAttrName="aTroikaGlyphColor";class GlyphsGeometry extends InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Sphere,this.boundingBox=new Box3}computeBoundingSphere(){}computeBoundingBox(){}setSide(o){const g=this.getIndex().count;this.setDrawRange(o===BackSide?g/2:0,o===DoubleSide?g:g/2)}set detail(o){if(o!==this._detail){this._detail=o,(typeof o!="number"||o<1)&&(o=1);let g=getTemplateGeometry(o);["position","normal","uv"].forEach(v=>{this.attributes[v]=g.attributes[v].clone()}),this.setIndex(g.getIndex().clone())}}get detail(){return this._detail}set curveRadius(o){o!==this._curveRadius&&(this._curveRadius=o,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(o,g,v,i,a){updateBufferAttr(this,glyphBoundsAttrName,o,4),updateBufferAttr(this,glyphIndexAttrName,g,1),updateBufferAttr(this,glyphColorAttrName,a,3),this._blockBounds=v,this._chunkedBounds=i,this.instanceCount=g.length,this._updateBounds()}_updateBounds(){const o=this._blockBounds;if(o){const{curveRadius:g,boundingBox:v}=this;if(g){const{PI:i,floor:a,min:f,max:c,sin:d,cos:x}=Math,y=i/2,_=i*2,S=Math.abs(g),b=o[0]/S,w=o[2]/S,T=a((b+y)/_)!==a((w+y)/_)?-S:f(d(b)*S,d(w)*S),E=a((b-y)/_)!==a((w-y)/_)?S:c(d(b)*S,d(w)*S),I=a((b+i)/_)!==a((w+i)/_)?S*2:c(S-x(b)*S,S-x(w)*S);v.min.set(T,o[1],g<0?-I:0),v.max.set(E,o[3],g<0?0:I)}else v.min.set(o[0],o[1],0),v.max.set(o[2],o[3],0);v.getBoundingSphere(this.boundingSphere)}}applyClipRect(o){let g=this.getAttribute(glyphIndexAttrName).count,v=this._chunkedBounds;if(v)for(let i=v.length;i--;){g=v[i].end;let a=v[i].rect;if(a[1]<o.w&&a[3]>o.y&&a[0]<o.z&&a[2]>o.x)break}this.instanceCount=g}}function updateBufferAttr(s,o,g,v){const i=s.getAttribute(o);g?i&&i.array.length===g.length?(i.array.set(g),i.needsUpdate=!0):(s.setAttribute(o,new InstancedBufferAttribute(g,v)),delete s._maxInstanceCount,s.dispose()):i&&s.deleteAttribute(o)}const VERTEX_DEFS=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,VERTEX_TRANSFORM=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,FRAGMENT_DEFS=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,FRAGMENT_TRANSFORM=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function createTextDerivedMaterial(s){const o=createDerivedMaterial(s,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vector4(0,0,0,0)},uTroikaClipRect:{value:new Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:VERTEX_DEFS,vertexTransform:VERTEX_TRANSFORM,fragmentDefs:FRAGMENT_DEFS,fragmentColorTransform:FRAGMENT_TRANSFORM,customRewriter({vertexShader:g,fragmentShader:v}){let i=/\buniform\s+vec3\s+diffuse\b/;return i.test(v)&&(v=v.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(g)||(g=g.replace(voidMainRegExp,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:g,fragmentShader:v}}});return o.transparent=!0,Object.defineProperties(o,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),o}const defaultMaterial=new MeshBasicMaterial({color:16777215,side:DoubleSide,transparent:!0}),defaultStrokeColor=8421504,tempMat4=new Matrix4,tempVec3a=new Vector3,tempVec3b=new Vector3,tempArray=[],origin=new Vector3,defaultOrient="+x+y";function first(s){return Array.isArray(s)?s[0]:s}let getFlatRaycastMesh=()=>{const s=new Mesh(new PlaneGeometry(1,1),defaultMaterial);return getFlatRaycastMesh=()=>s,s},getCurvedRaycastMesh=()=>{const s=new Mesh(new PlaneGeometry(1,1,32,1),defaultMaterial);return getCurvedRaycastMesh=()=>s,s};const syncStartEvent={type:"syncstart"},syncCompleteEvent={type:"synccomplete"},SYNCABLE_PROPS=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],COPYABLE_PROPS=SYNCABLE_PROPS.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let Text$1=class extends Mesh{constructor(){const o=new GlyphsGeometry;super(o,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=defaultStrokeColor,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=defaultOrient,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(o){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(o):(this._isSyncing=!0,this.dispatchEvent(syncStartEvent),getTextRenderInfo({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},g=>{this._isSyncing=!1,this._textRenderInfo=g,this.geometry.updateGlyphs(g.glyphBounds,g.glyphAtlasIndices,g.blockBounds,g.chunkedBounds,g.glyphColors);const v=this._queuedSyncs;v&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{v.forEach(i=>i&&i())})),this.dispatchEvent(syncCompleteEvent),o&&o()})))}onBeforeRender(o,g,v,i,a,f){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a),a._hadOwnSide=a.hasOwnProperty("side"),this.geometry.setSide(a._actualSide=a.side),a.side=FrontSide}onAfterRender(o,g,v,i,a,f){a._hadOwnSide?a.side=a._actualSide:delete a.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let o=this._derivedMaterial;const g=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=defaultMaterial.clone());if((!o||o.baseMaterial!==g)&&(o=this._derivedMaterial=createTextDerivedMaterial(g),g.addEventListener("dispose",function v(){g.removeEventListener("dispose",v),o.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let v=o._outlineMtl;return v||(v=o._outlineMtl=Object.create(o,{id:{value:o.id+.1}}),v.isTextOutlineMaterial=!0,v.depthWrite=!1,v.map=null,o.addEventListener("dispose",function i(){o.removeEventListener("dispose",i),v.dispose()})),[v,o]}else return o}set material(o){o&&o.isTroikaTextMaterial?(this._derivedMaterial=o,this._baseMaterial=o.baseMaterial):this._baseMaterial=o}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(o){this.geometry.detail=o}get curveRadius(){return this.geometry.curveRadius}set curveRadius(o){this.geometry.curveRadius=o}get customDepthMaterial(){return first(this.material).getDepthMaterial()}get customDistanceMaterial(){return first(this.material).getDistanceMaterial()}_prepareForRender(o){const g=o.isTextOutlineMaterial,v=o.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:c,blockBounds:d}=i;v.uTroikaSDFTexture.value=c,v.uTroikaSDFTextureSize.value.set(c.image.width,c.image.height),v.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,v.uTroikaSDFExponent.value=i.sdfExponent,v.uTroikaTotalBounds.value.fromArray(d),v.uTroikaUseGlyphColors.value=!g&&!!i.glyphColors;let x=0,y=0,_=0,S,b,w,T=0,E=0;if(g){let{outlineWidth:F,outlineOffsetX:M,outlineOffsetY:O,outlineBlur:R,outlineOpacity:D}=this;x=this._parsePercent(F)||0,y=Math.max(0,this._parsePercent(R)||0),S=D,T=this._parsePercent(M)||0,E=this._parsePercent(O)||0}else _=Math.max(0,this._parsePercent(this.strokeWidth)||0),_&&(w=this.strokeColor,v.uTroikaStrokeColor.value.set(w??defaultStrokeColor),b=this.strokeOpacity,b==null&&(b=1)),S=this.fillOpacity;v.uTroikaDistanceOffset.value=x,v.uTroikaPositionOffset.value.set(T,E),v.uTroikaBlurRadius.value=y,v.uTroikaStrokeWidth.value=_,v.uTroikaStrokeOpacity.value=b,v.uTroikaFillOpacity.value=S??1,v.uTroikaCurveRadius.value=this.curveRadius||0;let I=this.clipRect;if(I&&Array.isArray(I)&&I.length===4)v.uTroikaClipRect.value.fromArray(I);else{const F=(this.fontSize||.1)*100;v.uTroikaClipRect.value.set(d[0]-F,d[1]-F,d[2]+F,d[3]+F)}this.geometry.applyClipRect(v.uTroikaClipRect.value)}v.uTroikaSDFDebug.value=!!this.debugSDF,o.polygonOffset=!!this.depthOffset,o.polygonOffsetFactor=o.polygonOffsetUnits=this.depthOffset||0;const a=g?this.outlineColor||0:this.color;if(a==null)delete o.color;else{const c=o.hasOwnProperty("color")?o.color:o.color=new Color;(a!==c._input||typeof a=="object")&&c.set(c._input=a)}let f=this.orientation||defaultOrient;if(f!==o._orientation){let c=v.uTroikaOrient.value;f=f.replace(/[^-+xyz]/g,"");let d=f!==defaultOrient&&f.match(/^([-+])([xyz])([-+])([xyz])$/);if(d){let[,x,y,_,S]=d;tempVec3a.set(0,0,0)[y]=x==="-"?1:-1,tempVec3b.set(0,0,0)[S]=_==="-"?-1:1,tempMat4.lookAt(origin,tempVec3a.cross(tempVec3b),tempVec3b),c.setFromMatrix4(tempMat4)}else c.identity();o._orientation=f}}_parsePercent(o){if(typeof o=="string"){let g=o.match(/^(-?[\d.]+)%$/),v=g?parseFloat(g[1]):NaN;o=(isNaN(v)?0:v/100)*this.fontSize}return o}localPositionToTextCoords(o,g=new Vector2){g.copy(o);const v=this.curveRadius;return v&&(g.x=Math.atan2(o.x,Math.abs(v)-Math.abs(o.z))*Math.abs(v)),g}worldPositionToTextCoords(o,g=new Vector2){return tempVec3a.copy(o),this.localPositionToTextCoords(this.worldToLocal(tempVec3a),g)}raycast(o,g){const{textRenderInfo:v,curveRadius:i}=this;if(v){const a=v.blockBounds,f=i?getCurvedRaycastMesh():getFlatRaycastMesh(),c=f.geometry,{position:d,uv:x}=c.attributes;for(let y=0;y<x.count;y++){let _=a[0]+x.getX(y)*(a[2]-a[0]);const S=a[1]+x.getY(y)*(a[3]-a[1]);let b=0;i&&(b=i-Math.cos(_/i)*i,_=Math.sin(_/i)*i),d.setXYZ(y,_,S,b)}c.boundingSphere=this.geometry.boundingSphere,c.boundingBox=this.geometry.boundingBox,f.matrixWorld=this.matrixWorld,f.material.side=this.material.side,tempArray.length=0,f.raycast(o,tempArray);for(let y=0;y<tempArray.length;y++)tempArray[y].object=this,g.push(tempArray[y])}}copy(o){const g=this.geometry;return super.copy(o),this.geometry=g,COPYABLE_PROPS.forEach(v=>{this[v]=o[v]}),this}clone(){return new this.constructor().copy(this)}};SYNCABLE_PROPS.forEach(s=>{const o="_private_"+s;Object.defineProperty(Text$1.prototype,s,{get(){return this[o]},set(g){g!==this[o]&&(this[o]=g,this._needsSync=!0)}})});const Text=reactExports.forwardRef(({sdfGlyphSize:s=64,anchorX:o="center",anchorY:g="middle",font:v,fontSize:i=1,children:a,characters:f,onSync:c,...d},x)=>{const y=useThree(({invalidate:w})=>w),[_]=reactExports.useState(()=>new Text$1),[S,b]=reactExports.useMemo(()=>{const w=[];let T="";return reactExports.Children.forEach(a,E=>{typeof E=="string"||typeof E=="number"?T+=E:w.push(E)}),[w,T]},[a]);return suspend(()=>new Promise(w=>preloadFont({font:v,characters:f},w)),["troika-text",v,f]),reactExports.useLayoutEffect(()=>void _.sync(()=>{y(),c&&c(_)})),reactExports.useEffect(()=>()=>_.dispose(),[_]),reactExports.createElement("primitive",_extends({object:_,ref:x,font:v,text:b,anchorX:o,anchorY:g,fontSize:i,sdfGlyphSize:s},d),S)}),ImageMaterialImpl=shaderMaterial({color:new Color("white"),scale:[1,1],imageBounds:[1,1],map:null,zoom:1,grayscale:0,opacity:1},`
  varying vec2 vUv;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity), grayscale);
    
    #include <tonemapping_fragment>
    #include <${parseInt(REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),ImageBase=reactExports.forwardRef(({children:s,color:o,segments:g=1,scale:v=1,zoom:i=1,grayscale:a=0,opacity:f=1,texture:c,toneMapped:d,transparent:x,...y},_)=>{extend({ImageMaterial:ImageMaterialImpl});const S=Array.isArray(v)?[v[0],v[1]]:[v,v],b=[c.image.width,c.image.height];return reactExports.createElement("mesh",_extends({ref:_,scale:Array.isArray(v)?[...v,1]:v},y),reactExports.createElement("planeGeometry",{args:[1,1,g,g]}),reactExports.createElement("imageMaterial",{color:o,map:c,zoom:i,grayscale:a,opacity:f,scale:S,imageBounds:b,toneMapped:d,transparent:x}),s)}),ImageWithUrl=reactExports.forwardRef(({url:s,...o},g)=>{const v=useTexture(s);return reactExports.createElement(ImageBase,_extends({},o,{texture:v,ref:g}))}),ImageWithTexture=reactExports.forwardRef(({url:s,...o},g)=>reactExports.createElement(ImageBase,_extends({},o,{ref:g}))),Image=reactExports.forwardRef((s,o)=>{if(s.url)return reactExports.createElement(ImageWithUrl,_extends({},s,{ref:o}));if(s.texture)return reactExports.createElement(ImageWithTexture,_extends({},s,{ref:o}));throw new Error("<Image /> requires a url or texture")});class ConvolutionMaterial extends ShaderMaterial{constructor(o=new Vector2){super({uniforms:{inputBuffer:new Uniform(null),depthBuffer:new Uniform(null),resolution:new Uniform(new Vector2),texelSize:new Uniform(new Vector2),halfTexelSize:new Uniform(new Vector2),kernel:new Uniform(0),scale:new Uniform(1),cameraNear:new Uniform(0),cameraFar:new Uniform(1),minDepthThreshold:new Uniform(0),maxDepthThreshold:new Uniform(1),depthScale:new Uniform(0),depthToBlurRatioBias:new Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${parseInt(REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(o.x,o.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(o,g){this.uniforms.texelSize.value.set(o,g),this.uniforms.halfTexelSize.value.set(o,g).multiplyScalar(.5)}setResolution(o){this.uniforms.resolution.value.copy(o)}}class BlurPass{constructor({gl:o,resolution:g,width:v=500,height:i=500,minDepthThreshold:a=0,maxDepthThreshold:f=1,depthScale:c=0,depthToBlurRatioBias:d=.25}){this.renderToScreen=!1,this.renderTargetA=new WebGLRenderTarget(g,g,{minFilter:LinearFilter,magFilter:LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new ConvolutionMaterial,this.convolutionMaterial.setTexelSize(1/v,1/i),this.convolutionMaterial.setResolution(new Vector2(v,i)),this.scene=new Scene,this.camera=new Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=a,this.convolutionMaterial.uniforms.maxDepthThreshold.value=f,this.convolutionMaterial.uniforms.depthScale.value=c,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=d,this.convolutionMaterial.defines.USE_DEPTH=c>0;const x=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),y=new Float32Array([0,0,2,0,0,2]),_=new BufferGeometry;_.setAttribute("position",new BufferAttribute(x,3)),_.setAttribute("uv",new BufferAttribute(y,2)),this.screen=new Mesh(_,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(o,g,v){const i=this.scene,a=this.camera,f=this.renderTargetA,c=this.renderTargetB;let d=this.convolutionMaterial,x=d.uniforms;x.depthBuffer.value=g.depthTexture;const y=d.kernel;let _=g,S,b,w;for(b=0,w=y.length-1;b<w;++b)S=b&1?c:f,x.kernel.value=y[b],x.inputBuffer.value=_.texture,o.setRenderTarget(S),o.render(i,a),_=S;x.kernel.value=y[b],x.inputBuffer.value=_.texture,o.setRenderTarget(this.renderToScreen?null:v),o.render(i,a)}}let MeshReflectorMaterial$1=class extends MeshStandardMaterial{constructor(o={}){super(o),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(o)}onBeforeCompile(o){var g;(g=o.defines)!=null&&g.USE_UV||(o.defines.USE_UV=""),o.uniforms.hasBlur=this._hasBlur,o.uniforms.tDiffuse=this._tDiffuse,o.uniforms.tDepth=this._tDepth,o.uniforms.distortionMap=this._distortionMap,o.uniforms.tDiffuseBlur=this._tDiffuseBlur,o.uniforms.textureMatrix=this._textureMatrix,o.uniforms.mirror=this._mirror,o.uniforms.mixBlur=this._mixBlur,o.uniforms.mixStrength=this._blurStrength,o.uniforms.minDepthThreshold=this._minDepthThreshold,o.uniforms.maxDepthThreshold=this._maxDepthThreshold,o.uniforms.depthScale=this._depthScale,o.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,o.uniforms.distortion=this._distortion,o.uniforms.mixContrast=this._mixContrast,o.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${o.vertexShader}`,o.vertexShader=o.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),o.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${o.fragmentShader}`,o.fragmentShader=o.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(o){this._tDiffuse.value=o}get tDepth(){return this._tDepth.value}set tDepth(o){this._tDepth.value=o}get distortionMap(){return this._distortionMap.value}set distortionMap(o){this._distortionMap.value=o}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(o){this._tDiffuseBlur.value=o}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(o){this._textureMatrix.value=o}get hasBlur(){return this._hasBlur.value}set hasBlur(o){this._hasBlur.value=o}get mirror(){return this._mirror.value}set mirror(o){this._mirror.value=o}get mixBlur(){return this._mixBlur.value}set mixBlur(o){this._mixBlur.value=o}get mixStrength(){return this._blurStrength.value}set mixStrength(o){this._blurStrength.value=o}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(o){this._minDepthThreshold.value=o}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(o){this._maxDepthThreshold.value=o}get depthScale(){return this._depthScale.value}set depthScale(o){this._depthScale.value=o}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(o){this._depthToBlurRatioBias.value=o}get distortion(){return this._distortion.value}set distortion(o){this._distortion.value=o}get mixContrast(){return this._mixContrast.value}set mixContrast(o){this._mixContrast.value=o}};extend({MeshReflectorMaterialImpl:MeshReflectorMaterial$1});const MeshReflectorMaterial=reactExports.forwardRef(({mixBlur:s=0,mixStrength:o=1,resolution:g=256,blur:v=[0,0],minDepthThreshold:i=.9,maxDepthThreshold:a=1,depthScale:f=0,depthToBlurRatioBias:c=.25,mirror:d=0,distortion:x=1,mixContrast:y=1,distortionMap:_,reflectorOffset:S=0,...b},w)=>{const T=useThree(({gl:U})=>U),E=useThree(({camera:U})=>U),I=useThree(({scene:U})=>U);v=Array.isArray(v)?v:[v,v];const F=v[0]+v[1]>0,M=reactExports.useRef(null),[O]=reactExports.useState(()=>new Plane),[R]=reactExports.useState(()=>new Vector3),[D]=reactExports.useState(()=>new Vector3),[P]=reactExports.useState(()=>new Vector3),[B]=reactExports.useState(()=>new Matrix4),[ee]=reactExports.useState(()=>new Vector3(0,0,-1)),[ne]=reactExports.useState(()=>new Vector4),[ce]=reactExports.useState(()=>new Vector3),[A]=reactExports.useState(()=>new Vector3),[Y]=reactExports.useState(()=>new Vector4),[L]=reactExports.useState(()=>new Matrix4),[J]=reactExports.useState(()=>new PerspectiveCamera),$=reactExports.useCallback(()=>{var U;const C=M.current.parent||((U=M.current)==null?void 0:U.__r3f.parent);if(!C||(D.setFromMatrixPosition(C.matrixWorld),P.setFromMatrixPosition(E.matrixWorld),B.extractRotation(C.matrixWorld),R.set(0,0,1),R.applyMatrix4(B),D.addScaledVector(R,S),ce.subVectors(D,P),ce.dot(R)>0))return;ce.reflect(R).negate(),ce.add(D),B.extractRotation(E.matrixWorld),ee.set(0,0,-1),ee.applyMatrix4(B),ee.add(P),A.subVectors(D,ee),A.reflect(R).negate(),A.add(D),J.position.copy(ce),J.up.set(0,1,0),J.up.applyMatrix4(B),J.up.reflect(R),J.lookAt(A),J.far=E.far,J.updateMatrixWorld(),J.projectionMatrix.copy(E.projectionMatrix),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(J.projectionMatrix),L.multiply(J.matrixWorldInverse),L.multiply(C.matrixWorld),O.setFromNormalAndCoplanarPoint(R,D),O.applyMatrix4(J.matrixWorldInverse),ne.set(O.normal.x,O.normal.y,O.normal.z,O.constant);const N=J.projectionMatrix;Y.x=(Math.sign(ne.x)+N.elements[8])/N.elements[0],Y.y=(Math.sign(ne.y)+N.elements[9])/N.elements[5],Y.z=-1,Y.w=(1+N.elements[10])/N.elements[14],ne.multiplyScalar(2/ne.dot(Y)),N.elements[2]=ne.x,N.elements[6]=ne.y,N.elements[10]=ne.z+1,N.elements[14]=ne.w},[E,S]),[xe,me,j,Q]=reactExports.useMemo(()=>{const U={minFilter:LinearFilter,magFilter:LinearFilter,type:HalfFloatType},C=new WebGLRenderTarget(g,g,U);C.depthBuffer=!0,C.depthTexture=new DepthTexture(g,g),C.depthTexture.format=DepthFormat,C.depthTexture.type=UnsignedShortType;const N=new WebGLRenderTarget(g,g,U),V=new BlurPass({gl:T,resolution:g,width:v[0],height:v[1],minDepthThreshold:i,maxDepthThreshold:a,depthScale:f,depthToBlurRatioBias:c}),G={mirror:d,textureMatrix:L,mixBlur:s,tDiffuse:C.texture,tDepth:C.depthTexture,tDiffuseBlur:N.texture,hasBlur:F,mixStrength:o,minDepthThreshold:i,maxDepthThreshold:a,depthScale:f,depthToBlurRatioBias:c,distortion:x,distortionMap:_,mixContrast:y,"defines-USE_BLUR":F?"":void 0,"defines-USE_DEPTH":f>0?"":void 0,"defines-USE_DISTORTION":_?"":void 0};return[C,N,V,G]},[T,v,L,g,d,F,s,o,i,a,f,c,x,_,y]);return useFrame(()=>{var U;const C=M.current.parent||((U=M.current)==null?void 0:U.__r3f.parent);if(!C)return;C.visible=!1;const N=T.xr.enabled,V=T.shadowMap.autoUpdate;$(),T.xr.enabled=!1,T.shadowMap.autoUpdate=!1,T.setRenderTarget(xe),T.state.buffers.depth.setMask(!0),T.autoClear||T.clear(),T.render(I,J),F&&j.render(T,xe,me),T.xr.enabled=N,T.shadowMap.autoUpdate=V,C.visible=!0,T.setRenderTarget(null)}),reactExports.createElement("meshReflectorMaterialImpl",_extends({attach:"material",key:"key"+Q["defines-USE_BLUR"]+Q["defines-USE_DEPTH"]+Q["defines-USE_DISTORTION"],ref:mergeRefs([M,w])},Q,b))});var shim={exports:{}},useSyncExternalStoreShim_production_min={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e=reactExports;function h(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var k=typeof Object.is=="function"?Object.is:h,l=e.useState,m=e.useEffect,n=e.useLayoutEffect,p=e.useDebugValue;function q(s,o){var g=o(),v=l({inst:{value:g,getSnapshot:o}}),i=v[0].inst,a=v[1];return n(function(){i.value=g,i.getSnapshot=o,r(i)&&a({inst:i})},[s,g,o]),m(function(){return r(i)&&a({inst:i}),s(function(){r(i)&&a({inst:i})})},[s]),p(g),g}function r(s){var o=s.getSnapshot;s=s.value;try{var g=o();return!k(s,g)}catch{return!0}}function t(s,o){return o()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?t:q;useSyncExternalStoreShim_production_min.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u;shim.exports=useSyncExternalStoreShim_production_min;var shimExports=shim.exports;const{useEffect,useLayoutEffect,useRef,useInsertionEffect:useBuiltinInsertionEffect}=React,canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",useIsomorphicLayoutEffect=canUseDOM?useLayoutEffect:useEffect,useInsertionEffect=useBuiltinInsertionEffect||useIsomorphicLayoutEffect,useEvent=s=>{const o=useRef([s,(...g)=>o[0](...g)]).current;return useInsertionEffect(()=>{o[0]=s}),o[1]},relativePath=(s="",o=location.pathname)=>o.toLowerCase().indexOf(s.toLowerCase())?"~"+o:o.slice(s.length)||"/",absolutePath=(s,o="")=>s[0]==="~"?s.slice(1):o+s,eventPopstate="popstate",eventPushState="pushState",eventReplaceState="replaceState",eventHashchange="hashchange",events=[eventPopstate,eventPushState,eventReplaceState,eventHashchange],subscribeToLocationUpdates=s=>{for(const o of events)addEventListener(o,s);return()=>{for(const o of events)removeEventListener(o,s)}},useLocationProperty=(s,o)=>shimExports.useSyncExternalStore(subscribeToLocationUpdates,s,o),currentPathname=()=>location.pathname,usePathname=({ssrPath:s}={})=>useLocationProperty(currentPathname,s?()=>s:currentPathname),navigate=(s,{replace:o=!1}={})=>history[o?eventReplaceState:eventPushState](null,"",s),useLocation$1=(s={})=>[relativePath(s.base,usePathname(s)),useEvent((o,g)=>navigate(absolutePath(o,s.base),g))];if(typeof history<"u")for(const s of[eventPushState,eventReplaceState]){const o=history[s];history[s]=function(){const g=o.apply(this,arguments),v=new Event(s);return v.arguments=arguments,dispatchEvent(v),g}}function makeMatcher(s=pathToRegexp){let o={};const g=v=>o[v]||(o[v]=s(v));return(v,i)=>{const{regexp:a,keys:f}=g(v||""),c=a.exec(i);return c?[!0,f.reduce((x,y,_)=>(x[y.name]=c[_+1],x),{})]:[!1,null]}}const escapeRx=s=>s.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),rxForSegment=(s,o,g)=>{let v=s?"((?:[^\\/]+?)(?:\\/(?:[^\\/]+?))*)":"([^\\/]+?)";return o&&g&&(v="(?:\\/"+v+")"),v+(o?"?":"")},pathToRegexp=s=>{const o=/:([A-Za-z0-9_]+)([?+*]?)/g;let g=null,v=0,i=[],a="";for(;(g=o.exec(s))!==null;){const[f,c,d]=g,x=d==="+"||d==="*",y=d==="?"||d==="*",_=y&&s[g.index-1]==="/"?1:0,S=s.substring(v,g.index-_);i.push({name:c}),v=o.lastIndex,a+=escapeRx(S)+rxForSegment(x,y,_)}return a+=escapeRx(s.substring(v)),{keys:i,regexp:new RegExp("^"+a+"(?:\\/)?$","i")}},defaultRouter={hook:useLocation$1,matcher:makeMatcher(),base:""},RouterCtx=reactExports.createContext(defaultRouter),useRouter=()=>reactExports.useContext(RouterCtx),useLocationFromRouter=s=>s.hook(s),useLocation=()=>useLocationFromRouter(useRouter()),useRoute=s=>{const o=useRouter(),[g]=useLocationFromRouter(o);return o.matcher(s,g)};reactExports.createContext({params:{}});reactExports.forwardRef((s,o)=>{const g=useRouter(),[,v]=useLocationFromRouter(g),{to:i,href:a=i,children:f,onClick:c}=s,d=useEvent(_=>{_.ctrlKey||_.metaKey||_.altKey||_.shiftKey||_.button!==0||(c&&c(_),_.defaultPrevented||(_.preventDefault(),v(i||a,s)))}),x={href:a[0]==="~"?a.slice(1):g.base+a,onClick:d,to:null,ref:o},y=reactExports.isValidElement(f)?f:reactExports.createElement("a",s);return reactExports.cloneElement(y,x)});var md5$1={exports:{}};/**
 * [js-md5]{@link https://github.com/emn178/js-md5}
 *
 * @namespace md5
 * @version 0.7.3
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(function(module){(function(){var ERROR="input is invalid type",WINDOW=typeof window=="object",root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&typeof self=="object",NODE_JS=!root.JS_MD5_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&!0&&module.exports,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}(root.JS_MD5_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(s){return Object.prototype.toString.call(s)==="[object Array]"}),ARRAY_BUFFER&&(root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(s){return typeof s=="object"&&s.buffer&&s.buffer.constructor===ArrayBuffer});var createOutputMethod=function(s){return function(o){return new Md5(!0).update(o)[s]()}},createMethod=function(){var s=createOutputMethod("hex");NODE_JS&&(s=nodeWrap(s)),s.create=function(){return new Md5},s.update=function(v){return s.create().update(v)};for(var o=0;o<OUTPUT_TYPES.length;++o){var g=OUTPUT_TYPES[o];s[g]=createOutputMethod(g)}return s},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(s){if(typeof s=="string")return crypto.createHash("md5").update(s,"utf8").digest("hex");if(s==null)throw ERROR;return s.constructor===ArrayBuffer&&(s=new Uint8Array(s)),Array.isArray(s)||ArrayBuffer.isView(s)||s.constructor===Buffer?crypto.createHash("md5").update(new Buffer(s)).digest("hex"):method(s)};return nodeMethod};function Md5(s){if(s)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var o=new ArrayBuffer(68);this.buffer8=new Uint8Array(o),this.blocks=new Uint32Array(o)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(s){if(!this.finalized){var o,g=typeof s;if(g!=="string"){if(g==="object"){if(s===null)throw ERROR;if(ARRAY_BUFFER&&s.constructor===ArrayBuffer)s=new Uint8Array(s);else if(!Array.isArray(s)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(s)))throw ERROR}else throw ERROR;o=!0}for(var v,i=0,a,f=s.length,c=this.blocks,d=this.buffer8;i<f;){if(this.hashed&&(this.hashed=!1,c[0]=c[16],c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0),o)if(ARRAY_BUFFER)for(a=this.start;i<f&&a<64;++i)d[a++]=s[i];else for(a=this.start;i<f&&a<64;++i)c[a>>2]|=s[i]<<SHIFT[a++&3];else if(ARRAY_BUFFER)for(a=this.start;i<f&&a<64;++i)v=s.charCodeAt(i),v<128?d[a++]=v:v<2048?(d[a++]=192|v>>6,d[a++]=128|v&63):v<55296||v>=57344?(d[a++]=224|v>>12,d[a++]=128|v>>6&63,d[a++]=128|v&63):(v=65536+((v&1023)<<10|s.charCodeAt(++i)&1023),d[a++]=240|v>>18,d[a++]=128|v>>12&63,d[a++]=128|v>>6&63,d[a++]=128|v&63);else for(a=this.start;i<f&&a<64;++i)v=s.charCodeAt(i),v<128?c[a>>2]|=v<<SHIFT[a++&3]:v<2048?(c[a>>2]|=(192|v>>6)<<SHIFT[a++&3],c[a>>2]|=(128|v&63)<<SHIFT[a++&3]):v<55296||v>=57344?(c[a>>2]|=(224|v>>12)<<SHIFT[a++&3],c[a>>2]|=(128|v>>6&63)<<SHIFT[a++&3],c[a>>2]|=(128|v&63)<<SHIFT[a++&3]):(v=65536+((v&1023)<<10|s.charCodeAt(++i)&1023),c[a>>2]|=(240|v>>18)<<SHIFT[a++&3],c[a>>2]|=(128|v>>12&63)<<SHIFT[a++&3],c[a>>2]|=(128|v>>6&63)<<SHIFT[a++&3],c[a>>2]|=(128|v&63)<<SHIFT[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var s=this.blocks,o=this.lastByteIndex;s[o>>2]|=EXTRA[o&3],o>=56&&(this.hashed||this.hash(),s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),s[14]=this.bytes<<3,s[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var s,o,g,v,i,a,f=this.blocks;this.first?(s=f[0]-680876937,s=(s<<7|s>>>25)-271733879<<0,v=(-1732584194^s&2004318071)+f[1]-117830708,v=(v<<12|v>>>20)+s<<0,g=(-271733879^v&(s^-271733879))+f[2]-1126478375,g=(g<<17|g>>>15)+v<<0,o=(s^g&(v^s))+f[3]-1316259209,o=(o<<22|o>>>10)+g<<0):(s=this.h0,o=this.h1,g=this.h2,v=this.h3,s+=(v^o&(g^v))+f[0]-680876936,s=(s<<7|s>>>25)+o<<0,v+=(g^s&(o^g))+f[1]-389564586,v=(v<<12|v>>>20)+s<<0,g+=(o^v&(s^o))+f[2]+606105819,g=(g<<17|g>>>15)+v<<0,o+=(s^g&(v^s))+f[3]-1044525330,o=(o<<22|o>>>10)+g<<0),s+=(v^o&(g^v))+f[4]-176418897,s=(s<<7|s>>>25)+o<<0,v+=(g^s&(o^g))+f[5]+1200080426,v=(v<<12|v>>>20)+s<<0,g+=(o^v&(s^o))+f[6]-1473231341,g=(g<<17|g>>>15)+v<<0,o+=(s^g&(v^s))+f[7]-45705983,o=(o<<22|o>>>10)+g<<0,s+=(v^o&(g^v))+f[8]+1770035416,s=(s<<7|s>>>25)+o<<0,v+=(g^s&(o^g))+f[9]-1958414417,v=(v<<12|v>>>20)+s<<0,g+=(o^v&(s^o))+f[10]-42063,g=(g<<17|g>>>15)+v<<0,o+=(s^g&(v^s))+f[11]-1990404162,o=(o<<22|o>>>10)+g<<0,s+=(v^o&(g^v))+f[12]+1804603682,s=(s<<7|s>>>25)+o<<0,v+=(g^s&(o^g))+f[13]-40341101,v=(v<<12|v>>>20)+s<<0,g+=(o^v&(s^o))+f[14]-1502002290,g=(g<<17|g>>>15)+v<<0,o+=(s^g&(v^s))+f[15]+1236535329,o=(o<<22|o>>>10)+g<<0,s+=(g^v&(o^g))+f[1]-165796510,s=(s<<5|s>>>27)+o<<0,v+=(o^g&(s^o))+f[6]-1069501632,v=(v<<9|v>>>23)+s<<0,g+=(s^o&(v^s))+f[11]+643717713,g=(g<<14|g>>>18)+v<<0,o+=(v^s&(g^v))+f[0]-373897302,o=(o<<20|o>>>12)+g<<0,s+=(g^v&(o^g))+f[5]-701558691,s=(s<<5|s>>>27)+o<<0,v+=(o^g&(s^o))+f[10]+38016083,v=(v<<9|v>>>23)+s<<0,g+=(s^o&(v^s))+f[15]-660478335,g=(g<<14|g>>>18)+v<<0,o+=(v^s&(g^v))+f[4]-405537848,o=(o<<20|o>>>12)+g<<0,s+=(g^v&(o^g))+f[9]+568446438,s=(s<<5|s>>>27)+o<<0,v+=(o^g&(s^o))+f[14]-1019803690,v=(v<<9|v>>>23)+s<<0,g+=(s^o&(v^s))+f[3]-187363961,g=(g<<14|g>>>18)+v<<0,o+=(v^s&(g^v))+f[8]+1163531501,o=(o<<20|o>>>12)+g<<0,s+=(g^v&(o^g))+f[13]-1444681467,s=(s<<5|s>>>27)+o<<0,v+=(o^g&(s^o))+f[2]-51403784,v=(v<<9|v>>>23)+s<<0,g+=(s^o&(v^s))+f[7]+1735328473,g=(g<<14|g>>>18)+v<<0,o+=(v^s&(g^v))+f[12]-1926607734,o=(o<<20|o>>>12)+g<<0,i=o^g,s+=(i^v)+f[5]-378558,s=(s<<4|s>>>28)+o<<0,v+=(i^s)+f[8]-2022574463,v=(v<<11|v>>>21)+s<<0,a=v^s,g+=(a^o)+f[11]+1839030562,g=(g<<16|g>>>16)+v<<0,o+=(a^g)+f[14]-35309556,o=(o<<23|o>>>9)+g<<0,i=o^g,s+=(i^v)+f[1]-1530992060,s=(s<<4|s>>>28)+o<<0,v+=(i^s)+f[4]+1272893353,v=(v<<11|v>>>21)+s<<0,a=v^s,g+=(a^o)+f[7]-155497632,g=(g<<16|g>>>16)+v<<0,o+=(a^g)+f[10]-1094730640,o=(o<<23|o>>>9)+g<<0,i=o^g,s+=(i^v)+f[13]+681279174,s=(s<<4|s>>>28)+o<<0,v+=(i^s)+f[0]-358537222,v=(v<<11|v>>>21)+s<<0,a=v^s,g+=(a^o)+f[3]-722521979,g=(g<<16|g>>>16)+v<<0,o+=(a^g)+f[6]+76029189,o=(o<<23|o>>>9)+g<<0,i=o^g,s+=(i^v)+f[9]-640364487,s=(s<<4|s>>>28)+o<<0,v+=(i^s)+f[12]-421815835,v=(v<<11|v>>>21)+s<<0,a=v^s,g+=(a^o)+f[15]+530742520,g=(g<<16|g>>>16)+v<<0,o+=(a^g)+f[2]-995338651,o=(o<<23|o>>>9)+g<<0,s+=(g^(o|~v))+f[0]-198630844,s=(s<<6|s>>>26)+o<<0,v+=(o^(s|~g))+f[7]+1126891415,v=(v<<10|v>>>22)+s<<0,g+=(s^(v|~o))+f[14]-1416354905,g=(g<<15|g>>>17)+v<<0,o+=(v^(g|~s))+f[5]-57434055,o=(o<<21|o>>>11)+g<<0,s+=(g^(o|~v))+f[12]+1700485571,s=(s<<6|s>>>26)+o<<0,v+=(o^(s|~g))+f[3]-1894986606,v=(v<<10|v>>>22)+s<<0,g+=(s^(v|~o))+f[10]-1051523,g=(g<<15|g>>>17)+v<<0,o+=(v^(g|~s))+f[1]-2054922799,o=(o<<21|o>>>11)+g<<0,s+=(g^(o|~v))+f[8]+1873313359,s=(s<<6|s>>>26)+o<<0,v+=(o^(s|~g))+f[15]-30611744,v=(v<<10|v>>>22)+s<<0,g+=(s^(v|~o))+f[6]-1560198380,g=(g<<15|g>>>17)+v<<0,o+=(v^(g|~s))+f[13]+1309151649,o=(o<<21|o>>>11)+g<<0,s+=(g^(o|~v))+f[4]-145523070,s=(s<<6|s>>>26)+o<<0,v+=(o^(s|~g))+f[11]-1120210379,v=(v<<10|v>>>22)+s<<0,g+=(s^(v|~o))+f[2]+718787259,g=(g<<15|g>>>17)+v<<0,o+=(v^(g|~s))+f[9]-343485551,o=(o<<21|o>>>11)+g<<0,this.first?(this.h0=s+1732584193<<0,this.h1=o-271733879<<0,this.h2=g-1732584194<<0,this.h3=v+271733878<<0,this.first=!1):(this.h0=this.h0+s<<0,this.h1=this.h1+o<<0,this.h2=this.h2+g<<0,this.h3=this.h3+v<<0)},Md5.prototype.hex=function(){this.finalize();var s=this.h0,o=this.h1,g=this.h2,v=this.h3;return HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[o&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[g>>4&15]+HEX_CHARS[g&15]+HEX_CHARS[g>>12&15]+HEX_CHARS[g>>8&15]+HEX_CHARS[g>>20&15]+HEX_CHARS[g>>16&15]+HEX_CHARS[g>>28&15]+HEX_CHARS[g>>24&15]+HEX_CHARS[v>>4&15]+HEX_CHARS[v&15]+HEX_CHARS[v>>12&15]+HEX_CHARS[v>>8&15]+HEX_CHARS[v>>20&15]+HEX_CHARS[v>>16&15]+HEX_CHARS[v>>28&15]+HEX_CHARS[v>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var s=this.h0,o=this.h1,g=this.h2,v=this.h3;return[s&255,s>>8&255,s>>16&255,s>>24&255,o&255,o>>8&255,o>>16&255,o>>24&255,g&255,g>>8&255,g>>16&255,g>>24&255,v&255,v>>8&255,v>>16&255,v>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var s=new ArrayBuffer(16),o=new Uint32Array(s);return o[0]=this.h0,o[1]=this.h1,o[2]=this.h2,o[3]=this.h3,s},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var s,o,g,v="",i=this.array(),a=0;a<15;)s=i[a++],o=i[a++],g=i[a++],v+=BASE64_ENCODE_CHAR[s>>>2]+BASE64_ENCODE_CHAR[(s<<4|o>>>4)&63]+BASE64_ENCODE_CHAR[(o<<2|g>>>6)&63]+BASE64_ENCODE_CHAR[g&63];return s=i[a],v+=BASE64_ENCODE_CHAR[s>>>2]+BASE64_ENCODE_CHAR[s<<4&63]+"==",v};var exports=createMethod();COMMON_JS?module.exports=exports:root.md5=exports})()})(md5$1);var md5Exports=md5$1.exports,sha1$1={exports:{}};/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(function(module){(function(){var root=typeof window=="object"?window:{},NODE_JS=!root.JS_SHA1_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;NODE_JS&&(root=commonjsGlobal);var COMMON_JS=!root.JS_SHA1_NO_COMMON_JS&&!0&&module.exports,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[],createOutputMethod=function(s){return function(o){return new Sha1(!0).update(o)[s]()}},createMethod=function(){var s=createOutputMethod("hex");NODE_JS&&(s=nodeWrap(s)),s.create=function(){return new Sha1},s.update=function(v){return s.create().update(v)};for(var o=0;o<OUTPUT_TYPES.length;++o){var g=OUTPUT_TYPES[o];s[g]=createOutputMethod(g)}return s},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(s){if(typeof s=="string")return crypto.createHash("sha1").update(s,"utf8").digest("hex");if(s.constructor===ArrayBuffer)s=new Uint8Array(s);else if(s.length===void 0)return method(s);return crypto.createHash("sha1").update(new Buffer(s)).digest("hex")};return nodeMethod};function Sha1(s){s?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(s){if(!this.finalized){var o=typeof s!="string";o&&s.constructor===root.ArrayBuffer&&(s=new Uint8Array(s));for(var g,v=0,i,a=s.length||0,f=this.blocks;v<a;){if(this.hashed&&(this.hashed=!1,f[0]=this.block,f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0),o)for(i=this.start;v<a&&i<64;++v)f[i>>2]|=s[v]<<SHIFT[i++&3];else for(i=this.start;v<a&&i<64;++v)g=s.charCodeAt(v),g<128?f[i>>2]|=g<<SHIFT[i++&3]:g<2048?(f[i>>2]|=(192|g>>6)<<SHIFT[i++&3],f[i>>2]|=(128|g&63)<<SHIFT[i++&3]):g<55296||g>=57344?(f[i>>2]|=(224|g>>12)<<SHIFT[i++&3],f[i>>2]|=(128|g>>6&63)<<SHIFT[i++&3],f[i>>2]|=(128|g&63)<<SHIFT[i++&3]):(g=65536+((g&1023)<<10|s.charCodeAt(++v)&1023),f[i>>2]|=(240|g>>18)<<SHIFT[i++&3],f[i>>2]|=(128|g>>12&63)<<SHIFT[i++&3],f[i>>2]|=(128|g>>6&63)<<SHIFT[i++&3],f[i>>2]|=(128|g&63)<<SHIFT[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=f[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var s=this.blocks,o=this.lastByteIndex;s[16]=this.block,s[o>>2]|=EXTRA[o&3],this.block=s[16],o>=56&&(this.hashed||this.hash(),s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),s[14]=this.hBytes<<3|this.bytes>>>29,s[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var s=this.h0,o=this.h1,g=this.h2,v=this.h3,i=this.h4,a,f,c,d=this.blocks;for(f=16;f<80;++f)c=d[f-3]^d[f-8]^d[f-14]^d[f-16],d[f]=c<<1|c>>>31;for(f=0;f<20;f+=5)a=o&g|~o&v,c=s<<5|s>>>27,i=c+a+i+1518500249+d[f]<<0,o=o<<30|o>>>2,a=s&o|~s&g,c=i<<5|i>>>27,v=c+a+v+1518500249+d[f+1]<<0,s=s<<30|s>>>2,a=i&s|~i&o,c=v<<5|v>>>27,g=c+a+g+1518500249+d[f+2]<<0,i=i<<30|i>>>2,a=v&i|~v&s,c=g<<5|g>>>27,o=c+a+o+1518500249+d[f+3]<<0,v=v<<30|v>>>2,a=g&v|~g&i,c=o<<5|o>>>27,s=c+a+s+1518500249+d[f+4]<<0,g=g<<30|g>>>2;for(;f<40;f+=5)a=o^g^v,c=s<<5|s>>>27,i=c+a+i+1859775393+d[f]<<0,o=o<<30|o>>>2,a=s^o^g,c=i<<5|i>>>27,v=c+a+v+1859775393+d[f+1]<<0,s=s<<30|s>>>2,a=i^s^o,c=v<<5|v>>>27,g=c+a+g+1859775393+d[f+2]<<0,i=i<<30|i>>>2,a=v^i^s,c=g<<5|g>>>27,o=c+a+o+1859775393+d[f+3]<<0,v=v<<30|v>>>2,a=g^v^i,c=o<<5|o>>>27,s=c+a+s+1859775393+d[f+4]<<0,g=g<<30|g>>>2;for(;f<60;f+=5)a=o&g|o&v|g&v,c=s<<5|s>>>27,i=c+a+i-1894007588+d[f]<<0,o=o<<30|o>>>2,a=s&o|s&g|o&g,c=i<<5|i>>>27,v=c+a+v-1894007588+d[f+1]<<0,s=s<<30|s>>>2,a=i&s|i&o|s&o,c=v<<5|v>>>27,g=c+a+g-1894007588+d[f+2]<<0,i=i<<30|i>>>2,a=v&i|v&s|i&s,c=g<<5|g>>>27,o=c+a+o-1894007588+d[f+3]<<0,v=v<<30|v>>>2,a=g&v|g&i|v&i,c=o<<5|o>>>27,s=c+a+s-1894007588+d[f+4]<<0,g=g<<30|g>>>2;for(;f<80;f+=5)a=o^g^v,c=s<<5|s>>>27,i=c+a+i-899497514+d[f]<<0,o=o<<30|o>>>2,a=s^o^g,c=i<<5|i>>>27,v=c+a+v-899497514+d[f+1]<<0,s=s<<30|s>>>2,a=i^s^o,c=v<<5|v>>>27,g=c+a+g-899497514+d[f+2]<<0,i=i<<30|i>>>2,a=v^i^s,c=g<<5|g>>>27,o=c+a+o-899497514+d[f+3]<<0,v=v<<30|v>>>2,a=g^v^i,c=o<<5|o>>>27,s=c+a+s-899497514+d[f+4]<<0,g=g<<30|g>>>2;this.h0=this.h0+s<<0,this.h1=this.h1+o<<0,this.h2=this.h2+g<<0,this.h3=this.h3+v<<0,this.h4=this.h4+i<<0},Sha1.prototype.hex=function(){this.finalize();var s=this.h0,o=this.h1,g=this.h2,v=this.h3,i=this.h4;return HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[o&15]+HEX_CHARS[g>>28&15]+HEX_CHARS[g>>24&15]+HEX_CHARS[g>>20&15]+HEX_CHARS[g>>16&15]+HEX_CHARS[g>>12&15]+HEX_CHARS[g>>8&15]+HEX_CHARS[g>>4&15]+HEX_CHARS[g&15]+HEX_CHARS[v>>28&15]+HEX_CHARS[v>>24&15]+HEX_CHARS[v>>20&15]+HEX_CHARS[v>>16&15]+HEX_CHARS[v>>12&15]+HEX_CHARS[v>>8&15]+HEX_CHARS[v>>4&15]+HEX_CHARS[v&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[i&15]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var s=this.h0,o=this.h1,g=this.h2,v=this.h3,i=this.h4;return[s>>24&255,s>>16&255,s>>8&255,s&255,o>>24&255,o>>16&255,o>>8&255,o&255,g>>24&255,g>>16&255,g>>8&255,g&255,v>>24&255,v>>16&255,v>>8&255,v&255,i>>24&255,i>>16&255,i>>8&255,i&255]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var s=new ArrayBuffer(20),o=new DataView(s);return o.setUint32(0,this.h0),o.setUint32(4,this.h1),o.setUint32(8,this.h2),o.setUint32(12,this.h3),o.setUint32(16,this.h4),s};var exports=createMethod();COMMON_JS?module.exports=exports:root.sha1=exports})()})(sha1$1);var sha1Exports=sha1$1.exports,md5=md5Exports,sha1=sha1Exports,HEX_DIGITS="0123456789abcdef".split(""),UUID_LENGTH=36,UUID_REGEXP=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i,HEX_TO_BYTE_MAP=function(){for(var s={},o=0;o<256;o++){var g=o.toString(16);s[g.length===1?"0"+g:g]=o}return s}(),uint8ToHex=function(s){var o=s>>4,g=s-(o<<4);return HEX_DIGITS[o]+HEX_DIGITS[g]},uint8ArrayToHex=function(s){for(var o="",g=0;g<s.length;g++)o+=uint8ToHex(s[g]);return o},stringToCharBuffer=function(s){for(var o=unescape(encodeURIComponent(s)),g=new Uint8Array(o.length),v=0;v<o.length;v++)g[v]=o[v].charCodeAt(0);return g},md5Hash=function(s){return new Uint8Array(md5.arrayBuffer(s))},sha1Hash=function(s){return new Uint8Array(sha1.arrayBuffer(s))},concatBuffers=function(s,o){var g=new Uint8Array(s.length+o.length);return g.set(new Uint8Array(s),0),g.set(new Uint8Array(o),s.byteLength),g},validateUuid=function(s){return typeof s=="string"&&s.length===UUID_LENGTH&&UUID_REGEXP.test(s)},parseUuid=function(s){if(!validateUuid(s))throw TypeError("Invalid UUID");for(var o=new Uint8Array(16),g=0,v=0;g<s.length;){if(s[g]==="-"){g++;continue}var i=(s[g]+s[g+1]).toLowerCase();o[v]=HEX_TO_BYTE_MAP[i],v++,g+=2}return o},hashToUuid=function(s,o){return uint8ArrayToHex(s.slice(0,4))+"-"+uint8ArrayToHex(s.slice(4,6))+"-"+uint8ToHex(s[6]&15|parseInt(o*10,16))+uint8ToHex(s[7])+"-"+uint8ToHex(s[8]&63|128)+uint8ToHex(s[9])+"-"+uint8ArrayToHex(s.slice(10,16))},lib$1={uint8ToHex,uint8ArrayToHex,stringToCharBuffer,md5Hash,sha1Hash,concatBuffers,validateUuid,parseUuid,hashToUuid},lib=lib$1,EMPTY_UINT8_ARRAY=new Uint8Array(0);function generateUuid(s,o,g){if(typeof s!="string")throw TypeError("Value must be string");if(typeof o=="number")return generateUuid(s,void 0,o);if(g==null)return generateUuid(s,o,5);if(g!==3&&g!==5)throw TypeError("Version of UUID can be only 3 or 5");var v=lib.stringToCharBuffer(s),i=typeof o=="string"?lib.parseUuid(o):EMPTY_UINT8_ARRAY,a=lib.concatBuffers(i,v),f=g===3?lib.md5Hash(a):lib.sha1Hash(a);return lib.hashToUuid(f,g)}var src=generateUuid;const getUuid=getDefaultExportFromCjs(src),GOLDENRATIO=1.61803398875,pexel=s=>`https://images.pexels.com/photos/${s}/pexels-photo-${s}.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260`,images=[{position:[0,0,1.5],rotation:[0,0,0],url:pexel(1103970)},{position:[-.8,0,-.6],rotation:[0,0,0],url:pexel(416430)},{position:[.8,0,-.6],rotation:[0,0,0],url:pexel(310452)},{position:[-1.75,0,.25],rotation:[0,Math.PI/2.5,0],url:pexel(327482)},{position:[-2.15,0,1.5],rotation:[0,Math.PI/2.5,0],url:pexel(325185)},{position:[-2,0,2.75],rotation:[0,Math.PI/2.5,0],url:pexel(358574)},{position:[1.75,0,.25],rotation:[0,-Math.PI/2.5,0],url:pexel(227675)},{position:[2.15,0,1.5],rotation:[0,-Math.PI/2.5,0],url:pexel(911738)},{position:[2,0,2.75],rotation:[0,-Math.PI/2.5,0],url:pexel(1738986)}],gallery=()=>jsxRuntimeExports.jsxs(Canvas,{dpr:[1,1.5],style:{margin:"auto"},camera:{fov:70,position:[0,2,15]},children:[jsxRuntimeExports.jsx("color",{attach:"background",args:["#191920"]}),jsxRuntimeExports.jsx("fog",{attach:"fog",args:["#191920",0,15]}),jsxRuntimeExports.jsxs("group",{position:[0,-.5,0],children:[jsxRuntimeExports.jsx(Frames,{images}),jsxRuntimeExports.jsxs("mesh",{rotation:[-Math.PI/2,0,0],children:[jsxRuntimeExports.jsx("planeGeometry",{args:[50,50]}),jsxRuntimeExports.jsx(MeshReflectorMaterial,{blur:[300,100],resolution:2048,mixBlur:1,mixStrength:80,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#050505",metalness:.5})]})]})]});function Frames({images:s,q:o=new Quaternion,p:g=new Vector3}){const v=reactExports.useRef(),i=reactExports.useRef(),[,a]=useRoute("/"),[,f]=useLocation();return reactExports.useEffect(()=>{i.current=v.current.getObjectByName(a?.id),console.log(i),i.current?(i.current.parent.updateWorldMatrix(!0,!0),i.current.parent.localToWorld(g.set(0,GOLDENRATIO/2,1.25)),i.current.parent.getWorldQuaternion(o)):(g.set(0,0,5.5),o.identity())}),useFrame((c,d)=>{easing.damp3(c.camera.position,g,.4,d),easing.dampQ(c.camera.quaternion,o,.4,d)}),jsxRuntimeExports.jsx("group",{ref:v,onClick:c=>(c.stopPropagation(),f("/mono_notes/posts/gallery#5")),onPointerMissed:()=>f("/"),children:s.map(c=>jsxRuntimeExports.jsx(Frame,{...c},c.url))})}function Frame({url:s,c:o=new Color,...g}){const v=reactExports.useRef(),i=reactExports.useRef(),[,a]=useRoute("/"),[f,c]=reactExports.useState(!1),[d]=reactExports.useState(()=>Math.random()),x=getUuid(s),y=a?.id===x;return useCursor(f),useFrame((_,S)=>{v.current.material.zoom=2+Math.sin(d*1e4+_.clock.elapsedTime/3)/2,easing.damp3(v.current.scale,[.85*(!y&&f?.85:1),.9*(!y&&f?.905:1),1],.1,S),easing.dampC(i.current.material.color,f?"orange":"white",.1,S)}),jsxRuntimeExports.jsxs("group",{...g,children:[jsxRuntimeExports.jsxs("mesh",{name:x,onPointerOver:_=>(_.stopPropagation(),c(!0)),onPointerOut:()=>c(!1),scale:[1,GOLDENRATIO,.05],position:[0,GOLDENRATIO/2,0],children:[jsxRuntimeExports.jsx("boxGeometry",{}),jsxRuntimeExports.jsx("meshStandardMaterial",{color:"#151515",metalness:.5,roughness:.5,envMapIntensity:2}),jsxRuntimeExports.jsxs("mesh",{ref:i,raycast:()=>null,scale:[.9,.93,.9],position:[0,0,.2],children:[jsxRuntimeExports.jsx("boxGeometry",{}),jsxRuntimeExports.jsx("meshBasicMaterial",{toneMapped:!1,fog:!1})]}),jsxRuntimeExports.jsx(Image,{raycast:()=>null,ref:v,position:[0,0,.7],url:s})]}),jsxRuntimeExports.jsx(Text,{maxWidth:.1,anchorX:"left",anchorY:"top",position:[.55,GOLDENRATIO,0],fontSize:.025,children:x.split("-").join(" ")})]})}export{gallery as default};
