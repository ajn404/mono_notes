import{k as keyName,b as base}from"./index.9fb136d3.js";import{D,T,b as e$8,c as i$8,a as t$3,m,f,d as c$3,p as p$1,g as a$2,x as x$1,A,h as b$1,e as e$9}from"./directive-helpers.ea3d1013.js";import{g as getDefaultExportFromCjs,c as commonjsGlobal}from"./_commonjsHelpers.de833af9.js";import{_ as __vitePreload}from"./preload-helper.5bd54887.js";import{_ as _typeofExports}from"./typeof.b6c3327d.js";import{c as commonjsRequire}from"./_commonjs-dynamic-modules.302442b1.js";function _mergeNamespaces(k,_){for(var y=0;y<_.length;y++){const w=_[y];if(typeof w!="string"&&!Array.isArray(w)){for(const $ in w)if($!=="default"&&!($ in k)){const B=Object.getOwnPropertyDescriptor(w,$);B&&Object.defineProperty(k,$,B.get?B:{enumerable:!0,get:()=>w[$]})}}}return Object.freeze(Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}))}function isPrimitive$1(k){return k!==Object(k)}function assertExists$1(k,_="val does not exist"){if(k==null)throw _ instanceof Error?_:new Error(_)}function isEqual$2(k,_){const y=isPrimitive$1(k),w=isPrimitive$1(_);if(y&&w){if(!Object.is(k,_))return!1}else{if(y!==w)return!1;if(Array.isArray(k)&&Array.isArray(_))return k.length!==_.length?!1:k.every(($,B)=>isEqual$2($,_[B]));if(typeof k=="object"&&typeof _=="object"){const $=Object.entries(k),B=Object.entries(_);return $.length!==B.length?!1:$.every((R,H)=>isEqual$2(R,B[H]))}}return!0}function assertEquals$1(k,_,y="val is not same as expected"){if(!isEqual$2(k,_))throw new Error(y)}let DisposableGroup$1=class{constructor(){this._disposed=!1,this._disposables=[]}get disposed(){return this._disposed}add(_){typeof _=="function"?this._disposed?_():this._disposables.push({dispose:_}):this._disposed?_.dispose():this._disposables.push(_)}addFromEvent(_,y,w,$){this.add({dispose:()=>{_.removeEventListener(y,w,$)}}),_.addEventListener(y,w,$)}dispose(){disposeAll$1(this._disposables),this._disposables=[],this._disposed=!0}};function flattenDisposables$1(k){return{dispose:()=>disposeAll$1(k)}}function disposeAll$1(k){for(const _ of k)try{_.dispose()}catch(y){console.error(y)}}function diffArray(k,_,y=(w,$)=>w===$){const w=[],$=[],B=[];for(const R of k)_.some(H=>y(H,R))?B.push(R):$.push(R);for(const R of _)k.some(H=>y(H,R))||w.push(R);return{changed:w.length||$.length,add:w,remove:$,unchanged:B}}let Slot$1=class bt{constructor(){this._emitting=!1,this._callbacks=[],this._disposables=[],this.subscribe=(_,y,w)=>{let $;const{filter:B,equalityFn:R=Object.is}=w??{};return this.on(H=>{if(B&&!B(H))return;const j=_(H);($===void 0||!R($,j))&&(y(j),$=j)})}}filter(_){const y=new bt;return y._disposables.push({dispose:()=>this.dispose()}),this.on(w=>{_(w)&&y.emit(w)}),y}on(_){if(this._emitting){const y=[...this._callbacks,_];this._callbacks=y}else this._callbacks.push(_);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(y=>y!==_);else{const y=this._callbacks.indexOf(_);y>-1&&this._callbacks.splice(y,1)}}}}once(_){let y;const w=B=>{_(B),y&&y()},$=this.on(w);return y=$.dispose,$}unshift(_){if(this._emitting){const y=[_,...this._callbacks];this._callbacks=y}else this._callbacks.unshift(_);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(y=>y!==_);else{const y=this._callbacks.indexOf(_);y>-1&&this._callbacks.splice(y,1)}}}}emit(_){const y=this._emitting;this._emitting=!0,this._callbacks.forEach(w=>{try{w(_)}catch($){console.error($)}}),this._emitting=y}pipe(_){return this._callbacks.push(y=>_.emit(y)),this}dispose(){flattenDisposables$1(this._disposables).dispose(),this._callbacks=[],this._disposables=[]}toDispose(_){return _.push(this),this}};class UIEventState{constructor(_){this.event=_,this.type="defaultState"}}class UIEventStateContext{constructor(){this._map={},this.add=_=>{const y=_.type;this._map[y]&&console.warn("UIEventStateContext: state name duplicated",y),this._map[y]=_},this.has=_=>!!this._map[_],this.get=_=>{const y=this._map[_];return assertExists$1(y,`UIEventStateContext: state ${_} not found`),y}}static from(..._){const y=new UIEventStateContext;return _.forEach(w=>{y.add(w)}),y}}class PathFinder{constructor(){}}PathFinder.id=k=>k[k.length-1];PathFinder.parent=k=>k.slice(0,k.length-1);PathFinder.pathToKey=k=>k.join("|");PathFinder.keyToPath=k=>k.split("|");PathFinder.equals=(k,_)=>PathFinder.pathToKey(k)===PathFinder.pathToKey(_);PathFinder.includes=(k,_)=>PathFinder.pathToKey(k).startsWith(PathFinder.pathToKey(_));class ClipboardEventState extends UIEventState{constructor({event:_}){super(_),this.type="clipboardState",this.raw=_}}class ClipboardControl{constructor(_){this._dispatcher=_,this._cut=y=>{const w=new ClipboardEventState({event:y});this._dispatcher.run("cut",this._createContext(y,w))},this._copy=y=>{const w=new ClipboardEventState({event:y});this._dispatcher.run("copy",this._createContext(y,w))},this._paste=y=>{const w=new ClipboardEventState({event:y});this._dispatcher.run("paste",this._createContext(y,w))}}_createContext(_,y){return UIEventStateContext.from(new UIEventState(_),y)}listen(){this._dispatcher.disposables.addFromEvent(document,"cut",this._cut),this._dispatcher.disposables.addFromEvent(document,"copy",this._copy),this._dispatcher.disposables.addFromEvent(document,"paste",this._paste)}}class KeyboardEventState extends UIEventState{constructor({event:_}){super(_),this.type="keyboardState",this.raw=_}}class PointerEventState extends UIEventState{get x(){return this.point.x}get y(){return this.point.y}constructor({event:_,rect:y,startX:w,startY:$,last:B}){super(_),this.type="pointerState";const R=_.clientX-y.left,H=_.clientY-y.top;this.raw=_,this.point={x:R,y:H},this.containerOffset={x:y.left,y:y.top},this.start={x:w,y:$},this.delta=B?{x:R-B.point.x,y:H-B.point.y}:{x:0,y:0},this.keys={shift:_.shiftKey,cmd:_.metaKey||_.ctrlKey,alt:_.altKey},this.button=B?.button||_.button,this.dragging=!!B}}class KeyboardControl{constructor(_){this._dispatcher=_,this._down=y=>{const w=new KeyboardEventState({event:y});this._dispatcher.run("keyDown",this._createContext(y,w))},this._up=y=>{const w=new KeyboardEventState({event:y});this._dispatcher.run("keyUp",this._createContext(y,w))}}_createContext(_,y){return UIEventStateContext.from(new UIEventState(_),y)}listen(){this._dispatcher.disposables.addFromEvent(document,"keydown",this._down),this._dispatcher.disposables.addFromEvent(document,"keyup",this._up)}}function isFarEnough(k,_){const y=k.x-_.x,w=k.y-_.y;return Math.pow(y,2)+Math.pow(w,2)>4}const toLowerCase$1=k=>k.toLowerCase();class PointerControl{constructor(_){this._dispatcher=_,this._lastPointerDownEvent=null,this._startDragState=null,this._lastDragState=null,this._pointerDownCount=0,this._dragging=!1,this._startX=-1/0,this._startY=-1/0,this._reset=()=>{this._startX=-1/0,this._startY=-1/0,this._lastDragState=null,this._dragging=!1},this._down=y=>{this._lastPointerDownEvent&&y.timeStamp-this._lastPointerDownEvent.timeStamp<500&&!isFarEnough(y,this._lastPointerDownEvent)?this._pointerDownCount++:this._pointerDownCount=1;const w=new PointerEventState({event:y,rect:this._rect,startX:this._startX,startY:this._startY,last:null});this._startX=w.point.x,this._startY=w.point.y,this._startDragState=w,this._lastDragState=w,this._lastPointerDownEvent=y,this._dispatcher.run("pointerDown",this._createContext(y,w)),this._dispatcher.disposables.addFromEvent(document,"pointermove",this._move),this._dispatcher.disposables.addFromEvent(document,"pointerup",this._up)},this._up=y=>{const w=new PointerEventState({event:y,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState}),$=this._createContext(y,w);(()=>{if(this._dragging){this._dispatcher.run("dragEnd",$);return}this._dispatcher.run("click",$),this._pointerDownCount===2&&this._dispatcher.run("doubleClick",$),this._pointerDownCount===3&&this._dispatcher.run("tripleClick",$)})(),this._dispatcher.run("pointerUp",$),this._reset(),document.removeEventListener("pointermove",this._move),document.removeEventListener("pointerup",this._up)},this._move=y=>{const w=this._lastDragState,$=new PointerEventState({event:y,rect:this._rect,startX:this._startX,startY:this._startY,last:w});this._lastDragState=$,assertExists$1(this._startDragState),!this._dragging&&isFarEnough(this._startDragState.raw,$.raw)&&(this._dragging=!0,this._dispatcher.run("dragStart",this._createContext(y,this._startDragState))),this._dragging&&this._dispatcher.run("dragMove",this._createContext(y,$))},this._moveOn=y=>{const w=new PointerEventState({event:y,rect:this._rect,startX:this._startX,startY:this._startY,last:this._lastDragState});this._dispatcher.run("pointerMove",this._createContext(y,w))},this._out=y=>{const w=new PointerEventState({event:y,rect:this._rect,startX:-1/0,startY:-1/0,last:null});this._dispatcher.run("pointerOut",this._createContext(y,w))}}listen(){this._dispatcher.disposables.addFromEvent(this._dispatcher.root,"pointerdown",this._down),this._dispatcher.disposables.addFromEvent(this._dispatcher.root,"pointermove",this._moveOn),this._dispatcher.disposables.addFromEvent(this._dispatcher.root,"pointerout",this._out)}get _rect(){return this._dispatcher.root.getBoundingClientRect()}_createContext(_,y){return UIEventStateContext.from(new UIEventState(_),y)}}class RangeControl{constructor(_){this._dispatcher=_,this._prev=null,this._compositionUpdate=y=>{const w=this._buildScope("compositionUpdate");this._dispatcher.run("compositionUpdate",this._createContext(y),w)},this._compositionStart=y=>{const w=this._buildScope("compositionStart");this._dispatcher.run("compositionStart",this._createContext(y),w)},this._compositionEnd=y=>{const w=this._buildScope("compositionEnd");this._dispatcher.run("compositionEnd",this._createContext(y),w)},this._selectionChange=y=>{const w=this._buildScope("selectionChange");this._dispatcher.run("selectionChange",this._createContext(y),w)},this._buildScope=y=>{let w;const $=document.getSelection();if($&&$.rangeCount>0){const B=$.getRangeAt(0);w=this._buildEventScopeByNativeRange(y,B),this._prev=B}else this._prev!==null&&(w=this._buildEventScopeByNativeRange(y,this._prev),this._prev=null);return w}}listen(){this._dispatcher.disposables.addFromEvent(document,"selectionchange",this._selectionChange),this._dispatcher.disposables.addFromEvent(document,"compositionstart",this._compositionStart),this._dispatcher.disposables.addFromEvent(document,"compositionend",this._compositionEnd),this._dispatcher.disposables.addFromEvent(document,"compositionupdate",this._compositionUpdate)}_createContext(_){return UIEventStateContext.from(new UIEventState(_))}_buildEventScopeByNativeRange(_,y){const $=this._findBlockElementPath(y).map(R=>R).filter(R=>!!R),B=Array.from(new Set($.flatMap(R=>R.map(H=>this._dispatcher.blockStore.page.getBlockById(H)?.flavour)).filter(R=>!!R))).reverse();return this._dispatcher.buildEventScope(_,B,$)}_findBlockElementPath(_){const y=_.startContainer,w=_.endContainer,$=_.commonAncestorContainer,B=this._dispatcher.blockStore.viewStore.getNodeView;if($.nodeType===Node.TEXT_NODE){const X=B($);if(X)return[X.path]}const R=new Set;let H=!1;const j=(X,ee)=>{if(X&&X!==ee){if(X===w){R.add(X),H=!1;return}X===y&&(H=!0),H&&(X.nodeType===Node.TEXT_NODE||X.nodeType===Node.ELEMENT_NODE)&&R.add(X),j(X.firstChild,ee),j(X.nextSibling,ee)}};j($.firstChild,$);const q=new Set;return R.forEach(X=>{const ee=B(X);ee&&(q.has(ee.path)||q.add(ee.path))}),Array.from(q)}}const mac=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function normalizeKeyName(k){const _=k.split(/-(?!$)/);let y=_.at(-1);y==="Space"&&(y=" ");let w,$,B,R;return _.slice(0,-1).forEach(H=>{if(/^(cmd|meta|m)$/i.test(H)){R=!0;return}if(/^a(lt)?$/i.test(H)){w=!0;return}if(/^(c|ctrl|control)$/i.test(H)){$=!0;return}if(/^s(hift)?$/i.test(H)){B=!0;return}if(/^mod$/i.test(H)){mac?R=!0:$=!0;return}throw new Error("Unrecognized modifier name: "+H)}),w&&(y="Alt-"+y),$&&(y="Ctrl-"+y),R&&(y="Meta-"+y),B&&(y="Shift-"+y),y}function modifiers(k,_,y=!0){return _.altKey&&(k="Alt-"+k),_.ctrlKey&&(k="Ctrl-"+k),_.metaKey&&(k="Meta-"+k),y&&_.shiftKey&&(k="Shift-"+k),k}function normalize$1(k){const _=Object.create(null);for(const y in k)_[normalizeKeyName(y)]=k[y];return _}function bindKeymap(k){const _=normalize$1(k);return y=>{const $=y.get("keyboardState").raw,B=keyName($),R=_[modifiers(B,$)];if(R&&R(y))return!0;if(B.length!==1||B===" ")return!1;if($.shiftKey){const q=_[modifiers(B,$,!1)];if(q&&q(y))return!0}const H=$.shiftKey||$.altKey||$.metaKey||B.charCodeAt(0)>127,j=base[$.keyCode];if(H&&j&&j!==B){const q=_[modifiers(j,$)];if(q&&q(y))return!0}return!1}}const bypassEventNames=["beforeInput","blur","focus","drop","contextMenu","wheel"],eventNames=["click","doubleClick","tripleClick","pointerDown","pointerMove","pointerUp","pointerOut","dragStart","dragMove","dragEnd","keyDown","keyUp","selectionChange","compositionStart","compositionUpdate","compositionEnd","cut","copy","paste",...bypassEventNames];class UIEventDispatcher{constructor(_){this.blockStore=_,this.disposables=new DisposableGroup$1,this._handlersMap=Object.fromEntries(eventNames.map(y=>[y,[]])),this._pointerControl=new PointerControl(this),this._keyboardControl=new KeyboardControl(this),this._rangeControl=new RangeControl(this),this._clipboardControl=new ClipboardControl(this)}mount(){this.disposables.disposed&&(this.disposables=new DisposableGroup$1),this._bindEvents()}unmount(){this.disposables.dispose()}get root(){return this.blockStore.root}run(_,y,w){const{event:$}=y.get("defaultState");if(!(!w&&(w=this._getEventScope(_,$),!w)))for(const B of w.runners){const{fn:R}=B;if(R(y))return}}add(_,y,w){const $={fn:y,flavour:w?.flavour,path:w?.path};return this._handlersMap[_].unshift($),()=>{this._handlersMap[_].includes($)&&(this._handlersMap[_]=this._handlersMap[_].filter(B=>B!==$))}}bindHotkey(_,y){return this.add("keyDown",bindKeymap(_),y)}get _currentSelections(){return this.blockStore.selectionManager.value}_getEventScope(_,y){if(!this._handlersMap[_])return;let $;return y.target&&y.target instanceof Node&&($=this._buildEventScopeByTarget(_,y.target)),$||($=this._buildEventScopeBySelection(_)),$}buildEventScope(_,y,w){const $=this._handlersMap[_];if(!$)return;const B=$.filter(j=>j.flavour===void 0&&j.path===void 0),R=$.filter(j=>{const q=j.path;return q===void 0?!1:w.some(X=>PathFinder.includes(X,q))}),H=$.filter(j=>j.flavour&&y.includes(j.flavour));return{runners:R.concat(H).concat(B),flavours:y,paths:w}}_buildEventScopeByTarget(_,y){if(!this._handlersMap[_])return;const $=this.blockStore.viewStore.getNodeView(y)?.path;if(!$)return;const B=$.map(R=>this.blockStore.page.getBlockById(R)?.flavour).filter(R=>!!R).reverse();return this.buildEventScope(_,B,[$])}_buildEventScopeBySelection(_){if(!this._handlersMap[_])return;const w=this._currentSelections,$={},B=w.map(H=>H.path).flatMap(H=>H.map(j=>this.blockStore.page.getBlockById(j)?.flavour)).filter(H=>!H||$[H]?!1:($[H]=!0,!0)).reverse(),R=w.map(H=>H.path);return this.buildEventScope(_,B,R)}_bindEvents(){bypassEventNames.forEach(_=>{this.disposables.addFromEvent(this.root,toLowerCase$1(_),y=>{this.run(_,UIEventStateContext.from(new UIEventState(y)))})}),this._pointerControl.listen(),this._keyboardControl.listen(),this._rangeControl.listen(),this._clipboardControl.listen()}}class BaseSelection{constructor({path:_}){this.path=_}get blockId(){return PathFinder.id(this.path)}is(_){return this.type===_}get type(){return this.constructor.type}get group(){return this.constructor.group}static fromJSON(_){throw new Error("You must override this method")}}let BlockSelection$1=class _t extends BaseSelection{equals(_){return _ instanceof _t?PathFinder.equals(this.path,_.path):!1}toJSON(){return{type:"block",path:this.path}}static fromJSON(_){return new _t({path:_.path})}};BlockSelection$1.type="block";BlockSelection$1.group="note";class SurfaceSelection extends BaseSelection{constructor(_,y){super({path:[]}),this.elements=_,this.editing=y}isEmpty(){return this.elements.length===0&&!this.editing}equals(_){return _ instanceof SurfaceSelection?this.blockId===_.blockId&&this.elements.length===_.elements.length&&this.elements.every((y,w)=>y===_.elements[w]):!1}toJSON(){return{type:"surface",elements:this.elements,blockId:this.blockId,editing:this.editing}}static fromJSON(_){return new SurfaceSelection(_.elements,_.editing)}}SurfaceSelection.type="surface";SurfaceSelection.group="edgeless";class TextSelection extends BaseSelection{constructor({from:_,to:y}){super({path:_.path}),this.from=_,this.to=this._equalPoint(_,y)?null:y}empty(){return!!this.to}_equalPoint(_,y){return _&&y?PathFinder.equals(_.path,y.path)&&_.index===y.index&&_.length===y.length:_===y}equals(_){return _ instanceof TextSelection?PathFinder.equals(this.path,_.path)&&this._equalPoint(_.from,this.from)&&this._equalPoint(_.to,this.to):!1}toJSON(){return{type:"text",from:this.from,to:this.to}}static fromJSON(_){return new TextSelection({from:_.from,to:_.to})}isCollapsed(){return this.to===null&&this.from.length===0}isInSameBlock(){return this.to===null||PathFinder.equals(this.from.path,this.to.path)}}TextSelection.type="text";TextSelection.group="note";class SelectionManager{constructor(_){this.blockStore=_,this.disposables=new DisposableGroup$1,this._selectionConstructors={},this.slots={changed:new Slot$1,remoteChanged:new Slot$1},this._jsonToSelection=y=>{const w=this._selectionConstructors[y.type];if(!w)throw new Error(`Unknown selection type: ${y.type}`);return w.fromJSON(y)},this._itemAdded=y=>{y.stackItem.meta.set("selection-state",this.value)},this._itemPopped=y=>{const w=y.stackItem.meta.get("selection-state");w&&this.set(w)},this._setupDefaultSelections()}register(_){return[_].flat().forEach(y=>{this._selectionConstructors[y.type]=y}),this}get _store(){return this.blockStore.workspace.awarenessStore}_setupDefaultSelections(){this.register([TextSelection,BlockSelection$1,SurfaceSelection])}getInstance(_,...y){const w=this._selectionConstructors[_];if(!w)throw new Error(`Unknown selection type: ${_}`);return new w(...y)}get value(){return this._store.getLocalSelection().map(_=>this._jsonToSelection(_))}set(_){this._store.setLocalSelection(_.map(y=>y.toJSON())),this.slots.changed.emit(_)}setGroup(_,y){const w=this.value.filter($=>$.group!==_);this.set([...w,...y])}getGroup(_){return this.value.filter(y=>y.group===_)}update(_){const y=_(this.value);this.set(y)}clear(_){if(_){const y=this.value.filter(w=>!_.includes(w.type));this.set(y)}else this.set([])}find(_){return this.value.find(y=>y.is(_))}filter(_){return this.value.filter(y=>y.is(_))}get remoteSelections(){return Object.fromEntries(Array.from(this._store.getStates().entries()).filter(([_])=>_!==this._store.awareness.clientID).map(([_,y])=>[_,y.selection.map(this._jsonToSelection)]))}mount(){this.disposables.disposed&&(this.disposables=new DisposableGroup$1),this.blockStore.page.history.on("stack-item-added",this._itemAdded),this.blockStore.page.history.on("stack-item-popped",this._itemPopped),this.disposables.add(this._store.slots.update.on(({id:_})=>{_!==this._store.awareness.clientID&&this.slots.remoteChanged.emit(this.remoteSelections)}))}unmount(){this.blockStore.page.history.off("stack-item-added",this._itemAdded),this.blockStore.page.history.off("stack-item-popped",this._itemPopped),this.clear(),this.slots.changed.dispose(),this.disposables.dispose()}dispose(){Object.values(this.slots).forEach(_=>_.dispose()),this.disposables.dispose()}}class BlockService{constructor(_){this.disposables=new DisposableGroup$1,this.flavour=_.flavour,this.store=_.store}get workspace(){return this.store.workspace}get page(){return this.store.page}get selectionManager(){return this.store.selectionManager}get uiEventDispatcher(){return this.store.uiEventDispatcher}dispose(){this.disposables.dispose()}mounted(){}unmounted(){}handleEvent(_,y,w){this.disposables.add(this.uiEventDispatcher.add(_,y,{flavour:w?.global?void 0:this.flavour}))}bindHotKey(_,y){this.disposables.add(this.uiEventDispatcher.bindHotkey(_,{flavour:y?.global?void 0:this.flavour}))}}class SpecStore{constructor(_){this.blockStore=_,this._specs=new Map,this._services=new Map}dispose(){this._services.forEach(_=>{_.dispose(),_.unmounted()}),this._services.clear()}applySpecs(_){const y=this._specs,w=this._buildSpecMap(_);this._diffServices(y,w),this._specs=w}getView(_){const y=this._specs.get(_);return y?y.view:null}getService(_){return this._services.get(_)}_diffServices(_,y){_.forEach((w,$)=>{if(y.has($)&&y.get($)?.service===w.service)return;const B=this._services.get($);B&&(B.dispose(),B.unmounted()),this._services.delete($)}),y.forEach((w,$)=>{if(this._services.has($)||!w.service)return;const B=new w.service({flavour:$,store:this.blockStore});this._services.set($,B),B.mounted()})}_buildSpecMap(_){const y=new Map;return _.forEach(w=>{y.set(w.schema.model.flavour,w)}),y}}const observeOptions={childList:!0,subtree:!0};class ViewStore{constructor(_){this.blockStore=_,this._cachedTree=null,this._cachedPath=new Map,this.viewSpec=new Map,this.getChildren=y=>{const w=this.fromPath(y);return w?w.children:[]},this.getNodeView=y=>{for(const[w,$]of this.viewSpec.entries()){const B=$.fromDOM(y);if(B)return{type:w,...B}}return null},this.calculatePath=y=>this.calculateNodeViewPath(y).map($=>$.id),this.calculateNodeViewPath=y=>{if(this._cachedPath.has(y))return this._cachedPath.get(y);const w=this.blockStore.root,$=(R,H)=>{if(!R||R===w)return H;const j=this.getNodeView(R);if(!j)return H;const q=this.viewSpec.get(j.type);assertExists$1(q);const X=q.toDOM(j).parentElement;return X?$(X,H.concat(j)):H},B=$(y,[]).reverse();return this._cachedPath.set(y,B),B},this.getNodeViewTree=()=>{if(this._cachedTree)return this._cachedTree;const y=B=>{const R=this.getNodeView(B);if(!R)throw new Error("nodeView not found");const H=this.viewSpec.get(R.type);assertExists$1(H);const j=H.getChildren(H.toDOM(R)).map(q=>y(q));return{...R,children:j}},w=this.blockStore.root.firstElementChild;assertExists$1(w);const $={id:"__root__",path:[],children:[y(w)]};return this._cachedTree=$,$},this.fromPath=y=>{const w=this.getNodeViewTree();return y.reduce(($,B)=>{if(!$)return null;const R=$.children.find(H=>H.id===B);return R||null},w)},this.walkThrough=(y,w=[])=>{const $=this.fromPath(w);assertExists$1($,`Invalid path to get node in view: ${w}`);const B=R=>(H,j)=>{y(H,j,R)!==!0&&H.children.forEach(B(H))};$.children.forEach(B($))},this.getParent=y=>y.length===0?null:this.fromPath(PathFinder.parent(y)),this.findPrev=(y,w)=>{const $=H=>{const j=this.getParent(H);if(!j)return null;const q=this._indexOf(H,j);if(q===-1)return null;if(q===0){const X=this.getParent(PathFinder.parent(H));return X?{nodeView:j,parent:X,index:this._indexOf(PathFinder.parent(H),X)}:null}return{nodeView:j.children[q-1],parent:j,index:q-1}};let B=null;const R=H=>{const j=$(H);if(!j)return;const{nodeView:q,parent:X,index:ee}=j;if(w(q,ee,X)){B=q;return}R(q.path)};return R(y),B},this.findNext=(y,w)=>{const $=H=>{const j=this.getParent(H);if(!j)return null;const q=this._indexOf(H,j);if(q===-1)return null;if(q===j.children.length-1){const X=this.getParent(PathFinder.parent(H));return X?{nodeView:j,parent:X,index:this._indexOf(PathFinder.parent(H),X)}:null}return{nodeView:j.children[q+1],parent:j,index:q+1}};let B=null;const R=H=>{const j=$(H);if(!j)return;const{nodeView:q,parent:X,index:ee}=j;if(w(q,ee,X)){B=q;return}R(q.path)};return R(y),B},this.indexOf=y=>{const w=this.getParent(y);return w?this._indexOf(y,w):-1},this._indexOf=(y,w)=>w.children.findIndex($=>$.id===y[y.length-1]),this._observer=new MutationObserver(()=>{this._cachedPath.clear(),this._cachedTree=null})}register(_,y){this.viewSpec.set(_,y)}viewFromPath(_,y){const w=this.fromPath(y);return!w||w.type!==_?null:w.view}mount(){this._observer.observe(this.blockStore.root,observeOptions)}unmount(){this._cachedPath.clear(),this._cachedTree=null,this._observer.disconnect(),this.viewSpec.clear()}}class BlockStore{constructor(_){this.root=_.root,this.workspace=_.workspace,this.page=_.page,this.uiEventDispatcher=new UIEventDispatcher(this),this.selectionManager=new SelectionManager(this),this.specStore=new SpecStore(this),this.viewStore=new ViewStore(this)}mount(){this.selectionManager.mount(),this.uiEventDispatcher.mount(),this.viewStore.mount()}unmount(){this.uiEventDispatcher.unmount(),this.selectionManager.unmount(),this.viewStore.unmount(),this.specStore.dispose()}}function isPrimitive(k){return k!==Object(k)}function assertExists(k,_="val does not exist"){if(k==null)throw _ instanceof Error?_:new Error(_)}function assertNotExists(k,_="val exists"){if(k!=null)throw new Error(_)}function isEqual$1(k,_){const y=isPrimitive(k),w=isPrimitive(_);if(y&&w){if(!Object.is(k,_))return!1}else{if(y!==w)return!1;if(Array.isArray(k)&&Array.isArray(_))return k.length!==_.length?!1:k.every(($,B)=>isEqual$1($,_[B]));if(typeof k=="object"&&typeof _=="object"){const $=Object.entries(k),B=Object.entries(_);return $.length!==B.length?!1:$.every((R,H)=>isEqual$1(R,B[H]))}}return!0}function assertEquals(k,_,y="val is not same as expected"){if(!isEqual$1(k,_))throw new Error(y)}class DisposableGroup{constructor(){this._disposed=!1,this._disposables=[]}get disposed(){return this._disposed}add(_){typeof _=="function"?this._disposed?_():this._disposables.push({dispose:_}):this._disposed?_.dispose():this._disposables.push(_)}addFromEvent(_,y,w,$){this.add({dispose:()=>{_.removeEventListener(y,w,$)}}),_.addEventListener(y,w,$)}dispose(){disposeAll(this._disposables),this._disposables=[],this._disposed=!0}}function flattenDisposables(k){return{dispose:()=>disposeAll(k)}}function disposeAll(k){for(const _ of k)try{_.dispose()}catch(y){console.error(y)}}async function sleep(k){return new Promise(_=>setTimeout(_,k))}function noop(k){}function throttle$1(k,_,{leading:y=!0,trailing:w=!0}={}){let $=null,B=null;const R=()=>{B&&w?(k(...B),B=null,$=setTimeout(R,_)):$=null};return function(...H){if($){B=H;return}y&&k.apply(this,H),$=setTimeout(R,_)}}function countBy(k,_){const y={};return k.forEach(w=>{const $=_(w);y[$]||(y[$]=0),y[$]+=1}),y}function maxBy(k,_){if(!k.length)return null;let y=k[0],w=_(y);for(let $=1;$<k.length;$++){const B=k[$],R=_(B);R>w&&(w=R,y=B)}return y}function atLeastNMatches(k,_,y){let w=0;for(let $=0;$<k.length;$++)if(_(k[$])&&(w++,w>=y))return!0;return!1}function groupBy$1(k,_){const y={};for(const w of k){const $=typeof _=="function"?_(w):w[_];y[$]||(y[$]=[]),y[$].push(w)}return y}function pickArray(k,_){return _.reduce((y,w)=>(y.push(k[w]),y),[])}function pick(k,_){return _.reduce((y,w)=>(y[w]=k[w],y),{})}function pickValues(k,_){return _.reduce((y,w)=>(y.push(k[w]),y),[])}function lastN(k,_){return k.slice(k.length-_,k.length)}function almostEqual$1(k,_,y=1e-4){return Math.abs(k-_)<y}const clamp$2=(k,_,y)=>k<_?_:k>y?y:k;function launchIntoFullscreen(k){k.requestFullscreen?k.requestFullscreen():k.mozRequestFullScreen?k.mozRequestFullScreen():k.webkitRequestFullscreen?k.webkitRequestFullscreen():k.msRequestFullscreen&&k.msRequestFullscreen()}const createDelayHoverSignal=(k,_=300)=>{let y=0;return{onHover:()=>{k.signal.aborted&&console.warn("AbortSignal has been aborted! Did you forget to remove the listener?"),clearTimeout(y)},onHoverLeave:()=>{k.signal.aborted&&console.warn("AbortSignal has been aborted! Did you forget to remove the listener?"),clearTimeout(y),y=window.setTimeout(()=>{k.abort()},_)}}};class Slot{constructor(){this._emitting=!1,this._callbacks=[],this._disposables=[],this.subscribe=(_,y,w)=>{let $;const{filter:B,equalityFn:R=Object.is}=w??{};return this.on(H=>{if(B&&!B(H))return;const j=_(H);($===void 0||!R($,j))&&(y(j),$=j)})}}filter(_){const y=new Slot;return y._disposables.push({dispose:()=>this.dispose()}),this.on(w=>{_(w)&&y.emit(w)}),y}on(_){if(this._emitting){const y=[...this._callbacks,_];this._callbacks=y}else this._callbacks.push(_);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(y=>y!==_);else{const y=this._callbacks.indexOf(_);y>-1&&this._callbacks.splice(y,1)}}}}once(_){let y;const w=B=>{_(B),y&&y()},$=this.on(w);return y=$.dispose,$}unshift(_){if(this._emitting){const y=[_,...this._callbacks];this._callbacks=y}else this._callbacks.unshift(_);return{dispose:()=>{if(this._emitting)this._callbacks=this._callbacks.filter(y=>y!==_);else{const y=this._callbacks.indexOf(_);y>-1&&this._callbacks.splice(y,1)}}}}emit(_){const y=this._emitting;this._emitting=!0,this._callbacks.forEach(w=>{try{w(_)}catch($){console.error($)}}),this._emitting=y}pipe(_){return this._callbacks.push(y=>_.emit(y)),this}dispose(){flattenDisposables(this._disposables).dispose(),this._callbacks=[],this._disposables=[]}toDispose(_){return _.push(this),this}}function escapeRegExp(k){return k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function isFuzzyMatch(k,_){const y=k.trim().toLowerCase().split("").filter($=>$!==" ").join("");return new RegExp(_.split("").filter($=>$!==" ").map($=>`${escapeRegExp($)}.*`).join(""),"i").test(y)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$7=k=>_=>typeof _=="function"?((y,w)=>(customElements.define(y,w),w))(k,_):((y,w)=>{const{kind:$,elements:B}=w;return{kind:$,elements:B,finisher(R){customElements.define(y,R)}}})(k,_);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const i$7=(k,_)=>_.kind==="method"&&_.descriptor&&!("value"in _.descriptor)?{..._,finisher(y){y.createProperty(_.key,k)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:_.key,initializer(){typeof _.initializer=="function"&&(this[_.key]=_.initializer.call(this))},finisher(y){y.createProperty(_.key,k)}},e$6=(k,_,y)=>{_.constructor.createProperty(y,k)};function n$a(k){return(_,y)=>y!==void 0?e$6(k,_,y):i$7(k,_)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function t$2(k){return n$a({...k,state:!0})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o$9=({finisher:k,descriptor:_})=>(y,w)=>{var $;if(w===void 0){const B=($=y.originalKey)!==null&&$!==void 0?$:y.key,R=_!=null?{kind:"method",placement:"prototype",key:B,descriptor:_(y.key)}:{...y,key:B};return k!=null&&(R.finisher=function(H){k(H,B)}),R}{const B=y.constructor;_!==void 0&&Object.defineProperty(y,w,_(w)),k?.(B,w)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function i$6(k,_){return o$9({descriptor:y=>{const w={get(){var $,B;return(B=($=this.renderRoot)===null||$===void 0?void 0:$.querySelector(k))!==null&&B!==void 0?B:null},enumerable:!0,configurable:!0};if(_){const $=typeof y=="symbol"?Symbol():"__"+y;w.get=function(){var B,R;return this[$]===void 0&&(this[$]=(R=(B=this.renderRoot)===null||B===void 0?void 0:B.querySelector(k))!==null&&R!==void 0?R:null),this[$]}}return w}})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function e$5(k){return o$9({descriptor:_=>({get(){var y,w;return(w=(y=this.renderRoot)===null||y===void 0?void 0:y.querySelectorAll(k))!==null&&w!==void 0?w:[]},enumerable:!0,configurable:!0})})}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var n$9;((n$9=window.HTMLSlotElement)===null||n$9===void 0?void 0:n$9.prototype.assignedElements)!=null;function WithDisposable(k){class _ extends k{constructor(){super(...arguments),this._disposables=new DisposableGroup}get disposables(){return this._disposables}connectedCallback(){super.connectedCallback(),this._disposables.disposed&&(this._disposables=new DisposableGroup)}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}}return _}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$1=window,e$4=t$1.ShadowRoot&&(t$1.ShadyCSS===void 0||t$1.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s$4=Symbol(),n$8=new WeakMap;let o$8=class{constructor(_,y,w){if(this._$cssResult$=!0,w!==s$4)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=_,this.t=y}get styleSheet(){let _=this.o;const y=this.t;if(e$4&&_===void 0){const w=y!==void 0&&y.length===1;w&&(_=n$8.get(y)),_===void 0&&((this.o=_=new CSSStyleSheet).replaceSync(this.cssText),w&&n$8.set(y,_))}return _}toString(){return this.cssText}};const r$2=k=>new o$8(typeof k=="string"?k:k+"",void 0,s$4),i$5=(k,..._)=>{const y=k.length===1?k[0]:_.reduce((w,$,B)=>w+(R=>{if(R._$cssResult$===!0)return R.cssText;if(typeof R=="number")return R;throw Error("Value passed to 'css' function must be a 'css' function result: "+R+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})($)+k[B+1],k[0]);return new o$8(y,k,s$4)},S=(k,_)=>{e$4?k.adoptedStyleSheets=_.map(y=>y instanceof CSSStyleSheet?y:y.styleSheet):_.forEach(y=>{const w=document.createElement("style"),$=t$1.litNonce;$!==void 0&&w.setAttribute("nonce",$),w.textContent=y.cssText,k.appendChild(w)})},c$2=e$4?k=>k:k=>k instanceof CSSStyleSheet?(_=>{let y="";for(const w of _.cssRules)y+=w.cssText;return r$2(y)})(k):k;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var s$3;const e$3=window,r$1=e$3.trustedTypes,h$2=r$1?r$1.emptyScript:"",o$7=e$3.reactiveElementPolyfillSupport,n$7={toAttribute(k,_){switch(_){case Boolean:k=k?h$2:null;break;case Object:case Array:k=k==null?k:JSON.stringify(k)}return k},fromAttribute(k,_){let y=k;switch(_){case Boolean:y=k!==null;break;case Number:y=k===null?null:Number(k);break;case Object:case Array:try{y=JSON.parse(k)}catch{y=null}}return y}},a$1=(k,_)=>_!==k&&(_==_||k==k),l$4={attribute:!0,type:String,converter:n$7,reflect:!1,hasChanged:a$1},d="finalized";let u$1=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(_){var y;this.finalize(),((y=this.h)!==null&&y!==void 0?y:this.h=[]).push(_)}static get observedAttributes(){this.finalize();const _=[];return this.elementProperties.forEach((y,w)=>{const $=this._$Ep(w,y);$!==void 0&&(this._$Ev.set($,w),_.push($))}),_}static createProperty(_,y=l$4){if(y.state&&(y.attribute=!1),this.finalize(),this.elementProperties.set(_,y),!y.noAccessor&&!this.prototype.hasOwnProperty(_)){const w=typeof _=="symbol"?Symbol():"__"+_,$=this.getPropertyDescriptor(_,w,y);$!==void 0&&Object.defineProperty(this.prototype,_,$)}}static getPropertyDescriptor(_,y,w){return{get(){return this[y]},set($){const B=this[_];this[y]=$,this.requestUpdate(_,B,w)},configurable:!0,enumerable:!0}}static getPropertyOptions(_){return this.elementProperties.get(_)||l$4}static finalize(){if(this.hasOwnProperty(d))return!1;this[d]=!0;const _=Object.getPrototypeOf(this);if(_.finalize(),_.h!==void 0&&(this.h=[..._.h]),this.elementProperties=new Map(_.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const y=this.properties,w=[...Object.getOwnPropertyNames(y),...Object.getOwnPropertySymbols(y)];for(const $ of w)this.createProperty($,y[$])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(_){const y=[];if(Array.isArray(_)){const w=new Set(_.flat(1/0).reverse());for(const $ of w)y.unshift(c$2($))}else _!==void 0&&y.push(c$2(_));return y}static _$Ep(_,y){const w=y.attribute;return w===!1?void 0:typeof w=="string"?w:typeof _=="string"?_.toLowerCase():void 0}_$Eu(){var _;this._$E_=new Promise(y=>this.enableUpdating=y),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(_=this.constructor.h)===null||_===void 0||_.forEach(y=>y(this))}addController(_){var y,w;((y=this._$ES)!==null&&y!==void 0?y:this._$ES=[]).push(_),this.renderRoot!==void 0&&this.isConnected&&((w=_.hostConnected)===null||w===void 0||w.call(_))}removeController(_){var y;(y=this._$ES)===null||y===void 0||y.splice(this._$ES.indexOf(_)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((_,y)=>{this.hasOwnProperty(y)&&(this._$Ei.set(y,this[y]),delete this[y])})}createRenderRoot(){var _;const y=(_=this.shadowRoot)!==null&&_!==void 0?_:this.attachShadow(this.constructor.shadowRootOptions);return S(y,this.constructor.elementStyles),y}connectedCallback(){var _;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(_=this._$ES)===null||_===void 0||_.forEach(y=>{var w;return(w=y.hostConnected)===null||w===void 0?void 0:w.call(y)})}enableUpdating(_){}disconnectedCallback(){var _;(_=this._$ES)===null||_===void 0||_.forEach(y=>{var w;return(w=y.hostDisconnected)===null||w===void 0?void 0:w.call(y)})}attributeChangedCallback(_,y,w){this._$AK(_,w)}_$EO(_,y,w=l$4){var $;const B=this.constructor._$Ep(_,w);if(B!==void 0&&w.reflect===!0){const R=((($=w.converter)===null||$===void 0?void 0:$.toAttribute)!==void 0?w.converter:n$7).toAttribute(y,w.type);this._$El=_,R==null?this.removeAttribute(B):this.setAttribute(B,R),this._$El=null}}_$AK(_,y){var w;const $=this.constructor,B=$._$Ev.get(_);if(B!==void 0&&this._$El!==B){const R=$.getPropertyOptions(B),H=typeof R.converter=="function"?{fromAttribute:R.converter}:((w=R.converter)===null||w===void 0?void 0:w.fromAttribute)!==void 0?R.converter:n$7;this._$El=B,this[B]=H.fromAttribute(y,R.type),this._$El=null}}requestUpdate(_,y,w){let $=!0;_!==void 0&&(((w=w||this.constructor.getPropertyOptions(_)).hasChanged||a$1)(this[_],y)?(this._$AL.has(_)||this._$AL.set(_,y),w.reflect===!0&&this._$El!==_&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(_,w))):$=!1),!this.isUpdatePending&&$&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(y){Promise.reject(y)}const _=this.scheduleUpdate();return _!=null&&await _,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var _;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(($,B)=>this[B]=$),this._$Ei=void 0);let y=!1;const w=this._$AL;try{y=this.shouldUpdate(w),y?(this.willUpdate(w),(_=this._$ES)===null||_===void 0||_.forEach($=>{var B;return(B=$.hostUpdate)===null||B===void 0?void 0:B.call($)}),this.update(w)):this._$Ek()}catch($){throw y=!1,this._$Ek(),$}y&&this._$AE(w)}willUpdate(_){}_$AE(_){var y;(y=this._$ES)===null||y===void 0||y.forEach(w=>{var $;return($=w.hostUpdated)===null||$===void 0?void 0:$.call(w)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(_)),this.updated(_)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(_){return!0}update(_){this._$EC!==void 0&&(this._$EC.forEach((y,w)=>this._$EO(w,this[w],y)),this._$EC=void 0),this._$Ek()}updated(_){}firstUpdated(_){}};u$1[d]=!0,u$1.elementProperties=new Map,u$1.elementStyles=[],u$1.shadowRootOptions={mode:"open"},o$7?.({ReactiveElement:u$1}),((s$3=e$3.reactiveElementVersions)!==null&&s$3!==void 0?s$3:e$3.reactiveElementVersions=[]).push("1.6.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var l$3,o$6;let s$2=class extends u$1{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var _,y;const w=super.createRenderRoot();return(_=(y=this.renderOptions).renderBefore)!==null&&_!==void 0||(y.renderBefore=w.firstChild),w}update(_){const y=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(_),this._$Do=D(y,this.renderRoot,this.renderOptions)}connectedCallback(){var _;super.connectedCallback(),(_=this._$Do)===null||_===void 0||_.setConnected(!0)}disconnectedCallback(){var _;super.disconnectedCallback(),(_=this._$Do)===null||_===void 0||_.setConnected(!1)}render(){return T}};s$2.finalized=!0,s$2._$litElement$=!0,(l$3=globalThis.litElementHydrateSupport)===null||l$3===void 0||l$3.call(globalThis,{LitElement:s$2});const n$6=globalThis.litElementPolyfillSupport;n$6?.({LitElement:s$2});((o$6=globalThis.litElementVersions)!==null&&o$6!==void 0?o$6:globalThis.litElementVersions=[]).push("3.3.3");class ShadowlessElement extends s$2{static finalizeStyles(_){let y=super.finalizeStyles(_);const w=document.head;return this.disableShadowRoot&&(y.forEach($=>{if($ instanceof o$8){const B=document.createElement("style");B.textContent=$.cssText,w.appendChild(B)}else console.error("unreachable")}),y=[]),y}createRenderRoot(){return this.constructor.disableShadowRoot?this:super.createRenderRoot()}}ShadowlessElement.disableShadowRoot=!0;var __decorate$2E=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class BlockElement extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.content=null,this.selected=null,this.handleEvent=(_,y,w)=>{const $={flavour:w?.global?void 0:w?.flavour?this.model.flavour:void 0,path:w?.global||w?.flavour?void 0:this.path};this._disposables.add(this.root.uiEventDispatcher.add(_,y,$))},this.renderModel=_=>this.root.renderModel(_)}get parentPath(){return this.path.slice(0,-1)}get parentBlockElement(){const _=this.parentElement;assertExists(_);const y=this.root.viewStore.getNodeView(_);return assertExists(y),y.view}get childBlockElements(){return this.root.viewStore.getChildren(this.path).filter(y=>y.type==="block").map(y=>y.view)}get flavour(){return this.model.flavour}get widgetElements(){return Object.keys(this.widgets).reduce((_,y)=>({..._,[y]:this.root.viewStore.viewFromPath("widget",[...this.path,y])}),{})}get service(){return this.root.blockStore.specStore.getService(this.model.flavour)}get selection(){return this.root.selectionManager}get viewStore(){return this.root.viewStore}bindHotKey(_,y){const w={flavour:y?.global?void 0:y?.flavour?this.model.flavour:void 0,path:y?.global||y?.flavour?void 0:this.path};this._disposables.add(this.root.uiEventDispatcher.bindHotkey(_,w))}connectedCallback(){super.connectedCallback(),this.path=this.root.viewStore.calculatePath(this),this._disposables.add(this.model.propsUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.model.childrenUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(this.root.selectionManager.slots.changed.on(_=>{const y=_.find(w=>PathFinder.equals(w.path,this.path));if(!y){this.selected=null;return}this.selected=y}))}disconnectedCallback(){super.disconnectedCallback()}render(){return null}}__decorate$2E([n$a({attribute:!1})],BlockElement.prototype,"root",void 0);__decorate$2E([n$a({attribute:!1})],BlockElement.prototype,"model",void 0);__decorate$2E([n$a({attribute:!1})],BlockElement.prototype,"content",void 0);__decorate$2E([n$a({attribute:!1,hasChanged(k,_){return!k||!_?k!==_:!Object.keys(k).length&&!Object.keys(_).length?!1:k!==_}})],BlockElement.prototype,"widgets",void 0);__decorate$2E([n$a({attribute:!1})],BlockElement.prototype,"page",void 0);__decorate$2E([t$2({hasChanged(k,_){return!k||!_?k!==_:!k?.equals(_)}})],BlockElement.prototype,"selected",void 0);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const u=(k,_,y)=>{const w=new Map;for(let $=_;$<=y;$++)w.set(k[$],$);return w},c$1=e$8(class extends i$8{constructor(k){if(super(k),k.type!==t$3.CHILD)throw Error("repeat() can only be used in text expressions")}ct(k,_,y){let w;y===void 0?y=_:_!==void 0&&(w=_);const $=[],B=[];let R=0;for(const H of k)$[R]=w?w(H,R):R,B[R]=y(H,R),R++;return{values:B,keys:$}}render(k,_,y){return this.ct(k,_,y).values}update(k,[_,y,w]){var $;const B=m(k),{values:R,keys:H}=this.ct(_,y,w);if(!Array.isArray(B))return this.ut=H,R;const j=($=this.ut)!==null&&$!==void 0?$:this.ut=[],q=[];let X,ee,te=0,ne=B.length-1,oe=0,ie=R.length-1;for(;te<=ne&&oe<=ie;)if(B[te]===null)te++;else if(B[ne]===null)ne--;else if(j[te]===H[oe])q[oe]=f(B[te],R[oe]),te++,oe++;else if(j[ne]===H[ie])q[ie]=f(B[ne],R[ie]),ne--,ie--;else if(j[te]===H[ie])q[ie]=f(B[te],R[ie]),c$3(k,q[ie+1],B[te]),te++,ie--;else if(j[ne]===H[oe])q[oe]=f(B[ne],R[oe]),c$3(k,B[te],B[ne]),ne--,oe++;else if(X===void 0&&(X=u(H,oe,ie),ee=u(j,te,ne)),X.has(j[te]))if(X.has(j[ne])){const ae=ee.get(H[oe]),re=ae!==void 0?B[ae]:null;if(re===null){const se=c$3(k,B[te]);f(se,R[oe]),q[oe]=se}else q[oe]=f(re,R[oe]),c$3(k,B[te],re),B[ae]=null;oe++}else p$1(B[ne]),ne--;else p$1(B[te]),te++;for(;oe<=ie;){const ae=c$3(k,q[ie+1]);f(ae,R[oe]),q[oe++]=ae}for(;te<=ne;){const ae=B[te++];ae!==null&&p$1(ae)}return this.ut=H,a$2(k,q),T}});/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$2=Symbol.for(""),l$2=k=>{if(k?.r===e$2)return k?._$litStatic$},o$5=k=>({_$litStatic$:k,r:e$2}),i$4=(k,..._)=>({_$litStatic$:_.reduce((y,w,$)=>y+(B=>{if(B._$litStatic$!==void 0)return B._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${B}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(w)+k[$+1],k[0]),r:e$2}),s$1=new Map,a=k=>(_,...y)=>{const w=y.length;let $,B;const R=[],H=[];let j,q=0,X=!1;for(;q<w;){for(j=_[q];q<w&&(B=y[q],($=l$2(B))!==void 0);)j+=$+_[++q],X=!0;q!==w&&H.push(B),R.push(j),q++}if(q===w&&R.push(_[w]),X){const ee=R.join("$$lit$$");(_=s$1.get(ee))===void 0&&(R.raw=R,s$1.set(ee,_=R)),y=H}return k(_,...y)},n$5=a(x$1),workspaceMigrations=[{desc:"add pageVersion in meta",condition:k=>k.getMap("meta").get("workspaceVersion")<2,migrate:k=>{const _=k.getMap("meta");_.set("pageVersion",1),_.set("workspaceVersion",2)}}],createMemoryStorage=()=>{const k=new Map;return{crud:{get:async _=>k.get(_)??null,set:async(_,y)=>(k.set(_,y),_),delete:async _=>{k.delete(_)},list:async()=>Array.from(k.keys())}}};var util;(function(k){k.assertEqual=$=>$;function _($){}k.assertIs=_;function y($){throw new Error}k.assertNever=y,k.arrayToEnum=$=>{const B={};for(const R of $)B[R]=R;return B},k.getValidEnumValues=$=>{const B=k.objectKeys($).filter(H=>typeof $[$[H]]!="number"),R={};for(const H of B)R[H]=$[H];return k.objectValues(R)},k.objectValues=$=>k.objectKeys($).map(function(B){return $[B]}),k.objectKeys=typeof Object.keys=="function"?$=>Object.keys($):$=>{const B=[];for(const R in $)Object.prototype.hasOwnProperty.call($,R)&&B.push(R);return B},k.find=($,B)=>{for(const R of $)if(B(R))return R},k.isInteger=typeof Number.isInteger=="function"?$=>Number.isInteger($):$=>typeof $=="number"&&isFinite($)&&Math.floor($)===$;function w($,B=" | "){return $.map(R=>typeof R=="string"?`'${R}'`:R).join(B)}k.joinValues=w,k.jsonStringifyReplacer=($,B)=>typeof B=="bigint"?B.toString():B})(util||(util={}));var objectUtil;(function(k){k.mergeShapes=(_,y)=>({..._,...y})})(objectUtil||(objectUtil={}));const ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=k=>{switch(typeof k){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(k)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(k)?ZodParsedType.array:k===null?ZodParsedType.null:k.then&&typeof k.then=="function"&&k.catch&&typeof k.catch=="function"?ZodParsedType.promise:typeof Map<"u"&&k instanceof Map?ZodParsedType.map:typeof Set<"u"&&k instanceof Set?ZodParsedType.set:typeof Date<"u"&&k instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=k=>JSON.stringify(k,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(_){super(),this.issues=[],this.addIssue=w=>{this.issues=[...this.issues,w]},this.addIssues=(w=[])=>{this.issues=[...this.issues,...w]};const y=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,y):this.__proto__=y,this.name="ZodError",this.issues=_}get errors(){return this.issues}format(_){const y=_||function(B){return B.message},w={_errors:[]},$=B=>{for(const R of B.issues)if(R.code==="invalid_union")R.unionErrors.map($);else if(R.code==="invalid_return_type")$(R.returnTypeError);else if(R.code==="invalid_arguments")$(R.argumentsError);else if(R.path.length===0)w._errors.push(y(R));else{let H=w,j=0;for(;j<R.path.length;){const q=R.path[j];j===R.path.length-1?(H[q]=H[q]||{_errors:[]},H[q]._errors.push(y(R))):H[q]=H[q]||{_errors:[]},H=H[q],j++}}};return $(this),w}toString(){return this.message}get message(){return JSON.stringify(this.issues,util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(_=y=>y.message){const y={},w=[];for(const $ of this.issues)$.path.length>0?(y[$.path[0]]=y[$.path[0]]||[],y[$.path[0]].push(_($))):w.push(_($));return{formErrors:w,fieldErrors:y}}get formErrors(){return this.flatten()}}ZodError.create=k=>new ZodError(k);const errorMap=(k,_)=>{let y;switch(k.code){case ZodIssueCode.invalid_type:k.received===ZodParsedType.undefined?y="Required":y=`Expected ${k.expected}, received ${k.received}`;break;case ZodIssueCode.invalid_literal:y=`Invalid literal value, expected ${JSON.stringify(k.expected,util.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:y=`Unrecognized key(s) in object: ${util.joinValues(k.keys,", ")}`;break;case ZodIssueCode.invalid_union:y="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:y=`Invalid discriminator value. Expected ${util.joinValues(k.options)}`;break;case ZodIssueCode.invalid_enum_value:y=`Invalid enum value. Expected ${util.joinValues(k.options)}, received '${k.received}'`;break;case ZodIssueCode.invalid_arguments:y="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:y="Invalid function return type";break;case ZodIssueCode.invalid_date:y="Invalid date";break;case ZodIssueCode.invalid_string:typeof k.validation=="object"?"includes"in k.validation?(y=`Invalid input: must include "${k.validation.includes}"`,typeof k.validation.position=="number"&&(y=`${y} at one or more positions greater than or equal to ${k.validation.position}`)):"startsWith"in k.validation?y=`Invalid input: must start with "${k.validation.startsWith}"`:"endsWith"in k.validation?y=`Invalid input: must end with "${k.validation.endsWith}"`:util.assertNever(k.validation):k.validation!=="regex"?y=`Invalid ${k.validation}`:y="Invalid";break;case ZodIssueCode.too_small:k.type==="array"?y=`Array must contain ${k.exact?"exactly":k.inclusive?"at least":"more than"} ${k.minimum} element(s)`:k.type==="string"?y=`String must contain ${k.exact?"exactly":k.inclusive?"at least":"over"} ${k.minimum} character(s)`:k.type==="number"?y=`Number must be ${k.exact?"exactly equal to ":k.inclusive?"greater than or equal to ":"greater than "}${k.minimum}`:k.type==="date"?y=`Date must be ${k.exact?"exactly equal to ":k.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(k.minimum))}`:y="Invalid input";break;case ZodIssueCode.too_big:k.type==="array"?y=`Array must contain ${k.exact?"exactly":k.inclusive?"at most":"less than"} ${k.maximum} element(s)`:k.type==="string"?y=`String must contain ${k.exact?"exactly":k.inclusive?"at most":"under"} ${k.maximum} character(s)`:k.type==="number"?y=`Number must be ${k.exact?"exactly":k.inclusive?"less than or equal to":"less than"} ${k.maximum}`:k.type==="bigint"?y=`BigInt must be ${k.exact?"exactly":k.inclusive?"less than or equal to":"less than"} ${k.maximum}`:k.type==="date"?y=`Date must be ${k.exact?"exactly":k.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(k.maximum))}`:y="Invalid input";break;case ZodIssueCode.custom:y="Invalid input";break;case ZodIssueCode.invalid_intersection_types:y="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:y=`Number must be a multiple of ${k.multipleOf}`;break;case ZodIssueCode.not_finite:y="Number must be finite";break;default:y=_.defaultError,util.assertNever(k)}return{message:y}};let overrideErrorMap=errorMap;function setErrorMap(k){overrideErrorMap=k}function getErrorMap(){return overrideErrorMap}const makeIssue=k=>{const{data:_,path:y,errorMaps:w,issueData:$}=k,B=[...y,...$.path||[]],R={...$,path:B};let H="";const j=w.filter(q=>!!q).slice().reverse();for(const q of j)H=q(R,{data:_,defaultError:H}).message;return{...$,path:B,message:$.message||H}},EMPTY_PATH=[];function addIssueToContext(k,_){const y=makeIssue({issueData:_,data:k.data,path:k.path,errorMaps:[k.common.contextualErrorMap,k.schemaErrorMap,getErrorMap(),errorMap].filter(w=>!!w)});k.common.issues.push(y)}class ParseStatus{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(_,y){const w=[];for(const $ of y){if($.status==="aborted")return INVALID;$.status==="dirty"&&_.dirty(),w.push($.value)}return{status:_.value,value:w}}static async mergeObjectAsync(_,y){const w=[];for(const $ of y)w.push({key:await $.key,value:await $.value});return ParseStatus.mergeObjectSync(_,w)}static mergeObjectSync(_,y){const w={};for(const $ of y){const{key:B,value:R}=$;if(B.status==="aborted"||R.status==="aborted")return INVALID;B.status==="dirty"&&_.dirty(),R.status==="dirty"&&_.dirty(),B.value!=="__proto__"&&(typeof R.value<"u"||$.alwaysSet)&&(w[B.value]=R.value)}return{status:_.value,value:w}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=k=>({status:"dirty",value:k}),OK=k=>({status:"valid",value:k}),isAborted=k=>k.status==="aborted",isDirty=k=>k.status==="dirty",isValid$1=k=>k.status==="valid",isAsync=k=>typeof Promise<"u"&&k instanceof Promise;var errorUtil;(function(k){k.errToObj=_=>typeof _=="string"?{message:_}:_||{},k.toString=_=>typeof _=="string"?_:_?.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(_,y,w,$){this._cachedPath=[],this.parent=_,this.data=y,this._path=w,this._key=$}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(k,_)=>{if(isValid$1(_))return{success:!0,data:_.value};if(!k.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const y=new ZodError(k.common.issues);return this._error=y,this._error}}};function processCreateParams(k){if(!k)return{};const{errorMap:_,invalid_type_error:y,required_error:w,description:$}=k;if(_&&(y||w))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return _?{errorMap:_,description:$}:{errorMap:(R,H)=>R.code!=="invalid_type"?{message:H.defaultError}:typeof H.data>"u"?{message:w??H.defaultError}:{message:y??H.defaultError},description:$}}class ZodType{constructor(_){this.spa=this.safeParseAsync,this._def=_,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(_){return getParsedType(_.data)}_getOrReturnCtx(_,y){return y||{common:_.parent.common,data:_.data,parsedType:getParsedType(_.data),schemaErrorMap:this._def.errorMap,path:_.path,parent:_.parent}}_processInputParams(_){return{status:new ParseStatus,ctx:{common:_.parent.common,data:_.data,parsedType:getParsedType(_.data),schemaErrorMap:this._def.errorMap,path:_.path,parent:_.parent}}}_parseSync(_){const y=this._parse(_);if(isAsync(y))throw new Error("Synchronous parse encountered promise.");return y}_parseAsync(_){const y=this._parse(_);return Promise.resolve(y)}parse(_,y){const w=this.safeParse(_,y);if(w.success)return w.data;throw w.error}safeParse(_,y){var w;const $={common:{issues:[],async:(w=y?.async)!==null&&w!==void 0?w:!1,contextualErrorMap:y?.errorMap},path:y?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:_,parsedType:getParsedType(_)},B=this._parseSync({data:_,path:$.path,parent:$});return handleResult($,B)}async parseAsync(_,y){const w=await this.safeParseAsync(_,y);if(w.success)return w.data;throw w.error}async safeParseAsync(_,y){const w={common:{issues:[],contextualErrorMap:y?.errorMap,async:!0},path:y?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:_,parsedType:getParsedType(_)},$=this._parse({data:_,path:w.path,parent:w}),B=await(isAsync($)?$:Promise.resolve($));return handleResult(w,B)}refine(_,y){const w=$=>typeof y=="string"||typeof y>"u"?{message:y}:typeof y=="function"?y($):y;return this._refinement(($,B)=>{const R=_($),H=()=>B.addIssue({code:ZodIssueCode.custom,...w($)});return typeof Promise<"u"&&R instanceof Promise?R.then(j=>j?!0:(H(),!1)):R?!0:(H(),!1)})}refinement(_,y){return this._refinement((w,$)=>_(w)?!0:($.addIssue(typeof y=="function"?y(w,$):y),!1))}_refinement(_){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:_}})}superRefine(_){return this._refinement(_)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(_){return ZodUnion.create([this,_],this._def)}and(_){return ZodIntersection.create(this,_,this._def)}transform(_){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:_}})}default(_){const y=typeof _=="function"?_:()=>_;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:y,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(_){const y=typeof _=="function"?_:()=>_;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:y,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(_){const y=this.constructor;return new y({...this._def,description:_})}pipe(_){return ZodPipeline.create(this,_)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[a-z][a-z0-9]*$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let emojiRegex;const ipv4Regex=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,datetimeRegex=k=>k.precision?k.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${k.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${k.precision}}Z$`):k.precision===0?k.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):k.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function isValidIP(k,_){return!!((_==="v4"||!_)&&ipv4Regex.test(k)||(_==="v6"||!_)&&ipv6Regex.test(k))}class ZodString extends ZodType{_parse(_){if(this._def.coerce&&(_.data=String(_.data)),this._getType(_)!==ZodParsedType.string){const B=this._getOrReturnCtx(_);return addIssueToContext(B,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:B.parsedType}),INVALID}const w=new ParseStatus;let $;for(const B of this._def.checks)if(B.kind==="min")_.data.length<B.value&&($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.too_small,minimum:B.value,type:"string",inclusive:!0,exact:!1,message:B.message}),w.dirty());else if(B.kind==="max")_.data.length>B.value&&($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.too_big,maximum:B.value,type:"string",inclusive:!0,exact:!1,message:B.message}),w.dirty());else if(B.kind==="length"){const R=_.data.length>B.value,H=_.data.length<B.value;(R||H)&&($=this._getOrReturnCtx(_,$),R?addIssueToContext($,{code:ZodIssueCode.too_big,maximum:B.value,type:"string",inclusive:!0,exact:!0,message:B.message}):H&&addIssueToContext($,{code:ZodIssueCode.too_small,minimum:B.value,type:"string",inclusive:!0,exact:!0,message:B.message}),w.dirty())}else if(B.kind==="email")emailRegex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"email",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="emoji")emojiRegex||(emojiRegex=new RegExp(_emojiRegex,"u")),emojiRegex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"emoji",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="uuid")uuidRegex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"uuid",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="cuid")cuidRegex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"cuid",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="cuid2")cuid2Regex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="ulid")ulidRegex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"ulid",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty());else if(B.kind==="url")try{new URL(_.data)}catch{$=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"url",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty()}else B.kind==="regex"?(B.regex.lastIndex=0,B.regex.test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"regex",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty())):B.kind==="trim"?_.data=_.data.trim():B.kind==="includes"?_.data.includes(B.value,B.position)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.invalid_string,validation:{includes:B.value,position:B.position},message:B.message}),w.dirty()):B.kind==="toLowerCase"?_.data=_.data.toLowerCase():B.kind==="toUpperCase"?_.data=_.data.toUpperCase():B.kind==="startsWith"?_.data.startsWith(B.value)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.invalid_string,validation:{startsWith:B.value},message:B.message}),w.dirty()):B.kind==="endsWith"?_.data.endsWith(B.value)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.invalid_string,validation:{endsWith:B.value},message:B.message}),w.dirty()):B.kind==="datetime"?datetimeRegex(B).test(_.data)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.invalid_string,validation:"datetime",message:B.message}),w.dirty()):B.kind==="ip"?isValidIP(_.data,B.version)||($=this._getOrReturnCtx(_,$),addIssueToContext($,{validation:"ip",code:ZodIssueCode.invalid_string,message:B.message}),w.dirty()):util.assertNever(B);return{status:w.value,value:_.data}}_regex(_,y,w){return this.refinement($=>_.test($),{validation:y,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(w)})}_addCheck(_){return new ZodString({...this._def,checks:[...this._def.checks,_]})}email(_){return this._addCheck({kind:"email",...errorUtil.errToObj(_)})}url(_){return this._addCheck({kind:"url",...errorUtil.errToObj(_)})}emoji(_){return this._addCheck({kind:"emoji",...errorUtil.errToObj(_)})}uuid(_){return this._addCheck({kind:"uuid",...errorUtil.errToObj(_)})}cuid(_){return this._addCheck({kind:"cuid",...errorUtil.errToObj(_)})}cuid2(_){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(_)})}ulid(_){return this._addCheck({kind:"ulid",...errorUtil.errToObj(_)})}ip(_){return this._addCheck({kind:"ip",...errorUtil.errToObj(_)})}datetime(_){var y;return typeof _=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:_}):this._addCheck({kind:"datetime",precision:typeof _?.precision>"u"?null:_?.precision,offset:(y=_?.offset)!==null&&y!==void 0?y:!1,...errorUtil.errToObj(_?.message)})}regex(_,y){return this._addCheck({kind:"regex",regex:_,...errorUtil.errToObj(y)})}includes(_,y){return this._addCheck({kind:"includes",value:_,position:y?.position,...errorUtil.errToObj(y?.message)})}startsWith(_,y){return this._addCheck({kind:"startsWith",value:_,...errorUtil.errToObj(y)})}endsWith(_,y){return this._addCheck({kind:"endsWith",value:_,...errorUtil.errToObj(y)})}min(_,y){return this._addCheck({kind:"min",value:_,...errorUtil.errToObj(y)})}max(_,y){return this._addCheck({kind:"max",value:_,...errorUtil.errToObj(y)})}length(_,y){return this._addCheck({kind:"length",value:_,...errorUtil.errToObj(y)})}nonempty(_){return this.min(1,errorUtil.errToObj(_))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(_=>_.kind==="datetime")}get isEmail(){return!!this._def.checks.find(_=>_.kind==="email")}get isURL(){return!!this._def.checks.find(_=>_.kind==="url")}get isEmoji(){return!!this._def.checks.find(_=>_.kind==="emoji")}get isUUID(){return!!this._def.checks.find(_=>_.kind==="uuid")}get isCUID(){return!!this._def.checks.find(_=>_.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(_=>_.kind==="cuid2")}get isULID(){return!!this._def.checks.find(_=>_.kind==="ulid")}get isIP(){return!!this._def.checks.find(_=>_.kind==="ip")}get minLength(){let _=null;for(const y of this._def.checks)y.kind==="min"&&(_===null||y.value>_)&&(_=y.value);return _}get maxLength(){let _=null;for(const y of this._def.checks)y.kind==="max"&&(_===null||y.value<_)&&(_=y.value);return _}}ZodString.create=k=>{var _;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:(_=k?.coerce)!==null&&_!==void 0?_:!1,...processCreateParams(k)})};function floatSafeRemainder(k,_){const y=(k.toString().split(".")[1]||"").length,w=(_.toString().split(".")[1]||"").length,$=y>w?y:w,B=parseInt(k.toFixed($).replace(".","")),R=parseInt(_.toFixed($).replace(".",""));return B%R/Math.pow(10,$)}class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(_){if(this._def.coerce&&(_.data=Number(_.data)),this._getType(_)!==ZodParsedType.number){const B=this._getOrReturnCtx(_);return addIssueToContext(B,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:B.parsedType}),INVALID}let w;const $=new ParseStatus;for(const B of this._def.checks)B.kind==="int"?util.isInteger(_.data)||(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:B.message}),$.dirty()):B.kind==="min"?(B.inclusive?_.data<B.value:_.data<=B.value)&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:B.value,type:"number",inclusive:B.inclusive,exact:!1,message:B.message}),$.dirty()):B.kind==="max"?(B.inclusive?_.data>B.value:_.data>=B.value)&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:B.value,type:"number",inclusive:B.inclusive,exact:!1,message:B.message}),$.dirty()):B.kind==="multipleOf"?floatSafeRemainder(_.data,B.value)!==0&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.not_multiple_of,multipleOf:B.value,message:B.message}),$.dirty()):B.kind==="finite"?Number.isFinite(_.data)||(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.not_finite,message:B.message}),$.dirty()):util.assertNever(B);return{status:$.value,value:_.data}}gte(_,y){return this.setLimit("min",_,!0,errorUtil.toString(y))}gt(_,y){return this.setLimit("min",_,!1,errorUtil.toString(y))}lte(_,y){return this.setLimit("max",_,!0,errorUtil.toString(y))}lt(_,y){return this.setLimit("max",_,!1,errorUtil.toString(y))}setLimit(_,y,w,$){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:_,value:y,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(_){return new ZodNumber({...this._def,checks:[...this._def.checks,_]})}int(_){return this._addCheck({kind:"int",message:errorUtil.toString(_)})}positive(_){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(_)})}negative(_){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(_)})}nonpositive(_){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(_)})}nonnegative(_){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(_)})}multipleOf(_,y){return this._addCheck({kind:"multipleOf",value:_,message:errorUtil.toString(y)})}finite(_){return this._addCheck({kind:"finite",message:errorUtil.toString(_)})}safe(_){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(_)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(_)})}get minValue(){let _=null;for(const y of this._def.checks)y.kind==="min"&&(_===null||y.value>_)&&(_=y.value);return _}get maxValue(){let _=null;for(const y of this._def.checks)y.kind==="max"&&(_===null||y.value<_)&&(_=y.value);return _}get isInt(){return!!this._def.checks.find(_=>_.kind==="int"||_.kind==="multipleOf"&&util.isInteger(_.value))}get isFinite(){let _=null,y=null;for(const w of this._def.checks){if(w.kind==="finite"||w.kind==="int"||w.kind==="multipleOf")return!0;w.kind==="min"?(y===null||w.value>y)&&(y=w.value):w.kind==="max"&&(_===null||w.value<_)&&(_=w.value)}return Number.isFinite(y)&&Number.isFinite(_)}}ZodNumber.create=k=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:k?.coerce||!1,...processCreateParams(k)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(_){if(this._def.coerce&&(_.data=BigInt(_.data)),this._getType(_)!==ZodParsedType.bigint){const B=this._getOrReturnCtx(_);return addIssueToContext(B,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:B.parsedType}),INVALID}let w;const $=new ParseStatus;for(const B of this._def.checks)B.kind==="min"?(B.inclusive?_.data<B.value:_.data<=B.value)&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.too_small,type:"bigint",minimum:B.value,inclusive:B.inclusive,message:B.message}),$.dirty()):B.kind==="max"?(B.inclusive?_.data>B.value:_.data>=B.value)&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.too_big,type:"bigint",maximum:B.value,inclusive:B.inclusive,message:B.message}),$.dirty()):B.kind==="multipleOf"?_.data%B.value!==BigInt(0)&&(w=this._getOrReturnCtx(_,w),addIssueToContext(w,{code:ZodIssueCode.not_multiple_of,multipleOf:B.value,message:B.message}),$.dirty()):util.assertNever(B);return{status:$.value,value:_.data}}gte(_,y){return this.setLimit("min",_,!0,errorUtil.toString(y))}gt(_,y){return this.setLimit("min",_,!1,errorUtil.toString(y))}lte(_,y){return this.setLimit("max",_,!0,errorUtil.toString(y))}lt(_,y){return this.setLimit("max",_,!1,errorUtil.toString(y))}setLimit(_,y,w,$){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:_,value:y,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(_){return new ZodBigInt({...this._def,checks:[...this._def.checks,_]})}positive(_){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(_)})}negative(_){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(_)})}nonpositive(_){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(_)})}nonnegative(_){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(_)})}multipleOf(_,y){return this._addCheck({kind:"multipleOf",value:_,message:errorUtil.toString(y)})}get minValue(){let _=null;for(const y of this._def.checks)y.kind==="min"&&(_===null||y.value>_)&&(_=y.value);return _}get maxValue(){let _=null;for(const y of this._def.checks)y.kind==="max"&&(_===null||y.value<_)&&(_=y.value);return _}}ZodBigInt.create=k=>{var _;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:(_=k?.coerce)!==null&&_!==void 0?_:!1,...processCreateParams(k)})};class ZodBoolean extends ZodType{_parse(_){if(this._def.coerce&&(_.data=!!_.data),this._getType(_)!==ZodParsedType.boolean){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:w.parsedType}),INVALID}return OK(_.data)}}ZodBoolean.create=k=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:k?.coerce||!1,...processCreateParams(k)});class ZodDate extends ZodType{_parse(_){if(this._def.coerce&&(_.data=new Date(_.data)),this._getType(_)!==ZodParsedType.date){const B=this._getOrReturnCtx(_);return addIssueToContext(B,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:B.parsedType}),INVALID}if(isNaN(_.data.getTime())){const B=this._getOrReturnCtx(_);return addIssueToContext(B,{code:ZodIssueCode.invalid_date}),INVALID}const w=new ParseStatus;let $;for(const B of this._def.checks)B.kind==="min"?_.data.getTime()<B.value&&($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.too_small,message:B.message,inclusive:!0,exact:!1,minimum:B.value,type:"date"}),w.dirty()):B.kind==="max"?_.data.getTime()>B.value&&($=this._getOrReturnCtx(_,$),addIssueToContext($,{code:ZodIssueCode.too_big,message:B.message,inclusive:!0,exact:!1,maximum:B.value,type:"date"}),w.dirty()):util.assertNever(B);return{status:w.value,value:new Date(_.data.getTime())}}_addCheck(_){return new ZodDate({...this._def,checks:[...this._def.checks,_]})}min(_,y){return this._addCheck({kind:"min",value:_.getTime(),message:errorUtil.toString(y)})}max(_,y){return this._addCheck({kind:"max",value:_.getTime(),message:errorUtil.toString(y)})}get minDate(){let _=null;for(const y of this._def.checks)y.kind==="min"&&(_===null||y.value>_)&&(_=y.value);return _!=null?new Date(_):null}get maxDate(){let _=null;for(const y of this._def.checks)y.kind==="max"&&(_===null||y.value<_)&&(_=y.value);return _!=null?new Date(_):null}}ZodDate.create=k=>new ZodDate({checks:[],coerce:k?.coerce||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(k)});class ZodSymbol extends ZodType{_parse(_){if(this._getType(_)!==ZodParsedType.symbol){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:w.parsedType}),INVALID}return OK(_.data)}}ZodSymbol.create=k=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(k)});class ZodUndefined extends ZodType{_parse(_){if(this._getType(_)!==ZodParsedType.undefined){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:w.parsedType}),INVALID}return OK(_.data)}}ZodUndefined.create=k=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(k)});class ZodNull extends ZodType{_parse(_){if(this._getType(_)!==ZodParsedType.null){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:w.parsedType}),INVALID}return OK(_.data)}}ZodNull.create=k=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(k)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(_){return OK(_.data)}}ZodAny.create=k=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(k)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(_){return OK(_.data)}}ZodUnknown.create=k=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(k)});class ZodNever extends ZodType{_parse(_){const y=this._getOrReturnCtx(_);return addIssueToContext(y,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:y.parsedType}),INVALID}}ZodNever.create=k=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(k)});class ZodVoid extends ZodType{_parse(_){if(this._getType(_)!==ZodParsedType.undefined){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:w.parsedType}),INVALID}return OK(_.data)}}ZodVoid.create=k=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(k)});class ZodArray extends ZodType{_parse(_){const{ctx:y,status:w}=this._processInputParams(_),$=this._def;if(y.parsedType!==ZodParsedType.array)return addIssueToContext(y,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:y.parsedType}),INVALID;if($.exactLength!==null){const R=y.data.length>$.exactLength.value,H=y.data.length<$.exactLength.value;(R||H)&&(addIssueToContext(y,{code:R?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:H?$.exactLength.value:void 0,maximum:R?$.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:$.exactLength.message}),w.dirty())}if($.minLength!==null&&y.data.length<$.minLength.value&&(addIssueToContext(y,{code:ZodIssueCode.too_small,minimum:$.minLength.value,type:"array",inclusive:!0,exact:!1,message:$.minLength.message}),w.dirty()),$.maxLength!==null&&y.data.length>$.maxLength.value&&(addIssueToContext(y,{code:ZodIssueCode.too_big,maximum:$.maxLength.value,type:"array",inclusive:!0,exact:!1,message:$.maxLength.message}),w.dirty()),y.common.async)return Promise.all([...y.data].map((R,H)=>$.type._parseAsync(new ParseInputLazyPath(y,R,y.path,H)))).then(R=>ParseStatus.mergeArray(w,R));const B=[...y.data].map((R,H)=>$.type._parseSync(new ParseInputLazyPath(y,R,y.path,H)));return ParseStatus.mergeArray(w,B)}get element(){return this._def.type}min(_,y){return new ZodArray({...this._def,minLength:{value:_,message:errorUtil.toString(y)}})}max(_,y){return new ZodArray({...this._def,maxLength:{value:_,message:errorUtil.toString(y)}})}length(_,y){return new ZodArray({...this._def,exactLength:{value:_,message:errorUtil.toString(y)}})}nonempty(_){return this.min(1,_)}}ZodArray.create=(k,_)=>new ZodArray({type:k,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(_)});function deepPartialify(k){if(k instanceof ZodObject){const _={};for(const y in k.shape){const w=k.shape[y];_[y]=ZodOptional.create(deepPartialify(w))}return new ZodObject({...k._def,shape:()=>_})}else return k instanceof ZodArray?new ZodArray({...k._def,type:deepPartialify(k.element)}):k instanceof ZodOptional?ZodOptional.create(deepPartialify(k.unwrap())):k instanceof ZodNullable?ZodNullable.create(deepPartialify(k.unwrap())):k instanceof ZodTuple?ZodTuple.create(k.items.map(_=>deepPartialify(_))):k}class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const _=this._def.shape(),y=util.objectKeys(_);return this._cached={shape:_,keys:y}}_parse(_){if(this._getType(_)!==ZodParsedType.object){const q=this._getOrReturnCtx(_);return addIssueToContext(q,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:q.parsedType}),INVALID}const{status:w,ctx:$}=this._processInputParams(_),{shape:B,keys:R}=this._getCached(),H=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip"))for(const q in $.data)R.includes(q)||H.push(q);const j=[];for(const q of R){const X=B[q],ee=$.data[q];j.push({key:{status:"valid",value:q},value:X._parse(new ParseInputLazyPath($,ee,$.path,q)),alwaysSet:q in $.data})}if(this._def.catchall instanceof ZodNever){const q=this._def.unknownKeys;if(q==="passthrough")for(const X of H)j.push({key:{status:"valid",value:X},value:{status:"valid",value:$.data[X]}});else if(q==="strict")H.length>0&&(addIssueToContext($,{code:ZodIssueCode.unrecognized_keys,keys:H}),w.dirty());else if(q!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const q=this._def.catchall;for(const X of H){const ee=$.data[X];j.push({key:{status:"valid",value:X},value:q._parse(new ParseInputLazyPath($,ee,$.path,X)),alwaysSet:X in $.data})}}return $.common.async?Promise.resolve().then(async()=>{const q=[];for(const X of j){const ee=await X.key;q.push({key:ee,value:await X.value,alwaysSet:X.alwaysSet})}return q}).then(q=>ParseStatus.mergeObjectSync(w,q)):ParseStatus.mergeObjectSync(w,j)}get shape(){return this._def.shape()}strict(_){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",..._!==void 0?{errorMap:(y,w)=>{var $,B,R,H;const j=(R=(B=($=this._def).errorMap)===null||B===void 0?void 0:B.call($,y,w).message)!==null&&R!==void 0?R:w.defaultError;return y.code==="unrecognized_keys"?{message:(H=errorUtil.errToObj(_).message)!==null&&H!==void 0?H:j}:{message:j}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(_){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),..._})})}merge(_){return new ZodObject({unknownKeys:_._def.unknownKeys,catchall:_._def.catchall,shape:()=>({...this._def.shape(),..._._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(_,y){return this.augment({[_]:y})}catchall(_){return new ZodObject({...this._def,catchall:_})}pick(_){const y={};return util.objectKeys(_).forEach(w=>{_[w]&&this.shape[w]&&(y[w]=this.shape[w])}),new ZodObject({...this._def,shape:()=>y})}omit(_){const y={};return util.objectKeys(this.shape).forEach(w=>{_[w]||(y[w]=this.shape[w])}),new ZodObject({...this._def,shape:()=>y})}deepPartial(){return deepPartialify(this)}partial(_){const y={};return util.objectKeys(this.shape).forEach(w=>{const $=this.shape[w];_&&!_[w]?y[w]=$:y[w]=$.optional()}),new ZodObject({...this._def,shape:()=>y})}required(_){const y={};return util.objectKeys(this.shape).forEach(w=>{if(_&&!_[w])y[w]=this.shape[w];else{let B=this.shape[w];for(;B instanceof ZodOptional;)B=B._def.innerType;y[w]=B}}),new ZodObject({...this._def,shape:()=>y})}keyof(){return createZodEnum(util.objectKeys(this.shape))}}ZodObject.create=(k,_)=>new ZodObject({shape:()=>k,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(_)});ZodObject.strictCreate=(k,_)=>new ZodObject({shape:()=>k,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(_)});ZodObject.lazycreate=(k,_)=>new ZodObject({shape:k,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(_)});class ZodUnion extends ZodType{_parse(_){const{ctx:y}=this._processInputParams(_),w=this._def.options;function $(B){for(const H of B)if(H.result.status==="valid")return H.result;for(const H of B)if(H.result.status==="dirty")return y.common.issues.push(...H.ctx.common.issues),H.result;const R=B.map(H=>new ZodError(H.ctx.common.issues));return addIssueToContext(y,{code:ZodIssueCode.invalid_union,unionErrors:R}),INVALID}if(y.common.async)return Promise.all(w.map(async B=>{const R={...y,common:{...y.common,issues:[]},parent:null};return{result:await B._parseAsync({data:y.data,path:y.path,parent:R}),ctx:R}})).then($);{let B;const R=[];for(const j of w){const q={...y,common:{...y.common,issues:[]},parent:null},X=j._parseSync({data:y.data,path:y.path,parent:q});if(X.status==="valid")return X;X.status==="dirty"&&!B&&(B={result:X,ctx:q}),q.common.issues.length&&R.push(q.common.issues)}if(B)return y.common.issues.push(...B.ctx.common.issues),B.result;const H=R.map(j=>new ZodError(j));return addIssueToContext(y,{code:ZodIssueCode.invalid_union,unionErrors:H}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(k,_)=>new ZodUnion({options:k,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(_)});const getDiscriminator=k=>k instanceof ZodLazy?getDiscriminator(k.schema):k instanceof ZodEffects?getDiscriminator(k.innerType()):k instanceof ZodLiteral?[k.value]:k instanceof ZodEnum?k.options:k instanceof ZodNativeEnum?Object.keys(k.enum):k instanceof ZodDefault?getDiscriminator(k._def.innerType):k instanceof ZodUndefined?[void 0]:k instanceof ZodNull?[null]:null;class ZodDiscriminatedUnion extends ZodType{_parse(_){const{ctx:y}=this._processInputParams(_);if(y.parsedType!==ZodParsedType.object)return addIssueToContext(y,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:y.parsedType}),INVALID;const w=this.discriminator,$=y.data[w],B=this.optionsMap.get($);return B?y.common.async?B._parseAsync({data:y.data,path:y.path,parent:y}):B._parseSync({data:y.data,path:y.path,parent:y}):(addIssueToContext(y,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[w]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(_,y,w){const $=new Map;for(const B of y){const R=getDiscriminator(B.shape[_]);if(!R)throw new Error(`A discriminator value for key \`${_}\` could not be extracted from all schema options`);for(const H of R){if($.has(H))throw new Error(`Discriminator property ${String(_)} has duplicate value ${String(H)}`);$.set(H,B)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:_,options:y,optionsMap:$,...processCreateParams(w)})}}function mergeValues(k,_){const y=getParsedType(k),w=getParsedType(_);if(k===_)return{valid:!0,data:k};if(y===ZodParsedType.object&&w===ZodParsedType.object){const $=util.objectKeys(_),B=util.objectKeys(k).filter(H=>$.indexOf(H)!==-1),R={...k,..._};for(const H of B){const j=mergeValues(k[H],_[H]);if(!j.valid)return{valid:!1};R[H]=j.data}return{valid:!0,data:R}}else if(y===ZodParsedType.array&&w===ZodParsedType.array){if(k.length!==_.length)return{valid:!1};const $=[];for(let B=0;B<k.length;B++){const R=k[B],H=_[B],j=mergeValues(R,H);if(!j.valid)return{valid:!1};$.push(j.data)}return{valid:!0,data:$}}else return y===ZodParsedType.date&&w===ZodParsedType.date&&+k==+_?{valid:!0,data:k}:{valid:!1}}class ZodIntersection extends ZodType{_parse(_){const{status:y,ctx:w}=this._processInputParams(_),$=(B,R)=>{if(isAborted(B)||isAborted(R))return INVALID;const H=mergeValues(B.value,R.value);return H.valid?((isDirty(B)||isDirty(R))&&y.dirty(),{status:y.value,value:H.data}):(addIssueToContext(w,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return w.common.async?Promise.all([this._def.left._parseAsync({data:w.data,path:w.path,parent:w}),this._def.right._parseAsync({data:w.data,path:w.path,parent:w})]).then(([B,R])=>$(B,R)):$(this._def.left._parseSync({data:w.data,path:w.path,parent:w}),this._def.right._parseSync({data:w.data,path:w.path,parent:w}))}}ZodIntersection.create=(k,_,y)=>new ZodIntersection({left:k,right:_,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(y)});class ZodTuple extends ZodType{_parse(_){const{status:y,ctx:w}=this._processInputParams(_);if(w.parsedType!==ZodParsedType.array)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:w.parsedType}),INVALID;if(w.data.length<this._def.items.length)return addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&w.data.length>this._def.items.length&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y.dirty());const B=[...w.data].map((R,H)=>{const j=this._def.items[H]||this._def.rest;return j?j._parse(new ParseInputLazyPath(w,R,w.path,H)):null}).filter(R=>!!R);return w.common.async?Promise.all(B).then(R=>ParseStatus.mergeArray(y,R)):ParseStatus.mergeArray(y,B)}get items(){return this._def.items}rest(_){return new ZodTuple({...this._def,rest:_})}}ZodTuple.create=(k,_)=>{if(!Array.isArray(k))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:k,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(_)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(_){const{status:y,ctx:w}=this._processInputParams(_);if(w.parsedType!==ZodParsedType.object)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:w.parsedType}),INVALID;const $=[],B=this._def.keyType,R=this._def.valueType;for(const H in w.data)$.push({key:B._parse(new ParseInputLazyPath(w,H,w.path,H)),value:R._parse(new ParseInputLazyPath(w,w.data[H],w.path,H))});return w.common.async?ParseStatus.mergeObjectAsync(y,$):ParseStatus.mergeObjectSync(y,$)}get element(){return this._def.valueType}static create(_,y,w){return y instanceof ZodType?new ZodRecord({keyType:_,valueType:y,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(w)}):new ZodRecord({keyType:ZodString.create(),valueType:_,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(y)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(_){const{status:y,ctx:w}=this._processInputParams(_);if(w.parsedType!==ZodParsedType.map)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:w.parsedType}),INVALID;const $=this._def.keyType,B=this._def.valueType,R=[...w.data.entries()].map(([H,j],q)=>({key:$._parse(new ParseInputLazyPath(w,H,w.path,[q,"key"])),value:B._parse(new ParseInputLazyPath(w,j,w.path,[q,"value"]))}));if(w.common.async){const H=new Map;return Promise.resolve().then(async()=>{for(const j of R){const q=await j.key,X=await j.value;if(q.status==="aborted"||X.status==="aborted")return INVALID;(q.status==="dirty"||X.status==="dirty")&&y.dirty(),H.set(q.value,X.value)}return{status:y.value,value:H}})}else{const H=new Map;for(const j of R){const q=j.key,X=j.value;if(q.status==="aborted"||X.status==="aborted")return INVALID;(q.status==="dirty"||X.status==="dirty")&&y.dirty(),H.set(q.value,X.value)}return{status:y.value,value:H}}}}ZodMap.create=(k,_,y)=>new ZodMap({valueType:_,keyType:k,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(y)});class ZodSet extends ZodType{_parse(_){const{status:y,ctx:w}=this._processInputParams(_);if(w.parsedType!==ZodParsedType.set)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:w.parsedType}),INVALID;const $=this._def;$.minSize!==null&&w.data.size<$.minSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.minSize.value,type:"set",inclusive:!0,exact:!1,message:$.minSize.message}),y.dirty()),$.maxSize!==null&&w.data.size>$.maxSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.maxSize.value,type:"set",inclusive:!0,exact:!1,message:$.maxSize.message}),y.dirty());const B=this._def.valueType;function R(j){const q=new Set;for(const X of j){if(X.status==="aborted")return INVALID;X.status==="dirty"&&y.dirty(),q.add(X.value)}return{status:y.value,value:q}}const H=[...w.data.values()].map((j,q)=>B._parse(new ParseInputLazyPath(w,j,w.path,q)));return w.common.async?Promise.all(H).then(j=>R(j)):R(H)}min(_,y){return new ZodSet({...this._def,minSize:{value:_,message:errorUtil.toString(y)}})}max(_,y){return new ZodSet({...this._def,maxSize:{value:_,message:errorUtil.toString(y)}})}size(_,y){return this.min(_,y).max(_,y)}nonempty(_){return this.min(1,_)}}ZodSet.create=(k,_)=>new ZodSet({valueType:k,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(_)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(_){const{ctx:y}=this._processInputParams(_);if(y.parsedType!==ZodParsedType.function)return addIssueToContext(y,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:y.parsedType}),INVALID;function w(H,j){return makeIssue({data:H,path:y.path,errorMaps:[y.common.contextualErrorMap,y.schemaErrorMap,getErrorMap(),errorMap].filter(q=>!!q),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:j}})}function $(H,j){return makeIssue({data:H,path:y.path,errorMaps:[y.common.contextualErrorMap,y.schemaErrorMap,getErrorMap(),errorMap].filter(q=>!!q),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:j}})}const B={errorMap:y.common.contextualErrorMap},R=y.data;if(this._def.returns instanceof ZodPromise){const H=this;return OK(async function(...j){const q=new ZodError([]),X=await H._def.args.parseAsync(j,B).catch(ne=>{throw q.addIssue(w(j,ne)),q}),ee=await Reflect.apply(R,this,X);return await H._def.returns._def.type.parseAsync(ee,B).catch(ne=>{throw q.addIssue($(ee,ne)),q})})}else{const H=this;return OK(function(...j){const q=H._def.args.safeParse(j,B);if(!q.success)throw new ZodError([w(j,q.error)]);const X=Reflect.apply(R,this,q.data),ee=H._def.returns.safeParse(X,B);if(!ee.success)throw new ZodError([$(X,ee.error)]);return ee.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(..._){return new ZodFunction({...this._def,args:ZodTuple.create(_).rest(ZodUnknown.create())})}returns(_){return new ZodFunction({...this._def,returns:_})}implement(_){return this.parse(_)}strictImplement(_){return this.parse(_)}static create(_,y,w){return new ZodFunction({args:_||ZodTuple.create([]).rest(ZodUnknown.create()),returns:y||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(w)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(_){const{ctx:y}=this._processInputParams(_);return this._def.getter()._parse({data:y.data,path:y.path,parent:y})}}ZodLazy.create=(k,_)=>new ZodLazy({getter:k,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(_)});class ZodLiteral extends ZodType{_parse(_){if(_.data!==this._def.value){const y=this._getOrReturnCtx(_);return addIssueToContext(y,{received:y.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:_.data}}get value(){return this._def.value}}ZodLiteral.create=(k,_)=>new ZodLiteral({value:k,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(_)});function createZodEnum(k,_){return new ZodEnum({values:k,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(_)})}class ZodEnum extends ZodType{_parse(_){if(typeof _.data!="string"){const y=this._getOrReturnCtx(_),w=this._def.values;return addIssueToContext(y,{expected:util.joinValues(w),received:y.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(this._def.values.indexOf(_.data)===-1){const y=this._getOrReturnCtx(_),w=this._def.values;return addIssueToContext(y,{received:y.data,code:ZodIssueCode.invalid_enum_value,options:w}),INVALID}return OK(_.data)}get options(){return this._def.values}get enum(){const _={};for(const y of this._def.values)_[y]=y;return _}get Values(){const _={};for(const y of this._def.values)_[y]=y;return _}get Enum(){const _={};for(const y of this._def.values)_[y]=y;return _}extract(_){return ZodEnum.create(_)}exclude(_){return ZodEnum.create(this.options.filter(y=>!_.includes(y)))}}ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{_parse(_){const y=util.getValidEnumValues(this._def.values),w=this._getOrReturnCtx(_);if(w.parsedType!==ZodParsedType.string&&w.parsedType!==ZodParsedType.number){const $=util.objectValues(y);return addIssueToContext(w,{expected:util.joinValues($),received:w.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(y.indexOf(_.data)===-1){const $=util.objectValues(y);return addIssueToContext(w,{received:w.data,code:ZodIssueCode.invalid_enum_value,options:$}),INVALID}return OK(_.data)}get enum(){return this._def.values}}ZodNativeEnum.create=(k,_)=>new ZodNativeEnum({values:k,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(_)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(_){const{ctx:y}=this._processInputParams(_);if(y.parsedType!==ZodParsedType.promise&&y.common.async===!1)return addIssueToContext(y,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:y.parsedType}),INVALID;const w=y.parsedType===ZodParsedType.promise?y.data:Promise.resolve(y.data);return OK(w.then($=>this._def.type.parseAsync($,{path:y.path,errorMap:y.common.contextualErrorMap})))}}ZodPromise.create=(k,_)=>new ZodPromise({type:k,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(_)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(_){const{status:y,ctx:w}=this._processInputParams(_),$=this._def.effect||null,B={addIssue:R=>{addIssueToContext(w,R),R.fatal?y.abort():y.dirty()},get path(){return w.path}};if(B.addIssue=B.addIssue.bind(B),$.type==="preprocess"){const R=$.transform(w.data,B);return w.common.issues.length?{status:"dirty",value:w.data}:w.common.async?Promise.resolve(R).then(H=>this._def.schema._parseAsync({data:H,path:w.path,parent:w})):this._def.schema._parseSync({data:R,path:w.path,parent:w})}if($.type==="refinement"){const R=H=>{const j=$.refinement(H,B);if(w.common.async)return Promise.resolve(j);if(j instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return H};if(w.common.async===!1){const H=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});return H.status==="aborted"?INVALID:(H.status==="dirty"&&y.dirty(),R(H.value),{status:y.value,value:H.value})}else return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then(H=>H.status==="aborted"?INVALID:(H.status==="dirty"&&y.dirty(),R(H.value).then(()=>({status:y.value,value:H.value}))))}if($.type==="transform")if(w.common.async===!1){const R=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});if(!isValid$1(R))return R;const H=$.transform(R.value,B);if(H instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:y.value,value:H}}else return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then(R=>isValid$1(R)?Promise.resolve($.transform(R.value,B)).then(H=>({status:y.value,value:H})):R);util.assertNever($)}}ZodEffects.create=(k,_,y)=>new ZodEffects({schema:k,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:_,...processCreateParams(y)});ZodEffects.createWithPreprocess=(k,_,y)=>new ZodEffects({schema:_,effect:{type:"preprocess",transform:k},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(y)});class ZodOptional extends ZodType{_parse(_){return this._getType(_)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(_)}unwrap(){return this._def.innerType}}ZodOptional.create=(k,_)=>new ZodOptional({innerType:k,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(_)});class ZodNullable extends ZodType{_parse(_){return this._getType(_)===ZodParsedType.null?OK(null):this._def.innerType._parse(_)}unwrap(){return this._def.innerType}}ZodNullable.create=(k,_)=>new ZodNullable({innerType:k,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(_)});class ZodDefault extends ZodType{_parse(_){const{ctx:y}=this._processInputParams(_);let w=y.data;return y.parsedType===ZodParsedType.undefined&&(w=this._def.defaultValue()),this._def.innerType._parse({data:w,path:y.path,parent:y})}removeDefault(){return this._def.innerType}}ZodDefault.create=(k,_)=>new ZodDefault({innerType:k,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof _.default=="function"?_.default:()=>_.default,...processCreateParams(_)});class ZodCatch extends ZodType{_parse(_){const{ctx:y}=this._processInputParams(_),w={...y,common:{...y.common,issues:[]}},$=this._def.innerType._parse({data:w.data,path:w.path,parent:{...w}});return isAsync($)?$.then(B=>({status:"valid",value:B.status==="valid"?B.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})})):{status:"valid",value:$.status==="valid"?$.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(k,_)=>new ZodCatch({innerType:k,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof _.catch=="function"?_.catch:()=>_.catch,...processCreateParams(_)});class ZodNaN extends ZodType{_parse(_){if(this._getType(_)!==ZodParsedType.nan){const w=this._getOrReturnCtx(_);return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:w.parsedType}),INVALID}return{status:"valid",value:_.data}}}ZodNaN.create=k=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(k)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(_){const{ctx:y}=this._processInputParams(_),w=y.data;return this._def.type._parse({data:w,path:y.path,parent:y})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(_){const{status:y,ctx:w}=this._processInputParams(_);if(w.common.async)return(async()=>{const B=await this._def.in._parseAsync({data:w.data,path:w.path,parent:w});return B.status==="aborted"?INVALID:B.status==="dirty"?(y.dirty(),DIRTY(B.value)):this._def.out._parseAsync({data:B.value,path:w.path,parent:w})})();{const $=this._def.in._parseSync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(y.dirty(),{status:"dirty",value:$.value}):this._def.out._parseSync({data:$.value,path:w.path,parent:w})}}static create(_,y){return new ZodPipeline({in:_,out:y,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(_){const y=this._def.innerType._parse(_);return isValid$1(y)&&(y.value=Object.freeze(y.value)),y}}ZodReadonly.create=(k,_)=>new ZodReadonly({innerType:k,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(_)});const custom=(k,_={},y)=>k?ZodAny.create().superRefine((w,$)=>{var B,R;if(!k(w)){const H=typeof _=="function"?_(w):typeof _=="string"?{message:_}:_,j=(R=(B=H.fatal)!==null&&B!==void 0?B:y)!==null&&R!==void 0?R:!0,q=typeof H=="string"?{message:H}:H;$.addIssue({code:"custom",...q,fatal:j})}}):ZodAny.create(),late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(k){k.ZodString="ZodString",k.ZodNumber="ZodNumber",k.ZodNaN="ZodNaN",k.ZodBigInt="ZodBigInt",k.ZodBoolean="ZodBoolean",k.ZodDate="ZodDate",k.ZodSymbol="ZodSymbol",k.ZodUndefined="ZodUndefined",k.ZodNull="ZodNull",k.ZodAny="ZodAny",k.ZodUnknown="ZodUnknown",k.ZodNever="ZodNever",k.ZodVoid="ZodVoid",k.ZodArray="ZodArray",k.ZodObject="ZodObject",k.ZodUnion="ZodUnion",k.ZodDiscriminatedUnion="ZodDiscriminatedUnion",k.ZodIntersection="ZodIntersection",k.ZodTuple="ZodTuple",k.ZodRecord="ZodRecord",k.ZodMap="ZodMap",k.ZodSet="ZodSet",k.ZodFunction="ZodFunction",k.ZodLazy="ZodLazy",k.ZodLiteral="ZodLiteral",k.ZodEnum="ZodEnum",k.ZodEffects="ZodEffects",k.ZodNativeEnum="ZodNativeEnum",k.ZodOptional="ZodOptional",k.ZodNullable="ZodNullable",k.ZodDefault="ZodDefault",k.ZodCatch="ZodCatch",k.ZodPromise="ZodPromise",k.ZodBranded="ZodBranded",k.ZodPipeline="ZodPipeline",k.ZodReadonly="ZodReadonly"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(k,_={message:`Input not instance of ${k.name}`})=>custom(y=>y instanceof k,_),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:k=>ZodString.create({...k,coerce:!0}),number:k=>ZodNumber.create({...k,coerce:!0}),boolean:k=>ZodBoolean.create({...k,coerce:!0}),bigint:k=>ZodBigInt.create({...k,coerce:!0}),date:k=>ZodDate.create({...k,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap,getErrorMap,makeIssue,EMPTY_PATH,addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid:isValid$1,isAsync,get util(){return util},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,ZodReadonly,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson,ZodError});const create$6=()=>new Map,copy=k=>{const _=create$6();return k.forEach((y,w)=>{_.set(w,y)}),_},setIfUndefined=(k,_,y)=>{let w=k.get(_);return w===void 0&&k.set(_,w=y()),w},map$1=(k,_)=>{const y=[];for(const[w,$]of k)y.push(_($,w));return y},any=(k,_)=>{for(const[y,w]of k)if(_(w,y))return!0;return!1},create$5=()=>new Set,last=k=>k[k.length-1],appendTo=(k,_)=>{for(let y=0;y<_.length;y++)k.push(_[y])},from=Array.from,some=(k,_)=>{for(let y=0;y<k.length;y++)if(_(k[y],y,k))return!0;return!1},unfold=(k,_)=>{const y=new Array(k);for(let w=0;w<k;w++)y[w]=_(w,y);return y},isArray=Array.isArray;class Observable{constructor(){this._observers=create$6()}on(_,y){setIfUndefined(this._observers,_,create$5).add(y)}once(_,y){const w=(...$)=>{this.off(_,w),y(...$)};this.on(_,w)}off(_,y){const w=this._observers.get(_);w!==void 0&&(w.delete(y),w.size===0&&this._observers.delete(_))}emit(_,y){return from((this._observers.get(_)||create$6()).values()).forEach(w=>w(...y))}destroy(){this._observers=create$6()}}const floor$1=Math.floor,abs=Math.abs,min$2=(k,_)=>k<_?k:_,max$1=(k,_)=>k>_?k:_,isNegativeZero=k=>k!==0?k<0:1/k<0,toLowerCase=k=>k.toLowerCase(),trimLeftRegex=/^\s*/g,trimLeft=k=>k.replace(trimLeftRegex,""),fromCamelCaseRegex=/([A-Z])/g,fromCamelCase=(k,_)=>trimLeft(k.replace(fromCamelCaseRegex,y=>`${_}${toLowerCase(y)}`)),_encodeUtf8Polyfill=k=>{const _=unescape(encodeURIComponent(k)),y=_.length,w=new Uint8Array(y);for(let $=0;$<y;$++)w[$]=_.codePointAt($);return w},utf8TextEncoder=typeof TextEncoder<"u"?new TextEncoder:null,_encodeUtf8Native=k=>utf8TextEncoder.encode(k),encodeUtf8=utf8TextEncoder?_encodeUtf8Native:_encodeUtf8Polyfill;let utf8TextDecoder=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});utf8TextDecoder&&utf8TextDecoder.decode(new Uint8Array).length===1&&(utf8TextDecoder=null);const repeat=(k,_)=>unfold(_,()=>k).join(""),undefinedToNull=k=>k===void 0?null:k;class VarStoragePolyfill{constructor(){this.map=new Map}setItem(_,y){this.map.set(_,y)}getItem(_){return this.map.get(_)}}let _localStorage=new VarStoragePolyfill,usePolyfill=!0;try{typeof localStorage<"u"&&(_localStorage=localStorage,usePolyfill=!1)}catch{}const varStorage=_localStorage,assign=Object.assign,keys=Object.keys,forEach=(k,_)=>{for(const y in k)_(k[y],y)},length$2=k=>keys(k).length,isEmpty$1=k=>{for(const _ in k)return!1;return!0},every=(k,_)=>{for(const y in k)if(!_(k[y],y))return!1;return!0},hasProperty=(k,_)=>Object.prototype.hasOwnProperty.call(k,_),equalFlat=(k,_)=>k===_||length$2(k)===length$2(_)&&every(k,(y,w)=>(y!==void 0||hasProperty(_,w))&&_[w]===y),callAll=(k,_,y=0)=>{try{for(;y<k.length;y++)k[y](..._)}finally{y<k.length&&callAll(k,_,y+1)}},id=k=>k,equalityStrict=(k,_)=>k===_,equalityDeep=(k,_)=>{if(k==null||_==null)return equalityStrict(k,_);if(k.constructor!==_.constructor)return!1;if(k===_)return!0;switch(k.constructor){case ArrayBuffer:k=new Uint8Array(k),_=new Uint8Array(_);case Uint8Array:{if(k.byteLength!==_.byteLength)return!1;for(let y=0;y<k.length;y++)if(k[y]!==_[y])return!1;break}case Set:{if(k.size!==_.size)return!1;for(const y of k)if(!_.has(y))return!1;break}case Map:{if(k.size!==_.size)return!1;for(const y of k.keys())if(!_.has(y)||!equalityDeep(k.get(y),_.get(y)))return!1;break}case Object:if(length$2(k)!==length$2(_))return!1;for(const y in k)if(!hasProperty(k,y)||!equalityDeep(k[y],_[y]))return!1;break;case Array:if(k.length!==_.length)return!1;for(let y=0;y<k.length;y++)if(!equalityDeep(k[y],_[y]))return!1;break;default:return!1}return!0},isOneOf=(k,_)=>_.includes(k),isNode$2=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);let params;const computeParams=()=>{if(params===void 0)if(isNode$2){params=create$6();const k=process.argv;let _=null;for(let y=0;y<k.length;y++){const w=k[y];w[0]==="-"?(_!==null&&params.set(_,""),_=w):_!==null&&(params.set(_,w),_=null)}_!==null&&params.set(_,"")}else typeof location=="object"?(params=create$6(),(location.search||"?").slice(1).split("&").forEach(k=>{if(k.length!==0){const[_,y]=k.split("=");params.set(`--${fromCamelCase(_,"-")}`,y),params.set(`-${fromCamelCase(_,"-")}`,y)}})):params=create$6();return params},hasParam=k=>computeParams().has(k),getVariable=k=>undefinedToNull(isNode$2?process.env[k.toUpperCase()]:varStorage.getItem(k)),hasConf=k=>hasParam("--"+k)||getVariable(k)!==null;hasConf("production");const forceColor=isNode$2&&isOneOf({}.FORCE_COLOR,["true","1","2"]),supportsColor=!hasParam("no-colors")&&(!isNode$2||process.stdout.isTTY||forceColor)&&(!isNode$2||hasParam("color")||forceColor||getVariable("COLORTERM")!==null||(getVariable("TERM")||"").includes("color")),BIT1=1,BIT2=2,BIT3=4,BIT4=8,BIT6=32,BIT7=64,BIT8=128,BITS5=31,BITS6=63,BITS7=127,BITS31=2147483647,MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER,isInteger=Number.isInteger||(k=>typeof k=="number"&&isFinite(k)&&floor$1(k)===k),create$4=k=>new Error(k),methodUnimplemented=()=>{throw create$4("Method unimplemented")},unexpectedCase=()=>{throw create$4("Unexpected case")},errorUnexpectedEndOfArray=create$4("Unexpected end of array"),errorIntegerOutOfRange=create$4("Integer out of Range");class Decoder{constructor(_){this.arr=_,this.pos=0}}const createDecoder=k=>new Decoder(k),hasContent=k=>k.pos!==k.arr.length,readUint8Array=(k,_)=>{const y=createUint8ArrayViewFromArrayBuffer(k.arr.buffer,k.pos+k.arr.byteOffset,_);return k.pos+=_,y},readVarUint8Array=k=>readUint8Array(k,readVarUint(k)),readUint8=k=>k.arr[k.pos++],readVarUint=k=>{let _=0,y=1;const w=k.arr.length;for(;k.pos<w;){const $=k.arr[k.pos++];if(_=_+($&BITS7)*y,y*=128,$<BIT8)return _;if(_>MAX_SAFE_INTEGER)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},readVarInt=k=>{let _=k.arr[k.pos++],y=_&BITS6,w=64;const $=(_&BIT7)>0?-1:1;if(!(_&BIT8))return $*y;const B=k.arr.length;for(;k.pos<B;){if(_=k.arr[k.pos++],y=y+(_&BITS7)*w,w*=128,_<BIT8)return $*y;if(y>MAX_SAFE_INTEGER)throw errorIntegerOutOfRange}throw errorUnexpectedEndOfArray},_readVarStringPolyfill=k=>{let _=readVarUint(k);if(_===0)return"";{let y=String.fromCodePoint(readUint8(k));if(--_<100)for(;_--;)y+=String.fromCodePoint(readUint8(k));else for(;_>0;){const w=_<1e4?_:1e4,$=k.arr.subarray(k.pos,k.pos+w);k.pos+=w,y+=String.fromCodePoint.apply(null,$),_-=w}return decodeURIComponent(escape(y))}},_readVarStringNative=k=>utf8TextDecoder.decode(readVarUint8Array(k)),readVarString=utf8TextDecoder?_readVarStringNative:_readVarStringPolyfill,readFromDataView=(k,_)=>{const y=new DataView(k.arr.buffer,k.arr.byteOffset+k.pos,_);return k.pos+=_,y},readFloat32=k=>readFromDataView(k,4).getFloat32(0,!1),readFloat64=k=>readFromDataView(k,8).getFloat64(0,!1),readBigInt64=k=>readFromDataView(k,8).getBigInt64(0,!1),readAnyLookupTable=[k=>{},k=>null,readVarInt,readFloat32,readFloat64,readBigInt64,k=>!1,k=>!0,readVarString,k=>{const _=readVarUint(k),y={};for(let w=0;w<_;w++){const $=readVarString(k);y[$]=readAny(k)}return y},k=>{const _=readVarUint(k),y=[];for(let w=0;w<_;w++)y.push(readAny(k));return y},readVarUint8Array],readAny=k=>readAnyLookupTable[127-readUint8(k)](k);class RleDecoder extends Decoder{constructor(_,y){super(_),this.reader=y,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),hasContent(this)?this.count=readVarUint(this)+1:this.count=-1),this.count--,this.s}}class UintOptRleDecoder extends Decoder{constructor(_){super(_),this.s=0,this.count=0}read(){if(this.count===0){this.s=readVarInt(this);const _=isNegativeZero(this.s);this.count=1,_&&(this.s=-this.s,this.count=readVarUint(this)+2)}return this.count--,this.s}}class IntDiffOptRleDecoder extends Decoder{constructor(_){super(_),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const _=readVarInt(this),y=_&1;this.diff=floor$1(_/2),this.count=1,y&&(this.count=readVarUint(this)+2)}return this.s+=this.diff,this.count--,this.s}}class StringDecoder{constructor(_){this.decoder=new UintOptRleDecoder(_),this.str=readVarString(this.decoder),this.spos=0}read(){const _=this.spos+this.decoder.read(),y=this.str.slice(this.spos,_);return this.spos=_,y}}const createUint8ArrayFromLen=k=>new Uint8Array(k),createUint8ArrayViewFromArrayBuffer=(k,_,y)=>new Uint8Array(k,_,y),copyUint8Array=k=>{const _=createUint8ArrayFromLen(k.byteLength);return _.set(k),_};class Encoder{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const createEncoder=()=>new Encoder,length$1=k=>{let _=k.cpos;for(let y=0;y<k.bufs.length;y++)_+=k.bufs[y].length;return _},toUint8Array=k=>{const _=new Uint8Array(length$1(k));let y=0;for(let w=0;w<k.bufs.length;w++){const $=k.bufs[w];_.set($,y),y+=$.length}return _.set(createUint8ArrayViewFromArrayBuffer(k.cbuf.buffer,0,k.cpos),y),_},verifyLen=(k,_)=>{const y=k.cbuf.length;y-k.cpos<_&&(k.bufs.push(createUint8ArrayViewFromArrayBuffer(k.cbuf.buffer,0,k.cpos)),k.cbuf=new Uint8Array(max$1(y,_)*2),k.cpos=0)},write=(k,_)=>{const y=k.cbuf.length;k.cpos===y&&(k.bufs.push(k.cbuf),k.cbuf=new Uint8Array(y*2),k.cpos=0),k.cbuf[k.cpos++]=_},writeUint8=write,writeVarUint=(k,_)=>{for(;_>BITS7;)write(k,BIT8|BITS7&_),_=floor$1(_/128);write(k,BITS7&_)},writeVarInt=(k,_)=>{const y=isNegativeZero(_);for(y&&(_=-_),write(k,(_>BITS6?BIT8:0)|(y?BIT7:0)|BITS6&_),_=floor$1(_/64);_>0;)write(k,(_>BITS7?BIT8:0)|BITS7&_),_=floor$1(_/128)},_strBuffer=new Uint8Array(3e4),_maxStrBSize=_strBuffer.length/3,_writeVarStringNative=(k,_)=>{if(_.length<_maxStrBSize){const y=utf8TextEncoder.encodeInto(_,_strBuffer).written||0;writeVarUint(k,y);for(let w=0;w<y;w++)write(k,_strBuffer[w])}else writeVarUint8Array(k,encodeUtf8(_))},_writeVarStringPolyfill=(k,_)=>{const y=unescape(encodeURIComponent(_)),w=y.length;writeVarUint(k,w);for(let $=0;$<w;$++)write(k,y.codePointAt($))},writeVarString=utf8TextEncoder&&utf8TextEncoder.encodeInto?_writeVarStringNative:_writeVarStringPolyfill,writeBinaryEncoder=(k,_)=>writeUint8Array(k,toUint8Array(_)),writeUint8Array=(k,_)=>{const y=k.cbuf.length,w=k.cpos,$=min$2(y-w,_.length),B=_.length-$;k.cbuf.set(_.subarray(0,$),w),k.cpos+=$,B>0&&(k.bufs.push(k.cbuf),k.cbuf=new Uint8Array(max$1(y*2,B)),k.cbuf.set(_.subarray($)),k.cpos=B)},writeVarUint8Array=(k,_)=>{writeVarUint(k,_.byteLength),writeUint8Array(k,_)},writeOnDataView=(k,_)=>{verifyLen(k,_);const y=new DataView(k.cbuf.buffer,k.cpos,_);return k.cpos+=_,y},writeFloat32=(k,_)=>writeOnDataView(k,4).setFloat32(0,_,!1),writeFloat64=(k,_)=>writeOnDataView(k,8).setFloat64(0,_,!1),writeBigInt64=(k,_)=>writeOnDataView(k,8).setBigInt64(0,_,!1),floatTestBed=new DataView(new ArrayBuffer(4)),isFloat32=k=>(floatTestBed.setFloat32(0,k),floatTestBed.getFloat32(0)===k),writeAny=(k,_)=>{switch(typeof _){case"string":write(k,119),writeVarString(k,_);break;case"number":isInteger(_)&&abs(_)<=BITS31?(write(k,125),writeVarInt(k,_)):isFloat32(_)?(write(k,124),writeFloat32(k,_)):(write(k,123),writeFloat64(k,_));break;case"bigint":write(k,122),writeBigInt64(k,_);break;case"object":if(_===null)write(k,126);else if(isArray(_)){write(k,117),writeVarUint(k,_.length);for(let y=0;y<_.length;y++)writeAny(k,_[y])}else if(_ instanceof Uint8Array)write(k,116),writeVarUint8Array(k,_);else{write(k,118);const y=Object.keys(_);writeVarUint(k,y.length);for(let w=0;w<y.length;w++){const $=y[w];writeVarString(k,$),writeAny(k,_[$])}}break;case"boolean":write(k,_?120:121);break;default:write(k,127)}};class RleEncoder extends Encoder{constructor(_){super(),this.w=_,this.s=null,this.count=0}write(_){this.s===_?this.count++:(this.count>0&&writeVarUint(this,this.count-1),this.count=1,this.w(this,_),this.s=_)}}const flushUintOptRleEncoder=k=>{k.count>0&&(writeVarInt(k.encoder,k.count===1?k.s:-k.s),k.count>1&&writeVarUint(k.encoder,k.count-2))};class UintOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0}write(_){this.s===_?this.count++:(flushUintOptRleEncoder(this),this.count=1,this.s=_)}toUint8Array(){return flushUintOptRleEncoder(this),toUint8Array(this.encoder)}}const flushIntDiffOptRleEncoder=k=>{if(k.count>0){const _=k.diff*2+(k.count===1?0:1);writeVarInt(k.encoder,_),k.count>1&&writeVarUint(k.encoder,k.count-2)}};class IntDiffOptRleEncoder{constructor(){this.encoder=new Encoder,this.s=0,this.count=0,this.diff=0}write(_){this.diff===_-this.s?(this.s=_,this.count++):(flushIntDiffOptRleEncoder(this),this.count=1,this.diff=_-this.s,this.s=_)}toUint8Array(){return flushIntDiffOptRleEncoder(this),toUint8Array(this.encoder)}}class StringEncoder{constructor(){this.sarr=[],this.s="",this.lensE=new UintOptRleEncoder}write(_){this.s+=_,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(_.length)}toUint8Array(){const _=new Encoder;return this.sarr.push(this.s),this.s="",writeVarString(_,this.sarr.join("")),writeUint8Array(_,this.lensE.toUint8Array()),toUint8Array(_)}}const getRandomValues=crypto.getRandomValues.bind(crypto),uint32=()=>getRandomValues(new Uint32Array(1))[0],uuidv4Template=[1e7]+-1e3+-4e3+-8e3+-1e11,uuidv4$1=()=>uuidv4Template.replace(/[018]/g,k=>(k^uint32()&15>>k/4).toString(16)),getUnixTime=Date.now,create$3=k=>new Promise(k);Promise.all.bind(Promise);class Pair{constructor(_,y){this.left=_,this.right=y}}const create$2=(k,_)=>new Pair(k,_);typeof DOMParser<"u"&&new DOMParser;const mapToStyleString=k=>map$1(k,(_,y)=>`${y}:${_};`).join(""),create$1=Symbol,BOLD=create$1(),UNBOLD=create$1(),BLUE=create$1(),GREY=create$1(),GREEN=create$1(),RED=create$1(),PURPLE=create$1(),ORANGE=create$1(),UNCOLOR=create$1(),computeNoColorLoggingArgs=k=>{const _=[];let y=0;for(;y<k.length;y++){const w=k[y];w.constructor===String||w.constructor===Number||w.constructor===Object&&_.push(JSON.stringify(w))}return _},_browserStyleMap={[BOLD]:create$2("font-weight","bold"),[UNBOLD]:create$2("font-weight","normal"),[BLUE]:create$2("color","blue"),[GREEN]:create$2("color","green"),[GREY]:create$2("color","grey"),[RED]:create$2("color","red"),[PURPLE]:create$2("color","purple"),[ORANGE]:create$2("color","orange"),[UNCOLOR]:create$2("color","black")},computeBrowserLoggingArgs=k=>{const _=[],y=[],w=create$6();let $=[],B=0;for(;B<k.length;B++){const R=k[B],H=_browserStyleMap[R];if(H!==void 0)w.set(H.left,H.right);else if(R.constructor===String||R.constructor===Number){const j=mapToStyleString(w);B>0||j.length>0?(_.push("%c"+R),y.push(j)):_.push(R)}else break}for(B>0&&($=y,$.unshift(_.join("")));B<k.length;B++){const R=k[B];R instanceof Symbol||$.push(R)}return $},computeLoggingArgs=supportsColor?computeBrowserLoggingArgs:computeNoColorLoggingArgs,print=(...k)=>{console.log(...computeLoggingArgs(k)),vconsoles.forEach(_=>_.print(k))},warn=(...k)=>{console.warn(...computeLoggingArgs(k)),k.unshift(ORANGE),vconsoles.forEach(_=>_.print(k))},vconsoles=create$5(),createIterator=k=>({[Symbol.iterator](){return this},next:k}),iteratorFilter=(k,_)=>createIterator(()=>{let y;do y=k.next();while(!y.done&&!_(y.value));return y}),iteratorMap=(k,_)=>createIterator(()=>{const{done:y,value:w}=k.next();return{done:y,value:y?void 0:_(w)}});class AbstractConnector extends Observable{constructor(_,y){super(),this.doc=_,this.awareness=y}}class DeleteItem{constructor(_,y){this.clock=_,this.len=y}}class DeleteSet{constructor(){this.clients=new Map}}const iterateDeletedStructs=(k,_,y)=>_.clients.forEach((w,$)=>{const B=k.doc.store.clients.get($);for(let R=0;R<w.length;R++){const H=w[R];iterateStructs(k,B,H.clock,H.len,y)}}),findIndexDS=(k,_)=>{let y=0,w=k.length-1;for(;y<=w;){const $=floor$1((y+w)/2),B=k[$],R=B.clock;if(R<=_){if(_<R+B.len)return $;y=$+1}else w=$-1}return null},isDeleted=(k,_)=>{const y=k.clients.get(_.client);return y!==void 0&&findIndexDS(y,_.clock)!==null},sortAndMergeDeleteSet=k=>{k.clients.forEach(_=>{_.sort(($,B)=>$.clock-B.clock);let y,w;for(y=1,w=1;y<_.length;y++){const $=_[w-1],B=_[y];$.clock+$.len>=B.clock?$.len=max$1($.len,B.clock+B.len-$.clock):(w<y&&(_[w]=B),w++)}_.length=w})},mergeDeleteSets=k=>{const _=new DeleteSet;for(let y=0;y<k.length;y++)k[y].clients.forEach((w,$)=>{if(!_.clients.has($)){const B=w.slice();for(let R=y+1;R<k.length;R++)appendTo(B,k[R].clients.get($)||[]);_.clients.set($,B)}});return sortAndMergeDeleteSet(_),_},addToDeleteSet=(k,_,y,w)=>{setIfUndefined(k.clients,_,()=>[]).push(new DeleteItem(y,w))},createDeleteSet=()=>new DeleteSet,createDeleteSetFromStructStore=k=>{const _=createDeleteSet();return k.clients.forEach((y,w)=>{const $=[];for(let B=0;B<y.length;B++){const R=y[B];if(R.deleted){const H=R.id.clock;let j=R.length;if(B+1<y.length)for(let q=y[B+1];B+1<y.length&&q.deleted;q=y[++B+1])j+=q.length;$.push(new DeleteItem(H,j))}}$.length>0&&_.clients.set(w,$)}),_},writeDeleteSet=(k,_)=>{writeVarUint(k.restEncoder,_.clients.size),from(_.clients.entries()).sort((y,w)=>w[0]-y[0]).forEach(([y,w])=>{k.resetDsCurVal(),writeVarUint(k.restEncoder,y);const $=w.length;writeVarUint(k.restEncoder,$);for(let B=0;B<$;B++){const R=w[B];k.writeDsClock(R.clock),k.writeDsLen(R.len)}})},readDeleteSet=k=>{const _=new DeleteSet,y=readVarUint(k.restDecoder);for(let w=0;w<y;w++){k.resetDsCurVal();const $=readVarUint(k.restDecoder),B=readVarUint(k.restDecoder);if(B>0){const R=setIfUndefined(_.clients,$,()=>[]);for(let H=0;H<B;H++)R.push(new DeleteItem(k.readDsClock(),k.readDsLen()))}}return _},readAndApplyDeleteSet=(k,_,y)=>{const w=new DeleteSet,$=readVarUint(k.restDecoder);for(let B=0;B<$;B++){k.resetDsCurVal();const R=readVarUint(k.restDecoder),H=readVarUint(k.restDecoder),j=y.clients.get(R)||[],q=getState(y,R);for(let X=0;X<H;X++){const ee=k.readDsClock(),te=ee+k.readDsLen();if(ee<q){q<te&&addToDeleteSet(w,R,q,te-q);let ne=findIndexSS(j,ee),oe=j[ne];for(!oe.deleted&&oe.id.clock<ee&&(j.splice(ne+1,0,splitItem(_,oe,ee-oe.id.clock)),ne++);ne<j.length&&(oe=j[ne++],oe.id.clock<te);)oe.deleted||(te<oe.id.clock+oe.length&&j.splice(ne,0,splitItem(_,oe,te-oe.id.clock)),oe.delete(_))}else addToDeleteSet(w,R,ee,te-ee)}}if(w.clients.size>0){const B=new UpdateEncoderV2;return writeVarUint(B.restEncoder,0),writeDeleteSet(B,w),B.toUint8Array()}return null},equalDeleteSets=(k,_)=>{if(k.clients.size!==_.clients.size)return!1;for(const[y,w]of k.clients.entries()){const $=_.clients.get(y);if($===void 0||w.length!==$.length)return!1;for(let B=0;B<w.length;B++){const R=w[B],H=$[B];if(R.clock!==H.clock||R.len!==H.len)return!1}}return!0},generateNewClientId=uint32;class Doc extends Observable{constructor({guid:_=uuidv4$1(),collectionid:y=null,gc:w=!0,gcFilter:$=()=>!0,meta:B=null,autoLoad:R=!1,shouldLoad:H=!0}={}){super(),this.gc=w,this.gcFilter=$,this.clientID=generateNewClientId(),this.guid=_,this.collectionid=y,this.share=new Map,this.store=new StructStore,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=H,this.autoLoad=R,this.meta=B,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=create$3(q=>{this.on("load",()=>{this.isLoaded=!0,q(this)})});const j=()=>create$3(q=>{const X=ee=>{(ee===void 0||ee===!0)&&(this.off("sync",X),q())};this.on("sync",X)});this.on("sync",q=>{q===!1&&this.isSynced&&(this.whenSynced=j()),this.isSynced=q===void 0||q===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=j()}load(){const _=this._item;_!==null&&!this.shouldLoad&&transact(_.parent.doc,y=>{y.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(from(this.subdocs).map(_=>_.guid))}transact(_,y=null){return transact(this,_,y)}get(_,y=AbstractType){const w=setIfUndefined(this.share,_,()=>{const B=new y;return B._integrate(this,null),B}),$=w.constructor;if(y!==AbstractType&&$!==y)if($===AbstractType){const B=new y;B._map=w._map,w._map.forEach(R=>{for(;R!==null;R=R.left)R.parent=B}),B._start=w._start;for(let R=B._start;R!==null;R=R.right)R.parent=B;return B._length=w._length,this.share.set(_,B),B._integrate(this,null),B}else throw new Error(`Type with the name ${_} has already been defined with a different constructor`);return w}getArray(_=""){return this.get(_,YArray)}getText(_=""){return this.get(_,YText)}getMap(_=""){return this.get(_,YMap)}getXmlFragment(_=""){return this.get(_,YXmlFragment)}toJSON(){const _={};return this.share.forEach((y,w)=>{_[w]=y.toJSON()}),_}destroy(){from(this.subdocs).forEach(y=>y.destroy());const _=this._item;if(_!==null){this._item=null;const y=_.content;y.doc=new Doc({guid:this.guid,...y.opts,shouldLoad:!1}),y.doc._item=_,transact(_.parent.doc,w=>{const $=y.doc;_.deleted||w.subdocsAdded.add($),w.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(_,y){super.on(_,y)}off(_,y){super.off(_,y)}}class DSDecoderV1{constructor(_){this.restDecoder=_}resetDsCurVal(){}readDsClock(){return readVarUint(this.restDecoder)}readDsLen(){return readVarUint(this.restDecoder)}}class UpdateDecoderV1 extends DSDecoderV1{readLeftID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readRightID(){return createID(readVarUint(this.restDecoder),readVarUint(this.restDecoder))}readClient(){return readVarUint(this.restDecoder)}readInfo(){return readUint8(this.restDecoder)}readString(){return readVarString(this.restDecoder)}readParentInfo(){return readVarUint(this.restDecoder)===1}readTypeRef(){return readVarUint(this.restDecoder)}readLen(){return readVarUint(this.restDecoder)}readAny(){return readAny(this.restDecoder)}readBuf(){return copyUint8Array(readVarUint8Array(this.restDecoder))}readJSON(){return JSON.parse(readVarString(this.restDecoder))}readKey(){return readVarString(this.restDecoder)}}class DSDecoderV2{constructor(_){this.dsCurrVal=0,this.restDecoder=_}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=readVarUint(this.restDecoder),this.dsCurrVal}readDsLen(){const _=readVarUint(this.restDecoder)+1;return this.dsCurrVal+=_,_}}class UpdateDecoderV2 extends DSDecoderV2{constructor(_){super(_),this.keys=[],readVarUint(_),this.keyClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(_)),this.clientDecoder=new UintOptRleDecoder(readVarUint8Array(_)),this.leftClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(_)),this.rightClockDecoder=new IntDiffOptRleDecoder(readVarUint8Array(_)),this.infoDecoder=new RleDecoder(readVarUint8Array(_),readUint8),this.stringDecoder=new StringDecoder(readVarUint8Array(_)),this.parentInfoDecoder=new RleDecoder(readVarUint8Array(_),readUint8),this.typeRefDecoder=new UintOptRleDecoder(readVarUint8Array(_)),this.lenDecoder=new UintOptRleDecoder(readVarUint8Array(_))}readLeftID(){return new ID(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ID(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return readAny(this.restDecoder)}readBuf(){return readVarUint8Array(this.restDecoder)}readJSON(){return readAny(this.restDecoder)}readKey(){const _=this.keyClockDecoder.read();if(_<this.keys.length)return this.keys[_];{const y=this.stringDecoder.read();return this.keys.push(y),y}}}class DSEncoderV1{constructor(){this.restEncoder=createEncoder()}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){}writeDsClock(_){writeVarUint(this.restEncoder,_)}writeDsLen(_){writeVarUint(this.restEncoder,_)}}class UpdateEncoderV1 extends DSEncoderV1{writeLeftID(_){writeVarUint(this.restEncoder,_.client),writeVarUint(this.restEncoder,_.clock)}writeRightID(_){writeVarUint(this.restEncoder,_.client),writeVarUint(this.restEncoder,_.clock)}writeClient(_){writeVarUint(this.restEncoder,_)}writeInfo(_){writeUint8(this.restEncoder,_)}writeString(_){writeVarString(this.restEncoder,_)}writeParentInfo(_){writeVarUint(this.restEncoder,_?1:0)}writeTypeRef(_){writeVarUint(this.restEncoder,_)}writeLen(_){writeVarUint(this.restEncoder,_)}writeAny(_){writeAny(this.restEncoder,_)}writeBuf(_){writeVarUint8Array(this.restEncoder,_)}writeJSON(_){writeVarString(this.restEncoder,JSON.stringify(_))}writeKey(_){writeVarString(this.restEncoder,_)}}class DSEncoderV2{constructor(){this.restEncoder=createEncoder(),this.dsCurrVal=0}toUint8Array(){return toUint8Array(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(_){const y=_-this.dsCurrVal;this.dsCurrVal=_,writeVarUint(this.restEncoder,y)}writeDsLen(_){_===0&&unexpectedCase(),writeVarUint(this.restEncoder,_-1),this.dsCurrVal+=_}}class UpdateEncoderV2 extends DSEncoderV2{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new IntDiffOptRleEncoder,this.clientEncoder=new UintOptRleEncoder,this.leftClockEncoder=new IntDiffOptRleEncoder,this.rightClockEncoder=new IntDiffOptRleEncoder,this.infoEncoder=new RleEncoder(writeUint8),this.stringEncoder=new StringEncoder,this.parentInfoEncoder=new RleEncoder(writeUint8),this.typeRefEncoder=new UintOptRleEncoder,this.lenEncoder=new UintOptRleEncoder}toUint8Array(){const _=createEncoder();return writeVarUint(_,0),writeVarUint8Array(_,this.keyClockEncoder.toUint8Array()),writeVarUint8Array(_,this.clientEncoder.toUint8Array()),writeVarUint8Array(_,this.leftClockEncoder.toUint8Array()),writeVarUint8Array(_,this.rightClockEncoder.toUint8Array()),writeVarUint8Array(_,toUint8Array(this.infoEncoder)),writeVarUint8Array(_,this.stringEncoder.toUint8Array()),writeVarUint8Array(_,toUint8Array(this.parentInfoEncoder)),writeVarUint8Array(_,this.typeRefEncoder.toUint8Array()),writeVarUint8Array(_,this.lenEncoder.toUint8Array()),writeUint8Array(_,toUint8Array(this.restEncoder)),toUint8Array(_)}writeLeftID(_){this.clientEncoder.write(_.client),this.leftClockEncoder.write(_.clock)}writeRightID(_){this.clientEncoder.write(_.client),this.rightClockEncoder.write(_.clock)}writeClient(_){this.clientEncoder.write(_)}writeInfo(_){this.infoEncoder.write(_)}writeString(_){this.stringEncoder.write(_)}writeParentInfo(_){this.parentInfoEncoder.write(_?1:0)}writeTypeRef(_){this.typeRefEncoder.write(_)}writeLen(_){this.lenEncoder.write(_)}writeAny(_){writeAny(this.restEncoder,_)}writeBuf(_){writeVarUint8Array(this.restEncoder,_)}writeJSON(_){writeAny(this.restEncoder,_)}writeKey(_){const y=this.keyMap.get(_);y===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(_)):this.keyClockEncoder.write(y)}}const writeStructs=(k,_,y,w)=>{w=max$1(w,_[0].id.clock);const $=findIndexSS(_,w);writeVarUint(k.restEncoder,_.length-$),k.writeClient(y),writeVarUint(k.restEncoder,w);const B=_[$];B.write(k,w-B.id.clock);for(let R=$+1;R<_.length;R++)_[R].write(k,0)},writeClientsStructs=(k,_,y)=>{const w=new Map;y.forEach(($,B)=>{getState(_,B)>$&&w.set(B,$)}),getStateVector(_).forEach(($,B)=>{y.has(B)||w.set(B,0)}),writeVarUint(k.restEncoder,w.size),from(w.entries()).sort(($,B)=>B[0]-$[0]).forEach(([$,B])=>{writeStructs(k,_.clients.get($),$,B)})},readClientsStructRefs=(k,_)=>{const y=create$6(),w=readVarUint(k.restDecoder);for(let $=0;$<w;$++){const B=readVarUint(k.restDecoder),R=new Array(B),H=k.readClient();let j=readVarUint(k.restDecoder);y.set(H,{i:0,refs:R});for(let q=0;q<B;q++){const X=k.readInfo();switch(BITS5&X){case 0:{const ee=k.readLen();R[q]=new GC(createID(H,j),ee),j+=ee;break}case 10:{const ee=readVarUint(k.restDecoder);R[q]=new Skip(createID(H,j),ee),j+=ee;break}default:{const ee=(X&(BIT7|BIT8))===0,te=new Item(createID(H,j),null,(X&BIT8)===BIT8?k.readLeftID():null,null,(X&BIT7)===BIT7?k.readRightID():null,ee?k.readParentInfo()?_.get(k.readString()):k.readLeftID():null,ee&&(X&BIT6)===BIT6?k.readString():null,readItemContent(k,X));R[q]=te,j+=te.length}}}}return y},integrateStructs=(k,_,y)=>{const w=[];let $=from(y.keys()).sort((ne,oe)=>ne-oe);if($.length===0)return null;const B=()=>{if($.length===0)return null;let ne=y.get($[$.length-1]);for(;ne.refs.length===ne.i;)if($.pop(),$.length>0)ne=y.get($[$.length-1]);else return null;return ne};let R=B();if(R===null&&w.length===0)return null;const H=new StructStore,j=new Map,q=(ne,oe)=>{const ie=j.get(ne);(ie==null||ie>oe)&&j.set(ne,oe)};let X=R.refs[R.i++];const ee=new Map,te=()=>{for(const ne of w){const oe=ne.id.client,ie=y.get(oe);ie?(ie.i--,H.clients.set(oe,ie.refs.slice(ie.i)),y.delete(oe),ie.i=0,ie.refs=[]):H.clients.set(oe,[ne]),$=$.filter(ae=>ae!==oe)}w.length=0};for(;;){if(X.constructor!==Skip){const oe=setIfUndefined(ee,X.id.client,()=>getState(_,X.id.client))-X.id.clock;if(oe<0)w.push(X),q(X.id.client,X.id.clock-1),te();else{const ie=X.getMissing(k,_);if(ie!==null){w.push(X);const ae=y.get(ie)||{refs:[],i:0};if(ae.refs.length===ae.i)q(ie,getState(_,ie)),te();else{X=ae.refs[ae.i++];continue}}else(oe===0||oe<X.length)&&(X.integrate(k,oe),ee.set(X.id.client,X.id.clock+X.length))}}if(w.length>0)X=w.pop();else if(R!==null&&R.i<R.refs.length)X=R.refs[R.i++];else{if(R=B(),R===null)break;X=R.refs[R.i++]}}if(H.clients.size>0){const ne=new UpdateEncoderV2;return writeClientsStructs(ne,H,new Map),writeVarUint(ne.restEncoder,0),{missing:j,update:ne.toUint8Array()}}return null},writeStructsFromTransaction=(k,_)=>writeClientsStructs(k,_.doc.store,_.beforeState),readUpdateV2=(k,_,y,w=new UpdateDecoderV2(k))=>transact(_,$=>{$.local=!1;let B=!1;const R=$.doc,H=R.store,j=readClientsStructRefs(w,R),q=integrateStructs($,H,j),X=H.pendingStructs;if(X){for(const[te,ne]of X.missing)if(ne<getState(H,te)){B=!0;break}if(q){for(const[te,ne]of q.missing){const oe=X.missing.get(te);(oe==null||oe>ne)&&X.missing.set(te,ne)}X.update=mergeUpdatesV2([X.update,q.update])}}else H.pendingStructs=q;const ee=readAndApplyDeleteSet(w,$,H);if(H.pendingDs){const te=new UpdateDecoderV2(createDecoder(H.pendingDs));readVarUint(te.restDecoder);const ne=readAndApplyDeleteSet(te,$,H);ee&&ne?H.pendingDs=mergeUpdatesV2([ee,ne]):H.pendingDs=ee||ne}else H.pendingDs=ee;if(B){const te=H.pendingStructs.update;H.pendingStructs=null,applyUpdateV2($.doc,te)}},y,!1),readUpdate=(k,_,y)=>readUpdateV2(k,_,y,new UpdateDecoderV1(k)),applyUpdateV2=(k,_,y,w=UpdateDecoderV2)=>{const $=createDecoder(_);readUpdateV2($,k,y,new w($))},applyUpdate=(k,_,y)=>applyUpdateV2(k,_,y,UpdateDecoderV1),writeStateAsUpdate=(k,_,y=new Map)=>{writeClientsStructs(k,_.store,y),writeDeleteSet(k,createDeleteSetFromStructStore(_.store))},encodeStateAsUpdateV2=(k,_=new Uint8Array([0]),y=new UpdateEncoderV2)=>{const w=decodeStateVector(_);writeStateAsUpdate(y,k,w);const $=[y.toUint8Array()];if(k.store.pendingDs&&$.push(k.store.pendingDs),k.store.pendingStructs&&$.push(diffUpdateV2(k.store.pendingStructs.update,_)),$.length>1){if(y.constructor===UpdateEncoderV1)return mergeUpdates($.map((B,R)=>R===0?B:convertUpdateFormatV2ToV1(B)));if(y.constructor===UpdateEncoderV2)return mergeUpdatesV2($)}return $[0]},encodeStateAsUpdate=(k,_)=>encodeStateAsUpdateV2(k,_,new UpdateEncoderV1),readStateVector=k=>{const _=new Map,y=readVarUint(k.restDecoder);for(let w=0;w<y;w++){const $=readVarUint(k.restDecoder),B=readVarUint(k.restDecoder);_.set($,B)}return _},decodeStateVector=k=>readStateVector(new DSDecoderV1(createDecoder(k))),writeStateVector=(k,_)=>(writeVarUint(k.restEncoder,_.size),from(_.entries()).sort((y,w)=>w[0]-y[0]).forEach(([y,w])=>{writeVarUint(k.restEncoder,y),writeVarUint(k.restEncoder,w)}),k),writeDocumentStateVector=(k,_)=>writeStateVector(k,getStateVector(_.store)),encodeStateVectorV2=(k,_=new DSEncoderV2)=>(k instanceof Map?writeStateVector(_,k):writeDocumentStateVector(_,k),_.toUint8Array()),encodeStateVector=k=>encodeStateVectorV2(k,new DSEncoderV1);class EventHandler{constructor(){this.l=[]}}const createEventHandler=()=>new EventHandler,addEventHandlerListener=(k,_)=>k.l.push(_),removeEventHandlerListener=(k,_)=>{const y=k.l,w=y.length;k.l=y.filter($=>_!==$),w===k.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},callEventHandlerListeners=(k,_,y)=>callAll(k.l,[_,y]);class ID{constructor(_,y){this.client=_,this.clock=y}}const compareIDs=(k,_)=>k===_||k!==null&&_!==null&&k.client===_.client&&k.clock===_.clock,createID=(k,_)=>new ID(k,_),writeID=(k,_)=>{writeVarUint(k,_.client),writeVarUint(k,_.clock)},readID=k=>createID(readVarUint(k),readVarUint(k)),findRootTypeKey=k=>{for(const[_,y]of k.doc.share.entries())if(y===k)return _;throw unexpectedCase()},isParentOf=(k,_)=>{for(;_!==null;){if(_.parent===k)return!0;_=_.parent._item}return!1},logType=k=>{const _=[];let y=k._start;for(;y;)_.push(y),y=y.right;console.log("Children: ",_),console.log("Children content: ",_.filter(w=>!w.deleted).map(w=>w.content))};class PermanentUserData{constructor(_,y=_.getMap("users")){const w=new Map;this.yusers=y,this.doc=_,this.clients=new Map,this.dss=w;const $=(B,R)=>{const H=B.get("ds"),j=B.get("ids"),q=X=>this.clients.set(X,R);H.observe(X=>{X.changes.added.forEach(ee=>{ee.content.getContent().forEach(te=>{te instanceof Uint8Array&&this.dss.set(R,mergeDeleteSets([this.dss.get(R)||createDeleteSet(),readDeleteSet(new DSDecoderV1(createDecoder(te)))]))})})}),this.dss.set(R,mergeDeleteSets(H.map(X=>readDeleteSet(new DSDecoderV1(createDecoder(X)))))),j.observe(X=>X.changes.added.forEach(ee=>ee.content.getContent().forEach(q))),j.forEach(q)};y.observe(B=>{B.keysChanged.forEach(R=>$(y.get(R),R))}),y.forEach($)}setUserMapping(_,y,w,{filter:$=()=>!0}={}){const B=this.yusers;let R=B.get(w);R||(R=new YMap,R.set("ids",new YArray),R.set("ds",new YArray),B.set(w,R)),R.get("ids").push([y]),B.observe(H=>{setTimeout(()=>{const j=B.get(w);if(j!==R){R=j,this.clients.forEach((ee,te)=>{w===ee&&R.get("ids").push([te])});const q=new DSEncoderV1,X=this.dss.get(w);X&&(writeDeleteSet(q,X),R.get("ds").push([q.toUint8Array()]))}},0)}),_.on("afterTransaction",H=>{setTimeout(()=>{const j=R.get("ds"),q=H.deleteSet;if(H.local&&q.clients.size>0&&$(H,q)){const X=new DSEncoderV1;writeDeleteSet(X,q),j.push([X.toUint8Array()])}})})}getUserByClientId(_){return this.clients.get(_)||null}getUserByDeletedId(_){for(const[y,w]of this.dss.entries())if(isDeleted(w,_))return y;return null}}class RelativePosition{constructor(_,y,w,$=0){this.type=_,this.tname=y,this.item=w,this.assoc=$}}const relativePositionToJSON=k=>{const _={};return k.type&&(_.type=k.type),k.tname&&(_.tname=k.tname),k.item&&(_.item=k.item),k.assoc!=null&&(_.assoc=k.assoc),_},createRelativePositionFromJSON=k=>new RelativePosition(k.type==null?null:createID(k.type.client,k.type.clock),k.tname||null,k.item==null?null:createID(k.item.client,k.item.clock),k.assoc==null?0:k.assoc);class AbsolutePosition{constructor(_,y,w=0){this.type=_,this.index=y,this.assoc=w}}const createAbsolutePosition=(k,_,y=0)=>new AbsolutePosition(k,_,y),createRelativePosition=(k,_,y)=>{let w=null,$=null;return k._item===null?$=findRootTypeKey(k):w=createID(k._item.id.client,k._item.id.clock),new RelativePosition(w,$,_,y)},createRelativePositionFromTypeIndex=(k,_,y=0)=>{let w=k._start;if(y<0){if(_===0)return createRelativePosition(k,null,y);_--}for(;w!==null;){if(!w.deleted&&w.countable){if(w.length>_)return createRelativePosition(k,createID(w.id.client,w.id.clock+_),y);_-=w.length}if(w.right===null&&y<0)return createRelativePosition(k,w.lastId,y);w=w.right}return createRelativePosition(k,null,y)},writeRelativePosition=(k,_)=>{const{type:y,tname:w,item:$,assoc:B}=_;if($!==null)writeVarUint(k,0),writeID(k,$);else if(w!==null)writeUint8(k,1),writeVarString(k,w);else if(y!==null)writeUint8(k,2),writeID(k,y);else throw unexpectedCase();return writeVarInt(k,B),k},encodeRelativePosition=k=>{const _=createEncoder();return writeRelativePosition(_,k),toUint8Array(_)},readRelativePosition=k=>{let _=null,y=null,w=null;switch(readVarUint(k)){case 0:w=readID(k);break;case 1:y=readVarString(k);break;case 2:_=readID(k)}const $=hasContent(k)?readVarInt(k):0;return new RelativePosition(_,y,w,$)},decodeRelativePosition=k=>readRelativePosition(createDecoder(k)),createAbsolutePositionFromRelativePosition=(k,_)=>{const y=_.store,w=k.item,$=k.type,B=k.tname,R=k.assoc;let H=null,j=0;if(w!==null){if(getState(y,w.client)<=w.clock)return null;const q=followRedone(y,w),X=q.item;if(!(X instanceof Item))return null;if(H=X.parent,H._item===null||!H._item.deleted){j=X.deleted||!X.countable?0:q.diff+(R>=0?0:1);let ee=X.left;for(;ee!==null;)!ee.deleted&&ee.countable&&(j+=ee.length),ee=ee.left}}else{if(B!==null)H=_.get(B);else if($!==null){if(getState(y,$.client)<=$.clock)return null;const{item:q}=followRedone(y,$);if(q instanceof Item&&q.content instanceof ContentType)H=q.content.type;else return null}else throw unexpectedCase();R>=0?j=H._length:j=0}return createAbsolutePosition(H,j,k.assoc)},compareRelativePositions=(k,_)=>k===_||k!==null&&_!==null&&k.tname===_.tname&&compareIDs(k.item,_.item)&&compareIDs(k.type,_.type)&&k.assoc===_.assoc;class Snapshot{constructor(_,y){this.ds=_,this.sv=y}}const equalSnapshots=(k,_)=>{const y=k.ds.clients,w=_.ds.clients,$=k.sv,B=_.sv;if($.size!==B.size||y.size!==w.size)return!1;for(const[R,H]of $.entries())if(B.get(R)!==H)return!1;for(const[R,H]of y.entries()){const j=w.get(R)||[];if(H.length!==j.length)return!1;for(let q=0;q<H.length;q++){const X=H[q],ee=j[q];if(X.clock!==ee.clock||X.len!==ee.len)return!1}}return!0},encodeSnapshotV2=(k,_=new DSEncoderV2)=>(writeDeleteSet(_,k.ds),writeStateVector(_,k.sv),_.toUint8Array()),encodeSnapshot=k=>encodeSnapshotV2(k,new DSEncoderV1),decodeSnapshotV2=(k,_=new DSDecoderV2(createDecoder(k)))=>new Snapshot(readDeleteSet(_),readStateVector(_)),decodeSnapshot=k=>decodeSnapshotV2(k,new DSDecoderV1(createDecoder(k))),createSnapshot=(k,_)=>new Snapshot(k,_),emptySnapshot=createSnapshot(createDeleteSet(),new Map),snapshot=k=>createSnapshot(createDeleteSetFromStructStore(k.store),getStateVector(k.store)),isVisible$1=(k,_)=>_===void 0?!k.deleted:_.sv.has(k.id.client)&&(_.sv.get(k.id.client)||0)>k.id.clock&&!isDeleted(_.ds,k.id),splitSnapshotAffectedStructs=(k,_)=>{const y=setIfUndefined(k.meta,splitSnapshotAffectedStructs,create$5),w=k.doc.store;y.has(_)||(_.sv.forEach(($,B)=>{$<getState(w,B)&&getItemCleanStart(k,createID(B,$))}),iterateDeletedStructs(k,_.ds,$=>{}),y.add(_))},createDocFromSnapshot=(k,_,y=new Doc)=>{if(k.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");const{sv:w,ds:$}=_,B=new UpdateEncoderV2;return k.transact(R=>{let H=0;w.forEach(j=>{j>0&&H++}),writeVarUint(B.restEncoder,H);for(const[j,q]of w){if(q===0)continue;q<getState(k.store,j)&&getItemCleanStart(R,createID(j,q));const X=k.store.clients.get(j)||[],ee=findIndexSS(X,q-1);writeVarUint(B.restEncoder,ee+1),B.writeClient(j),writeVarUint(B.restEncoder,0);for(let te=0;te<=ee;te++)X[te].write(B,0)}writeDeleteSet(B,$)}),applyUpdateV2(y,B.toUint8Array(),"snapshot"),y},snapshotContainsUpdateV2=(k,_,y=UpdateDecoderV2)=>{const w=new y(createDecoder(_)),$=new LazyStructReader(w,!1);for(let R=$.curr;R!==null;R=$.next())if((k.sv.get(R.id.client)||0)<R.id.clock+R.length)return!1;const B=mergeDeleteSets([k.ds,readDeleteSet(w)]);return equalDeleteSets(k.ds,B)},snapshotContainsUpdate=(k,_)=>snapshotContainsUpdateV2(k,_,UpdateDecoderV1);class StructStore{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const getStateVector=k=>{const _=new Map;return k.clients.forEach((y,w)=>{const $=y[y.length-1];_.set(w,$.id.clock+$.length)}),_},getState=(k,_)=>{const y=k.clients.get(_);if(y===void 0)return 0;const w=y[y.length-1];return w.id.clock+w.length},addStruct=(k,_)=>{let y=k.clients.get(_.id.client);if(y===void 0)y=[],k.clients.set(_.id.client,y);else{const w=y[y.length-1];if(w.id.clock+w.length!==_.id.clock)throw unexpectedCase()}y.push(_)},findIndexSS=(k,_)=>{let y=0,w=k.length-1,$=k[w],B=$.id.clock;if(B===_)return w;let R=floor$1(_/(B+$.length-1)*w);for(;y<=w;){if($=k[R],B=$.id.clock,B<=_){if(_<B+$.length)return R;y=R+1}else w=R-1;R=floor$1((y+w)/2)}throw unexpectedCase()},find$1=(k,_)=>{const y=k.clients.get(_.client);return y[findIndexSS(y,_.clock)]},getItem=find$1,findIndexCleanStart=(k,_,y)=>{const w=findIndexSS(_,y),$=_[w];return $.id.clock<y&&$ instanceof Item?(_.splice(w+1,0,splitItem(k,$,y-$.id.clock)),w+1):w},getItemCleanStart=(k,_)=>{const y=k.doc.store.clients.get(_.client);return y[findIndexCleanStart(k,y,_.clock)]},getItemCleanEnd=(k,_,y)=>{const w=_.clients.get(y.client),$=findIndexSS(w,y.clock),B=w[$];return y.clock!==B.id.clock+B.length-1&&B.constructor!==GC&&w.splice($+1,0,splitItem(k,B,y.clock-B.id.clock+1)),B},replaceStruct=(k,_,y)=>{const w=k.clients.get(_.id.client);w[findIndexSS(w,_.id.clock)]=y},iterateStructs=(k,_,y,w,$)=>{if(w===0)return;const B=y+w;let R=findIndexCleanStart(k,_,y),H;do H=_[R++],B<H.id.clock+H.length&&findIndexCleanStart(k,_,B),$(H);while(R<_.length&&_[R].id.clock<B)};class Transaction{constructor(_,y,w){this.doc=_,this.deleteSet=new DeleteSet,this.beforeState=getStateVector(_.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=y,this.meta=new Map,this.local=w,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const writeUpdateMessageFromTransaction=(k,_)=>_.deleteSet.clients.size===0&&!any(_.afterState,(y,w)=>_.beforeState.get(w)!==y)?!1:(sortAndMergeDeleteSet(_.deleteSet),writeStructsFromTransaction(k,_),writeDeleteSet(k,_.deleteSet),!0),addChangedTypeToTransaction=(k,_,y)=>{const w=_._item;(w===null||w.id.clock<(k.beforeState.get(w.id.client)||0)&&!w.deleted)&&setIfUndefined(k.changed,_,create$5).add(y)},tryToMergeWithLefts=(k,_)=>{let y=k[_],w=k[_-1],$=_;for(;$>0;y=w,w=k[--$-1]){if(w.deleted===y.deleted&&w.constructor===y.constructor&&w.mergeWith(y)){y instanceof Item&&y.parentSub!==null&&y.parent._map.get(y.parentSub)===y&&y.parent._map.set(y.parentSub,w);continue}break}const B=_-$;return B&&k.splice(_+1-B,B),B},tryGcDeleteSet=(k,_,y)=>{for(const[w,$]of k.clients.entries()){const B=_.clients.get(w);for(let R=$.length-1;R>=0;R--){const H=$[R],j=H.clock+H.len;for(let q=findIndexSS(B,H.clock),X=B[q];q<B.length&&X.id.clock<j;X=B[++q]){const ee=B[q];if(H.clock+H.len<=ee.id.clock)break;ee instanceof Item&&ee.deleted&&!ee.keep&&y(ee)&&ee.gc(_,!1)}}}},tryMergeDeleteSet=(k,_)=>{k.clients.forEach((y,w)=>{const $=_.clients.get(w);for(let B=y.length-1;B>=0;B--){const R=y[B],H=min$2($.length-1,1+findIndexSS($,R.clock+R.len-1));for(let j=H,q=$[j];j>0&&q.id.clock>=R.clock;q=$[j])j-=1+tryToMergeWithLefts($,j)}})},tryGc=(k,_,y)=>{tryGcDeleteSet(k,_,y),tryMergeDeleteSet(k,_)},cleanupTransactions=(k,_)=>{if(_<k.length){const y=k[_],w=y.doc,$=w.store,B=y.deleteSet,R=y._mergeStructs;try{sortAndMergeDeleteSet(B),y.afterState=getStateVector(y.doc.store),w.emit("beforeObserverCalls",[y,w]);const H=[];y.changed.forEach((j,q)=>H.push(()=>{(q._item===null||!q._item.deleted)&&q._callObserver(y,j)})),H.push(()=>{y.changedParentTypes.forEach((j,q)=>{q._dEH.l.length>0&&(q._item===null||!q._item.deleted)&&(j=j.filter(X=>X.target._item===null||!X.target._item.deleted),j.forEach(X=>{X.currentTarget=q,X._path=null}),j.sort((X,ee)=>X.path.length-ee.path.length),callEventHandlerListeners(q._dEH,j,y))})}),H.push(()=>w.emit("afterTransaction",[y,w])),callAll(H,[]),y._needFormattingCleanup&&cleanupYTextAfterTransaction(y)}finally{w.gc&&tryGcDeleteSet(B,$,w.gcFilter),tryMergeDeleteSet(B,$),y.afterState.forEach((X,ee)=>{const te=y.beforeState.get(ee)||0;if(te!==X){const ne=$.clients.get(ee),oe=max$1(findIndexSS(ne,te),1);for(let ie=ne.length-1;ie>=oe;)ie-=1+tryToMergeWithLefts(ne,ie)}});for(let X=R.length-1;X>=0;X--){const{client:ee,clock:te}=R[X].id,ne=$.clients.get(ee),oe=findIndexSS(ne,te);oe+1<ne.length&&tryToMergeWithLefts(ne,oe+1)>1||oe>0&&tryToMergeWithLefts(ne,oe)}if(!y.local&&y.afterState.get(w.clientID)!==y.beforeState.get(w.clientID)&&(print(ORANGE,BOLD,"[yjs] ",UNBOLD,RED,"Changed the client-id because another client seems to be using it."),w.clientID=generateNewClientId()),w.emit("afterTransactionCleanup",[y,w]),w._observers.has("update")){const X=new UpdateEncoderV1;writeUpdateMessageFromTransaction(X,y)&&w.emit("update",[X.toUint8Array(),y.origin,w,y])}if(w._observers.has("updateV2")){const X=new UpdateEncoderV2;writeUpdateMessageFromTransaction(X,y)&&w.emit("updateV2",[X.toUint8Array(),y.origin,w,y])}const{subdocsAdded:H,subdocsLoaded:j,subdocsRemoved:q}=y;(H.size>0||q.size>0||j.size>0)&&(H.forEach(X=>{X.clientID=w.clientID,X.collectionid==null&&(X.collectionid=w.collectionid),w.subdocs.add(X)}),q.forEach(X=>w.subdocs.delete(X)),w.emit("subdocs",[{loaded:j,added:H,removed:q},w,y]),q.forEach(X=>X.destroy())),k.length<=_+1?(w._transactionCleanups=[],w.emit("afterAllTransactions",[w,k])):cleanupTransactions(k,_+1)}}},transact=(k,_,y=null,w=!0)=>{const $=k._transactionCleanups;let B=!1,R=null;k._transaction===null&&(B=!0,k._transaction=new Transaction(k,y,w),$.push(k._transaction),$.length===1&&k.emit("beforeAllTransactions",[k]),k.emit("beforeTransaction",[k._transaction,k]));try{R=_(k._transaction)}finally{if(B){const H=k._transaction===$[0];k._transaction=null,H&&cleanupTransactions($,0)}}return R};class StackItem{constructor(_,y){this.insertions=y,this.deletions=_,this.meta=new Map}}const clearUndoManagerStackItem=(k,_,y)=>{iterateDeletedStructs(k,y.deletions,w=>{w instanceof Item&&_.scope.some($=>isParentOf($,w))&&keepItem(w,!1)})},popStackItem=(k,_,y)=>{let w=null,$=null;const B=k.doc,R=k.scope;if(transact(B,H=>{for(;_.length>0&&w===null;){const j=B.store,q=_.pop(),X=new Set,ee=[];let te=!1;iterateDeletedStructs(H,q.insertions,ne=>{if(ne instanceof Item){if(ne.redone!==null){let{item:oe,diff:ie}=followRedone(j,ne.id);ie>0&&(oe=getItemCleanStart(H,createID(oe.id.client,oe.id.clock+ie))),ne=oe}!ne.deleted&&R.some(oe=>isParentOf(oe,ne))&&ee.push(ne)}}),iterateDeletedStructs(H,q.deletions,ne=>{ne instanceof Item&&R.some(oe=>isParentOf(oe,ne))&&!isDeleted(q.insertions,ne.id)&&X.add(ne)}),X.forEach(ne=>{te=redoItem(H,ne,X,q.insertions,k.ignoreRemoteMapChanges,k)!==null||te});for(let ne=ee.length-1;ne>=0;ne--){const oe=ee[ne];k.deleteFilter(oe)&&(oe.delete(H),te=!0)}w=te?q:null}H.changed.forEach((j,q)=>{j.has(null)&&q._searchMarker&&(q._searchMarker.length=0)}),$=H},k),w!=null){const H=$.changedParentTypes;k.emit("stack-item-popped",[{stackItem:w,type:y,changedParentTypes:H},k])}return w};class UndoManager extends Observable{constructor(_,{captureTimeout:y=500,captureTransaction:w=j=>!0,deleteFilter:$=()=>!0,trackedOrigins:B=new Set([null]),ignoreRemoteMapChanges:R=!1,doc:H=isArray(_)?_[0].doc:_.doc}={}){super(),this.scope=[],this.doc=H,this.addToScope(_),this.deleteFilter=$,B.add(this),this.trackedOrigins=B,this.captureTransaction=w,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.lastChange=0,this.ignoreRemoteMapChanges=R,this.captureTimeout=y,this.afterTransactionHandler=j=>{if(!this.captureTransaction(j)||!this.scope.some(ae=>j.changedParentTypes.has(ae))||!this.trackedOrigins.has(j.origin)&&(!j.origin||!this.trackedOrigins.has(j.origin.constructor)))return;const q=this.undoing,X=this.redoing,ee=q?this.redoStack:this.undoStack;q?this.stopCapturing():X||this.clear(!1,!0);const te=new DeleteSet;j.afterState.forEach((ae,re)=>{const se=j.beforeState.get(re)||0,le=ae-se;le>0&&addToDeleteSet(te,re,se,le)});const ne=getUnixTime();let oe=!1;if(this.lastChange>0&&ne-this.lastChange<this.captureTimeout&&ee.length>0&&!q&&!X){const ae=ee[ee.length-1];ae.deletions=mergeDeleteSets([ae.deletions,j.deleteSet]),ae.insertions=mergeDeleteSets([ae.insertions,te])}else ee.push(new StackItem(j.deleteSet,te)),oe=!0;!q&&!X&&(this.lastChange=ne),iterateDeletedStructs(j,j.deleteSet,ae=>{ae instanceof Item&&this.scope.some(re=>isParentOf(re,ae))&&keepItem(ae,!0)});const ie=[{stackItem:ee[ee.length-1],origin:j.origin,type:q?"redo":"undo",changedParentTypes:j.changedParentTypes},this];oe?this.emit("stack-item-added",ie):this.emit("stack-item-updated",ie)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(_){_=isArray(_)?_:[_],_.forEach(y=>{this.scope.every(w=>w!==y)&&(y.doc!==this.doc&&warn("[yjs#509] Not same Y.Doc"),this.scope.push(y))})}addTrackedOrigin(_){this.trackedOrigins.add(_)}removeTrackedOrigin(_){this.trackedOrigins.delete(_)}clear(_=!0,y=!0){(_&&this.canUndo()||y&&this.canRedo())&&this.doc.transact(w=>{_&&(this.undoStack.forEach($=>clearUndoManagerStackItem(w,this,$)),this.undoStack=[]),y&&(this.redoStack.forEach($=>clearUndoManagerStackItem(w,this,$)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:_,redoStackCleared:y}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let _;try{_=popStackItem(this,this.undoStack,"undo")}finally{this.undoing=!1}return _}redo(){this.redoing=!0;let _;try{_=popStackItem(this,this.redoStack,"redo")}finally{this.redoing=!1}return _}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*lazyStructReaderGenerator(k){const _=readVarUint(k.restDecoder);for(let y=0;y<_;y++){const w=readVarUint(k.restDecoder),$=k.readClient();let B=readVarUint(k.restDecoder);for(let R=0;R<w;R++){const H=k.readInfo();if(H===10){const j=readVarUint(k.restDecoder);yield new Skip(createID($,B),j),B+=j}else if(BITS5&H){const j=(H&(BIT7|BIT8))===0,q=new Item(createID($,B),null,(H&BIT8)===BIT8?k.readLeftID():null,null,(H&BIT7)===BIT7?k.readRightID():null,j?k.readParentInfo()?k.readString():k.readLeftID():null,j&&(H&BIT6)===BIT6?k.readString():null,readItemContent(k,H));yield q,B+=q.length}else{const j=k.readLen();yield new GC(createID($,B),j),B+=j}}}}class LazyStructReader{constructor(_,y){this.gen=lazyStructReaderGenerator(_),this.curr=null,this.done=!1,this.filterSkips=y,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Skip);return this.curr}}const logUpdate=k=>logUpdateV2(k,UpdateDecoderV1),logUpdateV2=(k,_=UpdateDecoderV2)=>{const y=[],w=new _(createDecoder(k)),$=new LazyStructReader(w,!1);for(let R=$.curr;R!==null;R=$.next())y.push(R);print("Structs: ",y);const B=readDeleteSet(w);print("DeleteSet: ",B)},decodeUpdate=k=>decodeUpdateV2(k,UpdateDecoderV1),decodeUpdateV2=(k,_=UpdateDecoderV2)=>{const y=[],w=new _(createDecoder(k)),$=new LazyStructReader(w,!1);for(let B=$.curr;B!==null;B=$.next())y.push(B);return{structs:y,ds:readDeleteSet(w)}};class LazyStructWriter{constructor(_){this.currClient=0,this.startClock=0,this.written=0,this.encoder=_,this.clientStructs=[]}}const mergeUpdates=k=>mergeUpdatesV2(k,UpdateDecoderV1,UpdateEncoderV1),encodeStateVectorFromUpdateV2=(k,_=DSEncoderV2,y=UpdateDecoderV2)=>{const w=new _,$=new LazyStructReader(new y(createDecoder(k)),!1);let B=$.curr;if(B!==null){let R=0,H=B.id.client,j=B.id.clock!==0,q=j?0:B.id.clock+B.length;for(;B!==null;B=$.next())H!==B.id.client&&(q!==0&&(R++,writeVarUint(w.restEncoder,H),writeVarUint(w.restEncoder,q)),H=B.id.client,q=0,j=B.id.clock!==0),B.constructor===Skip&&(j=!0),j||(q=B.id.clock+B.length);q!==0&&(R++,writeVarUint(w.restEncoder,H),writeVarUint(w.restEncoder,q));const X=createEncoder();return writeVarUint(X,R),writeBinaryEncoder(X,w.restEncoder),w.restEncoder=X,w.toUint8Array()}else return writeVarUint(w.restEncoder,0),w.toUint8Array()},encodeStateVectorFromUpdate=k=>encodeStateVectorFromUpdateV2(k,DSEncoderV1,UpdateDecoderV1),parseUpdateMetaV2=(k,_=UpdateDecoderV2)=>{const y=new Map,w=new Map,$=new LazyStructReader(new _(createDecoder(k)),!1);let B=$.curr;if(B!==null){let R=B.id.client,H=B.id.clock;for(y.set(R,H);B!==null;B=$.next())R!==B.id.client&&(w.set(R,H),y.set(B.id.client,B.id.clock),R=B.id.client),H=B.id.clock+B.length;w.set(R,H)}return{from:y,to:w}},parseUpdateMeta=k=>parseUpdateMetaV2(k,UpdateDecoderV1),sliceStruct=(k,_)=>{if(k.constructor===GC){const{client:y,clock:w}=k.id;return new GC(createID(y,w+_),k.length-_)}else if(k.constructor===Skip){const{client:y,clock:w}=k.id;return new Skip(createID(y,w+_),k.length-_)}else{const y=k,{client:w,clock:$}=y.id;return new Item(createID(w,$+_),null,createID(w,$+_-1),null,y.rightOrigin,y.parent,y.parentSub,y.content.splice(_))}},mergeUpdatesV2=(k,_=UpdateDecoderV2,y=UpdateEncoderV2)=>{if(k.length===1)return k[0];const w=k.map(X=>new _(createDecoder(X)));let $=w.map(X=>new LazyStructReader(X,!0)),B=null;const R=new y,H=new LazyStructWriter(R);for(;$=$.filter(te=>te.curr!==null),$.sort((te,ne)=>{if(te.curr.id.client===ne.curr.id.client){const oe=te.curr.id.clock-ne.curr.id.clock;return oe===0?te.curr.constructor===ne.curr.constructor?0:te.curr.constructor===Skip?1:-1:oe}else return ne.curr.id.client-te.curr.id.client}),$.length!==0;){const X=$[0],ee=X.curr.id.client;if(B!==null){let te=X.curr,ne=!1;for(;te!==null&&te.id.clock+te.length<=B.struct.id.clock+B.struct.length&&te.id.client>=B.struct.id.client;)te=X.next(),ne=!0;if(te===null||te.id.client!==ee||ne&&te.id.clock>B.struct.id.clock+B.struct.length)continue;if(ee!==B.struct.id.client)writeStructToLazyStructWriter(H,B.struct,B.offset),B={struct:te,offset:0},X.next();else if(B.struct.id.clock+B.struct.length<te.id.clock)if(B.struct.constructor===Skip)B.struct.length=te.id.clock+te.length-B.struct.id.clock;else{writeStructToLazyStructWriter(H,B.struct,B.offset);const oe=te.id.clock-B.struct.id.clock-B.struct.length;B={struct:new Skip(createID(ee,B.struct.id.clock+B.struct.length),oe),offset:0}}else{const oe=B.struct.id.clock+B.struct.length-te.id.clock;oe>0&&(B.struct.constructor===Skip?B.struct.length-=oe:te=sliceStruct(te,oe)),B.struct.mergeWith(te)||(writeStructToLazyStructWriter(H,B.struct,B.offset),B={struct:te,offset:0},X.next())}}else B={struct:X.curr,offset:0},X.next();for(let te=X.curr;te!==null&&te.id.client===ee&&te.id.clock===B.struct.id.clock+B.struct.length&&te.constructor!==Skip;te=X.next())writeStructToLazyStructWriter(H,B.struct,B.offset),B={struct:te,offset:0}}B!==null&&(writeStructToLazyStructWriter(H,B.struct,B.offset),B=null),finishLazyStructWriting(H);const j=w.map(X=>readDeleteSet(X)),q=mergeDeleteSets(j);return writeDeleteSet(R,q),R.toUint8Array()},diffUpdateV2=(k,_,y=UpdateDecoderV2,w=UpdateEncoderV2)=>{const $=decodeStateVector(_),B=new w,R=new LazyStructWriter(B),H=new y(createDecoder(k)),j=new LazyStructReader(H,!1);for(;j.curr;){const X=j.curr,ee=X.id.client,te=$.get(ee)||0;if(j.curr.constructor===Skip){j.next();continue}if(X.id.clock+X.length>te)for(writeStructToLazyStructWriter(R,X,max$1(te-X.id.clock,0)),j.next();j.curr&&j.curr.id.client===ee;)writeStructToLazyStructWriter(R,j.curr,0),j.next();else for(;j.curr&&j.curr.id.client===ee&&j.curr.id.clock+j.curr.length<=te;)j.next()}finishLazyStructWriting(R);const q=readDeleteSet(H);return writeDeleteSet(B,q),B.toUint8Array()},diffUpdate=(k,_)=>diffUpdateV2(k,_,UpdateDecoderV1,UpdateEncoderV1),flushLazyStructWriter=k=>{k.written>0&&(k.clientStructs.push({written:k.written,restEncoder:toUint8Array(k.encoder.restEncoder)}),k.encoder.restEncoder=createEncoder(),k.written=0)},writeStructToLazyStructWriter=(k,_,y)=>{k.written>0&&k.currClient!==_.id.client&&flushLazyStructWriter(k),k.written===0&&(k.currClient=_.id.client,k.encoder.writeClient(_.id.client),writeVarUint(k.encoder.restEncoder,_.id.clock+y)),_.write(k.encoder,y),k.written++},finishLazyStructWriting=k=>{flushLazyStructWriter(k);const _=k.encoder.restEncoder;writeVarUint(_,k.clientStructs.length);for(let y=0;y<k.clientStructs.length;y++){const w=k.clientStructs[y];writeVarUint(_,w.written),writeUint8Array(_,w.restEncoder)}},convertUpdateFormat=(k,_,y,w)=>{const $=new y(createDecoder(k)),B=new LazyStructReader($,!1),R=new w,H=new LazyStructWriter(R);for(let q=B.curr;q!==null;q=B.next())writeStructToLazyStructWriter(H,_(q),0);finishLazyStructWriting(H);const j=readDeleteSet($);return writeDeleteSet(R,j),R.toUint8Array()},createObfuscator=({formatting:k=!0,subdocs:_=!0,yxml:y=!0}={})=>{let w=0;const $=create$6(),B=create$6(),R=create$6(),H=create$6();return H.set(null,null),j=>{switch(j.constructor){case GC:case Skip:return j;case Item:{const q=j,X=q.content;switch(X.constructor){case ContentDeleted:break;case ContentType:{if(y){const ee=X.type;ee instanceof YXmlElement&&(ee.nodeName=setIfUndefined(B,ee.nodeName,()=>"node-"+w)),ee instanceof YXmlHook&&(ee.hookName=setIfUndefined(B,ee.hookName,()=>"hook-"+w))}break}case ContentAny:{const ee=X;ee.arr=ee.arr.map(()=>w);break}case ContentBinary:{const ee=X;ee.content=new Uint8Array([w]);break}case ContentDoc:{const ee=X;_&&(ee.opts={},ee.doc.guid=w+"");break}case ContentEmbed:{const ee=X;ee.embed={};break}case ContentFormat:{const ee=X;k&&(ee.key=setIfUndefined(R,ee.key,()=>w+""),ee.value=setIfUndefined(H,ee.value,()=>({i:w})));break}case ContentJSON:{const ee=X;ee.arr=ee.arr.map(()=>w);break}case ContentString:{const ee=X;ee.str=repeat(w%10+"",ee.str.length);break}default:unexpectedCase()}return q.parentSub&&(q.parentSub=setIfUndefined($,q.parentSub,()=>w+"")),w++,j}default:unexpectedCase()}}},obfuscateUpdate=(k,_)=>convertUpdateFormat(k,createObfuscator(_),UpdateDecoderV1,UpdateEncoderV1),obfuscateUpdateV2=(k,_)=>convertUpdateFormat(k,createObfuscator(_),UpdateDecoderV2,UpdateEncoderV2),convertUpdateFormatV1ToV2=k=>convertUpdateFormat(k,id,UpdateDecoderV1,UpdateEncoderV2),convertUpdateFormatV2ToV1=k=>convertUpdateFormat(k,id,UpdateDecoderV2,UpdateEncoderV1),errorComputeChanges="You must not compute changes after the event-handler fired.";class YEvent{constructor(_,y){this.target=_,this.currentTarget=_,this.transaction=y,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=getPathTo(this.currentTarget,this.target))}deletes(_){return isDeleted(this.transaction.deleteSet,_.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw create$4(errorComputeChanges);const _=new Map,y=this.target;this.transaction.changed.get(y).forEach($=>{if($!==null){const B=y._map.get($);let R,H;if(this.adds(B)){let j=B.left;for(;j!==null&&this.adds(j);)j=j.left;if(this.deletes(B))if(j!==null&&this.deletes(j))R="delete",H=last(j.content.getContent());else return;else j!==null&&this.deletes(j)?(R="update",H=last(j.content.getContent())):(R="add",H=void 0)}else if(this.deletes(B))R="delete",H=last(B.content.getContent());else return;_.set($,{action:R,oldValue:H})}}),this._keys=_}return this._keys}get delta(){return this.changes.delta}adds(_){return _.id.clock>=(this.transaction.beforeState.get(_.id.client)||0)}get changes(){let _=this._changes;if(_===null){if(this.transaction.doc._transactionCleanups.length===0)throw create$4(errorComputeChanges);const y=this.target,w=create$5(),$=create$5(),B=[];if(_={added:w,deleted:$,delta:B,keys:this.keys},this.transaction.changed.get(y).has(null)){let H=null;const j=()=>{H&&B.push(H)};for(let q=y._start;q!==null;q=q.right)q.deleted?this.deletes(q)&&!this.adds(q)&&((H===null||H.delete===void 0)&&(j(),H={delete:0}),H.delete+=q.length,$.add(q)):this.adds(q)?((H===null||H.insert===void 0)&&(j(),H={insert:[]}),H.insert=H.insert.concat(q.content.getContent()),w.add(q)):((H===null||H.retain===void 0)&&(j(),H={retain:0}),H.retain+=q.length);H!==null&&H.retain===void 0&&j()}this._changes=_}return _}}const getPathTo=(k,_)=>{const y=[];for(;_._item!==null&&_!==k;){if(_._item.parentSub!==null)y.unshift(_._item.parentSub);else{let w=0,$=_._item.parent._start;for(;$!==_._item&&$!==null;)$.deleted||w++,$=$.right;y.unshift(w)}_=_._item.parent}return y},maxSearchMarker=80;let globalSearchMarkerTimestamp=0;class ArraySearchMarker{constructor(_,y){_.marker=!0,this.p=_,this.index=y,this.timestamp=globalSearchMarkerTimestamp++}}const refreshMarkerTimestamp=k=>{k.timestamp=globalSearchMarkerTimestamp++},overwriteMarker=(k,_,y)=>{k.p.marker=!1,k.p=_,_.marker=!0,k.index=y,k.timestamp=globalSearchMarkerTimestamp++},markPosition=(k,_,y)=>{if(k.length>=maxSearchMarker){const w=k.reduce(($,B)=>$.timestamp<B.timestamp?$:B);return overwriteMarker(w,_,y),w}else{const w=new ArraySearchMarker(_,y);return k.push(w),w}},findMarker=(k,_)=>{if(k._start===null||_===0||k._searchMarker===null)return null;const y=k._searchMarker.length===0?null:k._searchMarker.reduce((B,R)=>abs(_-B.index)<abs(_-R.index)?B:R);let w=k._start,$=0;for(y!==null&&(w=y.p,$=y.index,refreshMarkerTimestamp(y));w.right!==null&&$<_;){if(!w.deleted&&w.countable){if(_<$+w.length)break;$+=w.length}w=w.right}for(;w.left!==null&&$>_;)w=w.left,!w.deleted&&w.countable&&($-=w.length);for(;w.left!==null&&w.left.id.client===w.id.client&&w.left.id.clock+w.left.length===w.id.clock;)w=w.left,!w.deleted&&w.countable&&($-=w.length);return y!==null&&abs(y.index-$)<w.parent.length/maxSearchMarker?(overwriteMarker(y,w,$),y):markPosition(k._searchMarker,w,$)},updateMarkerChanges=(k,_,y)=>{for(let w=k.length-1;w>=0;w--){const $=k[w];if(y>0){let B=$.p;for(B.marker=!1;B&&(B.deleted||!B.countable);)B=B.left,B&&!B.deleted&&B.countable&&($.index-=B.length);if(B===null||B.marker===!0){k.splice(w,1);continue}$.p=B,B.marker=!0}(_<$.index||y>0&&_===$.index)&&($.index=max$1(_,$.index+y))}},getTypeChildren=k=>{let _=k._start;const y=[];for(;_;)y.push(_),_=_.right;return y},callTypeObservers=(k,_,y)=>{const w=k,$=_.changedParentTypes;for(;setIfUndefined($,k,()=>[]).push(y),k._item!==null;)k=k._item.parent;callEventHandlerListeners(w._eH,y,_)};class AbstractType{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=createEventHandler(),this._dEH=createEventHandler(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(_,y){this.doc=_,this._item=y}_copy(){throw methodUnimplemented()}clone(){throw methodUnimplemented()}_write(_){}get _first(){let _=this._start;for(;_!==null&&_.deleted;)_=_.right;return _}_callObserver(_,y){!_.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(_){addEventHandlerListener(this._eH,_)}observeDeep(_){addEventHandlerListener(this._dEH,_)}unobserve(_){removeEventHandlerListener(this._eH,_)}unobserveDeep(_){removeEventHandlerListener(this._dEH,_)}toJSON(){}}const typeListSlice=(k,_,y)=>{_<0&&(_=k._length+_),y<0&&(y=k._length+y);let w=y-_;const $=[];let B=k._start;for(;B!==null&&w>0;){if(B.countable&&!B.deleted){const R=B.content.getContent();if(R.length<=_)_-=R.length;else{for(let H=_;H<R.length&&w>0;H++)$.push(R[H]),w--;_=0}}B=B.right}return $},typeListToArray=k=>{const _=[];let y=k._start;for(;y!==null;){if(y.countable&&!y.deleted){const w=y.content.getContent();for(let $=0;$<w.length;$++)_.push(w[$])}y=y.right}return _},typeListToArraySnapshot=(k,_)=>{const y=[];let w=k._start;for(;w!==null;){if(w.countable&&isVisible$1(w,_)){const $=w.content.getContent();for(let B=0;B<$.length;B++)y.push($[B])}w=w.right}return y},typeListForEach=(k,_)=>{let y=0,w=k._start;for(;w!==null;){if(w.countable&&!w.deleted){const $=w.content.getContent();for(let B=0;B<$.length;B++)_($[B],y++,k)}w=w.right}},typeListMap=(k,_)=>{const y=[];return typeListForEach(k,(w,$)=>{y.push(_(w,$,k))}),y},typeListCreateIterator=k=>{let _=k._start,y=null,w=0;return{[Symbol.iterator](){return this},next:()=>{if(y===null){for(;_!==null&&_.deleted;)_=_.right;if(_===null)return{done:!0,value:void 0};y=_.content.getContent(),w=0,_=_.right}const $=y[w++];return y.length<=w&&(y=null),{done:!1,value:$}}}},typeListGet=(k,_)=>{const y=findMarker(k,_);let w=k._start;for(y!==null&&(w=y.p,_-=y.index);w!==null;w=w.right)if(!w.deleted&&w.countable){if(_<w.length)return w.content.getContent()[_];_-=w.length}},typeListInsertGenericsAfter=(k,_,y,w)=>{let $=y;const B=k.doc,R=B.clientID,H=B.store,j=y===null?_._start:y.right;let q=[];const X=()=>{q.length>0&&($=new Item(createID(R,getState(H,R)),$,$&&$.lastId,j,j&&j.id,_,null,new ContentAny(q)),$.integrate(k,0),q=[])};w.forEach(ee=>{if(ee===null)q.push(ee);else switch(ee.constructor){case Number:case Object:case Boolean:case Array:case String:q.push(ee);break;default:switch(X(),ee.constructor){case Uint8Array:case ArrayBuffer:$=new Item(createID(R,getState(H,R)),$,$&&$.lastId,j,j&&j.id,_,null,new ContentBinary(new Uint8Array(ee))),$.integrate(k,0);break;case Doc:$=new Item(createID(R,getState(H,R)),$,$&&$.lastId,j,j&&j.id,_,null,new ContentDoc(ee)),$.integrate(k,0);break;default:if(ee instanceof AbstractType)$=new Item(createID(R,getState(H,R)),$,$&&$.lastId,j,j&&j.id,_,null,new ContentType(ee)),$.integrate(k,0);else throw new Error("Unexpected content type in insert operation")}}}),X()},lengthExceeded=()=>create$4("Length exceeded!"),typeListInsertGenerics=(k,_,y,w)=>{if(y>_._length)throw lengthExceeded();if(y===0)return _._searchMarker&&updateMarkerChanges(_._searchMarker,y,w.length),typeListInsertGenericsAfter(k,_,null,w);const $=y,B=findMarker(_,y);let R=_._start;for(B!==null&&(R=B.p,y-=B.index,y===0&&(R=R.prev,y+=R&&R.countable&&!R.deleted?R.length:0));R!==null;R=R.right)if(!R.deleted&&R.countable){if(y<=R.length){y<R.length&&getItemCleanStart(k,createID(R.id.client,R.id.clock+y));break}y-=R.length}return _._searchMarker&&updateMarkerChanges(_._searchMarker,$,w.length),typeListInsertGenericsAfter(k,_,R,w)},typeListPushGenerics=(k,_,y)=>{let $=(_._searchMarker||[]).reduce((B,R)=>R.index>B.index?R:B,{index:0,p:_._start}).p;if($)for(;$.right;)$=$.right;return typeListInsertGenericsAfter(k,_,$,y)},typeListDelete=(k,_,y,w)=>{if(w===0)return;const $=y,B=w,R=findMarker(_,y);let H=_._start;for(R!==null&&(H=R.p,y-=R.index);H!==null&&y>0;H=H.right)!H.deleted&&H.countable&&(y<H.length&&getItemCleanStart(k,createID(H.id.client,H.id.clock+y)),y-=H.length);for(;w>0&&H!==null;)H.deleted||(w<H.length&&getItemCleanStart(k,createID(H.id.client,H.id.clock+w)),H.delete(k),w-=H.length),H=H.right;if(w>0)throw lengthExceeded();_._searchMarker&&updateMarkerChanges(_._searchMarker,$,-B+w)},typeMapDelete=(k,_,y)=>{const w=_._map.get(y);w!==void 0&&w.delete(k)},typeMapSet=(k,_,y,w)=>{const $=_._map.get(y)||null,B=k.doc,R=B.clientID;let H;if(w==null)H=new ContentAny([w]);else switch(w.constructor){case Number:case Object:case Boolean:case Array:case String:H=new ContentAny([w]);break;case Uint8Array:H=new ContentBinary(w);break;case Doc:H=new ContentDoc(w);break;default:if(w instanceof AbstractType)H=new ContentType(w);else throw new Error("Unexpected content type")}new Item(createID(R,getState(B.store,R)),$,$&&$.lastId,null,null,_,y,H).integrate(k,0)},typeMapGet=(k,_)=>{const y=k._map.get(_);return y!==void 0&&!y.deleted?y.content.getContent()[y.length-1]:void 0},typeMapGetAll=k=>{const _={};return k._map.forEach((y,w)=>{y.deleted||(_[w]=y.content.getContent()[y.length-1])}),_},typeMapHas=(k,_)=>{const y=k._map.get(_);return y!==void 0&&!y.deleted},typeMapGetSnapshot=(k,_,y)=>{let w=k._map.get(_)||null;for(;w!==null&&(!y.sv.has(w.id.client)||w.id.clock>=(y.sv.get(w.id.client)||0));)w=w.left;return w!==null&&isVisible$1(w,y)?w.content.getContent()[w.length-1]:void 0},createMapIterator=k=>iteratorFilter(k.entries(),_=>!_[1].deleted);class YArrayEvent extends YEvent{constructor(_,y){super(_,y),this._transaction=y}}class YArray extends AbstractType{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(_){const y=new YArray;return y.push(_),y}_integrate(_,y){super._integrate(_,y),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YArray}clone(){const _=new YArray;return _.insert(0,this.toArray().map(y=>y instanceof AbstractType?y.clone():y)),_}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(_,y){super._callObserver(_,y),callTypeObservers(this,_,new YArrayEvent(this,_))}insert(_,y){this.doc!==null?transact(this.doc,w=>{typeListInsertGenerics(w,this,_,y)}):this._prelimContent.splice(_,0,...y)}push(_){this.doc!==null?transact(this.doc,y=>{typeListPushGenerics(y,this,_)}):this._prelimContent.push(..._)}unshift(_){this.insert(0,_)}delete(_,y=1){this.doc!==null?transact(this.doc,w=>{typeListDelete(w,this,_,y)}):this._prelimContent.splice(_,y)}get(_){return typeListGet(this,_)}toArray(){return typeListToArray(this)}slice(_=0,y=this.length){return typeListSlice(this,_,y)}toJSON(){return this.map(_=>_ instanceof AbstractType?_.toJSON():_)}map(_){return typeListMap(this,_)}forEach(_){typeListForEach(this,_)}[Symbol.iterator](){return typeListCreateIterator(this)}_write(_){_.writeTypeRef(YArrayRefID)}}const readYArray=k=>new YArray;class YMapEvent extends YEvent{constructor(_,y,w){super(_,y),this.keysChanged=w}}class YMap extends AbstractType{constructor(_){super(),this._prelimContent=null,_===void 0?this._prelimContent=new Map:this._prelimContent=new Map(_)}_integrate(_,y){super._integrate(_,y),this._prelimContent.forEach((w,$)=>{this.set($,w)}),this._prelimContent=null}_copy(){return new YMap}clone(){const _=new YMap;return this.forEach((y,w)=>{_.set(w,y instanceof AbstractType?y.clone():y)}),_}_callObserver(_,y){callTypeObservers(this,_,new YMapEvent(this,_,y))}toJSON(){const _={};return this._map.forEach((y,w)=>{if(!y.deleted){const $=y.content.getContent()[y.length-1];_[w]=$ instanceof AbstractType?$.toJSON():$}}),_}get size(){return[...createMapIterator(this._map)].length}keys(){return iteratorMap(createMapIterator(this._map),_=>_[0])}values(){return iteratorMap(createMapIterator(this._map),_=>_[1].content.getContent()[_[1].length-1])}entries(){return iteratorMap(createMapIterator(this._map),_=>[_[0],_[1].content.getContent()[_[1].length-1]])}forEach(_){this._map.forEach((y,w)=>{y.deleted||_(y.content.getContent()[y.length-1],w,this)})}[Symbol.iterator](){return this.entries()}delete(_){this.doc!==null?transact(this.doc,y=>{typeMapDelete(y,this,_)}):this._prelimContent.delete(_)}set(_,y){return this.doc!==null?transact(this.doc,w=>{typeMapSet(w,this,_,y)}):this._prelimContent.set(_,y),y}get(_){return typeMapGet(this,_)}has(_){return typeMapHas(this,_)}clear(){this.doc!==null?transact(this.doc,_=>{this.forEach(function(y,w,$){typeMapDelete(_,$,w)})}):this._prelimContent.clear()}_write(_){_.writeTypeRef(YMapRefID)}}const readYMap=k=>new YMap,equalAttrs=(k,_)=>k===_||typeof k=="object"&&typeof _=="object"&&k&&_&&equalFlat(k,_);class ItemTextListPosition{constructor(_,y,w,$){this.left=_,this.right=y,this.index=w,this.currentAttributes=$}forward(){switch(this.right===null&&unexpectedCase(),this.right.content.constructor){case ContentFormat:this.right.deleted||updateCurrentAttributes(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const findNextPosition=(k,_,y)=>{for(;_.right!==null&&y>0;){switch(_.right.content.constructor){case ContentFormat:_.right.deleted||updateCurrentAttributes(_.currentAttributes,_.right.content);break;default:_.right.deleted||(y<_.right.length&&getItemCleanStart(k,createID(_.right.id.client,_.right.id.clock+y)),_.index+=_.right.length,y-=_.right.length);break}_.left=_.right,_.right=_.right.right}return _},findPosition=(k,_,y)=>{const w=new Map,$=findMarker(_,y);if($){const B=new ItemTextListPosition($.p.left,$.p,$.index,w);return findNextPosition(k,B,y-$.index)}else{const B=new ItemTextListPosition(null,_._start,0,w);return findNextPosition(k,B,y)}},insertNegatedAttributes=(k,_,y,w)=>{for(;y.right!==null&&(y.right.deleted===!0||y.right.content.constructor===ContentFormat&&equalAttrs(w.get(y.right.content.key),y.right.content.value));)y.right.deleted||w.delete(y.right.content.key),y.forward();const $=k.doc,B=$.clientID;w.forEach((R,H)=>{const j=y.left,q=y.right,X=new Item(createID(B,getState($.store,B)),j,j&&j.lastId,q,q&&q.id,_,null,new ContentFormat(H,R));X.integrate(k,0),y.right=X,y.forward()})},updateCurrentAttributes=(k,_)=>{const{key:y,value:w}=_;w===null?k.delete(y):k.set(y,w)},minimizeAttributeChanges=(k,_)=>{for(;k.right!==null;){if(!(k.right.deleted||k.right.content.constructor===ContentFormat&&equalAttrs(_[k.right.content.key]||null,k.right.content.value)))break;k.forward()}},insertAttributes=(k,_,y,w)=>{const $=k.doc,B=$.clientID,R=new Map;for(const H in w){const j=w[H],q=y.currentAttributes.get(H)||null;if(!equalAttrs(q,j)){R.set(H,q);const{left:X,right:ee}=y;y.right=new Item(createID(B,getState($.store,B)),X,X&&X.lastId,ee,ee&&ee.id,_,null,new ContentFormat(H,j)),y.right.integrate(k,0),y.forward()}}return R},insertText=(k,_,y,w,$)=>{y.currentAttributes.forEach((te,ne)=>{$[ne]===void 0&&($[ne]=null)});const B=k.doc,R=B.clientID;minimizeAttributeChanges(y,$);const H=insertAttributes(k,_,y,$),j=w.constructor===String?new ContentString(w):w instanceof AbstractType?new ContentType(w):new ContentEmbed(w);let{left:q,right:X,index:ee}=y;_._searchMarker&&updateMarkerChanges(_._searchMarker,y.index,j.getLength()),X=new Item(createID(R,getState(B.store,R)),q,q&&q.lastId,X,X&&X.id,_,null,j),X.integrate(k,0),y.right=X,y.index=ee,y.forward(),insertNegatedAttributes(k,_,y,H)},formatText=(k,_,y,w,$)=>{const B=k.doc,R=B.clientID;minimizeAttributeChanges(y,$);const H=insertAttributes(k,_,y,$);e:for(;y.right!==null&&(w>0||H.size>0&&(y.right.deleted||y.right.content.constructor===ContentFormat));){if(!y.right.deleted)switch(y.right.content.constructor){case ContentFormat:{const{key:j,value:q}=y.right.content,X=$[j];if(X!==void 0){if(equalAttrs(X,q))H.delete(j);else{if(w===0)break e;H.set(j,q)}y.right.delete(k)}else y.currentAttributes.set(j,q);break}default:w<y.right.length&&getItemCleanStart(k,createID(y.right.id.client,y.right.id.clock+w)),w-=y.right.length;break}y.forward()}if(w>0){let j="";for(;w>0;w--)j+=`
`;y.right=new Item(createID(R,getState(B.store,R)),y.left,y.left&&y.left.lastId,y.right,y.right&&y.right.id,_,null,new ContentString(j)),y.right.integrate(k,0),y.forward()}insertNegatedAttributes(k,_,y,H)},cleanupFormattingGap=(k,_,y,w,$)=>{let B=_;const R=create$6();for(;B&&(!B.countable||B.deleted);){if(!B.deleted&&B.content.constructor===ContentFormat){const q=B.content;R.set(q.key,q)}B=B.right}let H=0,j=!1;for(;_!==B;){if(y===_&&(j=!0),!_.deleted){const q=_.content;switch(q.constructor){case ContentFormat:{const{key:X,value:ee}=q,te=w.get(X)||null;(R.get(X)!==q||te===ee)&&(_.delete(k),H++,!j&&($.get(X)||null)===ee&&te!==ee&&(te===null?$.delete(X):$.set(X,te))),!j&&!_.deleted&&updateCurrentAttributes($,q);break}}}_=_.right}return H},cleanupContextlessFormattingGap=(k,_)=>{for(;_&&_.right&&(_.right.deleted||!_.right.countable);)_=_.right;const y=new Set;for(;_&&(_.deleted||!_.countable);){if(!_.deleted&&_.content.constructor===ContentFormat){const w=_.content.key;y.has(w)?_.delete(k):y.add(w)}_=_.left}},cleanupYTextFormatting=k=>{let _=0;return transact(k.doc,y=>{let w=k._start,$=k._start,B=create$6();const R=copy(B);for(;$;){if($.deleted===!1)switch($.content.constructor){case ContentFormat:updateCurrentAttributes(R,$.content);break;default:_+=cleanupFormattingGap(y,w,$,B,R),B=copy(R),w=$;break}$=$.right}}),_},cleanupYTextAfterTransaction=k=>{const _=new Set,y=k.doc;for(const[w,$]of k.afterState.entries()){const B=k.beforeState.get(w)||0;$!==B&&iterateStructs(k,y.store.clients.get(w),B,$,R=>{!R.deleted&&R.content.constructor===ContentFormat&&R.constructor!==GC&&_.add(R.parent)})}transact(y,w=>{iterateDeletedStructs(k,k.deleteSet,$=>{if($ instanceof GC||!$.parent._hasFormatting||_.has($.parent))return;const B=$.parent;$.content.constructor===ContentFormat?_.add(B):cleanupContextlessFormattingGap(w,$)});for(const $ of _)cleanupYTextFormatting($)})},deleteText=(k,_,y)=>{const w=y,$=copy(_.currentAttributes),B=_.right;for(;y>0&&_.right!==null;){if(_.right.deleted===!1)switch(_.right.content.constructor){case ContentType:case ContentEmbed:case ContentString:y<_.right.length&&getItemCleanStart(k,createID(_.right.id.client,_.right.id.clock+y)),y-=_.right.length,_.right.delete(k);break}_.forward()}B&&cleanupFormattingGap(k,B,_.right,$,_.currentAttributes);const R=(_.left||_.right).parent;return R._searchMarker&&updateMarkerChanges(R._searchMarker,_.index,-w+y),_};class YTextEvent extends YEvent{constructor(_,y,w){super(_,y),this.childListChanged=!1,this.keysChanged=new Set,w.forEach($=>{$===null?this.childListChanged=!0:this.keysChanged.add($)})}get changes(){if(this._changes===null){const _={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=_}return this._changes}get delta(){if(this._delta===null){const _=this.target.doc,y=[];transact(_,w=>{const $=new Map,B=new Map;let R=this.target._start,H=null;const j={};let q="",X=0,ee=0;const te=()=>{if(H!==null){let ne=null;switch(H){case"delete":ee>0&&(ne={delete:ee}),ee=0;break;case"insert":(typeof q=="object"||q.length>0)&&(ne={insert:q},$.size>0&&(ne.attributes={},$.forEach((oe,ie)=>{oe!==null&&(ne.attributes[ie]=oe)}))),q="";break;case"retain":X>0&&(ne={retain:X},isEmpty$1(j)||(ne.attributes=assign({},j))),X=0;break}ne&&y.push(ne),H=null}};for(;R!==null;){switch(R.content.constructor){case ContentType:case ContentEmbed:this.adds(R)?this.deletes(R)||(te(),H="insert",q=R.content.getContent()[0],te()):this.deletes(R)?(H!=="delete"&&(te(),H="delete"),ee+=1):R.deleted||(H!=="retain"&&(te(),H="retain"),X+=1);break;case ContentString:this.adds(R)?this.deletes(R)||(H!=="insert"&&(te(),H="insert"),q+=R.content.str):this.deletes(R)?(H!=="delete"&&(te(),H="delete"),ee+=R.length):R.deleted||(H!=="retain"&&(te(),H="retain"),X+=R.length);break;case ContentFormat:{const{key:ne,value:oe}=R.content;if(this.adds(R)){if(!this.deletes(R)){const ie=$.get(ne)||null;equalAttrs(ie,oe)?oe!==null&&R.delete(w):(H==="retain"&&te(),equalAttrs(oe,B.get(ne)||null)?delete j[ne]:j[ne]=oe)}}else if(this.deletes(R)){B.set(ne,oe);const ie=$.get(ne)||null;equalAttrs(ie,oe)||(H==="retain"&&te(),j[ne]=ie)}else if(!R.deleted){B.set(ne,oe);const ie=j[ne];ie!==void 0&&(equalAttrs(ie,oe)?ie!==null&&R.delete(w):(H==="retain"&&te(),oe===null?delete j[ne]:j[ne]=oe))}R.deleted||(H==="insert"&&te(),updateCurrentAttributes($,R.content));break}}R=R.right}for(te();y.length>0;){const ne=y[y.length-1];if(ne.retain!==void 0&&ne.attributes===void 0)y.pop();else break}}),this._delta=y}return this._delta}}class YText extends AbstractType{constructor(_){super(),this._pending=_!==void 0?[()=>this.insert(0,_)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(_,y){super._integrate(_,y);try{this._pending.forEach(w=>w())}catch(w){console.error(w)}this._pending=null}_copy(){return new YText}clone(){const _=new YText;return _.applyDelta(this.toDelta()),_}_callObserver(_,y){super._callObserver(_,y);const w=new YTextEvent(this,_,y);callTypeObservers(this,_,w),!_.local&&this._hasFormatting&&(_._needFormattingCleanup=!0)}toString(){let _="",y=this._start;for(;y!==null;)!y.deleted&&y.countable&&y.content.constructor===ContentString&&(_+=y.content.str),y=y.right;return _}toJSON(){return this.toString()}applyDelta(_,{sanitize:y=!0}={}){this.doc!==null?transact(this.doc,w=>{const $=new ItemTextListPosition(null,this._start,0,new Map);for(let B=0;B<_.length;B++){const R=_[B];if(R.insert!==void 0){const H=!y&&typeof R.insert=="string"&&B===_.length-1&&$.right===null&&R.insert.slice(-1)===`
`?R.insert.slice(0,-1):R.insert;(typeof H!="string"||H.length>0)&&insertText(w,this,$,H,R.attributes||{})}else R.retain!==void 0?formatText(w,this,$,R.retain,R.attributes||{}):R.delete!==void 0&&deleteText(w,$,R.delete)}}):this._pending.push(()=>this.applyDelta(_))}toDelta(_,y,w){const $=[],B=new Map,R=this.doc;let H="",j=this._start;function q(){if(H.length>0){const ee={};let te=!1;B.forEach((oe,ie)=>{te=!0,ee[ie]=oe});const ne={insert:H};te&&(ne.attributes=ee),$.push(ne),H=""}}const X=()=>{for(;j!==null;){if(isVisible$1(j,_)||y!==void 0&&isVisible$1(j,y))switch(j.content.constructor){case ContentString:{const ee=B.get("ychange");_!==void 0&&!isVisible$1(j,_)?(ee===void 0||ee.user!==j.id.client||ee.type!=="removed")&&(q(),B.set("ychange",w?w("removed",j.id):{type:"removed"})):y!==void 0&&!isVisible$1(j,y)?(ee===void 0||ee.user!==j.id.client||ee.type!=="added")&&(q(),B.set("ychange",w?w("added",j.id):{type:"added"})):ee!==void 0&&(q(),B.delete("ychange")),H+=j.content.str;break}case ContentType:case ContentEmbed:{q();const ee={insert:j.content.getContent()[0]};if(B.size>0){const te={};ee.attributes=te,B.forEach((ne,oe)=>{te[oe]=ne})}$.push(ee);break}case ContentFormat:isVisible$1(j,_)&&(q(),updateCurrentAttributes(B,j.content));break}j=j.right}q()};return _||y?transact(R,ee=>{_&&splitSnapshotAffectedStructs(ee,_),y&&splitSnapshotAffectedStructs(ee,y),X()},"cleanup"):X(),$}insert(_,y,w){if(y.length<=0)return;const $=this.doc;$!==null?transact($,B=>{const R=findPosition(B,this,_);w||(w={},R.currentAttributes.forEach((H,j)=>{w[j]=H})),insertText(B,this,R,y,w)}):this._pending.push(()=>this.insert(_,y,w))}insertEmbed(_,y,w={}){const $=this.doc;$!==null?transact($,B=>{const R=findPosition(B,this,_);insertText(B,this,R,y,w)}):this._pending.push(()=>this.insertEmbed(_,y,w))}delete(_,y){if(y===0)return;const w=this.doc;w!==null?transact(w,$=>{deleteText($,findPosition($,this,_),y)}):this._pending.push(()=>this.delete(_,y))}format(_,y,w){if(y===0)return;const $=this.doc;$!==null?transact($,B=>{const R=findPosition(B,this,_);R.right!==null&&formatText(B,this,R,y,w)}):this._pending.push(()=>this.format(_,y,w))}removeAttribute(_){this.doc!==null?transact(this.doc,y=>{typeMapDelete(y,this,_)}):this._pending.push(()=>this.removeAttribute(_))}setAttribute(_,y){this.doc!==null?transact(this.doc,w=>{typeMapSet(w,this,_,y)}):this._pending.push(()=>this.setAttribute(_,y))}getAttribute(_){return typeMapGet(this,_)}getAttributes(){return typeMapGetAll(this)}_write(_){_.writeTypeRef(YTextRefID)}}const readYText=k=>new YText;class YXmlTreeWalker{constructor(_,y=()=>!0){this._filter=y,this._root=_,this._currentNode=_._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let _=this._currentNode,y=_&&_.content&&_.content.type;if(_!==null&&(!this._firstCall||_.deleted||!this._filter(y)))do if(y=_.content.type,!_.deleted&&(y.constructor===YXmlElement||y.constructor===YXmlFragment)&&y._start!==null)_=y._start;else for(;_!==null;)if(_.right!==null){_=_.right;break}else _.parent===this._root?_=null:_=_.parent._item;while(_!==null&&(_.deleted||!this._filter(_.content.type)));return this._firstCall=!1,_===null?{value:void 0,done:!0}:(this._currentNode=_,{value:_.content.type,done:!1})}}class YXmlFragment extends AbstractType{constructor(){super(),this._prelimContent=[]}get firstChild(){const _=this._first;return _?_.content.getContent()[0]:null}_integrate(_,y){super._integrate(_,y),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new YXmlFragment}clone(){const _=new YXmlFragment;return _.insert(0,this.toArray().map(y=>y instanceof AbstractType?y.clone():y)),_}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(_){return new YXmlTreeWalker(this,_)}querySelector(_){_=_.toUpperCase();const w=new YXmlTreeWalker(this,$=>$.nodeName&&$.nodeName.toUpperCase()===_).next();return w.done?null:w.value}querySelectorAll(_){return _=_.toUpperCase(),from(new YXmlTreeWalker(this,y=>y.nodeName&&y.nodeName.toUpperCase()===_))}_callObserver(_,y){callTypeObservers(this,_,new YXmlEvent(this,y,_))}toString(){return typeListMap(this,_=>_.toString()).join("")}toJSON(){return this.toString()}toDOM(_=document,y={},w){const $=_.createDocumentFragment();return w!==void 0&&w._createAssociation($,this),typeListForEach(this,B=>{$.insertBefore(B.toDOM(_,y,w),null)}),$}insert(_,y){this.doc!==null?transact(this.doc,w=>{typeListInsertGenerics(w,this,_,y)}):this._prelimContent.splice(_,0,...y)}insertAfter(_,y){if(this.doc!==null)transact(this.doc,w=>{const $=_&&_ instanceof AbstractType?_._item:_;typeListInsertGenericsAfter(w,this,$,y)});else{const w=this._prelimContent,$=_===null?0:w.findIndex(B=>B===_)+1;if($===0&&_!==null)throw create$4("Reference item not found");w.splice($,0,...y)}}delete(_,y=1){this.doc!==null?transact(this.doc,w=>{typeListDelete(w,this,_,y)}):this._prelimContent.splice(_,y)}toArray(){return typeListToArray(this)}push(_){this.insert(this.length,_)}unshift(_){this.insert(0,_)}get(_){return typeListGet(this,_)}slice(_=0,y=this.length){return typeListSlice(this,_,y)}forEach(_){typeListForEach(this,_)}_write(_){_.writeTypeRef(YXmlFragmentRefID)}}const readYXmlFragment=k=>new YXmlFragment;class YXmlElement extends YXmlFragment{constructor(_="UNDEFINED"){super(),this.nodeName=_,this._prelimAttrs=new Map}get nextSibling(){const _=this._item?this._item.next:null;return _?_.content.type:null}get prevSibling(){const _=this._item?this._item.prev:null;return _?_.content.type:null}_integrate(_,y){super._integrate(_,y),this._prelimAttrs.forEach((w,$)=>{this.setAttribute($,w)}),this._prelimAttrs=null}_copy(){return new YXmlElement(this.nodeName)}clone(){const _=new YXmlElement(this.nodeName),y=this.getAttributes();return forEach(y,(w,$)=>{typeof w=="string"&&_.setAttribute($,w)}),_.insert(0,this.toArray().map(w=>w instanceof AbstractType?w.clone():w)),_}toString(){const _=this.getAttributes(),y=[],w=[];for(const H in _)w.push(H);w.sort();const $=w.length;for(let H=0;H<$;H++){const j=w[H];y.push(j+'="'+_[j]+'"')}const B=this.nodeName.toLocaleLowerCase(),R=y.length>0?" "+y.join(" "):"";return`<${B}${R}>${super.toString()}</${B}>`}removeAttribute(_){this.doc!==null?transact(this.doc,y=>{typeMapDelete(y,this,_)}):this._prelimAttrs.delete(_)}setAttribute(_,y){this.doc!==null?transact(this.doc,w=>{typeMapSet(w,this,_,y)}):this._prelimAttrs.set(_,y)}getAttribute(_){return typeMapGet(this,_)}hasAttribute(_){return typeMapHas(this,_)}getAttributes(){return typeMapGetAll(this)}toDOM(_=document,y={},w){const $=_.createElement(this.nodeName),B=this.getAttributes();for(const R in B){const H=B[R];typeof H=="string"&&$.setAttribute(R,H)}return typeListForEach(this,R=>{$.appendChild(R.toDOM(_,y,w))}),w!==void 0&&w._createAssociation($,this),$}_write(_){_.writeTypeRef(YXmlElementRefID),_.writeKey(this.nodeName)}}const readYXmlElement=k=>new YXmlElement(k.readKey());class YXmlEvent extends YEvent{constructor(_,y,w){super(_,w),this.childListChanged=!1,this.attributesChanged=new Set,y.forEach($=>{$===null?this.childListChanged=!0:this.attributesChanged.add($)})}}class YXmlHook extends YMap{constructor(_){super(),this.hookName=_}_copy(){return new YXmlHook(this.hookName)}clone(){const _=new YXmlHook(this.hookName);return this.forEach((y,w)=>{_.set(w,y)}),_}toDOM(_=document,y={},w){const $=y[this.hookName];let B;return $!==void 0?B=$.createDom(this):B=document.createElement(this.hookName),B.setAttribute("data-yjs-hook",this.hookName),w!==void 0&&w._createAssociation(B,this),B}_write(_){_.writeTypeRef(YXmlHookRefID),_.writeKey(this.hookName)}}const readYXmlHook=k=>new YXmlHook(k.readKey());class YXmlText extends YText{get nextSibling(){const _=this._item?this._item.next:null;return _?_.content.type:null}get prevSibling(){const _=this._item?this._item.prev:null;return _?_.content.type:null}_copy(){return new YXmlText}clone(){const _=new YXmlText;return _.applyDelta(this.toDelta()),_}toDOM(_=document,y,w){const $=_.createTextNode(this.toString());return w!==void 0&&w._createAssociation($,this),$}toString(){return this.toDelta().map(_=>{const y=[];for(const $ in _.attributes){const B=[];for(const R in _.attributes[$])B.push({key:R,value:_.attributes[$][R]});B.sort((R,H)=>R.key<H.key?-1:1),y.push({nodeName:$,attrs:B})}y.sort(($,B)=>$.nodeName<B.nodeName?-1:1);let w="";for(let $=0;$<y.length;$++){const B=y[$];w+=`<${B.nodeName}`;for(let R=0;R<B.attrs.length;R++){const H=B.attrs[R];w+=` ${H.key}="${H.value}"`}w+=">"}w+=_.insert;for(let $=y.length-1;$>=0;$--)w+=`</${y[$].nodeName}>`;return w}).join("")}toJSON(){return this.toString()}_write(_){_.writeTypeRef(YXmlTextRefID)}}const readYXmlText=k=>new YXmlText;class AbstractStruct{constructor(_,y){this.id=_,this.length=y}get deleted(){throw methodUnimplemented()}mergeWith(_){return!1}write(_,y,w){throw methodUnimplemented()}integrate(_,y){throw methodUnimplemented()}}const structGCRefNumber=0;class GC extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(_){return this.constructor!==_.constructor?!1:(this.length+=_.length,!0)}integrate(_,y){y>0&&(this.id.clock+=y,this.length-=y),addStruct(_.doc.store,this)}write(_,y){_.writeInfo(structGCRefNumber),_.writeLen(this.length-y)}getMissing(_,y){return null}}class ContentBinary{constructor(_){this.content=_}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ContentBinary(this.content)}splice(_){throw methodUnimplemented()}mergeWith(_){return!1}integrate(_,y){}delete(_){}gc(_){}write(_,y){_.writeBuf(this.content)}getRef(){return 3}}const readContentBinary=k=>new ContentBinary(k.readBuf());class ContentDeleted{constructor(_){this.len=_}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ContentDeleted(this.len)}splice(_){const y=new ContentDeleted(this.len-_);return this.len=_,y}mergeWith(_){return this.len+=_.len,!0}integrate(_,y){addToDeleteSet(_.deleteSet,y.id.client,y.id.clock,this.len),y.markDeleted()}delete(_){}gc(_){}write(_,y){_.writeLen(this.len-y)}getRef(){return 1}}const readContentDeleted=k=>new ContentDeleted(k.readLen()),createDocFromOpts=(k,_)=>new Doc({guid:k,..._,shouldLoad:_.shouldLoad||_.autoLoad||!1});class ContentDoc{constructor(_){_._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=_;const y={};this.opts=y,_.gc||(y.gc=!1),_.autoLoad&&(y.autoLoad=!0),_.meta!==null&&(y.meta=_.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ContentDoc(createDocFromOpts(this.doc.guid,this.opts))}splice(_){throw methodUnimplemented()}mergeWith(_){return!1}integrate(_,y){this.doc._item=y,_.subdocsAdded.add(this.doc),this.doc.shouldLoad&&_.subdocsLoaded.add(this.doc)}delete(_){_.subdocsAdded.has(this.doc)?_.subdocsAdded.delete(this.doc):_.subdocsRemoved.add(this.doc)}gc(_){}write(_,y){_.writeString(this.doc.guid),_.writeAny(this.opts)}getRef(){return 9}}const readContentDoc=k=>new ContentDoc(createDocFromOpts(k.readString(),k.readAny()));class ContentEmbed{constructor(_){this.embed=_}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ContentEmbed(this.embed)}splice(_){throw methodUnimplemented()}mergeWith(_){return!1}integrate(_,y){}delete(_){}gc(_){}write(_,y){_.writeJSON(this.embed)}getRef(){return 5}}const readContentEmbed=k=>new ContentEmbed(k.readJSON());class ContentFormat{constructor(_,y){this.key=_,this.value=y}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ContentFormat(this.key,this.value)}splice(_){throw methodUnimplemented()}mergeWith(_){return!1}integrate(_,y){const w=y.parent;w._searchMarker=null,w._hasFormatting=!0}delete(_){}gc(_){}write(_,y){_.writeKey(this.key),_.writeJSON(this.value)}getRef(){return 6}}const readContentFormat=k=>new ContentFormat(k.readKey(),k.readJSON());class ContentJSON{constructor(_){this.arr=_}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentJSON(this.arr)}splice(_){const y=new ContentJSON(this.arr.slice(_));return this.arr=this.arr.slice(0,_),y}mergeWith(_){return this.arr=this.arr.concat(_.arr),!0}integrate(_,y){}delete(_){}gc(_){}write(_,y){const w=this.arr.length;_.writeLen(w-y);for(let $=y;$<w;$++){const B=this.arr[$];_.writeString(B===void 0?"undefined":JSON.stringify(B))}}getRef(){return 2}}const readContentJSON=k=>{const _=k.readLen(),y=[];for(let w=0;w<_;w++){const $=k.readString();$==="undefined"?y.push(void 0):y.push(JSON.parse($))}return new ContentJSON(y)};class ContentAny{constructor(_){this.arr=_}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentAny(this.arr)}splice(_){const y=new ContentAny(this.arr.slice(_));return this.arr=this.arr.slice(0,_),y}mergeWith(_){return this.arr=this.arr.concat(_.arr),!0}integrate(_,y){}delete(_){}gc(_){}write(_,y){const w=this.arr.length;_.writeLen(w-y);for(let $=y;$<w;$++){const B=this.arr[$];_.writeAny(B)}}getRef(){return 8}}const readContentAny=k=>{const _=k.readLen(),y=[];for(let w=0;w<_;w++)y.push(k.readAny());return new ContentAny(y)};class ContentString{constructor(_){this.str=_}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ContentString(this.str)}splice(_){const y=new ContentString(this.str.slice(_));this.str=this.str.slice(0,_);const w=this.str.charCodeAt(_-1);return w>=55296&&w<=56319&&(this.str=this.str.slice(0,_-1)+"�",y.str="�"+y.str.slice(1)),y}mergeWith(_){return this.str+=_.str,!0}integrate(_,y){}delete(_){}gc(_){}write(_,y){_.writeString(y===0?this.str:this.str.slice(y))}getRef(){return 4}}const readContentString=k=>new ContentString(k.readString()),typeRefs=[readYArray,readYMap,readYText,readYXmlElement,readYXmlFragment,readYXmlHook,readYXmlText],YArrayRefID=0,YMapRefID=1,YTextRefID=2,YXmlElementRefID=3,YXmlFragmentRefID=4,YXmlHookRefID=5,YXmlTextRefID=6;class ContentType{constructor(_){this.type=_}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ContentType(this.type._copy())}splice(_){throw methodUnimplemented()}mergeWith(_){return!1}integrate(_,y){this.type._integrate(_.doc,y)}delete(_){let y=this.type._start;for(;y!==null;)y.deleted?y.id.clock<(_.beforeState.get(y.id.client)||0)&&_._mergeStructs.push(y):y.delete(_),y=y.right;this.type._map.forEach(w=>{w.deleted?w.id.clock<(_.beforeState.get(w.id.client)||0)&&_._mergeStructs.push(w):w.delete(_)}),_.changed.delete(this.type)}gc(_){let y=this.type._start;for(;y!==null;)y.gc(_,!0),y=y.right;this.type._start=null,this.type._map.forEach(w=>{for(;w!==null;)w.gc(_,!0),w=w.left}),this.type._map=new Map}write(_,y){this.type._write(_)}getRef(){return 7}}const readContentType=k=>new ContentType(typeRefs[k.readTypeRef()](k)),followRedone=(k,_)=>{let y=_,w=0,$;do w>0&&(y=createID(y.client,y.clock+w)),$=getItem(k,y),w=y.clock-$.id.clock,y=$.redone;while(y!==null&&$ instanceof Item);return{item:$,diff:w}},keepItem=(k,_)=>{for(;k!==null&&k.keep!==_;)k.keep=_,k=k.parent._item},splitItem=(k,_,y)=>{const{client:w,clock:$}=_.id,B=new Item(createID(w,$+y),_,createID(w,$+y-1),_.right,_.rightOrigin,_.parent,_.parentSub,_.content.splice(y));return _.deleted&&B.markDeleted(),_.keep&&(B.keep=!0),_.redone!==null&&(B.redone=createID(_.redone.client,_.redone.clock+y)),_.right=B,B.right!==null&&(B.right.left=B),k._mergeStructs.push(B),B.parentSub!==null&&B.right===null&&B.parent._map.set(B.parentSub,B),_.length=y,B},isDeletedByUndoStack=(k,_)=>some(k,y=>isDeleted(y.deletions,_)),redoItem=(k,_,y,w,$,B)=>{const R=k.doc,H=R.store,j=R.clientID,q=_.redone;if(q!==null)return getItemCleanStart(k,q);let X=_.parent._item,ee=null,te;if(X!==null&&X.deleted===!0){if(X.redone===null&&(!y.has(X)||redoItem(k,X,y,w,$,B)===null))return null;for(;X.redone!==null;)X=getItemCleanStart(k,X.redone)}const ne=X===null?_.parent:X.content.type;if(_.parentSub===null){for(ee=_.left,te=_;ee!==null;){let re=ee;for(;re!==null&&re.parent._item!==X;)re=re.redone===null?null:getItemCleanStart(k,re.redone);if(re!==null&&re.parent._item===X){ee=re;break}ee=ee.left}for(;te!==null;){let re=te;for(;re!==null&&re.parent._item!==X;)re=re.redone===null?null:getItemCleanStart(k,re.redone);if(re!==null&&re.parent._item===X){te=re;break}te=te.right}}else if(te=null,_.right&&!$){for(ee=_;ee!==null&&ee.right!==null&&(ee.right.redone||isDeleted(w,ee.right.id)||isDeletedByUndoStack(B.undoStack,ee.right.id)||isDeletedByUndoStack(B.redoStack,ee.right.id));)for(ee=ee.right;ee.redone;)ee=getItemCleanStart(k,ee.redone);if(ee&&ee.right!==null)return null}else ee=ne._map.get(_.parentSub)||null;const oe=getState(H,j),ie=createID(j,oe),ae=new Item(ie,ee,ee&&ee.lastId,te,te&&te.id,ne,_.parentSub,_.content.copy());return _.redone=ie,keepItem(ae,!0),ae.integrate(k,0),ae};class Item extends AbstractStruct{constructor(_,y,w,$,B,R,H,j){super(_,j.getLength()),this.origin=w,this.left=y,this.right=$,this.rightOrigin=B,this.parent=R,this.parentSub=H,this.redone=null,this.content=j,this.info=this.content.isCountable()?BIT2:0}set marker(_){(this.info&BIT4)>0!==_&&(this.info^=BIT4)}get marker(){return(this.info&BIT4)>0}get keep(){return(this.info&BIT1)>0}set keep(_){this.keep!==_&&(this.info^=BIT1)}get countable(){return(this.info&BIT2)>0}get deleted(){return(this.info&BIT3)>0}set deleted(_){this.deleted!==_&&(this.info^=BIT3)}markDeleted(){this.info|=BIT3}getMissing(_,y){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=getState(y,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=getState(y,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ID&&this.id.client!==this.parent.client&&this.parent.clock>=getState(y,this.parent.client))return this.parent.client;if(this.origin&&(this.left=getItemCleanEnd(_,y,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=getItemCleanStart(_,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===GC||this.right&&this.right.constructor===GC)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Item&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Item&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ID){const w=getItem(y,this.parent);w.constructor===GC?this.parent=null:this.parent=w.content.type}return null}integrate(_,y){if(y>0&&(this.id.clock+=y,this.left=getItemCleanEnd(_,_.doc.store,createID(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(y),this.length-=y),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let w=this.left,$;if(w!==null)$=w.right;else if(this.parentSub!==null)for($=this.parent._map.get(this.parentSub)||null;$!==null&&$.left!==null;)$=$.left;else $=this.parent._start;const B=new Set,R=new Set;for(;$!==null&&$!==this.right;){if(R.add($),B.add($),compareIDs(this.origin,$.origin)){if($.id.client<this.id.client)w=$,B.clear();else if(compareIDs(this.rightOrigin,$.rightOrigin))break}else if($.origin!==null&&R.has(getItem(_.doc.store,$.origin)))B.has(getItem(_.doc.store,$.origin))||(w=$,B.clear());else break;$=$.right}this.left=w}if(this.left!==null){const w=this.left.right;this.right=w,this.left.right=this}else{let w;if(this.parentSub!==null)for(w=this.parent._map.get(this.parentSub)||null;w!==null&&w.left!==null;)w=w.left;else w=this.parent._start,this.parent._start=this;this.right=w}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(_)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),addStruct(_.doc.store,this),this.content.integrate(_,this),addChangedTypeToTransaction(_,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(_)}else new GC(this.id,this.length).integrate(_,0)}get next(){let _=this.right;for(;_!==null&&_.deleted;)_=_.right;return _}get prev(){let _=this.left;for(;_!==null&&_.deleted;)_=_.left;return _}get lastId(){return this.length===1?this.id:createID(this.id.client,this.id.clock+this.length-1)}mergeWith(_){if(this.constructor===_.constructor&&compareIDs(_.origin,this.lastId)&&this.right===_&&compareIDs(this.rightOrigin,_.rightOrigin)&&this.id.client===_.id.client&&this.id.clock+this.length===_.id.clock&&this.deleted===_.deleted&&this.redone===null&&_.redone===null&&this.content.constructor===_.content.constructor&&this.content.mergeWith(_.content)){const y=this.parent._searchMarker;return y&&y.forEach(w=>{w.p===_&&(w.p=this,!this.deleted&&this.countable&&(w.index-=this.length))}),_.keep&&(this.keep=!0),this.right=_.right,this.right!==null&&(this.right.left=this),this.length+=_.length,!0}return!1}delete(_){if(!this.deleted){const y=this.parent;this.countable&&this.parentSub===null&&(y._length-=this.length),this.markDeleted(),addToDeleteSet(_.deleteSet,this.id.client,this.id.clock,this.length),addChangedTypeToTransaction(_,y,this.parentSub),this.content.delete(_)}}gc(_,y){if(!this.deleted)throw unexpectedCase();this.content.gc(_),y?replaceStruct(_,this,new GC(this.id,this.length)):this.content=new ContentDeleted(this.length)}write(_,y){const w=y>0?createID(this.id.client,this.id.clock+y-1):this.origin,$=this.rightOrigin,B=this.parentSub,R=this.content.getRef()&BITS5|(w===null?0:BIT8)|($===null?0:BIT7)|(B===null?0:BIT6);if(_.writeInfo(R),w!==null&&_.writeLeftID(w),$!==null&&_.writeRightID($),w===null&&$===null){const H=this.parent;if(H._item!==void 0){const j=H._item;if(j===null){const q=findRootTypeKey(H);_.writeParentInfo(!0),_.writeString(q)}else _.writeParentInfo(!1),_.writeLeftID(j.id)}else H.constructor===String?(_.writeParentInfo(!0),_.writeString(H)):H.constructor===ID?(_.writeParentInfo(!1),_.writeLeftID(H)):unexpectedCase();B!==null&&_.writeString(B)}this.content.write(_,y)}}const readItemContent=(k,_)=>contentRefs[_&BITS5](k),contentRefs=[()=>{unexpectedCase()},readContentDeleted,readContentJSON,readContentBinary,readContentString,readContentEmbed,readContentFormat,readContentType,readContentAny,readContentDoc,()=>{unexpectedCase()}],structSkipRefNumber=10;class Skip extends AbstractStruct{get deleted(){return!0}delete(){}mergeWith(_){return this.constructor!==_.constructor?!1:(this.length+=_.length,!0)}integrate(_,y){unexpectedCase()}write(_,y){_.writeInfo(structSkipRefNumber),writeVarUint(_.restEncoder,this.length-y)}getMissing(_,y){return null}}const glo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},importIdentifier$3="__ $YJS$ __";glo[importIdentifier$3]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");glo[importIdentifier$3]=!0;const Y=Object.freeze(Object.defineProperty({__proto__:null,AbsolutePosition,AbstractConnector,AbstractStruct,AbstractType,Array:YArray,ContentAny,ContentBinary,ContentDeleted,ContentEmbed,ContentFormat,ContentJSON,ContentString,ContentType,Doc,GC,ID,Item,Map:YMap,PermanentUserData,RelativePosition,Snapshot,Text:YText,Transaction,UndoManager,UpdateEncoderV1,XmlElement:YXmlElement,XmlFragment:YXmlFragment,XmlHook:YXmlHook,XmlText:YXmlText,YArrayEvent,YEvent,YMapEvent,YTextEvent,YXmlEvent,applyUpdate,applyUpdateV2,cleanupYTextFormatting,compareIDs,compareRelativePositions,convertUpdateFormatV1ToV2,convertUpdateFormatV2ToV1,createAbsolutePositionFromRelativePosition,createDeleteSet,createDeleteSetFromStructStore,createDocFromSnapshot,createID,createRelativePositionFromJSON,createRelativePositionFromTypeIndex,createSnapshot,decodeRelativePosition,decodeSnapshot,decodeSnapshotV2,decodeStateVector,decodeUpdate,decodeUpdateV2,diffUpdate,diffUpdateV2,emptySnapshot,encodeRelativePosition,encodeSnapshot,encodeSnapshotV2,encodeStateAsUpdate,encodeStateAsUpdateV2,encodeStateVector,encodeStateVectorFromUpdate,encodeStateVectorFromUpdateV2,equalDeleteSets,equalSnapshots,findIndexSS,findRootTypeKey,getItem,getState,getTypeChildren,isDeleted,isParentOf,iterateDeletedStructs,logType,logUpdate,logUpdateV2,mergeUpdates,mergeUpdatesV2,obfuscateUpdate,obfuscateUpdateV2,parseUpdateMeta,parseUpdateMetaV2,readUpdate,readUpdateV2,relativePositionToJSON,snapshot,snapshotContainsUpdate,transact,tryGc,typeListToArraySnapshot,typeMapGetSnapshot},Symbol.toStringTag,{value:"Module"}));class NativeWrapper extends YMap{constructor(_){const y=["value",_];super([y])}setValue(_){return super.set("value",_)}getValue(){return super.get("value")}}let Text$1=class vt{constructor(_){this._shouldTransact=!0,typeof _=="string"?this._yText=new YText(_):_ instanceof YText?this._yText=_:this._yText=new YText}static fromDelta(_){const y=new YText;return y.applyDelta(_),new vt(y)}get length(){return this._yText.length}get yText(){return this._yText}_transact(_){if(this._shouldTransact){const y=this._yText.doc;if(!y)throw new Error("Failed to transact text! yText is not attached to a doc");y.transact(()=>{_()},y.clientID)}else _()}clone(){return new vt(this._yText.clone())}split(_,y=0){if(_<0||y<0||_+y>this._yText.length)throw new Error("Failed to split text! Index or length out of range, index: "+_+", length: "+y+", text length: "+this._yText.length);const w=this._yText.toDelta();if(!(w instanceof Array))throw new Error("This text cannot be split because we failed to get the deltas of it.");let $=0;const B=[];for(let j=0;j<w.length;j++){const q=w[j].insert;if(typeof q=="string"){if($+q.length>=_+y){const X=q.slice(_+y-$);B.push({insert:X,attributes:w[j].attributes}),B.push(...w.slice(j+1));break}$+=q.length}else throw new Error("This text cannot be split because it contains non-string insert.")}this.delete(_,this.length-_);const R=new YText;return R.applyDelta(B),new vt(R)}insert(_,y,w){if(_.length){if(y<0||y>this._yText.length)throw new Error("Failed to insert text! Index or length out of range, index: "+y+", length: "+length+", text length: "+this._yText.length);this._transact(()=>{this._yText.insert(y,_,w)})}}insertList(_,y){_.length&&this._transact(()=>{for(let w=_.length-1;w>=0;w--)this._yText.insert(y,_[w].insert||"",_[w].attributes)})}join(_){_.toDelta().length&&this._transact(()=>{const w=_._yText.toDelta();w.unshift({retain:this._yText.length}),this._yText.applyDelta(w)})}format(_,y,w){if(y!==0){if(_<0||y<0||_+y>this._yText.length)throw new Error("Failed to format text! Index or length out of range, index: "+_+", length: "+y+", text length: "+this._yText.length);this._transact(()=>{this._yText.format(_,y,w)})}}delete(_,y){if(y!==0){if(_<0||y<0||_+y>this._yText.length)throw new Error("Failed to delete text! Index or length out of range, index: "+_+", length: "+y+", text length: "+this._yText.length);this._transact(()=>{this._yText.delete(_,y)})}}replace(_,y,w,$){if(_<0||y<0||_+y>this._yText.length)throw new Error("Failed to replace text! The length of the text is"+this._yText.length+", but you are trying to replace from"+_+"to"+_+y);this._transact(()=>{this._yText.delete(_,y),this._yText.insert(_,w,$)})}clear(){this._yText.length&&this._transact(()=>{this._yText.delete(0,this._yText.length)})}applyDelta(_){this._transact(()=>{this._yText?.applyDelta(_)})}toDelta(){return this._yText?.toDelta()||[]}sliceToDelta(_,y){const w=[];if(y&&_>=y)return w;const $=this.toDelta();if(_<1&&!y)return $;if($&&$ instanceof Array){let B=0;for(let R=0;R<$.length;R++){const H=$[R];let j=H.insert||"";const q=j.length,X=y&&B+q>y,ee=B+q>_&&w.length===0;if(ee&&X){j=j.slice(_-B,y-B),w.push({...H,insert:j});break}else ee||X?(j=X?j.slice(0,y-B):j.slice(_-B),w.push({...H,insert:j})):w.length>0&&w.push(H);if(y&&B+q>y)break;B=B+q}}return w}toString(){return this._yText?.toString()||""}};const FlavourSchema=z.string(),ParentSchema=z.array(z.string()).optional(),ContentSchema=z.array(z.string()).optional(),role=["root","hub","content"],RoleSchema=z.enum(role),internalPrimitives=Object.freeze({Text:(k="")=>new Text$1(k),Native:(k={})=>new NativeWrapper(k)}),BlockSchema=z.object({version:z.number(),model:z.object({role:RoleSchema,flavour:FlavourSchema,parent:ParentSchema,children:ContentSchema,props:z.function().args(z.custom()).returns(z.record(z.any())).optional(),toModel:z.function().args().returns(z.custom()).optional()}),onUpgrade:z.function().args(z.any(),z.number(),z.number()).returns(z.void()).optional()});function defineBlockSchema({flavour:k,props:_,metadata:y,toModel:w,onUpgrade:$}){const B={version:y.version,model:{role:y.role,parent:y.parent,children:y.children,flavour:k,props:_,toModel:w},onUpgrade:$};return BlockSchema.parse(B),B}function MagicProps(){return class{}}class BaseBlockModel extends MagicProps(){constructor(){super(...arguments),this.created=new Slot$1,this.deleted=new Slot$1,this.propsUpdated=new Slot$1,this.childrenUpdated=new Slot$1,this.childMap=new Map,this.children=[]}originProp(_){return this.yBlock.get(`prop:${_}`)}isEmpty(){return this.children.length===0}firstChild(){return this.children[0]||null}lastChild(){return this.children.length?this.children[this.children.length-1].lastChild():this}firstItem(){return this.children.length?this.children[0]:this}lastItem(){return this.children.length?this.children[this.children.length-1]:this}dispose(){this.created.dispose(),this.deleted.dispose(),this.propsUpdated.dispose(),this.childrenUpdated.dispose()}}var ErrorCode;(function(k){k[k.MIGRATION_ERROR=100]="MIGRATION_ERROR",k[k.SCHEMA_VALIDATE_ERROR=101]="SCHEMA_VALIDATE_ERROR"})(ErrorCode||(ErrorCode={}));var _a;const kInternalError=Symbol("internal_error");class BlockSuiteError extends Error{constructor(_,y){super(y),this[_a]=!0,this.code=_}}_a=kInternalError;class SchemaValidateError extends BlockSuiteError{constructor(_,y){super(ErrorCode.SCHEMA_VALIDATE_ERROR,`Invalid schema for ${_}: ${y}`)}}var balancedMatch=balanced$1;function balanced$1(k,_,y){k instanceof RegExp&&(k=maybeMatch(k,y)),_ instanceof RegExp&&(_=maybeMatch(_,y));var w=range(k,_,y);return w&&{start:w[0],end:w[1],pre:y.slice(0,w[0]),body:y.slice(w[0]+k.length,w[1]),post:y.slice(w[1]+_.length)}}function maybeMatch(k,_){var y=_.match(k);return y?y[0]:null}balanced$1.range=range;function range(k,_,y){var w,$,B,R,H,j=y.indexOf(k),q=y.indexOf(_,j+1),X=j;if(j>=0&&q>0){if(k===_)return[j,q];for(w=[],B=y.length;X>=0&&!H;)X==j?(w.push(X),j=y.indexOf(k,X+1)):w.length==1?H=[w.pop(),q]:($=w.pop(),$<B&&(B=$,R=q),q=y.indexOf(_,X+1)),X=j<q&&j>=0?j:q;w.length&&(H=[B,R])}return H}var balanced=balancedMatch,braceExpansion=expandTop,escSlash="\0SLASH"+Math.random()+"\0",escOpen="\0OPEN"+Math.random()+"\0",escClose="\0CLOSE"+Math.random()+"\0",escComma="\0COMMA"+Math.random()+"\0",escPeriod="\0PERIOD"+Math.random()+"\0";function numeric(k){return parseInt(k,10)==k?parseInt(k,10):k.charCodeAt(0)}function escapeBraces(k){return k.split("\\\\").join(escSlash).split("\\{").join(escOpen).split("\\}").join(escClose).split("\\,").join(escComma).split("\\.").join(escPeriod)}function unescapeBraces(k){return k.split(escSlash).join("\\").split(escOpen).join("{").split(escClose).join("}").split(escComma).join(",").split(escPeriod).join(".")}function parseCommaParts(k){if(!k)return[""];var _=[],y=balanced("{","}",k);if(!y)return k.split(",");var w=y.pre,$=y.body,B=y.post,R=w.split(",");R[R.length-1]+="{"+$+"}";var H=parseCommaParts(B);return B.length&&(R[R.length-1]+=H.shift(),R.push.apply(R,H)),_.push.apply(_,R),_}function expandTop(k){return k?(k.substr(0,2)==="{}"&&(k="\\{\\}"+k.substr(2)),expand(escapeBraces(k),!0).map(unescapeBraces)):[]}function embrace(k){return"{"+k+"}"}function isPadded(k){return/^-?0\d/.test(k)}function lte(k,_){return k<=_}function gte(k,_){return k>=_}function expand(k,_){var y=[],w=balanced("{","}",k);if(!w)return[k];var $=w.pre,B=w.post.length?expand(w.post,!1):[""];if(/\$$/.test(w.pre))for(var R=0;R<B.length;R++){var H=$+"{"+w.body+"}"+B[R];y.push(H)}else{var j=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(w.body),q=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(w.body),X=j||q,ee=w.body.indexOf(",")>=0;if(!X&&!ee)return w.post.match(/,.*\}/)?(k=w.pre+"{"+w.body+escClose+w.post,expand(k)):[k];var te;if(X)te=w.body.split(/\.\./);else if(te=parseCommaParts(w.body),te.length===1&&(te=expand(te[0],!1).map(embrace),te.length===1))return B.map(function(we){return w.pre+te[0]+we});var ne;if(X){var oe=numeric(te[0]),ie=numeric(te[1]),ae=Math.max(te[0].length,te[1].length),re=te.length==3?Math.abs(numeric(te[2])):1,se=lte,le=ie<oe;le&&(re*=-1,se=gte);var ue=te.some(isPadded);ne=[];for(var he=oe;se(he,ie);he+=re){var ce;if(q)ce=String.fromCharCode(he),ce==="\\"&&(ce="");else if(ce=String(he),ue){var ge=ae-ce.length;if(ge>0){var be=new Array(ge+1).join("0");he<0?ce="-"+be+ce.slice(1):ce=be+ce}}ne.push(ce)}}else{ne=[];for(var fe=0;fe<te.length;fe++)ne.push.apply(ne,expand(te[fe],!1))}for(var fe=0;fe<ne.length;fe++)for(var R=0;R<B.length;R++){var H=$+ne[fe]+B[R];(!_||X||H)&&y.push(H)}}return y}const expand$1=getDefaultExportFromCjs(braceExpansion),MAX_PATTERN_LENGTH=1024*64,assertValidPattern=k=>{if(typeof k!="string")throw new TypeError("invalid pattern");if(k.length>MAX_PATTERN_LENGTH)throw new TypeError("pattern is too long")},posixClasses={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},braceEscape=k=>k.replace(/[[\]\\-]/g,"\\$&"),regexpEscape=k=>k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),rangesToString=k=>k.join(""),parseClass=(k,_)=>{const y=_;if(k.charAt(y)!=="[")throw new Error("not in a brace expression");const w=[],$=[];let B=y+1,R=!1,H=!1,j=!1,q=!1,X=y,ee="";e:for(;B<k.length;){const ie=k.charAt(B);if((ie==="!"||ie==="^")&&B===y+1){q=!0,B++;continue}if(ie==="]"&&R&&!j){X=B+1;break}if(R=!0,ie==="\\"&&!j){j=!0,B++;continue}if(ie==="["&&!j){for(const[ae,[re,se,le]]of Object.entries(posixClasses))if(k.startsWith(ae,B)){if(ee)return["$.",!1,k.length-y,!0];B+=ae.length,le?$.push(re):w.push(re),H=H||se;continue e}}if(j=!1,ee){ie>ee?w.push(braceEscape(ee)+"-"+braceEscape(ie)):ie===ee&&w.push(braceEscape(ie)),ee="",B++;continue}if(k.startsWith("-]",B+1)){w.push(braceEscape(ie+"-")),B+=2;continue}if(k.startsWith("-",B+1)){ee=ie,B+=2;continue}w.push(braceEscape(ie)),B++}if(X<B)return["",!1,0,!1];if(!w.length&&!$.length)return["$.",!1,k.length-y,!0];if($.length===0&&w.length===1&&/^\\?.$/.test(w[0])&&!q){const ie=w[0].length===2?w[0].slice(-1):w[0];return[regexpEscape(ie),!1,X-y,!1]}const te="["+(q?"^":"")+rangesToString(w)+"]",ne="["+(q?"":"^")+rangesToString($)+"]";return[w.length&&$.length?"("+te+"|"+ne+")":w.length?te:ne,H,X-y,!0]},unescape$2=(k,{windowsPathsNoEscape:_=!1}={})=>_?k.replace(/\[([^\/\\])\]/g,"$1"):k.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),types=new Set(["!","?","+","*","@"]),isExtglobType=k=>types.has(k),startNoTraversal="(?!(?:^|/)\\.\\.?(?:$|/))",startNoDot="(?!\\.)",addPatternStart=new Set(["[","."]),justDots=new Set(["..","."]),reSpecials=new Set("().*{}+?[]^$\\!"),regExpEscape$1=k=>k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),qmark$1="[^/]",star$1=qmark$1+"*?",starNoEmpty=qmark$1+"+?";class AST{type;#n;#o;#i=!1;#e=[];#t;#s;#l;#a=!1;#r;#c;#h=!1;constructor(_,y,w={}){this.type=_,_&&(this.#o=!0),this.#t=y,this.#n=this.#t?this.#t.#n:this,this.#r=this.#n===this?w:this.#n.#r,this.#l=this.#n===this?[]:this.#n.#l,_==="!"&&!this.#n.#a&&this.#l.push(this),this.#s=this.#t?this.#t.#e.length:0}get hasMagic(){if(this.#o!==void 0)return this.#o;for(const _ of this.#e)if(typeof _!="string"&&(_.type||_.hasMagic))return this.#o=!0;return this.#o}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#e.map(_=>String(_)).join("|")+")":this.#c=this.#e.map(_=>String(_)).join("")}#p(){if(this!==this.#n)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let _;for(;_=this.#l.pop();){if(_.type!=="!")continue;let y=_,w=y.#t;for(;w;){for(let $=y.#s+1;!w.type&&$<w.#e.length;$++)for(const B of _.#e){if(typeof B=="string")throw new Error("string part in extglob AST??");B.copyIn(w.#e[$])}y=w,w=y.#t}}return this}push(..._){for(const y of _)if(y!==""){if(typeof y!="string"&&!(y instanceof AST&&y.#t===this))throw new Error("invalid part: "+y);this.#e.push(y)}}toJSON(){const _=this.type===null?this.#e.slice().map(y=>typeof y=="string"?y:y.toJSON()):[this.type,...this.#e.map(y=>y.toJSON())];return this.isStart()&&!this.type&&_.unshift([]),this.isEnd()&&(this===this.#n||this.#n.#a&&this.#t?.type==="!")&&_.push({}),_}isStart(){if(this.#n===this)return!0;if(!this.#t?.isStart())return!1;if(this.#s===0)return!0;const _=this.#t;for(let y=0;y<this.#s;y++){const w=_.#e[y];if(!(w instanceof AST&&w.type==="!"))return!1}return!0}isEnd(){if(this.#n===this||this.#t?.type==="!")return!0;if(!this.#t?.isEnd())return!1;if(!this.type)return this.#t?.isEnd();const _=this.#t?this.#t.#e.length:0;return this.#s===_-1}copyIn(_){typeof _=="string"?this.push(_):this.push(_.clone(this))}clone(_){const y=new AST(this.type,_);for(const w of this.#e)y.copyIn(w);return y}static#d(_,y,w,$){let B=!1,R=!1,H=-1,j=!1;if(y.type===null){let ne=w,oe="";for(;ne<_.length;){const ie=_.charAt(ne++);if(B||ie==="\\"){B=!B,oe+=ie;continue}if(R){ne===H+1?(ie==="^"||ie==="!")&&(j=!0):ie==="]"&&!(ne===H+2&&j)&&(R=!1),oe+=ie;continue}else if(ie==="["){R=!0,H=ne,j=!1,oe+=ie;continue}if(!$.noext&&isExtglobType(ie)&&_.charAt(ne)==="("){y.push(oe),oe="";const ae=new AST(ie,y);ne=AST.#d(_,ae,ne,$),y.push(ae);continue}oe+=ie}return y.push(oe),ne}let q=w+1,X=new AST(null,y);const ee=[];let te="";for(;q<_.length;){const ne=_.charAt(q++);if(B||ne==="\\"){B=!B,te+=ne;continue}if(R){q===H+1?(ne==="^"||ne==="!")&&(j=!0):ne==="]"&&!(q===H+2&&j)&&(R=!1),te+=ne;continue}else if(ne==="["){R=!0,H=q,j=!1,te+=ne;continue}if(isExtglobType(ne)&&_.charAt(q)==="("){X.push(te),te="";const oe=new AST(ne,X);X.push(oe),q=AST.#d(_,oe,q,$);continue}if(ne==="|"){X.push(te),te="",ee.push(X),X=new AST(null,y);continue}if(ne===")")return te===""&&y.#e.length===0&&(y.#h=!0),X.push(te),te="",y.push(...ee,X),q;te+=ne}return y.type=null,y.#o=void 0,y.#e=[_.substring(w-1)],q}static fromGlob(_,y={}){const w=new AST(null,void 0,y);return AST.#d(_,w,0,y),w}toMMPattern(){if(this!==this.#n)return this.#n.toMMPattern();const _=this.toString(),[y,w,$,B]=this.toRegExpSource();if(!($||this.#o||this.#r.nocase&&!this.#r.nocaseMagicOnly&&_.toUpperCase()!==_.toLowerCase()))return w;const H=(this.#r.nocase?"i":"")+(B?"u":"");return Object.assign(new RegExp(`^${y}$`,H),{_src:y,_glob:_})}toRegExpSource(_){const y=_??!!this.#r.dot;if(this.#n===this&&this.#p(),!this.type){const j=this.isStart()&&this.isEnd(),q=this.#e.map(ne=>{const[oe,ie,ae,re]=typeof ne=="string"?AST.#f(ne,this.#o,j):ne.toRegExpSource(_);return this.#o=this.#o||ae,this.#i=this.#i||re,oe}).join("");let X="";if(this.isStart()&&typeof this.#e[0]=="string"&&!(this.#e.length===1&&justDots.has(this.#e[0]))){const oe=addPatternStart,ie=y&&oe.has(q.charAt(0))||q.startsWith("\\.")&&oe.has(q.charAt(2))||q.startsWith("\\.\\.")&&oe.has(q.charAt(4)),ae=!y&&!_&&oe.has(q.charAt(0));X=ie?startNoTraversal:ae?startNoDot:""}let ee="";return this.isEnd()&&this.#n.#a&&this.#t?.type==="!"&&(ee="(?:$|\\/)"),[X+q+ee,unescape$2(q),this.#o=!!this.#o,this.#i]}const w=this.type==="*"||this.type==="+",$=this.type==="!"?"(?:(?!(?:":"(?:";let B=this.#u(y);if(this.isStart()&&this.isEnd()&&!B&&this.type!=="!"){const j=this.toString();return this.#e=[j],this.type=null,this.#o=void 0,[j,unescape$2(this.toString()),!1,!1]}let R=!w||_||y||!startNoDot?"":this.#u(!0);R===B&&(R=""),R&&(B=`(?:${B})(?:${R})*?`);let H="";if(this.type==="!"&&this.#h)H=(this.isStart()&&!y?startNoDot:"")+starNoEmpty;else{const j=this.type==="!"?"))"+(this.isStart()&&!y&&!_?startNoDot:"")+star$1+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&R?")":this.type==="*"&&R?")?":`)${this.type}`;H=$+B+j}return[H,unescape$2(B),this.#o=!!this.#o,this.#i]}#u(_){return this.#e.map(y=>{if(typeof y=="string")throw new Error("string type in extglob ast??");const[w,$,B,R]=y.toRegExpSource(_);return this.#i=this.#i||R,w}).filter(y=>!(this.isStart()&&this.isEnd())||!!y).join("|")}static#f(_,y,w=!1){let $=!1,B="",R=!1;for(let H=0;H<_.length;H++){const j=_.charAt(H);if($){$=!1,B+=(reSpecials.has(j)?"\\":"")+j;continue}if(j==="\\"){H===_.length-1?B+="\\\\":$=!0;continue}if(j==="["){const[q,X,ee,te]=parseClass(_,H);if(ee){B+=q,R=R||X,H+=ee-1,y=y||te;continue}}if(j==="*"){w&&_==="*"?B+=starNoEmpty:B+=star$1,y=!0;continue}if(j==="?"){B+=qmark$1,y=!0;continue}B+=regExpEscape$1(j)}return[B,unescape$2(_),!!y,R]}}const escape$2=(k,{windowsPathsNoEscape:_=!1}={})=>_?k.replace(/[?*()[\]]/g,"[$&]"):k.replace(/[?*()[\]\\]/g,"\\$&"),minimatch=(k,_,y={})=>(assertValidPattern(_),!y.nocomment&&_.charAt(0)==="#"?!1:new Minimatch(_,y).match(k)),starDotExtRE=/^\*+([^+@!?\*\[\(]*)$/,starDotExtTest=k=>_=>!_.startsWith(".")&&_.endsWith(k),starDotExtTestDot=k=>_=>_.endsWith(k),starDotExtTestNocase=k=>(k=k.toLowerCase(),_=>!_.startsWith(".")&&_.toLowerCase().endsWith(k)),starDotExtTestNocaseDot=k=>(k=k.toLowerCase(),_=>_.toLowerCase().endsWith(k)),starDotStarRE=/^\*+\.\*+$/,starDotStarTest=k=>!k.startsWith(".")&&k.includes("."),starDotStarTestDot=k=>k!=="."&&k!==".."&&k.includes("."),dotStarRE=/^\.\*+$/,dotStarTest=k=>k!=="."&&k!==".."&&k.startsWith("."),starRE=/^\*+$/,starTest=k=>k.length!==0&&!k.startsWith("."),starTestDot=k=>k.length!==0&&k!=="."&&k!=="..",qmarksRE=/^\?+([^+@!?\*\[\(]*)?$/,qmarksTestNocase=([k,_=""])=>{const y=qmarksTestNoExt([k]);return _?(_=_.toLowerCase(),w=>y(w)&&w.toLowerCase().endsWith(_)):y},qmarksTestNocaseDot=([k,_=""])=>{const y=qmarksTestNoExtDot([k]);return _?(_=_.toLowerCase(),w=>y(w)&&w.toLowerCase().endsWith(_)):y},qmarksTestDot=([k,_=""])=>{const y=qmarksTestNoExtDot([k]);return _?w=>y(w)&&w.endsWith(_):y},qmarksTest=([k,_=""])=>{const y=qmarksTestNoExt([k]);return _?w=>y(w)&&w.endsWith(_):y},qmarksTestNoExt=([k])=>{const _=k.length;return y=>y.length===_&&!y.startsWith(".")},qmarksTestNoExtDot=([k])=>{const _=k.length;return y=>y.length===_&&y!=="."&&y!==".."},defaultPlatform=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&{}.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",path={win32:{sep:"\\"},posix:{sep:"/"}},sep=defaultPlatform==="win32"?path.win32.sep:path.posix.sep;minimatch.sep=sep;const GLOBSTAR=Symbol("globstar **");minimatch.GLOBSTAR=GLOBSTAR;const qmark="[^/]",star=qmark+"*?",twoStarDot="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",twoStarNoDot="(?:(?!(?:\\/|^)\\.).)*?",filter=(k,_={})=>y=>minimatch(y,k,_);minimatch.filter=filter;const ext=(k,_={})=>Object.assign({},k,_),defaults$2=k=>{if(!k||typeof k!="object"||!Object.keys(k).length)return minimatch;const _=minimatch;return Object.assign((w,$,B={})=>_(w,$,ext(k,B)),{Minimatch:class extends _.Minimatch{constructor($,B={}){super($,ext(k,B))}static defaults($){return _.defaults(ext(k,$)).Minimatch}},AST:class extends _.AST{constructor($,B,R={}){super($,B,ext(k,R))}static fromGlob($,B={}){return _.AST.fromGlob($,ext(k,B))}},unescape:(w,$={})=>_.unescape(w,ext(k,$)),escape:(w,$={})=>_.escape(w,ext(k,$)),filter:(w,$={})=>_.filter(w,ext(k,$)),defaults:w=>_.defaults(ext(k,w)),makeRe:(w,$={})=>_.makeRe(w,ext(k,$)),braceExpand:(w,$={})=>_.braceExpand(w,ext(k,$)),match:(w,$,B={})=>_.match(w,$,ext(k,B)),sep:_.sep,GLOBSTAR})};minimatch.defaults=defaults$2;const braceExpand=(k,_={})=>(assertValidPattern(k),_.nobrace||!/\{(?:(?!\{).)*\}/.test(k)?[k]:expand$1(k));minimatch.braceExpand=braceExpand;const makeRe=(k,_={})=>new Minimatch(k,_).makeRe();minimatch.makeRe=makeRe;const match$1=(k,_,y={})=>{const w=new Minimatch(_,y);return k=k.filter($=>w.match($)),w.options.nonull&&!k.length&&k.push(_),k};minimatch.match=match$1;const globMagic=/[?*]|[+@!]\(.*?\)|\[|\]/,regExpEscape=k=>k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Minimatch{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(_,y={}){assertValidPattern(_),y=y||{},this.options=y,this.pattern=_,this.platform=y.platform||defaultPlatform,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!y.windowsPathsNoEscape||y.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!y.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!y.nonegate,this.comment=!1,this.empty=!1,this.partial=!!y.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=y.windowsNoMagicRoot!==void 0?y.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const _ of this.set)for(const y of _)if(typeof y!="string")return!0;return!1}debug(..._){}make(){const _=this.pattern,y=this.options;if(!y.nocomment&&_.charAt(0)==="#"){this.comment=!0;return}if(!_){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],y.debug&&(this.debug=(...B)=>console.error(...B)),this.debug(this.pattern,this.globSet);const w=this.globSet.map(B=>this.slashSplit(B));this.globParts=this.preprocess(w),this.debug(this.pattern,this.globParts);let $=this.globParts.map((B,R,H)=>{if(this.isWindows&&this.windowsNoMagicRoot){const j=B[0]===""&&B[1]===""&&(B[2]==="?"||!globMagic.test(B[2]))&&!globMagic.test(B[3]),q=/^[a-z]:/i.test(B[0]);if(j)return[...B.slice(0,4),...B.slice(4).map(X=>this.parse(X))];if(q)return[B[0],...B.slice(1).map(X=>this.parse(X))]}return B.map(j=>this.parse(j))});if(this.debug(this.pattern,$),this.set=$.filter(B=>B.indexOf(!1)===-1),this.isWindows)for(let B=0;B<this.set.length;B++){const R=this.set[B];R[0]===""&&R[1]===""&&this.globParts[B][2]==="?"&&typeof R[3]=="string"&&/^[a-z]:$/i.test(R[3])&&(R[2]="?")}this.debug(this.pattern,this.set)}preprocess(_){if(this.options.noglobstar)for(let w=0;w<_.length;w++)for(let $=0;$<_[w].length;$++)_[w][$]==="**"&&(_[w][$]="*");const{optimizationLevel:y=1}=this.options;return y>=2?(_=this.firstPhasePreProcess(_),_=this.secondPhasePreProcess(_)):y>=1?_=this.levelOneOptimize(_):_=this.adjascentGlobstarOptimize(_),_}adjascentGlobstarOptimize(_){return _.map(y=>{let w=-1;for(;(w=y.indexOf("**",w+1))!==-1;){let $=w;for(;y[$+1]==="**";)$++;$!==w&&y.splice(w,$-w)}return y})}levelOneOptimize(_){return _.map(y=>(y=y.reduce((w,$)=>{const B=w[w.length-1];return $==="**"&&B==="**"?w:$===".."&&B&&B!==".."&&B!=="."&&B!=="**"?(w.pop(),w):(w.push($),w)},[]),y.length===0?[""]:y))}levelTwoFileOptimize(_){Array.isArray(_)||(_=this.slashSplit(_));let y=!1;do{if(y=!1,!this.preserveMultipleSlashes){for(let $=1;$<_.length-1;$++){const B=_[$];$===1&&B===""&&_[0]===""||(B==="."||B==="")&&(y=!0,_.splice($,1),$--)}_[0]==="."&&_.length===2&&(_[1]==="."||_[1]==="")&&(y=!0,_.pop())}let w=0;for(;(w=_.indexOf("..",w+1))!==-1;){const $=_[w-1];$&&$!=="."&&$!==".."&&$!=="**"&&(y=!0,_.splice(w-1,2),w-=2)}}while(y);return _.length===0?[""]:_}firstPhasePreProcess(_){let y=!1;do{y=!1;for(let w of _){let $=-1;for(;($=w.indexOf("**",$+1))!==-1;){let R=$;for(;w[R+1]==="**";)R++;R>$&&w.splice($+1,R-$);let H=w[$+1];const j=w[$+2],q=w[$+3];if(H!==".."||!j||j==="."||j===".."||!q||q==="."||q==="..")continue;y=!0,w.splice($,1);const X=w.slice(0);X[$]="**",_.push(X),$--}if(!this.preserveMultipleSlashes){for(let R=1;R<w.length-1;R++){const H=w[R];R===1&&H===""&&w[0]===""||(H==="."||H==="")&&(y=!0,w.splice(R,1),R--)}w[0]==="."&&w.length===2&&(w[1]==="."||w[1]==="")&&(y=!0,w.pop())}let B=0;for(;(B=w.indexOf("..",B+1))!==-1;){const R=w[B-1];if(R&&R!=="."&&R!==".."&&R!=="**"){y=!0;const j=B===1&&w[B+1]==="**"?["."]:[];w.splice(B-1,2,...j),w.length===0&&w.push(""),B-=2}}}}while(y);return _}secondPhasePreProcess(_){for(let y=0;y<_.length-1;y++)for(let w=y+1;w<_.length;w++){const $=this.partsMatch(_[y],_[w],!this.preserveMultipleSlashes);$&&(_[y]=$,_[w]=[])}return _.filter(y=>y.length)}partsMatch(_,y,w=!1){let $=0,B=0,R=[],H="";for(;$<_.length&&B<y.length;)if(_[$]===y[B])R.push(H==="b"?y[B]:_[$]),$++,B++;else if(w&&_[$]==="**"&&y[B]===_[$+1])R.push(_[$]),$++;else if(w&&y[B]==="**"&&_[$]===y[B+1])R.push(y[B]),B++;else if(_[$]==="*"&&y[B]&&(this.options.dot||!y[B].startsWith("."))&&y[B]!=="**"){if(H==="b")return!1;H="a",R.push(_[$]),$++,B++}else if(y[B]==="*"&&_[$]&&(this.options.dot||!_[$].startsWith("."))&&_[$]!=="**"){if(H==="a")return!1;H="b",R.push(y[B]),$++,B++}else return!1;return _.length===y.length&&R}parseNegate(){if(this.nonegate)return;const _=this.pattern;let y=!1,w=0;for(let $=0;$<_.length&&_.charAt($)==="!";$++)y=!y,w++;w&&(this.pattern=_.slice(w)),this.negate=y}matchOne(_,y,w=!1){const $=this.options;if(this.isWindows){const ie=typeof _[0]=="string"&&/^[a-z]:$/i.test(_[0]),ae=!ie&&_[0]===""&&_[1]===""&&_[2]==="?"&&/^[a-z]:$/i.test(_[3]),re=typeof y[0]=="string"&&/^[a-z]:$/i.test(y[0]),se=!re&&y[0]===""&&y[1]===""&&y[2]==="?"&&typeof y[3]=="string"&&/^[a-z]:$/i.test(y[3]),le=ae?3:ie?0:void 0,ue=se?3:re?0:void 0;if(typeof le=="number"&&typeof ue=="number"){const[he,ce]=[_[le],y[ue]];he.toLowerCase()===ce.toLowerCase()&&(y[ue]=he,ue>le?y=y.slice(ue):le>ue&&(_=_.slice(le)))}}const{optimizationLevel:B=1}=this.options;B>=2&&(_=this.levelTwoFileOptimize(_)),this.debug("matchOne",this,{file:_,pattern:y}),this.debug("matchOne",_.length,y.length);for(var R=0,H=0,j=_.length,q=y.length;R<j&&H<q;R++,H++){this.debug("matchOne loop");var X=y[H],ee=_[R];if(this.debug(y,X,ee),X===!1)return!1;if(X===GLOBSTAR){this.debug("GLOBSTAR",[y,X,ee]);var te=R,ne=H+1;if(ne===q){for(this.debug("** at the end");R<j;R++)if(_[R]==="."||_[R]===".."||!$.dot&&_[R].charAt(0)===".")return!1;return!0}for(;te<j;){var oe=_[te];if(this.debug(`
globstar while`,_,te,y,ne,oe),this.matchOne(_.slice(te),y.slice(ne),w))return this.debug("globstar found match!",te,j,oe),!0;if(oe==="."||oe===".."||!$.dot&&oe.charAt(0)==="."){this.debug("dot detected!",_,te,y,ne);break}this.debug("globstar swallow a segment, and continue"),te++}return!!(w&&(this.debug(`
>>> no match, partial?`,_,te,y,ne),te===j))}let ie;if(typeof X=="string"?(ie=ee===X,this.debug("string match",X,ee,ie)):(ie=X.test(ee),this.debug("pattern match",X,ee,ie)),!ie)return!1}if(R===j&&H===q)return!0;if(R===j)return w;if(H===q)return R===j-1&&_[R]==="";throw new Error("wtf?")}braceExpand(){return braceExpand(this.pattern,this.options)}parse(_){assertValidPattern(_);const y=this.options;if(_==="**")return GLOBSTAR;if(_==="")return"";let w,$=null;(w=_.match(starRE))?$=y.dot?starTestDot:starTest:(w=_.match(starDotExtRE))?$=(y.nocase?y.dot?starDotExtTestNocaseDot:starDotExtTestNocase:y.dot?starDotExtTestDot:starDotExtTest)(w[1]):(w=_.match(qmarksRE))?$=(y.nocase?y.dot?qmarksTestNocaseDot:qmarksTestNocase:y.dot?qmarksTestDot:qmarksTest)(w):(w=_.match(starDotStarRE))?$=y.dot?starDotStarTestDot:starDotStarTest:(w=_.match(dotStarRE))&&($=dotStarTest);const B=AST.fromGlob(_,this.options).toMMPattern();return $?Object.assign(B,{test:$}):B}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const _=this.set;if(!_.length)return this.regexp=!1,this.regexp;const y=this.options,w=y.noglobstar?star:y.dot?twoStarDot:twoStarNoDot,$=new Set(y.nocase?["i"]:[]);let B=_.map(j=>{const q=j.map(X=>{if(X instanceof RegExp)for(const ee of X.flags.split(""))$.add(ee);return typeof X=="string"?regExpEscape(X):X===GLOBSTAR?GLOBSTAR:X._src});return q.forEach((X,ee)=>{const te=q[ee+1],ne=q[ee-1];X!==GLOBSTAR||ne===GLOBSTAR||(ne===void 0?te!==void 0&&te!==GLOBSTAR?q[ee+1]="(?:\\/|"+w+"\\/)?"+te:q[ee]=w:te===void 0?q[ee-1]=ne+"(?:\\/|"+w+")?":te!==GLOBSTAR&&(q[ee-1]=ne+"(?:\\/|\\/"+w+"\\/)"+te,q[ee+1]=GLOBSTAR))}),q.filter(X=>X!==GLOBSTAR).join("/")}).join("|");const[R,H]=_.length>1?["(?:",")"]:["",""];B="^"+R+B+H+"$",this.negate&&(B="^(?!"+B+").+$");try{this.regexp=new RegExp(B,[...$].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(_){return this.preserveMultipleSlashes?_.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(_)?["",..._.split(/\/+/)]:_.split(/\/+/)}match(_,y=this.partial){if(this.debug("match",_,this.pattern),this.comment)return!1;if(this.empty)return _==="";if(_==="/"&&y)return!0;const w=this.options;this.isWindows&&(_=_.split("\\").join("/"));const $=this.slashSplit(_);this.debug(this.pattern,"split",$);const B=this.set;this.debug(this.pattern,"set",B);let R=$[$.length-1];if(!R)for(let H=$.length-2;!R&&H>=0;H--)R=$[H];for(let H=0;H<B.length;H++){const j=B[H];let q=$;if(w.matchBase&&j.length===1&&(q=[R]),this.matchOne(q,j,y))return w.flipNegate?!0:!this.negate}return w.flipNegate?!1:this.negate}static defaults(_){return minimatch.defaults(_).Minimatch}}minimatch.AST=AST;minimatch.Minimatch=Minimatch;minimatch.escape=escape$2;minimatch.unescape=unescape$2;const WORKSPACE_VERSION=2,PAGE_VERSION=1,SCHEMA_NOT_FOUND_MESSAGE="Schema not found. The block flavour may not be registered.";var src={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.isPlainObject=_.clone=_.recursive=_.merge=_.main=void 0,k.exports=_=y,_.default=y;function y(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];return w.apply(void 0,q)}_.main=y,y.clone=B,y.isPlainObject=R,y.recursive=$;function w(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];return j(q[0]===!0,!1,q)}_.merge=w;function $(){for(var q=[],X=0;X<arguments.length;X++)q[X]=arguments[X];return j(q[0]===!0,!0,q)}_.recursive=$;function B(q){if(Array.isArray(q)){for(var X=[],ee=0;ee<q.length;++ee)X.push(B(q[ee]));return X}else if(R(q)){var X={};for(var ee in q)X[ee]=B(q[ee]);return X}else return q}_.clone=B;function R(q){return q&&typeof q=="object"&&!Array.isArray(q)}_.isPlainObject=R;function H(q,X){if(!R(q))return X;for(var ee in X)ee==="__proto__"||ee==="constructor"||ee==="prototype"||(q[ee]=R(q[ee])&&R(X[ee])?H(q[ee],X[ee]):X[ee]);return q}function j(q,X,ee){var te;(q||!R(te=ee.shift()))&&(te={});for(var ne=0;ne<ee.length;++ne){var oe=ee[ne];if(R(oe)){for(var ie in oe)if(!(ie==="__proto__"||ie==="constructor"||ie==="prototype")){var ae=q?B(oe[ie]):oe[ie];te[ie]=X?H(te[ie],ae):ae}}}return te}})(src,src.exports);var srcExports=src.exports;class AwarenessStore{constructor(_,y,w){this.slots={update:new Slot$1},this._onAwarenessChange=$=>{const{added:B,removed:R,updated:H}=$,j=this.awareness.getStates();B.forEach(q=>{this.slots.update.emit({id:q,type:"add",state:j.get(q)})}),H.forEach(q=>{this.slots.update.emit({id:q,type:"update",state:j.get(q)})}),R.forEach(q=>{this.slots.update.emit({id:q,type:"remove"})})},this.store=_,this.awareness=y,this.awareness.on("change",this._onAwarenessChange),this.awareness.setLocalStateField("selection",[]),this._initFlags(w)}_initFlags(_){const y=this.awareness.getLocalState()?.flags,w=y?srcExports.merge(!0,_,y):{..._};this.awareness.setLocalStateField("flags",w)}setFlag(_,y){const w=this.awareness.getLocalState()?.flags??{};this.awareness.setLocalStateField("flags",{...w,[_]:y})}getFlag(_){return(this.awareness.getLocalState()?.flags??{})[_]}setReadonly(_,y){const w=this.getFlag("readonly")??{};this.setFlag("readonly",{...w,[_.prefixedId]:y})}isReadonly(_){const y=this.getFlag("readonly");return y&&typeof y=="object"?!!y[_.prefixedId]:!1}setLocalSelection(_){this.awareness.setLocalStateField("selection",_)}getLocalSelection(){return this.awareness.getLocalState()?.selection||[]}getStates(){return this.awareness.getStates()}destroy(){this.awareness&&(this.awareness.off("change",this._onAwarenessChange),this.slots.update.dispose())}}var ansiColors={exports:{}},symbols={exports:{}},hasRequiredSymbols;function requireSymbols(){return hasRequiredSymbols||(hasRequiredSymbols=1,function(k){const _=typeof process<"u"&&{}.TERM_PROGRAM==="Hyper",y=typeof process<"u"&&process.platform==="win32",w=typeof process<"u"&&process.platform==="linux",$={ballotDisabled:"☒",ballotOff:"☐",ballotOn:"☑",bullet:"•",bulletWhite:"◦",fullBlock:"█",heart:"❤",identicalTo:"≡",line:"─",mark:"※",middot:"·",minus:"－",multiplication:"×",obelus:"÷",pencilDownRight:"✎",pencilRight:"✏",pencilUpRight:"✐",percent:"%",pilcrow2:"❡",pilcrow:"¶",plusMinus:"±",question:"?",section:"§",starsOff:"☆",starsOn:"★",upDownArrow:"↕"},B=Object.assign({},$,{check:"√",cross:"×",ellipsisLarge:"...",ellipsis:"...",info:"i",questionSmall:"?",pointer:">",pointerSmall:"»",radioOff:"( )",radioOn:"(*)",warning:"‼"}),R=Object.assign({},$,{ballotCross:"✘",check:"✔",cross:"✖",ellipsisLarge:"⋯",ellipsis:"…",info:"ℹ",questionFull:"？",questionSmall:"﹖",pointer:w?"▸":"❯",pointerSmall:w?"‣":"›",radioOff:"◯",radioOn:"◉",warning:"⚠"});k.exports=y&&!_?B:R,Reflect.defineProperty(k.exports,"common",{enumerable:!1,value:$}),Reflect.defineProperty(k.exports,"windows",{enumerable:!1,value:B}),Reflect.defineProperty(k.exports,"other",{enumerable:!1,value:R})}(symbols)),symbols.exports}const isObject=k=>k!==null&&typeof k=="object"&&!Array.isArray(k),ANSI_REGEX=/[\u001b\u009b][[\]#;?()]*(?:(?:(?:[^\W_]*;?[^\W_]*)\u0007)|(?:(?:[0-9]{1,4}(;[0-9]{0,4})*)?[~0-9=<>cf-nqrtyA-PRZ]))/g,hasColor=()=>typeof process<"u"?{}.FORCE_COLOR!=="0":!1,create=()=>{const k={enabled:hasColor(),visible:!0,styles:{},keys:{}},_=B=>{let R=B.open=`\x1B[${B.codes[0]}m`,H=B.close=`\x1B[${B.codes[1]}m`,j=B.regex=new RegExp(`\\u001b\\[${B.codes[1]}m`,"g");return B.wrap=(q,X)=>{q.includes(H)&&(q=q.replace(j,H+R));let ee=R+q+H;return X?ee.replace(/\r*\n/g,`${H}$&${R}`):ee},B},y=(B,R,H)=>typeof B=="function"?B(R):B.wrap(R,H),w=(B,R)=>{if(B===""||B==null)return"";if(k.enabled===!1)return B;if(k.visible===!1)return"";let H=""+B,j=H.includes(`
`),q=R.length;for(q>0&&R.includes("unstyle")&&(R=[...new Set(["unstyle",...R])].reverse());q-- >0;)H=y(k.styles[R[q]],H,j);return H},$=(B,R,H)=>{k.styles[B]=_({name:B,codes:R}),(k.keys[H]||(k.keys[H]=[])).push(B),Reflect.defineProperty(k,B,{configurable:!0,enumerable:!0,set(q){k.alias(B,q)},get(){let q=X=>w(X,q.stack);return Reflect.setPrototypeOf(q,k),q.stack=this.stack?this.stack.concat(B):[B],q}})};return $("reset",[0,0],"modifier"),$("bold",[1,22],"modifier"),$("dim",[2,22],"modifier"),$("italic",[3,23],"modifier"),$("underline",[4,24],"modifier"),$("inverse",[7,27],"modifier"),$("hidden",[8,28],"modifier"),$("strikethrough",[9,29],"modifier"),$("black",[30,39],"color"),$("red",[31,39],"color"),$("green",[32,39],"color"),$("yellow",[33,39],"color"),$("blue",[34,39],"color"),$("magenta",[35,39],"color"),$("cyan",[36,39],"color"),$("white",[37,39],"color"),$("gray",[90,39],"color"),$("grey",[90,39],"color"),$("bgBlack",[40,49],"bg"),$("bgRed",[41,49],"bg"),$("bgGreen",[42,49],"bg"),$("bgYellow",[43,49],"bg"),$("bgBlue",[44,49],"bg"),$("bgMagenta",[45,49],"bg"),$("bgCyan",[46,49],"bg"),$("bgWhite",[47,49],"bg"),$("blackBright",[90,39],"bright"),$("redBright",[91,39],"bright"),$("greenBright",[92,39],"bright"),$("yellowBright",[93,39],"bright"),$("blueBright",[94,39],"bright"),$("magentaBright",[95,39],"bright"),$("cyanBright",[96,39],"bright"),$("whiteBright",[97,39],"bright"),$("bgBlackBright",[100,49],"bgBright"),$("bgRedBright",[101,49],"bgBright"),$("bgGreenBright",[102,49],"bgBright"),$("bgYellowBright",[103,49],"bgBright"),$("bgBlueBright",[104,49],"bgBright"),$("bgMagentaBright",[105,49],"bgBright"),$("bgCyanBright",[106,49],"bgBright"),$("bgWhiteBright",[107,49],"bgBright"),k.ansiRegex=ANSI_REGEX,k.hasColor=k.hasAnsi=B=>(k.ansiRegex.lastIndex=0,typeof B=="string"&&B!==""&&k.ansiRegex.test(B)),k.alias=(B,R)=>{let H=typeof R=="string"?k[R]:R;if(typeof H!="function")throw new TypeError("Expected alias to be the name of an existing color (string) or a function");H.stack||(Reflect.defineProperty(H,"name",{value:B}),k.styles[B]=H,H.stack=[B]),Reflect.defineProperty(k,B,{configurable:!0,enumerable:!0,set(j){k.alias(B,j)},get(){let j=q=>w(q,j.stack);return Reflect.setPrototypeOf(j,k),j.stack=this.stack?this.stack.concat(H.stack):H.stack,j}})},k.theme=B=>{if(!isObject(B))throw new TypeError("Expected theme to be an object");for(let R of Object.keys(B))k.alias(R,B[R]);return k},k.alias("unstyle",B=>typeof B=="string"&&B!==""?(k.ansiRegex.lastIndex=0,B.replace(k.ansiRegex,"")):""),k.alias("noop",B=>B),k.none=k.clear=k.noop,k.stripColor=k.unstyle,k.symbols=requireSymbols(),k.define=$,k};ansiColors.exports=create();ansiColors.exports.create=create;const whitelist=new Set,all=new Set,debug=k=>(all.add(k),(_,y,w)=>{const $=w.value;return assertExists$1($),assertEquals$1(typeof $,"function"),w.value=function(...R){return!k||whitelist.has(k),$.apply(this,R)},w});function isPureObject(k){return typeof k=="object"&&k!==null&&!Array.isArray(k)&&!(k instanceof YMap)&&!(k instanceof YArray)&&!(k instanceof YText)}function native2Y(k,_){if(k instanceof YText)return k.doc?k.clone():k;if(Array.isArray(k)){const y=new YArray,w=k.map($=>_?native2Y($,_):$);return y.insert(0,w),y}if(isPureObject(k)){const y=new YMap;return Object.entries(k).forEach(([w,$])=>{y.set(w,_?native2Y($,_):$)}),y}return k}class ProxyManager{constructor(){this._proxies=new WeakMap,this._applyYChanges=(_,y)=>{const w=this._proxies.get(_);assertExists$1(w,"YData is not subscribed before changes");const $=_.doc;return assertExists$1($,"YData is not attached to a document"),$.once("beforeObserverCalls",B=>{B.isLocalProxy=!0}),y()}}_initialize(_,y,w){const{deep:$}=w;(y instanceof YArray||y instanceof YMap)&&y.forEach((B,R)=>{const H=$&&(B instanceof YMap||B instanceof YArray)?this.createYProxy(B,w):B;_[R]=H})}_subscribeYArray(_,y,w){const{deep:$=!1}=w,B=R=>{if(R.transaction.isLocalProxy)return;let H=0;R.changes.delta.forEach(j=>{if(j.retain&&(H+=j.retain),j.delete&&_.splice(H,j.delete),j.insert){const q=[j.insert].flat();if($){const X=q.filter(ee=>!this._proxies.has(ee)).map(ee=>ee instanceof YMap||ee instanceof YArray?this.createYProxy(ee,w):ee);_.splice(H,0,...X)}else _.splice(H,0,...q);H+=j.insert.length}})};y.observe(B)}_subscribeYMap(_,y,w){const{deep:$=!1}=w,B=R=>{R.transaction.isLocalProxy||R.keysChanged.forEach(H=>{const j=R.changes.keys.get(H);if(j){if(j.action==="delete")delete _[H];else if(j.action==="add"||j.action==="update"){const q=y.get(H);$&&(q instanceof YMap||q instanceof YArray)?this._proxies.has(q)?_[H]=this._proxies.get(q):_[H]=this.createYProxy(q,w):_[H]=q}}})};y.observe(B)}createYProxy(_,y={}){if(this._proxies.has(_))return this._proxies.get(_);if(_ instanceof NativeWrapper){const w=this._createYMapProxy(_,{...y,deep:!1});return this._proxies.set(_,w),w}if(_ instanceof YArray){const w=this._createYArrayProxy(_,y);return this._proxies.set(_,w),w}if(_ instanceof YMap){const w=this._createYMapProxy(_,y);return this._proxies.set(_,w),w}throw new TypeError}_createYArrayProxy(_,y={}){const{readonly:w=!1,deep:$=!1}=y,B=[];if(!(_ instanceof YArray))throw new TypeError;return this._initialize(B,_,y),this._subscribeYArray(B,_,y),new Proxy(B,{has:(R,H)=>Reflect.has(R,H),set:(R,H,j,q)=>{if(w)throw new Error("Modify data is not allowed");if(typeof H!="string")throw new Error("key cannot be a symbol");return this._applyYChanges(_,()=>{const X=Number(H);if(Number.isNaN(X))return Reflect.set(R,H,j,q);const ee=te=>{X<_.length&&_.delete(X,1),_.insert(X,[te])};if($&&(isPureObject(j)||Array.isArray(j))){const te=native2Y(j,$);ee(te);const ne=this.createYProxy(te,y);return Reflect.set(R,H,ne,q)}return ee(j),Reflect.set(R,H,j,q)})},get:(R,H,j)=>Reflect.get(R,H,j),deleteProperty:(R,H)=>{if(w)throw new Error("Modify data is not allowed");if(typeof H!="string")throw new Error("key cannot be a symbol");return this._applyYChanges(_,()=>{const j=Number(H);return Number.isNaN(j)||_.delete(j,1),Reflect.deleteProperty(R,H)})}})}_createYMapProxy(_,y={}){const{readonly:w=!1,deep:$=!1}=y,B={};if(!(_ instanceof YMap))throw new TypeError;return this._initialize(B,_,y),this._subscribeYMap(B,_,y),new Proxy(B,{has:(R,H)=>Reflect.has(R,H),set:(R,H,j,q)=>{if(w)throw new Error("Modify data is not allowed");if(typeof H!="string")throw new Error("key cannot be a symbol");return this._applyYChanges(_,()=>{if($&&(isPureObject(j)||Array.isArray(j))){const X=native2Y(j,$);_.set(H,X);const ee=this.createYProxy(X,y);return Reflect.set(R,H,ee,q)}return _.set(H,j),Reflect.set(R,H,j,q)})},get:(R,H,j)=>Reflect.get(R,H,j),deleteProperty:(R,H)=>{if(w)throw new Error("Modify data is not allowed");if(typeof H!="string")throw new Error("key cannot be a symbol");return this._applyYChanges(_,()=>(_.delete(H),Reflect.deleteProperty(R,H)))}})}}var __decorate$2D=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class BlockSuiteDoc extends Doc{constructor(){super(...arguments),this.proxy=new ProxyManager,this._spaces=this.getMap("spaces")}get spaces(){return this._spaces}toJSON(){const _=super.toJSON();delete _.spaces;const y={};return this.spaces.forEach((w,$)=>{y[$]=w.toJSON()}),{..._,spaces:y}}getMapProxy(_,y={}){const w=super.getMap(_);return this.proxy.createYProxy(w,y)}getArrayProxy(_,y={}){const w=super.getArray(_);return this.proxy.createYProxy(w,y)}transact(_,y){return super.transact(_,y)}}__decorate$2D([debug("transact")],BlockSuiteDoc.prototype,"transact",null);const TEXT_UNIQ_IDENTIFIER="$blocksuite:internal:text$",NATIVE_UNIQ_IDENTIFIER="$blocksuite:internal:native$";function toJSON(k){if(k instanceof Doc)throw new Error("Y.Doc is not supported");if(k instanceof NativeWrapper)return{[NATIVE_UNIQ_IDENTIFIER]:!0,value:k.getValue()};if(k instanceof YText)return{[TEXT_UNIQ_IDENTIFIER]:!0,delta:k.toDelta()};if(k instanceof YMap){const _={};return k.forEach((y,w)=>{_[w]=toJSON(y)}),_}return k instanceof YArray?k.toArray().map(_=>toJSON(_)):k}function docToJSON(k){const _={};return k.share.forEach((y,w)=>{_[w]=toJSON(y)}),_}function fromJSON(k){if(Array.isArray(k)){const _=new YArray,y=k.map(w=>fromJSON(w));return _.insert(0,y),_}if(k instanceof Object){if(Reflect.has(k,NATIVE_UNIQ_IDENTIFIER))return new NativeWrapper(Reflect.get(k,"value"));if(Reflect.has(k,TEXT_UNIQ_IDENTIFIER)){const y=new YText;return y.applyDelta(Reflect.get(k,"delta")),y}const _=new YMap;return Object.entries(k).forEach(([y,w])=>{_.set(y,fromJSON(w))}),_}return k}function docFromJSON(k){const _=new Doc;return Object.entries(k).forEach(([y,w])=>{const $=_.getMap(y);Object.entries(w).forEach(([B,R])=>{$.set(B,fromJSON(R))})}),console.log(_.toJSON()),_}const SYS_KEYS=new Set(["id","flavour","children"]);function assertValidChildren(k,_){Array.isArray(_.children)&&_.children.forEach(y=>{if(!k.has(y.id))throw new Error("Invalid child id: "+y.id)})}function initInternalProps(k,_){k.set("sys:id",_.id),k.set("sys:flavour",_.flavour);const y=new YArray;k.set("sys:children",y),Array.isArray(_.children)&&_.children.forEach(w=>y.push([w.id]))}function syncBlockProps(k,_,y,w){const $=k.model.props?.(internalPrimitives)??{},B=k.model.flavour;Object.entries(y).forEach(([R,H])=>{if(SYS_KEYS.has(R)||w.has(R))return;if($[R]instanceof Text$1){H instanceof Text$1?_.set(`prop:${R}`,H.yText):_.set(`prop:${R}`,new YText(H));return}if(!isPrimitive$1(H)&&!Array.isArray(H)&&typeof H!="object")throw new Error("Only top level primitives are supported for now");if(B==="affine:surface"&&R==="elements"){const q=new YMap;Object.entries(H).forEach(([X,ee])=>{q.set(X,native2Y(ee,!1))}),_.set(`prop:${R}`,q);return}H!==void 0&&(Array.isArray(H)||isPureObject(H)?_.set(`prop:${R}`,native2Y(H,!0)):_.set(`prop:${R}`,H))}),Object.entries($).forEach(([R,H])=>{(!_.has(`prop:${R}`)||_.get(`prop:${R}`)===void 0)&&(H instanceof Text$1?_.set(`prop:${R}`,H.yText):Array.isArray(H)||isPureObject(H)?_.set(`prop:${R}`,native2Y(H,!0)):_.set(`prop:${R}`,H))})}function toBlockProps(k,_){const y={deep:!0},w=k.toJSON(),$={};return Object.keys(w).forEach(B=>{w[B]&&B.startsWith("sys:")&&($[B.replace("sys:","")]=w[B])}),Object.keys(w).forEach(B=>{if(w[B]&&B.startsWith("prop:")){const R=B.replace("prop:",""),H=k.get(B);if(H instanceof YMap){const j=_.createYProxy(H,y);$[R]=j}else if(H instanceof YArray){const j=_.createYProxy(H,y);$[R]=j}else $[R]=w[B]}}),$}function isInsideBlockByFlavour(k,_,y){const w=k.getParent(_);return w===null?!1:y===w.flavour?!0:isInsideBlockByFlavour(k,w,y)}function toBlockMigrationData(k,_){const y={deep:!0},w=toBlockProps(k,_);return new Proxy(w,{has:($,B)=>Reflect.has($,B),set:($,B,R,H)=>{if(typeof B!="string")throw new Error("key cannot be a symbol");if(isPureObject(R)||Array.isArray(R)){const j=native2Y(R,!0);k.set(`prop:${B}`,j);const q=_.createYProxy(j,y);return Reflect.set($,B,q,H)}return k.set(`prop:${B}`,R),Reflect.set($,B,R,H)},get:($,B,R)=>Reflect.get($,B,R),deleteProperty:($,B)=>{if(typeof B!="string")throw new Error("key cannot be a symbol");return k.delete(`prop:${B}`),Reflect.deleteProperty($,B)}})}class Schema{constructor(){this.flavourSchemaMap=new Map,this.proxy=new ProxyManager,this.validate=(_,y,w)=>{const $=this.flavourSchemaMap.get(_);assertExists$1($,new SchemaValidateError(_,SCHEMA_NOT_FOUND_MESSAGE));const B=()=>{w?.forEach(H=>{const j=this.flavourSchemaMap.get(H);assertExists$1(j,new SchemaValidateError(H,SCHEMA_NOT_FOUND_MESSAGE)),this.validateSchema(j,$)})};if($.model.role==="root"){if(y)throw new SchemaValidateError($.model.flavour,"Root block cannot have parent.");B();return}if(!y)throw new SchemaValidateError($.model.flavour,"Hub/Content must have parent.");const R=this.flavourSchemaMap.get(y);assertExists$1(R,new SchemaValidateError(y,SCHEMA_NOT_FOUND_MESSAGE)),this.validateSchema($,R),B()},this.upgradeWorkspace=_=>{this._upgradeBlockVersions(_),workspaceMigrations.forEach(y=>{try{y.condition(_)&&y.migrate(_)}catch{throw new Error(`migrate workspace failed: ${y.desc}`)}})},this.upgradePage=(_,y)=>{const w=y.getMap("blocks");Array.from(w.values()).forEach($=>{const B=$.get("sys:flavour"),R=_[B];assertExists$1(R,`previous version for flavour ${B} not found`),this.upgradeBlock(B,R,$)})},this.upgradeBlock=(_,y,w)=>{const $=this.flavourSchemaMap.get(_);assertExists$1($);const{onUpgrade:B,version:R}=$;if(!B)return;const H=toBlockMigrationData(w,this.proxy);return B(H,y,R)},this._upgradeBlockVersions=_=>{const w=_.getMap("meta").get("blockVersions");w&&w.forEach(($,B)=>{const R=this.flavourSchemaMap.get(B);w.set(B,R?.version??$)})}}toJSON(){return Object.fromEntries(Array.from(this.flavourSchemaMap.values()).map(_=>[_.model.flavour,{role:_.model.role,parent:_.model.parent,children:_.model.children}]))}register(_){return _.forEach(y=>{BlockSchema.parse(y),this.flavourSchemaMap.set(y.model.flavour,y)}),this}validateSchema(_,y){if(this._validateRole(_,y),!this._validateParent(_,y))throw new SchemaValidateError(_.model.flavour,`Block cannot have parent: ${y.model.flavour}.`)}_validateRole(_,y){const w=_.model.role,$=y.model.role,B=_.model.flavour,R=y.model.flavour;if(w==="root")throw new SchemaValidateError(B,`Root block cannot have parent: ${R}.`);if(w==="hub"&&$==="content")throw new SchemaValidateError(B,`Hub block cannot be child of content block: ${R}.`);if(w==="content"&&$==="root")throw new SchemaValidateError(B,`Content block can only be child of hub block or itself. But get: ${R}.`)}_matchFlavour(_,y){return minimatch(_,y)||minimatch(y,_)}_validateParent(_,y){const w=_.model.flavour,$=y.model.flavour,B=_.model.parent||["*"];return(y.model.children||["*"]).some(H=>B.some(j=>H==="*"&&j==="*"?!0:H==="*"?this._matchFlavour(j,$):j==="*"?this._matchFlavour(w,H):this._matchFlavour(w,H)&&this._matchFlavour(j,$)))}}let nanoid$1=(k=21)=>crypto.getRandomValues(new Uint8Array(k)).reduce((_,y)=>(y&=63,y<36?_+=y.toString(36):y<62?_+=(y-26).toString(36).toUpperCase():y>62?_+="-":_+="_",_),"");function createAutoIncrementIdGenerator(){let k=0;return()=>(k++).toString()}function createAutoIncrementIdGeneratorByClientId(k){let _=0;return()=>`${k}:${_++}`}function uuidv4(){return uuidv4$1()}function nanoid(){return nanoid$1(10)}class Space{constructor(_,y,w){this._onLoadSlot=new Slot$1,this._initSubDoc=()=>{const $=this.prefixedId;let B=this.doc.spaces.get($);if(B)this._loaded=!1,this.doc.on("subdocs",this._onSubdocEvent);else{const R=this.doc.guid;B=new Doc({guid:`${R}:${$}`}),this.doc.spaces.set($,B),this._loaded=!0,this._onLoadSlot.emit()}return B},this._onSubdocEvent=({loaded:$})=>{Array.from($).find(R=>R.guid===this._ySpaceDoc.guid)&&(this.doc.off("subdocs",this._onSubdocEvent),this._loaded=!0,this._onLoadSlot.emit())},this.id=_,this.doc=y,this.awarenessStore=w,this._ySpaceDoc=this._initSubDoc(),this._yBlocks=this._ySpaceDoc.getMap("blocks"),this._proxy=this.doc.proxy.createYProxy(this._yBlocks)}get prefixedId(){return this.id.startsWith("space:")?this.id:`space:${this.id}`}get loaded(){return this._loaded}get spaceDoc(){return this._ySpaceDoc}async waitForLoaded(){if(this.loaded)return this;const _=new Promise(y=>{this._onLoadSlot.once(()=>{y(void 0)})});return this._ySpaceDoc.load(),await _,this}remove(){this.destroy(),this.doc.spaces.delete(this.prefixedId)}destroy(){this._ySpaceDoc.destroy(),this._onLoadSlot.dispose(),this._loaded=!1}clear(){this._yBlocks.clear()}transact(_,y=!0){this._ySpaceDoc.transact(_,y?this.doc.clientID:null)}}var __decorate$2C=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createChildMap(k){return new Map(k.map((_,y)=>[_,y]))}class Page extends Space{constructor({id:_,workspace:y,doc:w,awarenessStore:$,idGenerator:B=uuidv4$1}){super(_,w,$),this._root=null,this._blockMap=new Map,this._synced=!1,this._shouldTransact=!0,this._ignoredKeys=new Set(Object.keys(new BaseBlockModel)),this.slots={historyUpdated:new Slot$1,rootAdded:new Slot$1,rootDeleted:new Slot$1,textUpdated:new Slot$1,yUpdated:new Slot$1,onYEvent:new Slot$1,blockUpdated:new Slot$1,yBlockUpdated:new Slot$1,copied:new Slot$1,pasted:new Slot$1},this._historyObserver=()=>{this.slots.historyUpdated.emit()},this._handleYEvents=R=>{for(const H of R)this._handleYEvent(H);this.slots.yUpdated.emit()},this._workspace=y,this._idGenerator=B}get readonly(){return this.awarenessStore.isReadonly(this)}get history(){return this._history}get workspace(){return this._workspace}get schema(){return this._workspace.schema}get meta(){return this.workspace.meta.getPageMeta(this.id)}get blobs(){return this.workspace.blobs}get root(){return this._root}get isEmpty(){return this._yBlocks.size===0}get canUndo(){return this.readonly?!1:this._history.canUndo()}get canRedo(){return this.readonly?!1:this._history.canRedo()}get YText(){return YText}get YMap(){return YMap}get Text(){return Text$1}withoutTransact(_){this._shouldTransact=!1,_(),this._shouldTransact=!0}transact(_,y=this._shouldTransact){super.transact(_,y)}undo(){if(this.readonly){console.error("cannot modify data in readonly mode");return}this._history.undo()}redo(){if(this.readonly){console.error("cannot modify data in readonly mode");return}this._history.redo()}captureSync(){this._history.stopCapturing()}resetHistory(){this._history.clear()}generateId(){return this._idGenerator()}getBlockById(_){return this._blockMap.get(_)??null}getBlockByFlavour(_){return Array.from(this._blockMap.values()).filter(({flavour:y})=>y===_)}hasFlavour(_){return this.getBlockByFlavour(_).length>0}getParent(_){const y=this._root,w=typeof _=="string"?_:_.id;if(!y||y.id===w)return null;const $=R=>{const H=this._blockMap.get(R);if(!H)return null;for(const[j]of H.childMap){if(j===w)return H;const q=$(j);if(q!==null)return q}return null},B=$(y.id);return B!==null?B:null}getPreviousSibling(_){const y=this.getParent(_);if(!y)return null;const w=y.children.indexOf(_);if(w===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return y.children[w-1]??null}getPreviousSiblings(_){const y=this.getParent(_);if(!y)return[];const w=y.children.indexOf(_);if(w===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return y.children.slice(0,w)}getNextSibling(_){const y=this.getParent(_);if(!y)return null;const w=y.children.indexOf(_);if(w===-1)throw new Error("Failed to getPreviousSiblings! Block not found in parent's children");return y.children[w+1]??null}getNextSiblings(_){const y=this.getParent(_);if(!y)return[];const w=y.children.indexOf(_);if(w===-1)throw new Error("Failed to getNextSiblings! Block not found in parent's children");return y.children.slice(w+1)}getSchemaByFlavour(_){return this.schema.flavourSchemaMap.get(_)}getInitialPropsByFlavour(_){const y=this.schema.flavourSchemaMap.get(_);return assertExists$1(y),y.model.props?.(internalPrimitives)??{}}addBlocks(_,y,w){const $=[];return _.forEach(B=>{const R=this.addBlock(B.flavour,B.blockProps??{},y,w);$.push(R),typeof w=="number"&&w++}),$}addBlock(_,y={},w,$){if(this.readonly)throw new Error("cannot modify data in readonly mode");if(!_)throw new Error("Block props must contain flavour");const B=typeof w=="string"?this.getBlockById(w):w;this.schema.validate(_,B?.flavour,y.children?.map(j=>j.flavour));const R={flavour:_,...y},H=y.id??this._idGenerator();return R.id=H,this.transact(()=>{const j=new YMap;this._yBlocks.set(H,j),assertValidChildren(this._yBlocks,R);const q=this.getSchemaByFlavour(_);assertExists$1(q),initInternalProps(j,R),syncBlockProps(q,j,R,this._ignoredKeys);const X=B?.id??(q.model.role==="root"?void 0:this._root?.id);if(X){const te=this._yBlocks.get(X).get("sys:children"),ne=$??te.length;te.insert(ne,[H])}}),this.slots.blockUpdated.emit({type:"add",id:H}),H}_populateParentChildrenMap(_,y,w){_.forEach($=>{const B=this.getParent($);if(!B)throw new Error("Can't find parent block for the current block");this.schema.validate($.flavour,w.flavour);const R=y.get(B);if(R){if(this.getNextSibling(R[R.length-1])!==$)throw new Error("The blocks to move are not contiguous under their parent");R.push($)}else y.set(B,[$])})}_repositionBlocks(_,y,w,$,B){for(const[R,H]of _){const q=this._yBlocks.get(R.id).get("sys:children"),X=H.map(({id:ne})=>ne),ee=q.toArray().findIndex(ne=>ne===X[0]);q.delete(ee,X.length);let te=0;w&&(te=y.toArray().findIndex(ne=>ne===w.id)),$?y.insert(te,X):(y.insert(te+B,X),B+=X.length)}}moveBlocks(_,y,w=null,$=!0){if(this.readonly){console.error("Cannot modify data in read-only mode");return}if(!y)throw new Error("Can't find new parent block");const B=new Map;this._populateParentChildrenMap(_,B,y),this.transact(()=>{const H=this._yBlocks.get(y.id).get("sys:children"),j=1;this._repositionBlocks(B,H,w,$,j)}),Array.from(B.keys()).forEach(R=>R.childrenUpdated.emit()),y.childrenUpdated.emit()}updateBlock(_,y){if(this.readonly){console.error("cannot modify data in readonly mode");return}const w=this.getParent(_);this.schema.validate(_.flavour,w?.flavour,y.children?.map(B=>B.flavour));const $=this._yBlocks.get(_.id);assertExists$1($),this.transact(()=>{if(y.children){const R=new YArray;R.insert(0,y.children.map(H=>H.id)),$.set("sys:children",R)}const B=this.schema.flavourSchemaMap.get(_.flavour);assertExists$1(B),syncBlockProps(B,$,y,this._ignoredKeys)}),_.propsUpdated.emit(),this.slots.blockUpdated.emit({type:"update",id:_.id,props:y})}addSiblingBlocks(_,y,w="after"){if(!y.length)return[];const $=this.getParent(_);assertExists$1($);const B=$.children.findIndex(({id:H})=>H===_.id)??0,R=w==="before"?B:B+1;if(y.length>1){const H=[];return y.forEach(j=>{const{flavour:q,...X}=j;assertExists$1(q),H.push({flavour:q,blockProps:X})}),this.addBlocks(H,$.id,R)}else{assertExists$1(y[0].flavour);const{flavour:H,...j}=y[0];return[this.addBlock(H,j,$.id,R)]}}deleteBlock(_,y={bringChildrenTo:!1}){if(this.readonly){console.error("cannot modify data in readonly mode");return}const w=this.getParent(_),$=w?.children.indexOf(_)??-1,{bringChildrenTo:B}=y;$>-1&&w?.children.splice(w.children.indexOf(_),1),B==="parent"&&w?(_.children.forEach(R=>{this.schema.validate(R.flavour,w.flavour)}),w.children.unshift(..._.children)):B instanceof BaseBlockModel&&(_.children.forEach(R=>{this.schema.validate(R.flavour,B.flavour)}),B===w&&$>-1?w.children.splice($,0,..._.children):B.children.push(..._.children)),this._blockMap.delete(_.id),_.deleted.emit(),this.transact(()=>{this._yBlocks.delete(_.id);const R=_.children.map(H=>H.id);if(_.dispose(),w){const j=this._yBlocks.get(w.id).get("sys:children");$>-1&&j.delete($,1),y.bringChildrenTo==="parent"?j.unshift(R):y.bringChildrenTo instanceof BaseBlockModel&&this.updateBlock(y.bringChildrenTo,{children:y.bringChildrenTo.children}),w.childrenUpdated.emit()}}),this.slots.blockUpdated.emit({type:"delete",id:_.id})}trySyncFromExistingDoc(){if(this._synced)throw new Error("Cannot sync from existing doc more than once");(this.workspace.meta.pages?.length??0)<=1&&this._handleVersion(),this._initYBlocks();const _=new Set;this._yBlocks.forEach((y,w)=>{_.has(w)||(_.add(w),this._handleYBlockAdd(_,w))}),this._synced=!0}dispose(){this.slots.historyUpdated.dispose(),this.slots.rootAdded.dispose(),this.slots.rootDeleted.dispose(),this.slots.textUpdated.dispose(),this.slots.yUpdated.dispose(),this.slots.blockUpdated.dispose(),this.slots.onYEvent.dispose(),this._synced&&(this._yBlocks.unobserveDeep(this._handleYEvents),this._yBlocks.clear())}_initYBlocks(){const{_yBlocks:_}=this;_.observeDeep(this._handleYEvents),this._history=new UndoManager([_],{trackedOrigins:new Set([this._ySpaceDoc.clientID])}),this._history.on("stack-cleared",this._historyObserver),this._history.on("stack-item-added",this._historyObserver),this._history.on("stack-item-popped",this._historyObserver),this._history.on("stack-item-updated",this._historyObserver)}_getYBlock(_){const y=this._yBlocks.get(_);if(!y)throw new Error(`Block with id ${_} does not exist`);return y}_createBlockModel(_,y){const w=this.schema.flavourSchemaMap.get(_.flavour);if(w){if(!_.id)throw new Error("Block id is not defined")}else throw new Error(`Block flavour ${_.flavour} is not registered`);const $=w.model.toModel?w.model.toModel():new BaseBlockModel;$.id=_.id;const B=w.model.props?.(internalPrimitives)??{};return Object.entries(B).forEach(([R,H])=>{$[R]=H instanceof Text$1?new Text$1(y.get(`prop:${R}`)):_[R]??H}),$.page=this,$.yBlock=y,$.flavour=w.model.flavour,$.role=w.model.role,$.created.emit(),$}_handleYBlockAdd(_,y){const w=this._getYBlock(y),$=toBlockProps(w,this.doc.proxy),B=this._createBlockModel({...$,id:y},w);this._blockMap.set(y,B);const R=w.get("sys:children");if(R instanceof YArray&&(B.childMap=createChildMap(R),R.forEach(q=>{const X=B.childMap.get(q);Number.isInteger(X)&&(this._blockMap.has(q)||(_.add(q),this._handleYBlockAdd(_,q)),B.children[X]=this._blockMap.get(q))})),B.role==="root"){this._root=B,this.slots.rootAdded.emit(this._root);return}const H=this.getParent(B),j=H?.childMap.get(B.id);H&&j!==void 0&&(H.children[j]=B,H.childrenUpdated.emit())}_handleYBlockDelete(_){this._blockMap.get(_)===this._root&&this.slots.rootDeleted.emit(_),this._blockMap.delete(_)}_handleYBlockUpdate(_){const y=_.target.get("sys:id"),w=this.getBlockById(y);if(!w)return;const $={},B={};let R=!1,H=!1;for(const j of _.keysChanged){if(j==="prop:text")continue;if(j==="sys:children"){H=!0;const X=_.target.get("sys:children");if(!(X instanceof YArray)){console.error("Failed to update block children!, sys:children is not an Y array",_,X);continue}w.childMap=createChildMap(X),w.children=X.map(ee=>this._blockMap.get(ee));continue}const q=_.target.get(j);B[j]={old:_.changes.keys.get(j)?.oldValue,new:q},R=!0,q instanceof YMap||q instanceof YArray?$[j.replace("prop:","")]=this.doc.proxy.createYProxy(q,{deep:!0}):$[j.replace("prop:","")]=q}R&&(Object.assign(w,$),w.propsUpdated.emit(),this.slots.yBlockUpdated.emit({id:w.id,props:B})),H&&w.childrenUpdated.emit()}_handleYEvent(_){if(_.target===this._yBlocks){const y=new Set;_.keys.forEach((w,$)=>{if(w.action==="add"){if(y.has($))return;y.add($),this._handleYBlockAdd(y,$)}else w.action==="delete"&&this._handleYBlockDelete($)})}else if(_.target.parent===this._yBlocks)_ instanceof YTextEvent?this.slots.textUpdated.emit(_):_ instanceof YMapEvent&&this._handleYBlockUpdate(_);else if(_.target.parent instanceof YMap&&_.target.parent.has("sys:id")&&_ instanceof YArrayEvent){const y=_.target.parent.get("sys:id"),w=this._blockMap.get(y);if(!w)throw new Error(`Block with id ${y} does not exist`);if(_.path[_.path.length-1]==="sys:children"){const B=_.target.toArray();w.children=B.map(R=>this._blockMap.get(R)),w.childMap=createChildMap(_.target),w.childrenUpdated.emit()}}this.slots.onYEvent.emit({event:_})}_handleVersion(){this.workspace.meta.hasVersion?this.workspace.meta.validateVersion(this.workspace):this.workspace.meta.writeVersion(this.workspace)}async waitForLoaded(_){return await super.waitForLoaded(),_?.(),this._synced||this.trySyncFromExistingDoc(),this}}__decorate$2C([debug("CRUD")],Page.prototype,"addBlocks",null);__decorate$2C([debug("CRUD")],Page.prototype,"addBlock",null);__decorate$2C([debug("CRUD")],Page.prototype,"moveBlocks",null);__decorate$2C([debug("CRUD")],Page.prototype,"updateBlock",null);__decorate$2C([debug("CRUD")],Page.prototype,"deleteBlock",null);const outdatedTimeout=3e4;class Awareness extends Observable{constructor(_){super(),this.doc=_,this.clientID=_.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const y=getUnixTime();this.getLocalState()!==null&&outdatedTimeout/2<=y-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const w=[];this.meta.forEach(($,B)=>{B!==this.clientID&&outdatedTimeout<=y-$.lastUpdated&&this.states.has(B)&&w.push(B)}),w.length>0&&removeAwarenessStates(this,w,"timeout")},floor$1(outdatedTimeout/10)),_.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(_){const y=this.clientID,w=this.meta.get(y),$=w===void 0?0:w.clock+1,B=this.states.get(y);_===null?this.states.delete(y):this.states.set(y,_),this.meta.set(y,{clock:$,lastUpdated:getUnixTime()});const R=[],H=[],j=[],q=[];_===null?q.push(y):B==null?_!=null&&R.push(y):(H.push(y),equalityDeep(B,_)||j.push(y)),(R.length>0||j.length>0||q.length>0)&&this.emit("change",[{added:R,updated:j,removed:q},"local"]),this.emit("update",[{added:R,updated:H,removed:q},"local"])}setLocalStateField(_,y){const w=this.getLocalState();w!==null&&this.setLocalState({...w,[_]:y})}getStates(){return this.states}}const removeAwarenessStates=(k,_,y)=>{const w=[];for(let $=0;$<_.length;$++){const B=_[$];if(k.states.has(B)){if(k.states.delete(B),B===k.clientID){const R=k.meta.get(B);k.meta.set(B,{clock:R.clock+1,lastUpdated:getUnixTime()})}w.push(B)}}w.length>0&&(k.emit("change",[{added:[],updated:[],removed:w},y]),k.emit("update",[{added:[],updated:[],removed:w},y]))},testSymbol=Symbol.for("react.test.json");function isValidRecord(k){return!(typeof k!="object"||k===null)}const IGNORED_PROPS=["sys:id","sys:flavour","sys:children","prop:xywh","prop:cells","prop:elements"];function yDocToJSXNode(k,_){if(!isValidRecord(k))throw new Error("Failed to parse doc record! Invalid data.");const y=k[_];if(!y)throw new Error(`Failed to parse doc record! Node not found! id: ${_}.`);const w=y["sys:flavour"],$=y["sys:children"],B=Object.fromEntries(Object.entries(y).filter(([R])=>!IGNORED_PROPS.includes(R)));return"prop:text"in B&&B["prop:text"]instanceof Array&&(B["prop:text"]=parseDelta(B["prop:text"])),"prop:title"in B&&B["prop:title"]instanceof Array&&(B["prop:title"]=parseDelta(B["prop:title"])),"prop:columns"in B&&B["prop:columns"]instanceof Array&&(B["prop:columns"]=`Array [${B["prop:columns"].length}]`),"prop:views"in B&&B["prop:views"]instanceof Array&&(B["prop:views"]=`Array [${B["prop:views"].length}]`),{$$typeof:testSymbol,type:w,props:B,children:$?.map(R=>yDocToJSXNode(k,R))??[]}}function serializeYDoc(k){const _={};return k.share.forEach((y,w)=>{y instanceof YMap?_[w]=serializeYMap(y):_[w]=y.toJSON()}),_}function serializeY(k){return k instanceof Doc?serializeYDoc(k):k instanceof YMap?serializeYMap(k):k instanceof YText?serializeYText(k):k instanceof YArray?k.toArray().map(_=>serializeY(_)):k instanceof AbstractType?k.toJSON():k}function serializeYMap(k){const _={};return k.forEach((y,w)=>{_[w]=serializeY(y)}),_}function serializeYText(k){return k.toDelta()}function parseDelta(k){if(k.length)return k.length===1&&!k[0].attributes?k[0].insert:{$$typeof:testSymbol,type:"",props:{},children:k?.map(({insert:_,attributes:y})=>({$$typeof:testSymbol,type:"text",props:{insert:_,...y}}))}}var Generator;(function(k){k.NanoID="nanoID",k.UUIDv4="uuidV4",k.AutoIncrementByClientId="autoIncrementByClientId",k.AutoIncrement="autoIncrement"})(Generator||(Generator={}));const flagsPreset={enable_set_remote_flag:!0,enable_drag_handle:!0,enable_block_hub:!0,enable_surface:!0,enable_edgeless_toolbar:!0,enable_slash_menu:!0,enable_attachment_block:!0,enable_database:!0,enable_database_filter:!1,enable_data_view:!1,enable_page_tags:!1,enable_toggle_block:!1,enable_block_selection_format_bar:!0,enable_linked_page:!1,enable_bookmark_operation:!1,enable_note_index:!1,readonly:{}};class Store{constructor({id:_,providerCreators:y=[],awareness:w,idGenerator:$,defaultFlags:B}={id:nanoid()}){switch(this.providers=[],this.spaces=new Map,this.id=_,this.doc=new BlockSuiteDoc({guid:_}),this.awarenessStore=new AwarenessStore(this,w??new Awareness(this.doc),srcExports.merge(!0,flagsPreset,B)),$){case Generator.AutoIncrement:{this.idGenerator=createAutoIncrementIdGenerator();break}case Generator.AutoIncrementByClientId:{this.idGenerator=createAutoIncrementIdGeneratorByClientId(this.doc.clientID);break}case Generator.UUIDv4:{this.idGenerator=uuidv4;break}case Generator.NanoID:default:{this.idGenerator=nanoid;break}}this.providers=y.map(R=>R(_,this.doc,{awareness:this.awarenessStore.awareness}))}registerProvider(_,y){const w=_(y??this.id,this.doc,{awareness:this.awarenessStore.awareness});return this.providers.push(w),w}addSpace(_){this.spaces.set(_.prefixedId,_)}removeSpace(_){this.spaces.delete(_.prefixedId)}exportJSX(_,y){const w=_.startsWith("space:")?_:`space:${_}`,$=this.doc.spaces.get(w);assertExists$1($);const B=serializeYDoc($);if(!B)throw new Error(`Page ${_} doesn't exist`);const R=B.blocks;if(!y){const H=Object.keys(R).at(0);if(!H)return null;y=H}return R[y]?yDocToJSXNode(R,y):null}}class BacklinkIndexer{constructor(_){this._linkIndexMap={},this._disposables=new DisposableGroup$1,this.slots={indexUpdated:new Slot$1},this._backlinkIndexMapCache=null,this._disposables.add(_.slots.refreshIndex.on(()=>this._onRefreshIndex())),this._disposables.add(_.slots.pageRemoved.on(y=>this._onPageRemoved(y))),this._disposables.add(_.slots.blockUpdated.on(y=>this._onBlockUpdated(y))),this.slots.indexUpdated.on(()=>{this._backlinkIndexMapCache=null})}getBacklink(_){if(this._backlinkIndexMapCache)return this._backlinkIndexMapCache[_]??[];const y={};for(const[w,$]of Object.entries(this._linkIndexMap))for(const[B,R]of Object.entries($))R.forEach(({pageId:H,type:j})=>{H in y||(y[H]=[]),y[H].push({pageId:w,blockId:B,type:j})});return this._backlinkIndexMapCache=y,this._backlinkIndexMapCache[_]??[]}_onRefreshIndex(){this._linkIndexMap={}}_onPageRemoved(_){this._linkIndexMap[_]&&(this._linkIndexMap[_]={},this.slots.indexUpdated.emit({action:"delete",pageId:_}))}_onBlockUpdated({action:_,pageId:y,block:w,blockId:$}){switch(_){case"add":case"update":{const B=w.get("prop:text");if(!(B instanceof YText)){B&&console.warn("Unexpected prop:text type",B);return}const R=B.toDelta();this._indexDelta({action:_,pageId:y,blockId:$,deltas:R});return}case"delete":{this._removeIndex(y,$);break}}}_indexDelta({action:_,pageId:y,blockId:w,deltas:$}){const B=$.filter(j=>j.attributes&&j.attributes.reference).map(j=>({...j.attributes.reference,blockId:w})),R=this._linkIndexMap[y]?.[w]??[];diffArray(R,B).changed&&(this._linkIndexMap[y]={...this._linkIndexMap[y],[w]:B},this.slots.indexUpdated.emit({action:_,pageId:y,blockId:w}))}_removeIndex(_,y){if(!this._linkIndexMap[_]||!this._linkIndexMap[_][y])return;const w=this._linkIndexMap[_][y];delete this._linkIndexMap[_][y],w.length&&this.slots.indexUpdated.emit({action:"delete",pageId:_,blockId:y})}dispose(){this._disposables.dispose()}}class BlockIndexer{constructor(_,{immediately:y=!1,slots:w}){if(this._disposables=new DisposableGroup$1,this.slots={pageRemoved:new Slot$1,blockUpdated:new Slot$1,refreshIndex:new Slot$1},this._yPageObserver=($,B,{pageId:R,yPage:H})=>{$.forEach(j=>{if(!(j instanceof YArrayEvent)){if(j instanceof YMapEvent){if(j.target!==j.currentTarget){if(j.keysChanged.has("prop:text")){const q=j.path[0],X=H.get(q);assertExists$1(X),this._indexBlock({action:"update",pageId:R,blockId:q,block:X})}return}Array.from(j.changes.keys.entries()).forEach(([q,{action:X}])=>{if(X==="delete"){this._indexBlock({action:X,pageId:R,blockId:q});return}const ee=H.get(q);assertExists$1(ee),this._indexBlock({action:X,pageId:R,blockId:q,block:ee})});return}if(j instanceof YTextEvent){const q=j.path[0];if(!q||typeof q!="string")throw new Error("Failed to update index! Unexpected YText Event!");const X=H.get(q);assertExists$1(X),this._indexBlock({action:"update",pageId:R,blockId:q,block:X});return}}})},this._doc=_,this._workspaceSlots=w,y){this._initIndex();return}setTimeout(()=>{this._initIndex()},0)}_initIndex(){const _=this._doc;if(!_.share.has("meta"))throw new Error("Failed to initialize indexer: workspace meta not found");let w={};this._disposables.add(()=>{Object.values(w).forEach($=>$?.()),w={}}),Array.from(_.spaces.keys()).map($=>$.startsWith("space:")?$.slice(6):$).map($=>({pageId:$,page:this._getPage($)})).forEach(({pageId:$,page:B})=>{if(assertExists$1(B,`Failed to find page '${$}'`),w[$]){console.warn(`Duplicated pageAdded event! ${$} already observed`,w);return}const R=this._indexPage($,B);w[$]=R}),this._workspaceSlots.pageAdded.on($=>{const B=this._getPage($);if(assertExists$1(B,`Failed to find page '${$}'`),w[$])return;const R=this._indexPage($,B);w[$]=R}),this._workspaceSlots.pageRemoved.on($=>{w[$]?.(),w[$]=null,this.slots.pageRemoved.emit($)})}_indexPage(_,y){const w=y.getMap("blocks");w.forEach((B,R)=>{this._indexBlock({action:"add",pageId:_,blockId:R,block:B})});const $=(B,R)=>this._yPageObserver(B,R,{pageId:_,yPage:w});return w.observeDeep($),()=>{w.unobserveDeep($)}}_indexBlock(_){this.slots.blockUpdated.emit(_)}_getPage(_){if(_.startsWith("space:"))throw new Error(`Unexpected 'space:' prefix for: ${_}`);return _=`space:${_}`,this._doc.spaces.get(_)}refreshIndex(){this.slots.refreshIndex.emit(),this._initIndex()}dispose(){this._disposables.dispose()}}var flexsearch_bundle={exports:{}};flexsearch_bundle.exports;(function(module){(function _f(self){try{module&&(self=module)}catch(k){}self._factory=_f;var t;function u(k){return typeof k<"u"?k:!0}function aa(k){const _=Array(k);for(let y=0;y<k;y++)_[y]=v();return _}function v(){return Object.create(null)}function ba(k,_){return _.length-k.length}function x(k){return typeof k=="string"}function C(k){return typeof k=="object"}function D(k){return typeof k=="function"}function ca(k,_){var y=da;if(k&&(_&&(k=E(k,_)),this.H&&(k=E(k,this.H)),this.J&&1<k.length&&(k=E(k,this.J)),y||y==="")){if(k=k.split(y),this.filter){_=this.filter,y=k.length;const w=[];for(let $=0,B=0;$<y;$++){const R=k[$];R&&!_[R]&&(w[B++]=R)}k=w}return k}return k}const da=/[\p{Z}\p{S}\p{P}\p{C}]+/u,ea=/[\u0300-\u036f]/g;function fa(k,_){const y=Object.keys(k),w=y.length,$=[];let B="",R=0;for(let H=0,j,q;H<w;H++)j=y[H],(q=k[j])?($[R++]=F(_?"(?!\\b)"+j+"(\\b|_)":j),$[R++]=q):B+=(B?"|":"")+j;return B&&($[R++]=F(_?"(?!\\b)("+B+")(\\b|_)":"("+B+")"),$[R]=""),$}function E(k,_){for(let y=0,w=_.length;y<w&&(k=k.replace(_[y],_[y+1]),k);y+=2);return k}function F(k){return new RegExp(k,"g")}function ha(k){let _="",y="";for(let w=0,$=k.length,B;w<$;w++)(B=k[w])!==y&&(_+=y=B);return _}var ja={encode:ia,F:!1,G:""};function ia(k){return ca.call(this,(""+k).toLowerCase(),!1)}const ka={},G={};function la(k){I(k,"add"),I(k,"append"),I(k,"search"),I(k,"update"),I(k,"remove")}function I(k,_){k[_+"Async"]=function(){const y=this,w=arguments;var $=w[w.length-1];let B;return D($)&&(B=$,delete w[w.length-1]),$=new Promise(function(R){setTimeout(function(){y.async=!0;const H=y[_].apply(y,w);y.async=!1,R(H)})}),B?($.then(B),this):$}}function ma(k,_,y,w){const $=k.length;let B=[],R,H,j=0;w&&(w=[]);for(let q=$-1;0<=q;q--){const X=k[q],ee=X.length,te=v();let ne=!R;for(let oe=0;oe<ee;oe++){const ie=X[oe],ae=ie.length;if(ae)for(let re=0,se,le;re<ae;re++)if(le=ie[re],R){if(R[le]){if(!q){if(y)y--;else if(B[j++]=le,j===_)return B}(q||w)&&(te[le]=1),ne=!0}if(w&&(H[le]=(se=H[le])?++se:se=1,se<$)){const ue=w[se-2]||(w[se-2]=[]);ue[ue.length]=le}}else te[le]=1}if(w)R||(H=te);else if(!ne)return[];R=te}if(w)for(let q=w.length-1,X,ee;0<=q;q--){X=w[q],ee=X.length;for(let te=0,ne;te<ee;te++)if(ne=X[te],!R[ne]){if(y)y--;else if(B[j++]=ne,j===_)return B;R[ne]=1}}return B}function na(k,_){const y=v(),w=v(),$=[];for(let B=0;B<k.length;B++)y[k[B]]=1;for(let B=0,R;B<_.length;B++){R=_[B];for(let H=0,j;H<R.length;H++)j=R[H],y[j]&&!w[j]&&(w[j]=1,$[$.length]=j)}return $}function J(k){this.l=k!==!0&&k,this.cache=v(),this.h=[]}function oa(k,_,y){C(k)&&(k=k.query);let w=this.cache.get(k);return w||(w=this.search(k,_,y),this.cache.set(k,w)),w}J.prototype.set=function(k,_){if(!this.cache[k]){var y=this.h.length;for(y===this.l?delete this.cache[this.h[y-1]]:y++,--y;0<y;y--)this.h[y]=this.h[y-1];this.h[0]=k}this.cache[k]=_},J.prototype.get=function(k){const _=this.cache[k];if(this.l&&_&&(k=this.h.indexOf(k))){const y=this.h[k-1];this.h[k-1]=this.h[k],this.h[k]=y}return _};const qa={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function ra(k,_,y,w,$,B){setTimeout(function(){const R=k(y,JSON.stringify(B));R&&R.then?R.then(function(){_.export(k,_,y,w,$+1)}):_.export(k,_,y,w,$+1)})}function K(k,_){if(!(this instanceof K))return new K(k);var y;if(k){x(k)?k=qa[k]:(y=k.preset)&&(k=Object.assign({},y[y],k)),y=k.charset;var w=k.lang;x(y)&&(y.indexOf(":")===-1&&(y+=":default"),y=G[y]),x(w)&&(w=ka[w])}else k={};let $,B,R=k.context||{};if(this.encode=k.encode||y&&y.encode||ia,this.register=_||v(),this.D=$=k.resolution||9,this.G=_=y&&y.G||k.tokenize||"strict",this.depth=_==="strict"&&R.depth,this.l=u(R.bidirectional),this.s=B=u(k.optimize),this.m=u(k.fastupdate),this.B=k.minlength||1,this.C=k.boost,this.map=B?aa($):v(),this.A=$=R.resolution||1,this.h=B?aa($):v(),this.F=y&&y.F||k.rtl,this.H=(_=k.matcher||w&&w.H)&&fa(_,!1),this.J=(_=k.stemmer||w&&w.J)&&fa(_,!0),y=_=k.filter||w&&w.filter){y=_,w=v();for(let H=0,j=y.length;H<j;H++)w[y[H]]=1;y=w}this.filter=y,this.cache=(_=k.cache)&&new J(_)}t=K.prototype,t.append=function(k,_){return this.add(k,_,!0)},t.add=function(k,_,y,w){if(_&&(k||k===0)){if(!w&&!y&&this.register[k])return this.update(k,_);if(_=this.encode(_),w=_.length){const q=v(),X=v(),ee=this.depth,te=this.D;for(let ne=0;ne<w;ne++){let oe=_[this.F?w-1-ne:ne];var $=oe.length;if(oe&&$>=this.B&&(ee||!X[oe])){var B=L(te,w,ne),R="";switch(this.G){case"full":if(3<$){for(B=0;B<$;B++)for(var H=$;H>B;H--)if(H-B>=this.B){var j=L(te,w,ne,$,B);R=oe.substring(B,H),M(this,X,R,j,k,y)}break}case"reverse":if(2<$){for(H=$-1;0<H;H--)R=oe[H]+R,R.length>=this.B&&M(this,X,R,L(te,w,ne,$,H),k,y);R=""}case"forward":if(1<$){for(H=0;H<$;H++)R+=oe[H],R.length>=this.B&&M(this,X,R,B,k,y);break}default:if(this.C&&(B=Math.min(B/this.C(_,oe,ne)|0,te-1)),M(this,X,oe,B,k,y),ee&&1<w&&ne<w-1){for($=v(),R=this.A,B=oe,H=Math.min(ee+1,w-ne),$[B]=1,j=1;j<H;j++)if((oe=_[this.F?w-1-ne-j:ne+j])&&oe.length>=this.B&&!$[oe]){$[oe]=1;const ie=this.l&&oe>B;M(this,q,ie?B:oe,L(R+(w/2>R?0:1),w,ne,H-1,j-1),k,y,ie?oe:B)}}}}}this.m||(this.register[k]=1)}}return this};function L(k,_,y,w,$){return y&&1<k?_+(w||0)<=k?y+($||0):(k-1)/(_+(w||0))*(y+($||0))+1|0:0}function M(k,_,y,w,$,B,R){let H=R?k.h:k.map;(!_[y]||R&&!_[y][R])&&(k.s&&(H=H[w]),R?(_=_[y]||(_[y]=v()),_[R]=1,H=H[R]||(H[R]=v())):_[y]=1,H=H[y]||(H[y]=[]),k.s||(H=H[w]||(H[w]=[])),B&&H.indexOf($)!==-1||(H[H.length]=$,k.m&&(k=k.register[$]||(k.register[$]=[]),k[k.length]=H)))}t.search=function(k,_,y){y||(!_&&C(k)?(y=k,k=y.query):C(_)&&(y=_));let w=[],$,B,R=0;if(y){_=y.limit,R=y.offset||0;var H=y.context;B=y.suggest}if(k&&(k=this.encode(k),$=k.length,1<$)){y=v();var j=[];for(let X=0,ee=0,te;X<$;X++)if((te=k[X])&&te.length>=this.B&&!y[te])if(this.s||B||this.map[te])j[ee++]=te,y[te]=1;else return w;k=j,$=k.length}if(!$)return w;_||(_=100),H=this.depth&&1<$&&H!==!1,y=0;let q;H?(q=k[0],y=1):1<$&&k.sort(ba);for(let X,ee;y<$;y++){if(ee=k[y],H?(X=sa(this,w,B,_,R,$===2,ee,q),B&&X===!1&&w.length||(q=ee)):X=sa(this,w,B,_,R,$===1,ee),X)return X;if(B&&y===$-1){if(j=w.length,!j){if(H){H=0,y=-1;continue}return w}if(j===1)return ta(w[0],_,R)}}return ma(w,_,R,B)};function sa(k,_,y,w,$,B,R,H){let j=[],q=H?k.h:k.map;if(k.s||(q=ua(q,R,H,k.l)),q){let X=0;const ee=Math.min(q.length,H?k.A:k.D);for(let te=0,ne=0,oe,ie;te<ee&&!((oe=q[te])&&(k.s&&(oe=ua(oe,R,H,k.l)),$&&oe&&B&&(ie=oe.length,ie<=$?($-=ie,oe=null):(oe=oe.slice($),$=0)),oe&&(j[X++]=oe,B&&(ne+=oe.length,ne>=w))));te++);if(X){if(B)return ta(j,w,0);_[_.length]=j;return}}return!y&&j}function ta(k,_,y){return k=k.length===1?k[0]:[].concat.apply([],k),y||k.length>_?k.slice(y,y+_):k}function ua(k,_,y,w){return y?(w=w&&_>y,k=(k=k[w?_:y])&&k[w?y:_]):k=k[_],k}t.contain=function(k){return!!this.register[k]},t.update=function(k,_){return this.remove(k).add(k,_)},t.remove=function(k,_){const y=this.register[k];if(y){if(this.m)for(let w=0,$;w<y.length;w++)$=y[w],$.splice($.indexOf(k),1);else N(this.map,k,this.D,this.s),this.depth&&N(this.h,k,this.A,this.s);if(_||delete this.register[k],this.cache){_=this.cache;for(let w=0,$,B;w<_.h.length;w++)B=_.h[w],$=_.cache[B],$.indexOf(k)!==-1&&(_.h.splice(w--,1),delete _.cache[B])}}return this};function N(k,_,y,w,$){let B=0;if(k.constructor===Array)if($)_=k.indexOf(_),_!==-1?1<k.length&&(k.splice(_,1),B++):B++;else{$=Math.min(k.length,y);for(let R=0,H;R<$;R++)(H=k[R])&&(B=N(H,_,y,w,$),w||B||delete k[R])}else for(let R in k)(B=N(k[R],_,y,w,$))||delete k[R];return B}t.searchCache=oa,t.export=function(k,_,y,w,$){let B,R;switch($||($=0)){case 0:if(B="reg",this.m){R=v();for(let H in this.register)R[H]=1}else R=this.register;break;case 1:B="cfg",R={doc:0,opt:this.s?1:0};break;case 2:B="map",R=this.map;break;case 3:B="ctx",R=this.h;break;default:return}return ra(k,_||this,y?y+"."+B:B,w,$,R),!0},t.import=function(k,_){if(_)switch(x(_)&&(_=JSON.parse(_)),k){case"cfg":this.s=!!_.opt;break;case"reg":this.m=!1,this.register=_;break;case"map":this.map=_;break;case"ctx":this.h=_}},la(K.prototype);function va(k){k=k.data;var _=self._index;const y=k.args;var w=k.task;switch(w){case"init":w=k.options||{},k=k.factory,_=w.encode,w.cache=!1,_&&_.indexOf("function")===0&&(w.encode=Function("return "+_)()),k?(Function("return "+k)()(self),self._index=new self.FlexSearch.Index(w),delete self.FlexSearch):self._index=new K(w);break;default:k=k.id,_=_[w].apply(_,y),postMessage(w==="search"?{id:k,msg:_}:{id:k})}}let wa=0;function O(k){if(!(this instanceof O))return new O(k);var _;k?D(_=k.encode)&&(k.encode=_.toString()):k={},(_=(self||window)._factory)&&(_=_.toString());const y=self.exports,w=this;this.o=xa(_,y,k.worker),this.h=v(),this.o&&(y?this.o.on("message",function($){w.h[$.id]($.msg),delete w.h[$.id]}):this.o.onmessage=function($){$=$.data,w.h[$.id]($.msg),delete w.h[$.id]},this.o.postMessage({task:"init",factory:_,options:k}))}P("add"),P("append"),P("search"),P("update"),P("remove");function P(k){O.prototype[k]=O.prototype[k+"Async"]=function(){const _=this,y=[].slice.call(arguments);var w=y[y.length-1];let $;return D(w)&&($=w,y.splice(y.length-1,1)),w=new Promise(function(B){setTimeout(function(){_.h[++wa]=B,_.o.postMessage({task:k,id:wa,args:y})})}),$?(w.then($),this):w}}function xa(a,b,c){let d;try{d=b?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):a?new Worker(URL.createObjectURL(new Blob(["onmessage="+va.toString()],{type:"text/javascript"}))):new Worker(x(c)?c:"worker/worker.js",{type:"module"})}catch(k){}return d}function Q(k){if(!(this instanceof Q))return new Q(k);var _=k.document||k.doc||k,y;this.K=[],this.h=[],this.A=[],this.register=v(),this.key=(y=_.key||_.id)&&S(y,this.A)||"id",this.m=u(k.fastupdate),this.C=(y=_.store)&&y!==!0&&[],this.store=y&&v(),this.I=(y=_.tag)&&S(y,this.A),this.l=y&&v(),this.cache=(y=k.cache)&&new J(y),k.cache=!1,this.o=k.worker,this.async=!1,y=v();let w=_.index||_.field||_;x(w)&&(w=[w]);for(let $=0,B,R;$<w.length;$++)B=w[$],x(B)||(R=B,B=B.field),R=C(R)?Object.assign({},k,R):k,this.o&&(y[B]=new O(R),y[B].o||(this.o=!1)),this.o||(y[B]=new K(R,this.register)),this.K[$]=S(B,this.A),this.h[$]=B;if(this.C)for(k=_.store,x(k)&&(k=[k]),_=0;_<k.length;_++)this.C[_]=S(k[_],this.A);this.index=y}function S(k,_){const y=k.split(":");let w=0;for(let $=0;$<y.length;$++)k=y[$],0<=k.indexOf("[]")&&(k=k.substring(0,k.length-2))&&(_[w]=!0),k&&(y[w++]=k);return w<y.length&&(y.length=w),1<w?y:y[0]}function T(k,_){if(x(_))k=k[_];else for(let y=0;k&&y<_.length;y++)k=k[_[y]];return k}function U(k,_,y,w,$){if(k=k[$],w===y.length-1)_[$]=k;else if(k)if(k.constructor===Array)for(_=_[$]=Array(k.length),$=0;$<k.length;$++)U(k,_,y,w,$);else _=_[$]||(_[$]=v()),$=y[++w],U(k,_,y,w,$)}function V(k,_,y,w,$,B,R,H){if(k=k[R])if(w===_.length-1){if(k.constructor===Array){if(y[w]){for(_=0;_<k.length;_++)$.add(B,k[_],!0,!0);return}k=k.join(" ")}$.add(B,k,H,!0)}else if(k.constructor===Array)for(R=0;R<k.length;R++)V(k,_,y,w,$,B,R,H);else R=_[++w],V(k,_,y,w,$,B,R,H)}t=Q.prototype,t.add=function(k,_,y){if(C(k)&&(_=k,k=T(_,this.key)),_&&(k||k===0)){if(!y&&this.register[k])return this.update(k,_);for(let w=0,$,B;w<this.h.length;w++)B=this.h[w],$=this.K[w],x($)&&($=[$]),V(_,$,this.A,0,this.index[B],k,$[0],y);if(this.I){let w=T(_,this.I),$=v();x(w)&&(w=[w]);for(let B=0,R,H;B<w.length;B++)if(R=w[B],!$[R]&&($[R]=1,H=this.l[R]||(this.l[R]=[]),!y||H.indexOf(k)===-1)&&(H[H.length]=k,this.m)){const j=this.register[k]||(this.register[k]=[]);j[j.length]=H}}if(this.store&&(!y||!this.store[k])){let w;if(this.C){w=v();for(let $=0,B;$<this.C.length;$++)B=this.C[$],x(B)?w[B]=_[B]:U(_,w,B,0,B[0])}this.store[k]=w||_}}return this},t.append=function(k,_){return this.add(k,_,!0)},t.update=function(k,_){return this.remove(k).add(k,_)},t.remove=function(k){if(C(k)&&(k=T(k,this.key)),this.register[k]){for(var _=0;_<this.h.length&&(this.index[this.h[_]].remove(k,!this.o),!this.m);_++);if(this.I&&!this.m)for(let y in this.l){_=this.l[y];const w=_.indexOf(k);w!==-1&&(1<_.length?_.splice(w,1):delete this.l[y])}this.store&&delete this.store[k],delete this.register[k]}return this},t.search=function(k,_,y,w){y||(!_&&C(k)?(y=k,k=y.query):C(_)&&(y=_,_=0));let $=[],B=[],R,H,j,q,X,ee,te=0;if(y)if(y.constructor===Array)j=y,y=null;else{if(j=(R=y.pluck)||y.index||y.field,q=y.tag,H=this.store&&y.enrich,X=y.bool==="and",_=y.limit||100,ee=y.offset||0,q&&(x(q)&&(q=[q]),!k)){for(let oe=0,ie;oe<q.length;oe++)(ie=ya.call(this,q[oe],_,ee,H))&&($[$.length]=ie,te++);return te?$:[]}x(j)&&(j=[j])}j||(j=this.h),X=X&&(1<j.length||q&&1<q.length);const ne=!w&&(this.o||this.async)&&[];for(let oe=0,ie,ae,re;oe<j.length;oe++){let se;if(ae=j[oe],x(ae)||(se=ae,ae=ae.field),ne)ne[oe]=this.index[ae].searchAsync(k,_,se||y);else{if(w?ie=w[oe]:ie=this.index[ae].search(k,_,se||y),re=ie&&ie.length,q&&re){const le=[];let ue=0;X&&(le[0]=[ie]);for(let he=0,ce,ge;he<q.length;he++)ce=q[he],(re=(ge=this.l[ce])&&ge.length)&&(ue++,le[le.length]=X?[ge]:ge);ue&&(ie=X?ma(le,_||100,ee||0):na(ie,le),re=ie.length)}if(re)B[te]=ae,$[te++]=ie;else if(X)return[]}}if(ne){const oe=this;return new Promise(function(ie){Promise.all(ne).then(function(ae){ie(oe.search(k,_,y,ae))})})}if(!te)return[];if(R&&(!H||!this.store))return $[0];for(let oe=0,ie;oe<B.length;oe++){if(ie=$[oe],ie.length&&H&&(ie=za.call(this,ie)),R)return ie;$[oe]={field:B[oe],result:ie}}return $};function ya(k,_,y,w){let $=this.l[k],B=$&&$.length-y;if(B&&0<B)return(B>_||y)&&($=$.slice(y,y+_)),w&&($=za.call(this,$)),{tag:k,result:$}}function za(k){const _=Array(k.length);for(let y=0,w;y<k.length;y++)w=k[y],_[y]={id:w,doc:this.store[w]};return _}t.contain=function(k){return!!this.register[k]},t.get=function(k){return this.store[k]},t.set=function(k,_){return this.store[k]=_,this},t.searchCache=oa,t.export=function(k,_,y,w,$){if($||($=0),w||(w=0),w<this.h.length){const B=this.h[w],R=this.index[B];_=this,setTimeout(function(){R.export(k,_,$?B.replace(":","-"):"",w,$++)||(w++,$=1,_.export(k,_,B,w,$))})}else{let B;switch($){case 1:y="tag",B=this.l;break;case 2:y="store",B=this.store;break;default:return}ra(k,this,y,w,$,B)}},t.import=function(k,_){if(_)switch(x(_)&&(_=JSON.parse(_)),k){case"tag":this.l=_;break;case"reg":this.m=!1,this.register=_;for(let w=0,$;w<this.h.length;w++)$=this.index[this.h[w]],$.register=_,$.m=!1;break;case"store":this.store=_;break;default:k=k.split(".");const y=k[0];k=k[1],y&&k&&this.index[y].import(k,_)}},la(Q.prototype);var Ba={encode:Aa,F:!1,G:""};const Ca=[F("[àáâãäå]"),"a",F("[èéêë]"),"e",F("[ìíîï]"),"i",F("[òóôõöő]"),"o",F("[ùúûüű]"),"u",F("[ýŷÿ]"),"y",F("ñ"),"n",F("[çc]"),"k",F("ß"),"s",F(" & ")," and "];function Aa(k){var _=k;return _.normalize&&(_=_.normalize("NFD").replace(ea,"")),ca.call(this,_.toLowerCase(),!k.normalize&&Ca)}var Ea={encode:Da,F:!1,G:"strict"};const Fa=/[^a-z0-9]+/,Ga={b:"p",v:"f",w:"f",z:"s",x:"s",ß:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Da(k){k=Aa.call(this,k).join(" ");const _=[];if(k){const y=k.split(Fa),w=y.length;for(let $=0,B,R=0;$<w;$++)if((k=y[$])&&(!this.filter||!this.filter[k])){B=k[0];let H=Ga[B]||B,j=H;for(let q=1;q<k.length;q++){B=k[q];const X=Ga[B]||B;X&&X!==j&&(H+=X,j=X)}_[R++]=H}}return _}var Ia={encode:Ha,F:!1,G:""};const Ja=[F("ae"),"a",F("oe"),"o",F("sh"),"s",F("th"),"t",F("ph"),"f",F("pf"),"f",F("(?![aeo])h(?![aeo])"),"",F("(?!^[aeo])h(?!^[aeo])"),""];function Ha(k,_){return k&&(k=Da.call(this,k).join(" "),2<k.length&&(k=E(k,Ja)),_||(1<k.length&&(k=ha(k)),k&&(k=k.split(" ")))),k}var La={encode:Ka,F:!1,G:""};const Ma=F("(?!\\b)[aeo]");function Ka(k){return k&&(k=Ha.call(this,k,!0),1<k.length&&(k=k.replace(Ma,"")),1<k.length&&(k=ha(k)),k&&(k=k.split(" "))),k}G["latin:default"]=ja,G["latin:simple"]=Ba,G["latin:balance"]=Ea,G["latin:advanced"]=Ia,G["latin:extra"]=La;const W=self;let Y;const Z={Index:K,Document:Q,Worker:O,registerCharset:function(k,_){G[k]=_},registerLanguage:function(k,_){ka[k]=_}};(Y=W.define)&&Y.amd?Y([],function(){return Z}):W.exports?W.exports=Z:W.FlexSearch=Z})(commonjsGlobal)})(flexsearch_bundle);var flexsearch_bundleExports=flexsearch_bundle.exports;const FlexSearch=getDefaultExportFromCjs(flexsearch_bundleExports),DocumentIndexer=FlexSearch.Document,Index=FlexSearch.Index;function tokenize$1(k){const _=Intl.Segmenter;if(_){const y=new Index({charset:"latin:advanced"}),w=y.encode.bind(y),$=/^[\p{Script=Latin}\p{Mark}\d]+$/u,B=new _([k],{granularity:"word"});return R=>{const H=[];return[...Array.from(B.segment(R)).filter(q=>{if(q.isWordLike){if(!$.test(q.segment))return!0;H.push(q.segment)}return!1}).map(q=>q.segment),...w(H.join(" "))]}}return y=>y.replace(/[\x00-\x7F]/g,"").split("")}class SearchIndexer{constructor(_,y="en-US"){this._doc=_,this._indexer=new DocumentIndexer({document:{id:"id",index:["content","reference","space"],tag:"tags",store:["space"]},encode:tokenize$1(y),tokenize:"forward",context:!0}),_.spaces.observe(w=>{w.keysChanged.forEach($=>{const B=this._getPage($);B!=null&&this._handlePageIndexing($,B)})})}search(_){return new Map(this._search(_).flatMap(({result:y})=>y.map(w=>[w.id,w.doc.space])))}_search(_){return typeof _=="object"?this._indexer.search({..._,enrich:!0}):this._indexer.search(_,{enrich:!0})}refreshPageIndex(_,y){const w=y.getMap("blocks");w.forEach(($,B)=>{this._refreshIndex(_,B,"add",w.get(B))})}_handlePageIndexing(_,y){if(!y)return;const w=y.getMap("blocks");this.refreshPageIndex(_,y),w.observeDeep($=>{const B=$.flatMap(R=>(R.path?.length|0)>0?[[R.path[0],"update"]]:Array.from(R.changes.keys.entries()).map(([H,{action:j}])=>[H,j]));B.length&&B.forEach(([R,H])=>{this._refreshIndex(_,R,H,w.get(R))})})}_refreshIndex(_,y,w,$){switch(w){case"add":case"update":{if($){const B=this._toContent($.get("prop:title")||$.get("prop:text"));B&&this._indexer.add(y,{content:B,space:_,tags:[_]})}break}case"delete":{this._indexer.remove(y);break}}}_toContent(_){if(_){if(typeof _=="string")return _;if(_ instanceof YText)return _.toJSON()}}_getPage(_){try{return _.startsWith("space:")||(_=`space:${_}`),this._doc.spaces.get(_)}catch{return}}}var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$3=0,len$1=code.length;i$3<len$1;++i$3)lookup[i$3]=code[i$3],revLookup[code.charCodeAt(i$3)]=i$3;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(k){var _=k.length;if(_%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var y=k.indexOf("=");y===-1&&(y=_);var w=y===_?0:4-y%4;return[y,w]}function byteLength(k){var _=getLens(k),y=_[0],w=_[1];return(y+w)*3/4-w}function _byteLength(k,_,y){return(_+y)*3/4-y}function toByteArray(k){var _,y=getLens(k),w=y[0],$=y[1],B=new Arr(_byteLength(k,w,$)),R=0,H=$>0?w-4:w,j;for(j=0;j<H;j+=4)_=revLookup[k.charCodeAt(j)]<<18|revLookup[k.charCodeAt(j+1)]<<12|revLookup[k.charCodeAt(j+2)]<<6|revLookup[k.charCodeAt(j+3)],B[R++]=_>>16&255,B[R++]=_>>8&255,B[R++]=_&255;return $===2&&(_=revLookup[k.charCodeAt(j)]<<2|revLookup[k.charCodeAt(j+1)]>>4,B[R++]=_&255),$===1&&(_=revLookup[k.charCodeAt(j)]<<10|revLookup[k.charCodeAt(j+1)]<<4|revLookup[k.charCodeAt(j+2)]>>2,B[R++]=_>>8&255,B[R++]=_&255),B}function tripletToBase64(k){return lookup[k>>18&63]+lookup[k>>12&63]+lookup[k>>6&63]+lookup[k&63]}function encodeChunk(k,_,y){for(var w,$=[],B=_;B<y;B+=3)w=(k[B]<<16&16711680)+(k[B+1]<<8&65280)+(k[B+2]&255),$.push(tripletToBase64(w));return $.join("")}function fromByteArray(k){for(var _,y=k.length,w=y%3,$=[],B=16383,R=0,H=y-w;R<H;R+=B)$.push(encodeChunk(k,R,R+B>H?H:R+B));return w===1?(_=k[y-1],$.push(lookup[_>>2]+lookup[_<<4&63]+"==")):w===2&&(_=(k[y-2]<<8)+k[y-1],$.push(lookup[_>>10]+lookup[_>>4&63]+lookup[_<<2&63]+"=")),$.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(k,_,y,w,$){var B,R,H=$*8-w-1,j=(1<<H)-1,q=j>>1,X=-7,ee=y?$-1:0,te=y?-1:1,ne=k[_+ee];for(ee+=te,B=ne&(1<<-X)-1,ne>>=-X,X+=H;X>0;B=B*256+k[_+ee],ee+=te,X-=8);for(R=B&(1<<-X)-1,B>>=-X,X+=w;X>0;R=R*256+k[_+ee],ee+=te,X-=8);if(B===0)B=1-q;else{if(B===j)return R?NaN:(ne?-1:1)*(1/0);R=R+Math.pow(2,w),B=B-q}return(ne?-1:1)*R*Math.pow(2,B-w)};ieee754.write=function(k,_,y,w,$,B){var R,H,j,q=B*8-$-1,X=(1<<q)-1,ee=X>>1,te=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=w?0:B-1,oe=w?1:-1,ie=_<0||_===0&&1/_<0?1:0;for(_=Math.abs(_),isNaN(_)||_===1/0?(H=isNaN(_)?1:0,R=X):(R=Math.floor(Math.log(_)/Math.LN2),_*(j=Math.pow(2,-R))<1&&(R--,j*=2),R+ee>=1?_+=te/j:_+=te*Math.pow(2,1-ee),_*j>=2&&(R++,j/=2),R+ee>=X?(H=0,R=X):R+ee>=1?(H=(_*j-1)*Math.pow(2,$),R=R+ee):(H=_*Math.pow(2,ee-1)*Math.pow(2,$),R=0));$>=8;k[y+ne]=H&255,ne+=oe,H/=256,$-=8);for(R=R<<$|H,q+=$;q>0;k[y+ne]=R&255,ne+=oe,R/=256,q-=8);k[y+ne-oe]|=ie*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(k){const _=base64Js,y=ieee754,w=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;k.Buffer=H,k.SlowBuffer=se,k.INSPECT_MAX_BYTES=50;const $=2147483647;k.kMaxLength=$,H.TYPED_ARRAY_SUPPORT=B(),!H.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function B(){try{const xe=new Uint8Array(1),de={foo:function(){return 42}};return Object.setPrototypeOf(de,Uint8Array.prototype),Object.setPrototypeOf(xe,de),xe.foo()===42}catch{return!1}}Object.defineProperty(H.prototype,"parent",{enumerable:!0,get:function(){if(H.isBuffer(this))return this.buffer}}),Object.defineProperty(H.prototype,"offset",{enumerable:!0,get:function(){if(H.isBuffer(this))return this.byteOffset}});function R(xe){if(xe>$)throw new RangeError('The value "'+xe+'" is invalid for option "size"');const de=new Uint8Array(xe);return Object.setPrototypeOf(de,H.prototype),de}function H(xe,de,pe){if(typeof xe=="number"){if(typeof de=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return ee(xe)}return j(xe,de,pe)}H.poolSize=8192;function j(xe,de,pe){if(typeof xe=="string")return te(xe,de);if(ArrayBuffer.isView(xe))return oe(xe);if(xe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof xe);if(Ae(xe,ArrayBuffer)||xe&&Ae(xe.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ae(xe,SharedArrayBuffer)||xe&&Ae(xe.buffer,SharedArrayBuffer)))return ie(xe,de,pe);if(typeof xe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Se=xe.valueOf&&xe.valueOf();if(Se!=null&&Se!==xe)return H.from(Se,de,pe);const Le=ae(xe);if(Le)return Le;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof xe[Symbol.toPrimitive]=="function")return H.from(xe[Symbol.toPrimitive]("string"),de,pe);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof xe)}H.from=function(xe,de,pe){return j(xe,de,pe)},Object.setPrototypeOf(H.prototype,Uint8Array.prototype),Object.setPrototypeOf(H,Uint8Array);function q(xe){if(typeof xe!="number")throw new TypeError('"size" argument must be of type number');if(xe<0)throw new RangeError('The value "'+xe+'" is invalid for option "size"')}function X(xe,de,pe){return q(xe),xe<=0?R(xe):de!==void 0?typeof pe=="string"?R(xe).fill(de,pe):R(xe).fill(de):R(xe)}H.alloc=function(xe,de,pe){return X(xe,de,pe)};function ee(xe){return q(xe),R(xe<0?0:re(xe)|0)}H.allocUnsafe=function(xe){return ee(xe)},H.allocUnsafeSlow=function(xe){return ee(xe)};function te(xe,de){if((typeof de!="string"||de==="")&&(de="utf8"),!H.isEncoding(de))throw new TypeError("Unknown encoding: "+de);const pe=le(xe,de)|0;let Se=R(pe);const Le=Se.write(xe,de);return Le!==pe&&(Se=Se.slice(0,Le)),Se}function ne(xe){const de=xe.length<0?0:re(xe.length)|0,pe=R(de);for(let Se=0;Se<de;Se+=1)pe[Se]=xe[Se]&255;return pe}function oe(xe){if(Ae(xe,Uint8Array)){const de=new Uint8Array(xe);return ie(de.buffer,de.byteOffset,de.byteLength)}return ne(xe)}function ie(xe,de,pe){if(de<0||xe.byteLength<de)throw new RangeError('"offset" is outside of buffer bounds');if(xe.byteLength<de+(pe||0))throw new RangeError('"length" is outside of buffer bounds');let Se;return de===void 0&&pe===void 0?Se=new Uint8Array(xe):pe===void 0?Se=new Uint8Array(xe,de):Se=new Uint8Array(xe,de,pe),Object.setPrototypeOf(Se,H.prototype),Se}function ae(xe){if(H.isBuffer(xe)){const de=re(xe.length)|0,pe=R(de);return pe.length===0||xe.copy(pe,0,0,de),pe}if(xe.length!==void 0)return typeof xe.length!="number"||Oe(xe.length)?R(0):ne(xe);if(xe.type==="Buffer"&&Array.isArray(xe.data))return ne(xe.data)}function re(xe){if(xe>=$)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+$.toString(16)+" bytes");return xe|0}function se(xe){return+xe!=xe&&(xe=0),H.alloc(+xe)}H.isBuffer=function(de){return de!=null&&de._isBuffer===!0&&de!==H.prototype},H.compare=function(de,pe){if(Ae(de,Uint8Array)&&(de=H.from(de,de.offset,de.byteLength)),Ae(pe,Uint8Array)&&(pe=H.from(pe,pe.offset,pe.byteLength)),!H.isBuffer(de)||!H.isBuffer(pe))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(de===pe)return 0;let Se=de.length,Le=pe.length;for(let ye=0,Ee=Math.min(Se,Le);ye<Ee;++ye)if(de[ye]!==pe[ye]){Se=de[ye],Le=pe[ye];break}return Se<Le?-1:Le<Se?1:0},H.isEncoding=function(de){switch(String(de).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},H.concat=function(de,pe){if(!Array.isArray(de))throw new TypeError('"list" argument must be an Array of Buffers');if(de.length===0)return H.alloc(0);let Se;if(pe===void 0)for(pe=0,Se=0;Se<de.length;++Se)pe+=de[Se].length;const Le=H.allocUnsafe(pe);let ye=0;for(Se=0;Se<de.length;++Se){let Ee=de[Se];if(Ae(Ee,Uint8Array))ye+Ee.length>Le.length?(H.isBuffer(Ee)||(Ee=H.from(Ee)),Ee.copy(Le,ye)):Uint8Array.prototype.set.call(Le,Ee,ye);else if(H.isBuffer(Ee))Ee.copy(Le,ye);else throw new TypeError('"list" argument must be an Array of Buffers');ye+=Ee.length}return Le};function le(xe,de){if(H.isBuffer(xe))return xe.length;if(ArrayBuffer.isView(xe)||Ae(xe,ArrayBuffer))return xe.byteLength;if(typeof xe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof xe);const pe=xe.length,Se=arguments.length>2&&arguments[2]===!0;if(!Se&&pe===0)return 0;let Le=!1;for(;;)switch(de){case"ascii":case"latin1":case"binary":return pe;case"utf8":case"utf-8":return $e(xe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe*2;case"hex":return pe>>>1;case"base64":return Ge(xe).length;default:if(Le)return Se?-1:$e(xe).length;de=(""+de).toLowerCase(),Le=!0}}H.byteLength=le;function ue(xe,de,pe){let Se=!1;if((de===void 0||de<0)&&(de=0),de>this.length||((pe===void 0||pe>this.length)&&(pe=this.length),pe<=0)||(pe>>>=0,de>>>=0,pe<=de))return"";for(xe||(xe="utf8");;)switch(xe){case"hex":return Re(this,de,pe);case"utf8":case"utf-8":return me(this,de,pe);case"ascii":return Be(this,de,pe);case"latin1":case"binary":return Ze(this,de,pe);case"base64":return ke(this,de,pe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return qe(this,de,pe);default:if(Se)throw new TypeError("Unknown encoding: "+xe);xe=(xe+"").toLowerCase(),Se=!0}}H.prototype._isBuffer=!0;function he(xe,de,pe){const Se=xe[de];xe[de]=xe[pe],xe[pe]=Se}H.prototype.swap16=function(){const de=this.length;if(de%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let pe=0;pe<de;pe+=2)he(this,pe,pe+1);return this},H.prototype.swap32=function(){const de=this.length;if(de%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let pe=0;pe<de;pe+=4)he(this,pe,pe+3),he(this,pe+1,pe+2);return this},H.prototype.swap64=function(){const de=this.length;if(de%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let pe=0;pe<de;pe+=8)he(this,pe,pe+7),he(this,pe+1,pe+6),he(this,pe+2,pe+5),he(this,pe+3,pe+4);return this},H.prototype.toString=function(){const de=this.length;return de===0?"":arguments.length===0?me(this,0,de):ue.apply(this,arguments)},H.prototype.toLocaleString=H.prototype.toString,H.prototype.equals=function(de){if(!H.isBuffer(de))throw new TypeError("Argument must be a Buffer");return this===de?!0:H.compare(this,de)===0},H.prototype.inspect=function(){let de="";const pe=k.INSPECT_MAX_BYTES;return de=this.toString("hex",0,pe).replace(/(.{2})/g,"$1 ").trim(),this.length>pe&&(de+=" ... "),"<Buffer "+de+">"},w&&(H.prototype[w]=H.prototype.inspect),H.prototype.compare=function(de,pe,Se,Le,ye){if(Ae(de,Uint8Array)&&(de=H.from(de,de.offset,de.byteLength)),!H.isBuffer(de))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof de);if(pe===void 0&&(pe=0),Se===void 0&&(Se=de?de.length:0),Le===void 0&&(Le=0),ye===void 0&&(ye=this.length),pe<0||Se>de.length||Le<0||ye>this.length)throw new RangeError("out of range index");if(Le>=ye&&pe>=Se)return 0;if(Le>=ye)return-1;if(pe>=Se)return 1;if(pe>>>=0,Se>>>=0,Le>>>=0,ye>>>=0,this===de)return 0;let Ee=ye-Le,He=Se-pe;const ze=Math.min(Ee,He),Xe=this.slice(Le,ye),ot=de.slice(pe,Se);for(let it=0;it<ze;++it)if(Xe[it]!==ot[it]){Ee=Xe[it],He=ot[it];break}return Ee<He?-1:He<Ee?1:0};function ce(xe,de,pe,Se,Le){if(xe.length===0)return-1;if(typeof pe=="string"?(Se=pe,pe=0):pe>2147483647?pe=2147483647:pe<-2147483648&&(pe=-2147483648),pe=+pe,Oe(pe)&&(pe=Le?0:xe.length-1),pe<0&&(pe=xe.length+pe),pe>=xe.length){if(Le)return-1;pe=xe.length-1}else if(pe<0)if(Le)pe=0;else return-1;if(typeof de=="string"&&(de=H.from(de,Se)),H.isBuffer(de))return de.length===0?-1:ge(xe,de,pe,Se,Le);if(typeof de=="number")return de=de&255,typeof Uint8Array.prototype.indexOf=="function"?Le?Uint8Array.prototype.indexOf.call(xe,de,pe):Uint8Array.prototype.lastIndexOf.call(xe,de,pe):ge(xe,[de],pe,Se,Le);throw new TypeError("val must be string, number or Buffer")}function ge(xe,de,pe,Se,Le){let ye=1,Ee=xe.length,He=de.length;if(Se!==void 0&&(Se=String(Se).toLowerCase(),Se==="ucs2"||Se==="ucs-2"||Se==="utf16le"||Se==="utf-16le")){if(xe.length<2||de.length<2)return-1;ye=2,Ee/=2,He/=2,pe/=2}function ze(ot,it){return ye===1?ot[it]:ot.readUInt16BE(it*ye)}let Xe;if(Le){let ot=-1;for(Xe=pe;Xe<Ee;Xe++)if(ze(xe,Xe)===ze(de,ot===-1?0:Xe-ot)){if(ot===-1&&(ot=Xe),Xe-ot+1===He)return ot*ye}else ot!==-1&&(Xe-=Xe-ot),ot=-1}else for(pe+He>Ee&&(pe=Ee-He),Xe=pe;Xe>=0;Xe--){let ot=!0;for(let it=0;it<He;it++)if(ze(xe,Xe+it)!==ze(de,it)){ot=!1;break}if(ot)return Xe}return-1}H.prototype.includes=function(de,pe,Se){return this.indexOf(de,pe,Se)!==-1},H.prototype.indexOf=function(de,pe,Se){return ce(this,de,pe,Se,!0)},H.prototype.lastIndexOf=function(de,pe,Se){return ce(this,de,pe,Se,!1)};function be(xe,de,pe,Se){pe=Number(pe)||0;const Le=xe.length-pe;Se?(Se=Number(Se),Se>Le&&(Se=Le)):Se=Le;const ye=de.length;Se>ye/2&&(Se=ye/2);let Ee;for(Ee=0;Ee<Se;++Ee){const He=parseInt(de.substr(Ee*2,2),16);if(Oe(He))return Ee;xe[pe+Ee]=He}return Ee}function fe(xe,de,pe,Se){return Ke($e(de,xe.length-pe),xe,pe,Se)}function we(xe,de,pe,Se){return Ke(Te(de),xe,pe,Se)}function Ce(xe,de,pe,Se){return Ke(Ge(de),xe,pe,Se)}function ve(xe,de,pe,Se){return Ke(De(de,xe.length-pe),xe,pe,Se)}H.prototype.write=function(de,pe,Se,Le){if(pe===void 0)Le="utf8",Se=this.length,pe=0;else if(Se===void 0&&typeof pe=="string")Le=pe,Se=this.length,pe=0;else if(isFinite(pe))pe=pe>>>0,isFinite(Se)?(Se=Se>>>0,Le===void 0&&(Le="utf8")):(Le=Se,Se=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ye=this.length-pe;if((Se===void 0||Se>ye)&&(Se=ye),de.length>0&&(Se<0||pe<0)||pe>this.length)throw new RangeError("Attempt to write outside buffer bounds");Le||(Le="utf8");let Ee=!1;for(;;)switch(Le){case"hex":return be(this,de,pe,Se);case"utf8":case"utf-8":return fe(this,de,pe,Se);case"ascii":case"latin1":case"binary":return we(this,de,pe,Se);case"base64":return Ce(this,de,pe,Se);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ve(this,de,pe,Se);default:if(Ee)throw new TypeError("Unknown encoding: "+Le);Le=(""+Le).toLowerCase(),Ee=!0}},H.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ke(xe,de,pe){return de===0&&pe===xe.length?_.fromByteArray(xe):_.fromByteArray(xe.slice(de,pe))}function me(xe,de,pe){pe=Math.min(xe.length,pe);const Se=[];let Le=de;for(;Le<pe;){const ye=xe[Le];let Ee=null,He=ye>239?4:ye>223?3:ye>191?2:1;if(Le+He<=pe){let ze,Xe,ot,it;switch(He){case 1:ye<128&&(Ee=ye);break;case 2:ze=xe[Le+1],(ze&192)===128&&(it=(ye&31)<<6|ze&63,it>127&&(Ee=it));break;case 3:ze=xe[Le+1],Xe=xe[Le+2],(ze&192)===128&&(Xe&192)===128&&(it=(ye&15)<<12|(ze&63)<<6|Xe&63,it>2047&&(it<55296||it>57343)&&(Ee=it));break;case 4:ze=xe[Le+1],Xe=xe[Le+2],ot=xe[Le+3],(ze&192)===128&&(Xe&192)===128&&(ot&192)===128&&(it=(ye&15)<<18|(ze&63)<<12|(Xe&63)<<6|ot&63,it>65535&&it<1114112&&(Ee=it))}}Ee===null?(Ee=65533,He=1):Ee>65535&&(Ee-=65536,Se.push(Ee>>>10&1023|55296),Ee=56320|Ee&1023),Se.push(Ee),Le+=He}return Fe(Se)}const Ie=4096;function Fe(xe){const de=xe.length;if(de<=Ie)return String.fromCharCode.apply(String,xe);let pe="",Se=0;for(;Se<de;)pe+=String.fromCharCode.apply(String,xe.slice(Se,Se+=Ie));return pe}function Be(xe,de,pe){let Se="";pe=Math.min(xe.length,pe);for(let Le=de;Le<pe;++Le)Se+=String.fromCharCode(xe[Le]&127);return Se}function Ze(xe,de,pe){let Se="";pe=Math.min(xe.length,pe);for(let Le=de;Le<pe;++Le)Se+=String.fromCharCode(xe[Le]);return Se}function Re(xe,de,pe){const Se=xe.length;(!de||de<0)&&(de=0),(!pe||pe<0||pe>Se)&&(pe=Se);let Le="";for(let ye=de;ye<pe;++ye)Le+=Ye[xe[ye]];return Le}function qe(xe,de,pe){const Se=xe.slice(de,pe);let Le="";for(let ye=0;ye<Se.length-1;ye+=2)Le+=String.fromCharCode(Se[ye]+Se[ye+1]*256);return Le}H.prototype.slice=function(de,pe){const Se=this.length;de=~~de,pe=pe===void 0?Se:~~pe,de<0?(de+=Se,de<0&&(de=0)):de>Se&&(de=Se),pe<0?(pe+=Se,pe<0&&(pe=0)):pe>Se&&(pe=Se),pe<de&&(pe=de);const Le=this.subarray(de,pe);return Object.setPrototypeOf(Le,H.prototype),Le};function Me(xe,de,pe){if(xe%1!==0||xe<0)throw new RangeError("offset is not uint");if(xe+de>pe)throw new RangeError("Trying to access beyond buffer length")}H.prototype.readUintLE=H.prototype.readUIntLE=function(de,pe,Se){de=de>>>0,pe=pe>>>0,Se||Me(de,pe,this.length);let Le=this[de],ye=1,Ee=0;for(;++Ee<pe&&(ye*=256);)Le+=this[de+Ee]*ye;return Le},H.prototype.readUintBE=H.prototype.readUIntBE=function(de,pe,Se){de=de>>>0,pe=pe>>>0,Se||Me(de,pe,this.length);let Le=this[de+--pe],ye=1;for(;pe>0&&(ye*=256);)Le+=this[de+--pe]*ye;return Le},H.prototype.readUint8=H.prototype.readUInt8=function(de,pe){return de=de>>>0,pe||Me(de,1,this.length),this[de]},H.prototype.readUint16LE=H.prototype.readUInt16LE=function(de,pe){return de=de>>>0,pe||Me(de,2,this.length),this[de]|this[de+1]<<8},H.prototype.readUint16BE=H.prototype.readUInt16BE=function(de,pe){return de=de>>>0,pe||Me(de,2,this.length),this[de]<<8|this[de+1]},H.prototype.readUint32LE=H.prototype.readUInt32LE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),(this[de]|this[de+1]<<8|this[de+2]<<16)+this[de+3]*16777216},H.prototype.readUint32BE=H.prototype.readUInt32BE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),this[de]*16777216+(this[de+1]<<16|this[de+2]<<8|this[de+3])},H.prototype.readBigUInt64LE=Je(function(de){de=de>>>0,lt(de,"offset");const pe=this[de],Se=this[de+7];(pe===void 0||Se===void 0)&&_e(de,this.length-8);const Le=pe+this[++de]*2**8+this[++de]*2**16+this[++de]*2**24,ye=this[++de]+this[++de]*2**8+this[++de]*2**16+Se*2**24;return BigInt(Le)+(BigInt(ye)<<BigInt(32))}),H.prototype.readBigUInt64BE=Je(function(de){de=de>>>0,lt(de,"offset");const pe=this[de],Se=this[de+7];(pe===void 0||Se===void 0)&&_e(de,this.length-8);const Le=pe*2**24+this[++de]*2**16+this[++de]*2**8+this[++de],ye=this[++de]*2**24+this[++de]*2**16+this[++de]*2**8+Se;return(BigInt(Le)<<BigInt(32))+BigInt(ye)}),H.prototype.readIntLE=function(de,pe,Se){de=de>>>0,pe=pe>>>0,Se||Me(de,pe,this.length);let Le=this[de],ye=1,Ee=0;for(;++Ee<pe&&(ye*=256);)Le+=this[de+Ee]*ye;return ye*=128,Le>=ye&&(Le-=Math.pow(2,8*pe)),Le},H.prototype.readIntBE=function(de,pe,Se){de=de>>>0,pe=pe>>>0,Se||Me(de,pe,this.length);let Le=pe,ye=1,Ee=this[de+--Le];for(;Le>0&&(ye*=256);)Ee+=this[de+--Le]*ye;return ye*=128,Ee>=ye&&(Ee-=Math.pow(2,8*pe)),Ee},H.prototype.readInt8=function(de,pe){return de=de>>>0,pe||Me(de,1,this.length),this[de]&128?(255-this[de]+1)*-1:this[de]},H.prototype.readInt16LE=function(de,pe){de=de>>>0,pe||Me(de,2,this.length);const Se=this[de]|this[de+1]<<8;return Se&32768?Se|4294901760:Se},H.prototype.readInt16BE=function(de,pe){de=de>>>0,pe||Me(de,2,this.length);const Se=this[de+1]|this[de]<<8;return Se&32768?Se|4294901760:Se},H.prototype.readInt32LE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),this[de]|this[de+1]<<8|this[de+2]<<16|this[de+3]<<24},H.prototype.readInt32BE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),this[de]<<24|this[de+1]<<16|this[de+2]<<8|this[de+3]},H.prototype.readBigInt64LE=Je(function(de){de=de>>>0,lt(de,"offset");const pe=this[de],Se=this[de+7];(pe===void 0||Se===void 0)&&_e(de,this.length-8);const Le=this[de+4]+this[de+5]*2**8+this[de+6]*2**16+(Se<<24);return(BigInt(Le)<<BigInt(32))+BigInt(pe+this[++de]*2**8+this[++de]*2**16+this[++de]*2**24)}),H.prototype.readBigInt64BE=Je(function(de){de=de>>>0,lt(de,"offset");const pe=this[de],Se=this[de+7];(pe===void 0||Se===void 0)&&_e(de,this.length-8);const Le=(pe<<24)+this[++de]*2**16+this[++de]*2**8+this[++de];return(BigInt(Le)<<BigInt(32))+BigInt(this[++de]*2**24+this[++de]*2**16+this[++de]*2**8+Se)}),H.prototype.readFloatLE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),y.read(this,de,!0,23,4)},H.prototype.readFloatBE=function(de,pe){return de=de>>>0,pe||Me(de,4,this.length),y.read(this,de,!1,23,4)},H.prototype.readDoubleLE=function(de,pe){return de=de>>>0,pe||Me(de,8,this.length),y.read(this,de,!0,52,8)},H.prototype.readDoubleBE=function(de,pe){return de=de>>>0,pe||Me(de,8,this.length),y.read(this,de,!1,52,8)};function Pe(xe,de,pe,Se,Le,ye){if(!H.isBuffer(xe))throw new TypeError('"buffer" argument must be a Buffer instance');if(de>Le||de<ye)throw new RangeError('"value" argument is out of bounds');if(pe+Se>xe.length)throw new RangeError("Index out of range")}H.prototype.writeUintLE=H.prototype.writeUIntLE=function(de,pe,Se,Le){if(de=+de,pe=pe>>>0,Se=Se>>>0,!Le){const He=Math.pow(2,8*Se)-1;Pe(this,de,pe,Se,He,0)}let ye=1,Ee=0;for(this[pe]=de&255;++Ee<Se&&(ye*=256);)this[pe+Ee]=de/ye&255;return pe+Se},H.prototype.writeUintBE=H.prototype.writeUIntBE=function(de,pe,Se,Le){if(de=+de,pe=pe>>>0,Se=Se>>>0,!Le){const He=Math.pow(2,8*Se)-1;Pe(this,de,pe,Se,He,0)}let ye=Se-1,Ee=1;for(this[pe+ye]=de&255;--ye>=0&&(Ee*=256);)this[pe+ye]=de/Ee&255;return pe+Se},H.prototype.writeUint8=H.prototype.writeUInt8=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,1,255,0),this[pe]=de&255,pe+1},H.prototype.writeUint16LE=H.prototype.writeUInt16LE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,2,65535,0),this[pe]=de&255,this[pe+1]=de>>>8,pe+2},H.prototype.writeUint16BE=H.prototype.writeUInt16BE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,2,65535,0),this[pe]=de>>>8,this[pe+1]=de&255,pe+2},H.prototype.writeUint32LE=H.prototype.writeUInt32LE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,4,4294967295,0),this[pe+3]=de>>>24,this[pe+2]=de>>>16,this[pe+1]=de>>>8,this[pe]=de&255,pe+4},H.prototype.writeUint32BE=H.prototype.writeUInt32BE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,4,4294967295,0),this[pe]=de>>>24,this[pe+1]=de>>>16,this[pe+2]=de>>>8,this[pe+3]=de&255,pe+4};function Qe(xe,de,pe,Se,Le){ct(de,Se,Le,xe,pe,7);let ye=Number(de&BigInt(4294967295));xe[pe++]=ye,ye=ye>>8,xe[pe++]=ye,ye=ye>>8,xe[pe++]=ye,ye=ye>>8,xe[pe++]=ye;let Ee=Number(de>>BigInt(32)&BigInt(4294967295));return xe[pe++]=Ee,Ee=Ee>>8,xe[pe++]=Ee,Ee=Ee>>8,xe[pe++]=Ee,Ee=Ee>>8,xe[pe++]=Ee,pe}function je(xe,de,pe,Se,Le){ct(de,Se,Le,xe,pe,7);let ye=Number(de&BigInt(4294967295));xe[pe+7]=ye,ye=ye>>8,xe[pe+6]=ye,ye=ye>>8,xe[pe+5]=ye,ye=ye>>8,xe[pe+4]=ye;let Ee=Number(de>>BigInt(32)&BigInt(4294967295));return xe[pe+3]=Ee,Ee=Ee>>8,xe[pe+2]=Ee,Ee=Ee>>8,xe[pe+1]=Ee,Ee=Ee>>8,xe[pe]=Ee,pe+8}H.prototype.writeBigUInt64LE=Je(function(de,pe=0){return Qe(this,de,pe,BigInt(0),BigInt("0xffffffffffffffff"))}),H.prototype.writeBigUInt64BE=Je(function(de,pe=0){return je(this,de,pe,BigInt(0),BigInt("0xffffffffffffffff"))}),H.prototype.writeIntLE=function(de,pe,Se,Le){if(de=+de,pe=pe>>>0,!Le){const ze=Math.pow(2,8*Se-1);Pe(this,de,pe,Se,ze-1,-ze)}let ye=0,Ee=1,He=0;for(this[pe]=de&255;++ye<Se&&(Ee*=256);)de<0&&He===0&&this[pe+ye-1]!==0&&(He=1),this[pe+ye]=(de/Ee>>0)-He&255;return pe+Se},H.prototype.writeIntBE=function(de,pe,Se,Le){if(de=+de,pe=pe>>>0,!Le){const ze=Math.pow(2,8*Se-1);Pe(this,de,pe,Se,ze-1,-ze)}let ye=Se-1,Ee=1,He=0;for(this[pe+ye]=de&255;--ye>=0&&(Ee*=256);)de<0&&He===0&&this[pe+ye+1]!==0&&(He=1),this[pe+ye]=(de/Ee>>0)-He&255;return pe+Se},H.prototype.writeInt8=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,1,127,-128),de<0&&(de=255+de+1),this[pe]=de&255,pe+1},H.prototype.writeInt16LE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,2,32767,-32768),this[pe]=de&255,this[pe+1]=de>>>8,pe+2},H.prototype.writeInt16BE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,2,32767,-32768),this[pe]=de>>>8,this[pe+1]=de&255,pe+2},H.prototype.writeInt32LE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,4,2147483647,-2147483648),this[pe]=de&255,this[pe+1]=de>>>8,this[pe+2]=de>>>16,this[pe+3]=de>>>24,pe+4},H.prototype.writeInt32BE=function(de,pe,Se){return de=+de,pe=pe>>>0,Se||Pe(this,de,pe,4,2147483647,-2147483648),de<0&&(de=4294967295+de+1),this[pe]=de>>>24,this[pe+1]=de>>>16,this[pe+2]=de>>>8,this[pe+3]=de&255,pe+4},H.prototype.writeBigInt64LE=Je(function(de,pe=0){return Qe(this,de,pe,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),H.prototype.writeBigInt64BE=Je(function(de,pe=0){return je(this,de,pe,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ue(xe,de,pe,Se,Le,ye){if(pe+Se>xe.length)throw new RangeError("Index out of range");if(pe<0)throw new RangeError("Index out of range")}function tt(xe,de,pe,Se,Le){return de=+de,pe=pe>>>0,Le||Ue(xe,de,pe,4),y.write(xe,de,pe,Se,23,4),pe+4}H.prototype.writeFloatLE=function(de,pe,Se){return tt(this,de,pe,!0,Se)},H.prototype.writeFloatBE=function(de,pe,Se){return tt(this,de,pe,!1,Se)};function Ve(xe,de,pe,Se,Le){return de=+de,pe=pe>>>0,Le||Ue(xe,de,pe,8),y.write(xe,de,pe,Se,52,8),pe+8}H.prototype.writeDoubleLE=function(de,pe,Se){return Ve(this,de,pe,!0,Se)},H.prototype.writeDoubleBE=function(de,pe,Se){return Ve(this,de,pe,!1,Se)},H.prototype.copy=function(de,pe,Se,Le){if(!H.isBuffer(de))throw new TypeError("argument should be a Buffer");if(Se||(Se=0),!Le&&Le!==0&&(Le=this.length),pe>=de.length&&(pe=de.length),pe||(pe=0),Le>0&&Le<Se&&(Le=Se),Le===Se||de.length===0||this.length===0)return 0;if(pe<0)throw new RangeError("targetStart out of bounds");if(Se<0||Se>=this.length)throw new RangeError("Index out of range");if(Le<0)throw new RangeError("sourceEnd out of bounds");Le>this.length&&(Le=this.length),de.length-pe<Le-Se&&(Le=de.length-pe+Se);const ye=Le-Se;return this===de&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(pe,Se,Le):Uint8Array.prototype.set.call(de,this.subarray(Se,Le),pe),ye},H.prototype.fill=function(de,pe,Se,Le){if(typeof de=="string"){if(typeof pe=="string"?(Le=pe,pe=0,Se=this.length):typeof Se=="string"&&(Le=Se,Se=this.length),Le!==void 0&&typeof Le!="string")throw new TypeError("encoding must be a string");if(typeof Le=="string"&&!H.isEncoding(Le))throw new TypeError("Unknown encoding: "+Le);if(de.length===1){const Ee=de.charCodeAt(0);(Le==="utf8"&&Ee<128||Le==="latin1")&&(de=Ee)}}else typeof de=="number"?de=de&255:typeof de=="boolean"&&(de=Number(de));if(pe<0||this.length<pe||this.length<Se)throw new RangeError("Out of range index");if(Se<=pe)return this;pe=pe>>>0,Se=Se===void 0?this.length:Se>>>0,de||(de=0);let ye;if(typeof de=="number")for(ye=pe;ye<Se;++ye)this[ye]=de;else{const Ee=H.isBuffer(de)?de:H.from(de,Le),He=Ee.length;if(He===0)throw new TypeError('The value "'+de+'" is invalid for argument "value"');for(ye=0;ye<Se-pe;++ye)this[ye+pe]=Ee[ye%He]}return this};const nt={};function et(xe,de,pe){nt[xe]=class extends pe{constructor(){super(),Object.defineProperty(this,"message",{value:de.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${xe}]`,this.stack,delete this.name}get code(){return xe}set code(Le){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Le,writable:!0})}toString(){return`${this.name} [${xe}]: ${this.message}`}}}et("ERR_BUFFER_OUT_OF_BOUNDS",function(xe){return xe?`${xe} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),et("ERR_INVALID_ARG_TYPE",function(xe,de){return`The "${xe}" argument must be of type number. Received type ${typeof de}`},TypeError),et("ERR_OUT_OF_RANGE",function(xe,de,pe){let Se=`The value of "${xe}" is out of range.`,Le=pe;return Number.isInteger(pe)&&Math.abs(pe)>2**32?Le=st(String(pe)):typeof pe=="bigint"&&(Le=String(pe),(pe>BigInt(2)**BigInt(32)||pe<-(BigInt(2)**BigInt(32)))&&(Le=st(Le)),Le+="n"),Se+=` It must be ${de}. Received ${Le}`,Se},RangeError);function st(xe){let de="",pe=xe.length;const Se=xe[0]==="-"?1:0;for(;pe>=Se+4;pe-=3)de=`_${xe.slice(pe-3,pe)}${de}`;return`${xe.slice(0,pe)}${de}`}function at(xe,de,pe){lt(de,"offset"),(xe[de]===void 0||xe[de+pe]===void 0)&&_e(de,xe.length-(pe+1))}function ct(xe,de,pe,Se,Le,ye){if(xe>pe||xe<de){const Ee=typeof de=="bigint"?"n":"";let He;throw ye>3?de===0||de===BigInt(0)?He=`>= 0${Ee} and < 2${Ee} ** ${(ye+1)*8}${Ee}`:He=`>= -(2${Ee} ** ${(ye+1)*8-1}${Ee}) and < 2 ** ${(ye+1)*8-1}${Ee}`:He=`>= ${de}${Ee} and <= ${pe}${Ee}`,new nt.ERR_OUT_OF_RANGE("value",He,xe)}at(Se,Le,ye)}function lt(xe,de){if(typeof xe!="number")throw new nt.ERR_INVALID_ARG_TYPE(de,"number",xe)}function _e(xe,de,pe){throw Math.floor(xe)!==xe?(lt(xe,pe),new nt.ERR_OUT_OF_RANGE(pe||"offset","an integer",xe)):de<0?new nt.ERR_BUFFER_OUT_OF_BOUNDS:new nt.ERR_OUT_OF_RANGE(pe||"offset",`>= ${pe?1:0} and <= ${de}`,xe)}const We=/[^+/0-9A-Za-z-_]/g;function Ne(xe){if(xe=xe.split("=")[0],xe=xe.trim().replace(We,""),xe.length<2)return"";for(;xe.length%4!==0;)xe=xe+"=";return xe}function $e(xe,de){de=de||1/0;let pe;const Se=xe.length;let Le=null;const ye=[];for(let Ee=0;Ee<Se;++Ee){if(pe=xe.charCodeAt(Ee),pe>55295&&pe<57344){if(!Le){if(pe>56319){(de-=3)>-1&&ye.push(239,191,189);continue}else if(Ee+1===Se){(de-=3)>-1&&ye.push(239,191,189);continue}Le=pe;continue}if(pe<56320){(de-=3)>-1&&ye.push(239,191,189),Le=pe;continue}pe=(Le-55296<<10|pe-56320)+65536}else Le&&(de-=3)>-1&&ye.push(239,191,189);if(Le=null,pe<128){if((de-=1)<0)break;ye.push(pe)}else if(pe<2048){if((de-=2)<0)break;ye.push(pe>>6|192,pe&63|128)}else if(pe<65536){if((de-=3)<0)break;ye.push(pe>>12|224,pe>>6&63|128,pe&63|128)}else if(pe<1114112){if((de-=4)<0)break;ye.push(pe>>18|240,pe>>12&63|128,pe>>6&63|128,pe&63|128)}else throw new Error("Invalid code point")}return ye}function Te(xe){const de=[];for(let pe=0;pe<xe.length;++pe)de.push(xe.charCodeAt(pe)&255);return de}function De(xe,de){let pe,Se,Le;const ye=[];for(let Ee=0;Ee<xe.length&&!((de-=2)<0);++Ee)pe=xe.charCodeAt(Ee),Se=pe>>8,Le=pe%256,ye.push(Le),ye.push(Se);return ye}function Ge(xe){return _.toByteArray(Ne(xe))}function Ke(xe,de,pe,Se){let Le;for(Le=0;Le<Se&&!(Le+pe>=de.length||Le>=xe.length);++Le)de[Le+pe]=xe[Le];return Le}function Ae(xe,de){return xe instanceof de||xe!=null&&xe.constructor!=null&&xe.constructor.name!=null&&xe.constructor.name===de.name}function Oe(xe){return xe!==xe}const Ye=function(){const xe="0123456789abcdef",de=new Array(256);for(let pe=0;pe<16;++pe){const Se=pe*16;for(let Le=0;Le<16;++Le)de[Se+Le]=xe[pe]+xe[Le]}return de}();function Je(xe){return typeof BigInt>"u"?rt:xe}function rt(){throw new Error("BigInt not supported")}})(buffer);async function sha(k){const _=await crypto.subtle.digest("SHA-256",k);return buffer.Buffer.from(_).toString("base64").replace(/\+/g,"-").replace(/\//g,"_")}class WorkspaceMeta{constructor(_){this.id="meta",this._prevPages=new Set,this.pageMetaAdded=new Slot$1,this.pageMetaRemoved=new Slot$1,this.pageMetasUpdated=new Slot$1,this.commonFieldsUpdated=new Slot$1,this._handleWorkspaceMetaEvents=y=>{y.forEach(w=>{const $=B=>w.target===this._yMap&&w.changes.keys.has(B);(w.target===this.yPages||w.target.parent===this.yPages||$("pages"))&&this._handlePageMetaEvent(),($("name")||$("avatar"))&&this._handleCommonFieldsEvent()})},this.doc=_,this._yMap=_.getMap(this.id),this._proxy=_.getMapProxy(this.id,{deep:!0}),this._yMap.observeDeep(this._handleWorkspaceMetaEvents)}get yPages(){return this._yMap.get("pages")}get pages(){return this._proxy.pages}get name(){return this._proxy.name}get avatar(){return this._proxy.avatar}get blockVersions(){return this._proxy.blockVersions}get workspaceVersion(){return this._proxy.workspaceVersion}get pageVersion(){return this._proxy.pageVersion}setName(_){this.doc.transact(()=>{this._proxy.name=_},this.doc.clientID)}setAvatar(_){this.doc.transact(()=>{this._proxy.avatar=_},this.doc.clientID)}get pageMetas(){return this._proxy.pages?[...this._proxy.pages]:[]}getPageMeta(_){return this.pageMetas.find(y=>y.id===_)}addPageMeta(_,y){this.doc.transact(()=>{this.pages||(this._proxy.pages=[]);const w=this.pages;y===void 0?w.push(_):w.splice(y,0,_)},this.doc.clientID)}setPageMeta(_,y){const $=(this.pages??[]).findIndex(B=>_===B.id);this.doc.transact(()=>{if(this.pages||(this._proxy.pages=[]),$===-1)return;assertExists$1(this.pages);const B=this.pages[$];Object.entries(y).forEach(([R,H])=>{B[R]=H})},this.doc.clientID)}removePageMeta(_){assertExists$1(this.pages);const w=this.pageMetas.findIndex($=>_===$.id);w!==-1&&this.doc.transact(()=>{assertExists$1(this.pages),this.pages.splice(w,1)},this.doc.clientID)}get hasVersion(){return!this.blockVersions||!this.pageVersion||!this.workspaceVersion?!1:Object.keys(this.blockVersions).length>0}writeVersion(_){const{blockVersions:y,pageVersion:w,workspaceVersion:$}=this._proxy;if($?console.error("Workspace version already set."):this._proxy.workspaceVersion=WORKSPACE_VERSION,w?console.error("Page version already set."):this._proxy.pageVersion=PAGE_VERSION,y)console.error("Block versions already set.");else{const B={};_.schema.flavourSchemaMap.forEach((R,H)=>{B[H]=R.version}),this._proxy.blockVersions=B}}validateVersion(_){const y={...this._proxy.blockVersions};if(!y)throw new Error("Invalid workspace data, versions data is missing. Please make sure the data is valid");const w=Object.keys(y);if(w.length===0)throw new Error("Invalid workspace data, missing versions field. Please make sure the data is valid.");w.forEach($=>{const B=y[$],R=_.schema.flavourSchemaMap.get($)?.version;if(R){if(B>R)throw new Error(`Editor doesn't support ${$}@${B}. Please upgrade the editor.`);if(B<R)throw new Error(`In workspace data, the block flavour ${$}@${B} is outdated. Please downgrade the editor or try data migration.`)}else throw new Error(`Editor missing ${$} flavour. Please make sure this block flavour is registered.`)})}_handlePageMetaEvent(){const{pageMetas:_,_prevPages:y}=this;_.forEach(w=>{y.has(w.id)||this.pageMetaAdded.emit(w.id)}),y.forEach(w=>{!_.find(B=>B.id===w)&&this.pageMetaRemoved.emit(w)}),y.clear(),_.forEach(w=>y.add(w.id)),this.pageMetasUpdated.emit()}_handleCommonFieldsEvent(){this.commonFieldsUpdated.emit()}get properties(){let _=this._proxy.properties;return _||(this._proxy.properties=_={tags:{options:[]}}),_}setProperties(_){this._proxy.properties=_,this.pageMetasUpdated.emit()}}class Workspace{constructor(_){this._storages=[],this.slots={pagesUpdated:new Slot$1,pageAdded:new Slot$1,pageRemoved:new Slot$1,blobUpdate:new Slot$1},this._schema=_.schema,this._store=new Store(_),this._storages=(_.blobStorages??[createMemoryStorage]).map(w=>w(_.id)),this._blobStorage={get:async w=>{let $=!1,B=0;return new Promise(R=>{this._storages.forEach(H=>H.crud.get(w).then(j=>{j&&!$&&($=!0,R(j)),++B===this._storages.length&&!$&&R(null)}).catch(j=>{console.error(j),++B===this._storages.length&&!$&&R(null)}))})},set:async w=>{const $=await sha(await w.arrayBuffer());return await Promise.all(this._storages.map(B=>B.crud.set($,w))),$},delete:async w=>{await Promise.all(this._storages.map($=>$.crud.delete(w)))},list:async()=>{const w=new Set;return await Promise.all(this._storages.map(async $=>{(await $.crud.list()).forEach(R=>w.add(R))})),Array.from(w)}},this.meta=new WorkspaceMeta(this.doc),this._bindPageMetaEvents();const y=new BlockIndexer(this.doc,{slots:this.slots});this.indexer={search:new SearchIndexer(this.doc),backlink:new BacklinkIndexer(y)}}get id(){return this._store.id}get isEmpty(){if(this.doc.store.clients.size===0)return!0;let _=!1;return this.doc.store.clients.size===1&&Array.from(this.doc.store.clients.values())[0].length<=2&&(_=!0),_}get awarenessStore(){return this._store.awarenessStore}get providers(){return this._store.providers}get blobs(){return this._blobStorage}get pages(){return this._pages}get _pages(){return this._store.spaces}get doc(){return this._store.doc}get idGenerator(){return this._store.idGenerator}get schema(){return this._schema}registerProvider(_,y){return this._store.registerProvider(_,y)}_hasPage(_){return this._pages.has(`space:${_}`)}getPage(_){const y=_.startsWith("space:")?_:`space:${_}`;return this._pages.get(y)??null}_bindPageMetaEvents(){this.meta.pageMetaAdded.on(_=>{const y=new Page({id:_,workspace:this,doc:this.doc,awarenessStore:this.awarenessStore,idGenerator:this._store.idGenerator});this._store.addSpace(y),this.slots.pageAdded.emit(y.id)}),this.meta.pageMetasUpdated.on(()=>this.slots.pagesUpdated.emit()),this.meta.pageMetaRemoved.on(_=>{const y=this.getPage(_);this._store.removeSpace(y),y.remove(),this.slots.pageRemoved.emit(_)})}createPage(_={}){typeof _=="string"&&(_={id:_},console.warn("`createPage(pageId)` is deprecated, use `createPage()` directly or `createPage({ id: pageId })` instead"),console.warn("More details see https://github.com/toeverything/blocksuite/pull/2272"));const{id:y=this.idGenerator()}=_;if(this._hasPage(y))throw new Error("page already exists");return this.meta.addPageMeta({id:y,title:"",createDate:+new Date,tags:[]}),this.getPage(y)}setPageMeta(_,y){this.meta.setPageMeta(_,y)}removePage(_){const y=this.meta.getPageMeta(_);assertExists$1(y);const w=this.getPage(_);w&&(w.dispose(),this.meta.removePageMeta(_),this._store.removeSpace(w))}search(_){return this.indexer.search.search(_)}async importPageSnapshotV2(_,y){const w=docFromJSON(_);let $=this.getPage(y);$?(await $.waitForLoaded(),$.clear()):($=this.createPage({id:y}),await $.waitForLoaded());const B=encodeStateAsUpdate(w);applyUpdate($.spaceDoc,B),$.resetHistory()}exportPageSnapshotV2(_){const y=this.getPage(_);return assertExists$1(y,`page ${_} not found`),docToJSON(y.spaceDoc)}async importPageSnapshot(_,y){const w=X=>X.replace("sys:","").replace("prop:","").replace("space:",""),$=new Set;let B=this.getPage(y);B?(await B.waitForLoaded(),B.clear()):(B=this.createPage({id:y}),await B.waitForLoaded());const R=async X=>{const ee={};if(X["sys:flavour"]==="affine:surface"&&X["prop:elements"]&&Object.values(X["prop:elements"]).forEach(te=>{const ne=te;if(ne.type==="text"){const oe=new YText;oe.applyDelta(ne.text),ne.text=oe}if(ne.type==="frame"){const oe=new YText;oe.applyDelta(ne.title),ne.title=oe}if(ne.type==="shape"&&ne.text){const oe=new YText;oe.applyDelta(ne.text),ne.text=oe}}),X["sys:flavour"]==="affine:image"){const te=X["prop:sourceId"];if(typeof te!="string")throw new Error("Embed source is not a string");if(te.startsWith("http"))try{const oe=await(await fetch(te,{cache:"no-cache",mode:"cors",headers:{Origin:window.location.origin}})).blob();if(!oe.type.startsWith("image/"))throw new Error("Embed source is not an image");assertExists$1(B);const ie=B.blobs;assertExists$1(ie),X["prop:sourceId"]=await ie.set(oe)}catch(ne){console.error("Failed to fetch embed source"),console.error(ne)}}if(X["sys:flavour"]==="affine:database"){const ne=X["prop:columns"].filter(ie=>ie.type==="rich-text"),oe=X["prop:cells"];ne.forEach(ie=>{Object.keys(oe).forEach(ae=>{const se=oe[ae][ie.id];if(se&&Array.isArray(se.value)){const le=new YText;le.applyDelta(se.value),se.value=new Text$1(le).yText}})})}return Object.keys(X).forEach(te=>{if(!(te==="sys:children"||te==="sys:flavour")&&(ee[w(te)]=X[te],te==="prop:text"||te==="prop:title")){const ne=new YText;ne.applyDelta(X[te]),ee[w(te)]=new Text$1(ne)}}),ee},{blocks:H}=_;assertExists$1(H,"Snapshot structure is invalid");const j=async(X,ee,te)=>{const ne=ee["sys:id"];if($.has(ne))return;const oe=await R(ee);X.addBlock(ee["sys:flavour"],oe,te),await ee["sys:children"].reduce(async(ie,ae)=>{await ie,await j(X,H[ae],ne),$.add(ae)},Promise.resolve())},q=Object.values(H).find(X=>{const te=X["sys:flavour"];return this.schema.flavourSchemaMap.get(te)?.model?.role==="root"});await j(B,q)}exportPageSnapshot(_){const y=this.getPage(_);return assertExists$1(y,`page ${_} not found`),serializeYDoc(y.spaceDoc)}exportSnapshot(){return serializeYDoc(this.doc)}exportWorkspaceYDoc(){const _=encodeStateAsUpdate(this.doc),y=new Blob([_],{type:"application/octet-stream"}),w=URL.createObjectURL(y),$=document.createElement("a");$.href=w,$.download="workspace.ydoc",$.click(),URL.revokeObjectURL(w)}exportPageYDoc(_){const w=this.doc.getMap("spaces").get(`space:${_}`);if(!(w instanceof Doc))throw new Error(`Page ${_} not found or not a Y.Doc`);const $=encodeStateAsUpdate(w),B=new Blob([$],{type:"application/octet-stream"}),R=URL.createObjectURL(B),H=document.createElement("a");H.href=R,H.download="workspace.ydoc",H.click(),URL.revokeObjectURL(R)}exportJSX(_,y=this.meta.pageMetas.at(0)?.id){return assertExists$1(y),this._store.exportJSX(y,_)}}Workspace.Y=Y;const env$2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},importIdentifier$2="__ $BLOCKSUITE_STORE$ __";env$2[importIdentifier$2]===!0&&console.error("@blocksuite/store was already imported. This breaks constructor checks and will lead to issues!");env$2[importIdentifier$2]=!0;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const i$2="important",n$4=" !"+i$2,o$4=e$8(class extends i$8{constructor(k){var _;if(super(k),k.type!==t$3.ATTRIBUTE||k.name!=="style"||((_=k.strings)===null||_===void 0?void 0:_.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(k){return Object.keys(k).reduce((_,y)=>{const w=k[y];return w==null?_:_+`${y=y.includes("-")?y:y.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${w};`},"")}update(k,[_]){const{style:y}=k.element;if(this.ht===void 0){this.ht=new Set;for(const w in _)this.ht.add(w);return this.render(_)}this.ht.forEach(w=>{_[w]==null&&(this.ht.delete(w),w.includes("-")?y.removeProperty(w):y[w]="")});for(const w in _){const $=_[w];if($!=null){this.ht.add(w);const B=typeof $=="string"&&$.endsWith(n$4);w.includes("-")||B?y.setProperty(w,B?$.slice(0,-11):$,B?i$2:""):y[w]=$}}return T}}),ZERO_WIDTH_SPACE="​",ZERO_WIDTH_NON_JOINER="‌";function findDocumentOrShadowRoot(k){const _=k.rootElement;if(!_)throw new Error("editor root element not found");const y=_.getRootNode();return(y instanceof Document||y instanceof ShadowRoot)&&"getSelection"in y?y:_.ownerDocument}function getVEditorInsideRoot(k){const _=k.closest('[data-virgo-root="true"]');assertExists(_,"element must be inside a v-root");const y=_.virgoEditor;return assertExists(y,"element must be inside a v-root with virgo-editor"),y}var __decorate$2B=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let VirgoElement=class extends s$2{constructor(){super(...arguments),this.delta={insert:ZERO_WIDTH_SPACE}}render(){const _=getVEditorInsideRoot(this),y=_.attributeService.attributeRenderer;if(_.isEmbed(this.delta)){if(this.delta.insert.length!==1)throw new Error(`The length of embed node should only be 1.
          This seems to be an internal issue with Virgo.
          Please go to https://github.com/toeverything/blocksuite/issues
          to report it.`);return x$1`<span
        data-virgo-embed="true"
        data-virgo-element="true"
        contenteditable="false"
        style=${o$4({userSelect:"none"})}
        >${y(this.delta,this.selected)}</span
      >`}return x$1`<span data-virgo-element="true"
      >${y(this.delta,this.selected)}</span
    >`}createRenderRoot(){return this}};__decorate$2B([n$a({type:Object})],VirgoElement.prototype,"delta",void 0);__decorate$2B([n$a({attribute:!1})],VirgoElement.prototype,"selected",void 0);VirgoElement=__decorate$2B([e$7("v-element")],VirgoElement);const EmbedGap=x$1`<span
  data-virgo-text-value=${ZERO_WIDTH_SPACE}
  data-virgo-embed-gap="true"
  data-virgo-text="true"
  style=${o$4({userSelect:"text",padding:"0 1px",outline:"none"})}
  >${ZERO_WIDTH_SPACE}</span
>`;var __decorate$2A=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let VirgoLine=class extends s$2{constructor(){super(...arguments),this.elements=[]}get vElements(){return Array.from(this.querySelectorAll("v-element"))}get textLength(){return this.vElements.reduce((_,y)=>_+y.delta.insert.length,0)}get textContent(){return this.vElements.reduce((_,y)=>_+y.delta.insert,"")}async getUpdateComplete(){const _=await super.getUpdateComplete();return await Promise.all(this.vElements.map(y=>y.updateComplete)),_}firstUpdated(){this.style.display="block"}render(){if(this.elements.length===0)return x$1`<div><v-text .str=${ZERO_WIDTH_SPACE}></v-text></div>`;const _=this.closest('[data-virgo-root="true"]');assertExists(_,"v-line must be inside a v-root");const y=_.virgoEditor;assertExists(y,"v-line must be inside a v-root with virgo-editor");const w=this.elements.flatMap(([$,B],R)=>{if(y.isEmbed(B)){if(B.insert.length!==1)throw new Error(`The length of embed node should only be 1.
            This seems to be an internal issue with Virgo.
            Please go to https://github.com/toeverything/blocksuite/issues
            to report it.`);if(R===0){const H=this.elements[R+1]?.[1];return!H||y.isEmbed(H)?[EmbedGap,$,EmbedGap]:[EmbedGap,$]}else{const H=this.elements[R+1]?.[1];return!H||y.isEmbed(H)?[$,EmbedGap]:[$]}}return $});return x$1`<div style=${o$4({padding:"0 1px"})}>${w}</div>`}createRenderRoot(){return this}};__decorate$2A([n$a({attribute:!1})],VirgoLine.prototype,"elements",void 0);VirgoLine=__decorate$2A([e$7("v-line")],VirgoLine);var __decorate$2z=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let VText=class extends s$2{constructor(){super(...arguments),this.str=ZERO_WIDTH_SPACE,this.styles={"word-wrap":"break-word","white-space":"break-spaces"}}render(){return x$1`<span style=${o$4(this.styles)} data-virgo-text="true"
      >${this.str}</span
    >`}createRenderRoot(){return this}};__decorate$2z([n$a({attribute:!1})],VText.prototype,"str",void 0);__decorate$2z([n$a({attribute:!1})],VText.prototype,"styles",void 0);VText=__decorate$2z([e$7("v-text")],VText);function virgoTextStyles(k){let _="";k.underline&&(_+="underline"),k.strike&&(_+=" line-through");let y={};return k.code&&(y={"font-family":'"SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace',"line-height":"normal",background:"rgba(135,131,120,0.15)",color:"#EB5757","border-radius":"3px","font-size":"85%",padding:"0.2em 0.4em"}),o$4({"word-wrap":"break-word","white-space":"break-spaces","font-weight":k.bold?"bold":"normal","font-style":k.italic?"italic":"normal","text-decoration":_.length>0?_:"none",...y})}const getDefaultAttributeRenderer=()=>k=>{const _=k.attributes?virgoTextStyles(k.attributes):o$4({});return x$1`<span style=${_}
      ><v-text .str=${k.insert}></v-text
    ></span>`},baseTextAttributes=z.object({bold:z.literal(!0).optional().catch(void 0),italic:z.literal(!0).optional().catch(void 0),underline:z.literal(!0).optional().catch(void 0),strike:z.literal(!0).optional().catch(void 0),code:z.literal(!0).optional().catch(void 0),link:z.string().optional().catch(void 0)});function transformDelta$1(k){const _=[];let y=k.insert;for(;y.length>0;){const w=y.indexOf(`
`);if(w===-1){_.push({insert:y,attributes:k.attributes});break}y.slice(0,w).length>0&&_.push({insert:y.slice(0,w),attributes:k.attributes}),_.push(`
`),y=y.slice(w+1)}return _}function deltaInsertsToChunks$1(k){if(k.length===0)return[[]];const _=k.flatMap(transformDelta$1);function*y(w){let $=0;for(let B=0;B<w.length;B++)if(w[B]===`
`){const R=w.slice($,B);$=B+1,yield R}else B===w.length-1&&(yield w.slice($));w.at(-1)===`
`&&(yield[])}return Array.from(y(_))}function isNativeTextInVText(k){return k instanceof Text&&k.parentElement?.dataset.virgoText==="true"}function isVElement(k){return k instanceof HTMLElement&&(k.dataset.virgoElement==="true"||k instanceof VirgoElement)}function isVLine(k){return k instanceof HTMLElement&&(k instanceof VirgoLine||k.parentElement instanceof VirgoLine)}function isVRoot(k){return k instanceof HTMLElement&&k.dataset.virgoRoot==="true"}function isInEmbedElement(k){return k instanceof Element?k instanceof VirgoElement?k.querySelector('[data-virgo-embed="true"]')!==null:!!k.closest('[data-virgo-embed="true"]'):!!k.parentElement?.closest('[data-virgo-embed="true"]')}const agent=globalThis.navigator?.userAgent??"",platform$1=globalThis.navigator?.platform,IS_WEB=typeof window<"u",IS_SAFARI=/Apple Computer/.test(globalThis.navigator?.vendor),IS_FIREFOX=IS_WEB&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1,IS_IOS=IS_SAFARI&&(/Mobile\/\w+/.test(agent)||globalThis.navigator?.maxTouchPoints>2),IS_MAC=/Mac/i.test(platform$1),SHORT_KEY_PROPERTY=IS_IOS||IS_MAC?"metaKey":"ctrlKey",VKEYBOARD_PREVENT_DEFAULT=!1,VKEYBOARD_ALLOW_DEFAULT=!0;function createVirgoKeyDownHandler(k,_){const y={};function w(H){return H.shortKey&&(H[SHORT_KEY_PROPERTY]=H.shortKey,delete H.shortKey),H}function $(H,j){return["altKey","ctrlKey","metaKey","shiftKey"].some(q=>Object.hasOwn(j,q)&&j[q]!==H[q])?!1:j.key===H.key}function B(H){const j=w(H);(Array.isArray(j.key)?j.key:[j.key]).forEach(X=>{const ee={...j,key:X};y[X]=y[X]??[],y[X].push(ee)})}Object.values(_).forEach(H=>{B(H)});function R(H){if(H.defaultPrevented||H.isComposing)return;const q=(y[H.key]??[]).filter(le=>$(H,le));if(q.length===0)return;const X=k.getVRange();if(!X)return;const[ee,te]=k.getTextPoint(X.index),[ne,oe]=X.length===0?[ee,te]:k.getTextPoint(X.index+X.length),ie=ee.textContent?ee.textContent.slice(0,te):"",ae=ne.textContent?ne.textContent.slice(oe):"",re={vRange:X,vEditor:k,collapsed:X.length===0,prefixText:ie,suffixText:ae,raw:H};q.some(le=>le.prefix&&!le.prefix.test(re.prefixText)||le.suffix&&!le.suffix.test(re.suffixText)?!1:le.handler(re)===VKEYBOARD_PREVENT_DEFAULT)&&H.preventDefault()}return R}function calculateTextLength(k){return k.wholeText===ZERO_WIDTH_SPACE?0:k.wholeText.length}function getTextNodesFromElement(k){return Array.from(k.querySelectorAll('[data-virgo-text="true"]')).map(w=>{const $=Array.from(w.childNodes).find(B=>B instanceof Text);if(!$)throw new Error("text node not found");return $})}function nativePointToTextPoint(k,_){if(isNativeTextInVText(k))return[k,_];if(isVElement(k)){const w=getTextNodesFromElement(k);if(w.length===1){const $=w[0].parentElement?.closest('[data-virgo-element="true"]');if($ instanceof HTMLElement&&$.dataset.virgoEmbed==="true")return[w[0],0]}return w[_]?[w[_],0]:null}if(isVLine(k)||isVRoot(k))return getTextPointRoughlyFromElementByOffset(k,_,!0);if(!(k instanceof Node))return null;const y=getVNodesFromNode(k);return y?getTextPointFromVNodes(y,k,_):null}function textPointToDomPoint(k,_,y){if(y.dataset.virgoRoot!=="true")throw new Error("textRangeToDomPoint should be called with editor root element");if(!y.contains(k))return null;const w=getTextNodesFromElement(y),$=w.indexOf(k);let B=0;for(const q of w.slice(0,$))B+=calculateTextLength(q);k.wholeText!==ZERO_WIDTH_SPACE&&(B+=_);const R=k.parentElement;if(!R)throw new Error("text element parent not found");const H=R.closest("v-line");if(!H)throw new Error("line element not found");const j=Array.from(y.querySelectorAll("v-line")).indexOf(H);return{text:k,index:B+j}}function getVNodesFromNode(k){const _=k.parentElement?.closest("v-line");if(_)return Array.from(_.querySelectorAll("v-element"));const y=k instanceof Element?k.closest('[data-virgo-root="true"]'):k.parentElement?.closest('[data-virgo-root="true"]');return y?Array.from(y.querySelectorAll("v-line")):null}function getTextPointFromVNodes(k,_,y){const w=k[0];for(let $=0;$<k.length;$++){const B=k[$];if($===0&&AFollowedByB(_,B))return getTextPointRoughlyFromElementByOffset(w,y,!0);if(AInsideB(_,B))return getTextPointRoughlyFromElementByOffset(w,y,!1);if($===k.length-1&&APrecededByB(_,B)||$<k.length-1&&APrecededByB(_,B)&&AFollowedByB(_,k[$+1]))return getTextPointRoughlyFromElement(B)}return null}function getTextPointRoughlyFromElement(k){const _=getTextNodesFromElement(k);if(_.length===0)return null;const y=_[_.length-1];return[y,calculateTextLength(y)]}function getTextPointRoughlyFromElementByOffset(k,_,y){const w=getTextNodesFromElement(k);if(w.length===0)return null;const $=y?w[0]:w[w.length-1];return[$,_===0?_:$.length]}function AInsideB(k,_){return _.compareDocumentPosition(k)===Node.DOCUMENT_POSITION_CONTAINED_BY||_.compareDocumentPosition(k)===(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)}function AFollowedByB(k,_){return k.compareDocumentPosition(_)===Node.DOCUMENT_POSITION_FOLLOWING}function APrecededByB(k,_){return k.compareDocumentPosition(_)===Node.DOCUMENT_POSITION_PRECEDING}const rangeHasAnchorAndFocus=({rootElement:k,startText:_,endText:y})=>k.contains(_)&&k.contains(y),rangeHasAnchorAndFocusHandler=({rootElement:k,startText:_,endText:y,startTextOffset:w,endTextOffset:$})=>{const B=textPointToDomPoint(_,w,k),R=textPointToDomPoint(y,$,k);return!B||!R?null:{index:Math.min(B.index,R.index),length:Math.abs(B.index-R.index)}},rangeOnlyHasFocus=({rootElement:k,startText:_,endText:y})=>!k.contains(_)&&k.contains(y),rangeOnlyHasFocusHandler=({rootElement:k,endText:_,endTextOffset:y})=>{const w=textPointToDomPoint(_,y,k);return w?{index:0,length:w.index}:null},rangeOnlyHasAnchor=({rootElement:k,startText:_,endText:y})=>k.contains(_)&&!k.contains(y),rangeOnlyHasAnchorHandler=({yText:k,rootElement:_,startText:y,startTextOffset:w})=>{const $=textPointToDomPoint(y,w,_);return $?{index:$.index,length:k.length-$.index}:null},rangeHasNoAnchorAndFocus=({rootElement:k,startText:_,endText:y,range:w})=>!k.contains(_)&&!k.contains(y)&&w.intersectsNode(k),rangeHasNoAnchorAndFocusHandler=({yText:k})=>({index:0,length:k.length}),buildContext=(k,_,y)=>{const{startContainer:w,startOffset:$,endContainer:B,endOffset:R}=k,H=nativePointToTextPoint(w,$),j=nativePointToTextPoint(B,R);if(!H||!j)return null;const[q,X]=H,[ee,te]=j;return{rootElement:_,range:k,yText:y,startNode:w,startOffset:$,endNode:B,endOffset:R,startText:q,startTextOffset:X,endText:ee,endTextOffset:te}};function domRangeToVirgoRange(k,_,y){const w=buildContext(k,_,y);if(!w)return null;if(w.startNode&&w.startNode===w.endNode&&isInEmbedElement(w.startNode)){const $=textPointToDomPoint(w.startText,w.startTextOffset,_);if($)return{index:$.index,length:1}}return rangeHasAnchorAndFocus(w)?rangeHasAnchorAndFocusHandler(w):rangeOnlyHasFocus(w)?rangeOnlyHasFocusHandler(w):rangeOnlyHasAnchor(w)?rangeOnlyHasAnchorHandler(w):rangeHasNoAnchorAndFocus(w)?rangeHasNoAnchorAndFocusHandler(w):null}function virgoRangeToDomRange(k,_){const y=Array.from(k.querySelectorAll("v-line"));let w=null,$=null,B=0,R=0,H=0;for(let q=0;q<y.length&&!(w&&$);q++){const X=getTextNodesFromElement(y[q]);for(const ee of X){const te=calculateTextLength(ee);if(!w&&H+te>=_.index&&(w=ee,B=_.index-H),!$&&H+te>=_.index+_.length&&($=ee,R=_.index+_.length-H),w&&$)break;H+=te}H+=1}if(!w||!$)return null;if(isInEmbedElement(w)){const q=w.parentElement?.closest("v-element");if(!q)throw new Error("failed to find vElement for a text note in an embed element");const X=q.nextElementSibling;if(!X)throw new Error("failed to find nextSibling sibling of an embed element");if(X instanceof VirgoElement){const ee=getTextNodesFromElement(X);w=ee[ee.length-1],B=calculateTextLength(w)}else w=X.childNodes.item(1),B=0}if(isInEmbedElement($)){const q=$.parentElement?.closest("v-element");if(!q)throw new Error("failed to find vElement for a text note in an embed element");const X=q.nextElementSibling;if(!X)throw new Error("failed to find nextSibling sibling of an embed element");X instanceof VirgoElement?($=getTextNodesFromElement(X)[0],R=0):($=X.childNodes.item(1),R=0)}const j=document.createRange();return j.setStart(w,B),j.setEnd($,R),j}function renderElement(k,_,y){return x$1`<v-element
    .selected=${y}
    .delta=${{insert:k.insert,attributes:_(k.attributes)}}
  ></v-element>`}function handleInsertText(k,_,y,w){k.index>=0&&_&&(y.slots.vRangeUpdated.emit([{index:k.index+_.length,length:0},"input"]),y.insertText(k,_,w))}function handleInsertParagraph(k,_){k.index>=0&&(_.slots.vRangeUpdated.emit([{index:k.index+1,length:0},"input"]),_.insertLineBreak(k))}function handleDeleteBackward(k,_){if(k.index>=0){if(k.length>0){_.slots.vRangeUpdated.emit([{index:k.index,length:0},"input"]),_.deleteText(k);return}if(k.index>0){const y=_.yText.toString().slice(0,k.index),w=[...new Intl.Segmenter().segment(y)],$=w[w.length-1].segment.length;_.slots.vRangeUpdated.emit([{index:k.index-$,length:0},"input"]),_.deleteText({index:k.index-$,length:$})}}}function handleDeleteForward(k,_){if(_.index<k.yText.length)if(_.length>0)k.slots.vRangeUpdated.emit([{index:_.index,length:0},"input"]),k.deleteText(_);else{const y=k.yText.toString(),w=[...new Intl.Segmenter().segment(y)],$=y.slice(0,_.index),B=[...new Intl.Segmenter().segment($)],R=w[B.length].segment.length;k.slots.vRangeUpdated.emit([{index:_.index,length:0},"input"]),k.deleteText({index:_.index,length:R})}}function handleDeleteWordBackward(k,_){const y=/\S+\s*$/.exec(k.yText.toString().slice(0,_.index));if(y){const w=y[0].length;k.slots.vRangeUpdated.emit([{index:_.index-w,length:0},"input"]),k.deleteText({index:_.index-w,length:w})}}function handleDeleteWordForward(k,_){const y=/^\s*\S+/.exec(k.yText.toString().slice(_.index));if(y){const w=y[0].length;k.slots.vRangeUpdated.emit([{index:_.index,length:0},"input"]),k.deleteText({index:_.index,length:w})}}function handleDeleteLine(k,_){if(_.length>0){k.slots.vRangeUpdated.emit([{index:_.index,length:0},"input"]),k.deleteText(_);return}if(_.index>0){const y=k.yText.toString(),w=_.index-Math.max(0,y.slice(0,_.index).lastIndexOf(`
`));k.slots.vRangeUpdated.emit([{index:_.index-w,length:0},"input"]),k.deleteText({index:_.index-w,length:w})}}function transformInput(k,_,y,w,$){switch(k){case"insertText":{handleInsertText(w,_,$,y);return}case"insertParagraph":{handleInsertParagraph(w,$);return}case"deleteContentBackward":case"deleteByCut":{handleDeleteBackward(w,$);return}case"deleteContentForward":{handleDeleteForward($,w);return}case"deleteWordBackward":{handleDeleteWordBackward($,w);return}case"deleteWordForward":{handleDeleteWordForward($,w);return}case"deleteHardLineBackward":case"deleteSoftLineBackward":{handleDeleteLine($,w);return}}}class VirgoAttributeService{constructor(_){this._marks=null,this._attributeRenderer=getDefaultAttributeRenderer(),this._attributeSchema=baseTextAttributes,this.setMarks=y=>{this._marks=y},this.resetMarks=()=>{this._marks=null},this.setAttributeSchema=y=>{this._attributeSchema=y},this.setAttributeRenderer=y=>{this._attributeRenderer=y},this.getFormat=(y,w=!1)=>{const B=this._editor.deltaService.getDeltasByVRange(y).filter(([H,j])=>j.index+j.length>y.index&&j.index<=y.index+y.length).map(([H])=>H.attributes);return w?B.reduce((H,j)=>({...H,...j}),{}):!B.length||B.some(H=>!H)?{}:B.reduce((H,j)=>{const q={};for(const X in H){const ee=X;H[ee]===j[ee]&&(q[ee]=H[ee])}return q})},this.normalizeAttributes=y=>{if(!y)return;const w=this._attributeSchema.safeParse(y);if(!w.success){console.error(w.error);return}return Object.fromEntries(Object.entries(w.data).filter(([$,B])=>B))},this._editor=_}get marks(){return this._marks}get attributeRenderer(){return this._attributeRenderer}}class VirgoDeltaService{constructor(_){this.mapDeltasInVRange=(y,w,$=!1)=>{const B=$?this.normalizedDeltas:this.deltas,R=[];return B.reduce((H,j,q)=>{const X=j.insert.length,ee=y.index-X,te=y.index+y.length;if(H>=ee&&(H<te||y.length===0&&H===y.index)){const oe=w(j,H,q);R.push(oe)}return H+X},0),R},this.getDeltaByRangeIndex=y=>{const w=this.deltas;let $=0;for(const B of w){if($+B.insert.length>=y)return B;$+=B.insert.length}return null},this.getDeltasByVRange=y=>this.mapDeltasInVRange(y,(w,$)=>[w,{index:$,length:w.insert.length}]),this.render=async(y=!0)=>{const w=this._editor.rootElement,$=this.normalizedDeltas,B=deltaInsertsToChunks$1($);let R=0;const H=B.map(j=>{if(j.length>0){const q=[];j.forEach(ee=>{q.push([ee,R]),R++});const X=q.map(([ee,te])=>{let ne=!1;const oe=this._editor.getVRange();return oe&&(ne=this.isNormalizedDeltaSelected(te,oe)),[renderElement(ee,this._editor.attributeService.normalizeAttributes,ne),ee]});return x$1`<v-line .elements=${X}></v-line>`}else return x$1`<v-line .elements=${[]}></v-line>`});try{D(c$1(H.map((j,q)=>({line:j,index:q})),j=>j.index,j=>j.line),w)}catch{this._editor.rerenderWholeEditor(),await this._editor.waitForUpdate()}await this._editor.waitForUpdate(),y&&this._editor.rangeService.syncVRange(),this._editor.slots.updated.emit()},this._editor=_}get deltas(){return this._editor.yText.toDelta()}get normalizedDeltas(){const _=[];for(const y of this.deltas)if(this._editor.isEmbed(y)){const w=[...y.insert].map($=>({insert:$,attributes:y.attributes}));_.push(...w)}else _.push(y);return _}isNormalizedDeltaSelected(_,y){let w=!1;return y.length>=1&&this._editor.mapDeltasInVRange(y,($,B,R)=>{R===_&&B>=y.index&&(w=!0)},!0),w}}function isMaybeVRangeEqual(k,_){return k===_||(k&&_?isVRangeEqual(k,_):!1)}function isVRangeEqual(k,_){return k.index===_.index&&k.length===_.length}function isVRangeIntersect(k,_){return k.index<=_.index+_.length&&k.index+k.length>=_.index}function intersectVRange(k,_){if(!isVRangeIntersect(k,_))return null;const y=Math.max(k.index,_.index),w=Math.min(k.index+k.length,_.index+_.length)-y;return{index:y,length:w}}class VirgoEventService{constructor(_){this.editor=_,this._isComposing=!1,this._previousAnchor=null,this._previousFocus=null,this.mount=()=>{const y=this.editor.rootElement;this.editor.disposables.addFromEvent(document,"selectionchange",this._onSelectionChange),this.editor.disposables.addFromEvent(y,"beforeinput",this._onBeforeInput),this.editor.disposables.addFromEvent(y,"compositionstart",this._onCompositionStart),this.editor.disposables.addFromEvent(y,"compositionend",this._onCompositionEnd),this.editor.disposables.addFromEvent(y,"scroll",this._onScroll),this.editor.disposables.addFromEvent(y,"keydown",this._onKeyDown),this.editor.disposables.addFromEvent(y,"click",this._onClick)},this._onSelectionChange=()=>{const y=this.editor.rootElement,w=this.editor.getVRange();if(this._isComposing)return;const B=findDocumentOrShadowRoot(this.editor).getSelection();if(!B)return;if(B.rangeCount===0){w!==null&&this.editor.slots.vRangeUpdated.emit([null,"native"]);return}const R=B.getRangeAt(0);if(R.startContainer===R.endContainer&&R.startContainer.textContent===ZERO_WIDTH_SPACE&&R.startOffset===1){R.setStart(R.startContainer,0),R.setEnd(R.endContainer,0),B.removeAllRanges(),B.addRange(R);return}if(!R.intersectsNode(y))if(R.endContainer.contains(y)&&Array.from(R.endContainer.childNodes).filter(q=>q instanceof HTMLElement).length===1&&R.startContainer.contains(y)&&Array.from(R.startContainer.childNodes).filter(q=>q instanceof HTMLElement).length===1){this.editor.focusEnd();return}else{w!==null&&this.editor.slots.vRangeUpdated.emit([null,"native"]);return}this._previousAnchor=[R.startContainer,R.startOffset],this._previousFocus=[R.endContainer,R.endOffset];const H=this.editor.toVRange(B.getRangeAt(0));isMaybeVRangeEqual(w,H)||this.editor.slots.vRangeUpdated.emit([H,"native"]),((R.startContainer.nodeType!==Node.TEXT_NODE||R.endContainer.nodeType!==Node.TEXT_NODE)&&R.startContainer!==this._previousAnchor[0]&&R.endContainer!==this._previousFocus[0]&&R.startOffset!==this._previousAnchor[1]&&R.endOffset!==this._previousFocus[1]||R.startContainer.nodeType===Node.COMMENT_NODE||R.endContainer.nodeType===Node.COMMENT_NODE)&&this.editor.syncVRange()},this._onCompositionStart=()=>{this._isComposing=!0,this.editor.rootElement.querySelectorAll('[data-virgo-embed="true"]').forEach(w=>{w.removeAttribute("contenteditable")})},this._onCompositionEnd=async y=>{if(this._isComposing=!1,this.editor.rerenderWholeEditor(),await this.editor.waitForUpdate(),this.editor.isReadonly)return;const w=this.editor.getVRange();if(!w)return;let $={vEditor:this.editor,raw:y,vRange:w,data:y.data,attributes:{}};const B=this.editor.hooks.compositionEnd;if(B&&($=B($)),!$)return;const{vRange:R,data:H}=$;if(R.index>=0){const j=window.getSelection();if(j&&j.rangeCount!==0){const X=j.getRangeAt(0).startContainer;if(X instanceof Text){if(X.parentElement?.dataset.virgoText!=="true")X.remove();else{const[te]=this.editor.getTextPoint(R.index),ne=te.parentElement?.closest("v-text");if(ne)ne.str!==te.textContent&&(te.textContent=ne.str);else{const oe=te.parentElement?.closest('[data-virgo-text="true"]');if(oe instanceof HTMLElement)if(oe.dataset.virgoTextValue)oe.dataset.virgoTextValue!==te.textContent&&(te.textContent=oe.dataset.virgoTextValue);else throw new Error("We detect a forged v-text node but it has no data-virgo-text-value attribute.")}}const ee=this.editor.toDomRange(R);ee&&(assertExists(ee),j.removeAllRanges(),j.addRange(ee))}}H&&H.length>0&&(this.editor.insertText(R,H,$.attributes),this.editor.slots.vRangeUpdated.emit([{index:R.index+H.length,length:0},"input"]))}},this._firstRecomputeInFrame=!0,this._onBeforeInput=y=>{if(y.preventDefault(),this.editor.isReadonly||this._isComposing)return;this._firstRecomputeInFrame&&(this._firstRecomputeInFrame=!1,this._onSelectionChange(),requestAnimationFrame(()=>{this._firstRecomputeInFrame=!0}));const w=this.editor.getVRange();if(!w)return;let $={vEditor:this.editor,raw:y,vRange:w,data:y.data,attributes:{}};const B=this.editor.hooks.beforeinput;if(B&&($=B($)),!$)return;const{raw:R,data:H,vRange:j}=$;transformInput(R.inputType,H,$.attributes,j,this.editor)},this._onScroll=()=>{this.editor.slots.scrollUpdated.emit(this.editor.rootElement.scrollLeft)},this._onKeyDown=y=>{if(!y.shiftKey&&(y.key==="ArrowLeft"||y.key==="ArrowRight")){const w=this.editor.getVRange();if(!w||w.length!==0)return;const $=()=>{y.preventDefault(),y.stopPropagation()},B=this.editor.getDeltasByVRange(w);if(B.length===2)y.key==="ArrowLeft"&&this.editor.isEmbed(B[0][0])?($(),this.editor.setVRange({index:w.index-1,length:1})):y.key==="ArrowRight"&&this.editor.isEmbed(B[1][0])&&($(),this.editor.setVRange({index:w.index,length:1}));else if(B.length===1){const R=B[0][0];this.editor.isEmbed(R)&&(y.key==="ArrowLeft"&&w.index-1>=0?($(),this.editor.setVRange({index:w.index-1,length:1})):y.key==="ArrowRight"&&w.index+1<=this.editor.yTextLength&&($(),this.editor.setVRange({index:w.index,length:1})))}}},this._onClick=y=>{if(y.target instanceof Node&&isInEmbedElement(y.target)){const $=findDocumentOrShadowRoot(this.editor).getSelection();if(!$)return;if(y.target instanceof HTMLElement){const B=y.target.closest("v-element");B&&$.selectAllChildren(B)}else{const B=y.target.parentElement?.closest("v-element");B&&$.selectAllChildren(B)}}}}}class VirgoHookService{constructor(_,y={}){this.editor=_,this.hooks=y}}class VirgoRangeService{constructor(_){this._prevVRange=null,this._vRange=null,this._lastScrollLeft=0,this.onVRangeUpdated=([y,w])=>{if(this._vRange=y,this._editor.mounted&&y&&!isMaybeVRangeEqual(this._prevVRange,y)&&this._editor.requestUpdate(!1),this._prevVRange=y,w!=="other")return;if(this._vRange===null){const R=findDocumentOrShadowRoot(this._editor).getSelection();R&&R.rangeCount>0&&R.getRangeAt(0).intersectsNode(this._editor.rootElement)&&R.removeAllRanges();return}requestAnimationFrame(()=>{this.syncVRange()})},this.getVRange=()=>this._vRange,this.setVRange=(y,w=!0)=>{if(y&&(y.index<0||y.index+y.length>this._editor.yText.length))throw new Error("invalid vRange");this._editor.slots.vRangeUpdated.emit([y,w?"other":"silent"])},this.syncVRange=()=>{this._vRange&&this._editor.mounted&&this._applyVRange(this._vRange)},this.toDomRange=y=>{const w=this._editor.rootElement;return virgoRangeToDomRange(w,y)},this.toVRange=y=>{const{rootElement:w,yText:$}=this._editor;return domRangeToVirgoRange(y,w,$)},this.onScrollUpdated=y=>{this._lastScrollLeft=y},this._applyVRange=y=>{const $=findDocumentOrShadowRoot(this._editor).getSelection();if(!$)return;const B=this.toDomRange(y);B&&($.removeAllRanges(),$.addRange(B),this._scrollLineIntoViewIfNeeded(B),this._scrollCursorIntoViewIfNeeded(B),this._editor.slots.rangeUpdated.emit(B))},this._scrollLineIntoViewIfNeeded=y=>{if(this._editor.shouldLineScrollIntoView){let w=y.endContainer.parentElement;for(;!(w instanceof VirgoLine);)w=w?.parentElement??null;w?.scrollIntoView({block:"nearest"})}},this._scrollCursorIntoViewIfNeeded=y=>{if(this._editor.shouldCursorScrollIntoView){const w=this._editor.rootElement,$=w.getBoundingClientRect(),B=y.getBoundingClientRect();let R=0;B.left>$.left&&(R=Math.max(this._lastScrollLeft,B.left-$.right)),w.scrollLeft=R,this._lastScrollLeft=R}},this._editor=_}}class VEditor{get disposables(){return this._disposables}get yText(){return this._yText}get yTextString(){return this.yText.toString()}get yTextLength(){return this.yText.length}get yTextDeltas(){return this.yText.toDelta()}get rootElement(){return assertExists(this._rootElement),this._rootElement}get eventService(){return this._eventService}get rangeService(){return this._rangeService}get attributeService(){return this._attributeService}get deltaService(){return this._deltaService}get mounted(){return this._mounted}get marks(){return this._attributeService.marks}get hooks(){return this._hooksService.hooks}constructor(_,y={}){if(this._disposables=new DisposableGroup,this._rootElement=null,this._isReadonly=!1,this._eventService=new VirgoEventService(this),this._rangeService=new VirgoRangeService(this),this._attributeService=new VirgoAttributeService(this),this._deltaService=new VirgoDeltaService(this),this._mounted=!1,this.shouldLineScrollIntoView=!0,this.shouldCursorScrollIntoView=!0,this.setAttributeSchema=this._attributeService.setAttributeSchema,this.setAttributeRenderer=this._attributeService.setAttributeRenderer,this.setMarks=this._attributeService.setMarks,this.resetMarks=this._attributeService.resetMarks,this.getFormat=this._attributeService.getFormat,this.toDomRange=this.rangeService.toDomRange,this.toVRange=this.rangeService.toVRange,this.getVRange=this.rangeService.getVRange,this.setVRange=this.rangeService.setVRange,this.syncVRange=this.rangeService.syncVRange,this.getDeltasByVRange=this.deltaService.getDeltasByVRange,this.getDeltaByRangeIndex=this.deltaService.getDeltaByRangeIndex,this.mapDeltasInVRange=this.deltaService.mapDeltasInVRange,this.isNormalizedDeltaSelected=this.deltaService.isNormalizedDeltaSelected,this._onYTextChange=()=>{if(this.yText.toString().includes("\r"))throw new Error("yText must not contain \r because it will break the range synchronization");Promise.resolve().then(()=>{assertExists(this._rootElement),this.deltaService.render()})},!_.doc)throw new Error("yText must be attached to a Y.Doc");if(_.toString().includes("\r"))throw new Error("yText must not contain \r because it will break the range synchronization");const{isEmbed:w=()=>!1,hooks:$={}}=y;this._yText=_,this.isEmbed=w,this._hooksService=new VirgoHookService(this,$),this.slots={mounted:new Slot,unmounted:new Slot,updated:new Slot,vRangeUpdated:new Slot,rangeUpdated:new Slot,scrollUpdated:new Slot},this.slots.vRangeUpdated.on(this.rangeService.onVRangeUpdated),this.slots.scrollUpdated.on(this.rangeService.onScrollUpdated)}mount(_){const y=_;y.virgoEditor=this,this._rootElement=y,D(A,this._rootElement),this._rootElement.contentEditable="true",this._rootElement.dataset.virgoRoot="true",this._bindYTextObserver(),this._deltaService.render(),this._eventService.mount(),this._mounted=!0,this.slots.mounted.emit()}unmount(){D(A,this.rootElement),this._rootElement=null,this._mounted=!1,this.disposables.dispose(),this.slots.unmounted.emit()}requestUpdate(_=!0){Promise.resolve().then(()=>{assertExists(this._rootElement),this._deltaService.render(_)})}async waitForUpdate(){const _=Array.from(this.rootElement.querySelectorAll("v-line"));await Promise.all(_.map(y=>y.updateComplete))}getNativeSelection(){const y=findDocumentOrShadowRoot(this).getSelection();return!y||y.rangeCount===0?null:y}getTextPoint(_){assertExists(this._rootElement);const y=Array.from(this._rootElement.querySelectorAll("v-line"));let w=0;for(const $ of y){const B=VEditor.getTextNodesFromElement($);for(const R of B){if(!R.textContent)throw new Error("text element should have textContent");if(w+R.textContent.length>=_)return[R,_-w];w+=calculateTextLength(R)}w+=1}throw new Error("failed to find leaf")}getLine(_){assertExists(this._rootElement);const y=Array.from(this._rootElement.querySelectorAll("v-line"));let w=0;for(const $ of y){if(_>=w&&_<=w+$.textLength)return[$,_-w];if(_===w+$.textLength&&_===this.yText.length)return[$,_-w];w+=$.textLength+1}throw new Error("failed to find line")}setReadonly(_){this.rootElement.contentEditable=_?"false":"true",this._isReadonly=_}get isReadonly(){return this._isReadonly}focusEnd(){this.rangeService.setVRange({index:this.yText.length,length:0})}focusByIndex(_){this.rangeService.setVRange({index:_,length:0})}deleteText(_){this._transact(()=>{this.yText.delete(_.index,_.length)})}insertText(_,y,w={}){this._attributeService.marks&&(w={...w,...this._attributeService.marks});const $=this._attributeService.normalizeAttributes(w);if(!y||!y.length)throw new Error("text must not be empty");this._transact(()=>{this.yText.delete(_.index,_.length),this.yText.insert(_.index,y,$)})}insertLineBreak(_){this._transact(()=>{this.yText.delete(_.index,_.length),this.yText.insert(_.index,`
`)})}formatText(_,y,w={}){const{match:$=()=>!0,mode:B="merge"}=w;this._deltaService.getDeltasByVRange(_).filter(([H,j])=>$(H,j)).forEach(([H,j])=>{const q=intersectVRange(_,j);q&&(B==="replace"&&this.resetText(q),this._transact(()=>{this.yText.format(q.index,q.length,y)}))})}resetText(_){const y=[];for(let $=_.index;$<=_.index+_.length;$++){const B=this.getDeltaByRangeIndex($);B&&y.push(B)}const w=Object.fromEntries(y.flatMap($=>$.attributes?Object.keys($.attributes).map(B=>[B,null]):[]));this._transact(()=>{this.yText.format(_.index,_.length,{...w})})}setText(_,y={}){this._transact(()=>{this.yText.delete(0,this.yText.length),this.yText.insert(0,_,y)})}rerenderWholeEditor(){D(A,this.rootElement),this._deltaService.render()}_transact(_){const y=this.yText.doc;if(!y)throw new Error("yText is not attached to a doc");y.transact(_,y.clientID)}_bindYTextObserver(){this.yText.observe(this._onYTextChange),this.disposables.add({dispose:()=>{this.yText.unobserve(this._onYTextChange)}})}}VEditor.nativePointToTextPoint=nativePointToTextPoint;VEditor.textPointToDomPoint=textPointToDomPoint;VEditor.getTextNodesFromElement=getTextNodesFromElement;class RangeSynchronizer{get _selectionManager(){return this.root.selectionManager}get _rangeManager(){return assertExists(this.root.rangeManager),this.root.rangeManager}get root(){return this.manager.root}constructor(_){this.manager=_,this._prevSelection=null,this._onSelectionModelChanged=y=>{const w=requestAnimationFrame(()=>{const $=y.find(R=>R.is("text"))??null;($&&this._prevSelection?$.equals(this._prevSelection):$===this._prevSelection)||(this._prevSelection=$,this._rangeManager.syncTextSelectionToRange($))});this.root.disposables.add(()=>{cancelAnimationFrame(w)})},this.root.disposables.add(this._selectionManager.slots.changed.on(this._onSelectionModelChanged)),this.root.disposables.add(this.root.uiEventDispatcher.add("selectionChange",()=>{const y=window.getSelection();if(!y){this._selectionManager.clear();return}const w=y.rangeCount>0?y.getRangeAt(0):null;this.manager.config.shouldSyncSelection(w)&&(w===null||w.intersectsNode(this.root)?this._prevSelection=this._rangeManager.syncRangeToTextSelection(w):(this._prevSelection=null,this._selectionManager.clear(["text"])))})),this.root.disposables.add(this.root.uiEventDispatcher.add("beforeInput",y=>{const w=y.get("defaultState").event;if(this.root.page.readonly)return;const $=this._selectionManager.find("text");$&&this._beforeTextInput($,w.isComposing)}))}_beforeTextInput(_,y){const{from:w,to:$}=_;if(!$||PathFinder.equals(w.path,$.path))return;const B=this._rangeManager.value;if(!B)return;const R=this._rangeManager.getSelectedBlockElementsByRange(B,{match:te=>te.model.role==="content",mode:"flat"}),H=R.at(0),j=R.at(-1);if(!H||!j)return;const q=H.model.text,X=j.model.text;if(!q||!X)return;const ee=$.length===X.length;this.root.page.transact(()=>{ee&&y&&this._shamefullyResetIMERangeBeforeInput(q,H,w),ee||(X.delete(0,$.length),q.join(X)),R.slice(1).forEach(te=>{this.root.page.deleteBlock(te.model)})})}_shamefullyResetIMERangeBeforeInput(_,y,w){_.delete(w.index,_.length-w.index);const B=getTextNodesFromElement(y).at(-1),R=document.getSelection();if(B&&R){const H=document.createRange();H.selectNode(B),H.setStart(B,B.length),H.collapse(),R.removeAllRanges(),R.addRange(H)}}}class RangeManager{constructor(_){this.root=_,this.config={shouldSyncSelection:()=>!0},this.setConfig=y=>{this.config={...this.config,...y}},this._range=null,new RangeSynchronizer(this)}get value(){return this._range}clearRange(_=!0){this._range=null,window.getSelection()?.removeAllRanges(),_&&this.root.selectionManager.clear(["text"])}renderRange(_,y){const w=[_];y&&w.push(y),this._range=this._mergeRanges(w),this._renderRange()}syncTextSelectionToRange(_){if(!_){this.clearRange(!1);return}const{from:y,to:w}=_;if(!this.root.viewStore.viewFromPath("block",y.path)){this.clearRange();return}const B=this.pointToRange(y);this._setUpRangePoint(y);const R=w?this.pointToRange(w):null;if(w&&this._setUpRangePoint(w),!B){this.clearRange(!1);return}this.renderRange(B,R)}syncRangeToTextSelection(_){if(!_)return this.clearRange(),null;const y=this.root.selectionManager;this._range=_;const{startContainer:w,endContainer:$}=_,B=this._nodeToPoint(w),R=_.collapsed?null:this._nodeToPoint($);if(!B)return y.find("text")&&y.clear(["text"]),null;const H=y.getInstance("text",{from:B,to:R});return y.setGroup("note",[H]),H}getSelectedBlockElementsByRange(_,y={}){const{mode:w="all",match:$=()=>!0}=y;let B=Array.from(this.root.querySelectorAll(`[${this.root.blockIdAttr}]`)).filter(H=>_.intersectsNode(H)&&$(H));if(B.length===0)return[];const R=_.startContainer.parentElement?.closest(`[${this.root.blockIdAttr}]`);if(assertExists(R),w==="flat")B=B.filter(H=>R.compareDocumentPosition(H)&Node.DOCUMENT_POSITION_FOLLOWING||H===R);else if(w==="highest"){let H=B[0];B=B.filter((j,q)=>q===0?!0:H.compareDocumentPosition(j)&Node.DOCUMENT_POSITION_CONTAINED_BY?!1:(H=j,!0))}return B}textSelectionToRange(_){const{from:y,to:w}=_;if(!this.root.viewStore.viewFromPath("block",y.path))return null;const B=this.pointToRange(y),R=w?this.pointToRange(w):null;if(!B)return null;const H=[B];return R&&H.push(R),this._mergeRanges(H)}pointToRange(_){const y=this._calculateVirgo(_);if(!y)return null;const[w,$]=y;return w.toDomRange($)}_calculateVirgo(_){const y=this.root.viewStore.viewFromPath("block",_.path);if(!y)return null;const w=y.querySelector("[data-virgo-root]");assertExists(w,`Cannot find virgo element in block ${_.path.join(" > ")}}`);const $=w.virgoEditor.yText.length,B=_.index>=$?$:_.index,R=B+_.length>=$?$-B:_.length;return[w.virgoEditor,{index:B,length:R}]}_setUpRangePoint(_){const y=this._calculateVirgo(_);if(!y)return;const[w,$]=y;w.setVRange($,!1)}_nodeToPoint(_){const y=this._getNearestVirgo(_);if(!y)return null;const w=this._getBlock(y);if(!w)return null;const $=this._range?y.virgoEditor.toVRange(this._range):null;return $?{blockId:w.model.id,path:w.path,index:$.index,length:$.length}:null}_snapshotToRange(_){const y=document.createRange();return y.setStart(_.startContainer,_.startOffset),y.setEnd(_.endContainer,_.endOffset),y}_mergeRanges(_){if(_.length===0)return null;if(_.length===1){const[q]=_,X=document.createRange();return X.setStart(q.startContainer,q.startOffset),X.setEnd(q.endContainer,q.endOffset),X}const[y,w]=_;let $=this._snapshotToRange(y),B=this._snapshotToRange(w);const R=_.slice(2);for($.compareBoundaryPoints(Range.END_TO_START,B)>0&&([$,B]=[B,$]);R.length>0;){const q=R.pop();if(!q)break;const X=this._snapshotToRange(q),ee=X.compareBoundaryPoints(Range.START_TO_END,$),te=X.compareBoundaryPoints(Range.END_TO_START,B);ee<0&&($=X),te>0&&(B=X)}const j=document.createRange();return j.setStart($.startContainer,$.startOffset),j.setEnd(B.endContainer,B.endOffset),$.detach(),B.detach(),j}_renderRange(){const _=document.getSelection();if(!_||!this._range){this.clearRange();return}_.removeAllRanges(),_.addRange(this._range)}_getNearestVirgo(_){let y;if(_ instanceof Element?y=_:y=_.parentElement,!!y)return y.closest("[data-virgo-root]")}_getBlock(_){return _.closest(`[${this.root.blockIdAttr}]`)}}var __decorate$2y=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let BlockSuiteRoot=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.blockIdAttr="data-block-id",this.widgetIdAttr="data-widget-id",this.modelSubscribed=new Set,this.rangeManager=null,this.renderModel=_=>{const{flavour:y,children:w}=_;if(!this.page.schema.flavourSchemaMap.get(y))return console.warn(`Cannot find schema for ${y}.`),n$5`${A}`;const B=this.blockStore.specStore.getView(y);if(!B)return console.warn(`Cannot find view for ${y}.`),n$5`${A}`;const R=B.component,H=B.widgets?Object.entries(B.widgets).reduce((q,[X,ee])=>{const te=n$5`<${ee} ${o$5(this.widgetIdAttr)}=${X} .root=${this} .page=${this.page}></${ee}>`;return{...q,[X]:te}},{}):{},j=w.length?n$5`${c$1(w,q=>q.id,q=>this.renderModel(q))}`:null;return this._onLoadModel(_),n$5`<${R}
      ${o$5(this.blockIdAttr)}=${_.id}
      .root=${this}
      .page=${this.page}
      .model=${_}
      .widgets=${H}
      .content=${j}
    ></${R}>`},this._onLoadModel=_=>{const{id:y}=_;this.modelSubscribed.has(y)||(this._disposables.add(_.propsUpdated.on(()=>{this.requestUpdate()})),this._disposables.add(_.childrenUpdated.on(()=>{this.requestUpdate()})),this.modelSubscribed.add(y))},this._registerView=()=>{const _=`[${this.blockIdAttr}]`,y=`[${this.widgetIdAttr}]`,w=($,B,R)=>{const H=`[${B}]`,j=`[${R}]`,q=$&&$ instanceof HTMLElement?$:$.parentElement;if(!q)return null;const X=q.closest(H);if(!X)return null;const ee=q.closest(j);if(X.contains(ee))return null;const te=X.getAttribute(B);return assertExists(te),{id:te,path:X.path,view:X}};this.blockStore.viewStore.register("block",{fromDOM:$=>w($,this.blockIdAttr,this.widgetIdAttr),toDOM:({view:$})=>$,getChildren:$=>Array.from($.querySelectorAll(`${_},${y}`)).filter(B=>B.parentElement?.closest(_)===$)}),this.blockStore.viewStore.register("widget",{fromDOM:$=>w($,this.widgetIdAttr,this.blockIdAttr),toDOM:({view:$})=>$,getChildren:()=>[]})}}get uiEventDispatcher(){return this.blockStore.uiEventDispatcher}get selectionManager(){return this.blockStore.selectionManager}get viewStore(){return this.blockStore.viewStore}willUpdate(_){_.has("blocks")&&this.blockStore.specStore.applySpecs(this.blocks),_.has("page")&&(this.blockStore.page=this.page),super.willUpdate(_)}connectedCallback(){super.connectedCallback(),this.blockStore=new BlockStore({root:this,workspace:this.page.workspace,page:this.page}),this._registerView(),this.blockStore.mount(),this.blockStore.specStore.applySpecs(this.blocks),this.rangeManager=new RangeManager(this)}disconnectedCallback(){super.disconnectedCallback(),this.blockStore.unmount(),this.modelSubscribed.clear(),this.rangeManager=null}render(){const{root:_}=this.page;return _?this.renderModel(_):null}};__decorate$2y([n$a({attribute:!1})],BlockSuiteRoot.prototype,"blocks",void 0);__decorate$2y([n$a({attribute:!1})],BlockSuiteRoot.prototype,"page",void 0);__decorate$2y([n$a({attribute:!1})],BlockSuiteRoot.prototype,"blockIdAttr",void 0);__decorate$2y([n$a({attribute:!1})],BlockSuiteRoot.prototype,"widgetIdAttr",void 0);BlockSuiteRoot=__decorate$2y([e$7("block-suite-root")],BlockSuiteRoot);var __decorate$2x=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class WidgetElement extends WithDisposable(s$2){constructor(){super(...arguments),this.handleEvent=(_,y,w)=>{this._disposables.add(this.root.uiEventDispatcher.add(_,y,{flavour:w?.global?void 0:this.flavour}))}}get widgetName(){return this.path[this.path.length-1]}get hostPath(){return this.path.slice(0,-1)}get pageElement(){const _=this.parentElement;assertExists(_);const y=this.root.viewStore.getNodeView(_);return assertExists(y),y.view}get flavour(){return assertExists(this.pageElement),this.pageElement.model.flavour}bindHotKey(_,y){this._disposables.add(this.root.uiEventDispatcher.bindHotkey(_,{flavour:y?.global?void 0:this.flavour}))}connectedCallback(){super.connectedCallback(),this.path=this.root.viewStore.calculatePath(this)}render(){return null}}__decorate$2x([n$a({attribute:!1})],WidgetElement.prototype,"root",void 0);__decorate$2x([n$a({attribute:!1})],WidgetElement.prototype,"page",void 0);function assertFlavours(k,_){if(!_.includes(k.flavour))throw new Error(`model flavour ${k.flavour} is not allowed`)}function matchFlavours(k,_){return _.includes(k.flavour)}function supportsChildren(k){return!(matchFlavours(k,["affine:image","affine:divider","affine:code"])||matchFlavours(k,["affine:paragraph"])&&["h1","h2","h3","h4","h5","h6","quote"].includes(k.type??""))}function isEmpty(k){return k.flavour==="affine:database"?k.children.length===0:k.children.length!==0?!k.children.find(y=>!isEmpty(y)):!k.text?.length&&!k.sourceId&&k.flavour!=="affine:code"&&k.flavour!=="affine:bookmark"}function createEvent(k,_){return new CustomEvent(k,{detail:_})}function isControlledKeyboardEvent(k){return k.ctrlKey||k.metaKey||k.altKey}function on$1(k,_,y,w){const $=()=>{k.removeEventListener(_,y,w)};return k.addEventListener(_,y,w),$}function once(k,_,y,w){const $=R=>{B(),y(R)},B=()=>{k.removeEventListener(_,$,w)};return k.addEventListener(_,$,w),B}const ZOOM_MAX=6,ZOOM_MIN=.1,ZOOM_STEP=.25,GRID_SIZE=3e3,GRID_GAP_MIN=10,GRID_GAP_MAX=50,DEFAULT_ROUGHNESS=1.4;var ShapeStyle;(function(k){k.General="General",k.Scribbled="Scribbled"})(ShapeStyle||(ShapeStyle={}));var StrokeStyle;(function(k){k.Solid="solid",k.Dashed="dash",k.None="none"})(StrokeStyle||(StrokeStyle={}));var ConnectorMode;(function(k){k[k.Straight=0]="Straight",k[k.Orthogonal=1]="Orthogonal"})(ConnectorMode||(ConnectorMode={}));function getArrowPoints([k,_],[y,w],$=10){const B=y-k,R=w-_,H=Math.atan2(R,B),j=[y-$*Math.cos(H-Math.PI/10),w-$*Math.sin(H-Math.PI/10)],q=[y-$*Math.cos(H+Math.PI/10),w-$*Math.sin(H+Math.PI/10)];return{sides:[j,q],start:[k,_],end:[y,w]}}function getStrokeRadius(k,_,y,w=$=>$){return k*w(.5-_*(.5-y))}function neg(k){return[-k[0],-k[1]]}function add(k,_){return[k[0]+_[0],k[1]+_[1]]}function sub(k,_){return[k[0]-_[0],k[1]-_[1]]}function mul(k,_){return[k[0]*_,k[1]*_]}function div(k,_){return[k[0]/_,k[1]/_]}function per(k){return[k[1],-k[0]]}function dpr(k,_){return k[0]*_[0]+k[1]*_[1]}function isEqual(k,_){return k[0]===_[0]&&k[1]===_[1]}function len(k){return Math.hypot(k[0],k[1])}function len2(k){return k[0]*k[0]+k[1]*k[1]}function dist2(k,_){return len2(sub(k,_))}function uni(k){return div(k,len(k))}function dist(k,_){return Math.hypot(k[1]-_[1],k[0]-_[0])}function rotAround(k,_,y){const w=Math.sin(y),$=Math.cos(y),B=k[0]-_[0],R=k[1]-_[1],H=B*$-R*w,j=B*w+R*$;return[H+_[0],j+_[1]]}function lrp(k,_,y){return add(k,mul(sub(_,k),y))}function prj(k,_,y){return add(k,mul(_,y))}const{min:min$1,PI}=Math,RATE_OF_PRESSURE_CHANGE=.275,FIXED_PI=PI+1e-4;function getStrokeOutlinePoints(k,_={}){const{size:y=16,smoothing:w=.5,thinning:$=.5,simulatePressure:B=!0,easing:R=Be=>Be,start:H={},end:j={},last:q=!1}=_,{cap:X=!0,easing:ee=Be=>Be*(2-Be)}=H,{cap:te=!0,easing:ne=Be=>--Be*Be*Be+1}=j;if(k.length===0||y<=0)return[];const oe=k[k.length-1].runningLength,ie=H.taper===!1?0:H.taper===!0?Math.max(y,oe):H.taper,ae=j.taper===!1?0:j.taper===!0?Math.max(y,oe):j.taper,re=Math.pow(y*w,2),se=[],le=[];let ue=k.slice(0,10).reduce((Be,Ze)=>{let Re=Ze.pressure;if(B){const qe=min$1(1,Ze.distance/y),Me=min$1(1,1-qe);Re=min$1(1,Be+(Me-Be)*(qe*RATE_OF_PRESSURE_CHANGE))}return(Be+Re)/2},k[0].pressure),he=getStrokeRadius(y,$,k[k.length-1].pressure,R),ce,ge=k[0].vector,be=k[0].point,fe=be,we=be,Ce=fe,ve=!1;for(let Be=0;Be<k.length;Be++){let{pressure:Ze}=k[Be];const{point:Re,vector:qe,distance:Me,runningLength:Pe}=k[Be];if(Be<k.length-1&&oe-Pe<3)continue;if($){if(B){const at=min$1(1,Me/y),ct=min$1(1,1-at);Ze=min$1(1,ue+(ct-ue)*(at*RATE_OF_PRESSURE_CHANGE))}he=getStrokeRadius(y,$,Ze,R)}else he=y/2;ce===void 0&&(ce=he);const Qe=Pe<ie?ee(Pe/ie):1,je=oe-Pe<ae?ne((oe-Pe)/ae):1;he=Math.max(.01,he*Math.min(Qe,je));const Ue=(Be<k.length-1?k[Be+1]:k[Be]).vector,tt=Be<k.length-1?dpr(qe,Ue):1,nt=dpr(qe,ge)<0&&!ve,et=tt!==null&&tt<0;if(nt||et){const at=mul(per(ge),he);for(let ct=1/13,lt=0;lt<=1;lt+=ct)we=rotAround(sub(Re,at),Re,FIXED_PI*lt),se.push(we),Ce=rotAround(add(Re,at),Re,FIXED_PI*-lt),le.push(Ce);be=we,fe=Ce,et&&(ve=!0);continue}if(ve=!1,Be===k.length-1){const at=mul(per(qe),he);se.push(sub(Re,at)),le.push(add(Re,at));continue}const st=mul(per(lrp(Ue,qe,tt)),he);we=sub(Re,st),(Be<=1||dist2(be,we)>re)&&(se.push(we),be=we),Ce=add(Re,st),(Be<=1||dist2(fe,Ce)>re)&&(le.push(Ce),fe=Ce),ue=Ze,ge=qe}const ke=k[0].point.slice(0,2),me=k.length>1?k[k.length-1].point.slice(0,2):add(k[0].point,[1,1]),Ie=[],Fe=[];if(k.length===1){if(!(ie||ae)||q){const Be=prj(ke,uni(per(sub(ke,me))),-(ce||he)),Ze=[];for(let Re=1/13,qe=Re;qe<=1;qe+=Re)Ze.push(rotAround(Be,ke,FIXED_PI*2*qe));return Ze}}else{if(!(ie||ae&&k.length===1))if(X)for(let Ze=1/13,Re=Ze;Re<=1;Re+=Ze){const qe=rotAround(le[0],ke,FIXED_PI*Re);Ie.push(qe)}else{const Ze=sub(se[0],le[0]),Re=mul(Ze,.5),qe=mul(Ze,.51);Ie.push(sub(ke,Re),sub(ke,qe),add(ke,qe),add(ke,Re))}const Be=per(neg(k[k.length-1].vector));if(ae||ie&&k.length===1)Fe.push(me);else if(te){const Ze=prj(me,Be,he);for(let Re=1/29,qe=Re;qe<1;qe+=Re)Fe.push(rotAround(Ze,me,FIXED_PI*3*qe))}else Fe.push(add(me,mul(Be,he)),add(me,mul(Be,he*.99)),sub(me,mul(Be,he*.99)),sub(me,mul(Be,he)))}return se.concat(Fe,le.reverse(),Ie)}function getStrokePoints(k,_={}){const{streamline:y=.5,size:w=16,last:$=!1}=_;if(k.length===0)return[];const B=.15+(1-y)*.85;let R=Array.isArray(k[0])?k:k.map(({x:te,y:ne,pressure:oe=.5})=>[te,ne,oe]);if(R.length===2){const te=R[1];R=R.slice(0,-1);for(let ne=1;ne<5;ne++)R.push(lrp(R[0],te,ne/4))}R.length===1&&(R=[...R,[...add(R[0],[1,1]),...R[0].slice(2)]]);const H=[{point:[R[0][0],R[0][1]],pressure:R[0][2]>=0?R[0][2]:.25,vector:[1,1],distance:0,runningLength:0}];let j=!1,q=0,X=H[0];const ee=R.length-1;for(let te=1;te<R.length;te++){const ne=$&&te===ee?R[te].slice(0,2):lrp(X.point,R[te],B);if(isEqual(X.point,ne))continue;const oe=dist(ne,X.point);if(q+=oe,te<ee&&!j){if(q<w)continue;j=!0}X={point:ne,pressure:R[te][2]>=0?R[te][2]:.5,vector:uni(sub(X.point,ne)),distance:oe,runningLength:q},H.push(X)}return H[0].vector=H[1]?.vector||[0,0],H}function getStroke(k,_={}){return getStrokeOutlinePoints(getStrokePoints(k,_),_)}class Vec{static clamp(_,y,w){return Math.max(y,typeof w<"u"?Math.min(_,w):_)}static clampV(_,y,w){return _.map($=>w?Vec.clamp($,y,w):Vec.clamp($,y))}static cross(_,y,w){return(y[0]-_[0])*(w[1]-_[1])-(w[0]-_[0])*(y[1]-_[1])}static snap(_,y=1){return[Math.round(_[0]/y)*y,Math.round(_[1]/y)*y]}}Vec.neg=k=>[-k[0],-k[1]];Vec.add=(k,_)=>[k[0]+_[0],k[1]+_[1]];Vec.addScalar=(k,_)=>[k[0]+_,k[1]+_];Vec.sub=(k,_)=>[k[0]-_[0],k[1]-_[1]];Vec.subScalar=(k,_)=>[k[0]-_,k[1]-_];Vec.vec=(k,_)=>[_[0]-k[0],_[1]-k[1]];Vec.mul=(k,_)=>[k[0]*_,k[1]*_];Vec.mulV=(k,_)=>[k[0]*_[0],k[1]*_[1]];Vec.div=(k,_)=>[k[0]/_,k[1]/_];Vec.divV=(k,_)=>[k[0]/_[0],k[1]/_[1]];Vec.per=k=>[k[1],-k[0]];Vec.dpr=(k,_)=>k[0]*_[0]+k[1]*_[1];Vec.cpr=(k,_)=>k[0]*_[1]-_[0]*k[1];Vec.len2=k=>k[0]*k[0]+k[1]*k[1];Vec.len=k=>Math.hypot(k[0],k[1]);Vec.pry=(k,_)=>Vec.dpr(k,_)/Vec.len(_);Vec.uni=k=>Vec.div(k,Vec.len(k));Vec.normalize=k=>Vec.uni(k);Vec.tangent=(k,_)=>Vec.uni(Vec.sub(k,_));Vec.dist2=(k,_)=>Vec.len2(Vec.sub(k,_));Vec.dist=(k,_)=>Math.hypot(k[1]-_[1],k[0]-_[0]);Vec.fastDist=(k,_)=>{const y=[_[0]-k[0],_[1]-k[1]],w=[Math.abs(y[0]),Math.abs(y[1])];let $=1/Math.max(w[0],w[1]);return $=$*(1.29289-(w[0]+w[1])*$*.29289),[y[0]*$,y[1]*$]};Vec.ang=(k,_)=>Math.atan2(Vec.cpr(k,_),Vec.dpr(k,_));Vec.angle=(k,_)=>Math.atan2(_[1]-k[1],_[0]-k[0]);Vec.med=(k,_)=>Vec.mul(Vec.add(k,_),.5);Vec.rot=(k,_=0)=>[k[0]*Math.cos(_)-k[1]*Math.sin(_),k[0]*Math.sin(_)+k[1]*Math.cos(_)];Vec.rotWith=(k,_,y=0)=>{if(y===0)return k;const w=Math.sin(y),$=Math.cos(y),B=k[0]-_[0],R=k[1]-_[1],H=B*$-R*w,j=B*w+R*$;return[H+_[0],j+_[1]]};Vec.isEqual=(k,_)=>k[0]===_[0]&&k[1]===_[1];Vec.lrp=(k,_,y)=>Vec.add(k,Vec.mul(Vec.sub(_,k),y));Vec.int=(k,_,y,w,$=1)=>{const B=(Vec.clamp(y,w)-y)/(w-y);return Vec.add(Vec.mul(k,1-B),Vec.mul(_,$))};Vec.ang3=(k,_,y)=>{const w=Vec.vec(_,k),$=Vec.vec(_,y);return Vec.ang(w,$)};Vec.abs=k=>[Math.abs(k[0]),Math.abs(k[1])];Vec.rescale=(k,_)=>{const y=Vec.len(k);return[_*k[0]/y,_*k[1]/y]};Vec.isLeft=(k,_,y)=>(_[0]-k[0])*(y[1]-k[1])-(y[0]-k[0])*(_[1]-k[1]);Vec.clockwise=(k,_,y)=>Vec.isLeft(k,_,y)>0;Vec.toFixed=k=>k.map(_=>Math.round(_*100)/100);Vec.nearestPointOnLineThroughPoint=(k,_,y)=>Vec.add(k,Vec.mul(_,Vec.pry(Vec.sub(y,k),_)));Vec.distanceToLineThroughPoint=(k,_,y)=>Vec.dist(y,Vec.nearestPointOnLineThroughPoint(k,_,y));Vec.nearestPointOnLineSegment=(k,_,y,w=!0)=>{const $=Vec.uni(Vec.sub(_,k)),B=Vec.add(k,Vec.mul($,Vec.pry(Vec.sub(y,k),$)));if(w){if(B[0]<Math.min(k[0],_[0]))return k[0]<_[0]?k:_;if(B[0]>Math.max(k[0],_[0]))return k[0]>_[0]?k:_;if(B[1]<Math.min(k[1],_[1]))return k[1]<_[1]?k:_;if(B[1]>Math.max(k[1],_[1]))return k[1]>_[1]?k:_}return B};Vec.distanceToLineSegment=(k,_,y,w=!0)=>Vec.dist(y,Vec.nearestPointOnLineSegment(k,_,y,w));Vec.nearestPointOnBounds=(k,_)=>[Vec.clamp(_[0],k.minX,k.maxX),Vec.clamp(_[1],k.minY,k.maxY)];Vec.distanceToBounds=(k,_)=>Vec.dist(_,Vec.nearestPointOnBounds(k,_));Vec.nudge=(k,_,y)=>Vec.isEqual(k,_)?k:Vec.add(k,Vec.mul(Vec.uni(Vec.sub(_,k)),y));Vec.nudgeAtAngle=(k,_,y)=>[Math.cos(_)*y+k[0],Math.sin(_)*y+k[1]];Vec.toPrecision=(k,_=4)=>[+k[0].toPrecision(_),+k[1].toPrecision(_)];Vec.pointsBetween=(k,_,y=6)=>Array.from(Array(y)).map((w,$)=>{const B=$/(y-1),R=Math.min(1,.5+Math.abs(.5-B));return[...Vec.lrp(k,_,B),R]});Vec.slope=(k,_)=>k[0]===_[0]?NaN:(k[1]-_[1])/(k[0]-_[0]);Vec.max=(...k)=>[Math.max(...k.map(_=>_[0])),Math.max(...k.map(_=>_[1]))];Vec.min=(...k)=>[Math.min(...k.map(_=>_[0])),Math.min(...k.map(_=>_[1]))];Vec.toVec=k=>[k.x,k.y];Vec.toPoint=k=>({x:k[0],y:k[1]});class PointLocation extends Array{constructor(_=[0,0],y=[0,0]){super(2),this._tangent=[0,0],this[0]=_[0],this[1]=_[1],this._tangent=y}static fromVec(_){const y=new PointLocation;return y[0]=_[0],y[1]=_[1],y}get tangent(){return this._tangent}set tangent(_){this._tangent=_}}const EPSILON=1e-12,MACHINE_EPSILON=112e-18;function square(k){return k*k}function sumSqr(k,_){return square(k[0]-_[0])+square(k[1]-_[1])}function distToSegmentSquared(k,_,y){const w=sumSqr(_,y);if(w==0)return sumSqr(k,_);let $=((k[0]-_[0])*(y[0]-_[0])+(k[1]-_[1])*(y[1]-_[1]))/w;return $=Math.max(0,Math.min(1,$)),sumSqr(k,[_[0]+$*(y[0]-_[0]),_[1]+$*(y[1]-_[1])])}function distToSegment(k,_,y){return Math.sqrt(distToSegmentSquared(k,_,y))}function isPointIn$1(k,_,y){return k.x<=_&&_<=k.x+k.w&&k.y<=y&&y<=k.y+k.h}function intersects(k,_){return k.x<_.x+_.w&&k.x+k.w>_.x&&k.y<_.y+_.h&&k.y+k.h>_.y}function almostEqual(k,_,y=1e-4){return Math.abs(k-_)<y}function clamp$1(k,_,y){return Math.max(_,typeof y<"u"?Math.min(k,y):k)}function pointInEllipse(k,_,y,w,$=0){const B=Math.cos($),R=Math.sin($),H=Vec.sub(k,_),j=B*H[0]+R*H[1],q=R*H[0]-B*H[1];return j*j/(y*y)+q*q/(w*w)<=1}function pointInPolygon(k,_){let y=0;return _.forEach((w,$)=>{const B=_[($+1)%_.length];w[1]<=k[1]?B[1]>k[1]&&Vec.cross(w,B,k)>0&&(y+=1):B[1]<=k[1]&&Vec.cross(w,B,k)<0&&(y-=1)}),y!==0}function pointOnPolygonStoke(k,_,y){for(let w=0;w<_.length;++w){const $=w+1===_.length?0:w+1;if(distToSegment(k,_[w],_[$])<=y)return!0}return!1}function getBoundsFromPoints(k,_=0){let y=1/0,w=1/0,$=-1/0,B=-1/0;if(k.length<2)y=0,w=0,$=1,B=1;else for(const[R,H]of k)y=Math.min(R,y),w=Math.min(H,w),$=Math.max(R,$),B=Math.max(H,B);return _!==0?getBoundsFromPoints(k.map(R=>Vec.rotWith(R,[(y+$)/2,(w+B)/2],_))):{minX:y,minY:w,maxX:$,maxY:B,width:Math.max(1,$-y),height:Math.max(1,B-w)}}function getSvgPathFromStroke(k,_=!0){const y=k.length;if(y<4)return"";let w=k[0],$=k[1];const B=k[2];let R=`M${w[0].toFixed(2)},${w[1].toFixed(2)} Q${$[0].toFixed(2)},${$[1].toFixed(2)} ${average($[0],B[0]).toFixed(2)},${average($[1],B[1]).toFixed(2)} T`;for(let H=2,j=y-1;H<j;H++)w=k[H],$=k[H+1],R+=`${average(w[0],$[0]).toFixed(2)},${average(w[1],$[1]).toFixed(2)} `;return _&&(R+="Z"),R}function average(k,_){return(k+_)/2}function lineIntersects(k,_,y,w,$=!1){const B=Vec.sub(_,k),R=Vec.sub(w,y),H=Vec.cpr(B,R);if(almostEqual(H,0,MACHINE_EPSILON))return null;const j=Vec.sub(k,y);let q=Vec.cpr(R,j)/H;const X=Vec.cpr(B,j)/H,ee=EPSILON,te=-ee,ne=1+ee;return $||te<q&&q<ne&&te<X&&X<ne?($||(q=clamp$1(q,0,1)),Vec.lrp(k,_,q)):null}function lineEllipseIntersects(k,_,y,w,$,B=0){k=Vec.rot(Vec.sub(k,y),-B),_=Vec.rot(Vec.sub(_,y),-B),w*=w,$*=$;const R=[],H=Vec.sub(_,k),j=w*H[1]*H[1]+$*H[0]*H[0],q=2*(w*k[1]*H[1]+$*k[0]*H[0]),X=w*k[1]*k[1]+$*k[0]*k[0]-w*$,ee=q*q-4*j*X;if(ee>=0){const te=Math.sqrt(ee),ne=(-q+te)/(2*j),oe=(-q-te)/(2*j);0<=ne&&ne<=1&&R.push(Vec.add(Vec.rot(Vec.add(Vec.mul(H,ne),k),B),y)),0<=oe&&oe<=1&&Math.abs(ne-oe)>1e-16&&R.push(Vec.add(Vec.rot(Vec.add(Vec.mul(H,oe),k),B),y))}return R.length===0?null:R.map(te=>new PointLocation(te))}function linePolygonIntersects(k,_,y){const w=[],$=y.length;for(let B=0;B<$;B++){const R=y[B],H=y[(B+1)%$],j=lineIntersects(k,_,R,H);if(j){const q=new PointLocation(j);q.tangent=Vec.normalize(Vec.sub(H,R)),w.push(q)}}return w.length?w:null}function polygonNearestPoint(k,_){const y=k.length;let w=[],$=1/0;for(let B=0;B<y;B++){const R=k[B],H=k[(B+1)%y],j=Vec.nearestPointOnLineSegment(R,H,_,!0),q=Vec.dist(j,_);q<$&&($=q,w=j)}return w}function polygonGetPointTangent(k,_){const y=k.length;for(let w=0;w<y;w++){const $=k[w],B=k[(w+1)%y];if(isPointOnLineSegment(_,[$,B]))return Vec.normalize(Vec.sub(B,$))}return[0,0]}function isPointOnLineSegment(k,_){const[y,w]=_,$=Vec.sub(k,y),B=Vec.sub(k,w);return almostEqual(Vec.cpr($,B),0)&&Vec.dpr($,B)<=0}function linePolylineIntersects(k,_,y){const w=[],$=y.length;for(let B=0;B<$-1;B++){const R=y[B],H=y[B+1],j=lineIntersects(k,_,R,H);j&&w.push(new PointLocation(j,Vec.normalize(Vec.sub(H,R))))}return w.length?w:null}function polyLineNearestPoint(k,_){const y=k.length;let w=[],$=1/0;for(let B=0;B<y-1;B++){const R=k[B],H=k[B+1],j=Vec.nearestPointOnLineSegment(R,H,_,!0),q=Vec.dist(j,_);q<$&&($=q,w=j)}return w}function sign(k){return k>0?1:-1}function getPointFromBoundsWithRotation(k,_){const{x:y,y:w,w:$,h:B,rotate:R}=k;if(!R)return _;const H=y+$/2,j=w+B/2,q=new DOMMatrix().translateSelf(H,j).rotateSelf(R).translateSelf(-H,-j),X=new DOMPoint(..._).matrixTransform(q);return[X.x,X.y]}function rotatePoints$1(k,_,y){const w=toRadian(y);return k.map($=>Vec.add(_,Vec.rot(Vec.sub($,_),w)))}function getPointsFromBoundsWithRotation(k,_=({x:y,y:w,w:$,h:B})=>[[y,w],[y+$,w],[y+$,w+B],[y,w+B]]){const{rotate:y}=k;let w=_(k);if(y){const{x:$,y:B,w:R,h:H}=k,j=$+R/2,q=B+H/2,X=new DOMMatrix().translateSelf(j,q).rotateSelf(y).translateSelf(-j,-q);w=w.map(ee=>{const{x:te,y:ne}=new DOMPoint(...ee).matrixTransform(X);return[te,ne]})}return w}function getQuadBoundsWithRotation(k){const{x:_,y,w,h:$,rotate:B}=k,R=new DOMRect(_,y,w,$);return B?new DOMQuad(...getPointsFromBoundsWithRotation(k).map(H=>new DOMPoint(...H))).getBounds():R}function getBoundsWithRotation(k){const{x:_,y,width:w,height:$}=getQuadBoundsWithRotation(k);return{x:_,y,w,h:$}}function normalizeDegAngle(k){return k<0&&(k+=360),k%=360,k}function toRadian(k){return k*Math.PI/180}function toDegree(k){return k*180/Math.PI}function isOverlap$1(k,_,y,w=!0){const $=w?(B,R)=>B<R:(B,R)=>B<=R;return!($(Math.max(k[0][y],k[1][y]),Math.min(_[0][y],_[1][y]))||$(Math.max(_[0][y],_[1][y]),Math.min(k[0][y],k[1][y])))}function serializeXYWH(k,_,y,w){return`[${k},${_},${y},${w}]`}function deserializeXYWH(k){return JSON.parse(k)}class Bound{constructor(_=0,y=0,w=0,$=0){this.x=_,this.y=y,this.w=w,this.h=$}static from(_){return new Bound(_.x,_.y,_.w,_.h)}static fromDOMRect({left:_,top:y,width:w,height:$}){return new Bound(_,y,w,$)}static fromPoints(_){const{minX:y,minY:w,maxX:$,maxY:B}=getBoundsFromPoints(_);return new Bound(y,w,$-y,B-w)}get points(){return[[this.x,this.y],[this.x+this.w,this.y],[this.x+this.w,this.y+this.h],[this.x,this.y+this.h]]}get midPoints(){return[[this.x+this.w/2,this.y],[this.x+this.w,this.y+this.h/2],[this.x+this.w/2,this.y+this.h],[this.x,this.y+this.h/2]]}get center(){return[this.x+this.w/2,this.y+this.h/2]}get minX(){return this.x}get minY(){return this.y}get maxX(){return this.x+this.w}get maxY(){return this.y+this.h}get tl(){return[this.x,this.y]}get tr(){return[this.x+this.w,this.y]}get bl(){return[this.x,this.y+this.h]}get br(){return[this.x+this.w,this.y+this.h]}get verticalLine(){return[[this.x+this.w/2,this.y],[this.x+this.w/2,this.y+this.h]]}get horizontalLine(){return[[this.x,this.y+this.h/2],[this.x+this.w,this.y+this.h/2]]}get upperLine(){return[[this.x,this.y],[this.x+this.w,this.y]]}get lowerLine(){return[[this.x,this.y+this.h],[this.x+this.w,this.y+this.h]]}get leftLine(){return[[this.x,this.y],[this.x,this.y+this.h]]}get rightLine(){return[[this.x+this.w,this.y],[this.x+this.w,this.y+this.h]]}containsPoint([_,y]){const{minX:w,minY:$,maxX:B,maxY:R}=this;return w<=_&&_<=B&&$<=y&&y<=R}intersectLine(_,y,w=!1){const $=[];return[[this.tl,this.tr],[this.tl,this.bl],[this.tr,this.br],[this.bl,this.br]].forEach(([B,R])=>{const H=lineIntersects(_,y,B,R,w);H&&$.push(H)}),$.length===0?null:$}isIntersectWithBound(_,y=EPSILON){return _.maxX>this.minX-y&&_.maxY>this.minY-y&&_.minX<this.maxX+y&&_.minY<this.maxY+y}unite(_){const y=Math.min(this.x,_.x),w=Math.min(this.y,_.y),$=Math.max(this.maxX,_.maxX),B=Math.max(this.maxY,_.maxY);return new Bound(y,w,$-y,B-w)}include(_){const y=Math.min(this.x,_[0]),w=Math.min(this.y,_[1]),$=Math.max(this.maxX,_[0]),B=Math.max(this.maxY,_[1]);return new Bound(y,w,$-y,B-w)}getRelativePoint([_,y]){return[this.x+_*this.w,this.y+y*this.h]}toRelative([_,y]){return[(_-this.x)/this.w,(y-this.y)/this.h]}serialize(){return serializeXYWH(this.x,this.y,this.w,this.h)}clone(){return new Bound(this.x,this.y,this.w,this.h)}isHorizontalCross(_){return!(this.maxY<_.minY||this.minY>_.maxY)}isVerticalCross(_){return!(this.maxX<_.minX||this.minX>_.maxX)}horizontalDistance(_){return Math.min(Math.abs(this.minX-_.maxX),Math.abs(this.maxX-_.minX))}verticalDistance(_){return Math.min(Math.abs(this.minY-_.maxY),Math.abs(this.maxY-_.minY))}expand(_,y=_,w=_,$=y){return new Bound(this.x-_,this.y-y,this.w+_+w,this.h+y+$)}isPointInBound([_,y],w=.01){return _>this.minX+w&&_<this.maxX-w&&y>this.minY+w&&y<this.maxY-w}contains(_){return _.x>=this.x&&_.y>=this.y&&_.maxX<=this.maxX&&_.maxY<=this.maxY}getVerticesAndMidpoints(){return[...this.points,...this.midPoints]}static deserialize(_){const[y,w,$,B]=deserializeXYWH(_);return new Bound(y,w,$,B)}}function getExpandedBound(k,_){const y=Math.min(k.x,_.x),w=Math.min(k.y,_.y),$=Math.max(k.x+k.w,_.x+_.w),B=Math.max(k.y+k.h,_.y+_.h),R=Math.abs($-y),H=Math.abs(B-w);return{x:y,y:w,w:R,h:H}}function getCommonBound(k){if(!k.length)return null;if(k.length===1){const{x:y,y:w,w:$,h:B}=k[0];return new Bound(y,w,$,B)}let _=k[0];for(let y=1;y<k.length;y++)_=getExpandedBound(_,k[y]);return new Bound(_.x,_.y,_.w,_.h)}function contains$1(k,_){return k.x<=_.x&&k.x+k.w>=_.x+_.w&&k.y<=_.y&&k.y+k.h>=_.y+_.h}function getBoundFromPoints(k){const{minX:_,minY:y,width:w,height:$}=getBoundsFromPoints(k);return new Bound(_,y,w,$)}function inflateBound(k,_){const y=_/2,w=new Bound(k.x-y,k.y-y,k.w+_,k.h+_);if(w.w<=0||w.h<=0)throw new Error("Invalid delta range or bound size.");return w}function transformPointsToNewBound(k,_,y,w,$){const B=y*2,R=$*2,H=Math.max(_.w-B,1),j=Math.max(_.h-B,1),q=Math.max(w.w-R,1),X=Math.max(w.h-R,1);return{points:k.map(te=>({...te,x:q*((te.x-y)/H)+$,y:X*((te.y-y)/j)+$})),bound:new Bound(w.x,w.y,q+R,X+R)}}class SurfaceElement{constructor(_,y,w={}){if(this.renderer=null,this._connectable=!0,this.computedValue=$=>$,this._onMap=$=>{this.renderer?.removeElement(this),this.renderer?.addElement(this);const B=$[0],R={};B.changes.keys.forEach((H,j)=>{R[j]={old:H.oldValue,new:this.yMap.get(j)}}),this.surface.slots.elementUpdated.emit({id:this.id,props:R})},!_.doc)throw new Error("yMap must be bound to a Y.Doc");this.yMap=_;for(const $ in w)this.yMap.set($,w[$]);this.surface=y}get id(){return this.yMap.get("id")}get index(){return this.yMap.get("index")}get type(){return this.yMap.get("type")}get xywh(){return this.yMap.get("xywh")}get seed(){return this.yMap.get("seed")}get rotate(){return this.yMap.get("rotate")??0}get batch(){return this.yMap.get("batch")??null}get gridBound(){return this.rotate?Bound.from(getBoundsWithRotation(this)):Bound.deserialize(this.xywh)}get x(){const[_]=this.deserializeXYWH();return _}get y(){const[,_]=this.deserializeXYWH();return _}get w(){const[,,_]=this.deserializeXYWH();return _}get h(){const[,,,_]=this.deserializeXYWH();return _}get localRecord(){return this.surface.getElementLocalRecord(this.id)}get connectable(){return this._connectable}getLocalRecord(){return this.surface.getElementLocalRecord(this.id)}applyUpdate(_){for(const y in _)this.yMap.set(y,_[y])}deserializeXYWH(){return deserializeXYWH(this.xywh)}serialize(){return this.yMap.toJSON()}hitTest(_,y,w){return isPointIn$1(this,_,y)}mount(_){this.renderer=_,this.renderer.addElement(this),this.yMap.observeDeep(this._onMap)}unmount(){this.yMap.unobserveDeep(this._onMap),this.renderer?.removeElement(this),this.renderer=null}render(_,y,w){}}function getSolidStrokePoints(k,_){return getStroke(k,{size:_,thinning:.6,streamline:.5,smoothing:.5,easing:y=>Math.sin(y*Math.PI/2),simulatePressure:!0})}class BrushElement extends SurfaceElement{constructor(){super(...arguments),this._testCanvas=document.createElement("canvas"),this._testCtx=this._testCanvas.getContext("2d"),this._connectable=!1}get points(){return this.yMap.get("points")}get color(){return this.yMap.get("color")}get lineWidth(){return this.yMap.get("lineWidth")}hitTest(_,y,w){const{rotate:$,points:B,_testCtx:R,renderer:H}=this,[j,q,X,ee]=this.deserializeXYWH(),te=getSvgPathFromStroke(getSolidStrokePoints(B,3)),ne=new Path2D(te);R.lineWidth!==(w?.expand??1)&&(R.lineWidth=(w?.expand??1)/(H?.zoom??1));const oe=X/2,ie=ee/2;return R.setTransform(new DOMMatrix().translateSelf(oe,ie).rotateSelf($).translateSelf(-oe,-ie)),R.isPointInStroke(ne,_-j,y-q)}render(_,y){const{points:w,lineWidth:$,color:B,rotate:R}=this,[,,H,j]=this.deserializeXYWH(),q=H/2,X=j/2;_.setTransform(y.translateSelf(q,X).rotateSelf(R).translateSelf(-q,-X));const ee=getSolidStrokePoints(w,$),te=getSvgPathFromStroke(ee),ne=new Path2D(te);_.fillStyle=this.computedValue(B),_.fill(ne)}applyUpdate(_){const y={..._},{points:w,xywh:$}=_;if(w?.length){const B=this.lineWidth,R=getBoundFromPoints(w),H=inflateBound(R,B),j=w.map(([q,X])=>[q-H.x,X-H.y]);y.points=j,y.xywh=H.serialize()}if($){const B=Bound.deserialize($),{lineWidth:R}=this,H=transformPointsToNewBound(this.points.map(([j,q])=>({x:j,y:q})),this,R/2,B,R/2);y.points=H.points.map(j=>[j.x,j.y]),y.xywh=H.bound.serialize()}if(_.lineWidth&&_.lineWidth!==this.lineWidth){const B=y.xywh?Bound.deserialize(y.xywh):this,R=y.points??this.points,H=transformPointsToNewBound(R.map(([j,q])=>({x:j,y:q})),B,this.lineWidth/2,inflateBound(B,_.lineWidth-this.lineWidth),_.lineWidth/2);y.points=H.points.map(j=>[j.x,j.y]),y.xywh=H.bound.serialize()}for(const B in y)this.yMap.set(B,y[B])}containedByBounds(_){return getPointsFromBoundsWithRotation(this).some(w=>_.containsPoint(w))}getNearestPoint(_){const{x:y,y:w}=this;return polyLineNearestPoint(this.points.map($=>Vec.add($,[y,w])),_)}intersectWithLine(_,y){const w=[this.x,this.y],$=getPointsFromBoundsWithRotation(this,R=>this.points.map(H=>Vec.add(H,w))),B=Bound.fromDOMRect(getQuadBoundsWithRotation(this));if(B.w<8&&B.h<8)return Vec.distanceToLineSegment(_,y,B.center)<5?[]:null;if(B.intersectLine(_,y,!0)){const R=$.length;for(let H=1;H<R;H++){const j=lineIntersects(_,y,$[H-1],$[H]);if(j)return[new PointLocation(j,Vec.normalize(Vec.sub($[H],$[H-1])))]}}return null}getRelativePointLocation(_){const y=Bound.deserialize(this.xywh).getRelativePoint(_);return new PointLocation(y)}}const BrushElementDefaultProps={type:"brush",xywh:"[0,0,0,0]",rotate:0,points:[],color:"#000000",lineWidth:4};class ConnectorElement extends SurfaceElement{constructor(){super(...arguments),this._path=[],this._xywh="[0, 0, 0, 0]",this._connectable=!1}get path(){return this._path}set path(_){this._path=_}get xywh(){return this._xywh}set xywh(_){this._xywh=_,this.renderer?.removeElement(this),this.renderer?.addElement(this)}get mode(){return this.yMap.get("mode")}get strokeWidth(){return this.yMap.get("strokeWidth")}get stroke(){return this.yMap.get("stroke")}get strokeStyle(){return this.yMap.get("strokeStyle")}get roughness(){return this.yMap.get("roughness")??DEFAULT_ROUGHNESS}get rough(){return this.yMap.get("rough")??!1}get target(){return this.yMap.get("target")}get source(){return this.yMap.get("source")}get controllers(){return this.yMap.get("controllers")}get absolutePath(){const{x:_,y}=this;return this.path.map(w=>[w[0]+_,w[1]+y])}hitTest(_,y,w){const $=polyLineNearestPoint(this.absolutePath,[_,y]);return Vec.dist($,[_,y])<(w?.expand?this.strokeWidth/2:0)+8}containedByBounds(_){return this.absolutePath.some(y=>_.containsPoint(y))}getNearestPoint(_){return polyLineNearestPoint(this.absolutePath,_)}intersectWithLine(_,y){return linePolylineIntersects(_,y,this.absolutePath)}render(_,y,w){const{absolutePath:$}=this,[B,R]=this.deserializeXYWH();if(_.setTransform(y.translateSelf(-B,-R)),this._renderPoints(_,w,$,this.strokeStyle===StrokeStyle.Dashed),!$.length||$.length<2){console.warn("connector points not ready yet, there is something wrong.");return}const H=$[$.length-1],j=$[$.length-2],{sides:q,end:X}=getArrowPoints(j,H,15);this._renderPoints(_,w,[q[0],X,q[1]],!1)}_renderPoints(_,y,w,$){const{seed:B,stroke:R,strokeWidth:H,roughness:j,rough:q}=this,X=this.computedValue(R);if(q){const ee={seed:B,roughness:j,strokeLineDash:$?[12,12]:void 0,stroke:X,strokeWidth:H};y.linearPath(w,ee)}else _.save(),_.strokeStyle=X,_.lineWidth=this.strokeWidth,$&&_.setLineDash([12,12]),_.beginPath(),w.forEach((ee,te)=>{te===0?_.moveTo(ee[0],ee[1]):_.lineTo(ee[0],ee[1])}),_.stroke(),_.closePath(),_.restore()}getRelativePointLocation(_){return new PointLocation(Bound.deserialize(this.xywh).getRelativePoint(_))}}const ConnectorElementDefaultProps={type:"connector",mode:ConnectorMode.Orthogonal,strokeWidth:4,stroke:"#000000",strokeStyle:StrokeStyle.Solid,roughness:DEFAULT_ROUGHNESS,source:{},target:{}},DebugElementDefaultProps={type:"debug",xywh:"[0,0,0,0]",rotate:0,color:"#000000"};class DebugElement extends SurfaceElement{get color(){return this.yMap.get("color")}containedByBounds(_){throw new Error("Method not implemented.")}getNearestPoint(_){throw new Error("Method not implemented.")}intersectWithLine(_,y){throw new Error("Method not implemented.")}getRelativePointLocation(_){throw new Error("Method not implemented.")}render(_,y){const{color:w,rotate:$}=this,[,,B,R]=this.deserializeXYWH(),H=B/2,j=R/2;_.setTransform(y.translateSelf(H,j).rotateSelf($).translateSelf(-H,-j)),_.fillStyle=w,_.fillRect(0,0,B,R)}}const FrameElementDefaultProps={type:"frame",xywh:"[0,0,0,0]",title:new YText("frame")},RS_LTR_CHARS="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",RS_RTL_CHARS="֑-߿יִ-﷽ﹰ-ﻼ",RE_RTL_CHECK=new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`),isRTL$1=k=>RE_RTL_CHECK.test(k),isChrome=globalThis.navigator?.userAgent.indexOf("Chrome")!==-1;!isChrome&&globalThis.navigator?.userAgent.indexOf("Safari");function getLineHeight(k,_){const y=document.createElement("span");y.style.fontFamily=k,y.style.fontSize=_+"px",y.style.lineHeight="initial",y.textContent="M",document.body.appendChild(y);const{height:w}=y.getBoundingClientRect();return y.remove(),w}function getFontString({fontSize:k,fontFamily:_,lineHeight:y,bold:w=!1,italic:$=!1}){return`${$?"italic":""} ${w?"bold":""} ${k}px/${y} ${_}`.trim()}function normalizeText(k){return k.replace(/\t/g,"        ").replace(/\r?\n|\r/g,`
`)}function splitIntoLines(k){return normalizeText(k).split(`
`)}function getLineWidth(k,_){const w=document.createElement("canvas").getContext("2d");return w.font=_,w.measureText(k).width}function getTextWidth(k,_){const y=splitIntoLines(k);let w=0;return y.forEach($=>{w=Math.max(w,getLineWidth($,_))}),w}function parseTokens(k){const _=k.split("-");return _.length>1&&_.forEach((y,w)=>{w!==_.length-1&&(_[w]=y+="-")}),_.join(" ").split(" ")}const charWidth=(()=>{const k={};return{calculate:(w,$)=>{const B=w.charCodeAt(0);if(k[$]||(k[$]=[]),!k[$][B]){const R=getLineWidth(w,$);k[$][B]=R}return k[$][B]},getCache:w=>k[w]}})(),truncateTextByWidth=(k,_,y)=>{let w=0,$=0;for(;$<k.length;$++){const B=k[$];if(w+=charWidth.calculate(B,_),w>y)break}return k.slice(0,$)};function wrapText(k,_,y){if(!Number.isFinite(y)||y<0)return k;const w=[],$=k.split(`
`),B=getLineWidth(" ",_);let R="",H=0;const j=X=>{X.trim()&&w.push(X)},q=()=>{R="",H=0};return $.forEach(X=>{if(getTextWidth(X,_)<=y){w.push(X);return}const te=parseTokens(X);q();let ne=0;for(;ne<te.length;){const oe=getLineWidth(te[ne],_);if(oe===y)j(te[ne]),ne++;else if(oe>y){for(j(R),q();te[ne].length>0;){const ie=String.fromCodePoint(te[ne].codePointAt(0)),ae=charWidth.calculate(ie,_);H+=ae,te[ne]=te[ne].slice(ie.length),H>=y?(j(R),R=ie,H=ae):R+=ie}H+B>=y?(j(R),q()):R.endsWith("-")||(R+=" ",H+=B),ne++}else for(;H<y&&ne<te.length;){const ie=te[ne];if(H=getLineWidth(R+ie,_),H>y){j(R),q();break}ne++;const ae=!ie.endsWith("-");if(R+=ie,ae&&(R+=" "),H+B>=y){ae?w.push(R.slice(0,-1)):w.push(R),q();break}}}R.slice(-1)===" "&&(R=R.slice(0,-1),j(R))}),w.join(`
`)}function transformDelta(k){const _=[];let y=k.insert;for(;y.length>0;){const w=y.indexOf(`
`);if(w===-1){_.push({insert:y,attributes:k.attributes});break}y.slice(0,w).length>0&&_.push({insert:y.slice(0,w),attributes:k.attributes}),_.push(`
`),y=y.slice(w+1)}return _}function deltaInsertsToChunks(k){if(k.length===0)return[[]];const _=k.flatMap(transformDelta);function*y(w){let $=0;for(let B=0;B<w.length;B++)if(w[B]===`
`){const R=w.slice($,B);$=B+1,yield R}else B===w.length-1&&(yield w.slice($));w.at(-1)===`
`&&(yield[])}return Array.from(y(_))}function normalizeTextBound(k,_){if(!k.text)return _;const y=k.text,{fontFamily:w,fontSize:$}=k,B=getLineHeight(w,$),R=getFontString({fontSize:$,lineHeight:`${B}px`,fontFamily:w,bold:k.bold,italic:k.italic}),H=y.toDelta(),j=deltaInsertsToChunks(H),q=Math.max(...y.toString().split(`
`).map(X=>getTextWidth(X,R)));return _.w=q,_.h=B*j.length,_}class FrameElement extends SurfaceElement{constructor(){super(...arguments),this._titleHeight=getLineHeight("'Kalam', cursive",16),this._titleWidth=0,this._padding=[0,0],this._radius=0,this._color="",this._connectable=!1}containedByBounds(_){return _.contains(Bound.deserialize(this.xywh))}intersectWithLine(_,y){return linePolygonIntersects(_,y,Bound.deserialize(this.xywh).points)}getRelativePointLocation(_){throw new Error("Method not implemented.")}getNearestPoint(_){throw new Error("Method not implemented.")}get color(){return this._color}set color(_){this._color=_}get titleHeight(){return this._titleHeight}get titleWidth(){return this._titleWidth}get padding(){return this._padding}get radius(){return this._radius}get title(){return this.yMap.get("title")}get gridBound(){const _=Bound.deserialize(this.xywh);return _.y-=this._titleHeight,_.h+=this._titleHeight,_}hitTest(_,y,w){return new Bound(this.x,this.y-this.titleHeight,this.titleWidth,this.titleHeight).isPointInBound([_,y],0)}render(_,y,w){const[,,$,B]=this.deserializeXYWH();_.setTransform(y),_.strokeStyle=this.color,_.lineWidth=2,_.beginPath(),_.roundRect(0,0,$,B,8),_.stroke(),this._renderTitle(_)}_renderTitle(_){let y=this.title.toJSON();const w=this.surface.viewport.zoom,$=16/w,B="sans-serif",R=Math.max(4/w,2);_.translate(0,-R);const H=getLineHeight(B,$),j=getFontString({fontSize:$,fontFamily:B,lineHeight:`${H}px`}),q=getLineWidth(y,j),X=[10/w,4/w],ee=4/w;this._titleHeight=H+X[1]*2+R,this._titleWidth=q+X[0]*2,this._titleWidth>this.w&&(y=truncateTextByWidth(y,j,this.w),y=y.slice(0,y.length-1)+"...",this._titleWidth=this.w),this._padding=X,this._radius=ee,!this.getLocalRecord()?.titleHide&&(_.beginPath(),_.roundRect(0,-H-X[1]*2,this._titleWidth,H+X[1]*2,ee),_.fillStyle=this.color,_.fill(),_.font=j,_.fillStyle="white",_.textAlign="left",_.textBaseline="middle",_.fillText(y,X[0],-H/2-X[1]))}}const ShapeElementDefaultProps={type:"shape",xywh:"[0,0,0,0]",rotate:0,shapeType:"rect",shapeStyle:ShapeStyle.Scribbled,radius:0,filled:!1,fillColor:"#ffffff",strokeWidth:4,strokeColor:"#000000",strokeStyle:StrokeStyle.Solid,roughness:DEFAULT_ROUGHNESS};var SHAPE_TEXT_FONT_SIZE;(function(k){k[k.SMALL=12]="SMALL",k[k.MEDIUM=20]="MEDIUM",k[k.LARGE=28]="LARGE",k[k.XLARGE=36]="XLARGE"})(SHAPE_TEXT_FONT_SIZE||(SHAPE_TEXT_FONT_SIZE={}));const SHAPE_TEXT_PADDING=20;function normalizeShapeBound(k,_){if(!k.text)return _;const y=k.text,{fontFamily:w,fontSize:$}=k,B=getLineHeight(w,$),R=getFontString({fontSize:$,lineHeight:`${B}px`,fontFamily:w}),H=[...y.toString()].map(X=>getTextWidth(X,R)).sort((X,ee)=>X-ee).pop()??getTextWidth("W",R);_.w<H+SHAPE_TEXT_PADDING*2&&(_.w=H+SHAPE_TEXT_PADDING*2);const j=y.toDelta().flatMap(X=>({insert:wrapText(X.insert,R,_.w-SHAPE_TEXT_PADDING*2),attributes:X.attributes})),q=deltaInsertsToChunks(j);return _.h<B*q.length+SHAPE_TEXT_PADDING*2&&(_.h=B*q.length+SHAPE_TEXT_PADDING*2),_}function drawRect(k,_,y,w,$,B){const R=Math.max(Math.min(w*B,$*B),0);k.beginPath(),k.moveTo(_+R,y),k.lineTo(_+w-R,y),k.arcTo(_+w,y,_+w,y+R,R),k.lineTo(_+w,y+$-R),k.arcTo(_+w,y+$,_+w-R,y+$,R),k.lineTo(_+R,y+$),k.arcTo(_,y+$,_,y+$-R,R),k.lineTo(_,y+R),k.arcTo(_,y,_+R,y,R),k.closePath()}function drawDiamond$1(k,_,y,w,$){k.beginPath(),k.moveTo(w/2,y),k.lineTo(w,$/2),k.lineTo(w/2,$),k.lineTo(_,$/2),k.closePath()}function drawEllipse$1(k,_,y,w,$){const B=w/2,R=$/2;k.beginPath(),k.ellipse(B,R,w/2,$/2,0,0,2*Math.PI),k.closePath()}function drawTriangle$1(k,_,y,w,$){k.beginPath(),k.moveTo(w/2,y),k.lineTo(w,$),k.lineTo(_,$),k.closePath()}function drawGeneralShape$1(k,_,y){switch(_){case"rect":drawRect(k,y.x,y.y,y.width,y.height,y.radius??0);break;case"diamond":drawDiamond$1(k,y.x,y.y,y.width,y.height);break;case"ellipse":drawEllipse$1(k,y.x,y.y,y.width,y.height);break;case"triangle":drawTriangle$1(k,y.x,y.y,y.width,y.height)}switch(k.lineWidth=y.strokeWidth,k.strokeStyle=y.strokeColor,k.fillStyle=y.fillColor,y.strokeStyle){case StrokeStyle.None:k.strokeStyle="transparent";break;case StrokeStyle.Dashed:k.setLineDash([12,12]),k.strokeStyle=y.strokeStyle;break;default:k.strokeStyle=y.strokeStyle}k.fill(),k.stroke()}const DiamondMethods={points({x:k,y:_,w:y,h:w}){return[[k,_+w/2],[k+y/2,_],[k+y,_+w/2],[k+y/2,_+w]]},render(k,_,y,w){const{seed:$,strokeWidth:B,filled:R,realFillColor:H,realStrokeColor:j,strokeStyle:q,roughness:X,rotate:ee,shapeStyle:te}=w,[,,ne,oe]=w.deserializeXYWH(),ie=Math.max(B,0)/2,ae=ne-ie*2,re=oe-ie*2,se=ae/2,le=re/2;k.setTransform(_.translateSelf(ie,ie).translateSelf(se,le).rotateSelf(ee).translateSelf(-se,-le)),te===ShapeStyle.General?drawGeneralShape$1(k,"diamond",{x:0,y:0,width:ae,height:re,strokeWidth:B,strokeColor:j,strokeStyle:q,fillColor:H}):y.polygon([[ae/2,0],[ae,re/2],[ae/2,re],[0,re/2]],{seed:$,roughness:te===ShapeStyle.Scribbled?X:0,strokeLineDash:q===StrokeStyle.Dashed?[12,12]:void 0,stroke:q===StrokeStyle.None?"none":j,strokeWidth:B,fill:R?H:void 0})},hitTest(k,_,y){const w=getPointsFromBoundsWithRotation(this,DiamondMethods.points);let $=pointOnPolygonStoke([k,_],w,(y?.expand??1)/(this.renderer?.zoom??1));return(!y.ignoreTransparent||this.filled)&&!$&&($=pointInPolygon([k,_],w)),$},containedByBounds(k,_){return getPointsFromBoundsWithRotation(_,DiamondMethods.points).some(w=>k.containsPoint(w))},getNearestPoint(k,_){const y=getPointsFromBoundsWithRotation(_,DiamondMethods.points);return polygonNearestPoint(y,k)},intersectWithLine(k,_,y){const w=getPointsFromBoundsWithRotation(y,DiamondMethods.points);return linePolygonIntersects(k,_,w)},getRelativePointLocation(k,_){const y=Bound.deserialize(_.xywh),w=y.getRelativePoint(k);let $=DiamondMethods.points(y);$.push(w),$=rotatePoints$1($,y.center,_.rotate);const B=$.pop(),R=polygonGetPointTangent($,B);return new PointLocation(B,R)}},EllipseMethods={points({x:k,y:_,w:y,h:w}){return[[k,_+w/2],[k+y/2,_],[k+y,_+w/2],[k+y/2,_+w]]},render(k,_,y,w){const{seed:$,strokeWidth:B,filled:R,realFillColor:H,realStrokeColor:j,strokeStyle:q,roughness:X,rotate:ee,shapeStyle:te}=w,[,,ne,oe]=w.deserializeXYWH(),ie=Math.max(B,0)/2,ae=Math.max(1,ne-ie*2),re=Math.max(1,oe-ie*2),se=ae/2,le=re/2;k.setTransform(_.translateSelf(ie,ie).translateSelf(se,le).rotateSelf(ee).translateSelf(-se,-le)),te===ShapeStyle.General?drawGeneralShape$1(k,"ellipse",{x:0,y:0,width:ae,height:re,strokeWidth:B,strokeColor:j,strokeStyle:q,fillColor:H}):y.ellipse(se,le,ae,re,{seed:$,roughness:te===ShapeStyle.Scribbled?X:0,strokeLineDash:q===StrokeStyle.Dashed?[12,12]:void 0,stroke:q===StrokeStyle.None?"none":j,strokeWidth:B,fill:R?H:void 0,curveFitting:1})},hitTest(k,_,y){const w=[k,_],$=(y?.expand??1)/(this.renderer?.zoom??1),B=this.w/2,R=this.h/2,H=[this.x+B,this.y+R],j=this.rotate*Math.PI/180;let q=pointInEllipse(w,H,B+$,R+$,j)&&!pointInEllipse(w,H,B-$,R-$,j);return(!y.ignoreTransparent||this.filled)&&!q&&(q=pointInEllipse(w,H,B,R,j)),q},containedByBounds(k,_){return getPointsFromBoundsWithRotation(_,EllipseMethods.points).some(w=>k.containsPoint(w))},getNearestPoint(k,_){return k},intersectWithLine(k,_,y){const w=y.rotate*Math.PI/180,$=Bound.deserialize(y.xywh);return lineEllipseIntersects(k,_,$.center,$.w/2,$.h/2,w)},getRelativePointLocation(k,_){const w=Bound.deserialize(_.xywh).getRelativePoint(k);return new PointLocation(w)}},kRect=1-.5522847498,RectMethods={points({x:k,y:_,w:y,h:w}){return[[k,_],[k+y,_],[k+y,_+w],[k,_+w]]},render(k,_,y,w){const{seed:$,strokeWidth:B,filled:R,realFillColor:H,realStrokeColor:j,radius:q,strokeStyle:X,roughness:ee,rotate:te,shapeStyle:ne}=w,[,,oe,ie]=w.deserializeXYWH(),ae=Math.max(B,0)/2,re=oe-ae*2,se=ie-ae*2,le=Math.min(re*q,se*q),ue=re/2,he=se/2;k.setTransform(_.translateSelf(ae,ae).translateSelf(ue,he).rotateSelf(te).translateSelf(-ue,-he)),ne===ShapeStyle.General?drawGeneralShape$1(k,"rect",{x:0,y:0,width:re,height:se,strokeWidth:B,strokeColor:j,strokeStyle:X,fillColor:H,radius:q}):y.path(`
        M ${le} 0
        L ${re-le} 0
        C ${re-kRect*le} 0 ${re} ${kRect*le} ${re} ${le}
        L ${re} ${se-le}
        C ${re} ${se-kRect*le} ${re-kRect*le} ${se} ${re-le} ${se}
        L ${le} ${se}
        C ${kRect*le} ${se} 0 ${se-kRect*le} 0 ${se-le}
        L 0 ${le}
        C 0 ${kRect*le} ${kRect*le} 0 ${le} 0
        Z
        `,{seed:$,roughness:ne===ShapeStyle.Scribbled?ee:0,strokeLineDash:X===StrokeStyle.Dashed?[12,12]:void 0,stroke:X===StrokeStyle.None?"none":j,strokeWidth:B,fill:R?H:void 0})},hitTest(k,_,y){const w=getPointsFromBoundsWithRotation(this);let $=pointOnPolygonStoke([k,_],w,(y?.expand??1)/(this.renderer?.zoom??1));return(!y.ignoreTransparent||this.filled)&&!$&&($=pointInPolygon([k,_],w)),$},containedByBounds(k,_){return getPointsFromBoundsWithRotation(_).some(w=>k.containsPoint(w))},getNearestPoint(k,_){const y=getPointsFromBoundsWithRotation(_);return polygonNearestPoint(y,k)},intersectWithLine(k,_,y){const w=getPointsFromBoundsWithRotation(y);return linePolygonIntersects(k,_,w)},getRelativePointLocation(k,_){const y=Bound.deserialize(_.xywh),w={...y,rotate:_.rotate},$=getPointFromBoundsWithRotation(w,y.getRelativePoint(k)),B=getPointsFromBoundsWithRotation(w),R=polygonGetPointTangent(B,$);return new PointLocation($,R)}},TriangleMethods={points({x:k,y:_,w:y,h:w}){return[[k,_+w],[k+y/2,_],[k+y,_+w]]},render(k,_,y,w){const{seed:$,strokeWidth:B,filled:R,realFillColor:H,realStrokeColor:j,strokeStyle:q,roughness:X,rotate:ee,shapeStyle:te}=w,[,,ne,oe]=w.deserializeXYWH(),ie=Math.max(B,0)/2,ae=ne-ie*2,re=oe-ie*2,se=ae/2,le=re/2;k.setTransform(_.translateSelf(ie,ie).translateSelf(se,le).rotateSelf(ee).translateSelf(-se,-le)),te===ShapeStyle.General?drawGeneralShape$1(k,"triangle",{x:0,y:0,width:ae,height:re,strokeWidth:B,strokeColor:j,strokeStyle:q,fillColor:H}):y.polygon([[ae/2,0],[ae,re],[0,re]],{seed:$,roughness:te===ShapeStyle.Scribbled?X:0,strokeLineDash:q===StrokeStyle.Dashed?[12,12]:void 0,stroke:q===StrokeStyle.None?"none":j,strokeWidth:B,fill:R?H:void 0})},hitTest(k,_,y){const w=getPointsFromBoundsWithRotation(this,TriangleMethods.points);let $=pointOnPolygonStoke([k,_],w,(y?.expand??1)/(this.renderer?.zoom??1));return(!y.ignoreTransparent||this.filled)&&!$&&($=pointInPolygon([k,_],w)),$},containedByBounds(k,_){return getPointsFromBoundsWithRotation(_,TriangleMethods.points).some(w=>k.containsPoint(w))},getNearestPoint(k,_){const y=getPointsFromBoundsWithRotation(_,TriangleMethods.points);return polygonNearestPoint(y,k)},intersectWithLine(k,_,y){const w=getPointsFromBoundsWithRotation(y,TriangleMethods.points);return linePolygonIntersects(k,_,w)},getRelativePointLocation(k,_){const y=Bound.deserialize(_.xywh),w=y.getRelativePoint(k);let $=TriangleMethods.points(y);$.push(w),$=rotatePoints$1($,y.center,_.rotate);const B=$.pop(),R=polygonGetPointTangent($,B);return new PointLocation(B,R)}},ShapeMethodsMap={rect:RectMethods,triangle:TriangleMethods,ellipse:EllipseMethods,diamond:DiamondMethods};class ShapeElement extends SurfaceElement{get shapeType(){return this.yMap.get("shapeType")}get radius(){return this.yMap.get("radius")}get filled(){return this.yMap.get("filled")}get fillColor(){return this.yMap.get("fillColor")}get strokeWidth(){return this.yMap.get("strokeWidth")}get strokeColor(){return this.yMap.get("strokeColor")}get strokeStyle(){return this.yMap.get("strokeStyle")}get roughness(){return this.yMap.get("roughness")??DEFAULT_ROUGHNESS}get realStrokeColor(){return this.computedValue(this.strokeColor)}get realFillColor(){return this.computedValue(this.fillColor)}get shapeStyle(){return this.yMap.get("shapeStyle")}get text(){return this.yMap.get("text")}get color(){return this.yMap.get("color")??"#000000"}get fontSize(){return this.yMap.get("fontSize")??SHAPE_TEXT_FONT_SIZE.MEDIUM}get fontFamily(){return this.yMap.get("fontFamily")??"'Kalam', cursive"}get textAlign(){return this.yMap.get("textAlign")??"center"}get textHorizontalAlign(){return this.yMap.get("textHorizontalAlign")??"center"}get textVerticalAlign(){return this.yMap.get("textVerticalAlign")??"center"}get bold(){return this.yMap.get("bold")??!1}get italic(){return this.yMap.get("italic")??!1}hitTest(_,y,w){if(!(w.pierce??!0))return isPointIn$1(this,_,y);const{hitTest:B}=ShapeMethodsMap[this.shapeType];return w.ignoreTransparent=w.ignoreTransparent??!0,B.apply(this,[_,y,w])}containedByBounds(_){return ShapeMethodsMap[this.shapeType].containedByBounds(_,this)}intersectWithLine(_,y){return ShapeMethodsMap[this.shapeType].intersectWithLine(_,y,this)}getNearestPoint(_){return ShapeMethodsMap[this.shapeType].getNearestPoint(_,this)}getRelativePointLocation(_){return ShapeMethodsMap[this.shapeType].getRelativePointLocation(_,this)}render(_,y,w){const{render:$}=ShapeMethodsMap[this.shapeType];$(_,y,w,this),(this.getLocalRecord()?.textDisplay??!0)&&this._renderText(_)}_renderText(_){const{w:y,text:w,color:$,fontSize:B,fontFamily:R,textVerticalAlign:H,textAlign:j,bold:q,italic:X}=this;if(!w)return;const ee=getLineHeight(R,B),te=getFontString({fontSize:B,lineHeight:`${ee}px`,fontFamily:R,bold:q,italic:X}),oe=w.toDelta().flatMap(se=>({insert:wrapText(se.insert,te,y-SHAPE_TEXT_PADDING*2),attributes:se.attributes})),ie=deltaInsertsToChunks(oe),ae=j==="center"?y/2:j==="right"?y-SHAPE_TEXT_PADDING:SHAPE_TEXT_PADDING,re=H==="center"?(this.h-ee*ie.length)/2:H==="top"?SHAPE_TEXT_PADDING:this.h-ee*ie.length-SHAPE_TEXT_PADDING;for(const[se,le]of ie.entries())for(const ue of le){_.save();const he=ue.insert,ce=isRTL$1(he),ge=ce&&!_.canvas.isConnected;ge&&document.body.appendChild(_.canvas),_.canvas.setAttribute("dir",ce?"rtl":"ltr"),_.font=te,_.fillStyle=this.computedValue($),_.textAlign=j,_.textBaseline="ideographic",_.fillText(he,ae-2,(se+1)*ee+re-1.5),ge&&_.canvas.remove(),_.restore()}}}const TextElementDefaultProps={type:"text",xywh:"[0,0,0,0]",rotate:0,text:new YText,color:"#000000",fontSize:16,fontFamily:"'Kalam', cursive",textAlign:"center",bold:!1,italic:!1};class TextElement extends SurfaceElement{get text(){return this.yMap.get("text")}get color(){return this.yMap.get("color")}get fontSize(){return this.yMap.get("fontSize")}get fontFamily(){return this.yMap.get("fontFamily")}get textAlign(){return this.yMap.get("textAlign")}get bold(){return this.yMap.get("bold")}get italic(){return this.yMap.get("italic")}get font(){const{bold:_,italic:y,fontSize:w,fontFamily:$}=this,B=getLineHeight($,w);return getFontString({bold:_,italic:y,fontSize:w,lineHeight:`${B}px`,fontFamily:$})}getNearestPoint(_){return polygonNearestPoint(Bound.deserialize(this.xywh).points,_)}getCursorByCoord(_){const{x:y,y:w,fontSize:$,fontFamily:B,text:R}=this,H=getLineHeight(B,$),j=Math.floor((_.y-w)/H),q=splitIntoLines(R.toString()),X=q[j],ee=_.x-y;let te=q.slice(0,j).join("").length+j-1,ne=0,oe=0;for(;ne<ee&&(te+=1,oe!==X.length);)ne+=charWidth.calculate(X[oe],this.font),oe+=1;return te}containedByBounds(_){return getPointsFromBoundsWithRotation(this).some(w=>_.containsPoint(w))}intersectWithLine(_,y){const w=getPointsFromBoundsWithRotation(this);return linePolygonIntersects(_,y,w)}render(_,y){const{text:w,color:$,fontSize:B,fontFamily:R,textAlign:H,rotate:j,computedValue:q}=this,[,,X,ee]=this.deserializeXYWH(),te=X/2,ne=ee/2;_.setTransform(y.translateSelf(te,ne).rotateSelf(j).translateSelf(-te,-ne));const ie=w.toDelta(),ae=deltaInsertsToChunks(ie),re=getLineHeight(R,B),se=this.font,le=H==="center"?X/2:H==="right"?X:0;for(const[ue,he]of ae.entries()){let ce=0;for(const ge of he){_.save();const be=ge.insert,fe=isRTL$1(be),we=fe&&!_.canvas.isConnected;we&&document.body.appendChild(_.canvas),_.canvas.setAttribute("dir",fe?"rtl":"ltr"),_.font=se,_.fillStyle=q($),_.textAlign=H,_.textBaseline="ideographic",_.fillText(be,le+ce+1,(ue+1)*re+.5),ce+=getTextWidth(be,se),we&&_.canvas.remove(),_.restore()}}}getRelativePointLocation(_){const y=Bound.deserialize(this.xywh),w=getPointFromBoundsWithRotation(this,y.getRelativePoint(_)),$=getPointsFromBoundsWithRotation(this),B=polygonGetPointTangent($,w);return new PointLocation(w,B)}}const ElementCtors={debug:DebugElement,brush:BrushElement,shape:ShapeElement,connector:ConnectorElement,text:TextElement,frame:FrameElement},ElementDefaultProps={debug:DebugElementDefaultProps,brush:BrushElementDefaultProps,shape:ShapeElementDefaultProps,connector:ConnectorElementDefaultProps,text:TextElementDefaultProps,frame:FrameElementDefaultProps};function getGridIndex(k){return Math.ceil(k/GRID_SIZE)-1}function rangeFromBound(k){k.rotate&&(k=getBoundsWithRotation(k));const _=getGridIndex(k.x),y=getGridIndex(k.x+k.w),w=getGridIndex(k.y),$=getGridIndex(k.y+k.h);return[_,y,w,$]}function rangeFromElement(k){const _=k.gridBound,y=getGridIndex(_.x),w=getGridIndex(_.maxX),$=getGridIndex(_.y),B=getGridIndex(_.maxY);return[y,w,$,B]}function compare$1(k,_){if(k.batch&&_.batch){if(k.batch<_.batch)return-1;if(k.batch>_.batch)return 1}return k.index<_.index?-1:k.index>_.index?1:0}class GridManager{constructor(){this._grids=new Map,this._elementToGrids=new Map}_createGrid(_,y){const w=_+"|"+y,$=new Set;return this._grids.set(w,$),$}_getGrid(_,y){const w=_+"|"+y;return this._grids.get(w)}get isEmpty(){return this._grids.size===0}add(_){const[y,w,$,B]=rangeFromElement(_),R=new Set;this._elementToGrids.set(_,R);for(let H=y;H<=w;H++)for(let j=$;j<=B;j++){let q=this._getGrid(H,j);q||(q=this._createGrid(H,j)),q.add(_),R.add(q)}}remove(_){const y=this._elementToGrids.get(_);assertExists(y);for(const w of y)w.delete(_)}boundHasChanged(_,y){const[w,$,B,R]=rangeFromBound(_),[H,j,q,X]=rangeFromBound(y);return w!==H||$!==j||B!==q||R!==X}search(_,y=!1){const[w,$,B,R]=rangeFromBound(_),H=new Set,j=Bound.from(_);for(let X=w;X<=$;X++)for(let ee=B;ee<=R;ee++){const te=this._getGrid(X,ee);if(te)for(const ne of te)(y?j.contains(ne.gridBound):intersects(ne.gridBound,_))&&H.add(ne)}return Array.from(H).sort(compare$1)}pick(_,y){const w=getGridIndex(_),$=getGridIndex(y),B=this._getGrid(w,$);if(!B)return[];const R=[];for(const H of B)isPointIn$1(getBoundsWithRotation(H),_,y)&&R.push(H);return R}}function clone$1(k){return[...k]}function curveToBezier(k,_=0){const y=k.length;if(y<3)throw new Error("A curve must have at least three points.");const w=[];if(y===3)w.push(clone$1(k[0]),clone$1(k[1]),clone$1(k[2]),clone$1(k[2]));else{const $=[];$.push(k[0],k[0]);for(let H=1;H<k.length;H++)$.push(k[H]),H===k.length-1&&$.push(k[H]);const B=[],R=1-_;w.push(clone$1($[0]));for(let H=1;H+2<$.length;H++){const j=$[H];B[0]=[j[0],j[1]],B[1]=[j[0]+(R*$[H+1][0]-R*$[H-1][0])/6,j[1]+(R*$[H+1][1]-R*$[H-1][1])/6],B[2]=[$[H+1][0]+(R*$[H][0]-R*$[H+2][0])/6,$[H+1][1]+(R*$[H][1]-R*$[H+2][1])/6],B[3]=[$[H+1][0],$[H+1][1]],w.push(B[1],B[2],B[3])}}return w}function distance(k,_){return Math.sqrt(distanceSq(k,_))}function distanceSq(k,_){return Math.pow(k[0]-_[0],2)+Math.pow(k[1]-_[1],2)}function distanceToSegmentSq(k,_,y){const w=distanceSq(_,y);if(w===0)return distanceSq(k,_);let $=((k[0]-_[0])*(y[0]-_[0])+(k[1]-_[1])*(y[1]-_[1]))/w;return $=Math.max(0,Math.min(1,$)),distanceSq(k,lerp(_,y,$))}function lerp(k,_,y){return[k[0]+(_[0]-k[0])*y,k[1]+(_[1]-k[1])*y]}function flatness(k,_){const y=k[_+0],w=k[_+1],$=k[_+2],B=k[_+3];let R=3*w[0]-2*y[0]-B[0];R*=R;let H=3*w[1]-2*y[1]-B[1];H*=H;let j=3*$[0]-2*B[0]-y[0];j*=j;let q=3*$[1]-2*B[1]-y[1];return q*=q,R<j&&(R=j),H<q&&(H=q),R+H}function getPointsOnBezierCurveWithSplitting(k,_,y,w){const $=w||[];if(flatness(k,_)<y){const B=k[_+0];$.length?distance($[$.length-1],B)>1&&$.push(B):$.push(B),$.push(k[_+3])}else{const R=k[_+0],H=k[_+1],j=k[_+2],q=k[_+3],X=lerp(R,H,.5),ee=lerp(H,j,.5),te=lerp(j,q,.5),ne=lerp(X,ee,.5),oe=lerp(ee,te,.5),ie=lerp(ne,oe,.5);getPointsOnBezierCurveWithSplitting([R,X,ne,ie],0,y,$),getPointsOnBezierCurveWithSplitting([ie,oe,te,q],0,y,$)}return $}function simplify(k,_){return simplifyPoints(k,0,k.length,_)}function simplifyPoints(k,_,y,w,$){const B=$||[],R=k[_],H=k[y-1];let j=0,q=1;for(let X=_+1;X<y-1;++X){const ee=distanceToSegmentSq(k[X],R,H);ee>j&&(j=ee,q=X)}return Math.sqrt(j)>w?(simplifyPoints(k,_,q+1,w,B),simplifyPoints(k,q,y,w,B)):(B.length||B.push(R),B.push(H)),B}function pointsOnBezierCurves(k,_=.15,y){const w=[],$=(k.length-1)/3;for(let B=0;B<$;B++){const R=B*3;getPointsOnBezierCurveWithSplitting(k,R,_,w)}return y&&y>0?simplifyPoints(w,0,w.length,y):w}function absolutize(k){let _=0,y=0,w=0,$=0;const B=[];for(const{key:R,data:H}of k)switch(R){case"M":B.push({key:"M",data:[...H]}),[_,y]=H,[w,$]=H;break;case"m":_+=H[0],y+=H[1],B.push({key:"M",data:[_,y]}),w=_,$=y;break;case"L":B.push({key:"L",data:[...H]}),[_,y]=H;break;case"l":_+=H[0],y+=H[1],B.push({key:"L",data:[_,y]});break;case"C":B.push({key:"C",data:[...H]}),_=H[4],y=H[5];break;case"c":{const j=H.map((q,X)=>X%2?q+y:q+_);B.push({key:"C",data:j}),_=j[4],y=j[5];break}case"Q":B.push({key:"Q",data:[...H]}),_=H[2],y=H[3];break;case"q":{const j=H.map((q,X)=>X%2?q+y:q+_);B.push({key:"Q",data:j}),_=j[2],y=j[3];break}case"A":B.push({key:"A",data:[...H]}),_=H[5],y=H[6];break;case"a":_+=H[5],y+=H[6],B.push({key:"A",data:[H[0],H[1],H[2],H[3],H[4],_,y]});break;case"H":B.push({key:"H",data:[...H]}),_=H[0];break;case"h":_+=H[0],B.push({key:"H",data:[_]});break;case"V":B.push({key:"V",data:[...H]}),y=H[0];break;case"v":y+=H[0],B.push({key:"V",data:[y]});break;case"S":B.push({key:"S",data:[...H]}),_=H[2],y=H[3];break;case"s":{const j=H.map((q,X)=>X%2?q+y:q+_);B.push({key:"S",data:j}),_=j[2],y=j[3];break}case"T":B.push({key:"T",data:[...H]}),_=H[0],y=H[1];break;case"t":_+=H[0],y+=H[1],B.push({key:"T",data:[_,y]});break;case"Z":case"z":B.push({key:"Z",data:[]}),_=w,y=$;break}return B}function normalize(k){const _=[];let y="",w=0,$=0,B=0,R=0,H=0,j=0;for(const{key:q,data:X}of k){switch(q){case"M":_.push({key:"M",data:[...X]}),[w,$]=X,[B,R]=X;break;case"C":_.push({key:"C",data:[...X]}),w=X[4],$=X[5],H=X[2],j=X[3];break;case"L":_.push({key:"L",data:[...X]}),[w,$]=X;break;case"H":w=X[0],_.push({key:"L",data:[w,$]});break;case"V":$=X[0],_.push({key:"L",data:[w,$]});break;case"S":{let ee=0,te=0;y==="C"||y==="S"?(ee=w+(w-H),te=$+($-j)):(ee=w,te=$),_.push({key:"C",data:[ee,te,...X]}),H=X[0],j=X[1],w=X[2],$=X[3];break}case"T":{const[ee,te]=X;let ne=0,oe=0;y==="Q"||y==="T"?(ne=w+(w-H),oe=$+($-j)):(ne=w,oe=$);const ie=w+2*(ne-w)/3,ae=$+2*(oe-$)/3,re=ee+2*(ne-ee)/3,se=te+2*(oe-te)/3;_.push({key:"C",data:[ie,ae,re,se,ee,te]}),H=ne,j=oe,w=ee,$=te;break}case"Q":{const[ee,te,ne,oe]=X,ie=w+2*(ee-w)/3,ae=$+2*(te-$)/3,re=ne+2*(ee-ne)/3,se=oe+2*(te-oe)/3;_.push({key:"C",data:[ie,ae,re,se,ne,oe]}),H=ee,j=te,w=ne,$=oe;break}case"A":{const ee=Math.abs(X[0]),te=Math.abs(X[1]),ne=X[2],oe=X[3],ie=X[4],ae=X[5],re=X[6];ee===0||te===0?(_.push({key:"C",data:[w,$,ae,re,ae,re]}),w=ae,$=re):(w!==ae||$!==re)&&(arcToCubicCurves(w,$,ae,re,ee,te,ne,oe,ie).forEach(function(le){_.push({key:"C",data:le})}),w=ae,$=re);break}case"Z":_.push({key:"Z",data:[]}),w=B,$=R;break}y=q}return _}function degToRad(k){return Math.PI*k/180}function rotate(k,_,y){const w=k*Math.cos(y)-_*Math.sin(y),$=k*Math.sin(y)+_*Math.cos(y);return[w,$]}function arcToCubicCurves(k,_,y,w,$,B,R,H,j,q){const X=degToRad(R);let ee=[],te=0,ne=0,oe=0,ie=0;if(q)[te,ne,oe,ie]=q;else{[k,_]=rotate(k,_,-X),[y,w]=rotate(y,w,-X);const ve=(k-y)/2,ke=(_-w)/2;let me=ve*ve/($*$)+ke*ke/(B*B);me>1&&(me=Math.sqrt(me),$=me*$,B=me*B);const Ie=H===j?-1:1,Fe=$*$,Be=B*B,Ze=Fe*Be-Fe*ke*ke-Be*ve*ve,Re=Fe*ke*ke+Be*ve*ve,qe=Ie*Math.sqrt(Math.abs(Ze/Re));oe=qe*$*ke/B+(k+y)/2,ie=qe*-B*ve/$+(_+w)/2,te=Math.asin(parseFloat(((_-ie)/B).toFixed(9))),ne=Math.asin(parseFloat(((w-ie)/B).toFixed(9))),k<oe&&(te=Math.PI-te),y<oe&&(ne=Math.PI-ne),te<0&&(te=Math.PI*2+te),ne<0&&(ne=Math.PI*2+ne),j&&te>ne&&(te=te-Math.PI*2),!j&&ne>te&&(ne=ne-Math.PI*2)}let ae=ne-te;if(Math.abs(ae)>Math.PI*120/180){const ve=ne,ke=y,me=w;j&&ne>te?ne=te+Math.PI*120/180*1:ne=te+Math.PI*120/180*-1,y=oe+$*Math.cos(ne),w=ie+B*Math.sin(ne),ee=arcToCubicCurves(y,w,ke,me,$,B,R,0,j,[ne,ve,oe,ie])}ae=ne-te;const re=Math.cos(te),se=Math.sin(te),le=Math.cos(ne),ue=Math.sin(ne),he=Math.tan(ae/4),ce=4/3*$*he,ge=4/3*B*he,be=[k,_],fe=[k+ce*se,_-ge*re],we=[y+ce*ue,w-ge*le],Ce=[y,w];if(fe[0]=2*be[0]-fe[0],fe[1]=2*be[1]-fe[1],q)return[fe,we,Ce].concat(ee);{ee=[fe,we,Ce].concat(ee);const ve=[];for(let ke=0;ke<ee.length;ke+=3){const me=rotate(ee[ke][0],ee[ke][1],X),Ie=rotate(ee[ke+1][0],ee[ke+1][1],X),Fe=rotate(ee[ke+2][0],ee[ke+2][1],X);ve.push([me[0],me[1],Ie[0],Ie[1],Fe[0],Fe[1]])}return ve}}const COMMAND=0,NUMBER=1,EOD=2,PARAMS={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function tokenize(k){const _=[];let y;for(;k!=="";){if(y=k.match(/^([ \t\r\n,]+)/),y){k=k.slice(y[0].length);continue}if(y=k.match(/^([aAcChHlLmMqQsStTvVzZ])/),y){_.push({type:COMMAND,text:y[0]}),k=k.slice(y[0].length);continue}if(y=k.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/),y)_.push({type:NUMBER,text:`${parseFloat(y[0])}`}),k=k.slice(y[0].length);else return[]}return _.push({type:EOD,text:""}),_}function isType(k,_){return k.type===_}function parsePath(k){const _=[],y=tokenize(k);let w="BOD",$=0,B=y[$];for(;!isType(B,EOD);){let R=0;const H=[];if(w==="BOD")if(B.text==="M"||B.text==="m")$++,R=PARAMS[B.text],w=B.text;else return parsePath("M0,0"+k);else isType(B,NUMBER)?R=PARAMS[w]:($++,R=PARAMS[B.text],w=B.text);if($+R<y.length){for(let j=$;j<$+R;j++){const q=y[j];if(isType(q,NUMBER))H[H.length]=+q.text;else throw new Error("Param not a number: "+w+","+q.text)}if(typeof PARAMS[w]=="number"){const j={key:w,data:H};_.push(j),$+=R,B=y[$],w==="M"&&(w="L"),w==="m"&&(w="l")}else throw new Error("Bad segment: "+w)}else throw new Error("Path data ended short")}return _}function pointsOnPath(k,_,y){const w=parsePath(k),$=normalize(absolutize(w)),B=[];let R=[],H=[0,0],j=[];const q=()=>{j.length>=4&&R.push(...pointsOnBezierCurves(j,_)),j=[]},X=()=>{q(),R.length&&(B.push(R),R=[])};for(const{key:te,data:ne}of $)switch(te){case"M":X(),H=[ne[0],ne[1]],R.push(H);break;case"L":q(),R.push([ne[0],ne[1]]);break;case"C":if(!j.length){const oe=R.length?R[R.length-1]:H;j.push([oe[0],oe[1]])}j.push([ne[0],ne[1]]),j.push([ne[2],ne[3]]),j.push([ne[4],ne[5]]);break;case"Z":q(),R.push([H[0],H[1]]);break}if(X(),!y)return B;const ee=[];for(const te of B){const ne=simplify(te,y);ne.length&&ee.push(ne)}return ee}function randomSeed(){return Math.floor(Math.random()*2**31)}class Random{constructor(_){this.seed=_}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}function rotatePoints(k,_,y){if(k&&k.length){const[w,$]=_,B=Math.PI/180*y,R=Math.cos(B),H=Math.sin(B);k.forEach(j=>{const[q,X]=j;j[0]=(q-w)*R-(X-$)*H+w,j[1]=(q-w)*H+(X-$)*R+$})}}function rotateLines(k,_,y){const w=[];k.forEach($=>w.push(...$)),rotatePoints(w,_,y)}function lineLength(k){const _=k[0],y=k[1];return Math.sqrt(Math.pow(_[0]-y[0],2)+Math.pow(_[1]-y[1],2))}function polygonHachureLines(k,_){const y=_.hachureAngle+90;let w=_.hachureGap;w<0&&(w=_.strokeWidth*4),w=Math.max(w,.1);const $=[0,0];if(y)for(const R of k)rotatePoints(R,$,y);const B=straightHachureLines(k,w);if(y){for(const R of k)rotatePoints(R,$,-y);rotateLines(B,$,-y)}return B}function straightHachureLines(k,_){const y=[];for(const H of k){const j=[...H];j[0].join(",")!==j[j.length-1].join(",")&&j.push([j[0][0],j[0][1]]),j.length>2&&y.push(j)}const w=[];_=Math.max(_,.1);const $=[];for(const H of y)for(let j=0;j<H.length-1;j++){const q=H[j],X=H[j+1];if(q[1]!==X[1]){const ee=Math.min(q[1],X[1]);$.push({ymin:ee,ymax:Math.max(q[1],X[1]),x:ee===q[1]?q[0]:X[0],islope:(X[0]-q[0])/(X[1]-q[1])})}}if($.sort((H,j)=>H.ymin<j.ymin?-1:H.ymin>j.ymin?1:H.x<j.x?-1:H.x>j.x?1:H.ymax===j.ymax?0:(H.ymax-j.ymax)/Math.abs(H.ymax-j.ymax)),!$.length)return w;let B=[],R=$[0].ymin;for(;B.length||$.length;){if($.length){let H=-1;for(let q=0;q<$.length&&!($[q].ymin>R);q++)H=q;$.splice(0,H+1).forEach(q=>{B.push({s:R,edge:q})})}if(B=B.filter(H=>!(H.edge.ymax<=R)),B.sort((H,j)=>H.edge.x===j.edge.x?0:(H.edge.x-j.edge.x)/Math.abs(H.edge.x-j.edge.x)),B.length>1)for(let H=0;H<B.length;H=H+2){const j=H+1;if(j>=B.length)break;const q=B[H].edge,X=B[j].edge;w.push([[Math.round(q.x),R],[Math.round(X.x),R]])}R+=_,B.forEach(H=>{H.edge.x=H.edge.x+_*H.edge.islope})}return w}class DashedFiller{constructor(_){this.helper=_}fillPolygons(_,y){const w=polygonHachureLines(_,y);return{type:"fillSketch",ops:this.dashedLine(w,y)}}dashedLine(_,y){const w=y.dashOffset<0?y.hachureGap<0?y.strokeWidth*4:y.hachureGap:y.dashOffset,$=y.dashGap<0?y.hachureGap<0?y.strokeWidth*4:y.hachureGap:y.dashGap,B=[];return _.forEach(R=>{const H=lineLength(R),j=Math.floor(H/(w+$)),q=(H+$-j*(w+$))/2;let X=R[0],ee=R[1];X[0]>ee[0]&&(X=R[1],ee=R[0]);const te=Math.atan((ee[1]-X[1])/(ee[0]-X[0]));for(let ne=0;ne<j;ne++){const oe=ne*(w+$),ie=oe+w,ae=[X[0]+oe*Math.cos(te)+q*Math.cos(te),X[1]+oe*Math.sin(te)+q*Math.sin(te)],re=[X[0]+ie*Math.cos(te)+q*Math.cos(te),X[1]+ie*Math.sin(te)+q*Math.sin(te)];B.push(...this.helper.doubleLineOps(ae[0],ae[1],re[0],re[1],y))}}),B}}class DotFiller{constructor(_){this.helper=_}fillPolygons(_,y){y=Object.assign({},y,{hachureAngle:0});const w=polygonHachureLines(_,y);return this.dotsOnLines(w,y)}dotsOnLines(_,y){const w=[];let $=y.hachureGap;$<0&&($=y.strokeWidth*4),$=Math.max($,.1);let B=y.fillWeight;B<0&&(B=y.strokeWidth/2);const R=$/4;for(const H of _){const j=lineLength(H),q=j/$,X=Math.ceil(q)-1,ee=j-X*$,te=(H[0][0]+H[1][0])/2-$/4,ne=Math.min(H[0][1],H[1][1]);for(let oe=0;oe<X;oe++){const ie=ne+ee+oe*$,ae=te-R+Math.random()*2*R,re=ie-R+Math.random()*2*R,se=this.helper.ellipse(ae,re,B,B,y);w.push(...se.ops)}}return{type:"fillSketch",ops:w}}}class HachureFiller{constructor(_){this.helper=_}fillPolygons(_,y){return this._fillPolygons(_,y)}_fillPolygons(_,y){const w=polygonHachureLines(_,y);return{type:"fillSketch",ops:this.renderLines(w,y)}}renderLines(_,y){const w=[];for(const $ of _)w.push(...this.helper.doubleLineOps($[0][0],$[0][1],$[1][0],$[1][1],y));return w}}class HatchFiller extends HachureFiller{fillPolygons(_,y){const w=this._fillPolygons(_,y),$=Object.assign({},y,{hachureAngle:y.hachureAngle+90}),B=this._fillPolygons(_,$);return w.ops=w.ops.concat(B.ops),w}}class ZigZagFiller extends HachureFiller{fillPolygons(_,y){let w=y.hachureGap;w<0&&(w=y.strokeWidth*4),w=Math.max(w,.1);const $=Object.assign({},y,{hachureGap:w}),B=polygonHachureLines(_,$),R=Math.PI/180*y.hachureAngle,H=[],j=w*.5*Math.cos(R),q=w*.5*Math.sin(R);for(const[ee,te]of B)lineLength([ee,te])&&H.push([[ee[0]-j,ee[1]+q],[...te]],[[ee[0]+j,ee[1]-q],[...te]]);return{type:"fillSketch",ops:this.renderLines(H,y)}}}class ZigZagLineFiller{constructor(_){this.helper=_}fillPolygons(_,y){const w=y.hachureGap<0?y.strokeWidth*4:y.hachureGap,$=y.zigzagOffset<0?w:y.zigzagOffset;y=Object.assign({},y,{hachureGap:w+$});const B=polygonHachureLines(_,y);return{type:"fillSketch",ops:this.zigzagLines(B,$,y)}}zigzagLines(_,y,w){const $=[];return _.forEach(B=>{const R=lineLength(B),H=Math.round(R/(2*y));let j=B[0],q=B[1];j[0]>q[0]&&(j=B[1],q=B[0]);const X=Math.atan((q[1]-j[1])/(q[0]-j[0]));for(let ee=0;ee<H;ee++){const te=ee*2*y,ne=(ee+1)*2*y,oe=Math.sqrt(2*Math.pow(y,2)),ie=[j[0]+te*Math.cos(X),j[1]+te*Math.sin(X)],ae=[j[0]+ne*Math.cos(X),j[1]+ne*Math.sin(X)],re=[ie[0]+oe*Math.cos(X+Math.PI/4),ie[1]+oe*Math.sin(X+Math.PI/4)];$.push(...this.helper.doubleLineOps(ie[0],ie[1],re[0],re[1],w),...this.helper.doubleLineOps(re[0],re[1],ae[0],ae[1],w))}}),$}}const fillers={};function getFiller(k,_){let y=k.fillStyle||"hachure";if(!fillers[y])switch(y){case"zigzag":fillers[y]||(fillers[y]=new ZigZagFiller(_));break;case"cross-hatch":fillers[y]||(fillers[y]=new HatchFiller(_));break;case"dots":fillers[y]||(fillers[y]=new DotFiller(_));break;case"dashed":fillers[y]||(fillers[y]=new DashedFiller(_));break;case"zigzag-line":fillers[y]||(fillers[y]=new ZigZagLineFiller(_));break;case"hachure":default:y="hachure",fillers[y]||(fillers[y]=new HachureFiller(_));break}return fillers[y]}const helper={randOffset,randOffsetWithRange,ellipse,doubleLineOps:doubleLineFillOps};function line(k,_,y,w,$){return{type:"path",ops:_doubleLine(k,_,y,w,$)}}function linearPath(k,_,y){const w=(k||[]).length;if(w>2){const $=[];for(let B=0;B<w-1;B++)$.push(..._doubleLine(k[B][0],k[B][1],k[B+1][0],k[B+1][1],y));return _&&$.push(..._doubleLine(k[w-1][0],k[w-1][1],k[0][0],k[0][1],y)),{type:"path",ops:$}}else if(w===2)return line(k[0][0],k[0][1],k[1][0],k[1][1],y);return{type:"path",ops:[]}}function polygon(k,_){return linearPath(k,!0,_)}function rectangle(k,_,y,w,$){const B=[[k,_],[k+y,_],[k+y,_+w],[k,_+w]];return polygon(B,$)}function curve(k,_){let y=_curveWithOffset(k,1*(1+_.roughness*.2),_);if(!_.disableMultiStroke){const w=_curveWithOffset(k,1.5*(1+_.roughness*.22),cloneOptionsAlterSeed(_));y=y.concat(w)}return{type:"path",ops:y}}function ellipse(k,_,y,w,$){const B=generateEllipseParams(y,w,$);return ellipseWithParams(k,_,$,B).opset}function generateEllipseParams(k,_,y){const w=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(k/2,2)+Math.pow(_/2,2))/2)),$=Math.ceil(Math.max(y.curveStepCount,y.curveStepCount/Math.sqrt(200)*w)),B=Math.PI*2/$;let R=Math.abs(k/2),H=Math.abs(_/2);const j=1-y.curveFitting;return R+=_offsetOpt(R*j,y),H+=_offsetOpt(H*j,y),{increment:B,rx:R,ry:H}}function ellipseWithParams(k,_,y,w){const[$,B]=_computeEllipsePoints(w.increment,k,_,w.rx,w.ry,1,w.increment*_offset(.1,_offset(.4,1,y),y),y);let R=_curve($,null,y);if(!y.disableMultiStroke&&y.roughness!==0){const[H]=_computeEllipsePoints(w.increment,k,_,w.rx,w.ry,1.5,0,y),j=_curve(H,null,y);R=R.concat(j)}return{estimatedPoints:B,opset:{type:"path",ops:R}}}function arc(k,_,y,w,$,B,R,H,j){const q=k,X=_;let ee=Math.abs(y/2),te=Math.abs(w/2);ee+=_offsetOpt(ee*.01,j),te+=_offsetOpt(te*.01,j);let ne=$,oe=B;for(;ne<0;)ne+=Math.PI*2,oe+=Math.PI*2;oe-ne>Math.PI*2&&(ne=0,oe=Math.PI*2);const ie=Math.PI*2/j.curveStepCount,ae=Math.min(ie/2,(oe-ne)/2),re=_arc(ae,q,X,ee,te,ne,oe,1,j);if(!j.disableMultiStroke){const se=_arc(ae,q,X,ee,te,ne,oe,1.5,j);re.push(...se)}return R&&(H?re.push(..._doubleLine(q,X,q+ee*Math.cos(ne),X+te*Math.sin(ne),j),..._doubleLine(q,X,q+ee*Math.cos(oe),X+te*Math.sin(oe),j)):re.push({op:"lineTo",data:[q,X]},{op:"lineTo",data:[q+ee*Math.cos(ne),X+te*Math.sin(ne)]})),{type:"path",ops:re}}function svgPath(k,_){const y=normalize(absolutize(parsePath(k))),w=[];let $=[0,0],B=[0,0];for(const{key:R,data:H}of y)switch(R){case"M":{const j=1*(_.maxRandomnessOffset||0),q=_.preserveVertices;w.push({op:"move",data:H.map(X=>X+(q?0:_offsetOpt(j,_)))}),B=[H[0],H[1]],$=[H[0],H[1]];break}case"L":w.push(..._doubleLine(B[0],B[1],H[0],H[1],_)),B=[H[0],H[1]];break;case"C":{const[j,q,X,ee,te,ne]=H;w.push(..._bezierTo(j,q,X,ee,te,ne,B,_)),B=[te,ne];break}case"Z":w.push(..._doubleLine(B[0],B[1],$[0],$[1],_)),B=[$[0],$[1]];break}return{type:"path",ops:w}}function solidFillPolygon(k,_){const y=[];for(const w of k)if(w.length){const $=_.maxRandomnessOffset||0,B=w.length;if(B>2){y.push({op:"move",data:[w[0][0]+_offsetOpt($,_),w[0][1]+_offsetOpt($,_)]});for(let R=1;R<B;R++)y.push({op:"lineTo",data:[w[R][0]+_offsetOpt($,_),w[R][1]+_offsetOpt($,_)]})}}return{type:"fillPath",ops:y}}function patternFillPolygons(k,_){return getFiller(_,helper).fillPolygons(k,_)}function patternFillArc(k,_,y,w,$,B,R){const H=k,j=_;let q=Math.abs(y/2),X=Math.abs(w/2);q+=_offsetOpt(q*.01,R),X+=_offsetOpt(X*.01,R);let ee=$,te=B;for(;ee<0;)ee+=Math.PI*2,te+=Math.PI*2;te-ee>Math.PI*2&&(ee=0,te=Math.PI*2);const ne=(te-ee)/R.curveStepCount,oe=[];for(let ie=ee;ie<=te;ie=ie+ne)oe.push([H+q*Math.cos(ie),j+X*Math.sin(ie)]);return oe.push([H+q*Math.cos(te),j+X*Math.sin(te)]),oe.push([H,j]),patternFillPolygons([oe],R)}function randOffset(k,_){return _offsetOpt(k,_)}function randOffsetWithRange(k,_,y){return _offset(k,_,y)}function doubleLineFillOps(k,_,y,w,$){return _doubleLine(k,_,y,w,$,!0)}function cloneOptionsAlterSeed(k){const _={...k};return _.randomizer=void 0,k.seed&&(_.seed=k.seed+1),_}function random(k){return k.randomizer||(k.randomizer=new Random(k.seed||0)),k.randomizer.next()}function _offset(k,_,y,w=1){return y.roughness*w*(random(y)*(_-k)+k)}function _offsetOpt(k,_,y=1){return _offset(-k,k,_,y)}function _doubleLine(k,_,y,w,$,B=!1){const R=B?$.disableMultiStrokeFill:$.disableMultiStroke,H=_line(k,_,y,w,$,!0,!1);if(R)return H;const j=_line(k,_,y,w,$,!0,!0);return H.concat(j)}function _line(k,_,y,w,$,B,R){const H=Math.pow(k-y,2)+Math.pow(_-w,2),j=Math.sqrt(H);let q=1;j<200?q=1:j>500?q=.4:q=-.0016668*j+1.233334;let X=$.maxRandomnessOffset||0;X*X*100>H&&(X=j/10);const ee=X/2,te=.2+random($)*.2;let ne=$.bowing*$.maxRandomnessOffset*(w-_)/200,oe=$.bowing*$.maxRandomnessOffset*(k-y)/200;ne=_offsetOpt(ne,$,q),oe=_offsetOpt(oe,$,q);const ie=[],ae=()=>_offsetOpt(ee,$,q),re=()=>_offsetOpt(X,$,q),se=$.preserveVertices;return B&&(R?ie.push({op:"move",data:[k+(se?0:ae()),_+(se?0:ae())]}):ie.push({op:"move",data:[k+(se?0:_offsetOpt(X,$,q)),_+(se?0:_offsetOpt(X,$,q))]})),R?ie.push({op:"bcurveTo",data:[ne+k+(y-k)*te+ae(),oe+_+(w-_)*te+ae(),ne+k+2*(y-k)*te+ae(),oe+_+2*(w-_)*te+ae(),y+(se?0:ae()),w+(se?0:ae())]}):ie.push({op:"bcurveTo",data:[ne+k+(y-k)*te+re(),oe+_+(w-_)*te+re(),ne+k+2*(y-k)*te+re(),oe+_+2*(w-_)*te+re(),y+(se?0:re()),w+(se?0:re())]}),ie}function _curveWithOffset(k,_,y){const w=[];w.push([k[0][0]+_offsetOpt(_,y),k[0][1]+_offsetOpt(_,y)]),w.push([k[0][0]+_offsetOpt(_,y),k[0][1]+_offsetOpt(_,y)]);for(let $=1;$<k.length;$++)w.push([k[$][0]+_offsetOpt(_,y),k[$][1]+_offsetOpt(_,y)]),$===k.length-1&&w.push([k[$][0]+_offsetOpt(_,y),k[$][1]+_offsetOpt(_,y)]);return _curve(w,null,y)}function _curve(k,_,y){const w=k.length,$=[];if(w>3){const B=[],R=1-y.curveTightness;$.push({op:"move",data:[k[1][0],k[1][1]]});for(let H=1;H+2<w;H++){const j=k[H];B[0]=[j[0],j[1]],B[1]=[j[0]+(R*k[H+1][0]-R*k[H-1][0])/6,j[1]+(R*k[H+1][1]-R*k[H-1][1])/6],B[2]=[k[H+1][0]+(R*k[H][0]-R*k[H+2][0])/6,k[H+1][1]+(R*k[H][1]-R*k[H+2][1])/6],B[3]=[k[H+1][0],k[H+1][1]],$.push({op:"bcurveTo",data:[B[1][0],B[1][1],B[2][0],B[2][1],B[3][0],B[3][1]]})}if(_&&_.length===2){const H=y.maxRandomnessOffset;$.push({op:"lineTo",data:[_[0]+_offsetOpt(H,y),_[1]+_offsetOpt(H,y)]})}}else w===3?($.push({op:"move",data:[k[1][0],k[1][1]]}),$.push({op:"bcurveTo",data:[k[1][0],k[1][1],k[2][0],k[2][1],k[2][0],k[2][1]]})):w===2&&$.push(..._doubleLine(k[0][0],k[0][1],k[1][0],k[1][1],y));return $}function _computeEllipsePoints(k,_,y,w,$,B,R,H){const j=H.roughness===0,q=[],X=[];if(j){k=k/4,X.push([_+w*Math.cos(-k),y+$*Math.sin(-k)]);for(let ee=0;ee<=Math.PI*2;ee=ee+k){const te=[_+w*Math.cos(ee),y+$*Math.sin(ee)];q.push(te),X.push(te)}X.push([_+w*Math.cos(0),y+$*Math.sin(0)]),X.push([_+w*Math.cos(k),y+$*Math.sin(k)])}else{const ee=_offsetOpt(.5,H)-Math.PI/2;X.push([_offsetOpt(B,H)+_+.9*w*Math.cos(ee-k),_offsetOpt(B,H)+y+.9*$*Math.sin(ee-k)]);const te=Math.PI*2+ee-.01;for(let ne=ee;ne<te;ne=ne+k){const oe=[_offsetOpt(B,H)+_+w*Math.cos(ne),_offsetOpt(B,H)+y+$*Math.sin(ne)];q.push(oe),X.push(oe)}X.push([_offsetOpt(B,H)+_+w*Math.cos(ee+Math.PI*2+R*.5),_offsetOpt(B,H)+y+$*Math.sin(ee+Math.PI*2+R*.5)]),X.push([_offsetOpt(B,H)+_+.98*w*Math.cos(ee+R),_offsetOpt(B,H)+y+.98*$*Math.sin(ee+R)]),X.push([_offsetOpt(B,H)+_+.9*w*Math.cos(ee+R*.5),_offsetOpt(B,H)+y+.9*$*Math.sin(ee+R*.5)])}return[X,q]}function _arc(k,_,y,w,$,B,R,H,j){const q=B+_offsetOpt(.1,j),X=[];X.push([_offsetOpt(H,j)+_+.9*w*Math.cos(q-k),_offsetOpt(H,j)+y+.9*$*Math.sin(q-k)]);for(let ee=q;ee<=R;ee=ee+k)X.push([_offsetOpt(H,j)+_+w*Math.cos(ee),_offsetOpt(H,j)+y+$*Math.sin(ee)]);return X.push([_+w*Math.cos(R),y+$*Math.sin(R)]),X.push([_+w*Math.cos(R),y+$*Math.sin(R)]),_curve(X,null,j)}function _bezierTo(k,_,y,w,$,B,R,H){const j=[],q=[H.maxRandomnessOffset||1,(H.maxRandomnessOffset||1)+.3];let X=[0,0];const ee=H.disableMultiStroke?1:2,te=H.preserveVertices;for(let ne=0;ne<ee;ne++)ne===0?j.push({op:"move",data:[R[0],R[1]]}):j.push({op:"move",data:[R[0]+(te?0:_offsetOpt(q[0],H)),R[1]+(te?0:_offsetOpt(q[0],H))]}),X=te?[$,B]:[$+_offsetOpt(q[ne],H),B+_offsetOpt(q[ne],H)],j.push({op:"bcurveTo",data:[k+_offsetOpt(q[ne],H),_+_offsetOpt(q[ne],H),y+_offsetOpt(q[ne],H),w+_offsetOpt(q[ne],H),X[0],X[1]]});return j}const NOS="none";class RoughGenerator{constructor(_){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=_||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return randomSeed()}_o(_){return _?Object.assign({},this.defaultOptions,_):this.defaultOptions}_d(_,y,w){return{shape:_,sets:y||[],options:w||this.defaultOptions}}line(_,y,w,$,B){const R=this._o(B);return this._d("line",[line(_,y,w,$,R)],R)}rectangle(_,y,w,$,B){const R=this._o(B),H=[],j=rectangle(_,y,w,$,R);if(R.fill){const q=[[_,y],[_+w,y],[_+w,y+$],[_,y+$]];R.fillStyle==="solid"?H.push(solidFillPolygon([q],R)):H.push(patternFillPolygons([q],R))}return R.stroke!==NOS&&H.push(j),this._d("rectangle",H,R)}ellipse(_,y,w,$,B){const R=this._o(B),H=[],j=generateEllipseParams(w,$,R),q=ellipseWithParams(_,y,R,j);if(R.fill)if(R.fillStyle==="solid"){const X=ellipseWithParams(_,y,R,j).opset;X.type="fillPath",H.push(X)}else H.push(patternFillPolygons([q.estimatedPoints],R));return R.stroke!==NOS&&H.push(q.opset),this._d("ellipse",H,R)}circle(_,y,w,$){const B=this.ellipse(_,y,w,w,$);return B.shape="circle",B}linearPath(_,y){const w=this._o(y);return this._d("linearPath",[linearPath(_,!1,w)],w)}arc(_,y,w,$,B,R,H=!1,j){const q=this._o(j),X=[],ee=arc(_,y,w,$,B,R,H,!0,q);if(H&&q.fill)if(q.fillStyle==="solid"){const te={...q};te.disableMultiStroke=!0;const ne=arc(_,y,w,$,B,R,!0,!1,te);ne.type="fillPath",X.push(ne)}else X.push(patternFillArc(_,y,w,$,B,R,q));return q.stroke!==NOS&&X.push(ee),this._d("arc",X,q)}curve(_,y){const w=this._o(y),$=[],B=curve(_,w);if(w.fill&&w.fill!==NOS&&_.length>=3){const R=curveToBezier(_),H=pointsOnBezierCurves(R,10,(1+w.roughness)/2);w.fillStyle==="solid"?$.push(solidFillPolygon([H],w)):$.push(patternFillPolygons([H],w))}return w.stroke!==NOS&&$.push(B),this._d("curve",$,w)}polygon(_,y){const w=this._o(y),$=[],B=linearPath(_,!0,w);return w.fill&&(w.fillStyle==="solid"?$.push(solidFillPolygon([_],w)):$.push(patternFillPolygons([_],w))),w.stroke!==NOS&&$.push(B),this._d("polygon",$,w)}path(_,y){const w=this._o(y),$=[];if(!_)return this._d("path",$,w);_=(_||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const B=w.fill&&w.fill!=="transparent"&&w.fill!==NOS,R=w.stroke!==NOS,H=!!(w.simplification&&w.simplification<1),j=H?4-4*w.simplification:(1+w.roughness)/2,q=pointsOnPath(_,1,j);return B&&(w.fillStyle==="solid"?$.push(solidFillPolygon(q,w)):$.push(patternFillPolygons(q,w))),R&&(H?q.forEach(X=>{$.push(linearPath(X,!1,w))}):$.push(svgPath(_,w))),this._d("path",$,w)}opsToPath(_,y){let w="";for(const $ of _.ops){const B=typeof y=="number"&&y>=0?$.data.map(R=>+R.toFixed(y)):$.data;switch($.op){case"move":w+=`M${B[0]} ${B[1]} `;break;case"bcurveTo":w+=`C${B[0]} ${B[1]}, ${B[2]} ${B[3]}, ${B[4]} ${B[5]} `;break;case"lineTo":w+=`L${B[0]} ${B[1]} `;break}}return w.trim()}toPaths(_){const y=_.sets||[],w=_.options||this.defaultOptions,$=[];for(const B of y){let R=null;switch(B.type){case"path":R={d:this.opsToPath(B),stroke:w.stroke,strokeWidth:w.strokeWidth,fill:NOS};break;case"fillPath":R={d:this.opsToPath(B),stroke:NOS,strokeWidth:0,fill:w.fill||NOS};break;case"fillSketch":R=this.fillSketch(B,w);break}R&&$.push(R)}return $}fillSketch(_,y){let w=y.fillWeight;return w<0&&(w=y.strokeWidth/2),{d:this.opsToPath(_),stroke:y.fill||NOS,strokeWidth:w,fill:NOS}}}class RoughCanvas{constructor(_,y){this.canvas=_,this.ctx=this.canvas.getContext("2d"),this.gen=new RoughGenerator(y)}draw(_){const y=_.sets||[],w=_.options||this.getDefaultOptions(),$=this.ctx,B=_.options.fixedDecimalPlaceDigits;for(const R of y)switch(R.type){case"path":$.save(),$.strokeStyle=w.stroke==="none"?"transparent":w.stroke,$.lineWidth=w.strokeWidth,w.strokeLineDash&&$.setLineDash(w.strokeLineDash),w.strokeLineDashOffset&&($.lineDashOffset=w.strokeLineDashOffset),this._drawToContext($,R,B),$.restore();break;case"fillPath":{$.save(),$.fillStyle=w.fill||"";const H=_.shape==="curve"||_.shape==="polygon"||_.shape==="path"?"evenodd":"nonzero";this._drawToContext($,R,B,H),$.restore();break}case"fillSketch":this.fillSketch($,R,w);break}}fillSketch(_,y,w){let $=w.fillWeight;$<0&&($=w.strokeWidth/2),_.save(),w.fillLineDash&&_.setLineDash(w.fillLineDash),w.fillLineDashOffset&&(_.lineDashOffset=w.fillLineDashOffset),_.strokeStyle=w.fill||"",_.lineWidth=$,this._drawToContext(_,y,w.fixedDecimalPlaceDigits),_.restore()}_drawToContext(_,y,w,$="nonzero"){_.beginPath();for(const B of y.ops){const R=typeof w=="number"&&w>=0?B.data.map(H=>+H.toFixed(w)):B.data;switch(B.op){case"move":_.moveTo(R[0],R[1]);break;case"bcurveTo":_.bezierCurveTo(R[0],R[1],R[2],R[3],R[4],R[5]);break;case"lineTo":_.lineTo(R[0],R[1]);break}}y.type==="fillPath"?_.fill($):_.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(_,y,w,$,B){const R=this.gen.line(_,y,w,$,B);return this.draw(R),R}rectangle(_,y,w,$,B){const R=this.gen.rectangle(_,y,w,$,B);return this.draw(R),R}ellipse(_,y,w,$,B){const R=this.gen.ellipse(_,y,w,$,B);return this.draw(R),R}circle(_,y,w,$){const B=this.gen.circle(_,y,w,$);return this.draw(B),B}linearPath(_,y){const w=this.gen.linearPath(_,y);return this.draw(w),w}polygon(_,y){const w=this.gen.polygon(_,y);return this.draw(w),w}arc(_,y,w,$,B,R,H=!1,j){const q=this.gen.arc(_,y,w,$,B,R,H,j);return this.draw(q),q}curve(_,y){const w=this.gen.curve(_,y);return this.draw(w),w}path(_,y){const w=this.gen.path(_,y);return this.draw(w),w}}function cutoff(k,_,y){return y>0&&k>_||y<0&&k<_?_:k}class Overlay{}let Renderer$1=class{constructor(){this.gridManager=new GridManager,this.slots={viewportUpdated:new Slot},this._overlays=new Set,this._left=0,this._top=0,this._width=0,this._height=0,this._zoom=1,this._center={x:0,y:0},this._shouldUpdate=!1,this._rafId=null,this.applyDeltaCenter=(y,w)=>{this.setCenter(this.centerX+y,this.centerY+w),this._emitViewportUpdatedSlot()};const _=document.createElement("canvas");this.canvas=_,this.ctx=this.canvas.getContext("2d"),this.rc=new RoughCanvas(_)}_emitViewportUpdatedSlot(){this.slots.viewportUpdated.emit({zoom:this._zoom,center:Vec.toVec(this._center)})}get left(){return this._left}get top(){return this._top}get width(){return this._width}get height(){return this._height}get zoom(){return this._zoom}get centerX(){return this._center.x}get centerY(){return this._center.y}get center(){return this._center}get viewportX(){const{centerX:_,width:y,zoom:w}=this;return _-y/2/w}get viewportY(){const{centerY:_,height:y,zoom:w}=this;return _-y/2/w}get viewportMinXY(){const{centerX:_,centerY:y,width:w,height:$,zoom:B}=this;return{x:_-w/2/B,y:y-$/2/B}}get viewportMaxXY(){const{centerX:_,centerY:y,width:w,height:$,zoom:B}=this;return{x:_+w/2/B,y:y+$/2/B}}get viewportBounds(){const{viewportMinXY:_,viewportMaxXY:y}=this;return{..._,w:y.x-_.x,h:y.y-_.y}}get boundingClientRect(){return this._container.getBoundingClientRect()}isInViewport(_){const y=Bound.from(this.viewportBounds);return y.contains(_)||y.isIntersectWithBound(_)}toModelCoord(_,y){const{viewportX:w,viewportY:$,zoom:B}=this;return[w+_/B,$+y/B]}toViewCoord(_,y){const{viewportX:w,viewportY:$,zoom:B}=this;return[(_-w)*B,(y-$)*B]}setCenter(_,y){this._center.x=_,this._center.y=y,this._shouldUpdate=!0,this._emitViewportUpdatedSlot()}setZoom(_,y){const w=this.zoom;y=y??this._center,this._zoom=clamp$1(_,ZOOM_MIN,ZOOM_MAX);const $=this.zoom,B=Vec.sub(Vec.toVec(this.center),Vec.toVec(y)),R=Vec.add(Vec.toVec(y),Vec.mul(B,w/$));this.setCenter(R[0],R[1]),this._shouldUpdate=!0,this._emitViewportUpdatedSlot()}setViewport(_,y=Vec.toVec(this.center),w=!1){const $=this._zoom;if(w){const B=$/_;if(B===1)this.smoothTranslate(y[0],y[1]);else{const R=[this.centerX,this.centerY],H=Vec.mul(Vec.sub(y,Vec.mul(R,B)),1/(1-B));this.smoothZoom(_,Vec.toPoint(H))}}else this._center.x=y[0],this._center.y=y[1],this.setZoom(_)}setViewportByBound(_,y=[0,0,0,0],w=!1){const[$,B,R,H]=y,j=Math.min((this.width-(B+H))/_.w,(this.height-($+R))/_.h),q=[_.x+(_.w+B/j)/2-H/j/2,_.y+(_.h+R/j)/2-$/j/2];this.setViewport(j,q,w)}smoothZoom(_,y){const w=_-this.zoom,$=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const B=w>0?1:-1,H=w/10,j=cutoff(this.zoom+H,_,B);this.setZoom(j,y),j!=_&&$()})};$()}smoothTranslate(_,y){const{center:w}=this,$={x:_-w.x,y:y-w.y},B=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const H={x:$.x/10,y:$.y/10},j={x:this.centerX+H.x,y:this.centerY+H.y},q=$.x>0?1:-1,X=$.y>0?1:-1;j.x=cutoff(j.x,_,q),j.y=cutoff(j.y,y,X),this.setCenter(j.x,j.y),(j.x!=_||j.y!=y)&&B()})};B()}addElement(_){this.gridManager.add(_),this._shouldUpdate=!0}removeElement(_){this.gridManager.remove(_),this._shouldUpdate=!0}load(_){for(let y=0;y<_.length;y++)this.gridManager.add(_[y]);this._shouldUpdate=!0}refresh(){this._shouldUpdate=!0}attach(_){assertNotExists(this._container,"Phasor surface is attached multiple times"),this._container=_,_.appendChild(this.canvas),this._resetSize(),this._loop()}onResize(){const _=this.width,y=this.height;this._resetSize(),this.setCenter(this.centerX-(_-this.width)/2,this.centerY-(y-this.height)/2),this._render(),this._shouldUpdate=!1}_resetSize(){const{canvas:_}=this,y=window.devicePixelRatio;_.style.width="100%",_.style.height="100%";const w=_.getBoundingClientRect();_.width=Math.ceil(w.width*y),_.height=Math.ceil(w.height*y),this._left=w.left,this._top=w.top,this._width=w.width,this._height=w.height,this._shouldUpdate=!0}_loop(){requestAnimationFrame(()=>{this._shouldUpdate&&this._render(),this._shouldUpdate=!1,this._loop()})}_render(){const{ctx:_,viewportBounds:y,width:w,height:$,rc:B,zoom:R}=this,H=window.devicePixelRatio,j=R*H,q=new DOMMatrix().scaleSelf(j);_.clearRect(0,0,w*H,$*H),_.save(),_.setTransform(q),this._renderByBound(_,q,B,y)}_renderByBound(_,y,w,$,B){if(!_)return;const{gridManager:R}=this,H=B??R.search($);for(const j of H){_.save();const q=j.localRecord,X=q?.display??!0,ee=q?.opacity??1;if(intersects(getBoundsWithRotation(j),$)&&X){_.globalAlpha=ee;const te=j.x-$.x,ne=j.y-$.y;j.render(_,y.translate(te,ne),w)}_.restore()}for(const j of this._overlays)_.save(),_.translate(-$.x,-$.y),j.render(_,w),_.restore();_.restore()}getCanvasByBound(_,y){const w=window.devicePixelRatio||1,$=document.createElement("canvas");$.width=_.w*w,$.height=_.h*w;const B=$.getContext("2d"),R=new DOMMatrix().scaleSelf(w),H=new RoughCanvas($);return B.setTransform(R),this._renderByBound(B,R,H,_,y),$}addOverlay(_){this._overlays.add(_),this._shouldUpdate=!0}removeOverlay(_){this._overlays.delete(_),this._shouldUpdate=!0}};class Batch{constructor(_){this.name=_,this._elements=new Set,this._min="a0",this._max="a0"}get max(){return this._max}set max(_){this._max=_}get min(){return this._min}set min(_){this._min=_}addElement(_){const y=_.index;y>this.max?this.max=y:y<this.min&&(this.min=y),this._elements.add(_)}deleteElement(_){this._elements.delete(_)}}const BASE_62_DIGITS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function midpoint(k,_,y){const w=y[0];if(_!=null&&k>=_)throw new Error(k+" >= "+_);if(k.slice(-1)===w||_&&_.slice(-1)===w)throw new Error("trailing zero");if(_){let R=0;for(;(k[R]||w)===_[R];)R++;if(R>0)return _.slice(0,R)+midpoint(k.slice(R),_.slice(R),y)}const $=k?y.indexOf(k[0]):0,B=_!=null?y.indexOf(_[0]):y.length;if(B-$>1){const R=Math.round(.5*($+B));return y[R]}else return _&&_.length>1?_.slice(0,1):y[$]+midpoint(k.slice(1),null,y)}function validateInteger(k){if(k.length!==getIntegerLength(k[0]))throw new Error("invalid integer part of order key: "+k)}function getIntegerLength(k){if(k>="a"&&k<="z")return k.charCodeAt(0)-"a".charCodeAt(0)+2;if(k>="A"&&k<="Z")return"Z".charCodeAt(0)-k.charCodeAt(0)+2;throw new Error("invalid order key head: "+k)}function getIntegerPart(k){const _=getIntegerLength(k[0]);if(_>k.length)throw new Error("invalid order key: "+k);return k.slice(0,_)}function validateOrderKey(k,_){if(k==="A"+_[0].repeat(26))throw new Error("invalid order key: "+k);const y=getIntegerPart(k);if(k.slice(y.length).slice(-1)===_[0])throw new Error("invalid order key: "+k)}function incrementInteger(k,_){validateInteger(k);const[y,...w]=k.split("");let $=!0;for(let B=w.length-1;$&&B>=0;B--){const R=_.indexOf(w[B])+1;R===_.length?w[B]=_[0]:(w[B]=_[R],$=!1)}if($){if(y==="Z")return"a"+_[0];if(y==="z")return null;const B=String.fromCharCode(y.charCodeAt(0)+1);return B>"a"?w.push(_[0]):w.pop(),B+w.join("")}else return y+w.join("")}function decrementInteger(k,_){validateInteger(k);const[y,...w]=k.split("");let $=!0;for(let B=w.length-1;$&&B>=0;B--){const R=_.indexOf(w[B])-1;R===-1?w[B]=_.slice(-1):(w[B]=_[R],$=!1)}if($){if(y==="a")return"Z"+_.slice(-1);if(y==="A")return null;const B=String.fromCharCode(y.charCodeAt(0)-1);return B<"Z"?w.push(_.slice(-1)):w.pop(),B+w.join("")}else return y+w.join("")}function generateKeyBetween(k,_,y=BASE_62_DIGITS){if(k!=null&&validateOrderKey(k,y),_!=null&&validateOrderKey(_,y),k!=null&&_!=null&&k>=_)throw new Error(k+" >= "+_);if(k==null){if(_==null)return"a"+y[0];const j=getIntegerPart(_),q=_.slice(j.length);if(j==="A"+y[0].repeat(26))return j+midpoint("",q,y);if(j<_)return j;const X=decrementInteger(j,y);if(X==null)throw new Error("cannot decrement any more");return X}if(_==null){const j=getIntegerPart(k),q=k.slice(j.length),X=incrementInteger(j,y);return X??j+midpoint(q,null,y)}const w=getIntegerPart(k),$=k.slice(w.length),B=getIntegerPart(_),R=_.slice(B.length);if(w===B)return w+midpoint($,R,y);const H=incrementInteger(w,y);if(H==null)throw new Error("cannot increment any more");return H<_?H:w+midpoint($,null,y)}function generateNKeysBetween(k,_,y,w=BASE_62_DIGITS){if(y===0)return[];if(y===1)return[generateKeyBetween(k,_,w)];if(_==null){let R=generateKeyBetween(k,_,w);const H=[R];for(let j=0;j<y-1;j++)R=generateKeyBetween(R,_,w),H.push(R);return H}if(k==null){let R=generateKeyBetween(k,_,w);const H=[R];for(let j=0;j<y-1;j++)R=generateKeyBetween(k,R,w),H.push(R);return H.reverse(),H}const $=Math.floor(y/2),B=generateKeyBetween(k,_,w);return[...generateNKeysBetween(k,B,$,w),B,...generateNKeysBetween(B,_,y-$-1,w)]}function generateElementId(){return nanoid$1(10)}function normalizeWheelDeltaY(k,_=1){const y=Math.sign(k),w=Math.abs(k),$=ZOOM_STEP*100;w>$&&(k=$*y);let B=_-k/100;return B+=Math.log10(Math.max(1,_))*-y*Math.min(1,w/20),B}class SurfaceManager{constructor(_,y=$=>$,w=()=>!1){this._elements=new Map,this._elementLocalRecords=new Map,this._defaultBatch="a1",this._batches=new Map,this.slots={elementUpdated:new Slot,elementAdded:new Slot,elementRemoved:new Slot},this._onYContainer=$=>{if($.changes.keys.size===0)return;const B=[];$.keysChanged.forEach(R=>{const H=$.changes.keys.get(R);if(!H){console.error("invalid event",$);return}if(H.action==="add"&&this._yContainer.get(R)?.get("type")==="connector"){B.push({change:H,id:R});return}else this._onYEvent(H,R)}),B.forEach(({change:R,id:H})=>this._onYEvent(R,H))},this._onYEvent=($,B)=>{if($.action==="add"){const R=this._yContainer.get(B),H=R.get("type"),j=ElementCtors[H];assertExists(j);const q=new j(R,this);q.computedValue=this._computedValue,q.mount(this._renderer),this._elements.set(q.id,q),this._addToBatch(q),this.slots.elementAdded.emit(B)}else if($.action==="update")console.error("update event on yElements is not supported",event);else if($.action==="delete"){const R=this._elements.get(B);assertExists(R),R.unmount(),this._elements.delete(B),this.deleteElementLocalRecord(B),this._removeFromBatch(R),this.slots.elementRemoved.emit({id:B,element:R})}},this._renderer=new Renderer$1,this._yContainer=_,this._computedValue=y,this._isReadonly=w,this._yContainer.observe(this._onYContainer)}init(){this._syncFromExistingContainer()}get viewport(){return this._renderer}get defaultBatch(){return this._defaultBatch}getBatch(_){const y=this._batches.get(_);if(y)return y;const w=new Batch(_);return this._batches.set(_,w),w}_addToBatch(_){const y=_.batch??this._defaultBatch;this.getBatch(y).addElement(_)}_removeFromBatch(_){const y=_.batch??this._defaultBatch;this.getBatch(y).deleteElement(_)}_syncFromExistingContainer(){this._transact(()=>{const _=[];this._yContainer.forEach(y=>{if(y.get("type")==="connector"){_.push(y);return}this._createElementFromYMap(y)}),_.forEach(y=>{this._createElementFromYMap(y)})})}_createElementFromYMap(_){const y=_.get("type"),w=_.get("id"),$=ElementCtors[y];assertExists($);const B=new $(_,this);B.computedValue=this._computedValue,B.mount(this._renderer),this._elements.set(B.id,B),this._addToBatch(B),this.slots.elementAdded.emit(w)}_transact(_){const y=this._yContainer.doc;y.transact(_,y.clientID)}refresh(){this._renderer.refresh()}updateIndexes(_,y,w){this._transact(()=>{let $,B=0;const R=y.length;for(;B<R;B++){$=_[B];const H=this._yContainer.get(y[B].id);H.get("index")!==$&&H.set("index",$)}w&&w(_)})}attach(_){this._renderer.attach(_)}onResize(){this._renderer.onResize()}getElementsBound(){return getCommonBound(Array.from(this._elements.values()))}addElement(_,y){if(this._isReadonly())throw new Error("Cannot add element in readonly mode");const w=generateElementId(),$=new YMap,B=ElementDefaultProps[_],R=this.getBatch(y.batch??this._defaultBatch),H={...B,...y,id:w,index:generateKeyBetween(R.max,null),seed:randomSeed()};return this._transact(()=>{for(const[j,q]of Object.entries(H))(j==="text"||j==="title")&&!(q instanceof YText)?$.set(j,new YText(q)):$.set(j,q);this._yContainer.set(w,$)}),w}updateElement(_,y){if(this._isReadonly())throw new Error("Cannot update element in readonly mode");this._transact(()=>{const w=this._elements.get(_);assertExists(w),w.applyUpdate(y)})}setElementBound(_,y){this.updateElement(_,{xywh:serializeXYWH(y.x,y.y,y.w,y.h)})}setDefaultBatch(_){this._defaultBatch=_}removeElement(_){if(this._isReadonly())throw new Error("Cannot remove element in readonly mode");this._transact(()=>{this._yContainer.delete(_)})}hasElement(_){return this._yContainer.has(_)}toModelCoord(_,y){return this._renderer.toModelCoord(_,y)}toViewCoord(_,y){return this._renderer.toViewCoord(_,y)}pickById(_){return this._elements.get(_)}pickByPoint(_,y,w={expand:10}){const $=w.expand??10;return this._renderer.gridManager.search({x:_-$/2,y:y-$/2,w:$,h:$}).filter(H=>H.hitTest(_,y,w))}pickTop(_,y,w){const $=this.pickByPoint(_,y,w);return $[$.length-1]??null}pickByBound(_){return this._renderer.gridManager.search(_).filter($=>{const B=Bound.from(_);return $.containedByBounds(B)||B.points.some((R,H,j)=>$.intersectWithLine(R,j[(H+1)%j.length]))})}getSortedElementsWithViewportBounds(){return this.pickByBound(this.viewport.viewportBounds).sort(compare$1)}dispose(){this._yContainer.unobserve(this._onYContainer)}initDefaultGestureHandler(){const{_renderer:_}=this;_.canvas.addEventListener("wheel",y=>{if(y.preventDefault(),y.ctrlKey){const w=normalizeWheelDeltaY(y.deltaY);_.setZoom(w)}else{const w=y.deltaX/_.zoom,$=y.deltaY/_.zoom;_.setCenter(_.centerX+w,_.centerY+$)}})}getElements(){return Array.from(this._elements.values())}getElementsByType(_){return this.getElements().filter(y=>y.type===_)}updateElementLocalRecord(_,y){const w=this._elementLocalRecords.get(_);w?this._elementLocalRecords.set(_,{...w,...y}):this._elementLocalRecords.set(_,y),this.refresh()}getElementLocalRecord(_){return this._elementLocalRecords.get(_)}deleteElementLocalRecord(_){this._elementLocalRecords.delete(_)}}function isOverlap(k,_){return[k[0][1],k[1][1],_[0][1],_[1][1]].every(y=>almostEqual(y,k[0][1],.02))?isOverlap$1(k,_,0):[k[0][0],k[1][0],_[0][0],_[1][0]].every(y=>almostEqual(y,k[0][0],.02))?isOverlap$1(k,_,1):!1}function arrayAlmostEqual(k,_){return almostEqual(k[0],_[0])&&almostEqual(k[1],_[1])}class Graph{constructor(_,y=[],w=[],$=[]){this.points=_,this.blocks=y,this.expandedBlocks=w,this.excludedPoints=$,this._xMap=new Map,this._yMap=new Map;const B=this._xMap,R=this._yMap;this.points.forEach(H=>{const[j,q]=H;B.has(j)||B.set(j,[]),R.has(q)||R.set(q,[]),B.get(j)?.push(H),R.get(q)?.push(H)})}_isBlock(_,y){return this.blocks.some(w=>linePolygonIntersects(_,y,w.points)?.length===2||w.isPointInBound(_,0)||w.isPointInBound(y,0)||[w.leftLine,w.upperLine,w.rightLine,w.lowerLine].some(B=>isOverlap(B,[_,y])))||this.expandedBlocks.some(w=>linePolygonIntersects(_,y,w.expand(-.5).points)?.length===2)}neighbors(_){const[y,w]=_,$=new Set,B=this._xMap.get(y),R=this._yMap.get(w);if(B){let H=1/0,j=1/0,q,X;B.forEach(ee=>{if(arrayAlmostEqual(ee,_))return;const te=ee[1]-_[1];te>0&&te<H&&(H=te,q=ee),te<0&&Math.abs(te)<j&&(j=Math.abs(te),X=ee)}),q&&(this._canSkipBlock(q)||!this._isBlock(_,q))&&$.add(q),X&&(this._canSkipBlock(X)||!this._isBlock(_,X))&&$.add(X)}if(R){let H=1/0,j=1/0,q,X;R.forEach(ee=>{if(arrayAlmostEqual(ee,_))return;const te=ee[0]-_[0];te>0&&te<H&&(H=te,q=ee),te<0&&Math.abs(te)<j&&(j=Math.abs(te),X=ee)}),q&&(this._canSkipBlock(q)||!this._isBlock(_,q))&&$.add(q),X&&(this._canSkipBlock(X)||!this._isBlock(_,X))&&$.add(X)}return Array.from($)}_canSkipBlock(_){return this.excludedPoints.some(y=>arrayAlmostEqual(_,y))}}class PriorityQueue{constructor(_){this._compare=_,this.heap=[]}enqueue(_,y){const w={value:_,priority:y};this.heap.push(w),this.bubbleUp()}dequeue(){const _=this.heap[0],y=this.heap.pop();return this.heap.length>0&&y&&(this.heap[0]=y,this.bubbleDown()),_?.value??null}empty(){return this.heap.length===0}bubbleUp(_=this.heap.length-1){const y=this.heap[_];for(;_>0;){const w=Math.floor((_-1)/2),$=this.heap[w];if(this._compare($.priority,y.priority)<=0)break;this.heap[w]=y,this.heap[_]=$,_=w}}bubbleDown(){let _=0;const y=this.heap.length,w=this.heap[0];for(;;){const $=2*_+1,B=2*_+2;let R=-1,H,j;if($<y&&(H=this.heap[$],this._compare(H.priority,w.priority)<0&&(R=$)),B<y&&(H=this.heap[$],j=this.heap[B],(R===null&&this._compare(j.priority,w.priority)<0||R!==null&&this._compare(j.priority,H.priority)<0)&&(R=B)),R===-1)break;this.heap[_]=this.heap[R],this.heap[R]=w,_=R}}}function cost(k,_){return Math.abs(k[0]-_[0])+Math.abs(k[1]-_[1])}function compare(k,_){return k[2]+.01<_[2]?-1:k[2]-.01>_[2]?1:k[0]<_[0]?-1:k[0]>_[0]?1:k[1]>_[1]?-1:k[1]<_[1]?1:0}function heuristic(k,_){return Math.abs(k[0]-_[0])+Math.abs(k[1]-_[1])}function getDiagonalCount(k,_,y){return almostEqual(k[0],_[0])&&almostEqual(k[0],y[0])||almostEqual(k[1],_[1])&&almostEqual(k[1],y[1])?0:1}function pointAlmostEqual(k,_){return almostEqual(k[0],_[0],.02)&&almostEqual(k[1],_[1],.02)}class AStarRunner{constructor(_,y,w,$,B,R=[],H=[]){this._sp=y,this._ep=w,this._originalSp=$,this._originalEp=B,this._cameFrom=new Map,this._costSoFar=new Map,this._diagonalCount=new Map,this._pointPriority=new Map,this._current=null,this._complete=!1,this._sp[2]=0,this._ep[2]=0,this._originalEp[2]=0,this._graph=new Graph([..._],R,H),this._init()}_init(){this._cameFrom.set(this._sp,{from:[this._originalSp],indexs:[-1]}),this._cameFrom.set(this._originalSp,{from:[],indexs:[]}),this._costSoFar.set(this._sp,[0]),this._diagonalCount.set(this._sp,[0]),this._pointPriority.set(this._sp,[0]),this._frontier=new PriorityQueue(compare),this._frontier.enqueue(this._sp,[0,0,0])}_neighbors(_){const y=this._graph.neighbors(_),w=this._cameFrom.get(_);return assertExists(w),w.from.forEach($=>{const B=y.findIndex(R=>pointAlmostEqual(R,$));B>=0&&y.splice(B,1)}),_===this._ep&&y.push(this._originalEp),y}step(){if(this._complete)return;this._current=this._frontier.dequeue();const _=this._current;if(!_){this._complete=!0;return}_===this._ep&&pointAlmostEqual(this._ep,this._originalEp)&&(this._originalEp=this._ep);const y=this._neighbors(_);for(let w=0;w<y.length;w++){const $=y[w],B=this._costSoFar.get(_),R=this._diagonalCount.get(_),H=this._pointPriority.get(_),j=this._cameFrom.get(_);assertExists(B),assertExists(R),assertExists(H),assertExists(j);const q=B.map(ce=>ce+cost(_,$)),X=R.map((ce,ge)=>ce+getDiagonalCount($,_,j.from[ge]));assertExists($[2]);const ee=H.map(ce=>ce+$[2]);let te=-1;if(q.length===1)te=0;else{const ce=findAllMinimalIndexs(q,(ge,be)=>ge+.01<be,(ge,be)=>almostEqual(ge,be,.02));if(ce.length===1)te=ce[0];else{const ge=ce.map(fe=>X[fe]),be=findAllMinimalIndexs(ge,(fe,we)=>fe<we,(fe,we)=>fe===we);if(be.length===1)te=ce[be[0]];else{const fe=be.map(Ce=>ee[ce[Ce]]);te=findAllMaximalIndexs(fe,(Ce,ve)=>Ce>ve,(Ce,ve)=>Ce===ve)[0]}}}const ne=!this._costSoFar.has($),oe=this._costSoFar.get($)??[],ie=this._diagonalCount.get($)??[],ae=this._pointPriority.get($)??[],re=this._cameFrom.get($)??{from:[],indexs:[]};oe.push(q[te]),ie.push(X[te]),ae.push(ee[te]),re.from.push(_),re.indexs.push(te);const se=X[te],le=ee[te],ue=q[te];this._costSoFar.set($,oe),this._diagonalCount.set($,ie),this._pointPriority.set($,ae),this._cameFrom.set($,re);const he=[se,le,ue+heuristic($,this._ep)];if(ne)this._frontier.enqueue($,he);else{const ce=this._frontier.heap.findIndex(be=>be.value===$),ge=this._frontier.heap[ce];ge?compare(he,ge.priority)<0&&(ge.priority=he,this._frontier.bubbleUp(ce)):this._frontier.enqueue($,he)}if(pointAlmostEqual(_,this._ep)&&pointAlmostEqual($,this._originalEp)){this._originalEp=$,this._complete=!0;return}}}reset(){this._cameFrom.clear(),this._costSoFar.clear(),this._diagonalCount.clear(),this._pointPriority.clear(),this._complete=!1,this._init()}run(){for(;!this._complete;)this.step()}get path(){const _=[];let y=this._complete?this._originalEp:this._current;const w=[0];for(;y;){_.unshift(y);const $=this._cameFrom.get(y);assertExists($);const B=w.shift();assertExists(B),w.push($.indexs[B]),y=$.from[B]}return _}}function findAllMinimalIndexs(k,_,y){let w=1/0,$=[];for(let B=0;B<k.length;B++){const R=k[B];_(R,w)?(w=R,$=[B]):y(R,w)&&$.push(B)}return $}function findAllMaximalIndexs(k,_,y){let w=-1/0,$=[];for(let B=0;B<k.length;B++){const R=k[B];_(R,w)?(w=R,$=[B]):y(R,w)&&$.push(B)}return $}var LineWidth;(function(k){k[k.LINE_WIDTH_TWO=2]="LINE_WIDTH_TWO",k[k.LINE_WIDTH_FOUR=4]="LINE_WIDTH_FOUR",k[k.LINE_WIDTH_SIX=6]="LINE_WIDTH_SIX",k[k.LINE_WIDTH_EIGHT=8]="LINE_WIDTH_EIGHT",k[k.LINE_WIDTH_TEN=10]="LINE_WIDTH_TEN",k[k.LINE_WIDTH_TWELVE=12]="LINE_WIDTH_TWELVE",k[k.Thin=4]="Thin",k[k.Thick=10]="Thick"})(LineWidth||(LineWidth={}));const BLOCK_ID_ATTR="data-block-id",BLOCK_SERVICE_LOADING_ATTR="data-service-loading",SCROLL_THRESHOLD=100,EDITOR_WIDTH=800,BLOCK_CHILDREN_CONTAINER_PADDING_LEFT=26,PAGE_BLOCK_PADDING_BOTTOM=150,PAGE_BLOCK_CHILD_PADDING=24,EDGELESS_BLOCK_CHILD_PADDING=24,EDGELESS_BLOCK_CHILD_BORDER_WIDTH=2,PAGE_HEADER_HEIGHT=53;class Point{constructor(_=0,y=0){this.x=_,this.y=y}static from(_,y){return Array.isArray(_)?new Point(_[0],_[1]):typeof _=="number"?new Point(_,y??_):new Point(_.x,_.y)}set(_,y){this.x=_,this.y=y}equals({x:_,y}){return this.x===_&&this.y===y}add(_){return new Point(this.x+_.x,this.y+_.y)}scale(_){return new Point(this.x*_,this.y*_)}subtract(_){return new Point(this.x-_.x,this.y-_.y)}clone(){return new Point(this.x,this.y)}cross(_){return this.x*_.y-this.y*_.x}lerp(_,y){return new Point(this.x+(_.x-this.x)*y,this.y+(_.y-this.y)*y)}toArray(){return[this.x,this.y]}static min(_,y){return new Point(Math.min(_.x,y.x),Math.min(_.y,y.y))}static max(_,y){return new Point(Math.max(_.x,y.x),Math.max(_.y,y.y))}static clamp(_,y,w){return new Point(clamp$2(_.x,y.x,w.x),clamp$2(_.y,y.y,w.y))}}class Rect{constructor(_,y,w,$){const[B,R]=_<=w?[_,w]:[w,_],[H,j]=y<=$?[y,$]:[$,y];this.min=new Point(B,H),this.max=new Point(R,j)}get width(){return this.max.x-this.min.x}set width(_){this.max.x=this.min.x+_}get height(){return this.max.y-this.min.y}set height(_){this.max.y=this.min.y+_}get left(){return this.min.x}set left(_){this.min.x=_}get top(){return this.min.y}set top(_){this.min.y=_}get right(){return this.max.x}set right(_){this.max.x=_}get bottom(){return this.max.y}set bottom(_){this.max.y=_}center(){return new Point((this.left+this.right)/2,(this.top+this.bottom)/2)}extend_with(_){this.min=Point.min(this.min,_),this.max=Point.max(this.max,_)}extend_with_x(_){this.min.x=Math.min(this.min.x,_),this.max.x=Math.max(this.max.x,_)}extend_with_y(_){this.min.y=Math.min(this.min.y,_),this.max.y=Math.max(this.max.y,_)}equals({min:_,max:y}){return this.min.equals(_)&&this.max.equals(y)}contains({min:_,max:y}){return this.isPointIn(_)&&this.isPointIn(y)}intersects({left:_,top:y,right:w,bottom:$}){return this.left<=w&&_<=this.right&&this.top<=$&&y<=this.bottom}isPointIn({x:_,y}){return this.left<=_&&_<=this.right&&this.top<=y&&y<=this.bottom}isPointDown({x:_,y}){return this.bottom<y&&this.left<=_&&this.right>=_}isPointUp({x:_,y}){return y<this.top&&this.left<=_&&this.right>=_}isPointLeft({x:_,y}){return _<this.left&&this.top<=y&&this.bottom>=y}isPointRight({x:_,y}){return _>this.right&&this.top<=y&&this.bottom>=y}intersect(_){return Rect.fromPoints(Point.max(this.min,_.min),Point.min(this.max,_.max))}clamp(_){return Point.clamp(_,this.min,this.max)}clone(){const{left:_,top:y,right:w,bottom:$}=this;return new Rect(_,y,w,$)}toDOMRect(){const{left:_,top:y,width:w,height:$}=this;return new DOMRect(_,y,w,$)}static fromLTRB(_,y,w,$){return new Rect(_,y,w,$)}static fromLWTH(_,y,w,$){return new Rect(_,w,_+y,w+$)}static fromXY(_,y){return Rect.fromPoint(new Point(_,y))}static fromPoint(_){return Rect.fromPoints(_.clone(),_)}static fromPoints(_,y){const w=Math.abs(y.x-_.x),$=Math.abs(y.y-_.y),B=Math.min(y.x,_.x),R=Math.min(y.y,_.y);return Rect.fromLWTH(B,w,R,$)}static fromDOMRect({left:_,top:y,right:w,bottom:$}){return Rect.fromLTRB(_,y,w,$)}static fromDOM(_){return Rect.fromDOMRect(_.getBoundingClientRect())}}const ATTR_SELECTOR=`[${BLOCK_ID_ATTR}]`,MAX_SPACE=32,STEPS=MAX_SPACE/2/2;function getNextBlock$1(k,_={}){if(k.id in _)throw new Error("Can't get next block! There's a loop in the block tree!");_[k.id]=!0;const y=k.page;if(k.children.length)return k.children[0];let w=k;for(;w;){const $=y.getNextSibling(w);if($)return matchFlavours($,["affine:note"])?getNextBlock$1($):$;w=y.getParent(w)}return null}function getPreviousBlock(k,_={}){if(k.id in _)throw new Error("Can't get previous block! There's a loop in the block tree!");_[k.id]=!0;const y=k.page,w=y.getParent(k);if(!w)return null;const $=y.getPreviousSibling(k);if(!$)return matchFlavours(w,["affine:note","affine:page","affine:database"])?getPreviousBlock(w):w;if($.children.length){let B=$.children[$.children.length-1];for(;B.children.length;)B=B.children[B.children.length-1];return B}return matchFlavours($,["affine:surface"])?getPreviousBlock($):$}function getPageBlock(k){return assertExists(k.page.root),document.querySelector(`[${BLOCK_ID_ATTR}="${k.page.root.id}"]`)}function getDocPage(k){const _=getEditorContainer(k);return _.mode!=="page"?null:_.querySelector("affine-doc-page")}function getDocPageByElement(k){const _=getClosestEditorContainer$1(k);return _.mode!=="page"?null:_.querySelector("affine-doc-page")}function getEdgelessPage(k){const _=getEditorContainer(k);return _.mode!=="edgeless"?null:_.querySelector("affine-edgeless-page")}function getEditorContainer(k){assertExists(k.root,"Failed to check page mode! Page root is not exists!");const y=getBlockElementById(k.root.id)?.closest("editor-container");return assertExists(y),y}const getClosestEditorContainer$1=k=>{const _=k.closest("editor-container");return assertExists(_),_};function isPageMode(k){const _=getEditorContainer(k);if(!("mode"in _))throw new Error("Failed to check page mode! Editor mode is not exists!");return _.mode==="page"}function getViewportElement(k){if(!isPageMode(k))return null;assertExists(k.root);const y=document.querySelector(`[${BLOCK_ID_ATTR}="${k.root.id}"]`);if(!y||y.closest("affine-doc-page")!==y)throw new Error("Failed to get viewport element!");return y.viewportElement}function getBlockElementByModel(k){assertExists(k.page.root);const _=getPageBlock(k);return _?k.id===k.page.root.id?_:_.querySelector(`[${BLOCK_ID_ATTR}="${k.id}"]`):null}function asyncGetBlockElementByModel(k){assertExists(k.page.root);const _=getPageBlock(k);if(!_)return Promise.resolve(null);if(k.id===k.page.root.id)return Promise.resolve(_);let y=!1;return new Promise((w,$)=>{const B=j=>{y=!0,H.disconnect(),w(j)},R=()=>{H.disconnect(),$(new Error(`Cannot find block element by model: ${k.flavour} id: ${k.id}`))},H=new MutationObserver(()=>{const j=_.querySelector(`[${BLOCK_ID_ATTR}="${k.id}"]`);j&&B(j)});H.observe(_,{childList:!0,subtree:!0}),requestAnimationFrame(()=>{if(!y){const j=getBlockElementByModel(k);j?B(j):R()}})})}function getRichTextByModel(k){const y=getBlockElementByModel(k)?.querySelector("rich-text");return y||null}async function asyncGetRichTextByModel(k){const y=(await asyncGetBlockElementByModel(k))?.querySelector("rich-text");return y||null}function getVirgoByModel(k){if(matchFlavours(k,["affine:database"]))return null;const _=getRichTextByModel(k);return _?_.vEditor:null}async function asyncGetVirgoByModel(k){if(matchFlavours(k,["affine:database"]))throw new Error("Cannot get virgo by database model!");const _=await asyncGetRichTextByModel(k);return _?_.vEditor:null}function getModelByElement(k){const _=k.closest(ATTR_SELECTOR);return assertExists(_,"Cannot find block element by element"),getModelByBlockElement(_)}function isInsidePageTitle(k){const y=(document.querySelector("editor-container")??document).querySelector('[data-block-is-title="true"]');return y?y.contains(k):!1}function isInsideEdgelessTextEditor(k){const _=document.querySelector("editor-container"),y=getEdgelessCanvasTextEditor(_??document);return y?y.contains(k):!1}function isDatabaseInput(k){return k instanceof HTMLElement&&k.getAttribute("data-virgo-root")==="true"&&!!k.closest("affine-database")}function contains(k,_){return k.compareDocumentPosition(_)&Node.DOCUMENT_POSITION_CONTAINED_BY}function hasBlockId(k){return k.hasAttribute(BLOCK_ID_ATTR)}function isDefaultPage({tagName:k}){return k==="AFFINE-DEFAULT-PAGE"}function isEdgelessPage(k){return k.tagName==="AFFINE-EDGELESS-PAGE"}function isPageOrNoteOrSurface(k){return isDefaultPage(k)||isEdgelessPage(k)||isNote(k)||isSurface(k)}function isBlock(k){return!isPageOrNoteOrSurface(k)}function isImage({tagName:k}){return k==="AFFINE-IMAGE"}function isNote({tagName:k}){return k==="AFFINE-NOTE"}function isSurface({tagName:k}){return k==="AFFINE-SURFACE"}function isDatabase({tagName:k}){return k==="AFFINE-DATABASE-TABLE"||k==="AFFINE-DATABASE"}function isEdgelessChildNote({classList:k}){return k.contains("affine-edgeless-child-note")}function getClosestBlockElementByPoint(k,_=null,y=1){const{y:w}=k;let $,B=null,R=null,H=null,j=0,q=1;if(_){const{snapToEdge:X={x:!0,y:!1}}=_;$=_.container;const ee=_.rect||$?.getBoundingClientRect();ee&&(X.x&&(k.x=Math.min(Math.max(k.x,ee.left)+BLOCK_CHILDREN_CONTAINER_PADDING_LEFT*y-1,ee.right-BLOCK_CHILDREN_CONTAINER_PADDING_LEFT*y-1)),X.y&&(y!==1&&console.warn("scale is not supported yet"),k.y=clamp$2(k.y,ee.top+1,ee.bottom-1)))}if(B=findBlockElement(document.elementsFromPoint(k.x,k.y),$),B){if(isDatabase(B)){R=B.getBoundingClientRect();const X=getDatabaseBlockRowsElement(B);if(X)if(H=X.getBoundingClientRect(),H.height){if(k.y<H.top||k.y>H.bottom)return B;H=null}else return B}else if(R=getRectByBlockElement(B),H=B.querySelector(".affine-block-children-container")?.firstElementChild?.getBoundingClientRect(),H&&H.height){if(R.x<k.x&&k.x<=H.x)return B;H=null}else return B;R=null,B=null}do if(k.y=w-q*2,q<0&&q--,q*=-1,B=findBlockElement(document.elementsFromPoint(k.x,k.y),$),B){if(R=getRectByBlockElement(B),j=R.bottom-k.y,j>=0&&j<=STEPS*2||(j=k.y-R.top,j>=0&&j<=STEPS*2))return B;R=null,B=null}while(q<=STEPS);return B}function findClosestBlockElement(k,_,y){const w=Array.from(k.querySelectorAll(y));let $=Number.POSITIVE_INFINITY,B=null;if(!w.length)return null;for(const R of w){const H=R.getBoundingClientRect();if(H.height===0||_.y>H.bottom||_.y<H.top)continue;const j=Math.pow(_.y-(H.y+H.height/2),2)+Math.pow(_.x-H.x,2);if(j<=$)$=j,B=R;else return B}return B}function getClosestBlockElementByElement(k){if(!k)return null;if(hasBlockId(k)&&isBlock(k))return k;const _=k.closest(ATTR_SELECTOR);return _&&isBlock(_)?_:null}function getModelByBlockElement(k){const _=k;if("hostModel"in _){const y=_;return assertExists(y.hostModel),y.hostModel}return assertExists(_.model),_.model}function getBlockElementById(k,_=document){return _.querySelector(`[${BLOCK_ID_ATTR}="${k}"]`)}function getClosestNoteBlockElementById(k,_=document){const y=getBlockElementById(k,_);return y?isNote(y)?y:y.closest("affine-note"):null}function getRectByBlockElement(k){return isDatabase(k)?k.getBoundingClientRect():(k.firstElementChild??k).getBoundingClientRect()}function getBlockElementsExcludeSubtrees(k){if(k.length<=1)return k;let _=k[0];return k.filter((y,w)=>w===0?!0:contains(_,y)?!1:(_=y,!0))}function findBlockElement(k,_){const y=k.length;let w=null,$=0;for(;$<y;)if(w=k[$],$++,!(_&&!contains(_,w))){if(hasBlockId(w)&&isBlock(w))return w;if(isImage(w)){const B=k[$];return $<y&&hasBlockId(B)&&isBlock(B)?k[$]:getClosestBlockElementByElement(B)}}return null}function queryCurrentMode(){return getComputedStyle(document.documentElement).getPropertyValue("--affine-theme-mode").trim()==="dark"?"dark":"light"}function getHoveringNote(k){return document.elementsFromPoint(k.x,k.y).find(isEdgelessChildNote)||null}function getDatabaseBlockTableElement(k){return k.querySelector(".affine-database-block-table")}function getDatabaseBlockColumnHeaderElement(k){return k.querySelector(".affine-database-column-header")}function getDatabaseBlockRowsElement(k){return k.querySelector(".affine-database-block-rows")}var DropFlags;(function(k){k[k.Normal=0]="Normal",k[k.Database=1]="Database",k[k.EmptyDatabase=2]="EmptyDatabase"})(DropFlags||(DropFlags={}));function getDropRectByPoint(k,_,y){const w={rect:getRectByBlockElement(y),flag:DropFlags.Normal};if(matchFlavours(_,["affine:database"])){const B=getDatabaseBlockTableElement(y);assertExists(B);let R=B.getBoundingClientRect();if(_.isEmpty()){if(w.flag=DropFlags.EmptyDatabase,k.y<R.top)return w;const H=getDatabaseBlockColumnHeaderElement(y);assertExists(H),R=H.getBoundingClientRect(),w.rect=new DOMRect(w.rect.left,R.bottom,w.rect.width,1)}else{w.flag=DropFlags.Database;const H=getDatabaseBlockRowsElement(y);assertExists(H);const j=H.getBoundingClientRect();if(k.y<j.top||k.y>j.bottom)return w;const q=document.elementsFromPoint(k.x,k.y),X=q.length;let ee,te=0;for(;te<X;te++){if(ee=q[te],ee.classList.contains("affine-database-block-row-cell-content"))return w.rect=getCellRect(ee,R),w;if(ee.classList.contains("affine-database-block-row"))return ee=ee.querySelector(ATTR_SELECTOR),assertExists(ee),w.rect=getCellRect(ee,R),w}}}else{const B=y.parentElement;if(B?.classList.contains("affine-database-block-row-cell-content"))return w.flag=DropFlags.Database,w.rect=getCellRect(B),w}return w}function getCellRect(k,_){if(!_){const B=k.closest(".affine-database-block-table");assertExists(B),_=B.getBoundingClientRect()}const y=k.parentElement;assertExists(y);const w=y.parentElement;assertExists(w);const $=y.getBoundingClientRect();return new DOMRect(_.left,$.top,$.right-_.left,$.height)}function getEdgelessCanvasTextEditor(k){return k.querySelector("edgeless-text-editor,edgeless-shape-text-editor")}function hasClassNameInList(k,_){return _.some(y=>k.classList.contains(y))}function caretRangeFromPoint(k,_){if(IS_FIREFOX){const $=document.caretPositionFromPoint(k,_),B=document.createRange();return B.setStart($.offsetNode,$.offset),B}const y=document.caretRangeFromPoint(k,_);if(!y)return null;const w=y?.getClientRects();return w&&w.length===2&&y.startOffset===y.endOffset&&_<w[0].y+w[0].height&&(w[0].x|0)-(w[1].x|0)>0&&(y.setStart(y.startContainer,y.startOffset-1),y.setEnd(y.endContainer,y.endOffset-1)),y}function setStartRange(k){const _=document.createRange();let y=k.firstChild;for(;y?.firstChild;)y=y.firstChild;return y&&(_.setStart(y,0),_.setEnd(y,0)),_}function setEndRange(k){const _=document.createRange();let y=k.lastChild;for(;y?.lastChild;)y=y.lastChild;return y&&(_.setStart(y,y.textContent?.length||0),_.setEnd(y,y.textContent?.length||0)),_}async function setNewTop(k,_,y=1){const w=_.closest(".affine-doc-viewport"),{top:$,bottom:B}=Rect.fromDOM(_),{clientHeight:R}=document.documentElement,H=(Number(window.getComputedStyle(_).lineHeight.replace(/\D+$/,""))||16)*y;switch(B<k){case!0:{let q=B;return B<SCROLL_THRESHOLD&&w&&(w.scrollTop=w.scrollTop-SCROLL_THRESHOLD+B,requestAnimationFrame(()=>{q=_.getBoundingClientRect().bottom})),q-H/2}case!1:{let q=$;return w&&$>R-SCROLL_THRESHOLD&&(w.scrollTop=w.scrollTop+($+SCROLL_THRESHOLD-R),requestAnimationFrame(()=>{q=_.getBoundingClientRect().top})),q+H/2}}}function focusTitle(k,_=1/0,y=0){const w=getDocPage(k);if(!w)throw new Error("Can't find page component!");if(!w.titleVEditor)throw new Error("Can't find title vEditor!");_>w.titleVEditor.yText.length&&(_=w.titleVEditor.yText.length),w.titleVEditor.setVRange({index:_,length:y})}async function focusRichText(k,_="end",y=1){!!getDocPageByElement(k)&&k.querySelector("v-line")?.scrollIntoView({block:"nearest"});const{left:$,right:B}=Rect.fromDOM(k);let R=null;switch(_){case"start":R=setStartRange(k);break;case"end":R=setEndRange(k);break;default:{const{x:H,y:j}=_;let q=H;const X=await setNewTop(j,k,y);H<=$&&(q=$+1),H>=B&&(q=B-1),R=caretRangeFromPoint(q,X);break}}resetNativeSelection(R)}function focusBlockByModel(k,_="end",y=1){if(matchFlavours(k,["affine:note","affine:page"]))throw new Error("Can't focus note or page!");const w=getPageBlock(k);assertExists(w);const $=getBlockElementByModel(k);assertExists($);const B=$?.querySelector("[contenteditable]");B&&focusRichText(B,_,y)}function resetNativeSelection(k){const _=window.getSelection();assertExists(_),_.removeAllRanges(),k&&_.addRange(k)}function hasNativeSelection(){const k=window.getSelection();return k?!!k.rangeCount:!1}function getCurrentNativeRange(k=window.getSelection()){if(!k)throw new Error("Failed to get current range, selection is null");if(k.rangeCount===0)throw new Error("Failed to get current range, rangeCount is 0");return k.rangeCount>1&&console.warn("getCurrentRange may be wrong, rangeCount > 1"),k.getRangeAt(0)}function handleNativeRangeAtPoint(k,_){const y=caretRangeFromPoint(k,_);y?.startContainer instanceof Node&&resetNativeSelection(y)}const createKeydownObserver=({target:k,onUpdateQuery:_,onMove:y,onConfirm:w,onEsc:$,interceptor:B=(H,j)=>j(),abortController:R})=>{let H="";const j=k.vEditor;assertExists(j,"Failed to observer keyboard! virgo editor is not exist.");const q=j?.getVRange()?.index??0,X=async()=>{await sleep(0);const te=getCurrentNativeRange();if(te.startContainer!==te.endContainer){console.warn("Failed to parse query! Current range is not collapsed.",te),R.abort();return}if(te.startContainer.nodeType!==Node.TEXT_NODE){console.warn("Failed to parse query! Current range is not a text node.",te),R.abort();return}const oe=j.getVRange()?.index??0,ie=j.yText.toString(),ae=H;H=ie.slice(q,oe),H!==ae&&_(H)},ee=te=>{if(te.stopPropagation(),!te.defaultPrevented){if(isControlledKeyboardEvent(te)){if((te.ctrlKey||te.metaKey)&&!te.altKey&&!te.shiftKey&&te.key.length===1)switch(te.key){case"P":case"p":{y(-1),te.preventDefault();return}case"N":case"n":{y(1),te.preventDefault();return}}if(te.key==="Control"||te.key==="Meta"||te.key==="Alt")return;R.abort();return}if(!isControlledKeyboardEvent(te)&&te.key.length===1||te.isComposing){X();return}switch(te.key){case"Escape":{R.abort();return}case"Backspace":{H.length||R.abort(),X();return}case"Enter":{if(te.shiftKey){R.abort();return}w(),te.preventDefault();return}case"Tab":{te.shiftKey?y(-1):y(1),te.preventDefault();return}case"ArrowUp":{if(te.shiftKey){R.abort();return}y(-1),te.preventDefault();return}case"ArrowDown":{if(te.shiftKey){R.abort();return}y(1),te.preventDefault();return}case"ArrowLeft":case"ArrowRight":{R.abort();return}default:return}}};if(k.addEventListener("keydown",te=>B(te,()=>ee(te)),{capture:!0,signal:R.signal}),k.addEventListener("input",X,{signal:R.signal}),$){const te=ne=>{ne.key==="Escape"&&$()};window.addEventListener("keydown",te,{signal:R.signal})}};function cleanSpecifiedTail(k,_){if(!_){console.warn("Failed to clean text! Unexpected empty string");return}const y=k instanceof BaseBlockModel?getVirgoByModel(k):k;assertExists(y,"Editor not found");const w=y.getVRange();assertExists(w);const $=w.index-_.length,B=y.yText.toString().slice($,$+_.length);if(B!==_){console.warn(`Failed to clean text! Text mismatch expected: ${_} but actual: ${B}`);return}y.deleteText({index:$,length:_.length}),y.setVRange({index:$,length:0})}const scrollbarStyle=k=>{if(!k)throw new Error("To prevent style pollution of the whole page, you must add a container before the scrollbar style.");if(k.length>50||k.includes("{")||k.includes("}"))throw new Error("Invalid container name!");return i$5`
    ${r$2(k)}::-webkit-scrollbar {
      -webkit-appearance: none;
      width: 4px;
    }
    ${r$2(k)}::-webkit-scrollbar-thumb {
      border-radius: 2px;
      background-color: #b1b1b1;
    }
  `},DatabaseSearchIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.75 9.5C3.75 6.32436 6.32436 3.75 9.5 3.75C12.6756 3.75 15.25 6.32436 15.25 9.5C15.25 12.6756 12.6756 15.25 9.5 15.25C6.32436 15.25 3.75 12.6756 3.75 9.5ZM9.5 2.25C5.49594 2.25 2.25 5.49594 2.25 9.5C2.25 13.5041 5.49594 16.75 9.5 16.75C11.2319 16.75 12.8219 16.1427 14.0689 15.1295L19.4697 20.5303C19.7626 20.8232 20.2374 20.8232 20.5303 20.5303C20.8232 20.2374 20.8232 19.7626 20.5303 19.4697L15.1295 14.0689C16.1427 12.8219 16.75 11.2319 16.75 9.5C16.75 5.49594 13.5041 2.25 9.5 2.25Z"
    fill="currentColor"
  />
</svg> `,DatabaseDuplicate=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V14C3.25 15.5188 4.48122 16.75 6 16.75H7.25V18C7.25 19.5188 8.48122 20.75 10 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V10C20.75 8.48122 19.5188 7.25 18 7.25H16.75V6C16.75 4.48122 15.5188 3.25 14 3.25H6ZM10 7.25H15.25V6C15.25 5.30964 14.6904 4.75 14 4.75H6C5.30964 4.75 4.75 5.30964 4.75 6V14C4.75 14.6904 5.30964 15.25 6 15.25H8C8.41421 15.25 8.75 15.5858 8.75 16V18C8.75 18.6904 9.30964 19.25 10 19.25H18C18.6904 19.25 19.25 18.6904 19.25 18V10C19.25 9.30964 18.6904 8.75 18 8.75H16H10C9.46561 8.75 9.00774 9.08568 8.82933 9.56024C8.68357 9.94796 8.2511 10.1441 7.86338 9.99835C7.47566 9.85259 7.27951 9.42012 7.42527 9.0324C7.81633 7.99216 8.82056 7.25 10 7.25ZM12.8871 10.489C12.6049 10.1858 12.1303 10.1688 11.8271 10.451C11.524 10.7333 11.507 11.2078 11.7892 11.511L12.4771 12.25H7.79999C7.38577 12.25 7.04999 12.5858 7.04999 13C7.04999 13.4142 7.38577 13.75 7.79999 13.75H12.4771L11.7892 14.489C11.507 14.7922 11.524 15.2667 11.8271 15.549C12.1303 15.8312 12.6049 15.8142 12.8871 15.511L14.7489 13.511C15.017 13.2231 15.017 12.7769 14.7489 12.489L12.8871 10.489Z"
    fill="currentColor"
  />
</svg> `,DatabaseInsertLeft=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M14 3.75C13.0335 3.75 12.25 4.5335 12.25 5.5V18.5C12.25 19.4665 13.0335 20.25 14 20.25H18C18.9665 20.25 19.75 19.4665 19.75 18.5V5.5C19.75 4.5335 18.9665 3.75 18 3.75H14ZM13.75 5.5C13.75 5.36193 13.8619 5.25 14 5.25H18C18.1381 5.25 18.25 5.36193 18.25 5.5V18.5C18.25 18.6381 18.1381 18.75 18 18.75H14C13.8619 18.75 13.75 18.6381 13.75 18.5V5.5ZM8.25 9.5C8.25 9.08579 7.91421 8.75 7.5 8.75C7.08579 8.75 6.75 9.08579 6.75 9.5V11.25H5C4.58579 11.25 4.25 11.5858 4.25 12C4.25 12.4142 4.58579 12.75 5 12.75H6.75V14.5C6.75 14.9142 7.08579 15.25 7.5 15.25C7.91421 15.25 8.25 14.9142 8.25 14.5V12.75H10C10.4142 12.75 10.75 12.4142 10.75 12C10.75 11.5858 10.4142 11.25 10 11.25H8.25V9.5Z"
    fill="currentColor"
  />
</svg> `,DatabaseInsertRight=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M6 3.75C5.0335 3.75 4.25 4.5335 4.25 5.5V18.5C4.25 19.4665 5.0335 20.25 6 20.25H10C10.9665 20.25 11.75 19.4665 11.75 18.5V5.5C11.75 4.5335 10.9665 3.75 10 3.75H6ZM5.75 5.5C5.75 5.36193 5.86193 5.25 6 5.25H10C10.1381 5.25 10.25 5.36193 10.25 5.5V18.5C10.25 18.6381 10.1381 18.75 10 18.75H6C5.86193 18.75 5.75 18.6381 5.75 18.5V5.5ZM17.25 9.5C17.25 9.08579 16.9142 8.75 16.5 8.75C16.0858 8.75 15.75 9.08579 15.75 9.5V11.25H14C13.5858 11.25 13.25 11.5858 13.25 12C13.25 12.4142 13.5858 12.75 14 12.75H15.75V14.5C15.75 14.9142 16.0858 15.25 16.5 15.25C16.9142 15.25 17.25 14.9142 17.25 14.5V12.75H19C19.4142 12.75 19.75 12.4142 19.75 12C19.75 11.5858 19.4142 11.25 19 11.25H17.25V9.5Z"
    fill="currentColor"
  />
</svg> `,DatabaseMoveLeft=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M4 4V20M8 12H20M8 12L12 8M8 12L12 16"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg>`,DatabaseMoveRight=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M20 4V20M4 12H16M16 12L12 8M16 12L12 16"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg>`,DatabaseMultiSelect=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M4 5L6.42929 7.42929C6.46834 7.46834 6.53166 7.46834 6.57071 7.42929L9 5"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M4 11L6.42929 13.4293C6.46834 13.4683 6.53166 13.4683 6.57071 13.4293L9 11"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M4 17L6.42929 19.4293C6.46834 19.4683 6.53166 19.4683 6.57071 19.4293L9 17"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M12 6L20 6"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M12 12L20 12"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M12 18L20 18"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
</svg>`,DatabaseNumber=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M18.5 4L12.5 20"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M12 4L6 20"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M20 8.5H5.5"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
  <path
    d="M19 15L4 15"
    stroke="currentColor"
    stroke-width="1.5"
    stroke-linecap="round"
  />
</svg>`,DatabaseSelect=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M12 3.75C7.44365 3.75 3.75 7.44365 3.75 12C3.75 16.5563 7.44365 20.25 12 20.25C16.5563 20.25 20.25 16.5563 20.25 12C20.25 7.44365 16.5563 3.75 12 3.75ZM2.25 12C2.25 6.61522 6.61522 2.25 12 2.25C17.3848 2.25 21.75 6.61522 21.75 12C21.75 17.3848 17.3848 21.75 12 21.75C6.61522 21.75 2.25 17.3848 2.25 12Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M7.46967 10.4697C7.76256 10.1768 8.23744 10.1768 8.53033 10.4697L12 13.9393L15.4697 10.4697C15.7626 10.1768 16.2374 10.1768 16.5303 10.4697C16.8232 10.7626 16.8232 11.2374 16.5303 11.5303L12.601 15.4596C12.2691 15.7916 11.7309 15.7916 11.399 15.4596L7.46967 11.5303C7.17678 11.2374 7.17678 10.7626 7.46967 10.4697Z"
  />
</svg>`,DatabaseProgress=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M15 4.25C15.4142 4.25 15.75 4.58579 15.75 5V6.25H18C20.0711 6.25 21.75 7.92893 21.75 10V14C21.75 16.0711 20.0711 17.75 18 17.75H15.75V19C15.75 19.4142 15.4142 19.75 15 19.75C14.5858 19.75 14.25 19.4142 14.25 19V17.75H6C3.92893 17.75 2.25 16.0711 2.25 14V10C2.25 7.92893 3.92893 6.25 6 6.25H14.25V5C14.25 4.58579 14.5858 4.25 15 4.25ZM14.25 7.75H6C4.75736 7.75 3.75 8.75736 3.75 10V14C3.75 15.2426 4.75736 16.25 6 16.25H14.25V7.75ZM15.75 16.25H18C19.2426 16.25 20.25 15.2426 20.25 14V10C20.25 8.75736 19.2426 7.75 18 7.75H15.75V16.25ZM6 9.25C6.41421 9.25 6.75 9.58579 6.75 10V14C6.75 14.4142 6.41421 14.75 6 14.75C5.58579 14.75 5.25 14.4142 5.25 14L5.25 10C5.25 9.58579 5.58579 9.25 6 9.25ZM9 9.25C9.41421 9.25 9.75 9.58579 9.75 10L9.75 14C9.75 14.4142 9.41421 14.75 9 14.75C8.58579 14.75 8.25 14.4142 8.25 14L8.25 10C8.25 9.58579 8.58579 9.25 9 9.25ZM12 9.25C12.4142 9.25 12.75 9.58579 12.75 10V14C12.75 14.4142 12.4142 14.75 12 14.75C11.5858 14.75 11.25 14.4142 11.25 14V10C11.25 9.58579 11.5858 9.25 12 9.25Z"
  />
</svg>`,DatabaseSearchClose=x$1`<svg
  width="16"
  height="16"
  viewBox="0 0 16 16"
  xmlns="http://www.w3.org/2000/svg"
  fill="none"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.22872 4.22878C4.42398 4.03352 4.74057 4.03352 4.93583 4.22878L7.99996 7.29291L11.0641 4.22878C11.2593 4.03352 11.5759 4.03352 11.7712 4.22878C11.9665 4.42405 11.9665 4.74063 11.7712 4.93589L8.70707 8.00002L11.7712 11.0641C11.9665 11.2594 11.9665 11.576 11.7712 11.7713C11.5759 11.9665 11.2593 11.9665 11.0641 11.7713L7.99996 8.70713L4.93583 11.7713C4.74057 11.9665 4.42398 11.9665 4.22872 11.7713C4.03346 11.576 4.03346 11.2594 4.22872 11.0641L7.29285 8.00002L4.22872 4.93589C4.03346 4.74063 4.03346 4.42405 4.22872 4.22878Z"
  />
</svg>`,addColumnStyle=`
  width: 12px;
  height: 12px;
  fill: var(--affine-text-primary-color);
`,DatabaseAddColumn=x$1`<svg
  viewBox="0 0 16 16"
  style=${addColumnStyle}
>
  <path
    d="M7.977 14.963c.407 0 .747-.324.747-.723V8.72h5.362c.399 0 .74-.34.74-.747a.746.746 0 00-.74-.738H8.724V1.706c0-.398-.34-.722-.747-.722a.732.732 0 00-.739.722v5.529h-5.37a.746.746 0 00-.74.738c0 .407.341.747.74.747h5.37v5.52c0 .399.332.723.739.723z"
  ></path>
</svg>`,DatabaseDragIcon=x$1`<svg
  width="10"
  height="14"
  viewBox="0 0 10 14"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <rect width="10" height="14" rx="2" />
  <rect width="10" height="14" rx="2" fill-opacity="0.08" />
  <g clip-path="url(#clip0_179_9218)">
    <circle cx="3" cy="3" r="1" fill="var(--affine-icon-color)" />
    <circle cx="3" cy="6.79163" r="1" fill="var(--affine-icon-color)" />
    <circle cx="3" cy="10.5833" r="1" fill="var(--affine-icon-color)" />
    <circle cx="7" cy="3" r="1" fill="var(--affine-icon-color)" />
    <circle cx="7" cy="6.79163" r="1" fill="var(--affine-icon-color)" />
    <circle cx="7" cy="10.5833" r="1" fill="var(--affine-icon-color)" />
  </g>
  <defs>
    <clipPath id="clip0_179_9218">
      <rect width="6" height="10" transform="translate(2 2)" />
    </clipPath>
  </defs>
</svg>`,DatabaseExpand=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M11.4697 3.46967C11.7626 3.17678 12.2374 3.17678 12.5303 3.46967L17.5303 8.46967C17.8232 8.76256 17.8232 9.23744 17.5303 9.53033C17.2374 9.82322 16.7626 9.82322 16.4697 9.53033L12 5.06066L7.53033 9.53033C7.23744 9.82322 6.76256 9.82322 6.46967 9.53033C6.17678 9.23744 6.17678 8.76256 6.46967 8.46967L11.4697 3.46967ZM6.46967 14.4697C6.76256 14.1768 7.23744 14.1768 7.53033 14.4697L12 18.9393L16.4697 14.4697C16.7626 14.1768 17.2374 14.1768 17.5303 14.4697C17.8232 14.7626 17.8232 15.2374 17.5303 15.5303L12.5303 20.5303C12.2374 20.8232 11.7626 20.8232 11.4697 20.5303L6.46967 15.5303C6.17678 15.2374 6.17678 14.7626 6.46967 14.4697Z"
    />
  </svg>
`,DatabaseTableViewClose=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M6.34314 6.34321C6.63604 6.05031 7.11091 6.05031 7.4038 6.34321L12 10.9394L16.5962 6.34321C16.8891 6.05031 17.364 6.05031 17.6569 6.34321C17.9497 6.6361 17.9497 7.11097 17.6569 7.40387L13.0607 12.0001L17.6569 16.5963C17.9497 16.8891 17.9497 17.364 17.6569 17.6569C17.364 17.9498 16.8891 17.9498 16.5962 17.6569L12 13.0607L7.4038 17.6569C7.11091 17.9498 6.63604 17.9498 6.34314 17.6569C6.05025 17.364 6.05025 16.8891 6.34314 16.5963L10.9393 12.0001L6.34314 7.40387C6.05025 7.11097 6.05025 6.6361 6.34314 6.34321Z"
    />
  </svg>
`,DateTime=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8 2.75C8.41421 2.75 8.75 3.08579 8.75 3.5V4.25H15.25V3.5C15.25 3.08579 15.5858 2.75 16 2.75C16.4142 2.75 16.75 3.08579 16.75 3.5V4.25H19C20.5188 4.25 21.75 5.48122 21.75 7V9.5V19C21.75 20.5188 20.5188 21.75 19 21.75H5C3.48122 21.75 2.25 20.5188 2.25 19V9.5V7C2.25 5.48122 3.48122 4.25 5 4.25H7.25V3.5C7.25 3.08579 7.58579 2.75 8 2.75ZM15.25 5.75V6.5C15.25 6.91421 15.5858 7.25 16 7.25C16.4142 7.25 16.75 6.91421 16.75 6.5V5.75H19C19.6904 5.75 20.25 6.30964 20.25 7V8.75H3.75V7C3.75 6.30964 4.30964 5.75 5 5.75H7.25V6.5C7.25 6.91421 7.58579 7.25 8 7.25C8.41421 7.25 8.75 6.91421 8.75 6.5V5.75H15.25ZM3.75 10.25H20.25V19C20.25 19.6904 19.6904 20.25 19 20.25H5C4.30964 20.25 3.75 19.6904 3.75 19V10.25Z"
    fill="currentColor"
  />
</svg> `,SelectIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.3382 3.88232L18.071 8.69778C19.057 9.31183 19.8404 9.79965 20.4017 10.2216C20.9493 10.6334 21.4318 11.0843 21.62 11.6695C21.8867 12.4988 21.7381 13.4034 21.2188 14.1027C20.8519 14.5967 20.2493 14.8668 19.599 15.0782C18.9323 15.295 18.0343 15.5017 16.9044 15.7619L14.4307 16.3315C14.0188 16.4263 13.9099 16.4546 13.8157 16.4966C13.7186 16.5398 13.628 16.5952 13.546 16.6612C13.4668 16.7248 13.3935 16.8071 13.1235 17.1285L11.9305 18.5487C11.1619 19.4637 10.552 20.1898 10.0419 20.6983C9.54485 21.1937 9.01767 21.6165 8.39804 21.7155C7.52711 21.8546 6.63961 21.5686 6.01457 20.9464C5.56962 20.5035 5.39023 19.852 5.27803 19.16C5.16287 18.4498 5.09454 17.5048 5.00846 16.3143L4.36524 7.4194C4.29567 6.45751 4.23964 5.68282 4.25162 5.08075C4.26356 4.48099 4.34123 3.90704 4.65753 3.44032C5.1136 2.76734 5.84833 2.33595 6.65829 2.25866C7.21736 2.20531 7.76101 2.406 8.30188 2.67863C8.84482 2.9523 9.5102 3.36667 10.3382 3.88232ZM7.62672 4.01809C7.14242 3.77398 6.91937 3.74056 6.80078 3.75187C6.43094 3.78716 6.10152 3.98335 5.89924 4.28182C5.83739 4.3731 5.76197 4.57571 5.75133 5.11059C5.74089 5.63501 5.79111 6.34017 5.86417 7.35039L6.50169 16.1665C6.59128 17.4054 6.6555 18.2835 6.7587 18.92C6.86614 19.5826 6.99323 19.8041 7.07276 19.8833C7.3574 20.1666 7.76345 20.2978 8.16139 20.2342C8.27331 20.2164 8.50697 20.1103 8.98296 19.6359C9.44025 19.1801 10.0077 18.5057 10.8074 17.5536L11.975 16.1637C11.9876 16.1487 12 16.1338 12.0123 16.1192C12.2275 15.8628 12.3981 15.6594 12.6059 15.4923C12.7891 15.345 12.9906 15.222 13.2055 15.1264C13.4489 15.018 13.7083 14.9583 14.0373 14.8828C14.056 14.8785 14.075 14.8741 14.0941 14.8697L16.5295 14.3089C17.7063 14.038 18.5391 13.8455 19.1352 13.6517C19.7552 13.4501 19.9496 13.2958 20.0145 13.2084C20.2445 12.8987 20.3109 12.4982 20.1921 12.1288C20.1582 12.0234 20.0224 11.8131 19.5003 11.4206C18.9981 11.0431 18.2715 10.5897 17.2448 9.95035L9.57798 5.17596C8.7097 4.63525 8.10182 4.25757 7.62672 4.01809Z"
  />
</svg>`,RenameIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M18.3032 4.49775C18.6342 4.16742 19.1714 4.16742 19.5024 4.49775C19.8326 4.82726 19.8326 5.3609 19.5024 5.69041L19.0739 6.1181L17.8768 4.92334L18.3032 4.49775ZM16.8151 5.98296L18.0122 7.17771L10.9259 14.25H9.75006V13.0341L16.8151 5.98296ZM20.562 3.43604C19.6455 2.52132 18.1601 2.52132 17.2436 3.43604L8.47025 12.1921C8.32928 12.3328 8.25006 12.5238 8.25006 12.723V15C8.25006 15.4142 8.58585 15.75 9.00006 15.75H11.2362C11.4348 15.75 11.6254 15.6712 11.766 15.5309L20.562 6.75212C21.4794 5.83658 21.4794 4.35158 20.562 3.43604ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H12C12.4142 4.75 12.75 4.41421 12.75 4C12.75 3.58579 12.4142 3.25 12 3.25H6C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V12C20.75 11.5858 20.4142 11.25 20 11.25C19.5858 11.25 19.25 11.5858 19.25 12V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6Z"
      fill="currentColor"
    />
  </svg>
`,AddFrameButtonIcon=x$1`
  <svg
    width="64"
    height="24"
    viewBox="0 0 64 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M7.83325 19.2923C7.48807 19.2923 7.20825 19.0125 7.20825 18.6673V16.7923H5.33325C4.98807 16.7923 4.70825 16.5125 4.70825 16.1673C4.70825 15.8221 4.98807 15.5423 5.33325 15.5423H7.20825L7.20825 8.45898H5.33325C4.98807 8.45898 4.70825 8.17916 4.70825 7.83398C4.70825 7.48881 4.98807 7.20898 5.33325 7.20898H7.20825V5.33398C7.20825 4.98881 7.48807 4.70898 7.83325 4.70898C8.17843 4.70898 8.45825 4.98881 8.45825 5.33398V7.20898H15.5416V5.33398C15.5416 4.98881 15.8214 4.70898 16.1666 4.70898C16.5118 4.70898 16.7916 4.98881 16.7916 5.33398V7.20898H18.6666C19.0118 7.20898 19.2916 7.48881 19.2916 7.83398C19.2916 8.17916 19.0118 8.45898 18.6666 8.45898H16.7916L16.7916 15.5423H18.6666C19.0118 15.5423 19.2916 15.8221 19.2916 16.1673C19.2916 16.5125 19.0118 16.7923 18.6666 16.7923H16.7916V18.6673C16.7916 19.0125 16.5118 19.2923 16.1666 19.2923C15.8214 19.2923 15.5416 19.0125 15.5416 18.6673V16.7923H8.45825V18.6673C8.45825 19.0125 8.17843 19.2923 7.83325 19.2923ZM15.5416 15.5423L15.5416 8.45898H8.45825L8.45825 15.5423H15.5416Z"
      fill="currentColor"
    />
    <path
      d="M27.0568 16V7.27273H32.2898V8.21023H28.1136V11.1591H31.8977V12.0966H28.1136V16H27.0568ZM33.8931 16V9.45455H34.8647V10.4432H34.9329C35.0522 10.1193 35.2681 9.85653 35.5806 9.65483C35.8931 9.45312 36.2454 9.35227 36.6374 9.35227C36.7113 9.35227 36.8036 9.35369 36.9144 9.35653C37.0252 9.35937 37.109 9.36364 37.1658 9.36932V10.392C37.1317 10.3835 37.0536 10.3707 36.9315 10.3537C36.8121 10.3338 36.6857 10.3239 36.5522 10.3239C36.234 10.3239 35.9499 10.3906 35.6999 10.5241C35.4528 10.6548 35.2567 10.8366 35.1119 11.0696C34.9698 11.2997 34.8988 11.5625 34.8988 11.858V16H33.8931ZM40.2841 16.1534C39.8693 16.1534 39.4929 16.0753 39.1548 15.919C38.8168 15.7599 38.5483 15.5312 38.3494 15.233C38.1506 14.9318 38.0511 14.5682 38.0511 14.142C38.0511 13.767 38.125 13.4631 38.2727 13.2301C38.4205 12.9943 38.6179 12.8097 38.8651 12.6761C39.1122 12.5426 39.3849 12.4432 39.6832 12.3778C39.9844 12.3097 40.2869 12.2557 40.5909 12.2159C40.9886 12.1648 41.3111 12.1264 41.5582 12.1009C41.8082 12.0724 41.9901 12.0256 42.1037 11.9602C42.2202 11.8949 42.2784 11.7812 42.2784 11.6193V11.5852C42.2784 11.1648 42.1634 10.8381 41.9332 10.6051C41.706 10.3722 41.3608 10.2557 40.8977 10.2557C40.4176 10.2557 40.0412 10.3608 39.7685 10.571C39.4957 10.7812 39.304 11.0057 39.1932 11.2443L38.2386 10.9034C38.4091 10.5057 38.6364 10.196 38.9205 9.97443C39.2074 9.75 39.5199 9.59375 39.858 9.50568C40.1989 9.41477 40.5341 9.36932 40.8636 9.36932C41.0739 9.36932 41.3153 9.39489 41.5881 9.44602C41.8636 9.49432 42.1293 9.59517 42.3849 9.74858C42.6435 9.90199 42.858 10.1335 43.0284 10.4432C43.1989 10.7528 43.2841 11.1676 43.2841 11.6875V16H42.2784V15.1136H42.2273C42.1591 15.2557 42.0455 15.4077 41.8864 15.5696C41.7273 15.7315 41.5156 15.8693 41.2514 15.983C40.9872 16.0966 40.6648 16.1534 40.2841 16.1534ZM40.4375 15.25C40.8352 15.25 41.1705 15.1719 41.4432 15.0156C41.7188 14.8594 41.9261 14.6577 42.0653 14.4105C42.2074 14.1634 42.2784 13.9034 42.2784 13.6307V12.7102C42.2358 12.7614 42.142 12.8082 41.9972 12.8509C41.8551 12.8906 41.6903 12.9261 41.5028 12.9574C41.3182 12.9858 41.1378 13.0114 40.9616 13.0341C40.7884 13.054 40.6477 13.071 40.5398 13.0852C40.2784 13.1193 40.0341 13.1747 39.8068 13.2514C39.5824 13.3253 39.4006 13.4375 39.2614 13.5881C39.125 13.7358 39.0568 13.9375 39.0568 14.1932C39.0568 14.5426 39.1861 14.8068 39.4446 14.9858C39.706 15.1619 40.0369 15.25 40.4375 15.25ZM45.1197 16V9.45455H46.0913V10.4773H46.1765C46.3129 10.1278 46.533 9.85653 46.837 9.66335C47.141 9.46733 47.506 9.36932 47.9322 9.36932C48.364 9.36932 48.7234 9.46733 49.0103 9.66335C49.3001 9.85653 49.5259 10.1278 49.6879 10.4773H49.756C49.9237 10.1392 50.1751 9.87074 50.5103 9.67188C50.8455 9.47017 51.2475 9.36932 51.7163 9.36932C52.3015 9.36932 52.7802 9.55256 53.1523 9.91903C53.5245 10.2827 53.7106 10.8494 53.7106 11.6193V16H52.7049V11.6193C52.7049 11.1364 52.5728 10.7912 52.3086 10.5838C52.0444 10.3764 51.7333 10.2727 51.3754 10.2727C50.9151 10.2727 50.5586 10.4119 50.3058 10.6903C50.0529 10.9659 49.9265 11.3153 49.9265 11.7386V16H48.9038V11.517C48.9038 11.1449 48.783 10.8452 48.5415 10.6179C48.3001 10.3878 47.989 10.2727 47.6083 10.2727C47.3469 10.2727 47.1026 10.3423 46.8754 10.4815C46.6509 10.6207 46.4691 10.8139 46.3299 11.0611C46.1935 11.3054 46.1254 11.5881 46.1254 11.9091V16H45.1197ZM58.2937 16.1364C57.663 16.1364 57.119 15.9972 56.6616 15.7188C56.207 15.4375 55.8562 15.0455 55.609 14.5426C55.3647 14.0369 55.2425 13.4489 55.2425 12.7784C55.2425 12.108 55.3647 11.517 55.609 11.0057C55.8562 10.4915 56.1999 10.0909 56.6403 9.80398C57.0835 9.5142 57.6005 9.36932 58.1914 9.36932C58.5323 9.36932 58.869 9.42614 59.2013 9.53977C59.5337 9.65341 59.8363 9.83807 60.109 10.0938C60.3817 10.3466 60.5991 10.6818 60.761 11.0994C60.9229 11.517 61.0039 12.0312 61.0039 12.642V13.0682H55.9585V12.1989H59.9812C59.9812 11.8295 59.9073 11.5 59.7596 11.2102C59.6147 10.9205 59.4073 10.6918 59.1374 10.5241C58.8704 10.3565 58.555 10.2727 58.1914 10.2727C57.7908 10.2727 57.4442 10.3722 57.1516 10.571C56.8619 10.767 56.6388 11.0227 56.4826 11.3381C56.3263 11.6534 56.2482 11.9915 56.2482 12.3523V12.9318C56.2482 13.4261 56.3335 13.8452 56.5039 14.1889C56.6772 14.5298 56.9173 14.7898 57.2241 14.9688C57.5309 15.1449 57.8874 15.233 58.2937 15.233C58.5579 15.233 58.7965 15.196 59.0096 15.1222C59.2255 15.0455 59.4116 14.9318 59.5678 14.7812C59.7241 14.6278 59.8448 14.4375 59.93 14.2102L60.9016 14.483C60.7994 14.8125 60.6275 15.1023 60.386 15.3523C60.1445 15.5994 59.8462 15.7926 59.4911 15.9318C59.136 16.0682 58.7369 16.1364 58.2937 16.1364Z"
      fill="currentColor"
    />
  </svg>
`,FrameNavigatorIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M3.17432 3.95175C3.17432 3.52535 3.51998 3.17969 3.94638 3.17969H5.08608H18.7626H19.9023C20.3287 3.17969 20.6743 3.52535 20.6743 3.95175C20.6743 4.37814 20.3287 4.7238 19.9023 4.7238H19.5346V14.5771H19.9023C20.3287 14.5771 20.6743 14.9228 20.6743 15.3492C20.6743 15.7756 20.3287 16.1212 19.9023 16.1212H12.6964V17.7827L16.6382 20.0352C17.0085 20.2467 17.1371 20.7183 16.9255 21.0885C16.714 21.4588 16.2424 21.5874 15.8722 21.3758L12.6964 19.5611V21.0477C12.6964 21.4741 12.3507 21.8197 11.9243 21.8197C11.4979 21.8197 11.1523 21.4741 11.1523 21.0477V19.6262L8.09045 21.3758C7.72024 21.5874 7.24862 21.4588 7.03707 21.0885C6.82552 20.7183 6.95414 20.2467 7.32436 20.0352L11.1523 17.8478V16.1212H3.94638C3.51998 16.1212 3.17432 15.7756 3.17432 15.3492C3.17432 14.9228 3.51998 14.5771 3.94638 14.5771H4.31402V4.7238H3.94638C3.51998 4.7238 3.17432 4.37814 3.17432 3.95175ZM5.85814 4.7238H17.9905V14.5767H5.85814V4.7238ZM9.27726 9.08046C9.27726 8.65406 8.9316 8.3084 8.5052 8.3084C8.0788 8.3084 7.73314 8.65406 7.73314 9.08046V11.3599C7.73314 11.7863 8.0788 12.1319 8.5052 12.1319C8.9316 12.1319 9.27726 11.7863 9.27726 11.3599V9.08046ZM11.9243 6.59891C12.3507 6.59891 12.6964 6.94457 12.6964 7.37097V11.3599C12.6964 11.7863 12.3507 12.132 11.9243 12.132C11.4979 12.132 11.1523 11.7863 11.1523 11.3599V7.37097C11.1523 6.94457 11.4979 6.59891 11.9243 6.59891ZM16.1155 10.2205C16.1155 9.79405 15.7698 9.44839 15.3434 9.44839C14.917 9.44839 14.5714 9.79405 14.5714 10.2205V11.3602C14.5714 11.7866 14.917 12.1322 15.3434 12.1322C15.7698 12.1322 16.1155 11.7866 16.1155 11.3602V10.2205Z"
  />
</svg> `,FrameNavigatorPrevIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M9.53033 7.46967C9.82322 7.76256 9.82322 8.23744 9.53033 8.53033L6.81066 11.25H19C19.4142 11.25 19.75 11.5858 19.75 12C19.75 12.4142 19.4142 12.75 19 12.75H6.81066L9.53033 15.4697C9.82322 15.7626 9.82322 16.2374 9.53033 16.5303C9.23744 16.8232 8.76256 16.8232 8.46967 16.5303L4.46967 12.5303C4.17678 12.2374 4.17678 11.7626 4.46967 11.4697L8.46967 7.46967C8.76256 7.17678 9.23744 7.17678 9.53033 7.46967Z"
    />
  </svg>
`,FrameNavigatorNextIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M14.4697 7.46967C14.7626 7.17678 15.2374 7.17678 15.5303 7.46967L19.5303 11.4697C19.8232 11.7626 19.8232 12.2374 19.5303 12.5303L15.5303 16.5303C15.2374 16.8232 14.7626 16.8232 14.4697 16.5303C14.1768 16.2374 14.1768 15.7626 14.4697 15.4697L17.1893 12.75H5C4.58579 12.75 4.25 12.4142 4.25 12C4.25 11.5858 4.58579 11.25 5 11.25H17.1893L14.4697 8.53033C14.1768 8.23744 14.1768 7.76256 14.4697 7.46967Z"
    />
  </svg>
`,PresentationFullScreenIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M15.25 4C15.25 3.58579 15.5858 3.25 16 3.25H20C20.4142 3.25 20.75 3.58579 20.75 4V8C20.75 8.41421 20.4142 8.75 20 8.75C19.5858 8.75 19.25 8.41421 19.25 8V5.81066L15.0303 10.0303C14.7374 10.3232 14.2626 10.3232 13.9697 10.0303C13.6768 9.73744 13.6768 9.26256 13.9697 8.96967L18.1893 4.75H16C15.5858 4.75 15.25 4.41421 15.25 4ZM10.0303 13.9697C10.3232 14.2626 10.3232 14.7374 10.0303 15.0303L5.81066 19.25H8C8.41421 19.25 8.75 19.5858 8.75 20C8.75 20.4142 8.41421 20.75 8 20.75H4C3.58579 20.75 3.25 20.4142 3.25 20V16C3.25 15.5858 3.58579 15.25 4 15.25C4.41421 15.25 4.75 15.5858 4.75 16V18.1893L8.96967 13.9697C9.26256 13.6768 9.73744 13.6768 10.0303 13.9697Z"
    />
  </svg>
`,PresentationExitFullScreenIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M20.5303 3.46967C20.8232 3.76256 20.8232 4.23744 20.5303 4.53033L16.3107 8.75H18.5C18.9142 8.75 19.25 9.08579 19.25 9.5C19.25 9.91421 18.9142 10.25 18.5 10.25H14.5C14.0858 10.25 13.75 9.91421 13.75 9.5V5.5C13.75 5.08579 14.0858 4.75 14.5 4.75C14.9142 4.75 15.25 5.08579 15.25 5.5V7.68934L19.4697 3.46967C19.7626 3.17678 20.2374 3.17678 20.5303 3.46967ZM5.5 15.25C5.08579 15.25 4.75 14.9142 4.75 14.5C4.75 14.0858 5.08579 13.75 5.5 13.75H9.5C9.91421 13.75 10.25 14.0858 10.25 14.5V18.5C10.25 18.9142 9.91421 19.25 9.5 19.25C9.08579 19.25 8.75 18.9142 8.75 18.5V16.3107L4.53033 20.5303C4.23744 20.8232 3.76256 20.8232 3.46967 20.5303C3.17678 20.2374 3.17678 19.7626 3.46967 19.4697L7.68934 15.25H5.5Z"
      fill="currentColor"
    />
  </svg>
`,FrameOrderAdjustmentIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M11.7543 3.80319C11.953 3.70722 12.1838 3.70359 12.3854 3.79325L20.3048 7.31578C20.5716 7.43446 20.7452 7.69723 20.7498 7.98922C20.7545 8.28122 20.5891 8.54933 20.3262 8.67637L12.2456 12.5802C12.0469 12.6762 11.8161 12.6798 11.6145 12.5901L3.69514 9.06761C3.42831 8.94893 3.25464 8.68616 3.25004 8.39417C3.24544 8.10217 3.41074 7.83406 3.67369 7.70703L11.7543 3.80319ZM12.0936 5.30516L5.78221 8.35425L11.9063 11.0782L18.2177 8.02914L12.0936 5.30516ZM20.6753 11.8653C20.8555 12.2383 20.6992 12.6867 20.3262 12.8669L12.2456 16.7707C12.0469 16.8667 11.8161 16.8703 11.6145 16.7807L3.69514 13.2581C3.31667 13.0898 3.14634 12.6465 3.31468 12.268C3.48302 11.8896 3.92629 11.7192 4.30475 11.8876L11.9063 15.2687L19.6737 11.5162C20.0467 11.336 20.4951 11.4923 20.6753 11.8653ZM20.6753 16.1746C20.8554 16.5476 20.6992 16.996 20.3262 17.1762L12.2456 21.08C12.0469 21.176 11.8161 21.1796 11.6145 21.09L3.69514 17.5674C3.31667 17.3991 3.14633 16.9558 3.31467 16.5773C3.48301 16.1989 3.92629 16.0285 4.30475 16.1969L11.9063 19.578L19.6737 15.8255C20.0467 15.6453 20.4951 15.8016 20.6753 16.1746Z"
    />
  </svg>
`,AutoCompleteArrowIcon=x$1`
  <svg
    width="16"
    height="16"
    viewBox="0 0 16 16"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M11.6717 7.3309C11.4683 7.51769 11.152 7.50423 10.9652 7.30084L8.50016 4.61665L8.50016 12.6663C8.50016 12.9425 8.2763 13.1663 8.00016 13.1663C7.72402 13.1663 7.50016 12.9425 7.50016 12.6663L7.50016 4.61665L5.03509 7.30084C4.84831 7.50423 4.53201 7.51769 4.32862 7.3309C4.12524 7.14412 4.11178 6.82782 4.29856 6.62444L7.6319 2.99481C7.72659 2.8917 7.86017 2.83301 8.00016 2.83301C8.14015 2.83301 8.27373 2.8917 8.36842 2.99481L11.7018 6.62443C11.8885 6.82782 11.8751 7.14412 11.6717 7.3309Z"
    />
  </svg>
`,ImageSVG=b$1`<path
  fill-rule="evenodd"
  clip-rule="evenodd"
  fill="currentColor"
  d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V16V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V14V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 18V16.3107L9.11612 11.9445C9.60427 11.4564 10.3957 11.4564 10.8839 11.9445L13.4697 14.5303L15.4697 16.5303C15.7626 16.8232 16.2374 16.8232 16.5303 16.5303C16.8232 16.2374 16.8232 15.7626 16.5303 15.4697L15.0607 14L16.1161 12.9445C16.6043 12.4564 17.3957 12.4564 17.8839 12.9445L19.25 14.3107V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18ZM11.9445 10.8839L14 12.9393L15.0555 11.8839C16.1294 10.8099 17.8706 10.8099 18.9445 11.8839L19.25 12.1893V6C19.25 5.30964 18.6904 4.75 18 4.75H6C5.30964 4.75 4.75 5.30964 4.75 6V14.1893L8.05546 10.8839C9.1294 9.80994 10.8706 9.80994 11.9445 10.8839ZM14 9C14.5523 9 15 8.55228 15 8C15 7.44772 14.5523 7 14 7C13.4477 7 13 7.44772 13 8C13 8.55228 13.4477 9 14 9Z"
/>`,ImageIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  ${ImageSVG}
</svg>`,ImageIcon20=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  ${ImageSVG}
</svg>`,EmbedIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_3334_82005)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M5.144 3.54166H14.856C15.3035 3.54166 15.6722 3.54165 15.9726 3.56312C16.2832 3.58533 16.5712 3.63292 16.8445 3.75478C17.2675 3.94339 17.6272 4.25139 17.8584 4.64842C18.0131 4.91401 18.0726 5.19494 18.0996 5.48406C18.125 5.75652 18.125 6.08757 18.125 6.47237V13.5276C18.125 13.9124 18.125 14.2435 18.0996 14.5159C18.0726 14.8051 18.0131 15.086 17.8584 15.3516C17.6272 15.7486 17.2675 16.0566 16.8445 16.2452C16.5712 16.3671 16.2832 16.4147 15.9726 16.4369C15.6722 16.4583 15.3034 16.4583 14.856 16.4583H5.144C4.69656 16.4583 4.32777 16.4583 4.02744 16.4369C3.71685 16.4147 3.42883 16.3671 3.15552 16.2452C2.73246 16.0566 2.37275 15.7486 2.14156 15.3516C1.9869 15.086 1.92741 14.8051 1.90042 14.5159C1.87497 14.2435 1.87499 13.9124 1.875 13.5276V6.4724C1.87499 6.08759 1.87497 5.75652 1.90042 5.48406C1.92741 5.19494 1.9869 4.91401 2.14156 4.64842C2.37275 4.25139 2.73247 3.94339 3.15552 3.75478C3.42883 3.63292 3.71685 3.58533 4.02744 3.56312C4.32777 3.54165 4.69655 3.54166 5.144 3.54166ZM3.125 8.4375V13.5C3.125 13.9201 3.12563 14.1923 3.145 14.3997C3.16342 14.597 3.19476 14.6762 3.22176 14.7226C3.31014 14.8743 3.46036 15.0125 3.66452 15.1035C3.74772 15.1406 3.87132 15.1725 4.11657 15.1901C4.36702 15.208 4.69092 15.2083 5.16667 15.2083H14.8333C15.3091 15.2083 15.633 15.208 15.8834 15.1901C16.1287 15.1725 16.2523 15.1406 16.3355 15.1035C16.5396 15.0125 16.6899 14.8743 16.7782 14.7226C16.8052 14.6762 16.8366 14.597 16.855 14.3997C16.8744 14.1923 16.875 13.9201 16.875 13.5V8.4375H3.125ZM16.875 7.1875H3.125V6.5C3.125 6.07986 3.12563 5.80768 3.145 5.60027C3.16342 5.40303 3.19476 5.3238 3.22176 5.27744C3.31014 5.12566 3.46036 4.98747 3.66452 4.89645C3.74772 4.85935 3.87132 4.82748 4.11657 4.80994C4.36702 4.79204 4.69092 4.79166 5.16667 4.79166H14.8333C15.3091 4.79166 15.633 4.79204 15.8834 4.80994C16.1287 4.82748 16.2523 4.85935 16.3355 4.89645C16.5396 4.98747 16.6899 5.12566 16.7782 5.27744C16.8052 5.3238 16.8366 5.40303 16.855 5.60027C16.8744 5.80768 16.875 6.07986 16.875 6.5V7.1875Z"
        fill="currentColor"
      />
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M8.86926 9.56896C9.10731 9.81892 9.09766 10.2145 8.8477 10.4526L7.57292 11.6667L8.8477 12.8807C9.09766 13.1188 9.10731 13.5144 8.86926 13.7644C8.6312 14.0143 8.23559 14.024 7.98563 13.7859L6.23563 12.1193C6.11177 12.0013 6.04167 11.8377 6.04167 11.6667C6.04167 11.4956 6.11177 11.332 6.23563 11.2141L7.98563 9.54741C8.23559 9.30936 8.6312 9.31901 8.86926 9.56896ZM11.1307 9.56896C11.3688 9.31901 11.7644 9.30936 12.0144 9.54741L13.7644 11.2141C13.8882 11.332 13.9583 11.4956 13.9583 11.6667C13.9583 11.8377 13.8882 12.0013 13.7644 12.1193L12.0144 13.7859C11.7644 14.024 11.3688 14.0143 11.1307 13.7644C10.8927 13.5144 10.9023 13.1188 11.1523 12.8807L12.4271 11.6667L11.1523 10.4526C10.9023 10.2145 10.8927 9.81892 11.1307 9.56896Z"
        fill="currentColor"
      />
      <path
        d="M5.08333 6.04166C5.08333 6.38684 4.80351 6.66666 4.45833 6.66666C4.11316 6.66666 3.83333 6.38684 3.83333 6.04166C3.83333 5.69649 4.11316 5.41666 4.45833 5.41666C4.80351 5.41666 5.08333 5.69649 5.08333 6.04166Z"
        fill="currentColor"
      />
      <path
        d="M6.75008 6.04166C6.75008 6.38684 6.47026 6.66666 6.12508 6.66666C5.77991 6.66666 5.50008 6.38684 5.50008 6.04166C5.50008 5.69649 5.77991 5.41666 6.12508 5.41666C6.47026 5.41666 6.75008 5.69649 6.75008 6.04166Z"
        fill="currentColor"
      />
      <path
        d="M8.41675 6.04166C8.41675 6.38684 8.13693 6.66666 7.79175 6.66666C7.44657 6.66666 7.16675 6.38684 7.16675 6.04166C7.16675 5.69649 7.44657 5.41666 7.79175 5.41666C8.13693 5.41666 8.41675 5.69649 8.41675 6.04166Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_3334_82005">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,BookmarkIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5 3.25C3.48122 3.25 2.25 4.48122 2.25 6V13C2.25 13.4142 2.58579 13.75 3 13.75C3.41421 13.75 3.75 13.4142 3.75 13V6C3.75 5.30964 4.30964 4.75 5 4.75H19C19.6904 4.75 20.25 5.30964 20.25 6V18C20.25 18.6904 19.6904 19.25 19 19.25H12C11.5858 19.25 11.25 19.5858 11.25 20C11.25 20.4142 11.5858 20.75 12 20.75H19C20.5188 20.75 21.75 19.5188 21.75 18V6C21.75 4.48122 20.5188 3.25 19 3.25H5ZM9.11612 13.1161C9.60427 12.628 10.3957 12.628 10.8839 13.1161C11.372 13.6043 11.372 14.3957 10.8839 14.8839L8.88388 16.8839C8.39573 17.372 7.60427 17.372 7.11612 16.8839C6.82322 16.591 6.34835 16.591 6.05546 16.8839C5.76256 17.1768 5.76256 17.6517 6.05546 17.9445C7.1294 19.0185 8.8706 19.0185 9.94454 17.9445L11.9445 15.9445C13.0185 14.8706 13.0185 13.1294 11.9445 12.0555C10.8706 10.9815 9.1294 10.9815 8.05546 12.0555L7.50565 12.6053C7.21276 12.8982 7.21276 13.373 7.50565 13.6659C7.79854 13.9588 8.27342 13.9588 8.56631 13.6659L9.11612 13.1161ZM6.11612 16.1161C6.60427 15.628 7.39573 15.628 7.88388 16.1161C8.17678 16.409 8.65165 16.409 8.94454 16.1161C9.23744 15.8232 9.23744 15.3483 8.94454 15.0555C7.8706 13.9815 6.1294 13.9815 5.05546 15.0555L3.05546 17.0555C1.98151 18.1294 1.98151 19.8706 3.05546 20.9445C4.1294 22.0185 5.8706 22.0185 6.94454 20.9445L7.49532 20.3938C7.78822 20.1009 7.78822 19.626 7.49533 19.3331C7.20243 19.0402 6.72756 19.0402 6.43467 19.3331L5.88388 19.8839C5.39573 20.372 4.60427 20.372 4.11612 19.8839C3.62796 19.3957 3.62796 18.6043 4.11612 18.1161L6.11612 16.1161Z"
  />
</svg>`,PenIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M19.2786 4.72105C18.6493 4.09298 17.6284 4.09298 16.9991 4.72105L16.1143 5.60408L18.3917 7.87702L19.2786 6.9919C19.9071 6.36465 19.9071 5.3483 19.2786 4.72105ZM17.33 8.93664L15.0526 6.6637L4.24997 17.4451V19.7501H6.49531L17.33 8.93664ZM15.9395 3.65934C17.1543 2.44689 19.1234 2.44689 20.3382 3.65934C21.5539 4.87262 21.5539 6.84033 20.3382 8.05361L7.33534 21.0309C7.19473 21.1712 7.00419 21.2501 6.80554 21.2501H3.49997C3.08576 21.2501 2.74997 20.9143 2.74997 20.5001V17.134C2.74997 16.9348 2.82919 16.7438 2.97016 16.6032L15.9395 3.65934Z"
  />
</svg> `,HandIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill="currentColor"
    d="M14.7333 20.7491C13.2101 20.7188 11.7085 20.3814 10.318 19.757L4.87829 17.1973C4.34611 16.9441 3.93572 16.4896 3.73708 15.9334C3.53844 15.3772 3.56776 14.7647 3.81861 14.2301C4.0693 13.697 4.52083 13.2855 5.07393 13.0862C5.62702 12.8869 6.2364 12.916 6.76806 13.1673L7.78359 13.6455C7.30673 12.0247 6.35302 9.34093 4.92245 7.7732L4.03938 7.05577C3.61069 6.70638 3.33352 6.20406 3.26602 5.65417C3.19852 5.10429 3.34593 4.54956 3.67732 4.1063C4.01168 3.66165 4.50487 3.3643 5.05324 3.27676C5.60161 3.18922 6.16247 3.3183 6.61794 3.63687C7.68536 4.4013 8.62184 5.33461 9.39078 6.40032C9.65039 6.01099 10.0282 5.71593 10.4681 5.55889C10.7401 5.45759 11.0297 5.41243 11.3196 5.42613C11.6094 5.43983 11.8935 5.51209 12.1548 5.6386C12.3904 5.74876 12.6054 5.89855 12.7906 6.08146C13.0286 5.81011 13.3329 5.60559 13.6737 5.48803C13.9277 5.39526 14.1977 5.35453 14.4676 5.36822C14.7376 5.38191 15.0021 5.44975 15.2455 5.56774C15.5246 5.6943 15.7698 5.88556 15.9608 6.12575C16.0596 6.06152 16.1665 6.01088 16.2787 5.97518C16.6663 5.83573 17.0933 5.85626 17.4658 6.0323C17.8384 6.20833 18.126 6.52546 18.2656 6.91405L20.3762 12.7953C20.8746 14.2018 20.8746 15.7376 20.3762 17.1442C20.1126 17.8897 19.6865 18.5667 19.1289 19.126C18.5713 19.6853 17.8962 20.1127 17.153 20.3771C16.373 20.6365 15.555 20.7623 14.7333 20.7491ZM5.93087 14.3364C5.80289 14.3092 5.61036 14.3014 5.51411 14.3364C5.40235 14.3749 5.29944 14.4355 5.21147 14.5146C5.12349 14.5937 5.05223 14.6898 5.00192 14.797C4.95016 14.9037 4.92031 15.0197 4.91412 15.1382C4.90793 15.2567 4.92553 15.3752 4.96589 15.4867C5.00625 15.5983 5.06854 15.7005 5.14906 15.7874C5.22958 15.8744 5.32669 15.9442 5.43463 15.9927L10.839 18.6056C10.839 18.6056 14.0357 20.0936 16.6673 19.1459C17.2293 18.9564 17.7408 18.6409 18.1632 18.2235C18.5855 17.8061 18.9074 17.2976 19.1045 16.7367C19.5014 15.6227 19.5014 14.4053 19.1045 13.2913L16.9852 7.41005C16.9763 7.38088 16.9615 7.35386 16.9418 7.33069C16.922 7.30751 16.8977 7.28868 16.8703 7.27537C16.843 7.26207 16.8131 7.25458 16.7828 7.25337C16.7524 7.25216 16.7221 7.25725 16.6938 7.26833C16.6381 7.29017 16.5931 7.33292 16.5684 7.38751C16.5436 7.44209 16.5411 7.50419 16.5613 7.56062L16.8615 8.44635C16.8967 8.53035 16.9142 8.62071 16.913 8.71179C16.9118 8.80288 16.892 8.89274 16.8547 8.97581C16.8175 9.05888 16.7635 9.13337 16.6964 9.19466C16.6292 9.25595 16.5501 9.30272 16.4642 9.33207C16.3804 9.36729 16.2903 9.38486 16.1995 9.38368C16.1087 9.38251 16.0191 9.36261 15.9363 9.32523C15.8535 9.28785 15.7792 9.23378 15.7181 9.16639C15.657 9.099 15.6104 9.01973 15.5811 8.9335L14.9983 7.30377C14.9265 7.12321 14.7915 6.97517 14.6185 6.88748C14.5305 6.8502 14.4359 6.831 14.3404 6.831C14.2448 6.831 14.1502 6.8502 14.0622 6.88748C13.8857 6.94651 13.7386 7.07145 13.6514 7.23637C13.5643 7.40129 13.5438 7.59353 13.5942 7.7732L13.8414 8.70321C13.8851 8.86876 13.8624 9.04485 13.7782 9.19382C13.694 9.3428 13.5551 9.45282 13.3911 9.50036C13.2294 9.55136 13.0543 9.53738 12.9028 9.46137C12.7512 9.38535 12.635 9.25324 12.5787 9.09292L11.9958 7.48091C11.9143 7.26388 11.7512 7.08756 11.5415 6.98985C11.3318 6.89214 11.0923 6.88083 10.8743 6.95834C10.658 7.04009 10.4822 7.20369 10.3848 7.41402C10.2873 7.62435 10.276 7.86461 10.3533 8.08319L10.7772 9.27008C10.8123 9.35408 10.8298 9.44443 10.8287 9.53551C10.8275 9.6266 10.8076 9.71646 10.7704 9.79953C10.7331 9.8826 10.6792 9.95709 10.612 10.0184C10.5448 10.0797 10.4658 10.1264 10.3798 10.1558C10.2961 10.191 10.206 10.2086 10.1152 10.2074C10.0244 10.2062 9.93476 10.1863 9.85194 10.1489C9.76912 10.1116 9.69485 10.0575 9.63374 9.99012C9.57264 9.92273 9.52601 9.84345 9.49675 9.75721C8.77492 7.80197 7.47469 6.11463 5.7702 4.92117C5.60002 4.79896 5.38865 4.74903 5.18198 4.78219C4.97531 4.81536 4.79003 4.92895 4.66636 5.09831C4.5387 5.26644 4.54989 5.42432 4.5746 5.63419C4.59932 5.84407 4.70436 6.0361 4.86755 6.16977L5.75062 6.91377L5.81244 6.97577C8.22322 9.57094 9.34471 14.6373 9.38886 14.8499C9.41539 14.9719 9.40709 15.0989 9.36492 15.2164C9.32275 15.3339 9.24841 15.4371 9.15044 15.5142C9.05374 15.5891 8.93848 15.6361 8.8171 15.6501C8.69571 15.6642 8.57281 15.6447 8.46164 15.5939L6.92105 14.797C6.5371 14.5875 6.45627 14.5146 5.93087 14.3364Z"
  />
</svg> `,SquareIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M2.70825 2.70898H17.2916V17.2923H2.70825V2.70898ZM3.95825 3.95898V16.0423H16.0416V3.95898H3.95825Z"
  />
</svg> `,EllipseIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M10 3.125C6.20304 3.125 3.125 6.20304 3.125 10C3.125 13.797 6.20304 16.875 10 16.875C13.797 16.875 16.875 13.797 16.875 10C16.875 6.20304 13.797 3.125 10 3.125ZM1.875 10C1.875 5.51269 5.51269 1.875 10 1.875C14.4873 1.875 18.125 5.51269 18.125 10C18.125 14.4873 14.4873 18.125 10 18.125C5.51269 18.125 1.875 14.4873 1.875 10Z"
  />
</svg>`,DiamondIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M10.0001 1.61523L18.384 9.99912L10.0001 18.383L1.61621 9.99912L10.0001 1.61523ZM3.38398 9.99912L10.0001 16.6152L16.6162 9.99912L10.0001 3.383L3.38398 9.99912Z"
  />
</svg>`,TriangleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M10.0001 2.08398L18.2995 16.459H1.70068L10.0001 2.08398ZM10.0001 4.58398L3.86575 15.209H16.1344L10.0001 4.58398Z"
  />
</svg>`,RoundedRectangleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M1.875 14.1673C1.875 15.433 2.90101 16.459 4.16667 16.459H15.8333C17.099 16.459 18.125 15.433 18.125 14.1673V5.83398C18.125 4.56833 17.099 3.54232 15.8333 3.54232H4.16667C2.90101 3.54232 1.875 4.56833 1.875 5.83398V14.1673ZM4.16667 15.209C3.59137 15.209 3.125 14.7426 3.125 14.1673V5.83398C3.125 5.25869 3.59137 4.79232 4.16667 4.79232H15.8333C16.4086 4.79232 16.875 5.25869 16.875 5.83398V14.1673C16.875 14.7426 16.4086 15.209 15.8333 15.209H4.16667Z"
  />
</svg>`,ScribbledSquareIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.45993 3.83639C2.64271 3.81446 2.80866 3.94487 2.83059 4.12765C2.92285 4.89681 3.01537 5.61006 3.10321 6.28727C3.55933 9.80379 3.88941 12.3486 3.40424 16.7043C3.38386 16.8872 3.21901 17.019 3.03605 16.9986C2.85309 16.9783 2.72129 16.8134 2.74167 16.6304C3.21749 12.3587 2.89776 9.89136 2.44329 6.38415C2.3552 5.70441 2.26206 4.98561 2.16867 4.20705C2.14674 4.02427 2.27714 3.85832 2.45993 3.83639Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M14.6788 16.6731C13.5378 16.6615 12.1261 16.6616 11.0279 16.7078C9.45128 16.7741 7.43455 16.9812 5.80651 17.1726C4.99366 17.2682 4.27987 17.3596 3.76935 17.4271C3.51411 17.4609 3.30974 17.4887 3.16929 17.508L3.00817 17.5303L2.95355 17.538L2.90588 17.2081L2.85912 16.878L2.91585 16.8701L3.07845 16.8475C3.21994 16.8281 3.42545 16.8001 3.68194 16.7662C4.19488 16.6984 4.91194 16.6066 5.72866 16.5105C7.35976 16.3187 9.39704 16.1091 10.9999 16.0417C12.1163 15.9947 13.5424 15.9948 14.6856 16.0065C15.258 16.0123 15.761 16.0211 16.1209 16.0284C16.3009 16.032 16.4451 16.0353 16.5445 16.0377L16.6586 16.0405L16.6978 16.0415L16.6895 16.3747L16.6805 16.708L16.6416 16.7069L16.5285 16.7042C16.4299 16.7018 16.2865 16.6985 16.1074 16.6949C15.7492 16.6876 15.2485 16.6789 14.6788 16.6731ZM17.0228 16.3837C17.0178 16.5677 16.8646 16.7129 16.6805 16.708L16.6895 16.3747L16.6978 16.0415C16.8819 16.0465 17.0277 16.1997 17.0228 16.3837ZM2.57586 17.2549C2.54999 17.0727 2.67685 16.9039 2.85912 16.878L2.90588 17.2081L2.95355 17.538C2.77128 17.5639 2.60173 17.4372 2.57586 17.2549Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M16.2785 3.00004C16.4626 2.99705 16.6142 3.14384 16.6172 3.32791L16.2839 3.33333L15.9506 3.33875C15.9476 3.15468 16.0944 3.00304 16.2785 3.00004ZM15.8785 17.5L15.5461 17.4759L15.5604 17.2746C15.5695 17.1442 15.5827 16.9546 15.5988 16.7179C15.631 16.2445 15.6746 15.5827 15.7206 14.8294C15.8126 13.3217 15.9136 11.4516 15.9507 9.99154C15.9836 8.69575 15.9836 7.03343 15.9754 5.69274C15.9712 5.02289 15.9651 4.43425 15.9599 4.01309C15.9573 3.80252 15.955 3.63385 15.9533 3.51786L15.9506 3.33875L16.2839 3.33333L16.6172 3.32791L16.6199 3.50823C16.6216 3.62466 16.6239 3.79382 16.6265 4.00493C16.6317 4.42711 16.6379 5.01714 16.642 5.68864C16.6503 7.03063 16.6503 8.70165 16.6171 10.0085C16.5797 11.4809 16.4781 13.3608 16.386 14.87C16.3399 15.6251 16.2962 16.2885 16.2639 16.7631C16.2478 17.0004 16.2346 17.1905 16.2254 17.3214L16.211 17.5232L15.8785 17.5ZM15.8785 17.5L15.5461 17.4759C15.5327 17.6595 15.6708 17.8192 15.8544 17.8325C16.038 17.8458 16.1977 17.7077 16.211 17.5241L15.8785 17.5Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.8222 4.25378L17.8204 4.26045L17.8149 4.2812L17.7936 4.36248C17.7751 4.43352 17.7485 4.53713 17.7161 4.66674C17.6512 4.92604 17.5634 5.28896 17.4713 5.70299C17.2862 6.53525 17.0878 7.55848 17.0216 8.36138C16.9302 9.47192 16.9847 10.3393 17.0561 11.223C17.0633 11.3116 17.0706 11.4004 17.078 11.4898C17.1443 12.2918 17.2137 13.1322 17.1847 14.1766C17.1687 14.7528 17.1279 15.4868 17.0913 16.0741C17.073 16.3683 17.0556 16.6267 17.0429 16.8116C17.0365 16.9041 17.0312 16.9782 17.0276 17.0292L17.0219 17.1081L16.6894 17.084L16.357 17.0596L16.3626 16.9817C16.3662 16.9312 16.3714 16.8576 16.3778 16.7657C16.3905 16.5819 16.4077 16.325 16.4259 16.0326C16.4624 15.4467 16.5027 14.7223 16.5183 14.1581C16.5462 13.1522 16.4798 12.3467 16.4135 11.5437C16.4062 11.4547 16.3988 11.3658 16.3916 11.2767C16.3193 10.3821 16.2613 9.47185 16.3572 8.30666C16.4273 7.45607 16.6342 6.39597 16.8205 5.55827C16.9141 5.13732 17.0034 4.7686 17.0693 4.50502C17.1023 4.37318 17.1294 4.26753 17.1484 4.19467L17.1704 4.11077L17.1762 4.08879L17.1781 4.08154C17.2259 3.90374 17.4089 3.79769 17.5867 3.84542C17.7645 3.89315 17.8699 4.07598 17.8222 4.25378ZM16.6894 17.084L16.357 17.0596C16.3435 17.2432 16.4814 17.403 16.665 17.4165C16.8486 17.4299 17.0084 17.2917 17.0219 17.1081L16.6894 17.084Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.17283 3.02528C2.20726 2.84434 2.38177 2.72526 2.5626 2.75931L2.50025 3.08692L2.43789 3.41454C2.25707 3.38049 2.13839 3.20622 2.17283 3.02528ZM16.7595 4.58093L16.7545 4.91426L16.7174 4.91377L16.6111 4.91221C16.5186 4.9108 16.3842 4.9086 16.2166 4.90547C15.8815 4.89921 15.4131 4.88922 14.8802 4.87428C13.8159 4.84446 12.4887 4.79477 11.451 4.71525C9.67135 4.57888 7.41581 4.25301 5.61119 3.96257C4.70758 3.81715 3.91464 3.68021 3.34754 3.57961C3.06396 3.52931 2.83678 3.48809 2.68039 3.45942C2.60219 3.44508 2.54168 3.43388 2.50067 3.42626L2.43789 3.41454C2.43784 3.41453 2.43789 3.41454 2.50025 3.08692L2.5626 2.75931L2.62388 2.77075C2.66438 2.77828 2.72434 2.78937 2.80196 2.80361C2.95722 2.83207 3.18314 2.87307 3.46534 2.92312C4.0298 3.02325 4.81916 3.15957 5.7185 3.30431C7.51977 3.59421 9.75269 3.91632 11.5034 4.05047C12.5242 4.1287 13.8381 4.17805 14.9003 4.20782C15.4307 4.22268 15.8969 4.23263 16.2305 4.23886C16.3973 4.24197 16.5309 4.24416 16.6228 4.24556L16.7281 4.24711L16.7638 4.24758L16.7595 4.58093ZM16.7595 4.58093L16.7545 4.91426C16.9386 4.91657 17.09 4.76919 17.0927 4.5851C17.0954 4.401 16.9479 4.24989 16.7638 4.24758L16.7595 4.58093Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5.28443 2.99528C6.67178 2.78395 8.41647 2.57209 9.79924 2.58239C11.1018 2.59209 12.7438 2.80384 14.0493 3.01027C14.7044 3.11385 15.2791 3.21681 15.6901 3.29389C15.8957 3.33244 16.0604 3.36454 16.174 3.38705C16.2308 3.3983 16.2747 3.40715 16.3046 3.41322L16.3387 3.42017L16.3499 3.42246C16.3499 3.42247 16.3508 3.42264 16.2832 3.74905L16.2156 4.07546L16.2049 4.07326L16.1721 4.06658C16.1432 4.06071 16.1001 4.05205 16.0444 4.041C15.9328 4.01889 15.7703 3.98723 15.5672 3.94914C15.1609 3.87294 14.5926 3.77113 13.9452 3.66876C12.6456 3.46327 11.0445 3.25835 9.79428 3.24904C8.46713 3.23916 6.7659 3.44397 5.38482 3.65435C4.69677 3.75916 4.09275 3.86462 3.66085 3.94386C3.44495 3.98348 3.2722 4.01651 3.15363 4.0396C3.09434 4.05115 3.04861 4.0602 3.01781 4.06635L2.98298 4.07334L2.97218 4.07553L2.90493 3.74905C2.83827 3.42245 2.83831 3.42244 2.83836 3.42243L2.85104 3.41986L2.8873 3.41259C2.91908 3.40624 2.96584 3.39698 3.0262 3.38523C3.1469 3.36172 3.32204 3.32823 3.54054 3.28814C3.97744 3.20798 4.58826 3.10133 5.28443 2.99528ZM2.90493 3.74905L2.83836 3.42243C2.65798 3.45925 2.54151 3.63533 2.57833 3.81571C2.61514 3.99608 2.7918 4.11234 2.97218 4.07553L2.90493 3.74905ZM16.6096 3.81662C16.5723 3.99689 16.3959 4.11278 16.2156 4.07546L16.2832 3.74905L16.3508 3.42264C16.531 3.45996 16.6469 3.63635 16.6096 3.81662Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.28464 4.25107C3.46815 4.23644 3.62878 4.37334 3.64341 4.55685L3.31113 4.58335L2.97886 4.60985C2.96422 4.42634 3.10112 4.26571 3.28464 4.25107ZM4.12194 17.0834L3.78903 17.1002L3.77925 16.9095C3.77288 16.7861 3.76358 16.6067 3.75184 16.3828C3.72836 15.9349 3.69511 15.3089 3.65607 14.5966C3.57795 13.1716 3.47669 11.4024 3.38395 10.0224C3.31295 8.96574 3.2117 7.61287 3.12814 6.52347C3.08637 5.97892 3.04905 5.50047 3.02217 5.15816L2.97886 4.60985L3.31113 4.58335L3.64341 4.55685L3.68679 5.10597C3.71369 5.44858 3.75105 5.92744 3.79285 6.47249C3.87644 7.56228 3.97789 8.91775 4.04912 9.97767C4.14215 11.362 4.24359 13.1346 4.32174 14.5601C4.36082 15.2731 4.39409 15.8996 4.41759 16.3479C4.42935 16.572 4.43866 16.7516 4.44503 16.8752L4.4548 17.0656L4.12194 17.0834ZM4.12194 17.0834L3.78903 17.1002C3.79838 17.2841 3.95501 17.4256 4.13887 17.4163C4.32272 17.4069 4.46415 17.2495 4.4548 17.0656L4.12194 17.0834Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5.60257 16.7254C6.90834 16.7169 8.53454 16.7169 9.80648 16.751C11.2396 16.7895 13.0691 16.894 14.5375 16.9886C15.2723 17.036 15.9178 17.0809 16.3797 17.1141C16.6106 17.1306 16.7956 17.1442 16.923 17.1537L17.1194 17.1685L17.0948 17.5009L17.0693 17.8333L16.8735 17.8185C16.7467 17.8091 16.5623 17.7956 16.332 17.779C15.8714 17.746 15.2275 17.7011 14.4947 17.6539C13.0278 17.5594 11.2086 17.4555 9.78861 17.4174C8.52831 17.3836 6.91129 17.3836 5.60691 17.3921C4.95524 17.3963 4.38257 17.4027 3.97284 17.408C3.76798 17.4106 3.60389 17.413 3.49105 17.4147L3.31753 17.4175L3.31112 17.0842L3.30545 16.7509L3.48089 16.7481C3.59419 16.7464 3.7588 16.744 3.96421 16.7414C4.37503 16.7361 4.94916 16.7297 5.60257 16.7254ZM3.31112 17.0842L3.30545 16.7509C3.12138 16.7541 2.97467 16.9059 2.97783 17.09C2.981 17.274 3.13346 17.4207 3.31753 17.4175L3.31112 17.0842ZM17.4271 17.5263C17.4131 17.7099 17.2529 17.8473 17.0693 17.8333L17.0948 17.5009L17.1202 17.1685C17.3038 17.1826 17.4412 17.3428 17.4271 17.5263Z"
  />
</svg>`,ScribbledEllipseIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.55739 3.93568C7.46902 0.8947 12.2002 1.1564 15.2608 3.91876C16.5142 5.04996 17.2816 6.49066 17.5878 8.01768C18.0083 8.94994 18.234 9.92054 18.249 10.8891C18.2779 12.7636 17.5162 14.6002 15.9043 16.0977C14.392 17.5028 12.5814 18.2375 10.7098 18.2491C9.97219 18.2537 9.22899 18.146 8.49453 17.9255C6.64295 17.767 4.87334 16.9658 3.58343 15.4367C1.676 13.1755 1.2832 10.344 2.28148 7.79433C2.57576 6.38916 3.46976 5.07164 4.55739 3.93568ZM2.42485 10.2275C2.34071 11.9006 2.88716 13.5774 4.093 15.0069C4.3286 15.2861 4.5828 15.5389 4.85254 15.7656C3.68056 14.5772 3.28103 13.0713 3.22018 11.7016C3.04507 11.4605 2.8826 11.214 2.75731 10.9819C2.62124 10.7297 2.51108 10.4781 2.42485 10.2275ZM3.2485 10.4782C2.84526 9.64052 2.76482 8.80019 2.9267 7.97457C3.20512 7.28242 3.59656 6.61183 4.09876 5.98247C6.83382 2.55491 12.419 2.76331 15.4335 6.00168C16.083 6.69948 16.589 7.44767 16.9464 8.21807C17.3965 10.5743 16.656 13.1556 14.8033 14.9846C13.1298 16.6366 10.8047 17.4377 8.61442 17.265C7.6035 16.9502 6.60135 16.3988 5.65306 15.5988C4.68607 14.7829 4.20276 13.7377 4.0001 12.6734C4.13559 12.8295 4.25734 12.9645 4.35215 13.0679C4.41501 13.1364 4.46616 13.1911 4.50176 13.2288L4.54306 13.2724L4.5541 13.2839L4.55706 13.287L4.55788 13.2879C4.6857 13.4204 4.8971 13.4246 5.02959 13.2967C5.16207 13.1689 5.16587 12.9579 5.03807 12.8254C5.03807 12.8254 5.03808 12.8254 5.03807 12.8254L5.03746 12.8248L5.03511 12.8224L5.02535 12.8121L4.98676 12.7714C4.95304 12.7357 4.90399 12.6832 4.84339 12.6172C4.7221 12.485 4.55505 12.2989 4.3723 12.0836C4.21091 11.8934 4.04049 11.6842 3.87965 11.4717C3.87539 11.2461 3.88058 11.0233 3.89318 10.8054C3.9396 10.0027 4.08633 9.28214 4.22199 8.76145C4.2897 8.50157 4.35434 8.29272 4.40167 8.14979C4.42533 8.07836 4.44464 8.02349 4.45781 7.98704C4.4644 7.96882 4.46945 7.95521 4.47274 7.94645L4.47632 7.93698L4.47707 7.93503C4.47705 7.93508 4.47709 7.93498 4.47707 7.93503C4.47705 7.9351 4.4771 7.93496 4.16643 7.81414M12.2502 17.3881C13.3911 17.104 14.4816 16.5096 15.4506 15.6093C16.8479 14.3111 17.5284 12.7623 17.5799 11.1863C17.2636 12.7577 16.4855 14.2608 15.2717 15.459C14.4028 16.3168 13.3632 16.9667 12.2502 17.3881ZM15.4936 5.12111C12.8787 2.70257 8.80143 2.11296 5.76705 3.74252C8.4055 1.71255 12.2223 2.07439 14.8142 4.41366C15.0612 4.63662 15.2876 4.87313 15.4936 5.12111Z"
  />
</svg>`,ScribbledDiamondIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M11.1077 1.89441C11.212 2.04607 11.1737 2.25361 11.022 2.35797L11.0139 2.36353L10.9891 2.38073C10.9672 2.39597 10.9346 2.41866 10.8925 2.44821C10.8083 2.50731 10.686 2.59381 10.5341 2.70295C10.2302 2.9213 9.80858 3.22993 9.33796 3.59077C8.39262 4.31558 7.26483 5.23952 6.49268 6.06158C5.75373 6.84829 4.9324 7.97618 4.29023 8.91779C3.97053 9.38655 3.69777 9.80539 3.50499 10.1069C3.40863 10.2577 3.33233 10.379 3.28022 10.4625C3.25417 10.5042 3.23417 10.5364 3.22074 10.5582L3.20559 10.5827L3.20093 10.5903C3.10482 10.7473 2.89938 10.7971 2.74236 10.701C2.58535 10.6049 2.53598 10.3997 2.63209 10.2427L2.63771 10.2335L2.65361 10.2077C2.66756 10.1852 2.6881 10.152 2.71472 10.1094C2.76796 10.0241 2.84553 9.90079 2.94329 9.74786C3.13876 9.4421 3.41522 9.01758 3.73945 8.54216C4.38514 7.5954 5.23047 6.43162 6.00676 5.60515C6.81794 4.74154 7.98182 3.79048 8.93232 3.06171C9.40961 2.69576 9.83695 2.38295 10.1451 2.16156C10.2992 2.05083 10.4235 1.96289 10.5096 1.90251C10.5526 1.87232 10.586 1.84901 10.6088 1.83319L10.6349 1.81514L10.6434 1.80924C10.6434 1.80921 10.6441 1.80876 10.8331 2.08336L10.6441 1.80876C10.7958 1.7044 11.0033 1.74275 11.1077 1.89441Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M1.82582 10.6214C1.94287 10.4793 2.15295 10.459 2.29504 10.5761L2.0831 10.8333L1.87116 11.0906C1.72907 10.9736 1.70877 10.7635 1.82582 10.6214ZM9.16643 17.9167L8.90914 18.1286L8.88737 18.1022L8.82364 18.0254C8.768 17.9584 8.68686 17.8611 8.58513 17.7399C8.38164 17.4975 8.09589 17.1598 7.76706 16.7791C7.1079 16.0159 6.28112 15.0861 5.5974 14.4024C4.91367 13.7187 3.98383 12.8919 3.22065 12.2327C2.83993 11.9039 2.5023 11.6181 2.25988 11.4146C2.1387 11.3129 2.04135 11.2318 1.97438 11.1761L1.89753 11.1124L1.87116 11.0906L2.0831 10.8333L2.29504 10.5761L2.32245 10.5987L2.40042 10.6634C2.46817 10.7197 2.56638 10.8015 2.68852 10.904C2.93274 11.1091 3.27283 11.3969 3.65642 11.7282C4.42187 12.3893 5.36702 13.2292 6.0688 13.931C6.77058 14.6328 7.61046 15.5779 8.27159 16.3434C8.60291 16.7269 8.89072 17.067 9.09574 17.3113C9.19826 17.4334 9.28012 17.5316 9.33641 17.5993L9.40107 17.6773L9.4233 17.7042L9.16643 17.9167ZM9.16643 17.9167L8.90914 18.1286C9.0262 18.2707 9.23628 18.291 9.37837 18.174C9.52046 18.0569 9.54035 17.8463 9.4233 17.7042L9.16643 17.9167Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.6976 10.1657C17.8365 10.045 18.0471 10.0597 18.1678 10.1987C18.2886 10.3376 18.2739 10.5481 18.1349 10.6689L17.9162 10.4173L17.6976 10.1657ZM9.99958 17.9173L9.76008 17.6855L9.86002 17.5825C9.9246 17.516 10.0185 17.4195 10.1358 17.2992C10.3704 17.0587 10.6989 16.7232 11.0744 16.343C11.8247 15.5834 12.7652 14.6428 13.52 13.9257C14.3177 13.1677 15.3629 12.2271 16.2067 11.4776C16.629 11.1026 17.0016 10.7747 17.2686 10.5406C17.4022 10.4235 17.5093 10.3299 17.5831 10.2654L17.6976 10.1657L17.9162 10.4173L18.1349 10.6689L18.0215 10.7678C17.948 10.8319 17.8412 10.9252 17.7081 11.0419C17.4419 11.2753 17.0704 11.6022 16.6494 11.9761C15.8066 12.7246 14.7684 13.6591 13.9792 14.409C13.2325 15.1184 12.2981 16.0528 11.5487 16.8115C11.1744 17.1905 10.8469 17.525 10.613 17.7648C10.496 17.8846 10.4025 17.9808 10.3382 18.047L10.2395 18.1487L9.99958 17.9173ZM9.99958 17.9173L9.76008 17.6855C9.63205 17.8178 9.63548 18.0288 9.76777 18.1569C9.90005 18.2849 10.1115 18.281 10.2395 18.1487L9.99958 17.9173Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8.86605 1.93879C8.94592 1.77293 9.14513 1.70321 9.31099 1.78308L9.16638 2.08341C9.31099 1.78308 9.31095 1.78306 9.31099 1.78308L9.31301 1.78405L9.31817 1.78655L9.33763 1.79603C9.35457 1.80431 9.37932 1.81647 9.41107 1.83223C9.47457 1.86376 9.56614 1.90976 9.67943 1.9681C9.90588 2.08472 10.2198 2.251 10.57 2.44996C11.2644 2.84444 12.1242 3.37987 12.7228 3.91908C13.7803 4.87171 14.411 5.77009 15.1185 6.77795C15.4184 7.20516 15.7321 7.65205 16.0979 8.13108C16.36 8.47421 16.6824 9.01299 16.9328 9.45249C17.0596 9.67498 17.1707 9.87686 17.2501 10.0231C17.2898 10.0963 17.3217 10.1556 17.3437 10.1968L17.369 10.2444L17.3756 10.257L17.3778 10.2611C17.4636 10.4241 17.4012 10.626 17.2383 10.7117C17.0754 10.7975 16.8738 10.7349 16.7881 10.572C16.7881 10.572 16.7881 10.572 16.7881 10.572L16.7861 10.5682L16.7799 10.5565L16.7555 10.5107C16.7342 10.4708 16.7031 10.4128 16.6642 10.3412C16.5864 10.1978 16.4776 10.0001 16.3536 9.78259C16.1026 9.34207 15.7999 8.83917 15.5681 8.53574C15.1665 8.00993 14.837 7.54007 14.5307 7.10341C13.845 6.12584 13.2759 5.31463 12.2766 4.41441C11.7346 3.92618 10.9278 3.41994 10.2407 3.02962C9.90015 2.83617 9.59455 2.67427 9.37421 2.56079C9.2641 2.50409 9.17545 2.45957 9.11458 2.42934C9.08414 2.41423 9.06066 2.4027 9.04493 2.39501L9.02723 2.38639L9.02293 2.3843L9.02195 2.38383C9.02194 2.38383 9.02196 2.38383 9.02195 2.38383C8.8561 2.30395 8.78618 2.10465 8.86605 1.93879Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.1351 1.77876C10.3033 1.85355 10.379 2.05054 10.3042 2.21876L9.99966 2.08335C10.3042 2.21876 10.3043 2.21867 10.3042 2.21876L10.3038 2.21976L10.303 2.22152L10.3004 2.2273L10.291 2.24778C10.2828 2.26534 10.2709 2.29066 10.255 2.32333C10.2233 2.38866 10.1759 2.48339 10.1117 2.60425C9.9834 2.84595 9.78793 3.19226 9.51656 3.61699C8.97388 4.46634 8.12722 5.63001 6.90645 6.89788C5.76129 8.08722 4.70343 8.93382 3.92952 9.48433C3.54251 9.75963 3.22631 9.96102 3.00544 10.0943C2.89499 10.161 2.80836 10.2106 2.7486 10.244C2.71871 10.2607 2.69555 10.2733 2.67948 10.2819L2.66074 10.2919L2.65545 10.2947L2.65384 10.2955L2.65309 10.2959C2.65301 10.296 2.65293 10.296 2.49966 10L2.65309 10.2959C2.48961 10.3806 2.2883 10.3168 2.20366 10.1533C2.11903 9.98984 2.18288 9.78875 2.34627 9.70407C2.34623 9.70409 2.34631 9.70405 2.34627 9.70407L2.34968 9.70228L2.36383 9.69474C2.37682 9.68775 2.39686 9.67685 2.42359 9.66193C2.47703 9.63209 2.55716 9.5862 2.66095 9.52356C2.86854 9.39827 3.17066 9.206 3.54309 8.94108C4.28804 8.41117 5.31352 7.5911 6.42621 6.43548C7.61256 5.20335 8.43257 4.07535 8.95477 3.25804C9.21585 2.84943 9.40237 2.51866 9.52292 2.29161C9.5832 2.1781 9.62696 2.09053 9.6553 2.03217C9.66947 2.00298 9.67978 1.9811 9.68636 1.96693L9.69346 1.9515L9.69495 1.94821C9.76978 1.78008 9.9669 1.70399 10.1351 1.77876Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.20044 11.1035C2.28101 10.938 2.48051 10.8691 2.64604 10.9497L2.65448 10.9538L2.67799 10.9654C2.69853 10.9755 2.72864 10.9904 2.76738 11.0097C2.84485 11.0484 2.95685 11.1047 3.09572 11.176C3.37337 11.3186 3.75901 11.5212 4.19138 11.7614C5.05137 12.2392 6.11398 12.8756 6.87603 13.4899C7.75522 14.1987 8.71011 15.2618 9.43707 16.1347C9.80256 16.5736 10.1142 16.969 10.3345 17.2547C10.4447 17.3977 10.5322 17.5133 10.5923 17.5934C10.6223 17.6335 10.6455 17.6647 10.6613 17.686L10.6793 17.7104L10.684 17.7167L10.6852 17.7184C10.6853 17.7185 10.6857 17.7191 10.4168 17.9161L10.6857 17.7191C10.7945 17.8676 10.7623 18.0762 10.6138 18.185C10.4653 18.2938 10.2567 18.2616 10.1479 18.1131C10.1479 18.1131 10.1479 18.1131 10.1479 18.1131L10.1425 18.1057L10.1256 18.0828C10.1105 18.0625 10.0881 18.0324 10.0589 17.9934C10.0004 17.9154 9.91477 17.8021 9.80657 17.6618C9.59008 17.381 9.28376 16.9924 8.92478 16.5613C8.20281 15.6944 7.2827 14.6741 6.45761 14.0089C5.74236 13.4323 4.72163 12.8186 3.86761 12.3442C3.44298 12.1083 3.06395 11.9092 2.79118 11.7691C2.65485 11.6991 2.54519 11.6439 2.46982 11.6063C2.43213 11.5875 2.40303 11.5731 2.38345 11.5635L2.36135 11.5526L2.3546 11.5493"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M11.1157 2.32268C11.1157 2.32267 11.1157 2.32268 11.1157 2.32268L11.1168 2.32437L11.1208 2.33079L11.1378 2.35749C11.1531 2.38131 11.1762 2.417 11.2067 2.46344C11.2679 2.55632 11.3589 2.69213 11.4775 2.86197C11.7147 3.20175 12.0615 3.67705 12.4984 4.21674C13.3744 5.29881 14.6027 6.6276 16.0268 7.64481C16.362 7.88419 16.7818 8.19911 17.1162 8.45286C17.2837 8.58001 17.4305 8.69231 17.5354 8.77284L17.6588 8.86774L17.7036 8.90235L17.4997 9.16606L17.2958 9.42971L17.2518 9.39574L17.1294 9.30165C17.0253 9.2217 16.8795 9.11016 16.7132 8.98393C16.3797 8.7309 15.9662 8.42081 15.6393 8.1873C14.1468 7.12119 12.8751 5.74164 11.9802 4.63621C11.5317 4.08215 11.1754 3.5939 10.9308 3.24358C10.8085 3.06837 10.714 2.92749 10.6498 2.82994C10.6177 2.78116 10.5932 2.7432 10.5765 2.71718L10.5575 2.68725L10.5524 2.67926L10.551 2.67705L10.5505 2.67619C10.5504 2.67612 10.5504 2.67606 10.8331 2.49939L10.5505 2.67619C10.4529 2.52008 10.5003 2.31429 10.6564 2.21672C10.8125 2.11917 11.0181 2.16661 11.1157 2.32268ZM17.4997 9.16606L17.2958 9.42971C17.4414 9.54235 17.6508 9.51562 17.7634 9.37001C17.876 9.22439 17.8492 9.01499 17.7036 8.90235L17.4997 9.16606Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.0171 9.57164C17.1434 9.43772 17.3544 9.43155 17.4883 9.55787C17.6222 9.68418 17.6284 9.89515 17.5021 10.0291L17.2596 9.80035L17.0171 9.57164ZM11.0737 17.7016L10.794 17.5203L10.8145 17.4887L10.8734 17.3985C10.9246 17.3201 10.9992 17.2065 11.0926 17.065C11.2796 16.7822 11.5424 16.388 11.8458 15.9426C12.4514 15.0538 13.2238 13.9538 13.8796 13.1278C14.459 12.3981 15.2447 11.5079 15.8823 10.8034C16.2017 10.4504 16.4852 10.1427 16.6889 9.92319C16.7908 9.81342 16.8727 9.72566 16.9292 9.66529L16.9943 9.59593L17.0171 9.57164L17.2596 9.80035L17.5021 10.0291L17.48 10.0525L17.4159 10.1209C17.36 10.1806 17.2787 10.2677 17.1776 10.3766C16.9754 10.5946 16.6938 10.9003 16.3766 11.2508C15.7408 11.9532 14.9671 12.8304 14.4017 13.5424C13.7618 14.3484 13.0007 15.4316 12.3968 16.318C12.0954 16.7603 11.8344 17.1517 11.6488 17.4326C11.556 17.573 11.4821 17.6857 11.4314 17.7633L11.3734 17.8522L11.3538 17.8824L11.0737 17.7016ZM11.0737 17.7016L10.794 17.5203C10.6939 17.6748 10.738 17.8813 10.8925 17.9814C11.047 18.0814 11.2537 18.0369 11.3538 17.8824L11.0737 17.7016Z"
  />
</svg>`,ScribbledTriangleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.1042 1.55591C10.2801 1.61017 10.3787 1.79676 10.3245 1.97268L10.0059 1.87444L9.6874 1.7762C9.74166 1.60028 9.92825 1.50165 10.1042 1.55591ZM2.92782 15.5656L2.66613 15.3592L2.67298 15.3505L2.69374 15.324C2.71206 15.3007 2.7392 15.2659 2.77423 15.2209C2.84431 15.1308 2.94597 14.9995 3.07196 14.8347C3.32399 14.5053 3.6731 14.0427 4.0612 13.5107C4.83961 12.4437 5.76667 11.1085 6.38444 10.0089C7.22603 8.51089 8.05125 6.4576 8.66899 4.76689C8.97699 3.92394 9.23181 3.17556 9.4096 2.63803C9.49848 2.36931 9.56806 2.15343 9.61536 2.00491C9.63902 1.93066 9.65709 1.87326 9.66922 1.83453L9.68291 1.79067L9.6874 1.7762L10.0059 1.87444C10.3245 1.97268 10.3245 1.97262 10.3245 1.97268L10.3241 1.97381L10.3195 1.98852L10.3054 2.0338C10.293 2.0735 10.2746 2.13192 10.2506 2.20723C10.2026 2.35785 10.1323 2.5761 10.0425 2.84738C9.86313 3.38983 9.60604 4.14488 9.29517 4.99568C8.67521 6.69249 7.835 8.78805 6.96567 10.3354C6.32758 11.4712 5.38103 12.8327 4.59978 13.9036C4.20806 14.4406 3.85583 14.9073 3.60148 15.2398C3.47429 15.4061 3.3715 15.5389 3.30042 15.6303C3.26488 15.6759 3.23727 15.7113 3.21848 15.7352L3.19704 15.7626L3.19006 15.7714L2.92782 15.5656ZM2.92782 15.5656L2.66613 15.3592C2.55211 15.5037 2.57684 15.7133 2.72137 15.8274C2.86591 15.9414 3.07551 15.9166 3.18953 15.7721L2.92782 15.5656Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5.15809 16.0728C6.66763 16.0543 8.54993 16.0541 10.0224 16.1288C11.5853 16.2081 13.5722 16.4167 15.1634 16.6046C15.9601 16.6987 16.6596 16.7879 17.1599 16.8535C17.4101 16.8863 17.6106 16.9133 17.7486 16.932L17.9071 16.9537L17.9624 16.9614C18.1448 16.9869 18.272 17.1554 18.2465 17.3377C18.221 17.52 18.0525 17.6471 17.8702 17.6216L17.816 17.6141L17.6588 17.5926C17.5217 17.574 17.3223 17.5472 17.0732 17.5145C16.575 17.4492 15.8785 17.3604 15.0853 17.2667C13.4967 17.0791 11.5282 16.8728 9.98864 16.7947C8.53815 16.7211 6.67322 16.7209 5.16628 16.7394C4.4138 16.7487 3.7524 16.7626 3.27918 16.7741C3.04259 16.7799 2.85308 16.7851 2.72281 16.7889L2.57336 16.7933L2.52264 16.7949L2.51107 16.4618L2.50033 16.1286L2.55289 16.1269L2.70361 16.1225C2.83476 16.1187 3.02524 16.1135 3.26289 16.1077C3.73816 16.096 4.40233 16.0821 5.15809 16.0728ZM2.17791 16.4726C2.17194 16.2886 2.31633 16.1346 2.50033 16.1286L2.51107 16.4618L2.52264 16.7949C2.33865 16.8009 2.18388 16.6566 2.17791 16.4726Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8.94721 2.04509C9.08267 1.92043 9.29354 1.92918 9.41821 2.06464L9.17293 2.29037L8.92766 2.51609C8.803 2.38063 8.81175 2.16976 8.94721 2.04509ZM17.5001 16.3965L17.1832 16.4996L17.1792 16.4874L17.1669 16.4503C17.1561 16.4175 17.14 16.3688 17.1189 16.3058C17.0767 16.1799 17.0146 15.9968 16.9356 15.7688C16.7775 15.3128 16.5516 14.6777 16.2801 13.9621C15.7356 12.5263 15.0142 10.7827 14.2952 9.50708C13.4583 8.02226 12.1209 6.27766 10.9829 4.89499C10.4157 4.20581 9.90135 3.61049 9.52889 3.18756C9.34269 2.97614 9.19206 2.80792 9.08812 2.69271C9.03616 2.63511 8.99587 2.59077 8.96866 2.56093L8.93783 2.52718L8.92766 2.51609L9.17293 2.29037C9.41821 2.06464 9.41816 2.06459 9.41821 2.06464L9.42942 2.07686L9.46134 2.1118C9.48929 2.14246 9.53035 2.18765 9.58312 2.24614C9.68866 2.36312 9.84107 2.53334 10.0292 2.74696C10.4054 3.17409 10.9247 3.77517 11.4976 4.47135C12.64 5.85938 14.0089 7.64131 14.876 9.17975C15.6209 10.5013 16.3567 12.2842 16.9035 13.7257C17.1777 14.4486 17.4059 15.0899 17.5655 15.5505C17.6454 15.7808 17.7081 15.9661 17.751 16.094C17.7724 16.158 17.7889 16.2076 17.8 16.2413L17.8127 16.2798L17.817 16.2932C17.8171 16.2932 17.8171 16.2933 17.5001 16.3965ZM17.5001 16.3965L17.1832 16.4996C17.2401 16.6747 17.4283 16.7704 17.6033 16.7134C17.7784 16.6564 17.874 16.4682 17.817 16.2932L17.5001 16.3965Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M9.73652 3.33805C9.84503 3.18934 10.0536 3.15674 10.2023 3.26525C10.351 3.37377 10.3836 3.58229 10.2751 3.731L10.0058 3.53453L9.73652 3.33805ZM3.76041 15.5662L3.44364 15.4624L3.44694 15.4524L3.4565 15.4234L3.4934 15.3123C3.52562 15.2158 3.57267 15.0759 3.63218 14.9017C3.75116 14.5534 3.92007 14.0677 4.11982 13.5182C4.51824 12.422 5.04339 11.0605 5.54203 10.0278C6.21751 8.62874 7.26905 6.95347 8.14522 5.63598C8.5845 4.97543 8.98196 4.40146 9.26965 3.99255C9.41352 3.78805 9.53001 3.62474 9.61064 3.51241C9.65096 3.45624 9.68231 3.41281 9.70364 3.38334L9.72799 3.34977L9.73652 3.33805C9.73655 3.33801 9.73652 3.33805 10.0058 3.53453L10.2751 3.731L10.2673 3.74174L10.2436 3.77428C10.2228 3.80305 10.192 3.84574 10.1522 3.90114C10.0727 4.01194 9.95745 4.17354 9.81489 4.37615C9.52974 4.78146 9.13569 5.35051 8.70034 6.00515C7.82723 7.31804 6.79698 8.96185 6.14238 10.3176C5.65914 11.3185 5.14339 12.6537 4.74638 13.7459C4.54842 14.2905 4.38098 14.772 4.26305 15.1172C4.20409 15.2898 4.15754 15.4282 4.12577 15.5234L4.0895 15.6326L4.08024 15.6606L4.07736 15.6694L3.76041 15.5662ZM3.76041 15.5662L3.44364 15.4624C3.38636 15.6374 3.48174 15.8257 3.6567 15.883C3.83166 15.9403 4.02009 15.8444 4.07736 15.6694L3.76041 15.5662Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.3149 2.38886C10.4893 2.32971 10.6785 2.42308 10.7377 2.59741L10.422 2.70452L10.1064 2.81163C10.0472 2.6373 10.1406 2.44802 10.3149 2.38886ZM10.422 2.70452C10.1064 2.81163 10.1064 2.81156 10.1064 2.81163L10.108 2.8163L10.1124 2.82938L10.1298 2.87998C10.1452 2.92432 10.1678 2.98953 10.1974 3.07354C10.2565 3.24157 10.3432 3.48485 10.4541 3.78682C10.6757 4.39063 10.9939 5.22977 11.3805 6.17156C12.1512 8.04929 13.2023 10.3568 14.3082 12.0168C14.83 12.7999 15.5668 13.7434 16.1684 14.486C16.4702 14.8584 16.7397 15.1824 16.9338 15.4134C17.0308 15.5289 17.1091 15.6212 17.1632 15.6847L17.2255 15.7577L17.2471 15.7829C17.3672 15.9225 17.5781 15.9387 17.7176 15.8186C17.8571 15.6985 17.8729 15.488 17.7528 15.3485L17.7476 15.3425L17.7319 15.3241L17.6708 15.2525C17.6175 15.19 17.5402 15.0988 17.4441 14.9845C17.252 14.7558 16.9851 14.435 16.6864 14.0663C16.0871 13.3267 15.3667 12.4031 14.863 11.6472C13.7957 10.0451 12.765 7.78891 11.9972 5.91841C11.6145 4.98608 11.2994 4.15499 11.0799 3.5571C10.9702 3.25822 10.8845 3.01778 10.8263 2.85229C10.7971 2.76955 10.7749 2.70557 10.76 2.6624L10.7432 2.61351L10.739 2.60126L10.7377 2.59741L10.422 2.70452Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.61027 17.5168C2.43001 17.5541 2.25355 17.4382 2.21619 17.2579C2.17883 17.0776 2.29468 16.9013 2.47494 16.864L2.54259 17.1904C2.47496 16.864 2.47489 16.864 2.47494 16.864L2.49141 16.8606L2.53887 16.8509C2.58054 16.8424 2.64195 16.83 2.7213 16.8142C2.87999 16.7825 3.11044 16.7372 3.3981 16.6823C3.97333 16.5726 4.77773 16.4247 5.69478 16.2721C7.52506 15.9674 9.81818 15.6413 11.634 15.5644C12.7876 15.5156 14.259 15.5457 15.4363 15.5876C16.0262 15.6086 16.5444 15.6325 16.9153 15.6513C17.1008 15.6607 17.2495 15.6688 17.3519 15.6745L17.4696 15.6812L17.5102 15.6836C17.6939 15.6947 17.8347 15.8527 17.8236 16.0365C17.8126 16.2202 17.6547 16.3602 17.4709 16.3491L17.4311 16.3467L17.3149 16.3401C17.2136 16.3344 17.0661 16.3264 16.8819 16.3171C16.5136 16.2985 15.9987 16.2746 15.4129 16.2538C14.2389 16.2121 12.7889 16.1828 11.6625 16.2305C9.88958 16.3055 7.62989 16.6259 5.80453 16.9297C4.89375 17.0813 4.09463 17.2282 3.52328 17.3372C3.23765 17.3916 3.00905 17.4366 2.85202 17.4679C2.77351 17.4836 2.71289 17.4959 2.67198 17.5042L2.62565 17.5136L2.61027 17.5168Z"
  />
</svg>`,ScribbledRoundedRectangleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.44887 6.33792C2.63082 6.30988 2.80104 6.43465 2.82908 6.61659C2.92357 7.22966 3.01845 7.79891 3.10866 8.34005C3.57794 11.1554 3.92041 13.2099 3.41887 16.7146C3.39279 16.8968 3.22391 17.0234 3.04168 16.9973C2.85944 16.9713 2.73284 16.8024 2.75892 16.6201C3.24508 13.2229 2.91967 11.2677 2.45308 8.4641C2.36247 7.91969 2.26654 7.34329 2.1702 6.71814C2.14216 6.53619 2.26692 6.36596 2.44887 6.33792Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M15.1061 16.1731C13.9651 16.1615 12.5534 16.1616 11.4552 16.2078C9.87853 16.2741 7.86179 16.4812 6.23376 16.6726C5.42091 16.7682 4.70712 16.8596 4.19659 16.9271C3.94136 16.9609 3.73699 16.9887 3.59653 17.008L3.43542 17.0303L3.38079 17.038L3.33313 16.7081L3.28636 16.378L3.34309 16.3701L3.50569 16.3475C3.64718 16.3281 3.8527 16.3001 4.10919 16.2662C4.62212 16.1984 5.33918 16.1066 6.1559 16.0105C7.787 15.8187 9.82429 15.6091 11.4272 15.5417C12.5436 15.4947 13.9697 15.4948 15.1129 15.5065C15.6853 15.5123 16.1882 15.5211 16.5482 15.5284C16.7281 15.532 16.8724 15.5353 16.9717 15.5377L17.0859 15.5405L17.1251 15.5415L17.1168 15.8747L17.1078 16.208L17.0689 16.2069L16.9558 16.2042C16.8572 16.2018 16.7137 16.1985 16.5346 16.1949C16.1764 16.1876 15.6757 16.1789 15.1061 16.1731ZM17.45 15.8837C17.445 16.0677 17.2918 16.2129 17.1078 16.208L17.1168 15.8747L17.1251 15.5415C17.3091 15.5465 17.455 15.6997 17.45 15.8837ZM3.0031 16.7549C2.97723 16.5727 3.10409 16.4039 3.28636 16.378L3.33313 16.7081L3.38079 17.038C3.19852 17.0639 3.02898 16.9372 3.0031 16.7549Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.4298 5.50028C17.6138 5.49278 17.769 5.63582 17.7765 5.81976L17.4434 5.83334L17.1104 5.84691C17.1029 5.66297 17.2459 5.50778 17.4298 5.50028ZM16.6664 16.6667L16.3384 16.6071L16.3454 16.5681L16.3657 16.4543C16.3832 16.355 16.4084 16.2105 16.4391 16.03C16.5006 15.6689 16.584 15.1641 16.6719 14.5896C16.848 13.4377 17.0404 12.016 17.1108 10.9102C17.1732 9.92887 17.1734 8.66525 17.1576 7.64117C17.1498 7.13036 17.1379 6.68143 17.1281 6.36026C17.1231 6.1997 17.1187 6.07114 17.1155 5.98282L17.1117 5.88158L17.1104 5.84691L17.4434 5.83334L17.7765 5.81976L17.7779 5.85588L17.7817 5.95871C17.785 6.04812 17.7894 6.17791 17.7944 6.3398C17.8044 6.66354 17.8163 7.11595 17.8242 7.63088C17.8401 8.65825 17.8403 9.94366 17.7761 10.9526C17.7037 12.0892 17.5076 13.5351 17.3309 14.6903C17.2423 15.2693 17.1583 15.7779 17.0963 16.1418C17.0654 16.3238 17.0399 16.4696 17.0222 16.5701L17.0017 16.6857L16.9945 16.7255L16.6664 16.6667ZM16.6664 16.6667L16.3384 16.6071C16.3055 16.7882 16.4257 16.9617 16.6068 16.9946C16.788 17.0275 16.9616 16.9066 16.9945 16.7255L16.6664 16.6667Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M18.6816 4.25378C18.6816 4.25378 18.6816 4.25377 18.6816 4.25378L18.6798 4.26045L18.6743 4.2812L18.653 4.36248C18.6345 4.43352 18.6079 4.53713 18.5755 4.66674C18.5106 4.92604 18.4227 5.28896 18.3307 5.70299C18.1456 6.53525 17.9471 7.55848 17.881 8.36138C17.7896 9.47192 17.8441 10.3393 17.9155 11.223C17.9227 11.3116 17.93 11.4004 17.9374 11.4898C18.0036 12.2918 18.0731 13.1322 18.0441 14.1766C18.0281 14.7528 17.9873 15.4868 17.9507 16.0741C17.9323 16.3683 17.915 16.6267 17.9022 16.8116C17.8958 16.9041 17.8906 16.9782 17.887 17.0292L17.8813 17.1081L17.5488 17.084L17.2164 17.0596L17.222 16.9817C17.2256 16.9312 17.2308 16.8576 17.2371 16.7657C17.2498 16.5819 17.2671 16.325 17.2853 16.0326C17.3218 15.4467 17.362 14.7223 17.3777 14.1581C17.4056 13.1522 17.3391 12.3467 17.2729 11.5437C17.2655 11.4547 17.2582 11.3658 17.251 11.2767C17.1787 10.3821 17.1206 9.47185 17.2166 8.30666C17.2867 7.45607 17.4936 6.39597 17.6799 5.55827C17.7735 5.13732 17.8628 4.7686 17.9287 4.50502C17.9617 4.37318 17.9888 4.26753 18.0078 4.19467L18.0298 4.11077L18.0356 4.08879L18.0375 4.08154C18.0852 3.90374 18.2682 3.79769 18.446 3.84542C18.6238 3.89315 18.7293 4.07598 18.6816 4.25378ZM17.5488 17.084L17.2164 17.0596C17.2029 17.2432 17.3408 17.403 17.5244 17.4165C17.708 17.4299 17.8678 17.2917 17.8813 17.1081L17.5488 17.084Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.83426 4.14247C3.84818 3.95882 4.00824 3.82092 4.19176 3.83446L4.16655 4.16698L4.14133 4.49951C3.95782 4.48597 3.82033 4.32611 3.83426 4.14247ZM4.16655 4.16698L4.14133 4.49951L4.18765 4.50286L4.32 4.5122C4.43514 4.5202 4.60234 4.53155 4.81097 4.54497C5.22818 4.5718 5.81134 4.60694 6.47532 4.64014C7.80099 4.70644 9.45741 4.76549 10.7588 4.73432C11.5177 4.71615 12.4849 4.65942 13.2592 4.60755C13.647 4.58156 13.9877 4.55671 14.2315 4.53835C14.3534 4.52917 14.4511 4.52161 14.5184 4.51634L14.6223 4.50811C14.8058 4.49328 14.9433 4.33243 14.9289 4.14888C14.9144 3.96534 14.754 3.82856 14.5705 3.84339L14.4678 3.85152C14.4011 3.85675 14.304 3.86425 14.1829 3.87338C13.9405 3.89163 13.6017 3.91635 13.2161 3.94218C12.4435 3.99394 11.4882 4.04985 10.7443 4.06766C9.46869 4.09821 7.8326 4.04026 6.51001 3.97412C5.84987 3.94111 5.26996 3.90617 4.85514 3.87949C4.64776 3.86615 4.48171 3.85488 4.36759 3.84695L4.23672 3.83772L4.19176 3.83446L4.16655 4.16698Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M6.90557 4.249C8.03011 4.03755 9.45202 3.82395 10.5835 3.83435C11.6494 3.84415 12.9876 4.05759 14.0458 4.26413C14.5778 4.36796 15.0444 4.47116 15.3782 4.54842C15.5451 4.58707 15.679 4.61926 15.7713 4.64185C15.8175 4.65315 15.8533 4.66204 15.8777 4.66815L15.9056 4.67516L15.9148 4.6775C15.9148 4.67751 15.9155 4.67769 15.833 5.00065L15.9148 4.6775C16.0931 4.72308 16.2015 4.90481 16.156 5.08318C16.1104 5.26154 15.9288 5.36918 15.7505 5.32361M5.0811 5.32388L5.08316 5.32337L5.09006 5.32164L5.11799 5.31473C5.14274 5.30863 5.17957 5.29962 5.22737 5.28813C5.32297 5.26515 5.46239 5.23224 5.63671 5.19276C5.98546 5.11377 6.47323 5.00865 7.02876 4.90419C8.14602 4.6941 9.51451 4.49122 10.5774 4.50099C11.5787 4.51019 12.8668 4.71325 13.9181 4.91845C14.4408 5.02048 14.8997 5.12196 15.2278 5.19791C15.3918 5.23588 15.523 5.26742 15.6129 5.28942C15.6578 5.30042 15.6925 5.30903 15.7158 5.31486L15.742 5.32147L15.7505 5.32361M4.99967 5.00065C4.91823 4.67742 4.91827 4.67741 4.91832 4.67739L4.9211 4.6767L4.92884 4.67476L4.95848 4.66742C4.9844 4.66103 5.02247 4.65173 5.07155 4.63993C5.16971 4.61633 5.312 4.58275 5.48945 4.54256C5.84422 4.46221 6.3402 4.35531 6.90557 4.249M4.99967 5.00065L4.91832 4.67739C4.73981 4.72237 4.63146 4.90357 4.67643 5.08208C4.72141 5.2606 4.90259 5.36885 5.0811 5.32388"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.09851 7.16634C2.28243 7.17439 2.425 7.33002 2.41694 7.51394L2.08393 7.49935L1.75092 7.48477C1.75897 7.30085 1.91459 7.15829 2.09851 7.16634ZM2.91732 16.666L2.59179 16.7377L2.5897 16.7282L2.58376 16.7009L2.56129 16.5965C2.5419 16.5058 2.5141 16.3741 2.48032 16.2097C2.41279 15.8811 2.32128 15.4215 2.22534 14.8975C2.0341 13.8528 1.82281 12.5389 1.75124 11.4944C1.69721 10.7057 1.6975 9.70092 1.71081 8.89957C1.71749 8.49756 1.7275 8.14425 1.73585 7.89139C1.74002 7.76493 1.74377 7.66352 1.74649 7.59361L1.74972 7.51316L1.75092 7.48477L2.08393 7.49935L2.41694 7.51394L2.41581 7.54077L2.41266 7.61951C2.40998 7.68825 2.40627 7.78834 2.40215 7.91337C2.3939 8.16348 2.38399 8.51306 2.37739 8.91065C2.36413 9.7085 2.36435 10.6898 2.41635 11.4488C2.48522 12.454 2.6907 13.7373 2.88111 14.7774C2.976 15.2957 3.06654 15.7505 3.13334 16.0755C3.16674 16.238 3.19418 16.368 3.21324 16.4573L3.23525 16.5595L3.24096 16.5857L3.24274 16.5938L2.91732 16.666ZM2.91732 16.666L2.59179 16.7377C2.63141 16.9175 2.80929 17.0312 2.98907 16.9915C3.16885 16.9519 3.28237 16.7736 3.24274 16.5938L2.91732 16.666Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5.62454 15.5047C6.93031 15.4962 8.55651 15.4962 9.82846 15.5303C11.2616 15.5688 13.0911 15.6733 14.5595 15.7679C15.2943 15.8153 15.9398 15.8602 16.4016 15.8934C16.6326 15.9099 16.8176 15.9235 16.9449 15.933L17.1413 15.9478L17.1167 16.2802L17.0913 16.6126L16.8955 16.5978C16.7687 16.5884 16.5842 16.5748 16.3539 16.5583C15.8933 16.5253 15.2495 16.4804 14.5166 16.4332C13.0497 16.3387 11.2306 16.2348 9.81058 16.1967C8.55028 16.1629 6.93327 16.1629 5.62888 16.1714C4.97721 16.1756 4.40454 16.182 3.99481 16.1873C3.78996 16.1899 3.62586 16.1923 3.51303 16.194L3.3395 16.1968L3.33309 15.8635L3.32742 15.5302L3.50286 15.5274C3.61616 15.5257 3.78077 15.5233 3.98619 15.5207C4.397 15.5154 4.97114 15.509 5.62454 15.5047ZM3.33309 15.8635L3.32742 15.5302C3.14335 15.5334 2.99664 15.6852 2.99981 15.8693C3.00297 16.0533 3.15543 16.2 3.3395 16.1968L3.33309 15.8635ZM17.4491 16.3056C17.4351 16.4892 17.2748 16.6266 17.0913 16.6126L17.1167 16.2802L17.1422 15.9478C17.3257 15.9619 17.4632 16.1221 17.4491 16.3056Z"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M15.4164 4.16586L15.3112 3.84959C15.1365 3.90772 15.042 4.09645 15.1002 4.27112C15.1583 4.4458 15.347 4.54027 15.5217 4.48214M15.4164 4.16586C15.3112 3.84959 15.3111 3.84961 15.3112 3.84959L15.312 3.8493L15.3136 3.8488L15.3186 3.84714L15.3364 3.84145C15.3515 3.83665 15.3731 3.82992 15.4003 3.82175C15.4547 3.80544 15.5319 3.78331 15.6251 3.75941C15.8101 3.71193 16.0639 3.65588 16.3298 3.62566C16.59 3.59607 16.8897 3.58772 17.1539 3.65441C17.4241 3.72264 17.7106 3.88695 17.8181 4.23381C17.8763 4.42122 17.8713 4.64093 17.8612 4.78275C17.8557 4.85982 17.8475 4.92756 17.8407 4.97617C17.8373 5.0006 17.8342 5.02054 17.8319 5.03479L17.829 5.05185L17.8281 5.05697L17.8278 5.05862L17.8276 5.05946C17.8276 5.05951 17.8276 5.05967 17.4998 4.9992L17.8276 5.05946C17.7942 5.2405 17.6203 5.3604 17.4393 5.327C17.2584 5.29363 17.1387 5.12 17.1719 4.9391"
    fill="currentColor"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.77882 6.55857C3.83811 6.73279 3.74499 6.92211 3.57078 6.98148C3.39653 7.04086 3.20713 6.94774 3.14774 6.77348L3.46323 6.66597C3.14774 6.77348 3.14777 6.77356 3.14774 6.77348L3.14716 6.77175L3.14616 6.76876L3.14299 6.7591C3.14038 6.75108 3.13683 6.73992 3.13255 6.72595C3.12399 6.69804 3.11247 6.65872 3.09978 6.61065C3.07458 6.51517 3.04391 6.38195 3.02326 6.23325C3.00283 6.08609 2.99073 5.91351 3.00806 5.74242C3.02512 5.57403 3.07338 5.38024 3.19659 5.21596C3.36782 4.98767 3.65782 4.85635 3.84492 4.7863C3.94807 4.74768 4.0425 4.71975 4.11102 4.70144C4.14549 4.69222 4.17396 4.6853 4.19437 4.68056L4.21882 4.67505L4.22612 4.67349L4.22846 4.673L4.2293 4.67283C4.22936 4.67281 4.2299 4.6727 4.29659 4.9993L4.2293 4.67283C4.40967 4.63599 4.58636 4.75223 4.62319 4.93261M4.36352 5.32584C4.36356 5.32583 4.36377 5.32579 4.36352 5.32584V5.32584Z"
    fill="currentColor"
  />
</svg>`,MinusIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5.25 12C5.25 11.5858 5.58579 11.25 6 11.25H18C18.4142 11.25 18.75 11.5858 18.75 12C18.75 12.4142 18.4142 12.75 18 12.75H6C5.58579 12.75 5.25 12.4142 5.25 12Z"
  />
</svg>`,PlusIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M12 5.25C12.4142 5.25 12.75 5.58579 12.75 6V11.25H18C18.4142 11.25 18.75 11.5858 18.75 12C18.75 12.4142 18.4142 12.75 18 12.75H12.75V18C12.75 18.4142 12.4142 18.75 12 18.75C11.5858 18.75 11.25 18.4142 11.25 18V12.75H6C5.58579 12.75 5.25 12.4142 5.25 12C5.25 11.5858 5.58579 11.25 6 11.25H11.25V6C11.25 5.58579 11.5858 5.25 12 5.25Z"
  />
</svg>`,ViewBarIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M3.25 20C2.83579 20 2.5 19.6642 2.5 19.25V4.75C2.5 4.33579 2.83579 4 3.25 4C3.66421 4 4 4.33579 4 4.75L4 19.25C4 19.6642 3.66421 20 3.25 20ZM9.66494 8.43945C9.97453 8.71464 10.0024 9.18869 9.72722 9.49828L8.17013 11.25H15.8298L14.2728 9.49828C13.9976 9.18869 14.0255 8.71464 14.335 8.43945C14.6446 8.16426 15.1187 8.19215 15.3939 8.50174L18.0605 11.5017C18.3131 11.7859 18.3131 12.2141 18.0605 12.4983L15.3939 15.4983C15.1187 15.8079 14.6446 15.8358 14.335 15.5606C14.0255 15.2854 13.9976 14.8113 14.2728 14.5017L15.8298 12.75H8.17013L9.72722 14.5017C10.0024 14.8113 9.97453 15.2854 9.66494 15.5606C9.35535 15.8358 8.8813 15.8079 8.60611 15.4983L5.93944 12.4983C5.68685 12.2141 5.68685 11.7859 5.93944 11.5017L8.60611 8.50174C8.8813 8.19215 9.35535 8.16426 9.66494 8.43945ZM21.5 4.75C21.5 4.33579 21.1642 4 20.75 4C20.3358 4 20 4.33579 20 4.75V19.25C20 19.6642 20.3358 20 20.75 20C21.1642 20 21.5 19.6642 21.5 19.25V4.75Z"
  />
</svg>`,TransparentIcon=x$1`<svg
  width="16"
  height="16"
  viewBox="0 0 16 16"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M-0.939238 4.14286C-0.979281 4.4228 -1 4.70898 -1 5V6.71429H1.57143V9.28571H-1V11C-1 11.291 -0.979281 11.5772 -0.939238 11.8571H1.57143V14.4286H0.0754482C0.481795 15.0111 0.988871 15.5182 1.57143 15.9246V14.4286L4.14286 14.4286V16.9392C4.4228 16.9793 4.70898 17 5 17H6.71429V14.4286H9.28571V17H11C11.291 17 11.5772 16.9793 11.8571 16.9392V14.4286H14.4286L14.4286 15.9246C15.0111 15.5182 15.5182 15.0111 15.9246 14.4286L14.4286 14.4286V11.8571H16.9392C16.9793 11.5772 17 11.291 17 11V9.28571H14.4286V6.71429H17V5C17 4.70898 16.9793 4.4228 16.9392 4.14286H14.4286V1.57143H15.9246C15.5182 0.988871 15.0111 0.481795 14.4286 0.075448L14.4286 1.57143H11.8571V-0.939238C11.5772 -0.979281 11.291 -1 11 -1H9.28571V1.57143H6.71429V-1H5C4.70898 -1 4.4228 -0.979281 4.14286 -0.939238V1.57143H1.57143V0.0754479C0.988871 0.481795 0.481795 0.988871 0.0754479 1.57143H1.57143V4.14286H-0.939238ZM4.14286 4.14286V1.57143H6.71429V4.14286H4.14286ZM4.14286 6.71429H1.57143V4.14286H4.14286V6.71429ZM6.71429 6.71429V4.14286H9.28571V6.71429H6.71429ZM6.71429 9.28571V6.71429H4.14286V9.28571H1.57143V11.8571H4.14286V14.4286H6.71429V11.8571H9.28571V14.4286H11.8571V11.8571H14.4286V9.28571H11.8571V6.71429H14.4286V4.14286H11.8571V1.57143H9.28571V4.14286H11.8571V6.71429H9.28571V9.28571H6.71429ZM6.71429 9.28571V11.8571H4.14286V9.28571H6.71429ZM9.28571 9.28571H11.8571V11.8571H9.28571V9.28571Z"
    fill="#D9D9D9"
  />
</svg>`,MoreHorizontalIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.5 12.0001C4.5 12.9559 5.27489 13.7308 6.23077 13.7308C7.18665 13.7308 7.96154 12.9559 7.96154 12.0001C7.96154 11.0442 7.18665 10.2693 6.23077 10.2693C5.27489 10.2693 4.5 11.0442 4.5 12.0001ZM12 13.7308C11.0441 13.7308 10.2692 12.9559 10.2692 12.0001C10.2692 11.0442 11.0441 10.2693 12 10.2693C12.9559 10.2693 13.7308 11.0442 13.7308 12.0001C13.7308 12.9559 12.9559 13.7308 12 13.7308ZM17.7692 13.7308C16.8134 13.7308 16.0385 12.9559 16.0385 12.0001C16.0385 11.0442 16.8134 10.2693 17.7692 10.2693C18.7251 10.2693 19.5 11.0442 19.5 12.0001C19.5 12.9559 18.7251 13.7308 17.7692 13.7308Z"
    fill="currentColor"
  />
</svg> `,MoreVerticalIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M11.25 5C11.25 5.69036 10.6904 6.25 10 6.25C9.30964 6.25 8.75 5.69036 8.75 5C8.75 4.30964 9.30964 3.75 10 3.75C10.6904 3.75 11.25 4.30964 11.25 5ZM11.25 10C11.25 10.6904 10.6904 11.25 10 11.25C9.30964 11.25 8.75 10.6904 8.75 10C8.75 9.30964 9.30964 8.75 10 8.75C10.6904 8.75 11.25 9.30964 11.25 10ZM10 16.25C10.6904 16.25 11.25 15.6904 11.25 15C11.25 14.3096 10.6904 13.75 10 13.75C9.30964 13.75 8.75 14.3096 8.75 15C8.75 15.6904 9.30964 16.25 10 16.25Z"
    fill="currentColor"
  />
</svg> `,LineStyleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M3.64999 5C3.64999 4.58579 3.98577 4.25 4.39999 4.25H7.39999C7.8142 4.25 8.14999 4.58579 8.14999 5C8.14999 5.41421 7.8142 5.75 7.39999 5.75H4.39999C3.98577 5.75 3.64999 5.41421 3.64999 5ZM9.74999 5C9.74999 4.58579 10.0858 4.25 10.5 4.25H13.5C13.9142 4.25 14.25 4.58579 14.25 5C14.25 5.41421 13.9142 5.75 13.5 5.75L10.5 5.75C10.0858 5.75 9.74999 5.41421 9.74999 5ZM16.8 4.25C16.3858 4.25 16.05 4.58579 16.05 5C16.05 5.41421 16.3858 5.75 16.8 5.75L19.8 5.75C20.2142 5.75 20.55 5.41421 20.55 5C20.55 4.58579 20.2142 4.25 19.8 4.25H16.8ZM3.245 12C3.245 11.5306 3.62555 11.15 4.095 11.15H19.8842C20.3536 11.15 20.7342 11.5306 20.7342 12C20.7342 12.4694 20.3536 12.85 19.8842 12.85H4.095C3.62555 12.85 3.245 12.4694 3.245 12ZM4.49999 17.75C3.80964 17.75 3.24999 18.3096 3.24999 19C3.24999 19.6904 3.80964 20.25 4.49999 20.25H19.5C20.1903 20.25 20.75 19.6904 20.75 19C20.75 18.3096 20.1903 17.75 19.5 17.75H4.49999Z"
  />
</svg>`,GeneralStyleIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M5.39177 4.9553C5.6006 4.68046 5.9927 4.62696 6.26753 4.83579C11.9583 9.15993 16.1901 14.9846 17.8532 18.3578C18.0058 18.6674 17.8786 19.0421 17.569 19.1948C17.2594 19.3474 16.8847 19.2202 16.7321 18.9106C15.1515 15.7047 11.0421 10.0337 5.51127 5.83107C5.23644 5.62223 5.18293 5.23014 5.39177 4.9553Z"
    />
  </svg>
`,ScribbledStyleIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M4.7244 5.19359C4.80201 4.85725 5.13759 4.64751 5.47393 4.72513C10.9871 5.99739 15.9297 8.80233 18.2292 10.6837C18.5303 10.9301 18.7797 11.1831 18.9343 11.4491C19.0965 11.7281 19.1885 12.0903 19.0251 12.4573C18.8794 12.7848 18.5897 12.972 18.3532 13.0832C18.1035 13.2007 17.8045 13.2839 17.4933 13.3483C16.8692 13.4775 16.0641 13.5565 15.211 13.6286C15.0041 13.646 14.7937 13.6632 14.5807 13.6805C13.8997 13.7359 13.1915 13.7936 12.4857 13.872C10.6165 14.0797 9.12382 14.3464 8.2104 14.666C7.84171 14.795 7.63227 14.9113 7.52734 14.9914C7.86905 15.3958 8.43971 15.7994 9.16558 16.1805C9.90858 16.5706 10.7617 16.9103 11.5782 17.191C12.3927 17.4709 13.1581 17.6879 13.7206 17.8349C14.0015 17.9083 14.2308 17.964 14.3891 18.0013C14.4683 18.0199 14.5296 18.0338 14.5708 18.043L14.617 18.0533L14.6281 18.0557L14.6306 18.0562C14.9681 18.1286 15.1835 18.4609 15.1112 18.7984C15.0389 19.1359 14.7066 19.3509 14.3691 19.2786L14.5001 18.6675C14.3691 19.2786 14.3692 19.2786 14.3691 19.2786L14.3674 19.2782L14.3635 19.2774L14.3495 19.2743L14.2975 19.2628C14.2524 19.2527 14.1868 19.2377 14.1032 19.2181C13.936 19.1788 13.6966 19.1206 13.4045 19.0443C12.8212 18.8918 12.0241 18.6661 11.1719 18.3731C10.3217 18.0809 9.40404 17.7175 8.58454 17.2872C7.77645 16.863 7.00904 16.3458 6.51201 15.7246C6.35483 15.5281 6.22952 15.2782 6.22579 14.9843C6.22198 14.6841 6.34606 14.4334 6.50705 14.2436C6.80009 13.8982 7.29046 13.6635 7.79762 13.4861C8.85378 13.1166 10.467 12.8386 12.3477 12.6296C13.0736 12.549 13.8076 12.4892 14.492 12.4336C14.7018 12.4165 14.9069 12.3998 15.1057 12.383C15.9678 12.3102 16.7002 12.236 17.2399 12.1243C17.4794 12.0747 17.6554 12.0226 17.7766 11.9719C17.7097 11.8929 17.6027 11.7863 17.4376 11.6512C15.2821 9.88756 10.513 7.17085 5.19285 5.94312C4.85651 5.8655 4.64678 5.52992 4.7244 5.19359Z"
    />
  </svg>
`,RoughIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M3.5422 4.13953C3.55683 3.79467 3.84826 3.52696 4.19313 3.54159C5.6402 3.60298 7.93882 3.7684 10.1442 4.06618C11.2467 4.21505 12.335 4.3982 13.2862 4.6204C14.2252 4.83972 15.0779 5.10751 15.6797 5.44307C15.8695 5.54892 16.0498 5.67172 16.1878 5.82007C16.3251 5.96767 16.4772 6.20446 16.4564 6.51369C16.4357 6.82248 16.2539 7.03228 16.1088 7.15201C15.9626 7.27256 15.7877 7.35885 15.6243 7.42399C14.9916 7.67626 13.914 7.8421 12.7874 7.97672C12.1057 8.05817 11.3578 8.13286 10.6263 8.20592C10.1318 8.25531 9.6447 8.30395 9.19068 8.35343C8.95971 8.3786 8.73783 8.40395 8.52673 8.42965C8.61119 8.44241 8.69751 8.45534 8.78561 8.46846C8.95845 8.49418 9.13736 8.52049 9.32106 8.5475C11.2577 8.83228 13.7266 9.19532 15.2289 9.78172C15.3629 9.834 15.5712 9.92807 15.7169 10.1094C15.8022 10.2157 15.8816 10.3722 15.8818 10.5687C15.882 10.7617 15.8056 10.9129 15.7316 11.012C15.6022 11.1853 15.4172 11.285 15.3044 11.3394C15.1702 11.4042 15.0138 11.4612 14.8513 11.5125C14.2128 11.7141 13.1901 11.9148 12.1299 12.1172C12.0179 12.1386 11.9052 12.16 11.792 12.1816C10.8122 12.368 9.80063 12.5606 8.94833 12.766C8.47307 12.8805 8.06348 12.9953 7.74601 13.1101C7.61714 13.1566 7.51574 13.199 7.43745 13.2356C7.68334 13.4275 8.10298 13.6573 8.65948 13.9028C9.85143 14.4285 11.4428 14.9294 12.5498 15.2295C12.883 15.3198 13.0799 15.663 12.9896 15.9962C12.8993 16.3294 12.556 16.5262 12.2228 16.4359C11.0881 16.1284 9.42898 15.6084 8.15502 15.0465C7.53037 14.7709 6.93835 14.46 6.55494 14.1279C6.36993 13.9676 6.15682 13.7383 6.0719 13.4374C6.02575 13.2738 6.01869 13.0918 6.07361 12.9077C6.12749 12.727 6.22983 12.5816 6.3455 12.4687C6.59012 12.23 6.96721 12.0624 7.32122 11.9344C7.70138 11.7971 8.16163 11.6698 8.65545 11.5508C9.53937 11.3377 10.5826 11.1392 11.5566 10.9539C11.6706 10.9322 11.7837 10.9107 11.8955 10.8894C12.4964 10.7746 13.0518 10.6663 13.5217 10.563C12.2127 10.238 10.5674 9.99514 9.10593 9.77947C8.93502 9.75425 8.76662 9.7294 8.60157 9.70483C7.60387 9.55632 6.69342 9.41305 6.17827 9.25053C6.04794 9.20942 5.90186 9.15496 5.77615 9.07834C5.69439 9.02851 5.3933 8.8354 5.38124 8.44931C5.36878 8.05014 5.67336 7.83944 5.76459 7.78114C5.89744 7.69624 6.05811 7.63314 6.21505 7.58209C6.84901 7.37589 7.92243 7.23423 9.05526 7.11079C9.53583 7.05842 10.0313 7.009 10.5275 6.95952C11.244 6.88806 11.9621 6.81644 12.6391 6.73554C13.5277 6.62937 14.2674 6.5148 14.7689 6.38596C14.3299 6.19232 13.7289 6.00744 13.0019 5.83763C12.1029 5.62764 11.0569 5.45077 9.9769 5.30494C7.81709 5.01331 5.55752 4.8506 4.14014 4.79046C3.79528 4.77583 3.52757 4.4844 3.5422 4.13953ZM14.8271 10.9699C14.827 10.9699 14.8253 10.969 14.8222 10.9671C14.8256 10.9689 14.8272 10.9699 14.8271 10.9699ZM14.7978 10.1943C14.8007 10.1922 14.8023 10.1912 14.8024 10.1912C14.8025 10.1913 14.8011 10.1923 14.7978 10.1943Z"
    />
  </svg>
`,ConnectorXIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M17.0303 2.01996C16.7374 1.72707 16.2626 1.72707 15.9697 2.01996C15.6768 2.31286 15.6768 2.78773 15.9697 3.08062L19.6391 6.75001H14C12.4812 6.75001 11.25 7.98123 11.25 9.50001V18C11.25 18.6904 10.6904 19.25 10 19.25H3C2.58579 19.25 2.25 19.5858 2.25 20C2.25 20.4142 2.58579 20.75 3 20.75H10C11.5188 20.75 12.75 19.5188 12.75 18V9.50001C12.75 8.80965 13.3096 8.25001 14 8.25001H19.6391L15.9697 11.9195C15.6768 12.2124 15.6768 12.6872 15.9697 12.9801C16.2626 13.273 16.7374 13.273 17.0303 12.9801L21.9094 8.10108C22.2413 7.76914 22.2413 7.23095 21.9094 6.899L17.0303 2.01996Z"
    fill="currentColor"
  />
</svg> `,ConnectorLIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M13 3.25C12.5858 3.25 12.25 3.58579 12.25 4C12.25 4.41421 12.5858 4.75 13 4.75H18.1893L3.46967 19.4697C3.17678 19.7626 3.17678 20.2374 3.46967 20.5303C3.76256 20.8232 4.23744 20.8232 4.53033 20.5303L19.25 5.81065V11C19.25 11.4142 19.5858 11.75 20 11.75C20.4142 11.75 20.75 11.4142 20.75 11V4.1C20.75 3.63056 20.3694 3.25 19.9 3.25H13Z"
    fill="currentColor"
  />
</svg> `,ConnectorXWithArrowIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <g clip-path="url(#clip0_8946_169583)">
    <path
      d="M14.1919 1.6833C13.9479 1.43922 13.5521 1.43922 13.3081 1.6833C13.064 1.92738 13.064 2.32311 13.3081 2.56719L16.3659 5.62501H11.6667C10.401 5.62501 9.375 6.65102 9.375 7.91667V15C9.375 15.5753 8.90863 16.0417 8.33333 16.0417H2.5C2.15482 16.0417 1.875 16.3215 1.875 16.6667C1.875 17.0119 2.15482 17.2917 2.5 17.2917H8.33333C9.59899 17.2917 10.625 16.2657 10.625 15V7.91667C10.625 7.34138 11.0914 6.87501 11.6667 6.87501H16.3659L13.3081 9.93288C13.064 10.177 13.064 10.5727 13.3081 10.8168C13.5521 11.0608 13.9479 11.0608 14.1919 10.8168L18.2578 6.7509C18.5344 6.47428 18.5344 6.02579 18.2578 5.74917L14.1919 1.6833Z"
    />
  </g>
  <defs>
    <clipPath id="clip0_8946_169583">
      <rect width="20" height="20" fill="white" />
    </clipPath>
  </defs>
</svg>`,ConnectorLWithArrowIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M10.833 2.70834C10.4878 2.70834 10.208 2.98817 10.208 3.33334C10.208 3.67852 10.4878 3.95834 10.833 3.95834H15.1574L2.89107 16.2247C2.64699 16.4688 2.64699 16.8645 2.89107 17.1086C3.13514 17.3527 3.53087 17.3527 3.77495 17.1086L16.0413 4.84222V9.16668C16.0413 9.51185 16.3212 9.79168 16.6663 9.79168C17.0115 9.79168 17.2913 9.51185 17.2913 9.16668V3.41668C17.2913 3.02548 16.9742 2.70834 16.583 2.70834H10.833Z"
  />
</svg>`,DashLineIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M17.1086 2.94282C17.3527 3.1869 17.3527 3.58263 17.1086 3.82671L14.4509 6.48449C14.2068 6.72857 13.811 6.72857 13.567 6.48449C13.3229 6.24041 13.3229 5.84469 13.567 5.60061L16.2248 2.94282C16.4688 2.69875 16.8646 2.69875 17.1086 2.94282ZM11.7961 8.25532C12.0402 8.4994 12.0402 8.89513 11.7961 9.13921L9.13835 11.797C8.89428 12.0411 8.49855 12.0411 8.25447 11.797C8.01039 11.5529 8.01039 11.1572 8.25447 10.9131L10.9123 8.25532C11.1563 8.01125 11.5521 8.01125 11.7961 8.25532ZM6.48364 14.4517C6.72771 14.2076 6.72771 13.8119 6.48364 13.5678C6.23956 13.3237 5.84383 13.3237 5.59975 13.5678L2.94197 16.2256C2.69789 16.4697 2.69789 16.8654 2.94197 17.1095C3.18605 17.3536 3.58178 17.3536 3.82585 17.1095L6.48364 14.4517Z"
  />
</svg>`,StraightLineIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M17.1086 2.89204C17.3527 3.13612 17.3527 3.53185 17.1086 3.77593L3.77532 17.1093C3.53124 17.3533 3.13551 17.3533 2.89143 17.1093C2.64735 16.8652 2.64735 16.4695 2.89143 16.2254L16.2248 2.89204C16.4688 2.64796 16.8646 2.64796 17.1086 2.89204Z"
  />
</svg>`,BanIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5.6004 4.71652L15.2835 14.3996C17.5379 11.6986 17.3972 7.67452 14.8614 5.13864C12.3255 2.60276 8.30143 2.46205 5.6004 4.71652ZM14.3996 15.2835L4.71652 5.6004C2.46205 8.30143 2.60276 12.3255 5.13864 14.8614C7.67452 17.3972 11.6986 17.5379 14.3996 15.2835ZM4.25476 4.25476C7.42777 1.08175 12.5722 1.08175 15.7452 4.25476C18.9183 7.42777 18.9183 12.5722 15.7452 15.7452C12.5722 18.9183 7.42777 18.9183 4.25476 15.7452C1.08175 12.5722 1.08175 7.42777 4.25476 4.25476Z"
  />
</svg>`,NoteIcon=x$1`<svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M7 3.25C5.48122 3.25 4.25 4.48122 4.25 6V18C4.25 19.5188 5.48122 20.75 7 20.75H17C18.5188 20.75 19.75 19.5188 19.75 18V6C19.75 4.48122 18.5188 3.25 17 3.25H7ZM5.75 6C5.75 5.30964 6.30964 4.75 7 4.75H17C17.6904 4.75 18.25 5.30964 18.25 6V18C18.25 18.6904 17.6904 19.25 17 19.25H7C6.30964 19.25 5.75 18.6904 5.75 18V6ZM9 7.25C8.58579 7.25 8.25 7.58579 8.25 8C8.25 8.41421 8.58579 8.75 9 8.75H12.5C12.9142 8.75 13.25 8.41421 13.25 8C13.25 7.58579 12.9142 7.25 12.5 7.25H9ZM8.25 11.5C8.25 11.0858 8.58579 10.75 9 10.75H15C15.4142 10.75 15.75 11.0858 15.75 11.5C15.75 11.9142 15.4142 12.25 15 12.25H9C8.58579 12.25 8.25 11.9142 8.25 11.5ZM9 14.25C8.58579 14.25 8.25 14.5858 8.25 15C8.25 15.4142 8.58579 15.75 9 15.75H14C14.4142 15.75 14.75 15.4142 14.75 15C14.75 14.5858 14.4142 14.25 14 14.25H9Z"
  />
</svg>`,FrameIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="currentColor"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_15920)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M5.83337 17.2923C5.4882 17.2923 5.20837 17.0125 5.20837 16.6673V14.7923H3.33337C2.9882 14.7923 2.70837 14.5125 2.70837 14.1673C2.70837 13.8221 2.9882 13.5423 3.33337 13.5423H5.20837L5.20837 6.45898H3.33337C2.9882 6.45898 2.70837 6.17916 2.70837 5.83398C2.70837 5.48881 2.9882 5.20898 3.33337 5.20898H5.20837V3.33398C5.20837 2.98881 5.4882 2.70898 5.83337 2.70898C6.17855 2.70898 6.45837 2.98881 6.45837 3.33398V5.20898H13.5417V3.33398C13.5417 2.98881 13.8215 2.70898 14.1667 2.70898C14.5119 2.70898 14.7917 2.98881 14.7917 3.33398V5.20898H16.6667C17.0119 5.20898 17.2917 5.48881 17.2917 5.83398C17.2917 6.17916 17.0119 6.45898 16.6667 6.45898H14.7917L14.7917 13.5423H16.6667C17.0119 13.5423 17.2917 13.8221 17.2917 14.1673C17.2917 14.5125 17.0119 14.7923 16.6667 14.7923H14.7917V16.6673C14.7917 17.0125 14.5119 17.2923 14.1667 17.2923C13.8215 17.2923 13.5417 17.0125 13.5417 16.6673V14.7923H6.45837V16.6673C6.45837 17.0125 6.17855 17.2923 5.83337 17.2923ZM13.5417 13.5423L13.5417 6.45898H6.45837L6.45837 13.5423H13.5417Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_15920">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,LargeFrameIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M7 20.75C6.58579 20.75 6.25 20.4142 6.25 20V17.75H4C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25H6.25L6.25 7.75H4C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25H6.25V4C6.25 3.58579 6.58579 3.25 7 3.25C7.41421 3.25 7.75 3.58579 7.75 4V6.25H16.25V4C16.25 3.58579 16.5858 3.25 17 3.25C17.4142 3.25 17.75 3.58579 17.75 4V6.25H20C20.4142 6.25 20.75 6.58579 20.75 7C20.75 7.41421 20.4142 7.75 20 7.75H17.75L17.75 16.25H20C20.4142 16.25 20.75 16.5858 20.75 17C20.75 17.4142 20.4142 17.75 20 17.75H17.75V20C17.75 20.4142 17.4142 20.75 17 20.75C16.5858 20.75 16.25 20.4142 16.25 20V17.75H7.75V20C7.75 20.4142 7.41421 20.75 7 20.75ZM16.25 16.25L16.25 7.75H7.75L7.75 16.25H16.25Z"
  />
</svg> `,TextAlignLeftIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.2916 5C17.2916 4.65482 17.0118 4.375 16.6666 4.375H4.16663C3.82145 4.375 3.54163 4.65482 3.54163 5C3.54163 5.34518 3.82145 5.625 4.16663 5.625H16.6666C17.0118 5.625 17.2916 5.34518 17.2916 5ZM11.4583 10C11.4583 9.65482 11.1785 9.375 10.8333 9.375H4.16663C3.82145 9.375 3.54163 9.65482 3.54163 10C3.54163 10.3452 3.82145 10.625 4.16663 10.625H10.8333C11.1785 10.625 11.4583 10.3452 11.4583 10ZM13.9583 15C13.9583 14.6548 13.6785 14.375 13.3333 14.375H4.16663C3.82145 14.375 3.54163 14.6548 3.54163 15C3.54163 15.3452 3.82145 15.625 4.16663 15.625H13.3333C13.6785 15.625 13.9583 15.3452 13.9583 15Z"
  />
</svg>`,TextAlignCenterIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.125 5C3.125 4.65482 3.40482 4.375 3.75 4.375H16.25C16.5952 4.375 16.875 4.65482 16.875 5C16.875 5.34518 16.5952 5.625 16.25 5.625H3.75C3.40482 5.625 3.125 5.34518 3.125 5ZM6.04167 10C6.04167 9.65482 6.32149 9.375 6.66667 9.375H13.3333C13.6785 9.375 13.9583 9.65482 13.9583 10C13.9583 10.3452 13.6785 10.625 13.3333 10.625H6.66667C6.32149 10.625 6.04167 10.3452 6.04167 10ZM5 14.375C4.65482 14.375 4.375 14.6548 4.375 15C4.375 15.3452 4.65482 15.625 5 15.625H15C15.3452 15.625 15.625 15.3452 15.625 15C15.625 14.6548 15.3452 14.375 15 14.375H5Z"
  />
</svg>`,TextAlignRightIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.54163 5C3.54163 4.65482 3.82145 4.375 4.16663 4.375H16.6666C17.0118 4.375 17.2916 4.65482 17.2916 5C17.2916 5.34518 17.0118 5.625 16.6666 5.625H4.16663C3.82145 5.625 3.54163 5.34518 3.54163 5ZM9.37496 10C9.37496 9.65482 9.65478 9.375 9.99996 9.375H16.6666C17.0118 9.375 17.2916 9.65482 17.2916 10C17.2916 10.3452 17.0118 10.625 16.6666 10.625H9.99996C9.65478 10.625 9.37496 10.3452 9.37496 10ZM6.87496 15C6.87496 14.6548 7.15478 14.375 7.49996 14.375H16.6666C17.0118 14.375 17.2916 14.6548 17.2916 15C17.2916 15.3452 17.0118 15.625 16.6666 15.625H7.49996C7.15478 15.625 6.87496 15.3452 6.87496 15Z"
  />
</svg>`,HiddenIcon=x$1`<svg
  width="16"
  height="17"
  viewBox="0 0 16 17"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M6.40665 7.11374C5.37002 7.67894 4.66667 8.77849 4.66667 10.0423C4.66667 11.8833 6.15905 13.3757 8 13.3757C9.26442 13.3757 10.3644 12.6716 10.9294 11.6342M14 10.0423C14 6.72861 11.3137 4.04232 8 4.04232C7.70546 4.04232 7.41587 4.06354 7.13268 4.10454M2 10.0423C2 8.04695 2.97403 6.27907 4.47256 5.18822M2 2.70898L14 14.709"
    stroke="currentColor"
    stroke-width="1.6"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg>`,CardIcon=x$1`<svg
  width="17"
  height="16"
  viewBox="0 0 17 16"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M2 4.66683C2 3.65431 2.82081 2.8335 3.83333 2.8335H13.1667C14.1792 2.8335 15 3.65431 15 4.66683V11.3335C15 12.346 14.1792 13.1668 13.1667 13.1668H3.83333C2.82081 13.1668 2 12.346 2 11.3335V4.66683ZM3.83333 3.8335C3.3731 3.8335 3 4.20659 3 4.66683V11.3335C3 11.7937 3.3731 12.1668 3.83333 12.1668H13.1667C13.6269 12.1668 14 11.7937 14 11.3335V4.66683C14 4.20659 13.6269 3.8335 13.1667 3.8335H3.83333Z"
    fill="currentColor"
  />
</svg> `,HiddenCardIcon=x$1`<svg
  width="17"
  height="16"
  viewBox="0 0 17 16"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8.5 2.5C5.46243 2.5 3 4.96243 3 8C3 11.0376 5.46243 13.5 8.5 13.5C11.5376 13.5 14 11.0376 14 8C14 4.96243 11.5376 2.5 8.5 2.5ZM2 8C2 4.41015 4.91015 1.5 8.5 1.5C12.0899 1.5 15 4.41015 15 8C15 11.5899 12.0899 14.5 8.5 14.5C4.91015 14.5 2 11.5899 2 8Z"
    fill="currentColor"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5 8C5 7.72386 5.22386 7.5 5.5 7.5H11.5C11.7761 7.5 12 7.72386 12 8C12 8.27614 11.7761 8.5 11.5 8.5H5.5C5.22386 8.5 5 8.27614 5 8Z"
    fill="currentColor"
  />
</svg> `,ArrowIcon=x$1`
  <svg
    width="17"
    height="16"
    viewBox="0 0 17 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M12.3702 9.68705C12.175 9.88231 11.8584 9.88231 11.6631 9.68705L8.91906 6.94297C8.78889 6.8128 8.57783 6.8128 8.44766 6.94297L5.70358 9.68705C5.50832 9.88231 5.19173 9.88231 4.99647 9.68705C4.80121 9.49179 4.80121 9.1752 4.99647 8.97994L7.74055 6.23586C8.26125 5.71517 9.10547 5.71516 9.62617 6.23586L12.3702 8.97994C12.5655 9.1752 12.5655 9.49179 12.3702 9.68705Z"
      fill="currentColor"
    />
  </svg>
`,CutIcon=x$1`<svg
  width="8"
  height="8"
  viewBox="0 0 8 8"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M2.71727 5.28335L7.00003 1.33333M4.1083 4.00001L2.71667 2.71667M7.00003 6.66669L5.00002 4.82233M3.00001 2C3.00001 2.55229 2.55229 3.00001 2 3.00001C1.44772 3.00001 1 2.55229 1 2C1 1.44772 1.44772 1 2 1C2.55229 1 3.00001 1.44772 3.00001 2ZM3.00001 6.00002C3.00001 6.55231 2.55229 7.00003 2 7.00003C1.44772 7.00003 1 6.55231 1 6.00002C1 5.44774 1.44772 5.00002 2 5.00002C2.55229 5.00002 3.00001 5.44774 3.00001 6.00002Z"
    stroke="currentColor"
    stroke-width="0.66667"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg> `,ArrowUpIcon=x$1`<svg
  width="8"
  height="4"
  viewBox="0 0 8 4"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M7.22586 3.47595C7.05501 3.64681 6.778 3.64681 6.60714 3.47595L4.20608 1.07489C4.09217 0.960983 3.9075 0.960983 3.7936 1.07489L1.39253 3.47595C1.22168 3.64681 0.944665 3.64681 0.773811 3.47595C0.602957 3.3051 0.602957 3.02809 0.773811 2.85724L3.17488 0.456168C3.63049 0.000556783 4.36918 0.000555735 4.82479 0.456168L7.22586 2.85724C7.39672 3.02809 7.39672 3.3051 7.22586 3.47595Z"
    fill="currentColor"
  />
</svg>`,EdgelessPenIcon=x$1`<svg
  width="22"
  height="66"
  viewBox="0 0 22 66"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  id="edgeless-pen-icon"
>
  <rect y="50" width="22" height="53" fill="url(#paint0_linear_5690_125889)" />
  <path
    d="M0 43.3541V48H22V43.3541C22 41.412 21.7643 39.477 21.2979 37.5916L12.2401 0.970747C12.0991 0.400545 11.5874 0 11 0C10.4126 0 9.90093 0.400544 9.7599 0.970746L0.702074 37.5916C0.235749 39.477 0 41.412 0 43.3541Z"
    fill="url(#paint1_linear_5690_125889)"
  />
  <mask
    id="mask0_5690_125889"
    style="mask-type:alpha"
    maskUnits="userSpaceOnUse"
    x="0"
    y="0"
    width="22"
    height="48"
  >
    <path
      d="M0 42.3795V48H22V42.3795C22 41.0847 21.8428 39.7947 21.532 38.5378L12.2401 0.970747C12.0991 0.400545 11.5874 0 11 0C10.4126 0 9.90093 0.400544 9.7599 0.970746L0.468049 38.5378C0.157166 39.7947 0 41.0847 0 42.3795Z"
      fill="url(#paint2_linear_5690_125889)"
    />
  </mask>
  <g mask="url(#mask0_5690_125889)">
    <rect
      x="6"
      y="-1"
      width="11"
      height="11"
      fill="none"
      class="brush-head-rect"
    />
  </g>
  <rect y="48" width="22" height="2" fill="none" class="brush-midline-rect" />
  <rect
    x="0.5"
    y="48.5"
    width="21"
    height="1"
    stroke="none"
    stroke-opacity="0.1"
    class="brush-midline-stroke"
  />
  <defs>
    <linearGradient
      id="paint0_linear_5690_125889"
      x1="4.66e-07"
      y1="77.7045"
      x2="22"
      y2="77.7045"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#D5F0F8" />
      <stop offset="0.0637281" stop-color="#EBEBEB" />
      <stop offset="0.178482" stop-color="#DADADA" />
      <stop offset="0.48833" stop-color="#F6F6F6" />
      <stop offset="0.757139" stop-color="#EFEFEF" />
      <stop offset="1" stop-color="#DDDDDD" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_5690_125889"
      x1="4.66e-07"
      y1="25.0909"
      x2="22"
      y2="25.0909"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#D5F0F8" />
      <stop offset="0.0637281" stop-color="#EBEBEB" />
      <stop offset="0.178482" stop-color="#DADADA" />
      <stop offset="0.48833" stop-color="#F6F6F6" />
      <stop offset="0.757139" stop-color="#EFEFEF" />
      <stop offset="1" stop-color="#DDDDDD" />
    </linearGradient>
    <linearGradient
      id="paint2_linear_5690_125889"
      x1="4.66e-07"
      y1="25.0909"
      x2="22"
      y2="25.0909"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#DBDBDB" />
      <stop offset="0.0637281" stop-color="#EBEBEB" />
      <stop offset="0.178482" stop-color="#DADADA" />
      <stop offset="0.48833" stop-color="#F6F6F6" />
      <stop offset="0.757139" stop-color="#EFEFEF" />
      <stop offset="1" stop-color="#DDDDDD" />
    </linearGradient>
  </defs>
</svg>`,EdgelessEraserIcon=x$1`<svg
  width="24"
  height="66"
  viewBox="7 0 24 66"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  id="edgeless-eraser-icon"
>
  <g filter="url(#filter0_dd_5690_125897)">
    <g filter="url(#filter1_i_5690_125897)">
      <path
        d="M8 9C8 6.23858 10.2386 4 13 4H25C27.7614 4 30 6.23858 30 9V23H8V9Z"
        fill="#FC3F55"
      />
      <path
        d="M8 9C8 6.23858 10.2386 4 13 4H25C27.7614 4 30 6.23858 30 9V23H8V9Z"
        fill="url(#paint0_linear_5690_125897)"
      />
    </g>
    <rect
      x="8"
      y="23"
      width="22"
      height="19"
      fill="url(#paint1_linear_5690_125897)"
    />
    <g filter="url(#filter2_i_5690_125897)">
      <path
        d="M18.634 29.5C19.0189 28.8333 19.9811 28.8333 20.366 29.5L23.3971 34.75C23.782 35.4167 23.3009 36.25 22.5311 36.25H16.4689C15.6991 36.25 15.218 35.4167 15.6029 34.75L18.634 29.5Z"
        fill="#FF5F56"
      />
    </g>
    <rect
      x="8"
      y="42"
      width="22"
      height="44"
      fill="url(#paint2_linear_5690_125897)"
    />
  </g>
  <rect x="8" y="42" width="22" height="1" fill="#D8D8D8" />
  <defs>
    <filter
      id="filter0_dd_5690_125897"
      x="0"
      y="0"
      width="38"
      height="98"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset dy="2" />
      <feGaussianBlur stdDeviation="2" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_5690_125897"
      />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset dy="4" />
      <feGaussianBlur stdDeviation="4" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"
      />
      <feBlend
        mode="normal"
        in2="effect1_dropShadow_5690_125897"
        result="effect2_dropShadow_5690_125897"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect2_dropShadow_5690_125897"
        result="shape"
      />
    </filter>
    <filter
      id="filter1_i_5690_125897"
      x="8"
      y="4"
      width="22"
      height="20"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset dy="1" />
      <feGaussianBlur stdDeviation="1" />
      <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.795833 0 0 0 0 0.506305 0 0 0 0 0.497396 0 0 0 1 0"
      />
      <feBlend
        mode="normal"
        in2="shape"
        result="effect1_innerShadow_5690_125897"
      />
    </filter>
    <filter
      id="filter2_i_5690_125897"
      x="15.4673"
      y="29"
      width="8.06543"
      height="9.25"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset dy="2" />
      <feGaussianBlur stdDeviation="1" />
      <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
      />
      <feBlend
        mode="normal"
        in2="shape"
        result="effect1_innerShadow_5690_125897"
      />
    </filter>
    <linearGradient
      id="paint0_linear_5690_125897"
      x1="30"
      y1="14"
      x2="8"
      y2="14"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#FF5D56" />
      <stop offset="0.218777" stop-color="#FF635A" />
      <stop offset="0.523472" stop-color="#FF5D54" />
      <stop offset="0.863338" stop-color="#FF5950" />
      <stop offset="0.945621" stop-color="#FFB0AB" />
      <stop offset="1" stop-color="#FF4A40" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_5690_125897"
      x1="8"
      y1="32.9318"
      x2="30"
      y2="32.9318"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#DBDBDB" />
      <stop offset="0.0637281" stop-color="#EBEBEB" />
      <stop offset="0.178482" stop-color="#DADADA" />
      <stop offset="0.48833" stop-color="#F6F6F6" />
      <stop offset="0.757139" stop-color="#EFEFEF" />
      <stop offset="1" stop-color="#DDDDDD" />
    </linearGradient>
    <linearGradient
      id="paint2_linear_5690_125897"
      x1="8"
      y1="65"
      x2="30"
      y2="65"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#DBDBDB" />
      <stop offset="0.0637281" stop-color="#EBEBEB" />
      <stop offset="0.178482" stop-color="#DADADA" />
      <stop offset="0.48833" stop-color="#F6F6F6" />
      <stop offset="0.757139" stop-color="#EFEFEF" />
      <stop offset="1" stop-color="#DDDDDD" />
    </linearGradient>
  </defs>
</svg>`,EdgelessTextIcon=x$1`<svg
  width="50"
  height="36"
  viewBox="0 0 50 36"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <rect x="0.5" y="0.5" width="49" height="35" rx="5.5" fill="#F5F3F7" />
  <path
    d="M24.3527 12.528C22.6247 12.624 21.6807 12.672 21.5207 12.672C21.1367 12.672 20.7527 12.44 20.3687 11.976C19.9847 11.496 19.7927 11 19.7927 10.488C19.7927 9.704 22.0727 9.312 26.6327 9.312C28.9687 9.312 30.6887 9.552 31.7927 10.032C32.8967 10.512 33.4487 11.096 33.4487 11.784C33.4487 11.992 33.3287 12.192 33.0887 12.384C32.8487 12.56 32.5447 12.648 32.1767 12.648C31.8087 12.648 31.1367 12.624 30.1607 12.576C29.1847 12.528 28.2967 12.496 27.4967 12.48C27.5607 12.672 27.5927 12.896 27.5927 13.152C27.5927 13.408 27.4967 13.912 27.3047 14.664C27.1287 15.416 26.8727 16.464 26.5367 17.808C26.2007 19.136 25.8327 20.752 25.4327 22.656C25.0327 24.544 24.7527 25.672 24.5927 26.04C24.4487 26.392 24.3047 26.568 24.1607 26.568C23.8247 26.568 23.4007 26.264 22.8887 25.656C22.3927 25.032 22.1447 24.528 22.1447 24.144C22.1447 23.76 22.4727 22.176 23.1287 19.392C23.7847 16.592 24.1927 14.304 24.3527 12.528Z"
    fill="#FFE838"
  />
  <path
    d="M24.3527 12.528L24.8506 12.5729L24.9025 11.9967L24.3249 12.0288L24.3527 12.528ZM20.3687 11.976L19.9782 12.2884L19.9835 12.2948L20.3687 11.976ZM31.7927 10.032L31.5933 10.4905V10.4905L31.7927 10.032ZM33.0887 12.384L33.3843 12.7872L33.3928 12.781L33.401 12.7744L33.0887 12.384ZM30.1607 12.576L30.1361 13.0754H30.1361L30.1607 12.576ZM27.4967 12.48L27.5067 11.9801L26.7983 11.9659L27.0223 12.6381L27.4967 12.48ZM27.3047 14.664L26.8201 14.5403L26.8178 14.5501L27.3047 14.664ZM26.5367 17.808L27.0214 17.9306L27.0217 17.9293L26.5367 17.808ZM25.4327 22.656L25.9218 22.7596L25.922 22.7588L25.4327 22.656ZM24.5927 26.04L24.134 25.8406L24.1299 25.8507L24.5927 26.04ZM22.8887 25.656L22.4972 25.9671L22.5016 25.9727L22.5062 25.9781L22.8887 25.656ZM23.1287 19.392L23.6153 19.5067L23.6155 19.5061L23.1287 19.392ZM24.3249 12.0288C22.5844 12.1255 21.6624 12.172 21.5207 12.172V13.172C21.6989 13.172 22.6649 13.1225 24.3804 13.0272L24.3249 12.0288ZM21.5207 12.172C21.3535 12.172 21.0969 12.0717 20.7539 11.6572L19.9835 12.2948C20.4084 12.8083 20.9198 13.172 21.5207 13.172V12.172ZM20.7591 11.6637C20.4313 11.2539 20.2927 10.8649 20.2927 10.488H19.2927C19.2927 11.1351 19.538 11.7381 19.9782 12.2883L20.7591 11.6637ZM20.2927 10.488C20.2927 10.5791 20.2176 10.5374 20.4494 10.4179C20.6663 10.306 21.0342 10.1939 21.5874 10.0988C22.684 9.91022 24.3593 9.812 26.6327 9.812V8.812C24.346 8.812 22.6013 8.90977 21.4179 9.11323C20.8311 9.21412 20.344 9.34701 19.991 9.52913C19.6527 9.70359 19.2927 10.0049 19.2927 10.488H20.2927ZM26.6327 9.812C28.9525 9.812 30.587 10.053 31.5933 10.4905L31.992 9.57346C30.7903 9.05097 28.9848 8.812 26.6327 8.812V9.812ZM31.5933 10.4905C32.6608 10.9547 32.9487 11.4164 32.9487 11.784H33.9487C33.9487 10.7756 33.1325 10.0693 31.992 9.57346L31.5933 10.4905ZM32.9487 11.784C32.9487 11.7867 32.9491 11.8008 32.9299 11.8328C32.9085 11.8685 32.8638 11.9236 32.7763 11.9936L33.401 12.7744C33.7012 12.5343 33.9487 12.2056 33.9487 11.784H32.9487ZM32.793 11.9808C32.6573 12.0803 32.4639 12.148 32.1767 12.148V13.148C32.6255 13.148 33.04 13.0397 33.3843 12.7872L32.793 11.9808ZM32.1767 12.148C31.8226 12.148 31.1621 12.1246 30.1852 12.0766L30.1361 13.0754C31.1112 13.1234 31.7947 13.148 32.1767 13.148V12.148ZM30.1852 12.0766C29.2054 12.0284 28.3124 11.9962 27.5067 11.9801L27.4867 12.9799C28.2809 12.9958 29.1639 13.0276 30.1361 13.0754L30.1852 12.0766ZM27.0223 12.6381C27.0655 12.7677 27.0927 12.9362 27.0927 13.152H28.0927C28.0927 12.8558 28.0558 12.5763 27.971 12.3219L27.0223 12.6381ZM27.0927 13.152C27.0927 13.3345 27.015 13.7772 26.8202 14.5403L27.7891 14.7877C27.9783 14.0468 28.0927 13.4815 28.0927 13.152H27.0927ZM26.8178 14.5501C26.6427 15.2984 26.3874 16.3436 26.0516 17.6867L27.0217 17.9293C27.3579 16.5844 27.6146 15.5336 27.7915 14.7779L26.8178 14.5501ZM26.0519 17.6854C25.7137 19.022 25.3442 20.6451 24.9433 22.5532L25.922 22.7588C26.3211 20.8589 26.6876 19.25 27.0214 17.9306L26.0519 17.6854ZM24.9435 22.5524C24.744 23.4939 24.5754 24.2416 24.4374 24.7975C24.2959 25.3674 24.1948 25.701 24.1341 25.8406L25.0512 26.2394C25.1505 26.011 25.2694 25.5966 25.4079 25.0385C25.5499 24.4664 25.7213 23.7061 25.9218 22.7596L24.9435 22.5524ZM24.1299 25.8507C24.0992 25.9258 24.0709 25.9854 24.0457 26.0316C24.0201 26.0784 24.0009 26.1057 23.9897 26.1194C23.9777 26.134 23.9825 26.1239 24.0079 26.1084C24.0368 26.0907 24.0898 26.068 24.1607 26.068V27.068C24.4519 27.068 24.6516 26.8895 24.7636 26.7526C24.8811 26.609 24.9755 26.4248 25.0554 26.2293L24.1299 25.8507ZM24.1607 26.068C24.1405 26.068 24.0528 26.0561 23.882 25.9337C23.7164 25.815 23.5128 25.6209 23.2711 25.3339L22.5062 25.9781C22.7766 26.2991 23.0409 26.561 23.2993 26.7463C23.5525 26.9279 23.8448 27.068 24.1607 27.068V26.068ZM23.2801 25.3449C22.7919 24.7307 22.6447 24.3443 22.6447 24.144H21.6447C21.6447 24.7117 21.9935 25.3333 22.4972 25.9671L23.2801 25.3449ZM22.6447 24.144C22.6447 24.0947 22.6579 23.9617 22.6994 23.7132C22.7388 23.4763 22.7989 23.1624 22.8803 22.7694C23.0429 21.984 23.2877 20.8971 23.6153 19.5067L22.642 19.2773C22.3136 20.6709 22.0664 21.768 21.901 22.5666C21.8184 22.9656 21.7555 23.2937 21.713 23.5488C21.6724 23.7923 21.6447 24.0013 21.6447 24.144H22.6447ZM23.6155 19.5061C24.274 16.6953 24.6877 14.3818 24.8506 12.5729L23.8547 12.4831C23.6976 14.2262 23.2953 16.4887 22.6418 19.2779L23.6155 19.5061Z"
    fill="black"
    fill-opacity="0.3"
  />
  <rect
    x="0.5"
    y="0.5"
    width="49"
    height="35"
    rx="5.5"
    stroke="#E3E2E4"
    stroke-dasharray="2 2"
  />
</svg> `,EdgelessGeneralShapeIcon=x$1`<svg
  width="58"
  height="48"
  viewBox="0 0 58 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  class="shape-icon-shape-group"
>
  <g>
    <g>
      <path
        d="M21.3608 1.8C21.8227 0.999997 22.9774 1 23.4392 1.8L40.7597 31.8C41.2216 32.6 40.6443 33.6 39.7205 33.6H5.07949C4.15573 33.6 3.57838 32.6 4.04026 31.8L21.3608 1.8Z"
      />
      <path
        d="M21.7072 2C22.0151 1.46667 22.7849 1.46667 23.0928 2L40.4133 32C40.7212 32.5333 40.3363 33.2 39.7205 33.2H5.07949C4.46365 33.2 4.07875 32.5333 4.38667 32L21.7072 2Z"
        stroke="black"
        stroke-opacity="0.1"
        stroke-width="0.8"
      />
    </g>
    <g>
      <circle cx="41.6001" cy="19.8008" r="16" />
      <circle
        cx="41.6001"
        cy="19.8008"
        r="15.6"
        stroke="black"
        stroke-opacity="0.1"
        stroke-width="0.8"
      />
    </g>
    <g>
      <rect x="7" y="11.4004" width="45" height="36" rx="1.5" />
      <rect
        x="7.5"
        y="11.9004"
        width="44"
        height="35"
        rx="1"
        stroke="black"
        stroke-opacity="0.1"
      />
    </g>
  </g>
</svg>`,EdgelessImageIcon=x$1`<svg
  width="66"
  height="50"
  viewBox="0 0 66 50"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <g filter="url(#filter0_d_3760_84867)">
    <g clip-path="url(#clip0_3760_84867)">
      <g clip-path="url(#clip1_3760_84867)">
        <g opacity="0.8" filter="url(#filter1_f_3760_84867)">
          <ellipse
            cx="18.0344"
            cy="24.2565"
            rx="18.0344"
            ry="24.2565"
            transform="matrix(-0.155936 -0.987767 0.999908 0.0135939 13.7056 34.4636)"
            fill="#FFCFAC"
          />
        </g>
        <g opacity="0.8" filter="url(#filter2_f_3760_84867)">
          <ellipse
            cx="19.6507"
            cy="19.8311"
            rx="19.6507"
            ry="19.8311"
            transform="matrix(-0.409404 -0.912353 0.978013 -0.208546 8.12207 36.8379)"
            fill="#FF7715"
          />
        </g>
        <g opacity="0.8" filter="url(#filter3_f_3760_84867)">
          <path
            d="M63.5789 9.77916C72.9851 18.853 56.3243 47.3862 52.5954 44.2186C50.3206 42.2863 50.0377 31.0205 43.0574 24.3547C38.5951 20.0935 28.6749 19.6723 22.6336 18.3699C7.14186 15.0301 54.0943 0.629664 63.5789 9.77916Z"
            fill="#DDBC68"
          />
        </g>
      </g>
    </g>
    <rect
      x="0.62962"
      y="1.09053"
      width="49.6656"
      height="33.0444"
      rx="3.56167"
      transform="matrix(0.965926 0.258818 -0.25882 0.965926 13.0395 3.55023)"
      stroke="#E3E2E4"
      stroke-width="1.78084"
    />
    <path
      d="M19.8753 18.8153C19.2887 21.0045 20.6767 23.2781 22.975 23.8939C25.2732 24.5097 27.612 23.2347 28.1986 21.0455C28.7852 18.8563 27.3973 16.5827 25.099 15.9669C22.8007 15.3511 20.4619 16.6261 19.8753 18.8153Z"
      fill="url(#paint0_linear_3760_84867)"
    />
    <path
      d="M39.5992 38.4261L39.23 39.8041C38.985 40.7181 38.8256 41.308 38.6667 41.7469C38.5143 42.1677 38.4088 42.3105 38.3459 42.3777C38.1064 42.6332 37.7867 42.8075 37.4328 42.8756C37.3398 42.8935 37.1561 42.9083 36.6944 42.8223C36.2129 42.7326 35.5929 42.5678 34.6331 42.3107L18.6523 38.0286C17.6925 37.7714 17.0731 37.6042 16.6113 37.4411C16.1685 37.2847 16.0169 37.1801 15.9453 37.1181C15.6728 36.8821 15.4831 36.5714 15.4034 36.2303C15.3825 36.1407 15.3626 35.9642 15.441 35.5236C15.5228 35.0641 15.6797 34.4735 15.9246 33.5595L17.0846 29.2304C17.1673 29.1894 17.2483 29.1503 17.3276 29.1134C17.9411 28.8273 18.5874 28.5994 19.3224 28.561C20.4178 28.5038 21.5121 28.7842 22.4456 29.3613C23.0721 29.7486 23.53 30.2594 23.9312 30.8055C24.1946 31.1639 24.4705 31.5905 24.7719 32.0732L26.8414 30.956C27.6317 30.5292 28.3131 30.1614 28.9008 29.9035C29.5206 29.6315 30.1719 29.4181 30.9073 29.3957C32.0034 29.3623 33.0905 29.6657 34.0102 30.2615C34.6274 30.6613 35.0734 31.1808 35.462 31.7342C35.462 31.7342 38.226 36.2071 39.5992 38.4261Z"
      fill="url(#paint1_linear_3760_84867)"
    />
  </g>
  <g filter="url(#filter4_d_3760_84867)">
    <rect
      x="5.67139"
      y="9.23291"
      width="52.5347"
      height="35.6167"
      rx="4.45209"
      fill="white"
      shape-rendering="crispEdges"
    />
    <g clip-path="url(#clip2_3760_84867)">
      <g clip-path="url(#clip3_3760_84867)">
        <g opacity="0.8" filter="url(#filter5_f_3760_84867)">
          <ellipse
            cx="18.0344"
            cy="24.2565"
            rx="18.0344"
            ry="24.2565"
            transform="matrix(-0.406276 -0.91375 0.969355 -0.245664 15.2515 39.2395)"
            fill="#5076FF"
          />
        </g>
        <g opacity="0.8" filter="url(#filter6_f_3760_84867)">
          <ellipse
            cx="19.6507"
            cy="19.8312"
            rx="19.6507"
            ry="19.8312"
            transform="matrix(-0.631588 -0.775304 0.890712 -0.454568 10.4727 42.9778)"
            fill="#77FFCE"
          />
        </g>
        <g opacity="0.8" filter="url(#filter7_f_3760_84867)">
          <path
            d="M57.0367 2.48772C68.4709 8.81785 59.7628 40.691 55.3411 38.5964C52.6437 37.3187 49.4547 26.51 40.9869 21.878C35.5738 18.9169 25.8826 21.0775 19.71 21.3831C3.88181 22.1667 45.5072 -3.89522 57.0367 2.48772Z"
            fill="#35B7E0"
          />
        </g>
      </g>
    </g>
    <rect
      x="6.5618"
      y="10.1231"
      width="50.7539"
      height="33.8358"
      rx="3.56167"
      stroke="#E3E2E4"
      stroke-width="1.78084"
    />
    <path
      d="M17.1606 22.5276C17.1606 24.7941 19.0897 26.6309 21.4691 26.6309C23.8484 26.6309 25.7776 24.7941 25.7776 22.5276C25.7776 20.2612 23.8484 18.4243 21.4691 18.4243C19.0897 18.4243 17.1606 20.2612 17.1606 22.5276Z"
      fill="url(#paint2_linear_3760_84867)"
    />
    <path
      d="M41.2881 36.3653L41.2881 37.7919C41.2881 38.7382 41.2867 39.3492 41.2468 39.8143C41.2086 40.2602 41.1437 40.4255 41.1002 40.5066C40.935 40.8155 40.6714 41.0666 40.3471 41.2239C40.2619 41.2653 40.0883 41.3271 39.6201 41.3635C39.1318 41.4015 38.4902 41.4028 37.4966 41.4028H20.9521C19.9584 41.4028 19.3169 41.4015 18.8286 41.3635C18.3604 41.3271 18.1868 41.2653 18.1016 41.2239C17.7773 41.0666 17.5137 40.8155 17.3484 40.5066C17.305 40.4255 17.2401 40.2602 17.2018 39.8143C17.1619 39.3492 17.1606 38.7382 17.1606 37.7919L17.1606 33.3102C17.2299 33.2491 17.2981 33.1904 17.3651 33.1342C17.8836 32.6991 18.4489 32.3117 19.149 32.0844C20.1922 31.7456 21.3217 31.7333 22.3729 32.0491C23.0782 32.261 23.6527 32.6359 24.1816 33.0595C24.5288 33.3376 24.9057 33.6783 25.3218 34.0665L27.0315 32.4517C27.6845 31.8349 28.2474 31.3033 28.7484 30.902C29.2767 30.4789 29.8506 30.1042 30.5552 29.8922C31.6052 29.5763 32.7338 29.5879 33.7764 29.9254C34.476 30.1519 35.0412 30.5383 35.5598 30.9722C35.5598 30.9722 39.3873 34.5773 41.2881 36.3653Z"
      fill="url(#paint3_linear_3760_84867)"
    />
  </g>
  <defs>
    <filter
      id="filter0_d_3760_84867"
      x="-0.561671"
      y="-0.561671"
      width="67.0862"
      height="55.1233"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="1.78084" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.14 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_3760_84867"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_3760_84867"
        result="shape"
      />
    </filter>
    <filter
      id="filter1_f_3760_84867"
      x="1.23073"
      y="-10.3352"
      width="67.834"
      height="54.6294"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.74889"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <filter
      id="filter2_f_3760_84867"
      x="-11.0286"
      y="-13.1272"
      width="61.0014"
      height="55.802"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.7489"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <filter
      id="filter3_f_3760_84867"
      x="10.0266"
      y="-2.71654"
      width="65.8896"
      height="56.6772"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.7489"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <filter
      id="filter4_d_3760_84867"
      x="2.10972"
      y="5.67099"
      width="59.658"
      height="42.7403"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="1.78084" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.14 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_3760_84867"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_3760_84867"
        result="shape"
      />
    </filter>
    <filter
      id="filter5_f_3760_84867"
      x="-2.69506"
      y="-10.2244"
      width="68.2656"
      height="54.0517"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.74889"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <filter
      id="filter6_f_3760_84867"
      x="-15.3625"
      y="-8.47509"
      width="62.1758"
      height="54.406"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.7489"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <filter
      id="filter7_f_3760_84867"
      x="6.66676"
      y="-8.01757"
      width="65.5259"
      height="56.2104"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="4.7489"
        result="effect1_foregroundBlur_3760_84867"
      />
    </filter>
    <linearGradient
      id="paint0_linear_3760_84867"
      x1="32.59"
      y1="17.9741"
      x2="26.6427"
      y2="40.1696"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_3760_84867"
      x1="32.59"
      y1="17.9741"
      x2="26.6427"
      y2="40.1696"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <linearGradient
      id="paint2_linear_3760_84867"
      x1="29.2243"
      y1="18.4243"
      x2="29.2243"
      y2="41.4028"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <linearGradient
      id="paint3_linear_3760_84867"
      x1="29.2243"
      y1="18.4243"
      x2="29.2243"
      y2="41.4028"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <clipPath id="clip0_3760_84867">
      <rect
        width="51.4464"
        height="34.8252"
        rx="4.45209"
        transform="matrix(0.965926 0.258818 -0.25882 0.965926 12.7358 3.67603)"
        fill="white"
      />
    </clipPath>
    <clipPath id="clip1_3760_84867">
      <rect
        width="51.4464"
        height="34.8252"
        fill="white"
        transform="matrix(0.965926 0.258818 -0.25882 0.965926 12.7358 3.67603)"
      />
    </clipPath>
    <clipPath id="clip2_3760_84867">
      <rect
        x="5.67139"
        y="9.23267"
        width="52.5347"
        height="35.6167"
        rx="4.45209"
        fill="white"
      />
    </clipPath>
    <clipPath id="clip3_3760_84867">
      <rect
        width="51.4464"
        height="34.8252"
        fill="white"
        transform="translate(6.34619 9.75171)"
      />
    </clipPath>
  </defs>
</svg> `,EdgelessConnectorIcon=x$1`<svg
  width="48"
  height="52"
  viewBox="0 0 48 52"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <rect
    x="11"
    y="35"
    width="26"
    height="10"
    rx="4"
    fill="url(#paint0_linear_4219_85601)"
  />
  <path
    d="M43 15V38C43 39.1046 42.1046 40 41 40H37"
    stroke="#B1A5FF"
    stroke-width="1.5"
  />
  <g filter="url(#filter0_d_4219_85601)">
    <rect x="41" y="24" width="4" height="10" rx="2" fill="#5438FF" />
  </g>
  <circle cx="43" cy="15" r="4" fill="url(#paint1_linear_4219_85601)" />
  <path
    d="M5 4V38C5 39.1045 5.89543 40 7 40H11"
    stroke="#B1A5FF"
    stroke-width="1.5"
  />
  <g filter="url(#filter1_d_4219_85601)">
    <rect x="3" y="17" width="4" height="10" rx="2" fill="#5438FF" />
  </g>
  <path
    d="M4.19187 0.462521C4.56513 -0.154174 5.43487 -0.154173 5.80813 0.462522L8.85362 5.49435C9.25033 6.1498 8.794 7 8.04549 7H1.95451C1.206 7 0.749671 6.1498 1.14638 5.49435L4.19187 0.462521Z"
    fill="url(#paint2_linear_4219_85601)"
  />
  <defs>
    <filter
      id="filter0_d_4219_85601"
      x="38"
      y="21"
      width="10"
      height="16"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="1.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.329412 0 0 0 0 0.219608 0 0 0 0 1 0 0 0 0.45 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_4219_85601"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_4219_85601"
        result="shape"
      />
    </filter>
    <filter
      id="filter1_d_4219_85601"
      x="0"
      y="14"
      width="10"
      height="16"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="1.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.329412 0 0 0 0 0.219608 0 0 0 0 1 0 0 0 0.45 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_4219_85601"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_4219_85601"
        result="shape"
      />
    </filter>
    <linearGradient
      id="paint0_linear_4219_85601"
      x1="24.5"
      y1="45"
      x2="24.5"
      y2="35"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#5438FF" />
      <stop offset="1" stop-color="#B1A5FF" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_4219_85601"
      x1="42.9999"
      y1="10.0026"
      x2="42.9999"
      y2="18.9999"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#5438FF" />
      <stop offset="1" stop-color="#B1A5FF" />
    </linearGradient>
    <linearGradient
      id="paint2_linear_4219_85601"
      x1="4.99992"
      y1="-0.872727"
      x2="4.99992"
      y2="6.99996"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="#5438FF" />
      <stop offset="1" stop-color="#B1A5FF" />
    </linearGradient>
  </defs>
</svg> `,MoreIcon=x$1` <svg
  width="24"
  height="25"
  viewBox="0 0 24 25"
  fill="currentColor"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M5 11.0498C4.17157 11.0498 3.5 11.7214 3.5 12.5498C3.5 13.3782 4.17157 14.0498 5 14.0498C5.82843 14.0498 6.5 13.3782 6.5 12.5498C6.5 11.7214 5.82843 11.0498 5 11.0498Z"
  />
  <path
    d="M12 11.0498C11.1716 11.0498 10.5 11.7214 10.5 12.5498C10.5 13.3782 11.1716 14.0498 12 14.0498C12.8284 14.0498 13.5 13.3782 13.5 12.5498C13.5 11.7214 12.8284 11.0498 12 11.0498Z"
  />
  <path
    d="M19 11.0498C18.1716 11.0498 17.5 11.7214 17.5 12.5498C17.5 13.3782 18.1716 14.0498 19 14.0498C19.8284 14.0498 20.5 13.3782 20.5 12.5498C20.5 11.7214 19.8284 11.0498 19 11.0498Z"
  />
</svg>`,BringToFrontIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M4.16663 2.70898C3.82145 2.70898 3.54163 2.98881 3.54163 3.33398C3.54163 3.67916 3.82145 3.95898 4.16663 3.95898H15.8333C16.1785 3.95898 16.4583 3.67916 16.4583 3.33398C16.4583 2.98881 16.1785 2.70898 15.8333 2.70898H4.16663ZM10.625 16.6673C10.625 17.0125 10.3451 17.2923 9.99996 17.2923C9.65478 17.2923 9.37496 17.0125 9.37496 16.6673L9.37496 8.1762L7.10857 10.4426C6.86449 10.6867 6.46876 10.6867 6.22468 10.4426C5.98061 10.1985 5.98061 9.80279 6.22468 9.55871L9.55802 6.22538C9.67523 6.10817 9.8342 6.04232 9.99996 6.04232C10.1657 6.04232 10.3247 6.10817 10.4419 6.22538L13.7752 9.55871C14.0193 9.80279 14.0193 10.1985 13.7752 10.4426C13.5312 10.6867 13.1354 10.6867 12.8914 10.4426L10.625 8.1762L10.625 16.6673Z"
      fill="currentColor"
    />
  </svg>
`,BringForwardIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_33410)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M14.5894 9.16338C14.3351 9.39686 13.9398 9.38004 13.7063 9.12581L10.625 5.77057L10.625 15.8327C10.625 16.1779 10.3451 16.4577 9.99996 16.4577C9.65478 16.4577 9.37496 16.1779 9.37496 15.8327L9.37496 5.77057L6.29362 9.12581C6.06014 9.38004 5.66477 9.39686 5.41054 9.16338C5.1563 8.9299 5.13948 8.53453 5.37296 8.2803L9.53962 3.74326C9.65799 3.61438 9.82496 3.54102 9.99996 3.54102C10.1749 3.54102 10.3419 3.61438 10.4603 3.74326L14.627 8.2803C14.8604 8.53453 14.8436 8.9299 14.5894 9.16338Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_33410">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,SendBackwardIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_42473)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M14.5894 10.8366C14.3351 10.6031 13.9398 10.62 13.7063 10.8742L10.625 14.2294L10.625 4.16732C10.625 3.82214 10.3451 3.54232 9.99996 3.54232C9.65478 3.54232 9.37496 3.82214 9.37496 4.16732L9.37496 14.2294L6.29362 10.8742C6.06014 10.62 5.66477 10.6031 5.41054 10.8366C5.1563 11.0701 5.13948 11.4655 5.37296 11.7197L9.53962 16.2567C9.65799 16.3856 9.82496 16.459 9.99996 16.459C10.1749 16.459 10.3419 16.3856 10.4603 16.2567L14.627 11.7197C14.8604 11.4655 14.8436 11.0701 14.5894 10.8366Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_42473">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,SendToBackIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_43486)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M10.625 3.33398C10.625 2.98881 10.3451 2.70898 9.99996 2.70898C9.65478 2.70898 9.37496 2.98881 9.37496 3.33398L9.37496 11.8251L7.10857 9.55871C6.86449 9.31463 6.46876 9.31463 6.22468 9.55871C5.98061 9.80279 5.98061 10.1985 6.22468 10.4426L9.55802 13.7759C9.67523 13.8931 9.8342 13.959 9.99996 13.959C10.1657 13.959 10.3247 13.8931 10.4419 13.7759L13.7752 10.4426C14.0193 10.1985 14.0193 9.80279 13.7752 9.55871C13.5312 9.31463 13.1354 9.31463 12.8914 9.55871L10.625 11.8251L10.625 3.33398ZM4.16663 16.0423C3.82145 16.0423 3.54163 16.3221 3.54163 16.6673C3.54163 17.0125 3.82145 17.2923 4.16663 17.2923H15.8333C16.1785 17.2923 16.4583 17.0125 16.4583 16.6673C16.4583 16.3221 16.1785 16.0423 15.8333 16.0423H4.16663Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_43486">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,MoreCopyIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_38897)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M2.70837 5.00065C2.70837 3.735 3.73439 2.70898 5.00004 2.70898H11.6667C12.9324 2.70898 13.9584 3.735 13.9584 5.00065V6.04232H15C16.2657 6.04232 17.2917 7.06833 17.2917 8.33398V15.0007C17.2917 16.2663 16.2657 17.2923 15 17.2923H8.33337C7.06772 17.2923 6.04171 16.2663 6.04171 15.0007V13.959H5.00004C3.73439 13.959 2.70837 12.933 2.70837 11.6673V5.00065ZM7.29171 15.0007C7.29171 15.5759 7.75808 16.0423 8.33337 16.0423H15C15.5753 16.0423 16.0417 15.5759 16.0417 15.0007V8.33398C16.0417 7.75869 15.5753 7.29232 15 7.29232H8.33337C7.75808 7.29232 7.29171 7.75869 7.29171 8.33398V15.0007ZM12.7084 6.04232H8.33337C7.06772 6.04232 6.04171 7.06833 6.04171 8.33398V12.709H5.00004C4.42474 12.709 3.95837 12.2426 3.95837 11.6673V5.00065C3.95837 4.42535 4.42474 3.95898 5.00004 3.95898H11.6667C12.242 3.95898 12.7084 4.42535 12.7084 5.00065V6.04232Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_38897">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,CopyAsPngIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_42427)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M6.66671 1.875C5.40105 1.875 4.37504 2.90101 4.37504 4.16667V6.66667C4.37504 7.01184 4.65486 7.29167 5.00004 7.29167C5.34522 7.29167 5.62504 7.01184 5.62504 6.66667V4.16667C5.62504 3.59137 6.09141 3.125 6.66671 3.125H10.8334H12.9349C13.2563 3.125 13.5598 3.27341 13.7571 3.52714L15.8223 6.18232C15.9645 6.36517 16.0417 6.5902 16.0417 6.82185V10V15C16.0417 15.5753 15.5753 16.0417 15 16.0417H6.66671C6.09141 16.0417 5.62504 15.5753 5.62504 15V13.75C5.62504 13.4048 5.34522 13.125 5.00004 13.125C4.65486 13.125 4.37504 13.4048 4.37504 13.75V15C4.37504 16.2657 5.40105 17.2917 6.66671 17.2917H15C16.2657 17.2917 17.2917 16.2657 17.2917 15V10V6.82185C17.2917 6.31223 17.1218 5.81716 16.809 5.4149L14.7438 2.75972C14.3097 2.2015 13.6421 1.875 12.9349 1.875H10.8334H6.66671ZM2.32751 11.6024C2.32751 11.9491 2.5155 12.1444 2.84509 12.1444C3.17468 12.1444 3.36267 11.9491 3.36267 11.6024V11.1214H3.8656C4.68835 11.1214 5.24744 10.6209 5.24744 9.84456C5.24744 9.06087 4.72009 8.56038 3.9364 8.56038H2.84509C2.5155 8.56038 2.32751 8.7557 2.32751 9.10238V11.6024ZM3.6532 10.3573H3.36267V9.33919H3.66052C3.99744 9.33919 4.20251 9.51253 4.20251 9.847C4.20251 10.1839 3.99744 10.3573 3.6532 10.3573ZM5.61365 11.6317C5.61365 11.9637 5.79187 12.1444 6.10193 12.1444C6.40955 12.1444 6.59021 11.9637 6.59021 11.6317V10.2279H6.60974L7.81335 11.8612C7.95984 12.0614 8.099 12.1444 8.29675 12.1444C8.60437 12.1444 8.77283 11.9759 8.77283 11.6659V9.01204C8.77283 8.68001 8.5946 8.49935 8.28455 8.49935C7.97693 8.49935 7.79626 8.68001 7.79626 9.01204V10.3866H7.77673L6.58289 8.78255C6.43396 8.5848 6.28992 8.49935 6.10193 8.49935C5.78455 8.49935 5.61365 8.66536 5.61365 8.97786V11.6317ZM9.17566 10.3182C9.17566 11.4876 9.83728 12.1444 10.9554 12.1444C12.0052 12.1444 12.5863 11.4998 12.5863 10.6624C12.5863 10.3158 12.3983 10.1204 12.0687 10.1204H11.3876C11.1532 10.1204 11.0043 10.2425 11.0043 10.4647C11.0043 10.6868 11.1556 10.8089 11.3876 10.8089H11.5902L11.5853 10.8577C11.556 11.141 11.3168 11.3289 10.9799 11.3289C10.5258 11.3289 10.2303 10.9456 10.2303 10.3035C10.2303 9.67611 10.4891 9.31478 10.9286 9.31478C11.1776 9.31478 11.3461 9.40755 11.5121 9.62972C11.639 9.79818 11.7928 9.8763 11.9955 9.8763C12.2592 9.8763 12.4398 9.69808 12.4398 9.43929C12.4398 9.3514 12.4203 9.26839 12.369 9.17318C12.1615 8.80208 11.6293 8.49935 10.9237 8.49935C9.83728 8.49935 9.17566 9.16341 9.17566 10.3182Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_42427">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,MoreDuplicateIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_38947)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M5.00004 2.70898C3.73439 2.70898 2.70837 3.735 2.70837 5.00065V11.6673C2.70837 12.933 3.73439 13.959 5.00004 13.959H6.04171V15.0007C6.04171 16.2663 7.06772 17.2923 8.33337 17.2923H15C16.2657 17.2923 17.2917 16.2663 17.2917 15.0007V8.33398C17.2917 7.06833 16.2657 6.04232 15 6.04232H13.9584V5.00065C13.9584 3.735 12.9324 2.70898 11.6667 2.70898H5.00004ZM8.33337 6.04232H12.7084V5.00065C12.7084 4.42535 12.242 3.95898 11.6667 3.95898H5.00004C4.42474 3.95898 3.95837 4.42535 3.95837 5.00065V11.6673C3.95837 12.2426 4.42474 12.709 5.00004 12.709H6.66671C7.01189 12.709 7.29171 12.9888 7.29171 13.334V15.0007C7.29171 15.5759 7.75808 16.0423 8.33337 16.0423H15C15.5753 16.0423 16.0417 15.5759 16.0417 15.0007V8.33398C16.0417 7.75869 15.5753 7.29232 15 7.29232H13.3334H8.33337C7.88805 7.29232 7.50649 7.57205 7.35782 7.96752C7.23635 8.29062 6.87596 8.45408 6.55286 8.33261C6.22976 8.21114 6.0663 7.85075 6.18777 7.52765C6.51365 6.66078 7.3505 6.04232 8.33337 6.04232ZM10.7393 8.74146C10.5041 8.48881 10.1086 8.47466 9.85599 8.70986C9.60334 8.94505 9.58919 9.34052 9.82438 9.59317L10.3976 10.209H6.50003C6.15485 10.209 5.87503 10.4888 5.87503 10.834C5.87503 11.1792 6.15485 11.459 6.50003 11.459H10.3976L9.82438 12.0748C9.58919 12.3274 9.60334 12.7229 9.85599 12.9581C10.1086 13.1933 10.5041 13.1792 10.7393 12.9265L12.2908 11.2598C12.5142 11.0199 12.5142 10.6481 12.2908 10.4081L10.7393 8.74146Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_38947">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,MoreDeleteIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_12840_42716)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M9.16667 1.875C7.90101 1.875 6.875 2.90101 6.875 4.16667V5.12492H3.33333C2.94213 5.12492 2.625 5.44205 2.625 5.83325C2.625 6.22445 2.94213 6.54159 3.33333 6.54159H3.59066L4.26602 15.9966C4.35168 17.1958 5.34957 18.125 6.55186 18.125H13.4481C14.6504 18.125 15.6483 17.1959 15.734 15.9966L16.4093 6.54159H16.6667C17.0579 6.54159 17.375 6.22445 17.375 5.83325C17.375 5.44205 17.0579 5.12492 16.6667 5.12492H13.125V4.16667C13.125 2.90101 12.099 1.875 10.8333 1.875H9.16667ZM11.875 5.12492V4.16667C11.875 3.59137 11.4086 3.125 10.8333 3.125H9.16667C8.59137 3.125 8.125 3.59137 8.125 4.16667V5.12492H11.875ZM15.1562 6.54159H4.84385L5.51285 15.9075C5.55178 16.4527 6.00537 16.875 6.55186 16.875H13.4481C13.9946 16.875 14.4482 16.4527 14.4872 15.9075L15.1562 6.54159ZM8.95833 9.16667C8.95833 8.82149 8.67851 8.54167 8.33333 8.54167C7.98815 8.54167 7.70833 8.82149 7.70833 9.16667V14.1667C7.70833 14.5118 7.98815 14.7917 8.33333 14.7917C8.67851 14.7917 8.95833 14.5118 8.95833 14.1667V9.16667ZM11.6667 8.54167C12.0118 8.54167 12.2917 8.82149 12.2917 9.16667V14.1667C12.2917 14.5118 12.0118 14.7917 11.6667 14.7917C11.3215 14.7917 11.0417 14.5118 11.0417 14.1667V9.16667C11.0417 8.82149 11.3215 8.54167 11.6667 8.54167Z"
        fill="currentColor"
      />
    </g>
    <defs>
      <clipPath id="clip0_12840_42716">
        <rect width="20" height="20" fill="white" />
      </clipPath>
    </defs>
  </svg>
`,SmallArrowDownIcon=x$1`<svg
  width="16"
  height="16"
  viewBox="0 0 16 16"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.31344 6.31295C4.5087 6.11769 4.82528 6.11769 5.02055 6.31295L7.76462 9.05703C7.8948 9.1872 8.10585 9.1872 8.23603 9.05703L10.9801 6.31295C11.1754 6.11769 11.492 6.11769 11.6872 6.31295C11.8825 6.50821 11.8825 6.8248 11.6872 7.02006L8.94313 9.76414C8.42244 10.2848 7.57822 10.2848 7.05752 9.76414L4.31344 7.02006C4.11818 6.8248 4.11818 6.50821 4.31344 6.31295Z"
    fill="currentColor"
  />
</svg>`,GeneralShapeStyleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M3.39177 2.9553C3.6006 2.68046 3.9927 2.62696 4.26753 2.83579C9.95831 7.15993 14.1901 12.9846 15.8532 16.3578C16.0058 16.6674 15.8786 17.0421 15.569 17.1948C15.2594 17.3474 14.8847 17.2202 14.7321 16.9106C13.1515 13.7047 9.04214 8.0337 3.51127 3.83107C3.23644 3.62223 3.18293 3.23014 3.39177 2.9553Z"
  />
</svg> `,ScribbledShapeStyleIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M2.7244 3.19359C2.80201 2.85725 3.13759 2.64751 3.47393 2.72513C8.98708 3.99739 13.9297 6.80233 16.2292 8.68373C16.5303 8.93011 16.7797 9.18308 16.9343 9.44907C17.0965 9.72811 17.1885 10.0903 17.0251 10.4573C16.8794 10.7848 16.5897 10.972 16.3532 11.0832C16.1035 11.2007 15.8045 11.2839 15.4933 11.3483C14.8692 11.4775 14.0641 11.5565 13.211 11.6286C13.0041 11.646 12.7937 11.6632 12.5807 11.6805C11.8997 11.7359 11.1915 11.7936 10.4857 11.872C8.6165 12.0797 7.12382 12.3464 6.2104 12.666C5.84171 12.795 5.63227 12.9113 5.52734 12.9914C5.86905 13.3958 6.43971 13.7994 7.16558 14.1805C7.90858 14.5706 8.76171 14.9103 9.57823 15.191C10.3927 15.4709 11.1581 15.6879 11.7206 15.8349C12.0015 15.9083 12.2308 15.964 12.3891 16.0013C12.4683 16.0199 12.5296 16.0338 12.5708 16.043L12.617 16.0533L12.6281 16.0557L12.6306 16.0562C12.9681 16.1286 13.1835 16.4609 13.1112 16.7984C13.0389 17.1359 12.7066 17.3509 12.3691 17.2786L12.5001 16.6675C12.3691 17.2786 12.3692 17.2786 12.3691 17.2786L12.3674 17.2782L12.3635 17.2774L12.3495 17.2743L12.2975 17.2628C12.2524 17.2527 12.1868 17.2377 12.1032 17.2181C11.936 17.1788 11.6966 17.1206 11.4045 17.0443C10.8212 16.8918 10.0241 16.6661 9.17188 16.3731C8.32174 16.0809 7.40404 15.7175 6.58454 15.2872C5.77645 14.863 5.00904 14.3458 4.51201 13.7246C4.35483 13.5281 4.22952 13.2782 4.22579 12.9843C4.22198 12.6841 4.34606 12.4334 4.50705 12.2436C4.80009 11.8982 5.29046 11.6635 5.79762 11.4861C6.85378 11.1166 8.46695 10.8386 10.3477 10.6296C11.0736 10.549 11.8076 10.4892 12.492 10.4336C12.7018 10.4165 12.9069 10.3998 13.1057 10.383C13.9678 10.3102 14.7002 10.236 15.2399 10.1243C15.4794 10.0747 15.6554 10.0226 15.7766 9.97188C15.7097 9.89286 15.6027 9.78628 15.4376 9.65118C13.2821 7.88756 8.51304 5.17085 3.19285 3.94312C2.85651 3.8655 2.64678 3.52992 2.7244 3.19359Z"
  />
</svg> `,ChangeShapeIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
  fill="currentColor"
>
  <g clip-path="url(#clip0_12129_30774)">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M9.99992 2.70898C10.2242 2.70898 10.4313 2.82916 10.5426 3.0239L13.5055 8.20908C13.6161 8.40252 13.6153 8.64018 13.5035 8.83287C13.3916 9.02557 13.1857 9.14417 12.9629 9.14417H7.03696C6.81416 9.14417 6.60821 9.02557 6.49639 8.83287C6.38456 8.64018 6.38377 8.40252 6.4943 8.20908L9.45727 3.0239C9.56854 2.82916 9.77563 2.70898 9.99992 2.70898ZM8.11394 7.89417H11.8859L9.99992 4.59371L8.11394 7.89417ZM5.92584 12.1071C4.83917 12.1071 3.95825 12.9881 3.95825 14.0747C3.95825 15.1614 4.83917 16.0423 5.92584 16.0423C7.01252 16.0423 7.89344 15.1614 7.89344 14.0747C7.89344 12.9881 7.01252 12.1071 5.92584 12.1071ZM2.70825 14.0747C2.70825 12.2977 4.14882 10.8571 5.92584 10.8571C7.70287 10.8571 9.14344 12.2977 9.14344 14.0747C9.14344 15.8518 7.70287 17.2923 5.92584 17.2923C4.14882 17.2923 2.70825 15.8518 2.70825 14.0747ZM10.8564 11.4821C10.8564 11.137 11.1362 10.8571 11.4814 10.8571H16.6666C17.0118 10.8571 17.2916 11.137 17.2916 11.4821V16.6673C17.2916 17.0125 17.0118 17.2923 16.6666 17.2923H11.4814C11.1362 17.2923 10.8564 17.0125 10.8564 16.6673V11.4821ZM12.1064 12.1071V16.0423H16.0416V12.1071H12.1064Z"
    />
  </g>
  <defs>
    <clipPath id="clip0_12129_30774">
      <rect width="20" height="20" fill="white" />
    </clipPath>
  </defs>
</svg>`,ArrowRightSmallIcon=b$1`<svg 
  xmlns="http://www.w3.org/2000/svg" 
  width="16" 
  height="16" 
  viewBox="0 0 24 24" 
  fill="none"
>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M8.46967 6.46967C8.17678 6.76256 8.17678 7.23744 8.46967 7.53033L12.9393 12L8.46967 16.4697C8.17678 16.7626 8.17678 17.2374 8.46967 17.5303C8.76256 17.8232 9.23744 17.8232 9.53033 17.5303L14.5303 12.5303C14.8232 12.2374 14.8232 11.7626 14.5303 11.4697L9.53033 6.46967C9.23744 6.17678 8.76256 6.17678 8.46967 6.46967Z" fill="currentColor"/>
</svg>`,CloseIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M5.46967 5.46967C5.76256 5.17678 6.23744 5.17678 6.53033 5.46967L12 10.9393L17.4697 5.46967C17.7626 5.17678 18.2374 5.17678 18.5303 5.46967C18.8232 5.76256 18.8232 6.23744 18.5303 6.53033L13.0607 12L18.5303 17.4697C18.8232 17.7626 18.8232 18.2374 18.5303 18.5303C18.2374 18.8232 17.7626 18.8232 17.4697 18.5303L12 13.0607L6.53033 18.5303C6.23744 18.8232 5.76256 18.8232 5.46967 18.5303C5.17678 18.2374 5.17678 17.7626 5.46967 17.4697L10.9393 12L5.46967 6.53033C5.17678 6.23744 5.17678 5.76256 5.46967 5.46967Z"
      fill="currentColor"
    />
  </svg>
`,ExportToMarkdownIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8 2.25C6.48122 2.25 5.25 3.48122 5.25 5V8C5.25 8.41421 5.58579 8.75 6 8.75C6.41421 8.75 6.75 8.41421 6.75 8V5C6.75 4.30964 7.30964 3.75 8 3.75H13H15.5218C15.9076 3.75 16.2717 3.92809 16.5085 4.23257L18.9867 7.41879C19.1573 7.63821 19.25 7.90825 19.25 8.18622V12V18C19.25 18.6904 18.6904 19.25 18 19.25H8C7.30964 19.25 6.75 18.6904 6.75 18V16.5C6.75 16.0858 6.41421 15.75 6 15.75C5.58579 15.75 5.25 16.0858 5.25 16.5V18C5.25 19.5188 6.48122 20.75 8 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V12V8.18622C20.75 7.57468 20.5462 6.98059 20.1707 6.49788L17.6926 3.31166C17.1715 2.6418 16.3705 2.25 15.5218 2.25H13H8ZM2.76855 13.8408C2.76855 14.1765 2.94849 14.3672 3.26538 14.3672C3.58228 14.3672 3.76221 14.1765 3.76221 13.8408V12.0549H3.78369L4.55444 13.9966C4.62964 14.1899 4.76123 14.2812 4.96533 14.2812C5.16675 14.2812 5.29028 14.1926 5.36816 13.9966L6.13892 12.0549H6.1604V13.8408C6.1604 14.1765 6.34033 14.3672 6.65723 14.3672C6.97412 14.3672 7.15405 14.1765 7.15405 13.8408V11.1042C7.15405 10.6262 6.89087 10.3577 6.41553 10.3577C6.01538 10.3577 5.80322 10.5161 5.64209 10.9377L4.97339 12.686H4.9519L4.28052 10.9377C4.11938 10.5161 3.90723 10.3577 3.50708 10.3577C3.03174 10.3577 2.76855 10.6262 2.76855 11.1042V13.8408ZM7.69385 13.7039C7.69385 14.0852 7.90063 14.3 8.26318 14.3H9.35083C10.5244 14.3 11.2173 13.575 11.2173 12.3342C11.2173 11.0935 10.5271 10.4248 9.35083 10.4248H8.26318C7.90063 10.4248 7.69385 10.6396 7.69385 11.021V13.7039ZM9.1897 13.395H8.83252V11.3298H9.1897C9.73486 11.3298 10.0571 11.6816 10.0571 12.3342C10.0571 13.0486 9.75903 13.395 9.1897 13.395Z"
    fill="currentColor"
  />
</svg> `,ExportToHTMLIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M8 2.25C6.48122 2.25 5.25 3.48122 5.25 5V8C5.25 8.41421 5.58579 8.75 6 8.75C6.41421 8.75 6.75 8.41421 6.75 8V5C6.75 4.30964 7.30964 3.75 8 3.75H15.5218C15.9076 3.75 16.2717 3.92809 16.5085 4.23257L18.9867 7.41879C19.1573 7.63821 19.25 7.90825 19.25 8.18622V18C19.25 18.6904 18.6904 19.25 18 19.25H8C7.30964 19.25 6.75 18.6904 6.75 18V16.5C6.75 16.0858 6.41421 15.75 6 15.75C5.58579 15.75 5.25 16.0858 5.25 16.5V18C5.25 19.5188 6.48122 20.75 8 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V8.18622C20.75 7.57468 20.5462 6.98059 20.1707 6.49788L17.6926 3.31166C17.1715 2.6418 16.3705 2.25 15.5218 2.25H8ZM2.76855 13.771C2.76855 14.1523 2.97534 14.3672 3.33789 14.3672C3.70044 14.3672 3.90723 14.1523 3.90723 13.771V12.8015H5.27148V13.771C5.27148 14.1523 5.47827 14.3672 5.84082 14.3672C6.20337 14.3672 6.41016 14.1523 6.41016 13.771V10.9539C6.41016 10.5725 6.20337 10.3577 5.84082 10.3577C5.47827 10.3577 5.27148 10.5725 5.27148 10.9539V11.8965H3.90723V10.9539C3.90723 10.5725 3.70044 10.3577 3.33789 10.3577C2.97534 10.3577 2.76855 10.5725 2.76855 10.9539V13.771ZM7.82007 13.771C7.82007 14.1523 8.02686 14.3672 8.3894 14.3672C8.75195 14.3672 8.95874 14.1523 8.95874 13.771V11.3325H9.53076C9.83154 11.3325 10.033 11.1687 10.033 10.8787C10.033 10.5886 9.83691 10.4248 9.53076 10.4248H7.24805C6.94189 10.4248 6.74585 10.5886 6.74585 10.8787C6.74585 11.1687 6.94727 11.3325 7.24805 11.3325H7.82007V13.771ZM10.8655 14.3672C10.5486 14.3672 10.3687 14.1765 10.3687 13.8408V11.1042C10.3687 10.6262 10.6318 10.3577 11.1072 10.3577C11.5073 10.3577 11.7195 10.5161 11.8806 10.9377L12.552 12.686H12.5735L13.2422 10.9377C13.4033 10.5161 13.6155 10.3577 14.0156 10.3577C14.491 10.3577 14.7542 10.6262 14.7542 11.1042V13.8408C14.7542 14.1765 14.5742 14.3672 14.2573 14.3672C13.9404 14.3672 13.7605 14.1765 13.7605 13.8408V12.0549H13.739L12.9683 13.9966C12.8904 14.1926 12.7668 14.2812 12.5654 14.2812C12.3613 14.2812 12.2297 14.1899 12.1545 13.9966L11.3838 12.0549H11.3623V13.8408C11.3623 14.1765 11.1824 14.3672 10.8655 14.3672ZM15.2939 13.7039C15.2939 14.0852 15.5007 14.3 15.8633 14.3H17.5042C17.8103 14.3 18.0063 14.1362 18.0063 13.8462C18.0063 13.5562 17.8049 13.3923 17.5042 13.3923H16.4326V10.9539C16.4326 10.5725 16.2258 10.3577 15.8633 10.3577C15.5007 10.3577 15.2939 10.5725 15.2939 10.9539V13.7039Z"
    fill="currentColor"
  />
</svg> `,NotionIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M6.26795 6.19873C6.83575 6.65959 7.04771 6.62458 8.11333 6.55361L18.1589 5.9508C18.3728 5.9508 18.1949 5.7369 18.1239 5.70189L16.4555 4.49627C16.1356 4.24834 15.7097 3.96346 14.894 4.03444L5.16636 4.7442C4.81245 4.7792 4.74147 4.95713 4.88245 5.09908L6.26795 6.19873ZM6.87076 8.53997V19.1086C6.87076 19.6774 7.15466 19.8893 7.79442 19.8543L18.8336 19.2156C19.4724 19.1806 19.5434 18.7897 19.5434 18.3288V7.83021C19.5434 7.36935 19.3664 7.12044 18.9756 7.15642L7.43857 7.83021C7.01271 7.86521 6.87076 8.07814 6.87076 8.53997ZM17.77 9.1068C17.84 9.42571 17.77 9.74559 17.4491 9.78156L16.9173 9.88754V17.6901C16.4555 17.939 16.0296 18.0809 15.6747 18.0809C15.1069 18.0809 14.965 17.903 14.5391 17.3712L11.0593 11.9089V17.1942L12.1609 17.4421C12.1609 17.4421 12.1609 18.0809 11.2723 18.0809L8.82309 18.2229C8.75211 18.0809 8.82309 17.727 9.07199 17.6551L9.71078 17.4781V10.4904L8.82309 10.4194C8.75211 10.0995 8.93004 9.63864 9.42687 9.60267L12.054 9.42668L15.6747 14.9589V10.0655L14.7511 9.95949C14.6811 9.56864 14.965 9.2857 15.3198 9.24973L17.77 9.1068ZM4.34964 3.78651L14.4672 3.04175C15.7087 2.9348 16.0286 3.00674 16.8103 3.57358L20.0393 5.84385C20.5721 6.23373 20.75 6.33971 20.75 6.76556V19.2156C20.75 19.9963 20.4661 20.4572 19.4724 20.5281L7.72247 21.2379C6.97673 21.2729 6.62185 21.1669 6.231 20.6701L3.85281 17.5841C3.42695 17.0163 3.25 16.5914 3.25 16.0936V5.02811C3.25 4.38932 3.53293 3.85749 4.34964 3.78651Z"
      fill="currentColor"
    />
  </svg>
`,NewIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M7.43531 5.11765C7.43531 3.53389 8.7192 2.25 10.303 2.25C11.1416 2.25 11.8962 2.61004 12.4206 3.18398C12.945 2.61004 13.6996 2.25 14.5382 2.25C16.122 2.25 17.4059 3.53389 17.4059 5.11765C17.4059 5.61288 17.2804 6.07879 17.0594 6.48529H19.8912C20.8577 6.48529 21.6412 7.2688 21.6412 8.23529V10.4706C21.6412 11.1916 21.2051 11.8108 20.5824 12.0788V19C20.5824 20.5188 19.3511 21.75 17.8324 21.75H7.00884C5.49006 21.75 4.25884 20.5188 4.25884 19V12.0788C3.63606 11.8108 3.20001 11.1916 3.20001 10.4706V8.2353C3.20001 7.2688 3.98351 6.48529 4.95001 6.48529H7.78183C7.56084 6.07879 7.43531 5.61288 7.43531 5.11765ZM10.303 6.48529H11.6706V5.11765C11.6706 4.36232 11.0583 3.75 10.303 3.75C9.54762 3.75 8.93531 4.36232 8.93531 5.11765C8.93531 5.87298 9.54762 6.48529 10.303 6.48529ZM13.1706 5.11765V6.48529H14.5382C15.2936 6.48529 15.9059 5.87298 15.9059 5.11765C15.9059 4.36232 15.2936 3.75 14.5382 3.75C13.7829 3.75 13.1706 4.36232 13.1706 5.11765ZM4.95001 7.98529C4.81194 7.98529 4.70001 8.09722 4.70001 8.2353V10.4706C4.70001 10.6087 4.81194 10.7206 4.95001 10.7206H19.8912C20.0293 10.7206 20.1412 10.6087 20.1412 10.4706V8.23529C20.1412 8.09722 20.0293 7.98529 19.8912 7.98529H4.95001ZM5.75884 12.2206V19C5.75884 19.6904 6.31848 20.25 7.00884 20.25H11.6706V12.2206H5.75884ZM13.1706 12.2206V20.25H17.8324C18.5227 20.25 19.0824 19.6904 19.0824 19V12.2206H13.1706Z"
    fill="currentColor"
  />
</svg>`,HelpIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.75 12C3.75 7.44365 7.44365 3.75 12 3.75C16.5563 3.75 20.25 7.44365 20.25 12C20.25 16.5563 16.5563 20.25 12 20.25C7.44365 20.25 3.75 16.5563 3.75 12ZM12 2.25C6.61522 2.25 2.25 6.61522 2.25 12C2.25 17.3848 6.61522 21.75 12 21.75C17.3848 21.75 21.75 17.3848 21.75 12C21.75 6.61522 17.3848 2.25 12 2.25ZM12.2385 10.9834C11.3157 11.708 10.9944 12.166 10.9944 12.9727C10.9944 13.4102 11.2678 13.7383 11.7668 13.7383C12.2454 13.7383 12.4231 13.4648 12.594 13.0615C12.7512 12.4873 12.9768 12.248 13.6399 11.7422C14.5149 11.0928 15.0959 10.5117 15.0959 9.45215C15.0959 7.92773 13.845 6.99121 12.0471 6.99121C11.0764 6.99121 10.3313 7.24414 9.83228 7.66797C9.42212 8.03027 9.15552 8.50879 9.15552 8.95996C9.15552 9.33594 9.39478 9.64355 9.82544 9.64355C10.1125 9.64355 10.2766 9.51367 10.4885 9.2334C10.8167 8.67285 11.2678 8.41992 11.9241 8.41992C12.676 8.41992 13.2708 8.86426 13.2708 9.53418C13.2708 10.1357 12.9016 10.4639 12.2385 10.9834ZM11.7668 14.709C11.1995 14.709 10.7346 15.1055 10.7346 15.6729C10.7346 16.2402 11.1995 16.6367 11.7668 16.6367C12.3342 16.6367 12.8059 16.2402 12.8059 15.6729C12.8059 15.1055 12.3342 14.709 11.7668 14.709Z"
    fill="currentColor"
  />
</svg> `,ImportIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M12 3.25C12.4142 3.25 12.75 3.58579 12.75 4L12.75 14.1893L15.4697 11.4697C15.7626 11.1768 16.2374 11.1768 16.5303 11.4697C16.8232 11.7626 16.8232 12.2374 16.5303 12.5303L12.5303 16.5303C12.2374 16.8232 11.7626 16.8232 11.4697 16.5303L7.46967 12.5303C7.17678 12.2374 7.17678 11.7626 7.46967 11.4697C7.76256 11.1768 8.23744 11.1768 8.53033 11.4697L11.25 14.1893L11.25 4C11.25 3.58579 11.5858 3.25 12 3.25ZM4 15.25C4.41421 15.25 4.75 15.5858 4.75 16V17C4.75 18.2426 5.75736 19.25 7 19.25H17C18.2426 19.25 19.25 18.2426 19.25 17V16C19.25 15.5858 19.5858 15.25 20 15.25C20.4142 15.25 20.75 15.5858 20.75 16V17C20.75 19.0711 19.0711 20.75 17 20.75H7C4.92893 20.75 3.25 19.0711 3.25 17V16C3.25 15.5858 3.58579 15.25 4 15.25Z"
      fill="currentColor"
    />
  </svg>
`;function fontIcon(k,_=20){const y=_/16,w=`
    width: ${y}em;
    height: ${y}em;
    vertical-align: middle;
    font-size: inherit;
    margin-bottom: 0.1em;
  `;return x$1`<svg
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
    style=${w}
  >
    ${k}
  </svg>`}function icon(k,_=24){return x$1`<svg
    width="${_}"
    height="${_}"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    ${k}
  </svg>`}const TagsSVG=b$1`<path fill-rule="evenodd" clip-rule="evenodd" d="M8.26257 2.48082C7.85697 2.49584 7.54034 2.83683 7.55536 3.24243C7.57038 3.64803 7.91137 3.96466 8.31697 3.94964L12.5926 3.79128C12.9329 3.77867 13.2632 3.90835 13.504 4.14919L19.8106 10.4558C20.0976 10.7428 20.5629 10.7428 20.8499 10.4558C21.1369 10.1688 21.1369 9.70348 20.8499 9.41648L14.5433 3.10987C14.0135 2.58003 13.287 2.29473 12.5382 2.32247L8.26257 2.48082ZM7.72668 6.72224C6.0604 6.78396 4.72384 8.12053 4.66212 9.7868L4.53585 13.1963C4.52324 13.5366 4.65292 13.8669 4.89376 14.1077L10.5116 19.7256C10.99 20.2039 11.7655 20.2039 12.2438 19.7256L17.6655 14.304C18.1438 13.8256 18.1438 13.0501 17.6655 12.5718L12.0476 6.95388C11.8068 6.71304 11.4765 6.58336 11.1362 6.59597L7.72668 6.72224ZM3.19331 9.7324C3.28351 7.29707 5.23695 5.34363 7.67228 5.25343L11.0818 5.12716C11.8305 5.09942 12.5571 5.38472 13.0869 5.91456L18.7048 11.5324C19.7571 12.5848 19.7571 14.2909 18.7048 15.3433L13.2832 20.7649C12.2308 21.8173 10.5246 21.8173 9.47232 20.7649L3.85444 15.147C3.3246 14.6172 3.0393 13.8907 3.06703 13.1419L3.19331 9.7324ZM7.8664 8.75593C8.18961 9.07914 8.18961 9.60317 7.8664 9.92638C7.54319 10.2496 7.01916 10.2496 6.69595 9.92638C6.37274 9.60317 6.37274 9.07914 6.69595 8.75593C7.01916 8.43272 7.54319 8.43272 7.8664 8.75593Z" fill="currentColor"/>`,TagsIcon=icon(TagsSVG,16),TextSVG=b$1`<path fill-rule="evenodd" clip-rule="evenodd" d="M3.25 4C3.25 3.58579 3.58579 3.25 4 3.25H20C20.4142 3.25 20.75 3.58579 20.75 4V6.66667C20.75 7.08088 20.4142 7.41667 20 7.41667C19.5858 7.41667 19.25 7.08088 19.25 6.66667V4.75H12.75V19.25H16C16.4142 19.25 16.75 19.5858 16.75 20C16.75 20.4142 16.4142 20.75 16 20.75H8C7.58579 20.75 7.25 20.4142 7.25 20C7.25 19.5858 7.58579 19.25 8 19.25H11.25V4.75H4.75V6.66667C4.75 7.08088 4.41421 7.41667 4 7.41667C3.58579 7.41667 3.25 7.08088 3.25 6.66667V4Z" fill="currentColor"/>`,TextIcon=icon(TextSVG,20),TitleIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M2.84088 5.25C2.42667 5.25 2.09088 5.58579 2.09088 6V8C2.09088 8.41421 2.42667 8.75 2.84088 8.75C3.25509 8.75 3.59088 8.41421 3.59088 8V6.75H6.99997V17.25H5.0227C4.60849 17.25 4.2727 17.5858 4.2727 18C4.2727 18.4142 4.60849 18.75 5.0227 18.75H7.74997H10.4772C10.8915 18.75 11.2272 18.4142 11.2272 18C11.2272 17.5858 10.8915 17.25 10.4772 17.25H8.49997V6.75H11.9091V8C11.9091 8.41421 12.2449 8.75 12.6591 8.75C13.0733 8.75 13.4091 8.41421 13.4091 8V6C13.4091 5.58579 13.0733 5.25 12.6591 5.25H7.74997H2.84088ZM15.6045 5.25C15.1903 5.25 14.8545 5.58579 14.8545 6C14.8545 6.41421 15.1903 6.75 15.6045 6.75H21.059C21.4733 6.75 21.809 6.41421 21.809 6C21.809 5.58579 21.4733 5.25 21.059 5.25H15.6045ZM14.8545 12C14.8545 11.5858 15.1903 11.25 15.6045 11.25H21.059C21.4733 11.25 21.809 11.5858 21.809 12C21.809 12.4142 21.4733 12.75 21.059 12.75H15.6045C15.1903 12.75 14.8545 12.4142 14.8545 12ZM15.6045 17.25C15.1903 17.25 14.8545 17.5858 14.8545 18C14.8545 18.4142 15.1903 18.75 15.6045 18.75H21.059C21.4733 18.75 21.809 18.4142 21.809 18C21.809 17.5858 21.4733 17.25 21.059 17.25H15.6045Z"
    fill="currentColor"
  />
</svg> `,TextIconLarge=icon(TextSVG),Heading1Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M17.9256 6.5784V17.4764C17.9256 18.078 18.2564 18.4389 18.7878 18.4389C19.3292 18.4389 19.65 18.088 19.65 17.4764V5.72621C19.65 5.04445 19.1988 4.57324 18.5572 4.57324C18.1662 4.57324 17.8153 4.72363 17.1836 5.19484L15.1584 6.69871C14.7574 6.98946 14.5669 7.26016 14.5669 7.55091C14.5669 7.93189 14.8677 8.24269 15.2386 8.24269C15.4592 8.24269 15.6697 8.16248 15.9605 7.95194L17.8453 6.5784H17.9256ZM4.41998 4.90259C4.84523 4.90259 5.18996 5.24732 5.18996 5.67257V11.0239H11.3584V5.67257C11.3584 5.24732 11.7031 4.90259 12.1284 4.90259C12.5536 4.90259 12.8983 5.24732 12.8983 5.67257V11.7939V17.9153C12.8983 18.3405 12.5536 18.6853 12.1284 18.6853C11.7031 18.6853 11.3584 18.3405 11.3584 17.9153V12.5639H5.18996V17.9153C5.18996 18.3405 4.84523 18.6853 4.41998 18.6853C3.99473 18.6853 3.64999 18.3405 3.64999 17.9153V5.67257C3.64999 5.24732 3.99473 4.90259 4.41998 4.90259Z"
  />
</svg>`,Heading2Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M14.1588 15.9996C13.5966 16.6381 13.4346 16.9049 13.4346 17.2479C13.4346 17.8006 13.873 18.1342 14.5686 18.1342H20.8578C21.3819 18.1342 21.6869 17.8578 21.6869 17.4099C21.6869 16.9525 21.3629 16.6762 20.8578 16.6762H15.5691V16.5618L19.0949 12.531C20.8102 10.5775 21.2962 9.67223 21.2962 8.43344C21.2962 6.33702 19.6476 4.85046 17.3035 4.85046C14.7878 4.85046 13.2154 6.54666 13.2154 8.16662C13.2154 8.6812 13.5204 9.03378 13.9873 9.03378C14.378 9.03378 14.6448 8.77649 14.7782 8.27144C15.0641 7.03265 15.9694 6.2989 17.1986 6.2989C18.6471 6.2989 19.6095 7.19464 19.6095 8.53826C19.6095 9.434 19.1998 10.2345 18.123 11.4637L14.1588 15.9996ZM3.41871 5.36361C3.82289 5.36361 4.15055 5.69127 4.15055 6.09545V11.1818H10.0134V6.09545C10.0134 5.69127 10.341 5.36361 10.7452 5.36361C11.1494 5.36361 11.4771 5.69127 11.4771 6.09545V11.9136V17.7317C11.4771 18.1359 11.1494 18.4636 10.7452 18.4636C10.341 18.4636 10.0134 18.1359 10.0134 17.7317V12.6454H4.15055V17.7317C4.15055 18.1359 3.82289 18.4636 3.41871 18.4636C3.01452 18.4636 2.68687 18.1359 2.68687 17.7317V6.09545C2.68687 5.69127 3.01452 5.36361 3.41871 5.36361Z"
  />
</svg>`,Heading3Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M4.04957 5.85587C4.04957 5.44177 3.71388 5.10608 3.29979 5.10608C2.88569 5.10608 2.55 5.44177 2.55 5.85587V17.7775C2.55 18.1916 2.88569 18.5273 3.29979 18.5273C3.71388 18.5273 4.04957 18.1916 4.04957 17.7775V12.5665H10.0562V17.7775C10.0562 18.1916 10.3919 18.5273 10.806 18.5273C11.2201 18.5273 11.5558 18.1916 11.5558 17.7775V11.8167V5.85587C11.5558 5.44177 11.2201 5.10608 10.806 5.10608C10.3919 5.10608 10.0562 5.44177 10.0562 5.85587V11.0669H4.04957V5.85587ZM13.5289 15.0901C13.1108 15.0901 12.8162 15.3942 12.8162 15.8218C12.8162 17.2759 14.6124 18.7585 17.0643 18.7585C19.7063 18.7585 21.55 17.1999 21.55 14.976C21.55 13.3414 20.324 11.9349 18.7179 11.7543V11.6592C20.0389 11.4312 21.1128 10.0626 21.1128 8.62759C21.1128 6.65084 19.4212 5.2348 17.0453 5.2348C14.7074 5.2348 13.1203 6.66034 13.1203 8.1334C13.1203 8.60859 13.4054 8.92221 13.8426 8.92221C14.2132 8.92221 14.4508 8.72263 14.6409 8.19993C15.021 7.22106 15.8763 6.66034 17.0073 6.66034C18.4613 6.66034 19.4402 7.53468 19.4402 8.83667C19.4402 10.1387 18.4328 11.0795 17.0453 11.0795H15.9239C15.4677 11.0795 15.1636 11.3741 15.1636 11.7923C15.1636 12.201 15.4867 12.5146 15.9239 12.5146H17.1118C18.7654 12.5146 19.8774 13.4934 19.8774 14.9475C19.8774 16.4016 18.7939 17.3329 17.0928 17.3329C15.8003 17.3329 14.8119 16.7627 14.3177 15.7458C14.0707 15.2611 13.8616 15.0901 13.5289 15.0901Z"
  />
</svg>`,Heading4Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M18.7933 15.7548V17.6864C18.7933 18.2383 19.0787 18.5523 19.583 18.5523C20.0968 18.5523 20.3823 18.2383 20.3823 17.6864V15.7548H21.3719C21.9143 15.7548 22.2188 15.4884 22.2188 15.0317C22.2188 14.5654 21.9047 14.299 21.3719 14.299H20.3823V6.69626C20.3823 5.81134 19.897 5.31654 19.0311 5.31654C18.3746 5.31654 17.9369 5.602 17.3755 6.42983C15.2155 9.66503 14.3591 11.0352 12.9984 13.4426C12.6654 14.0516 12.5512 14.3846 12.5512 14.7367C12.5512 15.3647 13.046 15.7548 13.7882 15.7548H18.7933ZM18.7933 14.299H14.1498V14.2038C15.3963 12.0439 17.09 9.32248 18.7076 6.93414H18.7933V14.299ZM2.94953 5.70536C3.35312 5.70536 3.6803 6.03254 3.6803 6.43613V11.515H9.53462V6.43613C9.53462 6.03254 9.86179 5.70536 10.2654 5.70536C10.669 5.70536 10.9962 6.03254 10.9962 6.43613V12.2458V18.0555C10.9962 18.459 10.669 18.7862 10.2654 18.7862C9.86179 18.7862 9.53462 18.459 9.53462 18.0555V12.9766H3.6803V18.0555C3.6803 18.459 3.35312 18.7862 2.94953 18.7862C2.54593 18.7862 2.21875 18.459 2.21875 18.0555V6.43613C2.21875 6.03254 2.54593 5.70536 2.94953 5.70536Z"
  />
</svg>`,Heading5Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M13.6153 15.0526C13.2062 15.0526 12.9366 15.3687 12.9366 15.8335C12.9366 17.135 14.4705 18.6316 16.9246 18.6316C19.5182 18.6316 21.3682 16.8096 21.3682 14.2439C21.3682 11.8362 19.7042 10.1443 17.343 10.1443C16.2739 10.1443 15.1863 10.5905 14.768 11.2134H14.675L15.0283 7.0766H20.0388C20.5873 7.0766 20.8941 6.8256 20.8941 6.37939C20.8941 5.92388 20.578 5.6543 20.0388 5.6543H14.8237C14.0243 5.6543 13.6246 5.97966 13.5688 6.66757L13.1598 11.8734C13.1133 12.5892 13.3829 13.0075 13.9127 13.0075C14.2102 13.0075 14.3961 12.8959 15.0747 12.2638C15.6139 11.7804 16.2553 11.5387 16.9804 11.5387C18.5886 11.5387 19.7321 12.6914 19.7321 14.3275C19.7321 16.038 18.5515 17.2279 16.8596 17.2279C15.7441 17.2279 14.8888 16.6887 14.3775 15.6941C14.1358 15.22 13.9313 15.0526 13.6153 15.0526ZM3.08209 5.90389C3.47639 5.90389 3.79603 6.22353 3.79603 6.61783V11.5797H9.51545V6.61783C9.51545 6.22353 9.83509 5.90389 10.2294 5.90389C10.6237 5.90389 10.9433 6.22353 10.9433 6.61783V12.2936V17.9695C10.9433 18.3638 10.6237 18.6834 10.2294 18.6834C9.83509 18.6834 9.51545 18.3638 9.51545 17.9695V13.0076H3.79603V17.9695C3.79603 18.3638 3.47639 18.6834 3.08209 18.6834C2.6878 18.6834 2.36816 18.3638 2.36816 17.9695V6.61783C2.36816 6.22353 2.6878 5.90389 3.08209 5.90389Z"
  />
</svg>`,Heading6Icon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M17.6502 5.51672C14.5518 5.51672 12.8253 8.00853 12.8253 12.4975C12.8253 14.4294 13.1426 15.8759 13.7865 16.9025C14.5518 18.1064 15.8117 18.7597 17.3889 18.7597C19.9834 18.7597 21.7379 17.0145 21.7379 14.448C21.7379 12.0122 20.0767 10.3043 17.7062 10.3043C16.2503 10.3043 14.9158 11.107 14.4865 12.2455H14.4118C14.4398 8.75514 15.5411 6.92595 17.6222 6.92595C18.4528 6.92595 19.1528 7.22459 19.8247 7.8872C20.1607 8.21385 20.3567 8.3165 20.618 8.3165C21.0193 8.3165 21.3086 8.01786 21.3086 7.61656C21.3086 7.18726 20.9353 6.67397 20.3193 6.27266C19.6101 5.78737 18.6488 5.51672 17.6502 5.51672ZM17.4542 17.3598C15.8024 17.3598 14.6451 16.1746 14.6451 14.504C14.6451 12.8521 15.7744 11.6949 17.3889 11.6949C19.0501 11.6949 20.1327 12.8148 20.1327 14.5134C20.1327 16.2306 19.0594 17.3598 17.4542 17.3598ZM3.45463 5.99129C3.85047 5.99129 4.17137 6.31218 4.17137 6.70803V11.6894H9.91326V6.70803C9.91326 6.31218 10.2342 5.99129 10.63 5.99129C11.0259 5.99129 11.3467 6.31218 11.3467 6.70803V12.4061V18.1043C11.3467 18.5001 11.0259 18.821 10.63 18.821C10.2342 18.821 9.91326 18.5001 9.91326 18.1043V13.1229H4.17137V18.1043C4.17137 18.5001 3.85047 18.821 3.45463 18.821C3.05878 18.821 2.73788 18.5001 2.73788 18.1043V6.70803C2.73788 6.31218 3.05878 5.99129 3.45463 5.99129Z"
  />
</svg>`,BulletedListSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M4.29999 7.5C4.85227 7.5 5.29999 7.05228 5.29999 6.5C5.29999 5.94772 4.85227 5.5 4.29999 5.5C3.7477 5.5 3.29999 5.94772 3.29999 6.5C3.29999 7.05228 3.7477 7.5 4.29999 7.5ZM8.33335 5.75073C7.91914 5.75071 7.58334 6.08648 7.58331 6.50069C7.58329 6.9149 7.91906 7.25071 8.33327 7.25073L20.2499 7.2514C20.6641 7.25142 20.9999 6.91565 21 6.50144C21 6.08722 20.6642 5.75142 20.25 5.7514L8.33335 5.75073ZM8.33336 11.2508C7.91914 11.2508 7.58334 11.5865 7.58331 12.0007C7.58329 12.415 7.91905 12.7508 8.33327 12.7508L20.25 12.7515C20.6642 12.7515 21 12.4158 21 12.0015C21 11.5873 20.6643 11.2515 20.2501 11.2515L8.33336 11.2508ZM8.33336 16.7508C7.91914 16.7508 7.58334 17.0865 7.58331 17.5007C7.58329 17.915 7.91905 18.2508 8.33327 18.2508L20.25 18.2515C20.6642 18.2515 21 17.9158 21 17.5016C21 17.0873 20.6643 16.7515 20.25 16.7515L8.33336 16.7508ZM5.29999 12C5.29999 12.5523 4.85227 13 4.29999 13C3.7477 13 3.29999 12.5523 3.29999 12C3.29999 11.4477 3.7477 11 4.29999 11C4.85227 11 5.29999 11.4477 5.29999 12ZM4.29999 18.5C4.85227 18.5 5.29999 18.0523 5.29999 17.5C5.29999 16.9477 4.85227 16.5 4.29999 16.5C3.7477 16.5 3.29999 16.9477 3.29999 17.5C3.29999 18.0523 3.7477 18.5 4.29999 18.5Z"/>`,BulletedListIcon=icon(BulletedListSVG,20),BulletedListIconLarge=icon(BulletedListSVG,24),NumberedListSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M4.1287 5.76205C4.18101 5.74447 4.22813 5.71723 4.27846 5.68228L4.53386 5.50534V7.63997C4.53386 7.82761 4.59717 7.9904 4.71548 8.10631C4.83355 8.222 4.99776 8.28258 5.18421 8.28258C5.37066 8.28258 5.53488 8.222 5.65295 8.10631C5.77126 7.9904 5.83457 7.82761 5.83457 7.63997V4.93384C5.83457 4.72505 5.76932 4.54353 5.6384 4.41417C5.50756 4.2849 5.32242 4.21887 5.10409 4.21887C4.88258 4.21887 4.6705 4.24086 4.42948 4.40154L3.75168 4.85427C3.57975 4.97094 3.5 5.12628 3.5 5.31379C3.5 5.58698 3.70304 5.7858 3.96426 5.7858C4.02312 5.7858 4.07561 5.7799 4.1287 5.76205ZM9.40567 5.6015C8.98147 5.60148 8.63757 5.94534 8.63755 6.36953C8.63752 6.79373 8.98138 7.13762 9.40557 7.13765L19.7319 7.13827C20.1561 7.1383 20.5 6.79444 20.5 6.37024C20.5 5.94605 20.1562 5.60215 19.732 5.60213L9.40567 5.6015ZM9.40567 11.234C8.98147 11.234 8.63757 11.5779 8.63755 12.0021C8.63752 12.4263 8.98138 12.7702 9.40557 12.7702L19.7319 12.7708C20.1561 12.7708 20.5 12.427 20.5 12.0028C20.5 11.5786 20.1562 11.2347 19.732 11.2347L9.40567 11.234ZM9.40567 16.8666C8.98147 16.8666 8.63757 17.2104 8.63755 17.6346C8.63752 18.0588 8.98138 18.4027 9.40557 18.4027L19.7319 18.4033C20.1561 18.4034 20.5 18.0595 20.5 17.6353C20.5 17.2111 20.1562 16.8672 19.732 16.8672L9.40567 16.8666ZM6.62426 11.114C6.63609 11.048 6.6419 10.9782 6.6419 10.9031C6.6419 10.2259 6.06294 9.7684 5.15573 9.7684C4.5044 9.7684 3.97971 10.045 3.78328 10.4895C3.77042 10.5192 3.76022 10.5492 3.75251 10.5798C3.76022 10.5492 3.77044 10.5191 3.78331 10.4894C3.97974 10.0449 4.50442 9.7683 5.15575 9.7683C6.06297 9.7683 6.64193 10.2258 6.64193 10.903C6.64193 10.9782 6.6361 11.048 6.62426 11.114ZM5.12474 12.7537L5.12471 12.7537V12.7744H6.30848C6.58246 12.7744 6.73753 12.9372 6.73753 13.1879C6.73753 13.2197 6.73493 13.2502 6.72981 13.2792C6.73495 13.2502 6.73756 13.2196 6.73756 13.1878C6.73756 12.9371 6.58248 12.7743 6.30851 12.7743H5.12474V12.7537ZM3.73998 12.9913C3.77464 12.8518 3.86616 12.7304 4.02368 12.5985L5.04978 11.7197C5.38832 11.4292 5.53086 11.2672 5.57304 11.0983C5.5309 11.2672 5.38836 11.4293 5.04976 11.7198L4.02365 12.5986C3.86617 12.7305 3.77466 12.8519 3.73998 12.9913ZM4.50342 11.1816C4.59839 11.1252 4.67754 11.0396 4.75422 10.9274C4.81979 10.8327 4.87897 10.7719 4.93846 10.7343C4.99601 10.6979 5.05933 10.6797 5.14025 10.6797C5.25266 10.6797 5.33878 10.7139 5.39544 10.7645C5.45119 10.8143 5.48498 10.8855 5.48498 10.9753C5.48498 11.1448 5.40603 11.2791 4.9831 11.642L3.95747 12.5204C3.73832 12.704 3.62145 12.8851 3.62145 13.1283C3.62145 13.2841 3.66578 13.4314 3.77329 13.5397C3.88112 13.6484 4.03847 13.7037 4.23562 13.7037H6.30851C6.46671 13.7037 6.60202 13.6548 6.69803 13.5592C6.79392 13.4637 6.83997 13.3323 6.83997 13.1878C6.83997 13.0412 6.79418 12.9093 6.6977 12.8141C6.60129 12.719 6.46582 12.6718 6.30851 12.6718H5.37617L5.87155 12.2443C6.15942 11.9949 6.3783 11.7967 6.52349 11.5947C6.67287 11.3868 6.74434 11.1753 6.74434 10.903C6.74434 10.5321 6.58449 10.2187 6.30157 10.0006C6.02097 9.78425 5.62548 9.66589 5.15575 9.66589C4.48013 9.66589 3.90785 9.95417 3.68934 10.4487C3.64978 10.54 3.63179 10.6341 3.63179 10.7324C3.63179 10.8869 3.68238 11.0223 3.78385 11.1187C3.8847 11.2145 4.02467 11.2613 4.18393 11.2613C4.30216 11.2613 4.40667 11.2391 4.50342 11.1816ZM3.67138 16.0785C3.82347 15.664 4.34013 15.2247 5.22801 15.2247C5.68517 15.2247 6.09277 15.3214 6.38781 15.5143C6.68486 15.7085 6.86644 15.9999 6.86644 16.3799C6.86644 16.8627 6.55828 17.1838 6.17395 17.3212C6.40817 17.3704 6.60427 17.4641 6.75036 17.5998C6.93436 17.7707 7.035 18.0045 7.035 18.2873C7.035 18.6915 6.86059 19.0236 6.54548 19.2529C6.23205 19.4811 5.78277 19.6055 5.23363 19.6055C4.27385 19.6055 3.73928 19.1473 3.59258 18.7372C3.56511 18.6608 3.55307 18.5763 3.55307 18.5092C3.55307 18.3499 3.60652 18.216 3.70785 18.1223C3.80872 18.0289 3.95152 17.9805 4.12117 17.9805C4.23774 17.9805 4.33814 17.9997 4.42613 18.0439C4.51436 18.0882 4.58653 18.1558 4.64935 18.247C4.72378 18.3559 4.79404 18.4374 4.8851 18.4925C4.97546 18.5471 5.09131 18.5788 5.26173 18.5788C5.53989 18.5788 5.7218 18.414 5.7218 18.2002C5.7218 18.0706 5.67315 17.9761 5.58111 17.9118C5.48617 17.8455 5.33953 17.8076 5.13812 17.8076H5.11003C4.96167 17.8076 4.84264 17.7662 4.76061 17.6859C4.67849 17.6054 4.64024 17.4925 4.64024 17.3631C4.64024 17.2388 4.6788 17.1269 4.76042 17.0461C4.84209 16.9653 4.96094 16.9214 5.11003 16.9214H5.13812C5.3156 16.9214 5.449 16.8827 5.53665 16.8186C5.62237 16.7559 5.66843 16.6661 5.66843 16.5512C5.66843 16.4399 5.62767 16.3529 5.5564 16.293C5.48412 16.2322 5.37547 16.1951 5.23363 16.1951C5.1199 16.1951 5.02579 16.2182 4.94752 16.2628C4.86935 16.3074 4.80383 16.3753 4.74999 16.4698C4.68013 16.5935 4.60457 16.683 4.50858 16.7408C4.41232 16.7988 4.30106 16.8216 4.16612 16.8216C3.99313 16.8216 3.85731 16.7706 3.76471 16.6781C3.67224 16.5856 3.62892 16.4576 3.62892 16.3153C3.62892 16.2303 3.64147 16.1623 3.67138 16.0785Z"/>`,NumberedListIconLarge=icon(NumberedListSVG,24),NumberedListIcon=icon(NumberedListSVG,20),DatabaseTableViewSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M3.25 6C3.25 4.48122 4.48122 3.25 6 3.25H18C19.5188 3.25 20.75 4.48122 20.75 6V18C20.75 19.5188 19.5188 20.75 18 20.75H6C4.48122 20.75 3.25 19.5188 3.25 18V6ZM6 4.75C5.30964 4.75 4.75 5.30964 4.75 6V8.25H19.25V6C19.25 5.30964 18.6904 4.75 18 4.75H6ZM4.75 18V9.75H7.75V19.25H6C5.30964 19.25 4.75 18.6904 4.75 18ZM9.25 19.25H18C18.6904 19.25 19.25 18.6904 19.25 18V9.75H9.25V19.25Z"/>`,DatabaseTableViewIcon=icon(DatabaseTableViewSVG),DatabaseTableViewIcon20=icon(DatabaseTableViewSVG,20),DatabaseKanbanViewSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M5.5 3.75C4.5335 3.75 3.75 4.5335 3.75 5.5V18C3.75 18.9665 4.5335 19.75 5.5 19.75H9.5C10.4665 19.75 11.25 18.9665 11.25 18V5.5C11.25 4.5335 10.4665 3.75 9.5 3.75H5.5ZM5.25 5.5C5.25 5.36193 5.36193 5.25 5.5 5.25H9.5C9.63807 5.25 9.75 5.36193 9.75 5.5V18C9.75 18.1381 9.63807 18.25 9.5 18.25H5.5C5.36193 18.25 5.25 18.1381 5.25 18V5.5ZM14.5 3.75C13.5335 3.75 12.75 4.5335 12.75 5.5V12.5C12.75 13.4665 13.5335 14.25 14.5 14.25H18.5C19.4665 14.25 20.25 13.4665 20.25 12.5V5.5C20.25 4.5335 19.4665 3.75 18.5 3.75H14.5ZM14.25 5.5C14.25 5.36193 14.3619 5.25 14.5 5.25H18.5C18.6381 5.25 18.75 5.36193 18.75 5.5V12.5C18.75 12.6381 18.6381 12.75 18.5 12.75H14.5C14.3619 12.75 14.25 12.6381 14.25 12.5V5.5Z"/>`,DatabaseKanbanViewIcon=icon(DatabaseKanbanViewSVG),DatabaseKanbanViewIcon20=icon(DatabaseKanbanViewSVG,20),CheckBoxIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H18C18.6904 4.75 19.25 5.30964 19.25 6V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6ZM16.5303 9.53033C16.8232 9.23744 16.8232 8.76256 16.5303 8.46967C16.2374 8.17678 15.7626 8.17678 15.4697 8.46967L10.5 13.4393L9.03033 11.9697C8.73744 11.6768 8.26256 11.6768 7.96967 11.9697C7.67678 12.2626 7.67678 12.7374 7.96967 13.0303L9.96967 15.0303C10.2626 15.3232 10.7374 15.3232 11.0303 15.0303L16.5303 9.53033Z"
  />
</svg>`,CodeBlockIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M2.25 6C2.25 4.48122 3.48122 3.25 5 3.25H19C20.5188 3.25 21.75 4.48122 21.75 6V18C21.75 19.5188 20.5188 20.75 19 20.75H5C3.48122 20.75 2.25 19.5188 2.25 18V6ZM5 4.75C4.30964 4.75 3.75 5.30964 3.75 6V18C3.75 18.6904 4.30964 19.25 5 19.25H19C19.6904 19.25 20.25 18.6904 20.25 18V6C20.25 5.30964 19.6904 4.75 19 4.75H5ZM10.5303 9.36957C10.8232 9.66247 10.8232 10.1373 10.5303 10.4302L8.93934 12.0212L10.5303 13.6122C10.8232 13.9051 10.8232 14.38 10.5303 14.6729C10.2374 14.9658 9.76256 14.9658 9.46967 14.6729L7.34835 12.5516C7.05546 12.2587 7.05546 11.7838 7.34835 11.4909L9.46967 9.36957C9.76256 9.07668 10.2374 9.07668 10.5303 9.36957ZM13.4697 10.4302C13.1768 10.1373 13.1768 9.66247 13.4697 9.36957C13.7626 9.07668 14.2374 9.07668 14.5303 9.36957L16.6517 11.4909C16.9445 11.7838 16.9445 12.2587 16.6517 12.5516L14.5303 14.6729C14.2374 14.9658 13.7626 14.9658 13.4697 14.6729C13.1768 14.38 13.1768 13.9051 13.4697 13.6122L15.0607 12.0212L13.4697 10.4302Z"
  />
</svg>`,QuoteIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5 10.9655V11.0953V15.0608C5 15.6262 5.45838 16.0846 6.02382 16.0846H10.119C10.6845 16.0846 11.1429 15.6262 11.1429 15.0608V10.9655C11.1429 10.4001 10.6845 9.9417 10.119 9.9417H6.70422C7.17415 8.66255 8.40313 7.75 9.84524 7.75V6.25C7.24961 6.25 5.13069 8.29105 5.00582 10.8557C5.00197 10.8918 5 10.9284 5 10.9655ZM13 10.9655V11.0953V15.0608C13 15.6262 13.4584 16.0846 14.0238 16.0846H18.119C18.6845 16.0846 19.1429 15.6262 19.1429 15.0608V10.9655C19.1429 10.4001 18.6845 9.9417 18.119 9.9417H14.7042C15.1741 8.66255 16.4031 7.75 17.8452 7.75V6.25C15.2496 6.25 13.1307 8.29105 13.0058 10.8557C13.002 10.8918 13 10.9284 13 10.9655Z"
  />
</svg>`,DividerIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M4 4.25C4.41421 4.25 4.75 4.58579 4.75 5V6C4.75 6.69036 5.30964 7.25 6 7.25H18C18.6904 7.25 19.25 6.69036 19.25 6V5C19.25 4.58579 19.5858 4.25 20 4.25C20.4142 4.25 20.75 4.58579 20.75 5V6C20.75 7.51878 19.5188 8.75 18 8.75H6C4.48122 8.75 3.25 7.51878 3.25 6V5C3.25 4.58579 3.58579 4.25 4 4.25ZM4 19.75C4.41421 19.75 4.75 19.4142 4.75 19V18C4.75 17.3096 5.30964 16.75 6 16.75H18C18.6904 16.75 19.25 17.3096 19.25 18V19C19.25 19.4142 19.5858 19.75 20 19.75C20.4142 19.75 20.75 19.4142 20.75 19V18C20.75 16.4812 19.5188 15.25 18 15.25H6C4.48122 15.25 3.25 16.4812 3.25 18V19C3.25 19.4142 3.58579 19.75 4 19.75ZM3 11.25C2.58579 11.25 2.25 11.5858 2.25 12C2.25 12.4142 2.58579 12.75 3 12.75H3.09H3.36H3.84H4.11H4.2C4.61421 12.75 4.95 12.4142 4.95 12C4.95 11.5858 4.61421 11.25 4.2 11.25H4.11H3.84H3.36H3.09H3ZM6.44995 12C6.44995 11.5858 6.78574 11.25 7.19995 11.25H7.28995H7.55995H8.03995H8.30995H8.39995C8.81416 11.25 9.14995 11.5858 9.14995 12C9.14995 12.4142 8.81416 12.75 8.39995 12.75H8.30995H8.03995H7.55995H7.28995H7.19995C6.78574 12.75 6.44995 12.4142 6.44995 12ZM11.3999 11.25C10.9857 11.25 10.6499 11.5858 10.6499 12C10.6499 12.4142 10.9857 12.75 11.3999 12.75H11.4899H11.7599H12.2399H12.5099H12.5999C13.0141 12.75 13.3499 12.4142 13.3499 12C13.3499 11.5858 13.0141 11.25 12.5999 11.25H12.5099H12.2399H11.7599H11.4899H11.3999ZM14.8499 12C14.8499 11.5858 15.1856 11.25 15.5999 11.25H15.6899H15.9599H16.4399H16.7099H16.7999C17.2141 11.25 17.5499 11.5858 17.5499 12C17.5499 12.4142 17.2141 12.75 16.7999 12.75H16.7099H16.4399H15.9599H15.6899H15.5999C15.1856 12.75 14.8499 12.4142 14.8499 12ZM19.7998 11.25C19.3856 11.25 19.0498 11.5858 19.0498 12C19.0498 12.4142 19.3856 12.75 19.7998 12.75H19.8898H20.1598H20.6398H20.9098H20.9998C21.414 12.75 21.7498 12.4142 21.7498 12C21.7498 11.5858 21.414 11.25 20.9998 11.25H20.9098H20.6398H20.1598H19.8898H19.7998Z"
  />
</svg>`,BoldIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M6.25 4C6.25 3.58579 6.58579 3.25 7 3.25H12.9583C15.6288 3.25 17.8333 5.35506 17.8333 8C17.8333 9.51519 17.1099 10.8532 15.9898 11.7198C17.6162 12.484 18.75 14.1032 18.75 16C18.75 18.6449 16.5455 20.75 13.875 20.75H7C6.58579 20.75 6.25 20.4142 6.25 20V4ZM7.75 12.75V19.25H13.875C15.7609 19.25 17.25 17.7733 17.25 16C17.25 14.2267 15.7609 12.75 13.875 12.75H7.75ZM7.75 11.25H12.9583C14.8442 11.25 16.3333 9.77334 16.3333 8C16.3333 6.22666 14.8442 4.75 12.9583 4.75H7.75V11.25Z"
  />
</svg>`,ItalicIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M14.6075 3.24996H10.25C9.83579 3.24996 9.5 3.58575 9.5 3.99996C9.5 4.41417 9.83579 4.74996 10.25 4.74996H13.5896L8.83175 19.25H5C4.58579 19.25 4.25 19.5857 4.25 20C4.25 20.4142 4.58579 20.75 5 20.75H9.35778C9.36938 20.7502 9.38095 20.7502 9.39249 20.75H13.75C14.1642 20.75 14.5 20.4142 14.5 20C14.5 19.5857 14.1642 19.25 13.75 19.25H10.4104L15.1682 4.74996H19C19.4142 4.74996 19.75 4.41417 19.75 3.99996C19.75 3.58575 19.4142 3.24996 19 3.24996H14.6422C14.6306 3.24969 14.619 3.24969 14.6075 3.24996Z"
  />
</svg>`,UnderlineIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M7.74427 3.96773C7.74427 3.52145 7.38249 3.15967 6.93621 3.15967C6.48992 3.15967 6.12814 3.52145 6.12814 3.96773V10.971C6.12814 14.0949 8.66062 16.6274 11.7846 16.6274C14.9086 16.6274 17.441 14.0949 17.441 10.971V3.96773C17.441 3.52145 17.0793 3.15967 16.633 3.15967C16.1867 3.15967 15.8249 3.52145 15.8249 3.96773V10.971C15.8249 13.2024 14.016 15.0113 11.7846 15.0113C9.55318 15.0113 7.74427 13.2024 7.74427 10.971V3.96773ZM4.45809 19.321C4.01181 19.321 3.65002 19.6828 3.65002 20.129C3.65002 20.5753 4.01181 20.9371 4.45809 20.9371H19.542C19.9882 20.9371 20.35 20.5753 20.35 20.129C20.35 19.6828 19.9882 19.321 19.542 19.321H4.45809Z"
  />
</svg>`,StrikethroughIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M8.40605 7.46437C8.40605 5.54921 9.9586 3.99667 11.8738 3.99667C13.2452 3.99667 14.4322 4.79274 14.9951 5.95145C15.181 6.33412 15.6419 6.49363 16.0246 6.30773C16.4072 6.12183 16.5668 5.66092 16.3809 5.27825C15.57 3.60922 13.8573 2.45605 11.8738 2.45605C9.10773 2.45605 6.86543 4.69835 6.86543 7.46437C6.86543 8.21934 7.03248 8.9353 7.33163 9.57729H9.1239C8.67373 8.99229 8.40605 8.25959 8.40605 7.46437ZM14.9176 15.9402C14.9176 15.145 14.6499 14.4123 14.1998 13.8273H15.992C16.2912 14.4693 16.4582 15.1852 16.4582 15.9402C16.4582 18.7062 14.2159 20.9485 11.4499 20.9485C9.46635 20.9485 7.75362 19.7953 6.9428 18.1263C6.7569 17.7436 6.91641 17.2827 7.29907 17.0968C7.68174 16.9109 8.14265 17.0704 8.32855 17.4531C8.89146 18.6118 10.0784 19.4079 11.4499 19.4079C13.3651 19.4079 14.9176 17.8553 14.9176 15.9402ZM4.29688 10.9054C3.85677 10.9054 3.5 11.2622 3.5 11.7023C3.5 12.1424 3.85677 12.4992 4.29688 12.4992H19.7031C20.1432 12.4992 20.5 12.1424 20.5 11.7023C20.5 11.2622 20.1432 10.9054 19.7031 10.9054H4.29688Z"
  />
</svg>`,CodeIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M13.9819 4.27233C14.3837 4.37279 14.6281 4.77999 14.5276 5.18183L10.9276 19.5818C10.8271 19.9837 10.4199 20.228 10.0181 20.1275C9.61625 20.0271 9.37193 19.6199 9.47239 19.218L13.0724 4.81803C13.1729 4.41619 13.5801 4.17186 13.9819 4.27233ZM7.13033 8.0696C7.42322 8.3625 7.42322 8.83737 7.13033 9.13026L4.06066 12.1999L7.13033 15.2696C7.42322 15.5625 7.42322 16.0374 7.13033 16.3303C6.83744 16.6232 6.36256 16.6232 6.06967 16.3303L2.46967 12.7303C2.17678 12.4374 2.17678 11.9625 2.46967 11.6696L6.06967 8.0696C6.36256 7.77671 6.83744 7.77671 7.13033 8.0696ZM16.8697 8.0696C17.1626 7.77671 17.6374 7.77671 17.9303 8.0696L21.5303 11.6696C21.8232 11.9625 21.8232 12.4374 21.5303 12.7303L17.9303 16.3303C17.6374 16.6232 17.1626 16.6232 16.8697 16.3303C16.5768 16.0374 16.5768 15.5625 16.8697 15.2696L19.9393 12.1999L16.8697 9.13026C16.5768 8.83737 16.5768 8.3625 16.8697 8.0696Z"
  />
</svg>`,LinkSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M18.4283 5.57173C17.3326 4.47609 15.5563 4.47609 14.4606 5.57173L13.4832 6.54916C13.1903 6.84205 12.7154 6.84205 12.4225 6.54916C12.1296 6.25627 12.1296 5.78139 12.4225 5.4885L13.4 4.51107C15.0814 2.82964 17.8075 2.82964 19.4889 4.51107C21.1704 6.19249 21.1704 8.91862 19.4889 10.6L15.9334 14.1556C14.252 15.837 11.5258 15.837 9.8444 14.1556C9.55151 13.8627 9.55151 13.3878 9.8444 13.0949C10.1373 12.802 10.6122 12.802 10.9051 13.0949C12.0007 14.1906 13.7771 14.1906 14.8727 13.0949L18.4283 9.53938C19.5239 8.44375 19.5239 6.66737 18.4283 5.57173ZM13.0949 10.9051C11.9993 9.80942 10.2229 9.80942 9.12728 10.9051L5.57173 14.4606C4.47609 15.5563 4.47609 17.3326 5.57173 18.4283C6.66737 19.5239 8.44375 19.5239 9.53938 18.4283L10.5185 17.4491C10.8114 17.1562 11.2863 17.1562 11.5792 17.4491C11.8721 17.742 11.8721 18.2169 11.5792 18.5098L10.6 19.4889C8.91862 21.1704 6.19249 21.1704 4.51107 19.4889C2.82964 17.8075 2.82964 15.0814 4.51107 13.4L8.06662 9.8444C9.74805 8.16298 12.4742 8.16298 14.1556 9.8444C14.4485 10.1373 14.4485 10.6122 14.1556 10.9051C13.8627 11.198 13.3878 11.198 13.0949 10.9051Z"/>`,LinkIcon=icon(LinkSVG,20),FontLinkIcon=fontIcon(LinkSVG),CopyIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M3.25 6C3.25 4.48122 4.48122 3.25 6 3.25H14C15.5188 3.25 16.75 4.48122 16.75 6V7.25H18C19.5188 7.25 20.75 8.48122 20.75 10V18C20.75 19.5188 19.5188 20.75 18 20.75H10C8.48122 20.75 7.25 19.5188 7.25 18V16.75H6C4.48122 16.75 3.25 15.5188 3.25 14V6ZM8.75 18C8.75 18.6904 9.30964 19.25 10 19.25H18C18.6904 19.25 19.25 18.6904 19.25 18V10C19.25 9.30964 18.6904 8.75 18 8.75H10C9.30964 8.75 8.75 9.30964 8.75 10V18ZM15.25 7.25H10C8.48122 7.25 7.25 8.48122 7.25 10V15.25H6C5.30964 15.25 4.75 14.6904 4.75 14V6C4.75 5.30964 5.30964 4.75 6 4.75H14C14.6904 4.75 15.25 5.30964 15.25 6V7.25Z"
  />
</svg>`,DuplicateIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V14C3.25 15.5188 4.48122 16.75 6 16.75H7.25V18C7.25 19.5188 8.48122 20.75 10 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V10C20.75 8.48122 19.5188 7.25 18 7.25H16.75V6C16.75 4.48122 15.5188 3.25 14 3.25H6ZM10 7.25H15.25V6C15.25 5.30964 14.6904 4.75 14 4.75H6C5.30964 4.75 4.75 5.30964 4.75 6V14C4.75 14.6904 5.30964 15.25 6 15.25H8C8.41421 15.25 8.75 15.5858 8.75 16V18C8.75 18.6904 9.30964 19.25 10 19.25H18C18.6904 19.25 19.25 18.6904 19.25 18V10C19.25 9.30964 18.6904 8.75 18 8.75H16H10C9.46561 8.75 9.00774 9.08568 8.82933 9.56024C8.68357 9.94796 8.2511 10.1441 7.86338 9.99835C7.47566 9.85259 7.27951 9.42012 7.42527 9.0324C7.81633 7.99216 8.82056 7.25 10 7.25ZM12.8871 10.489C12.6049 10.1858 12.1303 10.1688 11.8271 10.451C11.524 10.7333 11.507 11.2078 11.7892 11.511L12.4771 12.25H7.79999C7.38577 12.25 7.04999 12.5858 7.04999 13C7.04999 13.4142 7.38577 13.75 7.79999 13.75H12.4771L11.7892 14.489C11.507 14.7922 11.524 15.2667 11.8271 15.549C12.1303 15.8312 12.6049 15.8142 12.8871 15.511L14.7489 13.511C15.017 13.2231 15.017 12.7769 14.7489 12.489L12.8871 10.489Z"
  />
</svg>`,DeleteIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M11 2.25C9.48122 2.25 8.25 3.48122 8.25 5V6.1499H4C3.53056 6.1499 3.15 6.53046 3.15 6.9999C3.15 7.46934 3.53056 7.8499 4 7.8499H4.3088L5.11923 19.1959C5.22202 20.635 6.41948 21.75 7.86224 21.75H16.1378C17.5805 21.75 18.778 20.635 18.8808 19.1959L19.6912 7.8499H20C20.4694 7.8499 20.85 7.46934 20.85 6.9999C20.85 6.53046 20.4694 6.1499 20 6.1499H15.75V5C15.75 3.48122 14.5188 2.25 13 2.25H11ZM14.25 6.1499V5C14.25 4.30964 13.6904 3.75 13 3.75H11C10.3096 3.75 9.75 4.30964 9.75 5V6.1499H14.25ZM18.1874 7.8499H5.81262L6.61542 19.0891C6.66214 19.7432 7.20644 20.25 7.86224 20.25H16.1378C16.7936 20.25 17.3379 19.7432 17.3846 19.0891L18.1874 7.8499ZM10.75 11C10.75 10.5858 10.4142 10.25 10 10.25C9.58579 10.25 9.25 10.5858 9.25 11V17C9.25 17.4142 9.58579 17.75 10 17.75C10.4142 17.75 10.75 17.4142 10.75 17V11ZM14 10.25C14.4142 10.25 14.75 10.5858 14.75 11V17C14.75 17.4142 14.4142 17.75 14 17.75C13.5858 17.75 13.25 17.4142 13.25 17V11C13.25 10.5858 13.5858 10.25 14 10.25Z"
  />
</svg>`,TodayIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M8 2.75C8.41421 2.75 8.75 3.08579 8.75 3.5V4.25H15.25V3.5C15.25 3.08579 15.5858 2.75 16 2.75C16.4142 2.75 16.75 3.08579 16.75 3.5V4.25H19C20.5188 4.25 21.75 5.48122 21.75 7V9.5V19C21.75 20.5188 20.5188 21.75 19 21.75H5C3.48122 21.75 2.25 20.5188 2.25 19V9.5V7C2.25 5.48122 3.48122 4.25 5 4.25H7.25V3.5C7.25 3.08579 7.58579 2.75 8 2.75ZM15.25 5.75V6.5C15.25 6.91421 15.5858 7.25 16 7.25C16.4142 7.25 16.75 6.91421 16.75 6.5V5.75H19C19.6904 5.75 20.25 6.30964 20.25 7V8.75H3.75V7C3.75 6.30964 4.30964 5.75 5 5.75H7.25V6.5C7.25 6.91421 7.58579 7.25 8 7.25C8.41421 7.25 8.75 6.91421 8.75 6.5V5.75H15.25ZM20.25 10.25H3.75V19C3.75 19.6904 4.30964 20.25 5 20.25H19C19.6904 20.25 20.25 19.6904 20.25 19V10.25ZM7 11.8C6.72386 11.8 6.5 12.0239 6.5 12.3V13.8C6.5 14.0762 6.72386 14.3 7 14.3H8.5C8.77614 14.3 9 14.0762 9 13.8V12.3C9 12.0239 8.77614 11.8 8.5 11.8H7ZM6.5 16.2C6.5 15.9238 6.72386 15.7 7 15.7H8.5C8.77614 15.7 9 15.9238 9 16.2V17.7C9 17.9761 8.77614 18.2 8.5 18.2H7C6.72386 18.2 6.5 17.9761 6.5 17.7V16.2ZM11.2 11.8C10.9239 11.8 10.7 12.0239 10.7 12.3V13.8C10.7 14.0762 10.9239 14.3 11.2 14.3H12.7C12.9762 14.3 13.2 14.0762 13.2 13.8V12.3C13.2 12.0239 12.9762 11.8 12.7 11.8H11.2ZM10.7 16.2C10.7 15.9238 10.9239 15.7 11.2 15.7H12.7C12.9762 15.7 13.2 15.9238 13.2 16.2V17.7C13.2 17.9761 12.9762 18.2 12.7 18.2H11.2C10.9239 18.2 10.7 17.9761 10.7 17.7V16.2ZM15.5 11.8C15.2239 11.8 15 12.0239 15 12.3V13.8C15 14.0762 15.2239 14.3 15.5 14.3H17C17.2761 14.3 17.5 14.0762 17.5 13.8V12.3C17.5 12.0239 17.2761 11.8 17 11.8H15.5Z"
  />
</svg>`,TomorrowIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M8 2.75C8.41421 2.75 8.75 3.08579 8.75 3.5V4.25H15.25V3.5C15.25 3.08579 15.5858 2.75 16 2.75C16.4142 2.75 16.75 3.08579 16.75 3.5V4.25H19C20.5188 4.25 21.75 5.48122 21.75 7V9.5V13C21.75 13.4142 21.4142 13.75 21 13.75C20.5858 13.75 20.25 13.4142 20.25 13V10.25H3.75V19C3.75 19.6904 4.30964 20.25 5 20.25H11.5C11.9142 20.25 12.25 20.5858 12.25 21C12.25 21.4142 11.9142 21.75 11.5 21.75H5C3.48122 21.75 2.25 20.5188 2.25 19V9.5V7C2.25 5.48122 3.48122 4.25 5 4.25H7.25V3.5C7.25 3.08579 7.58579 2.75 8 2.75ZM15.25 5.75V6.5C15.25 6.91421 15.5858 7.25 16 7.25C16.4142 7.25 16.75 6.91421 16.75 6.5V5.75H19C19.6904 5.75 20.25 6.30964 20.25 7V8.75H3.75V7C3.75 6.30964 4.30964 5.75 5 5.75H7.25V6.5C7.25 6.91421 7.58579 7.25 8 7.25C8.41421 7.25 8.75 6.91421 8.75 6.5V5.75H15.25ZM19.2697 17.5303C18.9768 17.2374 18.9768 16.7626 19.2697 16.4697C19.5626 16.1768 20.0374 16.1768 20.3303 16.4697L22.4516 18.591C22.7445 18.8839 22.7445 19.3588 22.4516 19.6516L20.3303 21.773C20.0374 22.0659 19.5626 22.0659 19.2697 21.773C18.9768 21.4801 18.9768 21.0052 19.2697 20.7123L20.8606 19.1213L19.2697 17.5303ZM14.591 16.4697C14.2981 16.7626 14.2981 17.2374 14.591 17.5303L16.182 19.1213L14.591 20.7123C14.2981 21.0052 14.2981 21.4801 14.591 21.773C14.8839 22.0659 15.3588 22.0659 15.6517 21.773L17.773 19.6516C18.0659 19.3588 18.0659 18.8839 17.773 18.591L15.6517 16.4697C15.3588 16.1768 14.8839 16.1768 14.591 16.4697Z"
  />
</svg>`,YesterdayIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M8 2.75C8.41421 2.75 8.75 3.08579 8.75 3.5V4.25H15.25V3.5C15.25 3.08579 15.5858 2.75 16 2.75C16.4142 2.75 16.75 3.08579 16.75 3.5V4.25H19C20.5188 4.25 21.75 5.48122 21.75 7V13C21.75 13.4142 21.4142 13.75 21 13.75C20.5858 13.75 20.25 13.4142 20.25 13V10.35H3.75V19C3.75 19.6904 4.30964 20.25 5 20.25H11.5C11.9142 20.25 12.25 20.5858 12.25 21C12.25 21.4142 11.9142 21.75 11.5 21.75H5C3.48122 21.75 2.25 20.5188 2.25 19V7C2.25 5.48122 3.48122 4.25 5 4.25H7.25V3.5C7.25 3.08579 7.58579 2.75 8 2.75ZM15.25 5.75V6.5C15.25 6.91421 15.5858 7.25 16 7.25C16.4142 7.25 16.75 6.91421 16.75 6.5V5.75H19C19.6904 5.75 20.25 6.30964 20.25 7V8.65H3.75V7C3.75 6.30964 4.30964 5.75 5 5.75H7.25V6.5C7.25 6.91421 7.58579 7.25 8 7.25C8.41421 7.25 8.75 6.91421 8.75 6.5V5.75H15.25ZM17.0803 16.4697C17.3732 16.7626 17.3732 17.2374 17.0803 17.5303L15.4893 19.1213L17.0803 20.7123C17.3732 21.0052 17.3732 21.4801 17.0803 21.773C16.7874 22.0659 16.3126 22.0659 16.0197 21.773L13.8984 19.6516C13.6055 19.3588 13.6055 18.8839 13.8984 18.591L16.0197 16.4697C16.3126 16.1768 16.7874 16.1768 17.0803 16.4697ZM21.6517 17.5303C21.9446 17.2374 21.9446 16.7626 21.6517 16.4697C21.3588 16.1768 20.8839 16.1768 20.591 16.4697L18.4697 18.591C18.1768 18.8839 18.1768 19.3588 18.4697 19.6516L20.591 21.773C20.8839 22.0659 21.3588 22.0659 21.6517 21.773C21.9446 21.4801 21.9446 21.0052 21.6517 20.7123L20.0607 19.1213L21.6517 17.5303Z"
  />
</svg>`,NowIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M6.11366 3.67804C6.40656 3.97094 6.40656 4.44581 6.11366 4.7387L4.28033 6.57204C3.98744 6.86493 3.51256 6.86493 3.21967 6.57204C2.92678 6.27914 2.92678 5.80427 3.21967 5.51138L5.053 3.67804C5.3459 3.38515 5.82077 3.38515 6.11366 3.67804ZM17.8863 3.67804C18.1792 3.38515 18.6541 3.38515 18.947 3.67804L20.7803 5.51138C21.0732 5.80427 21.0732 6.27914 20.7803 6.57204C20.4874 6.86493 20.0126 6.86493 19.7197 6.57204L17.8863 4.7387C17.5934 4.44581 17.5934 3.97094 17.8863 3.67804ZM12 5.87504C8.36413 5.87504 5.41667 8.8225 5.41667 12.4584C5.41667 16.0942 8.36413 19.0417 12 19.0417C15.6359 19.0417 18.5833 16.0942 18.5833 12.4584C18.5833 8.8225 15.6359 5.87504 12 5.87504ZM3.91667 12.4584C3.91667 7.99407 7.5357 4.37504 12 4.37504C16.4643 4.37504 20.0833 7.99407 20.0833 12.4584C20.0833 16.9227 16.4643 20.5417 12 20.5417C7.5357 20.5417 3.91667 16.9227 3.91667 12.4584Z"
    />
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M15.197 10.3586C15.4899 10.6515 15.4899 11.1264 15.197 11.4193L11.6415 14.9748C11.3486 15.2677 10.8737 15.2677 10.5808 14.9748L8.80301 13.1971C8.51012 12.9042 8.51012 12.4293 8.80301 12.1364C9.09591 11.8435 9.57078 11.8435 9.86367 12.1364L11.1111 13.3839L14.1363 10.3586C14.4292 10.0657 14.9041 10.0657 15.197 10.3586Z"
    />
  </svg>
`,CrossIcon=x$1` <svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M6.34315 6.34314C6.63604 6.05025 7.11091 6.05025 7.40381 6.34314L12 10.9393L16.5962 6.34314C16.8891 6.05025 17.364 6.05025 17.6569 6.34314C17.9497 6.63604 17.9497 7.11091 17.6569 7.4038L13.0607 12L17.6569 16.5962C17.9497 16.8891 17.9497 17.364 17.6569 17.6569C17.364 17.9497 16.8891 17.9497 16.5962 17.6569L12 13.0607L7.40381 17.6569C7.11091 17.9497 6.63604 17.9497 6.34315 17.6569C6.05025 17.364 6.05025 16.8891 6.34315 16.5962L10.9393 12L6.34315 7.4038C6.05025 7.11091 6.05025 6.63604 6.34315 6.34314Z"
  />
</svg>`,InsertBlocksIcon=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M6.33333 4C4.76853 4 3.5 5.26853 3.5 6.83333V8.89394C3.5 10.4587 4.76853 11.7273 6.33333 11.7273H8.39394C9.95875 11.7273 11.2273 10.4587 11.2273 8.89394V6.83333C11.2273 5.26853 9.95875 4 8.39394 4H6.33333ZM5.04545 6.83333C5.04545 6.12206 5.62206 5.54545 6.33333 5.54545H8.39394C9.10522 5.54545 9.68182 6.12206 9.68182 6.83333V8.89394C9.68182 9.60522 9.10522 10.1818 8.39394 10.1818H6.33333C5.62206 10.1818 5.04545 9.60522 5.04545 8.89394V6.83333ZM6.33333 13.2727C4.76853 13.2727 3.5 14.5413 3.5 16.1061V18.1667C3.5 19.7315 4.76853 21 6.33333 21H8.39394C9.95875 21 11.2273 19.7315 11.2273 18.1667V16.1061C11.2273 14.5413 9.95875 13.2727 8.39394 13.2727H6.33333ZM5.04545 16.1061C5.04545 15.3948 5.62206 14.8182 6.33333 14.8182H8.39394C9.10522 14.8182 9.68182 15.3948 9.68182 16.1061V18.1667C9.68182 18.8779 9.10522 19.4545 8.39394 19.4545H6.33333C5.62206 19.4545 5.04545 18.8779 5.04545 18.1667V16.1061ZM12.7727 6.83333C12.7727 5.26853 14.0413 4 15.6061 4H17.6667C19.2315 4 20.5 5.26853 20.5 6.83333V8.89394C20.5 10.4587 19.2315 11.7273 17.6667 11.7273H15.6061C14.0413 11.7273 12.7727 10.4587 12.7727 8.89394V6.83333ZM15.6061 5.54545C14.8948 5.54545 14.3182 6.12206 14.3182 6.83333V8.89394C14.3182 9.60522 14.8948 10.1818 15.6061 10.1818H17.6667C18.3779 10.1818 18.9545 9.60522 18.9545 8.89394V6.83333C18.9545 6.12206 18.3779 5.54545 17.6667 5.54545H15.6061ZM17.4091 14.0455C17.4091 13.6187 17.0631 13.2727 16.6364 13.2727C16.2096 13.2727 15.8636 13.6187 15.8636 14.0455V16.3636H13.5455C13.1187 16.3636 12.7727 16.7096 12.7727 17.1364C12.7727 17.5631 13.1187 17.9091 13.5455 17.9091H15.8636V20.2273C15.8636 20.654 16.2096 21 16.6364 21C17.0631 21 17.4091 20.654 17.4091 20.2273V17.9091H19.7273C20.154 17.9091 20.5 17.5631 20.5 17.1364C20.5 16.7096 20.154 16.3636 19.7273 16.3636H17.4091V14.0455Z"/>`,BlockHubIcon20=x$1` <svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  ${InsertBlocksIcon}
</svg>`,BlockHubIcon=x$1` <svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5.57378 3.25C5.5825 3.25 5.59124 3.25 5.6 3.25L8.42622 3.25C8.68371 3.24998 8.92019 3.24996 9.11787 3.26612C9.33101 3.28353 9.56418 3.32339 9.79449 3.44074C10.1238 3.60852 10.3915 3.87623 10.5593 4.20552C10.6766 4.43582 10.7165 4.669 10.7339 4.88213C10.75 5.07982 10.75 5.3163 10.75 5.57379V8.42621C10.75 8.6837 10.75 8.92019 10.7339 9.11787C10.7165 9.33101 10.6766 9.56418 10.5593 9.79448C10.3915 10.1238 10.1238 10.3915 9.79449 10.5593C9.56418 10.6766 9.33101 10.7165 9.11787 10.7339C8.92019 10.75 8.6837 10.75 8.42622 10.75H5.57379C5.3163 10.75 5.07982 10.75 4.88213 10.7339C4.669 10.7165 4.43583 10.6766 4.20552 10.5593C3.87624 10.3915 3.60852 10.1238 3.44074 9.79448C3.32339 9.56418 3.28353 9.33101 3.26612 9.11787C3.24997 8.92019 3.24998 8.6837 3.25 8.42622L3.25 5.6C3.25 5.59124 3.25 5.5825 3.25 5.57378C3.24998 5.3163 3.24997 5.07981 3.26612 4.88213C3.28353 4.669 3.32339 4.43582 3.44074 4.20552C3.60852 3.87623 3.87624 3.60852 4.20552 3.44074C4.43583 3.32339 4.669 3.28353 4.88213 3.26612C5.07982 3.24996 5.3163 3.24998 5.57378 3.25ZM4.88088 4.77973C4.88085 4.77972 4.88132 4.77952 4.88239 4.77917L4.88088 4.77973ZM4.88346 4.77882C4.89234 4.77607 4.92547 4.76757 5.00428 4.76113C5.13341 4.75058 5.3076 4.75 5.6 4.75H8.4C8.6924 4.75 8.8666 4.75058 8.99573 4.76113C9.07454 4.76757 9.10766 4.77607 9.11654 4.77882C9.16118 4.80234 9.19766 4.83882 9.22118 4.88346C9.22393 4.89234 9.23243 4.92547 9.23887 5.00428C9.24942 5.1334 9.25 5.3076 9.25 5.6V8.4C9.25 8.6924 9.24942 8.8666 9.23887 8.99572C9.23243 9.07453 9.22393 9.10766 9.22118 9.11654C9.19766 9.16118 9.16118 9.19766 9.11654 9.22118C9.10767 9.22393 9.07454 9.23243 8.99573 9.23887C8.8666 9.24942 8.6924 9.25 8.4 9.25H5.6C5.3076 9.25 5.13341 9.24942 5.00428 9.23887C4.92547 9.23243 4.89234 9.22393 4.88347 9.22118C4.83883 9.19766 4.80235 9.16118 4.77883 9.11654C4.77607 9.10766 4.76757 9.07453 4.76114 8.99572C4.75059 8.8666 4.75 8.6924 4.75 8.4V5.6C4.75 5.3076 4.75059 5.1334 4.76114 5.00428C4.76757 4.92547 4.77607 4.89234 4.77883 4.88346C4.80235 4.83882 4.83883 4.80234 4.88346 4.77882ZM4.77973 4.88088C4.77974 4.8809 4.77956 4.88144 4.77917 4.88239L4.77973 4.88088ZM4.77973 9.11913C4.77972 9.11915 4.77953 9.11869 4.77918 9.11764L4.77973 9.11913ZM4.88088 9.22027C4.88091 9.22026 4.88143 9.22044 4.88236 9.22082L4.88088 9.22027ZM9.11913 9.22027C9.11916 9.22028 9.11869 9.22048 9.11764 9.22082L9.11913 9.22027ZM9.22028 9.11913C9.22027 9.11909 9.22044 9.11856 9.22084 9.11761L9.22028 9.11913ZM9.22028 4.88088C9.22029 4.88085 9.22048 4.88132 9.22084 4.88239L9.22028 4.88088ZM9.11764 4.77918C9.11869 4.77952 9.11916 4.77972 9.11913 4.77973L9.11764 4.77918ZM15.5738 3.25H18.4262C18.6837 3.24998 18.9202 3.24996 19.1179 3.26612C19.331 3.28353 19.5642 3.32339 19.7945 3.44074C20.1238 3.60852 20.3915 3.87623 20.5593 4.20552C20.6766 4.43582 20.7165 4.669 20.7339 4.88213C20.75 5.07981 20.75 5.31629 20.75 5.57377V8.42623C20.75 8.68371 20.75 8.92019 20.7339 9.11787C20.7165 9.33101 20.6766 9.56418 20.5593 9.79448C20.3915 10.1238 20.1238 10.3915 19.7945 10.5593C19.5642 10.6766 19.331 10.7165 19.1179 10.7339C18.9202 10.75 18.6837 10.75 18.4262 10.75H15.5738C15.3163 10.75 15.0798 10.75 14.8821 10.7339C14.669 10.7165 14.4358 10.6766 14.2055 10.5593C13.8762 10.3915 13.6085 10.1238 13.4407 9.79448C13.3234 9.56418 13.2835 9.33101 13.2661 9.11787C13.25 8.92019 13.25 8.68371 13.25 8.42623V5.57377C13.25 5.31629 13.25 5.07981 13.2661 4.88213C13.2835 4.669 13.3234 4.43582 13.4407 4.20552C13.6085 3.87623 13.8762 3.60852 14.2055 3.44074C14.4358 3.32339 14.669 3.28353 14.8821 3.26612C15.0798 3.24996 15.3163 3.24998 15.5738 3.25ZM14.8809 4.77973C14.8808 4.77972 14.8813 4.77953 14.8824 4.77918L14.8809 4.77973ZM14.8835 4.77882C14.8923 4.77607 14.9255 4.76757 15.0043 4.76113C15.1334 4.75058 15.3076 4.75 15.6 4.75H18.4C18.6924 4.75 18.8666 4.75058 18.9957 4.76113C19.0745 4.76757 19.1077 4.77607 19.1165 4.77882C19.1612 4.80234 19.1977 4.83882 19.2212 4.88346C19.2239 4.89234 19.2324 4.92547 19.2389 5.00428C19.2494 5.1334 19.25 5.3076 19.25 5.6V8.4C19.25 8.6924 19.2494 8.8666 19.2389 8.99572C19.2324 9.07453 19.2239 9.10766 19.2212 9.11654C19.1977 9.16118 19.1612 9.19766 19.1165 9.22118C19.1077 9.22393 19.0745 9.23243 18.9957 9.23887C18.8666 9.24942 18.6924 9.25 18.4 9.25H15.6C15.3076 9.25 15.1334 9.24942 15.0043 9.23887C14.9255 9.23243 14.8923 9.22393 14.8835 9.22118C14.8388 9.19766 14.8023 9.16118 14.7788 9.11654C14.7761 9.10766 14.7676 9.07453 14.7611 8.99572C14.7506 8.8666 14.75 8.6924 14.75 8.4V5.6C14.75 5.3076 14.7506 5.1334 14.7611 5.00428C14.7676 4.92547 14.7761 4.89234 14.7788 4.88346C14.8023 4.83882 14.8388 4.80234 14.8835 4.77882ZM14.7797 4.88088C14.7797 4.8809 14.7796 4.88143 14.7792 4.88236L14.7797 4.88088ZM14.7797 9.11913C14.7797 9.11915 14.7795 9.11867 14.7792 9.11761L14.7797 9.11913ZM14.8809 9.22027C14.8809 9.22026 14.8814 9.22044 14.8824 9.22082L14.8809 9.22027ZM19.1191 9.22027C19.1192 9.22028 19.1187 9.22048 19.1176 9.22082L19.1191 9.22027ZM19.2203 9.11913C19.2203 9.11911 19.2204 9.11857 19.2208 9.11761L19.2203 9.11913ZM19.2203 4.88088C19.2203 4.88085 19.2205 4.88131 19.2208 4.88236L19.2203 4.88088ZM19.1176 4.77917C19.1187 4.77952 19.1192 4.77972 19.1191 4.77973L19.1176 4.77917ZM5.57377 13.25H8.42623C8.68372 13.25 8.92019 13.25 9.11787 13.2661C9.33101 13.2835 9.56418 13.3234 9.79449 13.4407C10.1238 13.6085 10.3915 13.8762 10.5593 14.2055C10.6766 14.4358 10.7165 14.669 10.7339 14.8821C10.75 15.0798 10.75 15.3163 10.75 15.5738V18.4262C10.75 18.6837 10.75 18.9202 10.7339 19.1179C10.7165 19.331 10.6766 19.5642 10.5593 19.7945C10.3915 20.1238 10.1238 20.3915 9.79449 20.5593C9.56418 20.6766 9.33101 20.7165 9.11787 20.7339C8.92019 20.75 8.68372 20.75 8.42623 20.75H5.57377C5.31629 20.75 5.07981 20.75 4.88213 20.7339C4.669 20.7165 4.43583 20.6766 4.20552 20.5593C3.87624 20.3915 3.60852 20.1238 3.44074 19.7945C3.32339 19.5642 3.28353 19.331 3.26612 19.1179C3.24997 18.9202 3.24998 18.6837 3.25 18.4262V15.5738C3.24998 15.3163 3.24997 15.0798 3.26612 14.8821C3.28353 14.669 3.32339 14.4358 3.44074 14.2055C3.60852 13.8762 3.87624 13.6085 4.20552 13.4407C4.43583 13.3234 4.669 13.2835 4.88213 13.2661C5.07981 13.25 5.31629 13.25 5.57377 13.25ZM4.88088 14.7797C4.88085 14.7797 4.88131 14.7795 4.88237 14.7792L4.88088 14.7797ZM4.88346 14.7788C4.89234 14.7761 4.92546 14.7676 5.00428 14.7611C5.13341 14.7506 5.3076 14.75 5.6 14.75H8.4C8.6924 14.75 8.8666 14.7506 8.99573 14.7611C9.07453 14.7676 9.10766 14.7761 9.11654 14.7788C9.16118 14.8023 9.19766 14.8388 9.22118 14.8835C9.22393 14.8923 9.23243 14.9255 9.23887 15.0043C9.24942 15.1334 9.25 15.3076 9.25 15.6V18.4C9.25 18.6924 9.24942 18.8666 9.23887 18.9957C9.23243 19.0745 9.22393 19.1077 9.22118 19.1165C9.19766 19.1612 9.16118 19.1977 9.11654 19.2212C9.10767 19.2239 9.07454 19.2324 8.99573 19.2389C8.8666 19.2494 8.6924 19.25 8.4 19.25H5.6C5.3076 19.25 5.13341 19.2494 5.00428 19.2389C4.92547 19.2324 4.89235 19.2239 4.88347 19.2212C4.83883 19.1977 4.80235 19.1612 4.77883 19.1165C4.77607 19.1077 4.76757 19.0745 4.76114 18.9957C4.75059 18.8666 4.75 18.6924 4.75 18.4V15.6C4.75 15.3076 4.75059 15.1334 4.76114 15.0043C4.76757 14.9255 4.77607 14.8923 4.77883 14.8835C4.80234 14.8388 4.83882 14.8023 4.88346 14.7788ZM4.77973 14.8809C4.77974 14.8809 4.77956 14.8814 4.77918 14.8824L4.77973 14.8809ZM4.77973 19.1191C4.77972 19.1192 4.77953 19.1187 4.77918 19.1176L4.77973 19.1191ZM4.88088 19.2203C4.8809 19.2203 4.88143 19.2204 4.88236 19.2208L4.88088 19.2203ZM9.11913 19.2203C9.11917 19.2203 9.1187 19.2205 9.11762 19.2208L9.11913 19.2203ZM9.22028 19.1191C9.22026 19.1191 9.22044 19.1185 9.22087 19.1175L9.22028 19.1191ZM9.22027 14.8809C9.22028 14.8808 9.22048 14.8813 9.22084 14.8824L9.22027 14.8809ZM9.11761 14.7792C9.11868 14.7795 9.11915 14.7797 9.11913 14.7797L9.11761 14.7792ZM17 13.25C17.4142 13.25 17.75 13.5858 17.75 14V16.25H20C20.4142 16.25 20.75 16.5858 20.75 17C20.75 17.4142 20.4142 17.75 20 17.75H17.75V20C17.75 20.4142 17.4142 20.75 17 20.75C16.5858 20.75 16.25 20.4142 16.25 20V17.75H14C13.5858 17.75 13.25 17.4142 13.25 17C13.25 16.5858 13.5858 16.25 14 16.25H16.25V14C16.25 13.5858 16.5858 13.25 17 13.25Z"
  />
</svg>`,BlockHubRoundedRectangleIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M2.25 7C2.25 5.48122 3.48122 4.25 5 4.25H19C20.5188 4.25 21.75 5.48122 21.75 7V17C21.75 18.5188 20.5188 19.75 19 19.75H5C3.48122 19.75 2.25 18.5188 2.25 17V7ZM5 5.75C4.30964 5.75 3.75 6.30964 3.75 7V17C3.75 17.6904 4.30964 18.25 5 18.25H19C19.6904 18.25 20.25 17.6904 20.25 17V7C20.25 6.30964 19.6904 5.75 19 5.75H5Z"
  />
</svg>`,SearchIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M3.75 9.5C3.75 6.32436 6.32436 3.75 9.5 3.75C12.6756 3.75 15.25 6.32436 15.25 9.5C15.25 12.6756 12.6756 15.25 9.5 15.25C6.32436 15.25 3.75 12.6756 3.75 9.5ZM9.5 2.25C5.49594 2.25 2.25 5.49594 2.25 9.5C2.25 13.5041 5.49594 16.75 9.5 16.75C11.2319 16.75 12.8219 16.1427 14.0689 15.1295L19.4697 20.5303C19.7626 20.8232 20.2374 20.8232 20.5303 20.5303C20.8232 20.2374 20.8232 19.7626 20.5303 19.4697L15.1295 14.0689C16.1427 12.8219 16.75 11.2319 16.75 9.5C16.75 5.49594 13.5041 2.25 9.5 2.25Z"
    />
  </svg>
`,RefreshIcon=x$1`<svg
  xmlns="http://www.w3.org/2000/svg"
  width="20"
  height="20"
  viewBox="0 0 24 24"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.25 12C3.25 7.16751 7.16751 3.25 12 3.25C14.2406 3.25 16.286 4.09311 17.8335 5.4782L17.8359 5.48034L19.25 6.75695V4C19.25 3.58579 19.5858 3.25 20 3.25C20.4142 3.25 20.75 3.58579 20.75 4V8.44444C20.75 8.85866 20.4142 9.19444 20 9.19444H15.5556C15.1413 9.19444 14.8056 8.85866 14.8056 8.44444C14.8056 8.03023 15.1413 7.69444 15.5556 7.69444H18.05L16.8331 6.5959C16.8327 6.59554 16.8323 6.59518 16.8319 6.59483C15.5489 5.44701 13.8568 4.75 12 4.75C7.99594 4.75 4.75 7.99594 4.75 12C4.75 16.0041 7.99594 19.25 12 19.25C15.4494 19.25 18.3378 16.8403 19.0704 13.6118C19.162 13.2079 19.5638 12.9547 19.9677 13.0464C20.3717 13.138 20.6248 13.5398 20.5332 13.9437C19.6489 17.8405 16.1651 20.75 12 20.75C7.16751 20.75 3.25 16.8325 3.25 12Z"
  />
</svg>`,WebIconSVG=b$1`<g id="Web">
  <path
    id="Shape (Stroke)"
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.78363 11.25H8.26C8.32021 8.99973 8.64952 6.95181 9.16717 5.39887C9.32825 4.91563 9.51187 4.46715 9.7189 4.06941C6.50351 4.99257 4.09288 7.81832 3.78363 11.25ZM12 2.25C6.61522 2.25 2.25 6.61522 2.25 12C2.25 17.3848 6.61522 21.75 12 21.75C17.3848 21.75 21.75 17.3848 21.75 12C21.75 6.61522 17.3848 2.25 12 2.25ZM12 3.75C11.9141 3.75 11.7129 3.80155 11.4213 4.17149C11.1364 4.53298 10.8471 5.10255 10.5902 5.87321C10.1323 7.24686 9.82057 9.12821 9.76056 11.25H14.2394C14.1794 9.12821 13.8677 7.24686 13.4098 5.87321C13.1529 5.10255 12.8636 4.53298 12.5787 4.17149C12.2871 3.80155 12.0859 3.75 12 3.75ZM15.74 11.25C15.6798 8.99973 15.3505 6.95181 14.8328 5.39887C14.6718 4.91563 14.4881 4.46715 14.2811 4.06941C17.4965 4.99257 19.9071 7.81832 20.2164 11.25H15.74ZM14.2394 12.75H9.76056C9.82057 14.8718 10.1323 16.7531 10.5902 18.1268C10.8471 18.8975 11.1364 19.467 11.4213 19.8285C11.7129 20.1985 11.9141 20.25 12 20.25C12.0859 20.25 12.2871 20.1985 12.5787 19.8285C12.8636 19.467 13.1529 18.8975 13.4098 18.1268C13.8677 16.7531 14.1794 14.8718 14.2394 12.75ZM14.2811 19.9306C14.4881 19.5329 14.6718 19.0844 14.8328 18.6011C15.3505 17.0482 15.6798 15.0003 15.74 12.75H20.2164C19.9071 16.1817 17.4965 19.0074 14.2811 19.9306ZM9.7189 19.9306C9.51187 19.5329 9.32825 19.0844 9.16717 18.6011C8.64952 17.0482 8.32021 15.0003 8.26 12.75H3.78363C4.09288 16.1817 6.50351 19.0074 9.7189 19.9306Z"
  />
</g>`,WebIcon16=icon(WebIconSVG,16),ConfirmIcon=x$1` <svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M17.6726 6.0059L7.49998 16.1785L2.32739 11.0059L3.5059 9.82739L7.49998 13.8215L16.4941 4.82739L17.6726 6.0059Z"
  />
</svg>`,NewEditIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M18.3032 4.49775C18.6342 4.16742 19.1714 4.16742 19.5024 4.49775C19.8326 4.82726 19.8326 5.3609 19.5024 5.69041L19.0739 6.1181L17.8768 4.92334L18.3032 4.49775ZM16.8151 5.98296L18.0122 7.17771L10.9259 14.25H9.75006V13.0341L16.8151 5.98296ZM20.562 3.43604C19.6455 2.52132 18.1601 2.52132 17.2436 3.43604L8.47025 12.1921C8.32928 12.3328 8.25006 12.5238 8.25006 12.723V15C8.25006 15.4142 8.58585 15.75 9.00006 15.75H11.2362C11.4348 15.75 11.6254 15.6712 11.766 15.5309L20.562 6.75212C21.4794 5.83658 21.4794 4.35158 20.562 3.43604ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H12C12.4142 4.75 12.75 4.41421 12.75 4C12.75 3.58579 12.4142 3.25 12 3.25H6C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V12C20.75 11.5858 20.4142 11.25 20 11.25C19.5858 11.25 19.25 11.5858 19.25 12V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6Z"
      fill="currentColor"
    />
  </svg>
`,EditIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M18.3032 4.49775C18.6342 4.16742 19.1714 4.16742 19.5024 4.49775C19.8326 4.82726 19.8326 5.3609 19.5024 5.69041L19.0739 6.1181L17.8768 4.92334L18.3032 4.49775ZM16.8151 5.98296L18.0122 7.17771L10.9259 14.25H9.75006V13.0341L16.8151 5.98296ZM20.562 3.43604C19.6455 2.52132 18.1601 2.52132 17.2436 3.43604L8.47025 12.1921C8.32928 12.3328 8.25006 12.5238 8.25006 12.723V15C8.25006 15.4142 8.58585 15.75 9.00006 15.75H11.2362C11.4348 15.75 11.6254 15.6712 11.766 15.5309L20.562 6.75212C21.4794 5.83658 21.4794 4.35158 20.562 3.43604ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H12C12.4142 4.75 12.75 4.41421 12.75 4C12.75 3.58579 12.4142 3.25 12 3.25H6C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V12C20.75 11.5858 20.4142 11.25 20 11.25C19.5858 11.25 19.25 11.5858 19.25 12V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6Z"
  />
</svg>`,UnlinkIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M14.522 5.34979C15.6618 4.2099 17.51 4.2099 18.6499 5.34979C19.7897 6.48968 19.7897 8.3378 18.6499 9.47769L14.981 13.1466C14.6881 13.4394 14.6881 13.9143 14.981 14.2072C15.2739 14.5001 15.7488 14.5001 16.0416 14.2072L19.7105 10.5383C21.4362 8.81267 21.4362 6.0148 19.7105 4.28913C17.9848 2.56345 15.187 2.56345 13.4613 4.28913L12.4527 5.29771C12.1598 5.5906 12.1598 6.06548 12.4527 6.35837C12.7456 6.65126 13.2205 6.65126 13.5134 6.35837L14.522 5.34979ZM9.01866 10.8531C9.31155 10.5602 9.31155 10.0853 9.01866 9.79243C8.72576 9.49954 8.25089 9.49954 7.958 9.79243L4.28913 13.4613C2.56345 15.187 2.56345 17.9848 4.28913 19.7105C6.0148 21.4362 8.81267 21.4362 10.5383 19.7105L11.5487 18.7001C11.8416 18.4073 11.8416 17.9324 11.5487 17.6395C11.2558 17.3466 10.781 17.3466 10.4881 17.6395L9.47769 18.6499C8.3378 19.7897 6.48968 19.7897 5.34979 18.6499C4.2099 17.51 4.2099 15.6618 5.34979 14.522L9.01866 10.8531ZM9.39547 4.49363C9.30233 4.09002 8.89964 3.83834 8.49603 3.93148C8.09242 4.02462 7.84074 4.42731 7.93388 4.83092L8.33412 6.56529C8.42726 6.9689 8.82995 7.22058 9.23356 7.12744C9.63717 7.0343 9.88885 6.63161 9.79571 6.228L9.39547 4.49363ZM4.83092 7.93388C4.42731 7.84074 4.02462 8.09242 3.93148 8.49603C3.83834 8.89964 4.09002 9.30233 4.49363 9.39547L6.228 9.79571C6.63161 9.88885 7.0343 9.63717 7.12744 9.23356C7.22058 8.82995 6.9689 8.42726 6.56529 8.33412L4.83092 7.93388ZM17.772 14.2043C17.3684 14.1112 16.9657 14.3629 16.8726 14.7665C16.7794 15.1701 17.0311 15.5728 17.4347 15.6659L19.1691 16.0661C19.5727 16.1593 19.9754 15.9076 20.0685 15.504C20.1617 15.1004 19.91 14.6977 19.5064 14.6045L17.772 14.2043ZM15.6659 17.4347C15.5728 17.0311 15.1701 16.7794 14.7665 16.8726C14.3629 16.9657 14.1112 17.3684 14.2043 17.772L14.6045 19.5064C14.6977 19.91 15.1004 20.1617 15.504 20.0685C15.9076 19.9754 16.1593 19.5727 16.0661 19.1691L15.6659 17.4347Z"
  />
</svg>`,CaptionIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M4.25 7C4.25 5.48122 5.48122 4.25 7 4.25H12C13.5188 4.25 14.75 5.48122 14.75 7V10C14.75 11.5188 13.5188 12.75 12 12.75H7C5.48122 12.75 4.25 11.5188 4.25 10V7ZM7 5.75C6.30964 5.75 5.75 6.30964 5.75 7V10C5.75 10.6904 6.30964 11.25 7 11.25H12C12.6904 11.25 13.25 10.6904 13.25 10V7C13.25 6.30964 12.6904 5.75 12 5.75H7ZM4.25 15.5C4.25 15.0858 4.58579 14.75 5 14.75H19C19.4142 14.75 19.75 15.0858 19.75 15.5C19.75 15.9142 19.4142 16.25 19 16.25H5C4.58579 16.25 4.25 15.9142 4.25 15.5ZM5 18.25C4.58579 18.25 4.25 18.5858 4.25 19C4.25 19.4142 4.58579 19.75 5 19.75H14C14.4142 19.75 14.75 19.4142 14.75 19C14.75 18.5858 14.4142 18.25 14 18.25H5Z"
  />
</svg>`,DownloadIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M12.75 4.75C12.75 4.33579 12.4142 4 12 4C11.5858 4 11.25 4.33579 11.25 4.75L11.25 13.4393L9.03033 11.2197C8.73744 10.9268 8.26256 10.9268 7.96967 11.2197C7.67678 11.5126 7.67678 11.9874 7.96967 12.2803L11.4697 15.7803C11.6103 15.921 11.8011 16 12 16C12.1989 16 12.3897 15.921 12.5303 15.7803L16.0303 12.2803C16.3232 11.9874 16.3232 11.5126 16.0303 11.2197C15.7374 10.9268 15.2626 10.9268 14.9697 11.2197L12.75 13.4393L12.75 4.75ZM4.75 10.75C4.75 10.6119 4.86193 10.5 5 10.5H6C6.41421 10.5 6.75 10.1642 6.75 9.75C6.75 9.33579 6.41421 9 6 9H5C4.0335 9 3.25 9.7835 3.25 10.75V17.75C3.25 19.2688 4.48122 20.5 6 20.5H18C19.5188 20.5 20.75 19.2688 20.75 17.75V10.75C20.75 9.7835 19.9665 9 19 9H18C17.5858 9 17.25 9.33579 17.25 9.75C17.25 10.1642 17.5858 10.5 18 10.5H19C19.1381 10.5 19.25 10.6119 19.25 10.75V17.75C19.25 18.4404 18.6904 19 18 19H6C5.30964 19 4.75 18.4404 4.75 17.75V10.75Z"
  />
</svg>`,WrapIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M11.046 5C11.046 4.58579 11.3818 4.25 11.796 4.25H14.6776C18.0311 4.25 20.7497 6.96849 20.7498 10.322C20.7499 13.6757 18.0313 16.3944 14.6776 16.3944H5.78857L8.81522 19.4743C9.10555 19.7697 9.10141 20.2446 8.80598 20.5349C8.51054 20.8253 8.03569 20.8211 7.74536 20.5257L3.46507 16.1701C3.17831 15.8783 3.17831 15.4105 3.46507 15.1187L7.74536 10.7632C8.03569 10.4677 8.51054 10.4636 8.80598 10.7539C9.10141 11.0443 9.10555 11.5191 8.81522 11.8146L5.78857 14.8944H14.6776C17.2028 14.8944 19.2499 12.8473 19.2498 10.3221C19.2497 7.79695 17.2027 5.75 14.6776 5.75H11.796C11.3818 5.75 11.046 5.41421 11.046 5Z"
  />
</svg>`,CancelWrapIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M16.5303 2.46967C16.2374 2.17678 15.7626 2.17678 15.4697 2.46967C15.1768 2.76256 15.1768 3.23744 15.4697 3.53033L18.1893 6.25L8 6.25C7.58579 6.25 7.25 6.58579 7.25 7C7.25 7.41421 7.58579 7.75 8 7.75H18.1893L15.4697 10.4697C15.1768 10.7626 15.1768 11.2374 15.4697 11.5303C15.7626 11.8232 16.2374 11.8232 16.5303 11.5303L20.5303 7.53033C20.671 7.38968 20.75 7.19891 20.75 7C20.75 6.80109 20.671 6.61032 20.5303 6.46967L16.5303 2.46967ZM11.5303 11.4697C11.2374 11.1768 10.7626 11.1768 10.4697 11.4697C10.1768 11.7626 10.1768 12.2374 10.4697 12.5303L13.1893 15.25H4.5C4.08579 15.25 3.75 15.5858 3.75 16C3.75 16.4142 4.08579 16.75 4.5 16.75H13.1893L10.4697 19.4697C10.1768 19.7626 10.1768 20.2374 10.4697 20.5303C10.7626 20.8232 11.2374 20.8232 11.5303 20.5303L15.5303 16.5303C15.671 16.3897 15.75 16.1989 15.75 16C15.75 15.8011 15.671 15.6103 15.5303 15.4697L11.5303 11.4697Z"
  />
</svg>`,ViewIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M12.0004 5.75C8.06451 5.75 4.70095 8.20857 3.36528 11.6764C3.28512 11.8845 3.28512 12.1155 3.36527 12.3236C4.70093 15.7914 8.06451 18.25 12.0005 18.25C15.9364 18.25 19.2999 15.7914 20.6356 12.3236C20.7158 12.1155 20.7158 11.8846 20.6356 11.6764C19.3 8.2086 15.9364 5.75 12.0004 5.75ZM1.96552 11.1372C3.51675 7.10978 7.42369 4.25 12.0004 4.25C16.5772 4.25 20.4842 7.10982 22.0354 11.1373C22.2492 11.6924 22.2492 12.3077 22.0354 12.8628C20.4841 16.8902 16.5772 19.75 12.0005 19.75C7.42369 19.75 3.51672 16.8902 1.96551 12.8627C1.75171 12.3076 1.75171 11.6923 1.96552 11.1372ZM12 9.75C10.7574 9.75 9.74999 10.7574 9.74999 12C9.74999 13.2426 10.7574 14.25 12 14.25C13.2426 14.25 14.25 13.2426 14.25 12C14.25 10.7574 13.2426 9.75 12 9.75ZM8.24999 12C8.24999 9.92893 9.92893 8.25 12 8.25C14.0711 8.25 15.75 9.92893 15.75 12C15.75 14.0711 14.0711 15.75 12 15.75C9.92893 15.75 8.24999 14.0711 8.24999 12Z"
  />
</svg>`,EmbedWebIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M5 3.25C3.48122 3.25 2.25 4.48122 2.25 6V9V18C2.25 19.5188 3.48122 20.75 5 20.75H19C20.5188 20.75 21.75 19.5188 21.75 18V9V6C21.75 4.48122 20.5188 3.25 19 3.25H5ZM20.25 8.25V6C20.25 5.30964 19.6904 4.75 19 4.75H5C4.30964 4.75 3.75 5.30964 3.75 6V8.25H20.25ZM3.75 9.75H20.25V18C20.25 18.6904 19.6904 19.25 19 19.25H5C4.30964 19.25 3.75 18.6904 3.75 18V9.75ZM10.5303 13.0304C10.8232 12.7375 10.8232 12.2627 10.5303 11.9698C10.2374 11.6769 9.76256 11.6769 9.46967 11.9698L7.34835 14.0911C7.05546 14.384 7.05546 14.8589 7.34835 15.1518L9.46967 17.2731C9.76256 17.566 10.2374 17.566 10.5303 17.2731C10.8232 16.9802 10.8232 16.5053 10.5303 16.2124L8.93934 14.6214L10.5303 13.0304ZM13.4697 11.9698C13.1768 12.2627 13.1768 12.7375 13.4697 13.0304L15.0607 14.6214L13.4697 16.2124C13.1768 16.5053 13.1768 16.9802 13.4697 17.2731C13.7626 17.566 14.2374 17.566 14.5303 17.2731L16.6517 15.1518C16.9445 14.8589 16.9445 14.384 16.6517 14.0911L14.5303 11.9698C14.2374 11.6769 13.7626 11.6769 13.4697 11.9698ZM6.5 6.55005C6.5 6.96426 6.16421 7.30005 5.75 7.30005C5.33579 7.30005 5 6.96426 5 6.55005C5 6.13584 5.33579 5.80005 5.75 5.80005C6.16421 5.80005 6.5 6.13584 6.5 6.55005ZM8.25 7.30005C8.66421 7.30005 9 6.96426 9 6.55005C9 6.13584 8.66421 5.80005 8.25 5.80005C7.83579 5.80005 7.5 6.13584 7.5 6.55005C7.5 6.96426 7.83579 7.30005 8.25 7.30005Z"
  />
</svg>`,ArrowDownIcon=x$1` <svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M6.46967 9.46967C6.76256 9.17678 7.23744 9.17678 7.53033 9.46967L11.6464 13.5858C11.8417 13.781 12.1583 13.781 12.3536 13.5858L16.4697 9.46967C16.7626 9.17678 17.2374 9.17678 17.5303 9.46967C17.8232 9.76256 17.8232 10.2374 17.5303 10.5303L13.4142 14.6464C12.6332 15.4275 11.3668 15.4275 10.5858 14.6464L6.46967 10.5303C6.17678 10.2374 6.17678 9.76256 6.46967 9.46967Z"
  />
</svg>`,ShapeArrowDownSmallIcon=x$1`<svg
  width="16"
  height="16"
  viewBox="0 0 16 16"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M11.7202 5.98043C11.9154 6.17569 11.9154 6.49228 11.7202 6.68754L8.38684 10.0209C8.19158 10.2161 7.87499 10.2161 7.67973 10.0209L4.3464 6.68754C4.15114 6.49228 4.15114 6.17569 4.3464 5.98043C4.54166 5.78517 4.85824 5.78517 5.0535 5.98043L8.03328 8.96021L11.0131 5.98043C11.2083 5.78517 11.5249 5.78517 11.7202 5.98043Z"
  />
</svg>`,PageIconSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M7 3.25C5.48122 3.25 4.25 4.48122 4.25 6V18C4.25 19.5188 5.48122 20.75 7 20.75H17C18.5188 20.75 19.75 19.5188 19.75 18V6C19.75 4.48122 18.5188 3.25 17 3.25H7ZM5.75 6C5.75 5.30964 6.30964 4.75 7 4.75H17C17.6904 4.75 18.25 5.30964 18.25 6V18C18.25 18.6904 17.6904 19.25 17 19.25H7C6.30964 19.25 5.75 18.6904 5.75 18V6ZM9 7.25C8.58579 7.25 8.25 7.58579 8.25 8C8.25 8.41421 8.58579 8.75 9 8.75H12.5C12.9142 8.75 13.25 8.41421 13.25 8C13.25 7.58579 12.9142 7.25 12.5 7.25H9ZM8.25 11.5C8.25 11.0858 8.58579 10.75 9 10.75H15C15.4142 10.75 15.75 11.0858 15.75 11.5C15.75 11.9142 15.4142 12.25 15 12.25H9C8.58579 12.25 8.25 11.9142 8.25 11.5ZM9 14.25C8.58579 14.25 8.25 14.5858 8.25 15C8.25 15.4142 8.58579 15.75 9 15.75H14C14.4142 15.75 14.75 15.4142 14.75 15C14.75 14.5858 14.4142 14.25 14 14.25H9Z"/>`,LinkedPageSVG=b$1`
<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M4.25 6C4.25 4.48122 5.48122 3.25 7 3.25H17C18.5188 3.25 19.75 4.48122 19.75 6V12C19.75 12.4142 19.4142 12.75 19 12.75C18.5858 12.75 18.25 12.4142 18.25 12V6C18.25 5.30964 17.6904 4.75 17 4.75H7C6.30964 4.75 5.75 5.30964 5.75 6V18C5.75 18.6904 6.30964 19.25 7 19.25H12C12.4142 19.25 12.75 19.5858 12.75 20C12.75 20.4142 12.4142 20.75 12 20.75H7C5.48122 20.75 4.25 19.5188 4.25 18V6ZM8.25 8C8.25 7.58579 8.58579 7.25 9 7.25H12C12.4142 7.25 12.75 7.58579 12.75 8C12.75 8.41421 12.4142 8.75 12 8.75H9C8.58579 8.75 8.25 8.41421 8.25 8ZM9 10.75C8.58579 10.75 8.25 11.0858 8.25 11.5C8.25 11.9142 8.58579 12.25 9 12.25H15C15.4142 12.25 15.75 11.9142 15.75 11.5C15.75 11.0858 15.4142 10.75 15 10.75H9ZM8.25 15C8.25 14.5858 8.58579 14.25 9 14.25H11.5C11.9142 14.25 12.25 14.5858 12.25 15C12.25 15.4142 11.9142 15.75 11.5 15.75H9C8.58579 15.75 8.25 15.4142 8.25 15ZM15.5 14.25C15.0858 14.25 14.75 14.5858 14.75 15C14.75 15.4142 15.0858 15.75 15.5 15.75H18.1893L14.4697 19.4697C14.1768 19.7626 14.1768 20.2374 14.4697 20.5303C14.7626 20.8232 15.2374 20.8232 15.5303 20.5303L19.25 16.8107V19.5C19.25 19.9142 19.5858 20.25 20 20.25C20.4142 20.25 20.75 19.9142 20.75 19.5V15C20.75 14.8011 20.671 14.6103 20.5303 14.4697C20.3897 14.329 20.1989 14.25 20 14.25H15.5Z"/>
`,FontPageIcon=fontIcon(PageIconSVG),FontLinkedPageIcon=fontIcon(LinkedPageSVG),PageIcon=icon(PageIconSVG,20),LinkedPageIcon=icon(LinkedPageSVG,20),NewPageIcon=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    fill="currentColor"
    d="M12 4.75C12.4142 4.75 12.75 5.08579 12.75 5.5V11.25H18.5C18.9142 11.25 19.25 11.5858 19.25 12C19.25 12.4142 18.9142 12.75 18.5 12.75H12.75V18.5C12.75 18.9142 12.4142 19.25 12 19.25C11.5858 19.25 11.25 18.9142 11.25 18.5V12.75L5.5 12.75C5.08579 12.75 4.75 12.4142 4.75 12C4.75 11.5858 5.08579 11.25 5.5 11.25L11.25 11.25V5.5C11.25 5.08579 11.5858 4.75 12 4.75Z"
  />
</svg>`,DualLinkSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M10.6667 6.19995C10.2525 6.19995 9.91667 5.86416 9.91667 5.44995C9.91667 5.03574 10.2525 4.69995 10.6667 4.69995H19C19.4142 4.69995 19.75 5.03574 19.75 5.44995V13.7833C19.75 14.1975 19.4142 14.5333 19 14.5333C18.5858 14.5333 18.25 14.1975 18.25 13.7833V7.26061L6.53033 18.9803C6.23744 19.2732 5.76256 19.2732 5.46967 18.9803C5.17678 18.6874 5.17678 18.2125 5.46967 17.9196L17.1893 6.19995H10.6667Z"/>`,DualLinkIcon=icon(DualLinkSVG,20),DualLinkIcon16=icon(DualLinkSVG,16),ArrowDownSmallIcon=x$1`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M17.5804 8.96967C17.8733 9.26256 17.8733 9.73744 17.5804 10.0303L12.5804 15.0303C12.2875 15.3232 11.8126 15.3232 11.5197 15.0303L6.51972 10.0303C6.22683 9.73744 6.22683 9.26256 6.51972 8.96967C6.81261 8.67678 7.28749 8.67678 7.58038 8.96967L12.05 13.4393L16.5197 8.96967C16.8126 8.67678 17.2875 8.67678 17.5804 8.96967Z"
      fill="currentColor"
    />
  </svg>
`,AddCursorIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M6 12H18M12 6V18"
    stroke="black"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg> `,FontFamilyIcon=x$1`
  <svg
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M1 18.161C1 18.629 1.38658 18.9647 1.91558 18.9647C2.37337 18.9647 2.63787 18.751 2.81082 18.2627L4.10281 14.6208H9.91166L11.2138 18.2627C11.3868 18.751 11.6513 18.9647 12.1091 18.9647C12.6381 18.9647 13.0246 18.629 13.0246 18.161C13.0246 18.0288 12.9941 17.8762 12.9127 17.6523L8.18223 4.87489C7.95842 4.27467 7.59219 4 7.03267 4C6.43245 4 6.05605 4.28485 5.83224 4.88506L1.1119 17.6523C1.03052 17.8762 1 18.0288 1 18.161ZM9.39283 13.0643H4.63181L6.9818 6.37034H7.04284L9.39283 13.0643ZM13.6533 15.8314C13.6533 17.7337 15.0674 19.0054 17.1732 19.0054C18.5975 19.0054 19.9505 18.2119 20.5812 17.0013H20.6219V18.1101C20.6219 18.6391 20.9678 19.0054 21.4663 19.0054C21.9546 19.0054 22.3005 18.6391 22.3005 18.1101V11.5078C22.3005 9.40193 20.7338 8.05908 18.2516 8.05908C16.5323 8.05908 14.986 8.82206 14.3858 9.9818C14.2434 10.2361 14.1722 10.4905 14.1722 10.7143C14.1722 11.1924 14.4977 11.5078 14.9555 11.5078C15.2912 11.5078 15.5252 11.3755 15.688 11.0805C16.278 10.0327 17.0613 9.61557 18.2109 9.61557C19.6758 9.61557 20.5304 10.3887 20.5304 11.6807V12.5658L17.4886 12.7387C15.0471 12.8811 13.6533 14.0205 13.6533 15.8314ZM20.5304 14.8039C20.5304 16.3298 19.2384 17.4997 17.57 17.4997C16.2984 17.4997 15.454 16.8385 15.454 15.8314C15.454 14.8344 16.2678 14.2037 17.6921 14.1121L20.5304 13.9392V14.8039Z"
      fill="currentColor"
    />
  </svg>
`,AttachmentSVG=b$1`<path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M12.2175 5.60799L6.17732 11.6483C4.27429 13.5017 4.27424 16.4984 6.17727 18.3518C8.09138 20.2161 11.2027 20.2161 13.1168 18.3518L19.0068 12.6288C19.3038 12.3401 19.7787 12.347 20.0673 12.644C20.356 12.9411 20.3491 13.4159 20.0521 13.7046L14.1634 19.4264C14.1633 19.4265 14.1635 19.4263 14.1634 19.4264C11.6669 21.8576 7.62711 21.8578 5.1307 19.4264C2.62432 16.9853 2.6231 13.0198 5.12704 10.5772L11.1676 4.53664C12.929 2.82109 15.7769 2.82114 17.5383 4.53669C19.3095 6.26181 19.3108 9.06644 17.542 10.7931L11.5014 16.8337C10.4751 17.8333 8.81906 17.8333 7.79275 16.8337C6.75536 15.8233 6.75536 14.1768 7.79275 13.1664L13.9911 7.12941C14.2879 6.84041 14.7627 6.84667 15.0517 7.1434C15.3407 7.44013 15.3344 7.91497 15.0377 8.20397L8.83932 14.2409C8.4065 14.6625 8.4065 15.3376 8.83932 15.7591C9.28219 16.1904 10.0075 16.1914 10.4517 15.7621L16.4917 9.72209C17.6596 8.58458 17.6596 6.74876 16.4917 5.61124C15.3138 4.46404 13.3968 4.46295 12.2175 5.60799Z"/>`,AttachmentIcon=icon(AttachmentSVG,20),AttachmentIcon16=icon(AttachmentSVG,16),TextBackgroundDuotoneIcon=x$1` <svg
  xmlns="http://www.w3.org/2000/svg"
  width="20"
  height="20"
  fill="none"
  viewBox="0 0 24 24"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5.99998 4.35004C5.08871 4.35004 4.34998 5.08877 4.34998 6.00004V18C4.34998 18.9113 5.08871 19.65 5.99998 19.65H18C18.9112 19.65 19.65 18.9113 19.65 18V6.00004C19.65 5.08877 18.9112 4.35004 18 4.35004H5.99998Z"
    fill="currentColor"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.65002 6.00002C3.65002 4.70216 4.70216 3.65002 6.00002 3.65002H18C19.2979 3.65002 20.35 4.70216 20.35 6.00002V18C20.35 19.2979 19.2979 20.35 18 20.35H6.00002C4.70216 20.35 3.65002 19.2979 3.65002 18V6.00002ZM6.00002 4.35002C5.08875 4.35002 4.35002 5.08875 4.35002 6.00002V18C4.35002 18.9113 5.08875 19.65 6.00002 19.65H18C18.9113 19.65 19.65 18.9113 19.65 18V6.00002C19.65 5.08875 18.9113 4.35002 18 4.35002H6.00002Z"
    fill="black"
    fill-opacity="0.3"
  />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.6897 7.75798C10.8946 7.21181 11.4167 6.84998 12 6.84998C12.5833 6.84998 13.1054 7.21181 13.3102 7.75798L16.3023 15.7367C16.4477 16.1245 16.2512 16.5568 15.8633 16.7022C15.4755 16.8477 15.0432 16.6512 14.8978 16.2633L14.0706 14.0576H9.92938L9.10223 16.2633C8.95679 16.6512 8.52448 16.8477 8.13664 16.7022C7.7488 16.5568 7.5523 16.1245 7.69774 15.7367L10.6897 7.75798ZM10.4919 12.5576H13.5081L12 8.53597L10.4919 12.5576Z"
    fill="#77757D"
  />
</svg>`,HighLightDuotoneSVG=b$1`
  <path d="M5.82912 16.3197L7.91758 18.4082L6.57812 19.7476C6.53121 19.7945 6.46407 19.8151 6.39891 19.8026L3.37038 19.2199C3.21286 19.1896 3.15332 18.9955 3.26674 18.8821L5.82912 16.3197Z" fill="#1E96EB"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M19.0095 3.51624C17.9526 2.45932 16.26 2.39465 15.1255 3.36783L7.3214 10.0624C6.35443 10.8919 6.0528 12.261 6.58168 13.42L6.73506 13.7562L5.67702 14.8142C5.30174 15.1895 5.30174 15.7979 5.67702 16.1732L8.06384 18.56C8.43912 18.9353 9.04757 18.9353 9.42285 18.56L10.4809 17.502L10.8171 17.6555C11.9761 18.1843 13.3453 17.8827 14.1747 16.9157L20.8693 9.11159C21.8425 7.9771 21.7778 6.28452 20.7209 5.22761L19.0095 3.51624ZM16.1022 4.50634C16.6416 4.04362 17.4463 4.07437 17.9489 4.5769L19.6602 6.28827C20.1628 6.79079 20.1935 7.59555 19.7308 8.13496L14.6424 14.0667L10.1705 9.59469L16.1022 4.50634ZM9.02862 10.5742L8.29803 11.2009C7.83827 11.5953 7.69486 12.2462 7.94632 12.7973L8.2979 13.5678C8.43485 13.8679 8.37953 14.233 8.13377 14.4788L7.11884 15.4937L8.74335 17.1182L9.75818 16.1034C10.004 15.8576 10.3692 15.8023 10.6693 15.9392L11.4398 16.2908C11.9909 16.5423 12.6419 16.3989 13.0362 15.9391L13.663 15.2085L9.02862 10.5742Z" fill="currentColor"/>
`,HighLightDuotoneIcon=icon(HighLightDuotoneSVG,20),ArrowRightBigIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M13.0032 6.4927C12.723 6.79778 12.7432 7.27223 13.0483 7.5524L17.0745 11.25L5 11.25C4.58579 11.25 4.25 11.5858 4.25 12C4.25 12.4142 4.58579 12.75 5 12.75L17.0745 12.75L13.0483 16.4476C12.7432 16.7278 12.723 17.2022 13.0032 17.5073C13.2833 17.8124 13.7578 17.8326 14.0629 17.5524L19.5073 12.5524C19.662 12.4104 19.75 12.21 19.75 12C19.75 11.79 19.662 11.5896 19.5073 11.4476L14.0629 6.44761C13.7578 6.16743 13.2833 6.18762 13.0032 6.4927Z"
    fill="currentColor"
  />
</svg>`,ExpandFullIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M15.25 4C15.25 3.58579 15.5858 3.25 16 3.25H20C20.4142 3.25 20.75 3.58579 20.75 4V8C20.75 8.41421 20.4142 8.75 20 8.75C19.5858 8.75 19.25 8.41421 19.25 8V5.81066L15.0303 10.0303C14.7374 10.3232 14.2626 10.3232 13.9697 10.0303C13.6768 9.73744 13.6768 9.26256 13.9697 8.96967L18.1893 4.75H16C15.5858 4.75 15.25 4.41421 15.25 4ZM10.0303 13.9697C10.3232 14.2626 10.3232 14.7374 10.0303 15.0303L5.81066 19.25H8C8.41421 19.25 8.75 19.5858 8.75 20C8.75 20.4142 8.41421 20.75 8 20.75H4C3.58579 20.75 3.25 20.4142 3.25 20V16C3.25 15.5858 3.58579 15.25 4 15.25C4.41421 15.25 4.75 15.5858 4.75 16V18.1893L8.96967 13.9697C9.26256 13.6768 9.73744 13.6768 10.0303 13.9697Z"
    fill="currentColor"
  />
</svg> `,MoveLeftIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.75 4C4.75 3.58579 4.41421 3.25 4 3.25C3.58579 3.25 3.25 3.58579 3.25 4V20C3.25 20.4142 3.58579 20.75 4 20.75C4.41421 20.75 4.75 20.4142 4.75 20V4ZM13.1548 8.56944C13.4693 8.29988 13.5057 7.8264 13.2361 7.51191C12.9665 7.19741 12.4931 7.16099 12.1786 7.43056L7.51191 11.4306C7.34567 11.573 7.25 11.7811 7.25 12C7.25 12.2189 7.34567 12.427 7.51191 12.5694L12.1786 16.5694C12.4931 16.839 12.9665 16.8026 13.2361 16.4881C13.5057 16.1736 13.4693 15.7001 13.1548 15.4306L10.0274 12.75H20C20.4142 12.75 20.75 12.4142 20.75 12C20.75 11.5858 20.4142 11.25 20 11.25H10.0274L13.1548 8.56944Z"
    fill="currentColor"
  />
</svg> `,MoveRightIcon=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M20.75 4C20.75 3.58579 20.4142 3.25 20 3.25C19.5858 3.25 19.25 3.58579 19.25 4V20C19.25 20.4142 19.5858 20.75 20 20.75C20.4142 20.75 20.75 20.4142 20.75 20V4ZM10.8452 8.56944C10.5307 8.29988 10.4943 7.8264 10.7639 7.51191C11.0335 7.19741 11.5069 7.16099 11.8214 7.43056L16.4881 11.4306C16.6543 11.573 16.75 11.7811 16.75 12C16.75 12.2189 16.6543 12.427 16.4881 12.5694L11.8214 16.5694C11.5069 16.839 11.0335 16.8026 10.7639 16.4881C10.4943 16.1736 10.5307 15.7001 10.8452 15.4306L13.9726 12.75H4C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25H13.9726L10.8452 8.56944Z"
    fill="currentColor"
  />
</svg> `,ArrowUpBigIcon=x$1`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M17.5073 10.9968C17.2022 11.277 16.7278 11.2568 16.4476 10.9517L12.75 6.92547L12.75 19C12.75 19.4142 12.4142 19.75 12 19.75C11.5858 19.75 11.25 19.4142 11.25 19L11.25 6.92547L7.55239 10.9517C7.27222 11.2568 6.79777 11.277 6.49269 10.9968C6.18761 10.7167 6.16742 10.2422 6.4476 9.93714L11.4476 4.4927C11.5896 4.33803 11.79 4.25 12 4.25C12.21 4.25 12.4104 4.33803 12.5524 4.4927L17.5524 9.93714C17.8326 10.2422 17.8124 10.7167 17.5073 10.9968Z"
    />
  </svg>
`,ArrowDownBigIcon=x$1`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      fill="currentColor"
      d="M17.5073 13.0032C17.2022 12.723 16.7278 12.7432 16.4476 13.0483L12.75 17.0745L12.75 5C12.75 4.58579 12.4142 4.25 12 4.25C11.5858 4.25 11.25 4.58579 11.25 5L11.25 17.0745L7.55239 13.0483C7.27222 12.7432 6.79777 12.723 6.49269 13.0032C6.18761 13.2833 6.16742 13.7578 6.4476 14.0629L11.4476 19.5073C11.5896 19.662 11.79 19.75 12 19.75C12.21 19.75 12.4104 19.662 12.5524 19.5073L17.5524 14.0629C17.8326 13.7578 17.8124 13.2833 17.5073 13.0032Z"
    />
  </svg>
`,icons=Object.freeze(Object.defineProperty({__proto__:null,AddCursorIcon,AddFrameButtonIcon,ArrowDownBigIcon,ArrowDownIcon,ArrowDownSmallIcon,ArrowIcon,ArrowRightBigIcon,ArrowRightSmallIcon,ArrowUpBigIcon,ArrowUpIcon,AttachmentIcon,AttachmentIcon16,AutoCompleteArrowIcon,BanIcon,BlockHubIcon,BlockHubIcon20,BlockHubRoundedRectangleIcon,BoldIcon,BookmarkIcon,BringForwardIcon,BringToFrontIcon,BulletedListIcon,BulletedListIconLarge,CancelWrapIcon,CaptionIcon,CardIcon,ChangeShapeIcon,CheckBoxIcon,CloseIcon,CodeBlockIcon,CodeIcon,ConfirmIcon,ConnectorLIcon,ConnectorLWithArrowIcon,ConnectorXIcon,ConnectorXWithArrowIcon,CopyAsPngIcon,CopyIcon,CrossIcon,CutIcon,DashLineIcon,DatabaseAddColumn,DatabaseDragIcon,DatabaseDuplicate,DatabaseExpand,DatabaseInsertLeft,DatabaseInsertRight,DatabaseKanbanViewIcon,DatabaseKanbanViewIcon20,DatabaseKanbanViewSVG,DatabaseMoveLeft,DatabaseMoveRight,DatabaseMultiSelect,DatabaseNumber,DatabaseProgress,DatabaseSearchClose,DatabaseSearchIcon,DatabaseSelect,DatabaseTableViewClose,DatabaseTableViewIcon,DatabaseTableViewIcon20,DatabaseTableViewSVG,DateTime,DeleteIcon,DiamondIcon,DividerIcon,DownloadIcon,DualLinkIcon,DualLinkIcon16,DualLinkSVG,DuplicateIcon,EdgelessConnectorIcon,EdgelessEraserIcon,EdgelessGeneralShapeIcon,EdgelessImageIcon,EdgelessPenIcon,EdgelessTextIcon,EditIcon,EllipseIcon,EmbedIcon,EmbedWebIcon,ExpandFullIcon,ExportToHTMLIcon,ExportToMarkdownIcon,FontFamilyIcon,FontLinkIcon,FontLinkedPageIcon,FontPageIcon,FrameIcon,FrameNavigatorIcon,FrameNavigatorNextIcon,FrameNavigatorPrevIcon,FrameOrderAdjustmentIcon,GeneralShapeStyleIcon,GeneralStyleIcon,HandIcon,Heading1Icon,Heading2Icon,Heading3Icon,Heading4Icon,Heading5Icon,Heading6Icon,HelpIcon,HiddenCardIcon,HiddenIcon,HighLightDuotoneIcon,ImageIcon,ImageIcon20,ImportIcon,ItalicIcon,LargeFrameIcon,LineStyleIcon,LinkIcon,LinkedPageIcon,MinusIcon,MoreCopyIcon,MoreDeleteIcon,MoreDuplicateIcon,MoreHorizontalIcon,MoreIcon,MoreVerticalIcon,MoveLeftIcon,MoveRightIcon,NewEditIcon,NewIcon,NewPageIcon,NoteIcon,NotionIcon,NowIcon,NumberedListIcon,NumberedListIconLarge,PageIcon,PenIcon,PlusIcon,PresentationExitFullScreenIcon,PresentationFullScreenIcon,QuoteIcon,RefreshIcon,RenameIcon,RoughIcon,RoundedRectangleIcon,ScribbledDiamondIcon,ScribbledEllipseIcon,ScribbledRoundedRectangleIcon,ScribbledShapeStyleIcon,ScribbledSquareIcon,ScribbledStyleIcon,ScribbledTriangleIcon,SearchIcon,SelectIcon,SendBackwardIcon,SendToBackIcon,ShapeArrowDownSmallIcon,SmallArrowDownIcon,SquareIcon,StraightLineIcon,StrikethroughIcon,TagsIcon,TextAlignCenterIcon,TextAlignLeftIcon,TextAlignRightIcon,TextBackgroundDuotoneIcon,TextIcon,TextIconLarge,TitleIcon,TodayIcon,TomorrowIcon,TransparentIcon,TriangleIcon,UnderlineIcon,UnlinkIcon,ViewBarIcon,ViewIcon,WebIcon16,WebIconSVG,WrapIcon,YesterdayIcon,fontIcon,icon},Symbol.toStringTag,{value:"Module"})),listenBacklinkList=(k,_)=>{const y=Object.fromEntries(k.page.workspace.meta.pageMetas.map(H=>[H.id,H])),w=k.page,$=H=>{const j=y[H.pageId];return j||console.warn("Unexpected page meta not found",H.pageId),{...H,...j,icon:H.type==="LinkedPage"?LinkedPageIcon:PageIcon,jump:()=>{H.pageId!==w.id&&k.slots.pageLinkClicked.emit({pageId:H.pageId,blockId:H.blockId})}}},B=w.workspace.indexer.backlink,R=()=>B.getBacklink(w.id).filter(H=>H.type==="LinkedPage").map($);return _(R()),B.slots.indexUpdated.on(()=>{_(R())})},DEFAULT_PAGE_NAME$2="Untitled";var __decorate$2w=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$q=i$5`
  :host {
    position: relative;
    display: flex;
  }

  .btn {
    padding: 0 12px;
    box-sizing: border-box;
    display: inline-flex;
    align-items: center;
    border: none;
    height: 30px;
    border-radius: 8px;
    gap: 4px;
    background: transparent;
    cursor: pointer;

    user-select: none;
    font-size: var(--affine-font-sm);
    font-family: var(--affine-font-family);
    fill: var(--affine-text-secondary-color);
    color: var(--affine-text-secondary-color);
    pointer-events: auto;
  }

  .btn > span {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .btn:hover {
    background: var(--affine-hover-color);
  }

  .btn:active {
    background: var(--affine-hover-color);
  }

  .backlink-popover {
    position: absolute;
    left: 0;
    bottom: 0;
    transform: translateY(100%);
    z-index: 1;
    padding-top: 8px;
  }

  .menu {
    display: flex;
    flex-direction: column;
    padding: 8px 4px;
    background: var(--affine-white);
    box-shadow: var(--affine-menu-shadow);
    border-radius: 12px;
  }

  .backlink-popover .group-title {
    color: var(--affine-text-secondary-color);
    margin: 8px 12px;
  }

  .backlink-popover icon-button {
    padding: 8px;
    justify-content: flex-start;
    gap: 8px;
  }

  ${scrollbarStyle(".backlink-popover .group")}
`;let BacklinkButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.backlinks=[],this._showPopover=!1,this._onClickAway=_=>{_.target!==this&&this._showPopover&&(this._showPopover=!1)}}connectedCallback(){super.connectedCallback(),this.tabIndex=0,this._disposables.addFromEvent(window,"mousedown",this._onClickAway)}onClick(){this._showPopover=!this._showPopover}render(){const _=this.backlinks;return _.length?x$1`
      <div class="btn" @click="${this.onClick}">
        ${DualLinkIcon16}<span>Backlinks (${_.length})</span>
        ${this._showPopover?backlinkPopover(_):null}
      </div>
    `:null}};BacklinkButton.styles=styles$q;__decorate$2w([n$a({attribute:!1})],BacklinkButton.prototype,"backlinks",void 0);__decorate$2w([t$2()],BacklinkButton.prototype,"_showPopover",void 0);BacklinkButton=__decorate$2w([e$7("backlink-button")],BacklinkButton);function backlinkPopover(k){return x$1` <div class="backlink-popover">
    <div class="menu">
      <div class="group-title">Linked to this page</div>
      <div class="group" style="overflow-y: scroll; max-height: 372px;">
        ${k.map(_=>{const y=_.title||DEFAULT_PAGE_NAME$2;return x$1`<icon-button
            width="248px"
            height="32px"
            text="${y}"
            @mousedown="${_.jump}"
          >
            ${_.icon}
          </icon-button>`})}
      </div>
    </div>
  </div>`}const sides=["top","right","bottom","left"],alignments=["start","end"],placements=sides.reduce((k,_)=>k.concat(_,_+"-"+alignments[0],_+"-"+alignments[1]),[]),min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=k=>({x:k,y:k}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(k,_,y){return max(k,min(_,y))}function evaluate(k,_){return typeof k=="function"?k(_):k}function getSide(k){return k.split("-")[0]}function getAlignment(k){return k.split("-")[1]}function getOppositeAxis(k){return k==="x"?"y":"x"}function getAxisLength(k){return k==="y"?"height":"width"}function getSideAxis(k){return["top","bottom"].includes(getSide(k))?"y":"x"}function getAlignmentAxis(k){return getOppositeAxis(getSideAxis(k))}function getAlignmentSides(k,_,y){y===void 0&&(y=!1);const w=getAlignment(k),$=getAlignmentAxis(k),B=getAxisLength($);let R=$==="x"?w===(y?"end":"start")?"right":"left":w==="start"?"bottom":"top";return _.reference[B]>_.floating[B]&&(R=getOppositePlacement(R)),[R,getOppositePlacement(R)]}function getExpandedPlacements(k){const _=getOppositePlacement(k);return[getOppositeAlignmentPlacement(k),_,getOppositeAlignmentPlacement(_)]}function getOppositeAlignmentPlacement(k){return k.replace(/start|end/g,_=>oppositeAlignmentMap[_])}function getSideList(k,_,y){const w=["left","right"],$=["right","left"],B=["top","bottom"],R=["bottom","top"];switch(k){case"top":case"bottom":return y?_?$:w:_?w:$;case"left":case"right":return _?B:R;default:return[]}}function getOppositeAxisPlacements(k,_,y,w){const $=getAlignment(k);let B=getSideList(getSide(k),y==="start",w);return $&&(B=B.map(R=>R+"-"+$),_&&(B=B.concat(B.map(getOppositeAlignmentPlacement)))),B}function getOppositePlacement(k){return k.replace(/left|right|bottom|top/g,_=>oppositeSideMap[_])}function expandPaddingObject(k){return{top:0,right:0,bottom:0,left:0,...k}}function getPaddingObject(k){return typeof k!="number"?expandPaddingObject(k):{top:k,right:k,bottom:k,left:k}}function rectToClientRect(k){return{...k,top:k.y,left:k.x,right:k.x+k.width,bottom:k.y+k.height}}function computeCoordsFromPlacement(k,_,y){let{reference:w,floating:$}=k;const B=getSideAxis(_),R=getAlignmentAxis(_),H=getAxisLength(R),j=getSide(_),q=B==="y",X=w.x+w.width/2-$.width/2,ee=w.y+w.height/2-$.height/2,te=w[H]/2-$[H]/2;let ne;switch(j){case"top":ne={x:X,y:w.y-$.height};break;case"bottom":ne={x:X,y:w.y+w.height};break;case"right":ne={x:w.x+w.width,y:ee};break;case"left":ne={x:w.x-$.width,y:ee};break;default:ne={x:w.x,y:w.y}}switch(getAlignment(_)){case"start":ne[R]-=te*(y&&q?-1:1);break;case"end":ne[R]+=te*(y&&q?-1:1);break}return ne}const computePosition$1=async(k,_,y)=>{const{placement:w="bottom",strategy:$="absolute",middleware:B=[],platform:R}=y,H=B.filter(Boolean),j=await(R.isRTL==null?void 0:R.isRTL(_));let q=await R.getElementRects({reference:k,floating:_,strategy:$}),{x:X,y:ee}=computeCoordsFromPlacement(q,w,j),te=w,ne={},oe=0;for(let ie=0;ie<H.length;ie++){const{name:ae,fn:re}=H[ie],{x:se,y:le,data:ue,reset:he}=await re({x:X,y:ee,initialPlacement:w,placement:te,strategy:$,middlewareData:ne,rects:q,platform:R,elements:{reference:k,floating:_}});if(X=se??X,ee=le??ee,ne={...ne,[ae]:{...ne[ae],...ue}},he&&oe<=50){oe++,typeof he=="object"&&(he.placement&&(te=he.placement),he.rects&&(q=he.rects===!0?await R.getElementRects({reference:k,floating:_,strategy:$}):he.rects),{x:X,y:ee}=computeCoordsFromPlacement(q,te,j)),ie=-1;continue}}return{x:X,y:ee,placement:te,strategy:$,middlewareData:ne}};async function detectOverflow(k,_){var y;_===void 0&&(_={});const{x:w,y:$,platform:B,rects:R,elements:H,strategy:j}=k,{boundary:q="clippingAncestors",rootBoundary:X="viewport",elementContext:ee="floating",altBoundary:te=!1,padding:ne=0}=evaluate(_,k),oe=getPaddingObject(ne),ae=H[te?ee==="floating"?"reference":"floating":ee],re=rectToClientRect(await B.getClippingRect({element:(y=await(B.isElement==null?void 0:B.isElement(ae)))==null||y?ae:ae.contextElement||await(B.getDocumentElement==null?void 0:B.getDocumentElement(H.floating)),boundary:q,rootBoundary:X,strategy:j})),se=ee==="floating"?{...R.floating,x:w,y:$}:R.reference,le=await(B.getOffsetParent==null?void 0:B.getOffsetParent(H.floating)),ue=await(B.isElement==null?void 0:B.isElement(le))?await(B.getScale==null?void 0:B.getScale(le))||{x:1,y:1}:{x:1,y:1},he=rectToClientRect(B.convertOffsetParentRelativeRectToViewportRelativeRect?await B.convertOffsetParentRelativeRectToViewportRelativeRect({rect:se,offsetParent:le,strategy:j}):se);return{top:(re.top-he.top+oe.top)/ue.y,bottom:(he.bottom-re.bottom+oe.bottom)/ue.y,left:(re.left-he.left+oe.left)/ue.x,right:(he.right-re.right+oe.right)/ue.x}}function getPlacementList(k,_,y){return(k?[...y.filter($=>getAlignment($)===k),...y.filter($=>getAlignment($)!==k)]:y.filter($=>getSide($)===$)).filter($=>k?getAlignment($)===k||(_?getOppositeAlignmentPlacement($)!==$:!1):!0)}const autoPlacement=function(k){return k===void 0&&(k={}),{name:"autoPlacement",options:k,async fn(_){var y,w,$;const{rects:B,middlewareData:R,placement:H,platform:j,elements:q}=_,{crossAxis:X=!1,alignment:ee,allowedPlacements:te=placements,autoAlignment:ne=!0,...oe}=evaluate(k,_),ie=ee!==void 0||te===placements?getPlacementList(ee||null,ne,te):te,ae=await detectOverflow(_,oe),re=((y=R.autoPlacement)==null?void 0:y.index)||0,se=ie[re];if(se==null)return{};const le=getAlignmentSides(se,B,await(j.isRTL==null?void 0:j.isRTL(q.floating)));if(H!==se)return{reset:{placement:ie[0]}};const ue=[ae[getSide(se)],ae[le[0]],ae[le[1]]],he=[...((w=R.autoPlacement)==null?void 0:w.overflows)||[],{placement:se,overflows:ue}],ce=ie[re+1];if(ce)return{data:{index:re+1,overflows:he},reset:{placement:ce}};const ge=he.map(we=>{const Ce=getAlignment(we.placement);return[we.placement,Ce&&X?we.overflows.slice(0,2).reduce((ve,ke)=>ve+ke,0):we.overflows[0],we.overflows]}).sort((we,Ce)=>we[1]-Ce[1]),fe=(($=ge.filter(we=>we[2].slice(0,getAlignment(we[0])?2:3).every(Ce=>Ce<=0))[0])==null?void 0:$[0])||ge[0][0];return fe!==H?{data:{index:re+1,overflows:he},reset:{placement:fe}}:{}}}},flip=function(k){return k===void 0&&(k={}),{name:"flip",options:k,async fn(_){var y,w;const{placement:$,middlewareData:B,rects:R,initialPlacement:H,platform:j,elements:q}=_,{mainAxis:X=!0,crossAxis:ee=!0,fallbackPlacements:te,fallbackStrategy:ne="bestFit",fallbackAxisSideDirection:oe="none",flipAlignment:ie=!0,...ae}=evaluate(k,_);if((y=B.arrow)!=null&&y.alignmentOffset)return{};const re=getSide($),se=getSide(H)===H,le=await(j.isRTL==null?void 0:j.isRTL(q.floating)),ue=te||(se||!ie?[getOppositePlacement(H)]:getExpandedPlacements(H));!te&&oe!=="none"&&ue.push(...getOppositeAxisPlacements(H,ie,oe,le));const he=[H,...ue],ce=await detectOverflow(_,ae),ge=[];let be=((w=B.flip)==null?void 0:w.overflows)||[];if(X&&ge.push(ce[re]),ee){const ve=getAlignmentSides($,R,le);ge.push(ce[ve[0]],ce[ve[1]])}if(be=[...be,{placement:$,overflows:ge}],!ge.every(ve=>ve<=0)){var fe,we;const ve=(((fe=B.flip)==null?void 0:fe.index)||0)+1,ke=he[ve];if(ke)return{data:{index:ve,overflows:be},reset:{placement:ke}};let me=(we=be.filter(Ie=>Ie.overflows[0]<=0).sort((Ie,Fe)=>Ie.overflows[1]-Fe.overflows[1])[0])==null?void 0:we.placement;if(!me)switch(ne){case"bestFit":{var Ce;const Ie=(Ce=be.map(Fe=>[Fe.placement,Fe.overflows.filter(Be=>Be>0).reduce((Be,Ze)=>Be+Ze,0)]).sort((Fe,Be)=>Fe[1]-Be[1])[0])==null?void 0:Ce[0];Ie&&(me=Ie);break}case"initialPlacement":me=H;break}if($!==me)return{reset:{placement:me}}}return{}}}};function getBoundingRect(k){const _=min(...k.map(B=>B.left)),y=min(...k.map(B=>B.top)),w=max(...k.map(B=>B.right)),$=max(...k.map(B=>B.bottom));return{x:_,y,width:w-_,height:$-y}}function getRectsByLine(k){const _=k.slice().sort(($,B)=>$.y-B.y),y=[];let w=null;for(let $=0;$<_.length;$++){const B=_[$];!w||B.y-w.y>w.height/2?y.push([B]):y[y.length-1].push(B),w=B}return y.map($=>rectToClientRect(getBoundingRect($)))}const inline$1=function(k){return k===void 0&&(k={}),{name:"inline",options:k,async fn(_){const{placement:y,elements:w,rects:$,platform:B,strategy:R}=_,{padding:H=2,x:j,y:q}=evaluate(k,_),X=Array.from(await(B.getClientRects==null?void 0:B.getClientRects(w.reference))||[]),ee=getRectsByLine(X),te=rectToClientRect(getBoundingRect(X)),ne=getPaddingObject(H);function oe(){if(ee.length===2&&ee[0].left>ee[1].right&&j!=null&&q!=null)return ee.find(ae=>j>ae.left-ne.left&&j<ae.right+ne.right&&q>ae.top-ne.top&&q<ae.bottom+ne.bottom)||te;if(ee.length>=2){if(getSideAxis(y)==="y"){const we=ee[0],Ce=ee[ee.length-1],ve=getSide(y)==="top",ke=we.top,me=Ce.bottom,Ie=ve?we.left:Ce.left,Fe=ve?we.right:Ce.right,Be=Fe-Ie,Ze=me-ke;return{top:ke,bottom:me,left:Ie,right:Fe,width:Be,height:Ze,x:Ie,y:ke}}const ae=getSide(y)==="left",re=max(...ee.map(we=>we.right)),se=min(...ee.map(we=>we.left)),le=ee.filter(we=>ae?we.left===se:we.right===re),ue=le[0].top,he=le[le.length-1].bottom,ce=se,ge=re,be=ge-ce,fe=he-ue;return{top:ue,bottom:he,left:ce,right:ge,width:be,height:fe,x:ce,y:ue}}return te}const ie=await B.getElementRects({reference:{getBoundingClientRect:oe},floating:w.floating,strategy:R});return $.reference.x!==ie.reference.x||$.reference.y!==ie.reference.y||$.reference.width!==ie.reference.width||$.reference.height!==ie.reference.height?{reset:{rects:ie}}:{}}}};async function convertValueToCoords(k,_){const{placement:y,platform:w,elements:$}=k,B=await(w.isRTL==null?void 0:w.isRTL($.floating)),R=getSide(y),H=getAlignment(y),j=getSideAxis(y)==="y",q=["left","top"].includes(R)?-1:1,X=B&&j?-1:1,ee=evaluate(_,k);let{mainAxis:te,crossAxis:ne,alignmentAxis:oe}=typeof ee=="number"?{mainAxis:ee,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...ee};return H&&typeof oe=="number"&&(ne=H==="end"?oe*-1:oe),j?{x:ne*X,y:te*q}:{x:te*q,y:ne*X}}const offset$1=function(k){return k===void 0&&(k=0),{name:"offset",options:k,async fn(_){const{x:y,y:w}=_,$=await convertValueToCoords(_,k);return{x:y+$.x,y:w+$.y,data:$}}}},shift=function(k){return k===void 0&&(k={}),{name:"shift",options:k,async fn(_){const{x:y,y:w,placement:$}=_,{mainAxis:B=!0,crossAxis:R=!1,limiter:H={fn:ae=>{let{x:re,y:se}=ae;return{x:re,y:se}}},...j}=evaluate(k,_),q={x:y,y:w},X=await detectOverflow(_,j),ee=getSideAxis(getSide($)),te=getOppositeAxis(ee);let ne=q[te],oe=q[ee];if(B){const ae=te==="y"?"top":"left",re=te==="y"?"bottom":"right",se=ne+X[ae],le=ne-X[re];ne=clamp(se,ne,le)}if(R){const ae=ee==="y"?"top":"left",re=ee==="y"?"bottom":"right",se=oe+X[ae],le=oe-X[re];oe=clamp(se,oe,le)}const ie=H.fn({..._,[te]:ne,[ee]:oe});return{...ie,data:{x:ie.x-y,y:ie.y-w}}}}},size=function(k){return k===void 0&&(k={}),{name:"size",options:k,async fn(_){const{placement:y,rects:w,platform:$,elements:B}=_,{apply:R=()=>{},...H}=evaluate(k,_),j=await detectOverflow(_,H),q=getSide(y),X=getAlignment(y),ee=getSideAxis(y)==="y",{width:te,height:ne}=w.floating;let oe,ie;q==="top"||q==="bottom"?(oe=q,ie=X===(await($.isRTL==null?void 0:$.isRTL(B.floating))?"start":"end")?"left":"right"):(ie=q,oe=X==="end"?"top":"bottom");const ae=ne-j[oe],re=te-j[ie],se=!_.middlewareData.shift;let le=ae,ue=re;if(ee){const ce=te-j.left-j.right;ue=X||se?min(re,ce):ce}else{const ce=ne-j.top-j.bottom;le=X||se?min(ae,ce):ce}if(se&&!X){const ce=max(j.left,0),ge=max(j.right,0),be=max(j.top,0),fe=max(j.bottom,0);ee?ue=te-2*(ce!==0||ge!==0?ce+ge:max(j.left,j.right)):le=ne-2*(be!==0||fe!==0?be+fe:max(j.top,j.bottom))}await R({..._,availableWidth:ue,availableHeight:le});const he=await $.getDimensions(B.floating);return te!==he.width||ne!==he.height?{reset:{rects:!0}}:{}}}};function getNodeName(k){return isNode$1(k)?(k.nodeName||"").toLowerCase():"#document"}function getWindow(k){var _;return(k==null||(_=k.ownerDocument)==null?void 0:_.defaultView)||window}function getDocumentElement(k){var _;return(_=(isNode$1(k)?k.ownerDocument:k.document)||window.document)==null?void 0:_.documentElement}function isNode$1(k){return k instanceof Node||k instanceof getWindow(k).Node}function isElement(k){return k instanceof Element||k instanceof getWindow(k).Element}function isHTMLElement(k){return k instanceof HTMLElement||k instanceof getWindow(k).HTMLElement}function isShadowRoot(k){return typeof ShadowRoot>"u"?!1:k instanceof ShadowRoot||k instanceof getWindow(k).ShadowRoot}function isOverflowElement(k){const{overflow:_,overflowX:y,overflowY:w,display:$}=getComputedStyle$1(k);return/auto|scroll|overlay|hidden|clip/.test(_+w+y)&&!["inline","contents"].includes($)}function isTableElement(k){return["table","td","th"].includes(getNodeName(k))}function isContainingBlock(k){const _=isWebKit(),y=getComputedStyle$1(k);return y.transform!=="none"||y.perspective!=="none"||(y.containerType?y.containerType!=="normal":!1)||!_&&(y.backdropFilter?y.backdropFilter!=="none":!1)||!_&&(y.filter?y.filter!=="none":!1)||["transform","perspective","filter"].some(w=>(y.willChange||"").includes(w))||["paint","layout","strict","content"].some(w=>(y.contain||"").includes(w))}function getContainingBlock(k){let _=getParentNode(k);for(;isHTMLElement(_)&&!isLastTraversableNode(_);){if(isContainingBlock(_))return _;_=getParentNode(_)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(k){return["html","body","#document"].includes(getNodeName(k))}function getComputedStyle$1(k){return getWindow(k).getComputedStyle(k)}function getNodeScroll(k){return isElement(k)?{scrollLeft:k.scrollLeft,scrollTop:k.scrollTop}:{scrollLeft:k.pageXOffset,scrollTop:k.pageYOffset}}function getParentNode(k){if(getNodeName(k)==="html")return k;const _=k.assignedSlot||k.parentNode||isShadowRoot(k)&&k.host||getDocumentElement(k);return isShadowRoot(_)?_.host:_}function getNearestOverflowAncestor(k){const _=getParentNode(k);return isLastTraversableNode(_)?k.ownerDocument?k.ownerDocument.body:k.body:isHTMLElement(_)&&isOverflowElement(_)?_:getNearestOverflowAncestor(_)}function getOverflowAncestors(k,_,y){var w;_===void 0&&(_=[]),y===void 0&&(y=!0);const $=getNearestOverflowAncestor(k),B=$===((w=k.ownerDocument)==null?void 0:w.body),R=getWindow($);return B?_.concat(R,R.visualViewport||[],isOverflowElement($)?$:[],R.frameElement&&y?getOverflowAncestors(R.frameElement):[]):_.concat($,getOverflowAncestors($,[],y))}function getCssDimensions(k){const _=getComputedStyle$1(k);let y=parseFloat(_.width)||0,w=parseFloat(_.height)||0;const $=isHTMLElement(k),B=$?k.offsetWidth:y,R=$?k.offsetHeight:w,H=round(y)!==B||round(w)!==R;return H&&(y=B,w=R),{width:y,height:w,$:H}}function unwrapElement(k){return isElement(k)?k:k.contextElement}function getScale(k){const _=unwrapElement(k);if(!isHTMLElement(_))return createCoords(1);const y=_.getBoundingClientRect(),{width:w,height:$,$:B}=getCssDimensions(_);let R=(B?round(y.width):y.width)/w,H=(B?round(y.height):y.height)/$;return(!R||!Number.isFinite(R))&&(R=1),(!H||!Number.isFinite(H))&&(H=1),{x:R,y:H}}const noOffsets=createCoords(0);function getVisualOffsets(k){const _=getWindow(k);return!isWebKit()||!_.visualViewport?noOffsets:{x:_.visualViewport.offsetLeft,y:_.visualViewport.offsetTop}}function shouldAddVisualOffsets(k,_,y){return _===void 0&&(_=!1),!y||_&&y!==getWindow(k)?!1:_}function getBoundingClientRect(k,_,y,w){_===void 0&&(_=!1),y===void 0&&(y=!1);const $=k.getBoundingClientRect(),B=unwrapElement(k);let R=createCoords(1);_&&(w?isElement(w)&&(R=getScale(w)):R=getScale(k));const H=shouldAddVisualOffsets(B,y,w)?getVisualOffsets(B):createCoords(0);let j=($.left+H.x)/R.x,q=($.top+H.y)/R.y,X=$.width/R.x,ee=$.height/R.y;if(B){const te=getWindow(B),ne=w&&isElement(w)?getWindow(w):w;let oe=te.frameElement;for(;oe&&w&&ne!==te;){const ie=getScale(oe),ae=oe.getBoundingClientRect(),re=getComputedStyle$1(oe),se=ae.left+(oe.clientLeft+parseFloat(re.paddingLeft))*ie.x,le=ae.top+(oe.clientTop+parseFloat(re.paddingTop))*ie.y;j*=ie.x,q*=ie.y,X*=ie.x,ee*=ie.y,j+=se,q+=le,oe=getWindow(oe).frameElement}}return rectToClientRect({width:X,height:ee,x:j,y:q})}function convertOffsetParentRelativeRectToViewportRelativeRect(k){let{rect:_,offsetParent:y,strategy:w}=k;const $=isHTMLElement(y),B=getDocumentElement(y);if(y===B)return _;let R={scrollLeft:0,scrollTop:0},H=createCoords(1);const j=createCoords(0);if(($||!$&&w!=="fixed")&&((getNodeName(y)!=="body"||isOverflowElement(B))&&(R=getNodeScroll(y)),isHTMLElement(y))){const q=getBoundingClientRect(y);H=getScale(y),j.x=q.x+y.clientLeft,j.y=q.y+y.clientTop}return{width:_.width*H.x,height:_.height*H.y,x:_.x*H.x-R.scrollLeft*H.x+j.x,y:_.y*H.y-R.scrollTop*H.y+j.y}}function getClientRects(k){return Array.from(k.getClientRects())}function getWindowScrollBarX(k){return getBoundingClientRect(getDocumentElement(k)).left+getNodeScroll(k).scrollLeft}function getDocumentRect(k){const _=getDocumentElement(k),y=getNodeScroll(k),w=k.ownerDocument.body,$=max(_.scrollWidth,_.clientWidth,w.scrollWidth,w.clientWidth),B=max(_.scrollHeight,_.clientHeight,w.scrollHeight,w.clientHeight);let R=-y.scrollLeft+getWindowScrollBarX(k);const H=-y.scrollTop;return getComputedStyle$1(w).direction==="rtl"&&(R+=max(_.clientWidth,w.clientWidth)-$),{width:$,height:B,x:R,y:H}}function getViewportRect(k,_){const y=getWindow(k),w=getDocumentElement(k),$=y.visualViewport;let B=w.clientWidth,R=w.clientHeight,H=0,j=0;if($){B=$.width,R=$.height;const q=isWebKit();(!q||q&&_==="fixed")&&(H=$.offsetLeft,j=$.offsetTop)}return{width:B,height:R,x:H,y:j}}function getInnerBoundingClientRect(k,_){const y=getBoundingClientRect(k,!0,_==="fixed"),w=y.top+k.clientTop,$=y.left+k.clientLeft,B=isHTMLElement(k)?getScale(k):createCoords(1),R=k.clientWidth*B.x,H=k.clientHeight*B.y,j=$*B.x,q=w*B.y;return{width:R,height:H,x:j,y:q}}function getClientRectFromClippingAncestor(k,_,y){let w;if(_==="viewport")w=getViewportRect(k,y);else if(_==="document")w=getDocumentRect(getDocumentElement(k));else if(isElement(_))w=getInnerBoundingClientRect(_,y);else{const $=getVisualOffsets(k);w={..._,x:_.x-$.x,y:_.y-$.y}}return rectToClientRect(w)}function hasFixedPositionAncestor(k,_){const y=getParentNode(k);return y===_||!isElement(y)||isLastTraversableNode(y)?!1:getComputedStyle$1(y).position==="fixed"||hasFixedPositionAncestor(y,_)}function getClippingElementAncestors(k,_){const y=_.get(k);if(y)return y;let w=getOverflowAncestors(k,[],!1).filter(H=>isElement(H)&&getNodeName(H)!=="body"),$=null;const B=getComputedStyle$1(k).position==="fixed";let R=B?getParentNode(k):k;for(;isElement(R)&&!isLastTraversableNode(R);){const H=getComputedStyle$1(R),j=isContainingBlock(R);!j&&H.position==="fixed"&&($=null),(B?!j&&!$:!j&&H.position==="static"&&!!$&&["absolute","fixed"].includes($.position)||isOverflowElement(R)&&!j&&hasFixedPositionAncestor(k,R))?w=w.filter(X=>X!==R):$=H,R=getParentNode(R)}return _.set(k,w),w}function getClippingRect(k){let{element:_,boundary:y,rootBoundary:w,strategy:$}=k;const R=[...y==="clippingAncestors"?getClippingElementAncestors(_,this._c):[].concat(y),w],H=R[0],j=R.reduce((q,X)=>{const ee=getClientRectFromClippingAncestor(_,X,$);return q.top=max(ee.top,q.top),q.right=min(ee.right,q.right),q.bottom=min(ee.bottom,q.bottom),q.left=max(ee.left,q.left),q},getClientRectFromClippingAncestor(_,H,$));return{width:j.right-j.left,height:j.bottom-j.top,x:j.left,y:j.top}}function getDimensions(k){return getCssDimensions(k)}function getRectRelativeToOffsetParent(k,_,y){const w=isHTMLElement(_),$=getDocumentElement(_),B=y==="fixed",R=getBoundingClientRect(k,!0,B,_);let H={scrollLeft:0,scrollTop:0};const j=createCoords(0);if(w||!w&&!B)if((getNodeName(_)!=="body"||isOverflowElement($))&&(H=getNodeScroll(_)),w){const q=getBoundingClientRect(_,!0,B,_);j.x=q.x+_.clientLeft,j.y=q.y+_.clientTop}else $&&(j.x=getWindowScrollBarX($));return{x:R.left+H.scrollLeft-j.x,y:R.top+H.scrollTop-j.y,width:R.width,height:R.height}}function getTrueOffsetParent(k,_){return!isHTMLElement(k)||getComputedStyle$1(k).position==="fixed"?null:_?_(k):k.offsetParent}function getOffsetParent(k,_){const y=getWindow(k);if(!isHTMLElement(k))return y;let w=getTrueOffsetParent(k,_);for(;w&&isTableElement(w)&&getComputedStyle$1(w).position==="static";)w=getTrueOffsetParent(w,_);return w&&(getNodeName(w)==="html"||getNodeName(w)==="body"&&getComputedStyle$1(w).position==="static"&&!isContainingBlock(w))?y:w||getContainingBlock(k)||y}const getElementRects=async function(k){let{reference:_,floating:y,strategy:w}=k;const $=this.getOffsetParent||getOffsetParent,B=this.getDimensions;return{reference:getRectRelativeToOffsetParent(_,await $(y),w),floating:{x:0,y:0,...await B(y)}}};function isRTL(k){return getComputedStyle$1(k).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(k,_){let y=null,w;const $=getDocumentElement(k);function B(){clearTimeout(w),y&&y.disconnect(),y=null}function R(H,j){H===void 0&&(H=!1),j===void 0&&(j=1),B();const{left:q,top:X,width:ee,height:te}=k.getBoundingClientRect();if(H||_(),!ee||!te)return;const ne=floor(X),oe=floor($.clientWidth-(q+ee)),ie=floor($.clientHeight-(X+te)),ae=floor(q),se={rootMargin:-ne+"px "+-oe+"px "+-ie+"px "+-ae+"px",threshold:max(0,min(1,j))||1};let le=!0;function ue(he){const ce=he[0].intersectionRatio;if(ce!==j){if(!le)return R();ce?R(!1,ce):w=setTimeout(()=>{R(!1,1e-7)},100)}le=!1}try{y=new IntersectionObserver(ue,{...se,root:$.ownerDocument})}catch{y=new IntersectionObserver(ue,se)}y.observe(k)}return R(!0),B}function autoUpdate(k,_,y,w){w===void 0&&(w={});const{ancestorScroll:$=!0,ancestorResize:B=!0,elementResize:R=typeof ResizeObserver=="function",layoutShift:H=typeof IntersectionObserver=="function",animationFrame:j=!1}=w,q=unwrapElement(k),X=$||B?[...q?getOverflowAncestors(q):[],...getOverflowAncestors(_)]:[];X.forEach(re=>{$&&re.addEventListener("scroll",y,{passive:!0}),B&&re.addEventListener("resize",y)});const ee=q&&H?observeMove(q,y):null;let te=-1,ne=null;R&&(ne=new ResizeObserver(re=>{let[se]=re;se&&se.target===q&&ne&&(ne.unobserve(_),cancelAnimationFrame(te),te=requestAnimationFrame(()=>{ne&&ne.observe(_)})),y()}),q&&!j&&ne.observe(q),ne.observe(_));let oe,ie=j?getBoundingClientRect(k):null;j&&ae();function ae(){const re=getBoundingClientRect(k);ie&&(re.x!==ie.x||re.y!==ie.y||re.width!==ie.width||re.height!==ie.height)&&y(),ie=re,oe=requestAnimationFrame(ae)}return y(),()=>{X.forEach(re=>{$&&re.removeEventListener("scroll",y),B&&re.removeEventListener("resize",y)}),ee&&ee(),ne&&ne.disconnect(),ne=null,j&&cancelAnimationFrame(oe)}}const computePosition=(k,_,y)=>{const w=new Map,$={platform,...y},B={...$.platform,_c:w};return computePosition$1(k,_,{...$,platform:B})};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o$3=e$8(class extends i$8{constructor(k){var _;if(super(k),k.type!==t$3.ATTRIBUTE||k.name!=="class"||((_=k.strings)===null||_===void 0?void 0:_.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(k){return" "+Object.keys(k).filter(_=>k[_]).join(" ")+" "}update(k,[_]){var y,w;if(this.it===void 0){this.it=new Set,k.strings!==void 0&&(this.nt=new Set(k.strings.join(" ").split(/\s/).filter(B=>B!=="")));for(const B in _)_[B]&&!(!((y=this.nt)===null||y===void 0)&&y.has(B))&&this.it.add(B);return this.render(_)}const $=k.element.classList;this.it.forEach(B=>{B in _||($.remove(B),this.it.delete(B))});for(const B in _){const R=!!_[B];R===this.it.has(B)||!((w=this.nt)===null||w===void 0)&&w.has(B)||(R?($.add(B),this.it.add(B)):($.remove(B),this.it.delete(B)))}return T}}),regularizationNumberInRange=(k,_,y)=>(y=y-_,k=(k-_+y)%y,_+(Number.isNaN(k)?0:k));function humanFileSize(k,_=!0,y=1){const w=_?1e3:1024;if(Math.abs(k)<w)return k+" bytes";const $=_?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let B=-1;const R=10**y;do k/=w,++B;while(Math.round(Math.abs(k)*R)/R>=w&&B<$.length-1);return k.toFixed(y)+" "+$[B]}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const s=(k,_)=>{var y,w;const $=k._$AN;if($===void 0)return!1;for(const B of $)(w=(y=B)._$AO)===null||w===void 0||w.call(y,_,!1),s(B,_);return!0},o$2=k=>{let _,y;do{if((_=k._$AM)===void 0)break;y=_._$AN,y.delete(k),k=_}while(y?.size===0)},r=k=>{for(let _;_=k._$AM;k=_){let y=_._$AN;if(y===void 0)_._$AN=y=new Set;else if(y.has(k))break;y.add(k),l$1(_)}};function n$3(k){this._$AN!==void 0?(o$2(this),this._$AM=k,r(this)):this._$AM=k}function h$1(k,_=!1,y=0){const w=this._$AH,$=this._$AN;if($!==void 0&&$.size!==0)if(_)if(Array.isArray(w))for(let B=y;B<w.length;B++)s(w[B],!1),o$2(w[B]);else w!=null&&(s(w,!1),o$2(w));else s(this,k)}const l$1=k=>{var _,y,w,$;k.type==t$3.CHILD&&((_=(w=k)._$AP)!==null&&_!==void 0||(w._$AP=h$1),(y=($=k)._$AQ)!==null&&y!==void 0||($._$AQ=n$3))};class c extends i$8{constructor(){super(...arguments),this._$AN=void 0}_$AT(_,y,w){super._$AT(_,y,w),r(this),this.isConnected=_._$AU}_$AO(_,y=!0){var w,$;_!==this.isConnected&&(this.isConnected=_,_?(w=this.reconnected)===null||w===void 0||w.call(this):($=this.disconnected)===null||$===void 0||$.call(this)),y&&(s(this,_),o$2(this))}setValue(_){if(e$9(this._$Ct))this._$Ct._$AI(_,this);else{const y=[...this._$Ct._$AH];y[this._$Ci]=_,this._$Ct._$AI(y,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const e$1=()=>new o$1;let o$1=class{};const h=new WeakMap,n$2=e$8(class extends c{render(k){return A}update(k,[_]){var y;const w=_!==this.G;return w&&this.G!==void 0&&this.ot(void 0),(w||this.rt!==this.lt)&&(this.G=_,this.dt=(y=k.options)===null||y===void 0?void 0:y.host,this.ot(this.lt=k.element)),A}ot(k){var _;if(typeof this.G=="function"){const y=(_=this.dt)!==null&&_!==void 0?_:globalThis;let w=h.get(y);w===void 0&&(w=new WeakMap,h.set(y,w)),w.get(this.G)!==void 0&&this.G.call(this.dt,void 0),w.set(this.G,k),k!==void 0&&this.G.call(this.dt,k)}else this.G.value=k}get rt(){var k,_,y;return typeof this.G=="function"?(_=h.get((k=this.dt)!==null&&k!==void 0?k:globalThis))===null||_===void 0?void 0:_.get(this.G):(y=this.G)===null||y===void 0?void 0:y.value}disconnected(){this.rt===this.lt&&this.ot(void 0)}reconnected(){this.ot(this.lt)}});var __decorate$2v=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},MenuComponent_1;let MenuComponent=MenuComponent_1=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.inputRef=e$1(),this._inputText=_=>{const y=_.target;this.text=y.value},this.processMap={action:_=>[{label:x$1` ${_.icon?x$1` <div class="icon">${_.icon}</div>`:A}
            <div class="affine-menu-action-text">
              ${_.label??_.name}
            </div>`,select:()=>{_.select(),this._complete()},class:_.class??""}],group:_=>{const y=_.children().flatMap(w=>this.process(w));return y[0]&&(y[0].upDivider=!0),y[y.length-1]&&(y[y.length-1].downDivider=!0),y},"sub-menu":_=>{const y=()=>{this.subMenu?.remove(),setTimeout(()=>{const w=new MenuComponent_1,$=_.options;w.options={...$,onClose:()=>{$.onClose?.(),this.clearSubMenu()},onComplete:()=>{this._complete()}},this.append(w),computePosition(this,w,{middleware:[autoPlacement({allowedPlacements:["left-start","right-start"]})]}).then(({x:B,y:R})=>{Object.assign(w.style,{left:`${B}px`,top:`${R}px`})}),this.subMenu=w})};return[{label:x$1`${_.icon?x$1` <div class="icon">${_.icon}</div>`:A}
            <div class="affine-menu-action-text">
              ${_.label??_.name}
            </div>
            <div
              class=""
              style="display:flex;align-items:center;transform: rotate(-90deg)"
            >
              ${ArrowDownIcon}
            </div>`,mouseEnter:y,select:y,class:""}]}},this._complete=()=>{this.options.onComplete?.(),this.close()},this._clickContainer=_=>{_.stopPropagation(),this.focusInput()},this._mouseEnter=_=>{this._isConsciousChoice()||_!==this.selectedIndex&&(this.selectedIndex=_,this.clearSubMenu(),this.selectedItem?.mouseEnter?.())},this.initTime=0,this.mouseEnterHeader=()=>{this.isSearchMode||this._mouseEnter(-1)}}get minIndex(){return this.isSearchMode?0:-1}get selectedIndex(){return this._selectedIndex??this.minIndex}set selectedIndex(_){this._selectedIndex=regularizationNumberInRange(_??this.minIndex,this.minIndex,this.items.length)}get text(){return this._text??this.options.input?.initValue??""}set text(_){this._text=_}close(){this.options.onClose?.()}firstUpdated(){this.initTime=Date.now();const _=this.inputRef.value;if(_){this.focusInput();const y=_.value.length;_.setSelectionRange(y,y),this._disposables.addFromEvent(_,"keydown",w=>{if(w.stopPropagation(),w.key==="Escape"){this.close();return}if(w.key==="Enter"){const $=this.selectedItem;$?$.select():(this.options.input?.onComplete?.(this.text),this._complete());return}if(w.key==="ArrowUp"){w.preventDefault(),this.selectedIndex=this.selectedIndex-1;return}if(w.key==="ArrowDown"){w.preventDefault(),this.selectedIndex=this.selectedIndex+1;return}})}}show(_){return this.isSearchMode&&!_.name.toLowerCase().includes(this.text.toLowerCase())?!1:!_.hide?.()}process(_){return this.show(_)?this.processMap[_.type](_):[]}focusInput(){this.inputRef.value?.focus()}get selectedItem(){return this.items[this.selectedIndex]}_isConsciousChoice(){return Date.now()<this.initTime+100}clearSubMenu(){this.subMenu?.remove(),this.subMenu=void 0,this.focusInput()}render(){this.items=this.options.items.flatMap(w=>this.process(w)),this.selectedIndex=this._selectedIndex;const _=this.showHeader(),y=o$4({opacity:_?"1":"0",height:_?void 0:"0",overflow:_?void 0:"hidden"});return x$1`
      <div class="affine-menu" @click="${this._clickContainer}">
        ${this.options.input?x$1` <div
                class="affine-menu-header"
                style=${y}
                @mouseenter="${this.mouseEnterHeader}"
              >
                <input
                  ${n$2(this.inputRef)}
                  type="text"
                  placeholder="${this.options.input?.placeholder??""}"
                  value="${this.text??this.options.input?.initValue??""}"
                  @input="${this._inputText}"
                />
              </div>
              ${this.items.length&&_?x$1` <div class="affine-menu-divider"></div>`:null}`:null}
        <div class="affine-menu-body">
          ${this.items.length===0&&this.isSearchMode?x$1` <div class="no-results">No Results</div>`:""}
          ${c$1(this.items,(w,$)=>{const B=w.upDivider||this.items[$-1]?.downDivider,R=()=>{this._mouseEnter($)},H=w.class??"",j=o$3({"affine-menu-action":!0,selected:this._selectedIndex===$,[H]:!0});return x$1`
              ${B?x$1` <div class="affine-menu-divider"></div>`:null}
              <div
                class="${j}"
                @click="${w.select}"
                @mouseenter="${R}"
              >
                <div class="content">${w.label}</div>
              </div>
            `})}
        </div>
      </div>
    `}showHeader(){return!this.isSearchMode||!!this.text}get isSearchMode(){return this.options.input?.search}};MenuComponent.styles=i$5`
    affine-menu {
      display: flex;
      flex-direction: column;
      user-select: none;
      min-width: 200px;
      box-shadow: 0px 0px 12px 0px rgba(66, 65, 73, 0.14),
        0px 0px 0px 0.5px #e3e3e4 inset;
      border-radius: 8px;
      background-color: var(--affine-background-primary-color);
      padding: 8px;
      position: absolute;
      z-index: 999;
    }

    .affine-menu-header {
    }

    .affine-menu-body {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .affine-menu-header input {
      width: 100%;
      border-radius: 4px;
      outline: none;
      font-size: 14px;
      line-height: 22px;
      padding: 5px 12px;
      border: 1px solid var(--affine-border-color);
    }

    .affine-menu-header input::placeholder {
      color: var(--affine-placeholder-color);
    }

    .affine-menu-header input:focus {
      border: 1px solid var(--affine-primary-color);
    }

    .affine-menu-divider {
      height: 0.5px;
      background: var(--affine-divider-color);
      margin: 7px 0;
    }

    .affine-menu-action {
      padding: 4px 12px;
      cursor: pointer;
      display: flex;
      gap: 4px;
      border-radius: 4px;
    }

    .affine-menu-action svg {
      width: 20px;
      height: 20px;
      color: var(--affine-icon-color);
      fill: var(--affine-icon-color);
    }

    .affine-menu-action .icon {
      margin-right: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .affine-menu-action .content {
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
      justify-content: space-between;
      display: flex;
      align-items: center;
      font-size: 14px;
      line-height: 22px;
      flex: 1;
    }

    .affine-menu-action.selected {
      background-color: var(--affine-hover-color);
    }

    .affine-menu-action.selected.delete-item {
      background-color: var(--affine-background-error-color);
      color: var(--affine-error-color);
    }

    .affine-menu-action.selected.delete-item .icon > svg {
      fill: var(--affine-error-color);
    }

    .database-menu-component-action-button:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .no-results {
      font-size: 12px;
      line-height: 20px;
      color: var(--affine-text-secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 8px;
    }

    .affine-menu-action-text {
      flex: 1;
      padding: 0 4px;
    }
  `;__decorate$2v([n$a({attribute:!1})],MenuComponent.prototype,"options",void 0);__decorate$2v([t$2()],MenuComponent.prototype,"_text",void 0);__decorate$2v([t$2()],MenuComponent.prototype,"_selectedIndex",void 0);MenuComponent=MenuComponent_1=__decorate$2v([e$7("affine-menu")],MenuComponent);const createModal=()=>{const k=document.createElement("div");return k.style.position="fixed",k.style.left="0",k.style.top="0",k.style.width="100vw",k.style.height="100vh",k.style.zIndex="1001",document.body.querySelector("block-suite-root")?.append(k),k},positionToVRect=(k,_)=>({getBoundingClientRect(){return{x:k,y:_,width:0,height:0,top:_,bottom:_,left:k,right:k}}}),createPopup=(k,_,y)=>{const w=createModal();return w.append(_),computePosition(k,_,{middleware:y?.middleware??[autoPlacement({allowedPlacements:["left-start","right-start","top-start","bottom-start"]})]}).then(({x:$,y:B})=>{Object.assign(_.style,{left:`${$}px`,top:`${B}px`})}),w.onclick=$=>{$.target===w&&(w.remove(),y?.onClose?.())},w.oncontextmenu=$=>{$.preventDefault(),$.target===w&&(w.remove(),y?.onClose?.())},()=>{w.remove()}},popMenu=(k,_)=>{const y=new MenuComponent;y.options={..._.options,onClose:()=>{_.options.onClose?.(),w()}};const w=createPopup(k,y,{onClose:_.options.onClose,middleware:_.middleware})},popFilterableSimpleMenu=(k,_,y)=>{popMenu(k,{options:{input:{placeholder:"Search",search:!0},items:_,onClose:y}})},selectOptionColors=[{color:"var(--affine-tag-red)",name:"Red"},{color:"var(--affine-tag-pink)",name:"Pink"},{color:"var(--affine-tag-orange)",name:"Orange"},{color:"var(--affine-tag-yellow)",name:"Yellow"},{color:"var(--affine-tag-green)",name:"Green"},{color:"var(--affine-tag-teal)",name:"Teal"},{color:"var(--affine-tag-blue)",name:"Blue"},{color:"var(--affine-tag-purple)",name:"Purple"},{color:"var(--affine-tag-gray)",name:"Gray"},{color:"var(--affine-tag-white)",name:"White"}],selectTagColorPoll=selectOptionColors.map(k=>k.color);function tagColorHelper(){let k=[...selectTagColorPoll];return()=>{k.length===0&&(k=[...selectTagColorPoll]);const _=Math.floor(Math.random()*k.length);return k.splice(_,1)[0]}}const getTagColor=tagColorHelper(),styles$p=i$5`
  affine-multi-tag-select {
    position: absolute;
    width: 100%;
    z-index: 2;
    border: 1px solid var(--affine-border-color);
    border-radius: 8px;
    background: var(--affine-background-primary-color);
    box-shadow: var(--affine-shadow-2);
  }

  .affine-select-cell-select {
    font-size: var(--affine-font-sm);
  }

  @media print {
    .affine-select-cell-select {
      display: none;
    }
  }

  .select-input-container {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 6px;
    min-height: 44px;
    padding: 10px 8px;
    background: var(--affine-hover-color);
    border-radius: 8px;
  }

  .select-input {
    flex: 1 1 0;
    height: 24px;
    border: none;
    font-family: var(--affine-font-family);
    color: inherit;
    background: transparent;
    line-height: 24px;
  }

  .select-input:focus {
    outline: none;
  }

  .select-input::placeholder {
    color: var(--affine-placeholder-color);
  }

  .select-option-container {
    padding: 8px;
    color: var(--affine-black-90);
    fill: var(--affine-black-90);
    max-height: 400px;
    overflow-y: auto;
  }

  .select-option-container-header {
    padding: 0px 4px 8px 4px;
    color: var(--affine-black-60);
    font-size: 12px;
    user-select: none;
  }

  .select-input-container .select-selected {
    display: flex;
    align-items: center;
    padding: 2px 10px;
    gap: 10px;
    height: 28px;
    background: var(--affine-tag-white);
    border-radius: 4px;
    color: var(--affine-black-90);
    background: var(--affine-tertiary-color);
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .select-selected-text {
    width: calc(100% - 16px);
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .select-selected > .close-icon {
    display: flex;
    align-items: center;
  }

  .select-selected > .close-icon:hover {
    cursor: pointer;
  }

  .select-selected > .close-icon > svg {
    fill: var(--affine-black-90);
  }

  .select-option-new {
    display: flex;
    flex-direction: row;
    align-items: center;
    height: 36px;
    padding: 4px;
    gap: 5px;
    border-radius: 4px;
    background: var(--affine-selected-color);
  }

  .select-option-new-text {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    height: 28px;
    padding: 2px 10px;
    border-radius: 4px;
    background: var(--affine-tag-red);
  }

  .select-option-new-icon {
    display: flex;
    align-items: center;
    gap: 6px;
    height: 28px;
    color: var(--affine-text-primary-color);
    margin-right: 8px;
  }

  .select-option-new-icon svg {
    width: 16px;
    height: 16px;
  }

  .select-option {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px;
    border-radius: 4px;
    margin-bottom: 4px;
    cursor: pointer;
  }

  .select-option.selected {
    background: var(--affine-hover-color);
  }

  .select-option-text-container {
    width: 100%;
    overflow: hidden;
    display: flex;
  }

  .select-option-group-name {
    font-size: 9px;
    padding: 0 2px;
    border-radius: 2px;
  }

  .select-option-name {
    padding: 4px 8px;
    border-radius: 4px;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  .select-option-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 28px;
    height: 28px;
    border-radius: 3px;
    cursor: pointer;
    opacity: 0;
  }

  .select-option.selected .select-option-icon {
    opacity: 1;
  }

  .select-option-icon:hover {
    background: var(--affine-hover-color);
  }

  .select-option-icon svg {
    width: 16px;
    height: 16px;
    pointer-events: none;
  }
`;var __decorate$2u=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let MultiTagSelect=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.mode="multi",this.options=[],this.filteredOptions=[],this.value=[],this.newTags=_=>{this.onOptionsChange([..._,...this.options])},this.deleteTag=_=>{this.onOptionsChange(this.options.filter(y=>y.id!==_).map(y=>({...y,parentId:y.parentId===_?void 0:y.parentId})))},this.changeTag=_=>{this.onOptionsChange(this.options.map(y=>y.id===_.id?_:y))},this.text="",this.selectedIndex=0,this._currentColor=void 0,this._onDeleteSelected=(_,y)=>{const w=_.filter($=>$!==y);this.onChange(w)},this._onInput=_=>{this.text=_.target.value},this._onInputKeydown=_=>{_.stopPropagation();const y=this.text.trim();if(_.key==="Backspace"&&y==="")this._onDeleteSelected(this.value,this.value[this.value.length-1]);else if(_.key==="Enter"&&!_.isComposing)this.selectedTag?.select();else if(_.key==="ArrowUp")_.preventDefault(),this.setSelectedOption(this.selectedIndex-1);else if(_.key==="ArrowDown")_.preventDefault(),this.setSelectedOption(this.selectedIndex+1);else if(_.key==="Escape")this.editComplete();else if(_.key==="Tab"){_.preventDefault();const w=this.selectedTag;w&&(this.text=this.getTagFullName(w,w.group))}},this._onSelect=_=>{if(this.value.findIndex($=>$===_)>-1)return;if(!(this.value.indexOf(_)>-1)){const $=this.isSingleMode?[_]:[...this.value,_];this.onChange($),this.isSingleMode&&setTimeout(()=>{this.editComplete()},4)}},this._createOption=()=>{const _=this.text.trim();if(_==="")return;const y=this.getGroupInfoByFullName(_);if(!y)return;const w=y.name,$=this.color;this.clearColor();const B={id:nanoid(),value:w,color:$,parentId:y.parent?.id};this.newTags([B]);const R=this.isSingleMode?[B.id]:[...this.value,B.id];this.onChange(R),this.text="",this.isSingleMode&&this.editComplete()},this._clickItemOption=(_,y)=>{_.stopPropagation();const w=this.options.find($=>$.id===y);w&&popMenu(_.target,{options:{input:{initValue:w.value,onComplete:$=>{this.changeTag({...w,value:$})}},items:[{type:"action",name:"Delete",select:()=>{this.deleteTag(y)}},{type:"group",name:"color",children:()=>selectOptionColors.map($=>{const B=o$4({backgroundColor:$.color,borderRadius:"50%",width:"20px",height:"20px",marginRight:"8px"});return{type:"action",name:$.name,icon:n$5` <div style=${B}></div>`,select:()=>{this.changeTag({...w,color:$.color})}}})}]},middleware:[autoPlacement()]})}}get color(){return this._currentColor||(this._currentColor=getTagColor()),this._currentColor}clearColor(){this._currentColor=void 0}get isSingleMode(){return this.mode==="single"}firstUpdated(){this._selectInput.focus(),this._disposables.addFromEvent(this,"click",()=>{this._selectInput.focus()})}get selectedTag(){return this.filteredOptions[this.selectedIndex]}optionsIdMap(){return Object.fromEntries(this.options.map(_=>[_.id,_]))}getTagGroup(_,y=this.optionsIdMap()){const w=[];let $=_.parentId;for(;$;){const B=y[$];w.unshift(B),$=B.parentId}return w}setSelectedOption(_){this.selectedIndex=regularizationNumberInRange(_,0,this.filteredOptions.length)}getTagFullName(_,y){return[...y,_].map(w=>w.value).join("/")}getGroupInfoByFullName(_){const y=_.split("/"),w=y.slice(0,-1),$=[];for(const B of w){const R=$[$.length-1],H=this.options.find(j=>j.parentId===R?.id&&j.value===B);if(!H)return;$.push(H)}return{name:y[y.length-1],group:$,parent:$[$.length-1]}}_filterOptions(){const _=this.optionsIdMap();let y=!1;const w=this.options.map($=>({...$,group:this.getTagGroup($,_)})).filter($=>this.text?this.getTagFullName($,$.group).toLocaleLowerCase().includes(this.text.toLocaleLowerCase()):!0).map($=>(this.getTagFullName($,$.group)===this.text&&(y=!0),{...$,isCreate:!1,select:()=>this._onSelect($.id)}));return this.text&&!y&&w.push({id:"create",color:this.color,value:this.text,isCreate:!0,group:[],select:this._createOption}),w}render(){this.filteredOptions=this._filterOptions(),this.setSelectedOption(this.selectedIndex);const _=this.value,y=new Map(this.options.map(w=>[w.id,w]));return n$5`
      <div class="affine-select-cell-select">
        <div class="select-input-container">
          ${_.map(w=>{const $=y.get(w);if(!$)return;const B=o$4({backgroundColor:$.color});return n$5` <div class="select-selected" style=${B}>
              <div class="select-selected-text">${$.value}</div>
              <span
                class="close-icon"
                @click="${()=>this._onDeleteSelected(_,w)}"
                >${DatabaseSearchClose}</span
              >
            </div>`})}
          <input
            class="select-input"
            placeholder="Type here..."
            .value="${this.text}"
            @input="${this._onInput}"
            @keydown="${this._onInputKeydown}"
          />
        </div>
        <div class="select-option-container">
          <div class="select-option-container-header">
            Select tag or create one
          </div>
          ${c$1(this.filteredOptions,w=>w.id,(w,$)=>{const B=$===this.selectedIndex,R=()=>{this.setSelectedOption($)},H=o$3({"select-option":!0,selected:B}),j=o$4({backgroundColor:w.color}),q=X=>this._clickItemOption(X,w.id);return n$5`
                <div class="${H}" @mouseenter="${R}">
                  <div
                    class="select-option-text-container"
                    @click="${w.select}"
                  >
                    ${w.isCreate?n$5` <div class="select-option-new-icon">
                          Create ${PlusIcon}
                        </div>`:""}
                    <div style="display:flex;flex-direction: column">
                      <div
                        style="display:flex;align-items:center;margin-bottom: 2px;opacity: 0.5;"
                      >
                        ${w.group.map((X,ee)=>{const te=o$4({backgroundColor:X.color});return n$5`${ee===0?"":n$5`<span style="margin: 0 1px">/</span>`}<span
                              class="select-option-group-name"
                              style=${te}
                              >${X.value}</span
                            >`})}
                      </div>
                      <div style="display:flex;">
                        <div style=${j} class="select-option-name">
                          ${w.value}
                        </div>
                      </div>
                    </div>
                  </div>
                  ${w.isCreate?null:n$5` <div
                        class="select-option-icon"
                        @click="${q}"
                      >
                        ${MoreHorizontalIcon}
                      </div>`}
                </div>
              `})}
        </div>
      </div>
    `}};MultiTagSelect.styles=styles$p;__decorate$2u([n$a()],MultiTagSelect.prototype,"mode",void 0);__decorate$2u([n$a({attribute:!1})],MultiTagSelect.prototype,"options",void 0);__decorate$2u([n$a({attribute:!1})],MultiTagSelect.prototype,"onOptionsChange",void 0);__decorate$2u([n$a({attribute:!1})],MultiTagSelect.prototype,"value",void 0);__decorate$2u([n$a({attribute:!1})],MultiTagSelect.prototype,"onChange",void 0);__decorate$2u([n$a({attribute:!1})],MultiTagSelect.prototype,"editComplete",void 0);__decorate$2u([i$6(".select-input")],MultiTagSelect.prototype,"_selectInput",void 0);__decorate$2u([t$2()],MultiTagSelect.prototype,"text",void 0);__decorate$2u([t$2()],MultiTagSelect.prototype,"selectedIndex",void 0);MultiTagSelect=__decorate$2u([e$7("affine-multi-tag-select")],MultiTagSelect);const popTagSelect=(k,_)=>{const y=new MultiTagSelect;_.mode&&(y.mode=_.mode),y.style.width=`${Math.max(_.minWidth??k.offsetWidth,k.offsetWidth)}px`,y.value=_.value,y.onChange=$=>{_.onChange($),y.value=$},y.options=_.options,y.onOptionsChange=$=>{_.onOptionsChange($),y.options=$},y.editComplete=()=>{_.onComplete?.(),w()};const w=createPopup(k,y,{onClose:_.onComplete,middleware:[offset$1($=>({mainAxis:-$.rects.reference.height,crossAxis:$.rects.floating.width/2-$.rects.reference.width/2}))]});return w};var __decorate$2t=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let MultiTagView=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.value=[],this.options=[]}render(){const _=this.value,y=new Map(this.options?.map(w=>[w.id,w]));return n$5`
      <div class="affine-select-cell-container">
        ${c$1(_,w=>{const $=y.get(w);if(!$)return;const B=o$4({backgroundColor:$.color});return n$5`<span class="select-selected" style=${B}
            >${$.value}</span
          >`})}
      </div>
    `}};MultiTagView.styles=i$5`
    affine-multi-tag-view {
      display: flex;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    .affine-select-cell-container * {
      box-sizing: border-box;
    }

    .affine-select-cell-container {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
      width: 100%;
      font-size: var(--affine-font-sm);
    }

    .affine-select-cell-container .select-selected {
      height: 22px;
      font-size: 14px;
      line-height: 22px;
      padding: 0 8px;
      border-radius: 4px;
      white-space: nowrap;
      background: var(--affine-tag-white);
      overflow: hidden;
      text-overflow: ellipsis;
    }
  `;__decorate$2t([i$6(".affine-select-cell-container")],MultiTagView.prototype,"selectContainer",void 0);__decorate$2t([n$a({attribute:!1})],MultiTagView.prototype,"value",void 0);__decorate$2t([n$a({attribute:!1})],MultiTagView.prototype,"options",void 0);MultiTagView=__decorate$2t([e$7("affine-multi-tag-view")],MultiTagView);var __decorate$2s=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let PageMetaData=class extends WithDisposable(s$2){constructor(){super(...arguments),this.showSelect=!1,this._selectTags=()=>{this._disposables.add({dispose:popTagSelect(this.shadowRoot?.querySelector(".tags")??this,{value:this.tags,onChange:_=>this.tags=_,options:this.options,onOptionsChange:_=>this.options=_})})},this.renderBacklinkInline=()=>x$1`
      <backlink-button
        @click="${y=>{y.stopPropagation()}}"
        .backlinks="${this.backlinkList}"
      ></backlink-button>
    `,this.renderTagsInline=()=>{const _=this.tags,y=Object.fromEntries(this.options.map(w=>[w.id,w]));return x$1` <div class="tags-inline">
      ${TagsIcon}
      ${_.length>0?x$1` <div class="tag-list">
            ${c$1(_.slice(0,3),w=>w,(w,$)=>{const B=y[w];return B?x$1` <div>${$!==0?x$1`,&nbsp;`:""}</div>
                  <div class="tag-inline">${B.value}</div>`:null})}
            ${_.length>3?x$1`, and ${_.length-3} more`:""}
          </div>`:"Tags"}
    </div>`},this.expanded=!1,this._toggle=()=>{this.expanded=!this.expanded},this.renderBacklinkExpanded=()=>{const _=this.backlinkList;return _.length?x$1`<div class="meta-data-expanded-column-item">
      <div class="backlink-title">
        ${DualLinkIcon16}
        <span class="title">Linked to this page</span>
      </div>
      <div class="backlinks">
        ${c$1(_,w=>w.pageId,w=>x$1` <div @click=${w.jump} class="link">
        ${w.icon}
        <div class="link-title">${w.title||DEFAULT_PAGE_NAME$2}</div>
      </div>`)}
      </div>
    </div>`:null},this.renderTagsExpanded=()=>{const _=Object.fromEntries(this.options.map(y=>[y.id,y]));return x$1` <div class="meta-data-expanded-item">
      <div class="type">${TagsIcon}</div>
      <div class="value">
        <div class="tags">
          ${c$1(this.tags,y=>y,y=>{const w=_[y];if(!w)return null;const $=o$4({backgroundColor:w.color});return x$1` <div class="tag" @click=${()=>{this.pageElement.slots.tagClicked.emit({tagId:w.id})}} style=${$}>
                ${w.value}
              </div>`})}
          ${this.page.readonly?A:x$1`<div class="add-tag" @click="${this._selectTags}">
                ${PlusIcon}
              </div>`}
        </div>
      </div>
    </div>`}}get meta(){return this.page.workspace.meta}get options(){return this.meta.properties.tags?.options??[]}set options(_){this.tags=this.tags.filter(y=>_.find(w=>w.id===y)),this.page.workspace.meta.setProperties({...this.meta.properties,tags:{...this.meta.properties.tags,options:_}})}get tags(){return this.page.meta.tags??[]}set tags(_){this.page.meta.tags=_}connectedCallback(){super.connectedCallback(),this._disposables.add(listenBacklinkList(this.pageElement,_=>{this.backlinkList=_})),this._disposables.add(this.meta.pageMetasUpdated.on(()=>{this.requestUpdate()}))}render(){return this.expanded?x$1` <div class="meta-data-expanded">
      <div class="meta-data-expanded-title" @click="${this._toggle}">
        <div>Page info</div>
        <div class="close">${ArrowDownSmallIcon}</div>
      </div>
      <div class="meta-data-expanded-content">
        ${this.renderBacklinkExpanded()} ${this.renderTagsExpanded()}
      </div>
    </div>`:x$1`
        <div class="meta-data" @click="${this._toggle}">
          <div class="meta-data-content">
            ${this.renderBacklinkInline()} ${this.renderTagsInline()}
          </div>
          <div class="expand">${ArrowDownSmallIcon}</div>
        </div>
      `}};PageMetaData.styles=i$5`
    .meta-data {
      border-radius: 8px;
      display: flex;
      align-items: center;
      height: 30px;
      cursor: pointer;
      justify-content: space-between;
      margin: 0 -12px;
    }

    .meta-data-content {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--affine-text-secondary-color);
    }

    .meta-data:hover {
      background-color: var(--affine-hover-color);
    }

    .tags-inline {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 14px;
    }

    .tags-inline .tag-list {
      display: flex;
      align-items: center;
    }

    .tag-inline {
      max-width: 100px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .expand {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
    }

    .meta-data-expanded {
      padding: 10px 12px 24px;
      margin: 0 -24px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: var(--affine-hover-color-filled);
      border-radius: 8px;
    }

    .meta-data-expanded-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 12px;
      font-weight: 600;
      font-size: 14px;
      color: var(--affine-text-secondary-color);
      border-radius: 4px;
      cursor: pointer;
    }

    .meta-data-expanded-title:hover {
      background-color: var(--affine-hover-color);
    }

    .meta-data-expanded-title .close {
      transform: rotate(180deg);
      border-radius: 4px;
      display: flex;
      align-items: center;
    }

    @media print {
      .meta-data-expanded-title .close {
        display: none;
      }

      .expand {
        display: none;
      }
    }

    .meta-data-expanded-title .close:hover {
      background-color: var(--affine-hover-color);
    }

    .meta-data-expanded-content {
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding: 0 12px;
    }

    .meta-data-expanded-column-item {
      display: flex;
      flex-direction: column;
    }

    .meta-data-expanded-column-item .backlink-title {
      display: flex;
      align-items: center;
      gap: 8px;
      fill: var(--affine-icon-color);
    }

    .meta-data-expanded-column-item .backlinks {
      margin-left: 24px;
    }

    .meta-data-expanded-item {
      display: flex;
      gap: 8px;
    }

    .meta-data-expanded-item .value {
      flex: 1;
    }

    .add-tag {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .add-tag svg {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      fill: var(--affine-icon-color);
    }

    .add-tag:hover svg {
      background-color: var(--affine-hover-color);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag {
      padding: 4px 10px;
      border-radius: 8px;
      color: var(--affine-text-primary-color);
      font-size: 13px;
      line-height: 13px;
      display: flex;
      align-items: center;
      font-weight: 400;
      cursor: pointer;
    }

    .backlinks {
      display: flex;
      gap: 8px;
      flex-direction: column;
    }

    .backlinks .title {
      height: 28px;
      color: var(--affine-text-secondary-color);
      font-size: var(--affine-font-sm);
    }

    .backlinks .link {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 15px;
      cursor: pointer;
      width: max-content;
      border-radius: 4px;
      padding: 0 8px 0 4px;
      margin: 0 -8px 0 -4px;
    }

    .backlinks .link:hover {
      background-color: var(--affine-hover-color);
    }

    .backlinks .link svg {
      fill: var(--affine-icon-color);
    }

    .link-title {
      border-bottom: 0.5px solid var(--affine-divider-color);
    }

    .backlinks .link:hover .link-title {
      border-bottom-color: transparent;
    }
  `;__decorate$2s([n$a({attribute:!1})],PageMetaData.prototype,"page",void 0);__decorate$2s([n$a({attribute:!1})],PageMetaData.prototype,"pageElement",void 0);__decorate$2s([t$2()],PageMetaData.prototype,"backlinkList",void 0);__decorate$2s([t$2()],PageMetaData.prototype,"showSelect",void 0);__decorate$2s([t$2()],PageMetaData.prototype,"expanded",void 0);PageMetaData=__decorate$2s([e$7("affine-page-meta-data")],PageMetaData);async function asyncSetVRange(k,_){const y=await asyncGetRichTextByModel(k);if(!y)return;await y.updateComplete;const w=y.vEditor;return assertExists(w),w.setVRange(_),new Promise($=>{w.slots.rangeUpdated.once(()=>{$()})})}function asyncFocusRichText(k,_,y={index:0,length:0}){const w=k.getBlockById(_);if(assertExists(w),!matchFlavours(w,["affine:divider"]))return asyncSetVRange(w,y)}function convertToList(k,_,y,w,$){if(matchFlavours(_,["affine:list"]))return!1;if(matchFlavours(_,["affine:paragraph"])){const B=k.getParent(_);if(!B)return!1;const R=B.children.indexOf(_);_.text?.insert(" ",w.length),k.captureSync(),_.text?.delete(0,w.length+1);const H={type:y,text:_.text?.clone(),children:_.children,...$};k.deleteBlock(_);const j=k.addBlock("affine:list",H,B,R);asyncFocusRichText(k,j)}return!0}function convertToParagraph(k,_,y,w){if(matchFlavours(_,["affine:paragraph"])&&_.type===y)return!1;if(matchFlavours(_,["affine:paragraph"])){if(matchFlavours(_,["affine:paragraph"])&&_.type!==y){_.text?.insert(" ",w.length),k.captureSync(),_.text?.delete(0,w.length+1);const $=getVirgoByModel(_);$&&$.setVRange({index:0,length:0}),k.updateBlock(_,{type:y})}}else{const $=k.getParent(_);if(!$)return!1;const B=$.children.indexOf(_);_.text?.insert(" ",w.length),k.captureSync(),_.text?.delete(0,w.length+1);const R={type:y,text:_.text?.clone(),children:_.children};k.deleteBlock(_);const H=k.addBlock("affine:paragraph",R,$,B);asyncFocusRichText(k,H)}return!0}function convertToDivider(k,_,y){if(matchFlavours(_,["affine:divider"])||_.type==="quote")return!1;if(!matchFlavours(_,["affine:divider"])){const w=k.getParent(_);if(!w)return!1;const $=w.children.indexOf(_);_.text?.insert(" ",y.length),k.captureSync(),_.text?.delete(0,y.length+1);const B={children:_.children};k.addBlock("affine:divider",B,w,$);const R=w.children[$+1];if(R)asyncFocusRichText(k,R.id);else{const H=k.addBlock("affine:paragraph",{},w);asyncFocusRichText(k,H)}}return!0}async function createPage(k,_={}){const y=k.createPage({id:_.id});await y.waitForLoaded();const w=y.addBlock("affine:page",{title:new y.Text(_.title??"")});y.addBlock("affine:surface",{},w);const $=y.addBlock("affine:note",{},w);return y.addBlock("affine:paragraph",{},$),y.resetHistory(),y}function calcDropTarget(k,_,y,w,$,B=null){const R=_.page.getSchemaByFlavour("affine:database");assertExists(R);const H=R.model.children??[];let j=!0;if(H.length&&(w.length?j=w.map(getModelByBlockElement).every(se=>H.includes(se.flavour)):B&&(j=H.includes(B))),!j&&!matchFlavours(_,["affine:database"])){const se=y.closest("affine-database");se&&(y=se,_=getModelByBlockElement(y))}let q="none";const X=3*$,{rect:ee,flag:te}=getDropRectByPoint(k,_,y);if(te===DropFlags.EmptyDatabase){const se=Rect.fromDOMRect(ee);return se.top-=X/2,se.height=X,q="database",{type:q,rect:se,modelState:{model:_,rect:ee,element:y}}}else if(te===DropFlags.Database){const se=Math.abs(ee.top-k.y),le=Math.abs(ee.bottom-k.y),ue=se<le;return q=ue?"before":"after",{type:q,rect:Rect.fromLWTH(ee.left,ee.width,(ue?ee.top-1:ee.bottom)-X/2,X),modelState:{model:_,rect:ee,element:y}}}const ne=Math.abs(ee.top-k.y),oe=Math.abs(ee.bottom-k.y);q=ne<oe?"before":"after";let ae=4;if(q==="before"){let se,le;se=y.previousElementSibling,se?se===w[w.length-1]?q="none":le=getRectByBlockElement(se):(se=y.parentElement?.previousElementSibling,se&&(le=se.getBoundingClientRect())),le&&(ae=(ee.top-le.bottom)/2)}else{let se,le;se=y.nextElementSibling,se?se===w[0]&&(q="none",se=null):se=getClosestBlockElementByElement(y.parentElement)?.nextElementSibling,se&&(le=getRectByBlockElement(se),ae=(le.top-ee.bottom)/2)}if(q==="none")return null;let re=ee.top;return q==="before"?re-=ae:re+=ee.height+ae,{type:q,rect:Rect.fromLWTH(ee.left,ee.width,re-X/2,X),modelState:{model:_,rect:ee,element:y}}}function isPinchEvent(k){return IS_IOS||IS_MAC?k.ctrlKey||k.metaKey:k.ctrlKey}var MOUSE_BUTTONS;(function(k){k[k.NO_BUTTON=0]="NO_BUTTON",k[k.PRIMARY=1]="PRIMARY",k[k.SECONDARY=2]="SECONDARY",k[k.AUXILIARY=4]="AUXILIARY",k[k.FORTH=8]="FORTH",k[k.FIFTH=16]="FIFTH"})(MOUSE_BUTTONS||(MOUSE_BUTTONS={}));function isMiddleButtonPressed(k){return(MOUSE_BUTTONS.AUXILIARY&k.buttons)===MOUSE_BUTTONS.AUXILIARY}function stopPropagation(k){k.stopPropagation()}const FileTypes=[{description:"Images",accept:{"image/*":[".avif",".gif",".jpeg",".jpg",".png",".tif",".tiff",".webp"]}},{description:"Videos",accept:{"video/*":[".avi",".mp4",".mpeg",".ogg",".webm",".3gp",".3g2"]}},{description:"Audios",accept:{"audio/*":[".aac",".mid",".midi",".mp3",".oga",".opus",".wav",".weba",".3gp",".3g2"]}},{description:"Markdown",accept:{"text/markdown":[".md",".markdwon"]}},{description:"Html",accept:{"text/html":[".html",".htm"]}},{description:"Zip",accept:{"application/zip":[".zip"]}}];async function openFileOrFiles({acceptType:k="Any",multiple:_=!1}={}){if("showOpenFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})()&&window.showOpenFilePicker)try{const w=FileTypes.find(R=>R.description===k);if(k!=="Any"&&!w)throw new Error(`Unexpected acceptType "${k}"`);const $={types:w?[w]:void 0,multiple:_},B=await window.showOpenFilePicker($);return _?await Promise.all(B.map(async H=>await H.getFile())):await B[0].getFile()}catch(w){if(!(w instanceof Error)||w.name!=="AbortError")throw w;return null}return new Promise(w=>{const $=document.createElement("input");$.classList.add("affine-upload-input"),$.style.display="none",$.type="file",_&&($.multiple=!0),k!=="Any"&&($.accept=Object.keys(FileTypes.find(B=>B.description===k)?.accept??"").join(",")),document.body.append($),$.addEventListener("change",()=>{if($.remove(),!$.files){w(null);return}if(_){w(Array.from($.files));return}w($.files[0])}),"showPicker"in HTMLInputElement.prototype?$.showPicker():$.click()})}const uploadImageFromLocal=async k=>{const _=await openFileOrFiles({acceptType:"Images",multiple:!0});if(!_)return[];const y=[];for(let w=0;w<_.length;w++){const $=_[w],B=await k.set($);y.push({file:$,sourceId:B})}return y};function downloadBlob(k,_){const y=URL.createObjectURL(k),w=document.createElement("a"),$=new MouseEvent("click");w.download=_,w.href=y,w.dispatchEvent($),w.remove(),URL.revokeObjectURL(y)}function getIndexesWith(k,_){return k.map(y=>_.findIndex(w=>w===y))}function generateRanges(k){let _,y=1,w=k[0],$=k[0];const B=[{start:w,end:$}],R=k.length;for(;y<R;y++)_=k[y],_-$===1?B[B.length-1].end=$=_:(w=$=_,B.push({start:w,end:$}));return B}function bringForward(k,_){let y=k.length;for(;y;){y--;const{start:w,end:$}=k[y],B=_.splice(w,$+1-w);_.splice(w+1,0,...B)}}function sendBackward(k,_){let y=0;const w=k.length;for(;y<w;y++){const{start:$,end:B}=k[y];if($===0)continue;const R=_.splice($,B+1-$);_.splice($-1,0,...R)}}function reorderTo(k,_,y,w,$){if(!k.length)return;k.sort(_);const{start:B,end:R}=y(k),H=w(B,R,k.length);$(H,k)}function reorder(k,_,y,w,$,B,R){if(!k.length)return;k.sort(_);const H=y().sort(_),{start:j,end:q}=w(H),X=getIndexesWith(k,H),ee=generateRanges(X);$(ee,H);const te=B(j,q,H.length);R(te,H)}function isTopLevelBlock(k){return!!k&&"flavour"in k}function isPhasorElement(k){return!isTopLevelBlock(k)}function isPhasorElementWithText(k){return k instanceof TextElement||k instanceof ShapeElement}function isPointIn(k,_,y){const[w,$,B,R]=deserializeXYWH(k.xywh);return isPointIn$1({x:w,y:$,w:B,h:R},_,y)}function pickTopBlock(k,_,y){for(let w=k.length-1;w>=0;w--){const $=k[w];if(isPointIn($,_,y))return $}return null}function pickBlocksByBound(k,_){return k.filter(y=>{const[w,$,B,R]=deserializeXYWH(y.xywh),H={x:w,y:$,w:B,h:R};return contains$1(_,H)||intersects(_,H)})}function getSelectionBoxBound(k,_){const[y,w,$,B]=deserializeXYWH(_),[R,H]=k.toViewCoord(y,w);return new DOMRect(R,H,$*k.zoom,B*k.zoom)}function getXYWH(k){return isTopLevelBlock(k)?k.xywh:serializeXYWH(k.x,k.y,k.w,k.h)}function getCursorMode(k){switch(k.type){case"default":return"default";case"pan":return k.panning?"grabbing":"grab";case"brush":case"eraser":case"shape":case"connector":case"frame":return"crosshair";case"text":return"text";default:return"default"}}function getBackgroundGrid(k,_,y,w){const $=y<.5?2:1/(Math.floor(y)||1),B=clamp$1(20*$*y,GRID_GAP_MIN,GRID_GAP_MAX),R=-k*y,H=-_*y;return{gap:B,translateX:R,translateY:H,grid:w?"radial-gradient(var(--affine-edgeless-grid-color) 1px, var(--affine-background-primary-color) 1px)":"unset"}}function getSelectedRect(k){if(k.length===0)return new DOMRect;if(k.length===1){const[_,y,w,$]=deserializeXYWH(k[0].xywh);return new DOMRect(_,y,w,$)}return k.reduce((_,y,w)=>{const $=isTopLevelBlock(y)?0:y.rotate,[B,R,H,j]=deserializeXYWH(y.xywh);let{left:q,top:X,right:ee,bottom:te}=getQuadBoundsWithRotation({x:B,y:R,w:H,h:j,rotate:$});return w!==0&&(q=Math.min(q,_.left),X=Math.min(X,_.top),ee=Math.max(ee,_.right),te=Math.max(te,_.bottom)),_.x=q,_.y=X,_.width=ee-q,_.height=te-X,_},new DOMRect)}function getSelectableBounds(k){const _=new Map;for(const y of k){const w=Bound.deserialize(y.xywh);let $=0;isTopLevelBlock(y)||($=y.rotate??0),_.set(y.id,{bound:w,rotate:$})}return _}function getEdgelessElement(k,_){return k.surface.pickById(_)??k.page.getBlockById(_)??null}function getGridBound(k){return isTopLevelBlock(k)?Bound.deserialize(k.xywh):k.gridBound}function edgelessElementsBound(k){return k.reduce((_,y)=>_.unite(getGridBound(y)),getGridBound(k[0]))}function getCopyElements(k,_){const y=new Set;return _.forEach(w=>{w instanceof FrameElement?(y.add(w),k.frame.getElementsInFrame(w).forEach($=>y.add($))):y.add(w)}),Array.from(y)}const offset=10;async function duplicate(k,_,y=!0){const{surface:w,page:$}=k,B=edgelessElementsBound(_),R=await Promise.all(getCopyElements(k,_).map(async H=>{const j=H instanceof FrameElement?Bound.deserialize(H.xywh):getGridBound(H);if(j.x+=B.w+offset,isTopLevelBlock(H)){const q=k.getService("affine:note"),X=$.addBlock("affine:note",{xywh:j.serialize()},$.root?.id),ee=$.getBlockById(X);return assertExists(ee),await q.json2Block(ee,q.block2Json(H).children),X}else return w.addElement(H.type,{...H.serialize(),xywh:j.serialize()})}));y&&k.selectionManager.setSelection({elements:R,editing:!1})}function deleteElements(k,_){const y=new Set(_);_.forEach(w=>{(isTopLevelBlock(w)||w.connectable)&&k.connector.getConnecttedConnectors([w]).forEach(B=>y.add(B))}),y.forEach(w=>{isTopLevelBlock(w)?(k.page.root?.children??[]).length>1&&k.page.deleteBlock(w):k.surface.removeElement(w.id)})}function getSelectedContentModels(k,_){return getSelectedContentBlockElements(k,_).map($=>$.model)}function getSelectedContentBlockElements(k,_){const{rangeManager:y}=k.root,w=k.root.selectionManager;if(w.value.length===0)return[];const B=[];if(_.includes("text")&&w.find("text")){assertExists(y);const H=y.value;if(!H)return[];const j=y.getSelectedBlockElementsByRange(H,{match:q=>q.model.role==="content",mode:"flat"});B.push(...j)}if(_.includes("block")&&w.find("block")){const H=k.root.viewStore,j=w.filter("block");B.push(...j.flatMap(q=>H.viewFromPath("block",q.path)??[]))}return B.filter((H,j)=>B.indexOf(H)===j).sort((H,j)=>{if(H===j)return 0;const q=H.compareDocumentPosition(j);return q&Node.DOCUMENT_POSITION_FOLLOWING||q&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:q&Node.DOCUMENT_POSITION_PRECEDING||q&Node.DOCUMENT_POSITION_CONTAINS?1:0})}function mergeFormat(k,_){return k.length?_?k.reduce((y,w)=>({...y,...w})):k.reduce((y,w)=>{const $={};for(const B in y){const R=B;y[R]===w[R]&&($[R]=y[R])}return $}):{}}function getCombinedFormatInTextSelection(k,_,y=!1){const w=getSelectedContentModels(k,["text","block"]);if(w.length===0)return{};if(w.length===1){const H=getVirgoByModel(w[0]);return assertExists(H),H.getFormat({index:_.from.index,length:_.from.length},y)}const $=[],B=w[0];if(!matchFlavours(B,["affine:code"])&&B.text&&B.text.length){const H=getVirgoByModel(B);assertExists(H);const j=H.getFormat({index:_.from.index,length:_.from.length},y);$.push(j)}const R=w[w.length-1];if(!matchFlavours(R,["affine:code"])&&R.text&&R.text.length){const H=getVirgoByModel(R);assertExists(H);const j=H.getFormat({index:0,length:_.to?.length??0},y);$.push(j)}return w.slice(1,-1).filter(H=>!matchFlavours(H,["affine:code"])).filter(H=>H.text&&H.text.length).forEach(H=>{const j=getVirgoByModel(H);assertExists(j);const q=j.getFormat({index:0,length:j.yText.length-1});$.push(q)},y),mergeFormat($,y)}function getCombinedFormatInBlockSelections(k,_,y=!1){const w=k.root.viewStore,$=k.root.selectionManager,B=_.flatMap(R=>{const H=w.viewFromPath("block",R.path);if(!H||!H.model.text)return[];const j=$.getInstance("text",{from:{path:R.path,index:0,length:H.model.text.length},to:null});return getCombinedFormatInTextSelection(H,j,y)});return mergeFormat(B,y)}function getDefaults(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,hooks:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults$1=getDefaults();function changeDefaults(k){defaults$1=k}const escapeTest=/[&<>"']/,escapeReplace=new RegExp(escapeTest.source,"g"),escapeTestNoEncode=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode=new RegExp(escapeTestNoEncode.source,"g"),escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=k=>escapeReplacements[k];function escape$1(k,_){if(_){if(escapeTest.test(k))return k.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(k))return k.replace(escapeReplaceNoEncode,getEscapeReplacement);return k}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(k){return k.replace(unescapeTest,(_,y)=>(y=y.toLowerCase(),y==="colon"?":":y.charAt(0)==="#"?y.charAt(1)==="x"?String.fromCharCode(parseInt(y.substring(2),16)):String.fromCharCode(+y.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(k,_){k=typeof k=="string"?k:k.source,_=_||"";const y={replace:(w,$)=>($=$.source||$,$=$.replace(caret,"$1"),k=k.replace(w,$),y),getRegex:()=>new RegExp(k,_)};return y}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(k,_,y){if(k){let w;try{w=decodeURIComponent(unescape$1(y)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if(w.indexOf("javascript:")===0||w.indexOf("vbscript:")===0||w.indexOf("data:")===0)return null}_&&!originIndependentUrl.test(y)&&(y=resolveUrl(_,y));try{y=encodeURI(y).replace(/%25/g,"%")}catch{return null}return y}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(k,_){baseUrls[" "+k]||(justDomain.test(k)?baseUrls[" "+k]=k+"/":baseUrls[" "+k]=rtrim(k,"/",!0)),k=baseUrls[" "+k];const y=k.indexOf(":")===-1;return _.substring(0,2)==="//"?y?_:k.replace(protocol,"$1")+_:_.charAt(0)==="/"?y?_:k.replace(domain,"$1")+_:k+_}const noopTest={exec:function k(){}};function splitCells(k,_){const y=k.replace(/\|/g,(B,R,H)=>{let j=!1,q=R;for(;--q>=0&&H[q]==="\\";)j=!j;return j?"|":" |"}),w=y.split(/ \|/);let $=0;if(w[0].trim()||w.shift(),w.length>0&&!w[w.length-1].trim()&&w.pop(),w.length>_)w.splice(_);else for(;w.length<_;)w.push("");for(;$<w.length;$++)w[$]=w[$].trim().replace(/\\\|/g,"|");return w}function rtrim(k,_,y){const w=k.length;if(w===0)return"";let $=0;for(;$<w;){const B=k.charAt(w-$-1);if(B===_&&!y)$++;else if(B!==_&&y)$++;else break}return k.slice(0,w-$)}function findClosingBracket(k,_){if(k.indexOf(_[1])===-1)return-1;const y=k.length;let w=0,$=0;for(;$<y;$++)if(k[$]==="\\")$++;else if(k[$]===_[0])w++;else if(k[$]===_[1]&&(w--,w<0))return $;return-1}function checkSanitizeDeprecation(k){k&&k.sanitize&&!k.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(k,_){if(_<1)return"";let y="";for(;_>1;)_&1&&(y+=k),_>>=1,k+=k;return y+k}function outputLink(k,_,y,w){const $=_.href,B=_.title?escape$1(_.title):null,R=k[1].replace(/\\([\[\]])/g,"$1");if(k[0].charAt(0)!=="!"){w.state.inLink=!0;const H={type:"link",raw:y,href:$,title:B,text:R,tokens:w.inlineTokens(R)};return w.state.inLink=!1,H}return{type:"image",raw:y,href:$,title:B,text:escape$1(R)}}function indentCodeCompensation(k,_){const y=k.match(/^(\s+)(?:```)/);if(y===null)return _;const w=y[1];return _.split(`
`).map($=>{const B=$.match(/^\s+/);if(B===null)return $;const[R]=B;return R.length>=w.length?$.slice(w.length):$}).join(`
`)}class Tokenizer{constructor(_){this.options=_||defaults$1}space(_){const y=this.rules.block.newline.exec(_);if(y&&y[0].length>0)return{type:"space",raw:y[0]}}code(_){const y=this.rules.block.code.exec(_);if(y){const w=y[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:y[0],codeBlockStyle:"indented",text:this.options.pedantic?w:rtrim(w,`
`)}}}fences(_){const y=this.rules.block.fences.exec(_);if(y){const w=y[0],$=indentCodeCompensation(w,y[3]||"");return{type:"code",raw:w,lang:y[2]?y[2].trim().replace(this.rules.inline._escapes,"$1"):y[2],text:$}}}heading(_){const y=this.rules.block.heading.exec(_);if(y){let w=y[2].trim();if(/#$/.test(w)){const $=rtrim(w,"#");(this.options.pedantic||!$||/ $/.test($))&&(w=$.trim())}return{type:"heading",raw:y[0],depth:y[1].length,text:w,tokens:this.lexer.inline(w)}}}hr(_){const y=this.rules.block.hr.exec(_);if(y)return{type:"hr",raw:y[0]}}blockquote(_){const y=this.rules.block.blockquote.exec(_);if(y){const w=y[0].replace(/^ *>[ \t]?/gm,""),$=this.lexer.state.top;this.lexer.state.top=!0;const B=this.lexer.blockTokens(w);return this.lexer.state.top=$,{type:"blockquote",raw:y[0],tokens:B,text:w}}}list(_){let y=this.rules.block.list.exec(_);if(y){let w,$,B,R,H,j,q,X,ee,te,ne,oe,ie=y[1].trim();const ae=ie.length>1,re={type:"list",raw:"",ordered:ae,start:ae?+ie.slice(0,-1):"",loose:!1,items:[]};ie=ae?`\\d{1,9}\\${ie.slice(-1)}`:`\\${ie}`,this.options.pedantic&&(ie=ae?ie:"[*+-]");const se=new RegExp(`^( {0,3}${ie})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;_&&(oe=!1,!(!(y=se.exec(_))||this.rules.block.hr.test(_)));){if(w=y[0],_=_.substring(w.length),X=y[2].split(`
`,1)[0].replace(/^\t+/,ue=>" ".repeat(3*ue.length)),ee=_.split(`
`,1)[0],this.options.pedantic?(R=2,ne=X.trimLeft()):(R=y[2].search(/[^ ]/),R=R>4?1:R,ne=X.slice(R),R+=y[1].length),j=!1,!X&&/^ *$/.test(ee)&&(w+=ee+`
`,_=_.substring(ee.length+1),oe=!0),!oe){const ue=new RegExp(`^ {0,${Math.min(3,R-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),he=new RegExp(`^ {0,${Math.min(3,R-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),ce=new RegExp(`^ {0,${Math.min(3,R-1)}}(?:\`\`\`|~~~)`),ge=new RegExp(`^ {0,${Math.min(3,R-1)}}#`);for(;_&&(te=_.split(`
`,1)[0],ee=te,this.options.pedantic&&(ee=ee.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(ce.test(ee)||ge.test(ee)||ue.test(ee)||he.test(_)));){if(ee.search(/[^ ]/)>=R||!ee.trim())ne+=`
`+ee.slice(R);else{if(j||X.search(/[^ ]/)>=4||ce.test(X)||ge.test(X)||he.test(X))break;ne+=`
`+ee}!j&&!ee.trim()&&(j=!0),w+=te+`
`,_=_.substring(te.length+1),X=ee.slice(R)}}re.loose||(q?re.loose=!0:/\n *\n *$/.test(w)&&(q=!0)),this.options.gfm&&($=/^\[[ xX]\] /.exec(ne),$&&(B=$[0]!=="[ ] ",ne=ne.replace(/^\[[ xX]\] +/,""))),re.items.push({type:"list_item",raw:w,task:!!$,checked:B,loose:!1,text:ne}),re.raw+=w}re.items[re.items.length-1].raw=w.trimRight(),re.items[re.items.length-1].text=ne.trimRight(),re.raw=re.raw.trimRight();const le=re.items.length;for(H=0;H<le;H++)if(this.lexer.state.top=!1,re.items[H].tokens=this.lexer.blockTokens(re.items[H].text,[]),!re.loose){const ue=re.items[H].tokens.filter(ce=>ce.type==="space"),he=ue.length>0&&ue.some(ce=>/\n.*\n/.test(ce.raw));re.loose=he}if(re.loose)for(H=0;H<le;H++)re.items[H].loose=!0;return re}}html(_){const y=this.rules.block.html.exec(_);if(y){const w={type:"html",raw:y[0],pre:!this.options.sanitizer&&(y[1]==="pre"||y[1]==="script"||y[1]==="style"),text:y[0]};if(this.options.sanitize){const $=this.options.sanitizer?this.options.sanitizer(y[0]):escape$1(y[0]);w.type="paragraph",w.text=$,w.tokens=this.lexer.inline($)}return w}}def(_){const y=this.rules.block.def.exec(_);if(y){const w=y[1].toLowerCase().replace(/\s+/g," "),$=y[2]?y[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",B=y[3]?y[3].substring(1,y[3].length-1).replace(this.rules.inline._escapes,"$1"):y[3];return{type:"def",tag:w,raw:y[0],href:$,title:B}}}table(_){const y=this.rules.block.table.exec(_);if(y){const w={type:"table",header:splitCells(y[1]).map($=>({text:$})),align:y[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:y[3]&&y[3].trim()?y[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(w.header.length===w.align.length){w.raw=y[0];let $=w.align.length,B,R,H,j;for(B=0;B<$;B++)/^ *-+: *$/.test(w.align[B])?w.align[B]="right":/^ *:-+: *$/.test(w.align[B])?w.align[B]="center":/^ *:-+ *$/.test(w.align[B])?w.align[B]="left":w.align[B]=null;for($=w.rows.length,B=0;B<$;B++)w.rows[B]=splitCells(w.rows[B],w.header.length).map(q=>({text:q}));for($=w.header.length,R=0;R<$;R++)w.header[R].tokens=this.lexer.inline(w.header[R].text);for($=w.rows.length,R=0;R<$;R++)for(j=w.rows[R],H=0;H<j.length;H++)j[H].tokens=this.lexer.inline(j[H].text);return w}}}lheading(_){const y=this.rules.block.lheading.exec(_);if(y)return{type:"heading",raw:y[0],depth:y[2].charAt(0)==="="?1:2,text:y[1],tokens:this.lexer.inline(y[1])}}paragraph(_){const y=this.rules.block.paragraph.exec(_);if(y){const w=y[1].charAt(y[1].length-1)===`
`?y[1].slice(0,-1):y[1];return{type:"paragraph",raw:y[0],text:w,tokens:this.lexer.inline(w)}}}text(_){const y=this.rules.block.text.exec(_);if(y)return{type:"text",raw:y[0],text:y[0],tokens:this.lexer.inline(y[0])}}escape(_){const y=this.rules.inline.escape.exec(_);if(y)return{type:"escape",raw:y[0],text:escape$1(y[1])}}tag(_){const y=this.rules.inline.tag.exec(_);if(y)return!this.lexer.state.inLink&&/^<a /i.test(y[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(y[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(y[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(y[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:y[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(y[0]):escape$1(y[0]):y[0]}}link(_){const y=this.rules.inline.link.exec(_);if(y){const w=y[2].trim();if(!this.options.pedantic&&/^</.test(w)){if(!/>$/.test(w))return;const R=rtrim(w.slice(0,-1),"\\");if((w.length-R.length)%2===0)return}else{const R=findClosingBracket(y[2],"()");if(R>-1){const j=(y[0].indexOf("!")===0?5:4)+y[1].length+R;y[2]=y[2].substring(0,R),y[0]=y[0].substring(0,j).trim(),y[3]=""}}let $=y[2],B="";if(this.options.pedantic){const R=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec($);R&&($=R[1],B=R[3])}else B=y[3]?y[3].slice(1,-1):"";return $=$.trim(),/^</.test($)&&(this.options.pedantic&&!/>$/.test(w)?$=$.slice(1):$=$.slice(1,-1)),outputLink(y,{href:$&&$.replace(this.rules.inline._escapes,"$1"),title:B&&B.replace(this.rules.inline._escapes,"$1")},y[0],this.lexer)}}reflink(_,y){let w;if((w=this.rules.inline.reflink.exec(_))||(w=this.rules.inline.nolink.exec(_))){let $=(w[2]||w[1]).replace(/\s+/g," ");if($=y[$.toLowerCase()],!$){const B=w[0].charAt(0);return{type:"text",raw:B,text:B}}return outputLink(w,$,w[0],this.lexer)}}emStrong(_,y,w=""){let $=this.rules.inline.emStrong.lDelim.exec(_);if(!$||$[3]&&w.match(/[\p{L}\p{N}]/u))return;const B=$[1]||$[2]||"";if(!B||B&&(w===""||this.rules.inline.punctuation.exec(w))){const R=$[0].length-1;let H,j,q=R,X=0;const ee=$[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(ee.lastIndex=0,y=y.slice(-1*_.length+R);($=ee.exec(y))!=null;){if(H=$[1]||$[2]||$[3]||$[4]||$[5]||$[6],!H)continue;if(j=H.length,$[3]||$[4]){q+=j;continue}else if(($[5]||$[6])&&R%3&&!((R+j)%3)){X+=j;continue}if(q-=j,q>0)continue;j=Math.min(j,j+q+X);const te=_.slice(0,R+$.index+($[0].length-H.length)+j);if(Math.min(R,j)%2){const oe=te.slice(1,-1);return{type:"em",raw:te,text:oe,tokens:this.lexer.inlineTokens(oe)}}const ne=te.slice(2,-2);return{type:"strong",raw:te,text:ne,tokens:this.lexer.inlineTokens(ne)}}}}codespan(_){const y=this.rules.inline.code.exec(_);if(y){let w=y[2].replace(/\n/g," ");const $=/[^ ]/.test(w),B=/^ /.test(w)&&/ $/.test(w);return $&&B&&(w=w.substring(1,w.length-1)),w=escape$1(w,!0),{type:"codespan",raw:y[0],text:w}}}br(_){const y=this.rules.inline.br.exec(_);if(y)return{type:"br",raw:y[0]}}del(_){const y=this.rules.inline.del.exec(_);if(y)return{type:"del",raw:y[0],text:y[2],tokens:this.lexer.inlineTokens(y[2])}}autolink(_,y){const w=this.rules.inline.autolink.exec(_);if(w){let $,B;return w[2]==="@"?($=escape$1(this.options.mangle?y(w[1]):w[1]),B="mailto:"+$):($=escape$1(w[1]),B=$),{type:"link",raw:w[0],text:$,href:B,tokens:[{type:"text",raw:$,text:$}]}}}url(_,y){let w;if(w=this.rules.inline.url.exec(_)){let $,B;if(w[2]==="@")$=escape$1(this.options.mangle?y(w[0]):w[0]),B="mailto:"+$;else{let R;do R=w[0],w[0]=this.rules.inline._backpedal.exec(w[0])[0];while(R!==w[0]);$=escape$1(w[0]),w[1]==="www."?B="http://"+w[0]:B=w[0]}return{type:"link",raw:w[0],text:$,href:B,tokens:[{type:"text",raw:$,text:$}]}}}inlineText(_,y){const w=this.rules.inline.text.exec(_);if(w){let $;return this.lexer.state.inRawBlock?$=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(w[0]):escape$1(w[0]):w[0]:$=escape$1(this.options.smartypants?y(w[0]):w[0]),{type:"text",raw:w[0],text:$}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal={...block};block.gfm={...block.normal,table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"};block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic={...block.normal,html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()};const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal={...inline};inline.pedantic={...inline.normal,strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()};inline.gfm={...inline.normal,escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/};inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks={...inline.gfm,br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()};function smartypants(k){return k.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function mangle(k){let _="",y,w;const $=k.length;for(y=0;y<$;y++)w=k.charCodeAt(y),Math.random()>.5&&(w="x"+w.toString(16)),_+="&#"+w+";";return _}class Lexer{constructor(_){this.tokens=[],this.tokens.links=Object.create(null),this.options=_||defaults$1,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const y={block:block.normal,inline:inline.normal};this.options.pedantic?(y.block=block.pedantic,y.inline=inline.pedantic):this.options.gfm&&(y.block=block.gfm,this.options.breaks?y.inline=inline.breaks:y.inline=inline.gfm),this.tokenizer.rules=y}static get rules(){return{block,inline}}static lex(_,y){return new Lexer(y).lex(_)}static lexInline(_,y){return new Lexer(y).inlineTokens(_)}lex(_){_=_.replace(/\r\n|\r/g,`
`),this.blockTokens(_,this.tokens);let y;for(;y=this.inlineQueue.shift();)this.inlineTokens(y.src,y.tokens);return this.tokens}blockTokens(_,y=[]){this.options.pedantic?_=_.replace(/\t/g,"    ").replace(/^ +$/gm,""):_=_.replace(/^( *)(\t+)/gm,(H,j,q)=>j+"    ".repeat(q.length));let w,$,B,R;for(;_;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(H=>(w=H.call({lexer:this},_,y))?(_=_.substring(w.raw.length),y.push(w),!0):!1))){if(w=this.tokenizer.space(_)){_=_.substring(w.raw.length),w.raw.length===1&&y.length>0?y[y.length-1].raw+=`
`:y.push(w);continue}if(w=this.tokenizer.code(_)){_=_.substring(w.raw.length),$=y[y.length-1],$&&($.type==="paragraph"||$.type==="text")?($.raw+=`
`+w.raw,$.text+=`
`+w.text,this.inlineQueue[this.inlineQueue.length-1].src=$.text):y.push(w);continue}if(w=this.tokenizer.fences(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.heading(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.hr(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.blockquote(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.list(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.html(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.def(_)){_=_.substring(w.raw.length),$=y[y.length-1],$&&($.type==="paragraph"||$.type==="text")?($.raw+=`
`+w.raw,$.text+=`
`+w.raw,this.inlineQueue[this.inlineQueue.length-1].src=$.text):this.tokens.links[w.tag]||(this.tokens.links[w.tag]={href:w.href,title:w.title});continue}if(w=this.tokenizer.table(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.lheading(_)){_=_.substring(w.raw.length),y.push(w);continue}if(B=_,this.options.extensions&&this.options.extensions.startBlock){let H=1/0;const j=_.slice(1);let q;this.options.extensions.startBlock.forEach(function(X){q=X.call({lexer:this},j),typeof q=="number"&&q>=0&&(H=Math.min(H,q))}),H<1/0&&H>=0&&(B=_.substring(0,H+1))}if(this.state.top&&(w=this.tokenizer.paragraph(B))){$=y[y.length-1],R&&$.type==="paragraph"?($.raw+=`
`+w.raw,$.text+=`
`+w.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=$.text):y.push(w),R=B.length!==_.length,_=_.substring(w.raw.length);continue}if(w=this.tokenizer.text(_)){_=_.substring(w.raw.length),$=y[y.length-1],$&&$.type==="text"?($.raw+=`
`+w.raw,$.text+=`
`+w.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=$.text):y.push(w);continue}if(_){const H="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(H);break}else throw new Error(H)}}return this.state.top=!0,y}inline(_,y=[]){return this.inlineQueue.push({src:_,tokens:y}),y}inlineTokens(_,y=[]){let w,$,B,R=_,H,j,q;if(this.tokens.links){const X=Object.keys(this.tokens.links);if(X.length>0)for(;(H=this.tokenizer.rules.inline.reflinkSearch.exec(R))!=null;)X.includes(H[0].slice(H[0].lastIndexOf("[")+1,-1))&&(R=R.slice(0,H.index)+"["+repeatString("a",H[0].length-2)+"]"+R.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(H=this.tokenizer.rules.inline.blockSkip.exec(R))!=null;)R=R.slice(0,H.index)+"["+repeatString("a",H[0].length-2)+"]"+R.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(H=this.tokenizer.rules.inline.escapedEmSt.exec(R))!=null;)R=R.slice(0,H.index+H[0].length-2)+"++"+R.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;_;)if(j||(q=""),j=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(X=>(w=X.call({lexer:this},_,y))?(_=_.substring(w.raw.length),y.push(w),!0):!1))){if(w=this.tokenizer.escape(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.tag(_)){_=_.substring(w.raw.length),$=y[y.length-1],$&&w.type==="text"&&$.type==="text"?($.raw+=w.raw,$.text+=w.text):y.push(w);continue}if(w=this.tokenizer.link(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.reflink(_,this.tokens.links)){_=_.substring(w.raw.length),$=y[y.length-1],$&&w.type==="text"&&$.type==="text"?($.raw+=w.raw,$.text+=w.text):y.push(w);continue}if(w=this.tokenizer.emStrong(_,R,q)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.codespan(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.br(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.del(_)){_=_.substring(w.raw.length),y.push(w);continue}if(w=this.tokenizer.autolink(_,mangle)){_=_.substring(w.raw.length),y.push(w);continue}if(!this.state.inLink&&(w=this.tokenizer.url(_,mangle))){_=_.substring(w.raw.length),y.push(w);continue}if(B=_,this.options.extensions&&this.options.extensions.startInline){let X=1/0;const ee=_.slice(1);let te;this.options.extensions.startInline.forEach(function(ne){te=ne.call({lexer:this},ee),typeof te=="number"&&te>=0&&(X=Math.min(X,te))}),X<1/0&&X>=0&&(B=_.substring(0,X+1))}if(w=this.tokenizer.inlineText(B,smartypants)){_=_.substring(w.raw.length),w.raw.slice(-1)!=="_"&&(q=w.raw.slice(-1)),j=!0,$=y[y.length-1],$&&$.type==="text"?($.raw+=w.raw,$.text+=w.text):y.push(w);continue}if(_){const X="Infinite loop on byte: "+_.charCodeAt(0);if(this.options.silent){console.error(X);break}else throw new Error(X)}}return y}}class Renderer{constructor(_){this.options=_||defaults$1}code(_,y,w){const $=(y||"").match(/\S*/)[0];if(this.options.highlight){const B=this.options.highlight(_,$);B!=null&&B!==_&&(w=!0,_=B)}return _=_.replace(/\n$/,"")+`
`,$?'<pre><code class="'+this.options.langPrefix+escape$1($)+'">'+(w?_:escape$1(_,!0))+`</code></pre>
`:"<pre><code>"+(w?_:escape$1(_,!0))+`</code></pre>
`}blockquote(_){return`<blockquote>
${_}</blockquote>
`}html(_){return _}heading(_,y,w,$){if(this.options.headerIds){const B=this.options.headerPrefix+$.slug(w);return`<h${y} id="${B}">${_}</h${y}>
`}return`<h${y}>${_}</h${y}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(_,y,w){const $=y?"ol":"ul",B=y&&w!==1?' start="'+w+'"':"";return"<"+$+B+`>
`+_+"</"+$+`>
`}listitem(_){return`<li>${_}</li>
`}checkbox(_){return"<input "+(_?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(_){return`<p>${_}</p>
`}table(_,y){return y&&(y=`<tbody>${y}</tbody>`),`<table>
<thead>
`+_+`</thead>
`+y+`</table>
`}tablerow(_){return`<tr>
${_}</tr>
`}tablecell(_,y){const w=y.header?"th":"td";return(y.align?`<${w} align="${y.align}">`:`<${w}>`)+_+`</${w}>
`}strong(_){return`<strong>${_}</strong>`}em(_){return`<em>${_}</em>`}codespan(_){return`<code>${_}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(_){return`<del>${_}</del>`}link(_,y,w){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return w;let $='<a href="'+_+'"';return y&&($+=' title="'+y+'"'),$+=">"+w+"</a>",$}image(_,y,w){if(_=cleanUrl(this.options.sanitize,this.options.baseUrl,_),_===null)return w;let $=`<img src="${_}" alt="${w}"`;return y&&($+=` title="${y}"`),$+=this.options.xhtml?"/>":">",$}text(_){return _}}class TextRenderer{strong(_){return _}em(_){return _}codespan(_){return _}del(_){return _}html(_){return _}text(_){return _}link(_,y,w){return""+w}image(_,y,w){return""+w}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(_){return _.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(_,y){let w=_,$=0;if(this.seen.hasOwnProperty(w)){$=this.seen[_];do $++,w=_+"-"+$;while(this.seen.hasOwnProperty(w))}return y||(this.seen[_]=$,this.seen[w]=0),w}slug(_,y={}){const w=this.serialize(_);return this.getNextSafeSlug(w,y.dryrun)}}class Parser{constructor(_){this.options=_||defaults$1,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(_,y){return new Parser(y).parse(_)}static parseInline(_,y){return new Parser(y).parseInline(_)}parse(_,y=!0){let w="",$,B,R,H,j,q,X,ee,te,ne,oe,ie,ae,re,se,le,ue,he,ce;const ge=_.length;for($=0;$<ge;$++){if(ne=_[$],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[ne.type]&&(ce=this.options.extensions.renderers[ne.type].call({parser:this},ne),ce!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(ne.type))){w+=ce||"";continue}switch(ne.type){case"space":continue;case"hr":{w+=this.renderer.hr();continue}case"heading":{w+=this.renderer.heading(this.parseInline(ne.tokens),ne.depth,unescape$1(this.parseInline(ne.tokens,this.textRenderer)),this.slugger);continue}case"code":{w+=this.renderer.code(ne.text,ne.lang,ne.escaped);continue}case"table":{for(ee="",X="",H=ne.header.length,B=0;B<H;B++)X+=this.renderer.tablecell(this.parseInline(ne.header[B].tokens),{header:!0,align:ne.align[B]});for(ee+=this.renderer.tablerow(X),te="",H=ne.rows.length,B=0;B<H;B++){for(q=ne.rows[B],X="",j=q.length,R=0;R<j;R++)X+=this.renderer.tablecell(this.parseInline(q[R].tokens),{header:!1,align:ne.align[R]});te+=this.renderer.tablerow(X)}w+=this.renderer.table(ee,te);continue}case"blockquote":{te=this.parse(ne.tokens),w+=this.renderer.blockquote(te);continue}case"list":{for(oe=ne.ordered,ie=ne.start,ae=ne.loose,H=ne.items.length,te="",B=0;B<H;B++)se=ne.items[B],le=se.checked,ue=se.task,re="",se.task&&(he=this.renderer.checkbox(le),ae?se.tokens.length>0&&se.tokens[0].type==="paragraph"?(se.tokens[0].text=he+" "+se.tokens[0].text,se.tokens[0].tokens&&se.tokens[0].tokens.length>0&&se.tokens[0].tokens[0].type==="text"&&(se.tokens[0].tokens[0].text=he+" "+se.tokens[0].tokens[0].text)):se.tokens.unshift({type:"text",text:he}):re+=he),re+=this.parse(se.tokens,ae),te+=this.renderer.listitem(re,ue,le);w+=this.renderer.list(te,oe,ie);continue}case"html":{w+=this.renderer.html(ne.text);continue}case"paragraph":{w+=this.renderer.paragraph(this.parseInline(ne.tokens));continue}case"text":{for(te=ne.tokens?this.parseInline(ne.tokens):ne.text;$+1<ge&&_[$+1].type==="text";)ne=_[++$],te+=`
`+(ne.tokens?this.parseInline(ne.tokens):ne.text);w+=y?this.renderer.paragraph(te):te;continue}default:{const be='Token with "'+ne.type+'" type was not found.';if(this.options.silent){console.error(be);return}else throw new Error(be)}}}return w}parseInline(_,y){y=y||this.renderer;let w="",$,B,R;const H=_.length;for($=0;$<H;$++){if(B=_[$],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[B.type]&&(R=this.options.extensions.renderers[B.type].call({parser:this},B),R!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(B.type))){w+=R||"";continue}switch(B.type){case"escape":{w+=y.text(B.text);break}case"html":{w+=y.html(B.text);break}case"link":{w+=y.link(B.href,B.title,this.parseInline(B.tokens,y));break}case"image":{w+=y.image(B.href,B.title,B.text);break}case"strong":{w+=y.strong(this.parseInline(B.tokens,y));break}case"em":{w+=y.em(this.parseInline(B.tokens,y));break}case"codespan":{w+=y.codespan(B.text);break}case"br":{w+=y.br();break}case"del":{w+=y.del(this.parseInline(B.tokens,y));break}case"text":{w+=y.text(B.text);break}default:{const j='Token with "'+B.type+'" type was not found.';if(this.options.silent){console.error(j);return}else throw new Error(j)}}}return w}}class Hooks{constructor(_){this.options=_||defaults$1}static passThroughHooks=new Set(["preprocess","postprocess"]);preprocess(_){return _}postprocess(_){return _}}function onError(k,_,y){return w=>{if(w.message+=`
Please report this to https://github.com/markedjs/marked.`,k){const $="<p>An error occurred:</p><pre>"+escape$1(w.message+"",!0)+"</pre>";if(_)return Promise.resolve($);if(y){y(null,$);return}return $}if(_)return Promise.reject(w);if(y){y(w);return}throw w}}function parseMarkdown(k,_){return(y,w,$)=>{typeof w=="function"&&($=w,w=null);const B={...w};w={...marked.defaults,...B};const R=onError(w.silent,w.async,$);if(typeof y>"u"||y===null)return R(new Error("marked(): input parameter is undefined or null"));if(typeof y!="string")return R(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(y)+", string expected"));if(checkSanitizeDeprecation(w),w.hooks&&(w.hooks.options=w),$){const H=w.highlight;let j;try{w.hooks&&(y=w.hooks.preprocess(y)),j=k(y,w)}catch(ee){return R(ee)}const q=function(ee){let te;if(!ee)try{w.walkTokens&&marked.walkTokens(j,w.walkTokens),te=_(j,w),w.hooks&&(te=w.hooks.postprocess(te))}catch(ne){ee=ne}return w.highlight=H,ee?R(ee):$(null,te)};if(!H||H.length<3||(delete w.highlight,!j.length))return q();let X=0;marked.walkTokens(j,function(ee){ee.type==="code"&&(X++,setTimeout(()=>{H(ee.text,ee.lang,function(te,ne){if(te)return q(te);ne!=null&&ne!==ee.text&&(ee.text=ne,ee.escaped=!0),X--,X===0&&q()})},0))}),X===0&&q();return}if(w.async)return Promise.resolve(w.hooks?w.hooks.preprocess(y):y).then(H=>k(H,w)).then(H=>w.walkTokens?Promise.all(marked.walkTokens(H,w.walkTokens)).then(()=>H):H).then(H=>_(H,w)).then(H=>w.hooks?w.hooks.postprocess(H):H).catch(R);try{w.hooks&&(y=w.hooks.preprocess(y));const H=k(y,w);w.walkTokens&&marked.walkTokens(H,w.walkTokens);let j=_(H,w);return w.hooks&&(j=w.hooks.postprocess(j)),j}catch(H){return R(H)}}}function marked(k,_,y){return parseMarkdown(Lexer.lex,Parser.parse)(k,_,y)}marked.options=marked.setOptions=function(k){return marked.defaults={...marked.defaults,...k},changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults$1;marked.use=function(...k){const _=marked.defaults.extensions||{renderers:{},childTokens:{}};k.forEach(y=>{const w={...y};if(w.async=marked.defaults.async||w.async||!1,y.extensions&&(y.extensions.forEach($=>{if(!$.name)throw new Error("extension name required");if($.renderer){const B=_.renderers[$.name];B?_.renderers[$.name]=function(...R){let H=$.renderer.apply(this,R);return H===!1&&(H=B.apply(this,R)),H}:_.renderers[$.name]=$.renderer}if($.tokenizer){if(!$.level||$.level!=="block"&&$.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");_[$.level]?_[$.level].unshift($.tokenizer):_[$.level]=[$.tokenizer],$.start&&($.level==="block"?_.startBlock?_.startBlock.push($.start):_.startBlock=[$.start]:$.level==="inline"&&(_.startInline?_.startInline.push($.start):_.startInline=[$.start]))}$.childTokens&&(_.childTokens[$.name]=$.childTokens)}),w.extensions=_),y.renderer){const $=marked.defaults.renderer||new Renderer;for(const B in y.renderer){const R=$[B];$[B]=(...H)=>{let j=y.renderer[B].apply($,H);return j===!1&&(j=R.apply($,H)),j}}w.renderer=$}if(y.tokenizer){const $=marked.defaults.tokenizer||new Tokenizer;for(const B in y.tokenizer){const R=$[B];$[B]=(...H)=>{let j=y.tokenizer[B].apply($,H);return j===!1&&(j=R.apply($,H)),j}}w.tokenizer=$}if(y.hooks){const $=marked.defaults.hooks||new Hooks;for(const B in y.hooks){const R=$[B];Hooks.passThroughHooks.has(B)?$[B]=H=>{if(marked.defaults.async)return Promise.resolve(y.hooks[B].call($,H)).then(q=>R.call($,q));const j=y.hooks[B].call($,H);return R.call($,j)}:$[B]=(...H)=>{let j=y.hooks[B].apply($,H);return j===!1&&(j=R.apply($,H)),j}}w.hooks=$}if(y.walkTokens){const $=marked.defaults.walkTokens;w.walkTokens=function(B){let R=[];return R.push(y.walkTokens.call(this,B)),$&&(R=R.concat($.call(this,B))),R}}marked.setOptions(w)})};marked.walkTokens=function(k,_){let y=[];for(const w of k)switch(y=y.concat(_.call(marked,w)),w.type){case"table":{for(const $ of w.header)y=y.concat(marked.walkTokens($.tokens,_));for(const $ of w.rows)for(const B of $)y=y.concat(marked.walkTokens(B.tokens,_));break}case"list":{y=y.concat(marked.walkTokens(w.items,_));break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[w.type]?marked.defaults.extensions.childTokens[w.type].forEach(function($){y=y.concat(marked.walkTokens(w[$],_))}):w.tokens&&(y=y.concat(marked.walkTokens(w.tokens,_)))}return y};marked.parseInline=parseMarkdown(Lexer.lexInline,Parser.parseInline);marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.Hooks=Hooks;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;let ToastContainer=null;const htmlToElement=k=>{const _=document.createElement("template");if(typeof k=="string")k=k.trim(),_.innerHTML=k;else{const{strings:y,values:w}=k,$=[...w,""],B=y.reduce((R,H,j)=>R+H+$[j],"");_.innerHTML=B}return _.content.firstChild},createToastContainer=()=>{const _=x$1`<div class="toast-container" style="${`
    position: fixed;
    z-index: 9999;
    top: 16px;
    left: 16px;
    right: 16px;
    bottom: 78px;
    pointer-events: none;
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
  `}"></div>`,y=htmlToElement(_),w=document.body.querySelector("editor-container");return assertExists(w),w.appendChild(y),y},toast=(k,_=2500)=>{ToastContainer||(ToastContainer=createToastContainer());const w=x$1`<div style="${`
    max-width: 480px;
    text-align: center;
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-sm);
    padding: 6px 12px;
    margin: 10px 0 0 0;
    color: var(--affine-white);
    background: var(--affine-tooltip);
    box-shadow: var(--affine-float-button-shadow);
    border-radius: 10px;
    transition: all 230ms cubic-bezier(0.21, 1.02, 0.73, 1);
    opacity: 0;
  `}"></div>`,$=htmlToElement(w);$.textContent=k,ToastContainer.appendChild($);const B=[{opacity:0},{opacity:1}],R={duration:230,easing:"cubic-bezier(0.21, 1.02, 0.73, 1)",fill:"forwards"};return $.animate(B,R),setTimeout(async()=>{const H=B.reverse();await $.animate(H,R).finished,$.style.maxHeight="0",$.style.margin="0",$.style.padding="0",$.addEventListener("transitionend",()=>{$.remove()},{once:!0})},_),$};function mergeToCodeModel(k){if(k.length===0)throw new Error("No models to merge");const _=k[0].page,y=_.getParent(k[0]);assertExists(y);const w=y.children.indexOf(k[0]),$=k.map(R=>R.text instanceof Text$1?R.text.toString():null).filter(Boolean).join(`
`);return k.map(R=>_.deleteBlock(R)),_.addBlock("affine:code",{text:new Text$1($)},y,w)}function transformModel(k,_,y){const w=k.page,$=w.getParent(k);assertExists($);const B={text:k?.text?.clone(),children:k.children,...y},R=$.children.indexOf(k);return w.deleteBlock(k),w.addBlock(_,B,$,R)}const defaultAttachmentProps={name:"",size:0,type:"application/octet-stream",sourceId:void 0,loadingKey:void 0,caption:void 0},AttachmentBlockSchema=defineBlockSchema({flavour:"affine:attachment",props:()=>defaultAttachmentProps,metadata:{version:1,role:"content",parent:["affine:note"]}}),MAX_ATTACHMENT_SIZE=10*1e3*1e3;function cloneAttachmentProperties(k){const _={};for(const y in defaultAttachmentProps){const w=y;_[w]=k[w]}return _}async function getAttachment(k){const _=k.page.blobs,y=k.sourceId;if(!y)return null;const w=await _.get(y);return w||null}async function downloadAttachment(k){const _=await getAttachment(k);if(!_){toast("Failed to download attachment!"),console.error("attachment load failed! sourceId:",k.sourceId,"BlobManager:",k.page.blobs);return}downloadBlob(_,k.name)}const MAX_TEMP_DATA_SIZE=100,tempAttachmentMap=new Map,tempImageMap=new Map,withTempConvertData=()=>({saveAttachmentData:($,B)=>{tempAttachmentMap.size>MAX_TEMP_DATA_SIZE&&tempAttachmentMap.clear();const{name:R}=B;tempAttachmentMap.set($,{name:R})},getAttachmentData:$=>{const B=tempAttachmentMap.get($);return tempAttachmentMap.delete($),B},saveImageData:($,B)=>{tempImageMap.size>MAX_TEMP_DATA_SIZE&&tempImageMap.clear();const{width:R,height:H}=B;tempImageMap.set($,{width:R,height:H})},getImageData:$=>{const B=tempImageMap.get($);return tempImageMap.delete($),B}});async function turnIntoEmbedView(k){const _=k.sourceId;assertExists(_);const{saveAttachmentData:y,getImageData:w}=withTempConvertData(),$=w(k.id),B={sourceId:_,caption:k.caption,...$},R=transformModel(k,"affine:image",B);y(R,k)}function turnImageIntoCardView(k,_){const y=k.sourceId;assertExists(y);const{saveImageData:w,getAttachmentData:$}=withTempConvertData(),B=$(k.id),R={sourceId:y,name:_.name,size:_.size,type:_.type,caption:k.caption,...B},H=transformModel(k,"affine:attachment",R);w(H,k)}async function uploadFileForAttachment(k,_){const y=k.loadingKey;(y?isAttachmentLoading(y):!1)||console.warn("uploadAttachment: the attachment is not loading!",k);const $=k.page,B=$.blobs;try{const R=await B.set(_);return setAttachmentLoading(k.loadingKey??"",!1),$.updateBlock(k,{sourceId:R,loadingKey:null}),k}catch(R){return console.error(R),R instanceof Error&&toast(`Failed to upload attachment! ${R.message||R.toString()}`),$.updateBlock(k,{loadingKey:null}),null}}async function appendAttachmentBlock(k,_){if(k.size>MAX_ATTACHMENT_SIZE){toast(`You can only upload files less than ${humanFileSize(MAX_ATTACHMENT_SIZE,!0,0)}`);return}const y=_.page,w=y.generateId();setAttachmentLoading(w,!0);const $={flavour:"affine:attachment",name:k.name,size:k.size,type:k.type,loadingKey:w},[B]=y.addSiblingBlocks(_,[$]),R=y.getBlockById(B);assertExists(R),uploadFileForAttachment(R,k)}const attachmentLoadingMap=new Set;function setAttachmentLoading(k,_){_?attachmentLoadingMap.add(k):attachmentLoadingMap.delete(k)}function isAttachmentLoading(k){return attachmentLoadingMap.has(k)}async function hasBlob(k,_){return(await k.list()).some(w=>w===_)}function xywhArrayToObject(k){const[_,y,w,$]=deserializeXYWH(k.xywh);return{x:_,y,w,h:$}}function handleBlockEndEnter(k,_){const y=k.getParent(_),w=k.getNextSibling(_);if(!y)return;const $=()=>matchFlavours(_,["affine:list"])?[_.flavour,{type:_.type}]:["affine:paragraph",{type:"text"}],[B,R]=$();if(isInsideBlockByFlavour(k,_,"affine:database")){k.captureSync();const q=y.children.findIndex(oe=>oe.id===_.id);let X=y,ee=q+1;const te=y.children.length;if(q===te-1&&_.text?.yText.length===0){te!==1&&k.deleteBlock(_);const oe=k.getNextSibling(X);if(oe&&matchFlavours(oe,["affine:paragraph"])){asyncFocusRichText(k,oe.id,{index:oe.text.yText.length,length:0});return}const ie=k.getParent(y);if(!ie)return;const ae=ie.children.findIndex(re=>re.id===y.id);X=ie,ee=ae+1}const ne=k.addBlock(B,R,X,ee);asyncFocusRichText(k,ne);return}const H=y.children.indexOf(_);if(H===-1)return;k.captureSync();const j=_.children.length?k.addBlock(B,R,_,0):k.addBlock(B,R,y,H+1);if(matchFlavours(_,["affine:list"])&&_.type==="numbered"){let q=w;for(;q&&matchFlavours(q,["affine:list"])&&_.type==="numbered";)k.updateBlock(q,{}),q=k.getNextSibling(q)}asyncFocusRichText(k,j)}function handleBlockSplit(k,_,y,w){if(!(_.text instanceof Text$1)||_.text.yText.length<y+w)return;const $=k.getParent(_);if(!$)return;k.captureSync();const B=_.text.split(y,w),R=$,H=R.children.indexOf(_)+1,j=[..._.children];k.updateBlock(_,{children:[]});const q=k.addBlock(_.flavour,{text:B,type:_.type,children:j},R,H);return asyncFocusRichText(k,q)}function handleIndent(k,_,y=0){const w=k.getPreviousSibling(_),$=k.getNextSibling(_);if(!w||!supportsChildren(w))return;const B=k.getParent(_);if(!B)return;k.captureSync();const R=_.children;if(k.updateBlock(_,{children:[]}),k.updateBlock(B,{children:B.children.filter(H=>H.id!==_.id)}),k.updateBlock(w,{children:[...w.children,_,...R]}),matchFlavours(_,["affine:list"])&&_.type==="numbered"){let H=$;for(;H&&matchFlavours(H,["affine:list"])&&_.type==="numbered";)k.updateBlock(H,{}),H=k.getNextSibling(H)}assertExists(_),asyncSetVRange(_,{index:y,length:0})}function handleMultiBlockIndent(k,_){if(!_.length)return;let y=-1,w=null;for(let B=0;B<_.length;B++)if(w=k.getPreviousSibling(_[B]),w&&supportsChildren(w)){y=B;break}if(y===-1)return;k.captureSync();const $=_.slice(y);$.forEach(B=>{const R=k.getParent(B);if(assertExists(R),!$.includes(R)){if(w=k.getPreviousSibling(B),!w||!supportsChildren(w))return;const H=R.children.filter(j=>j.id!==B.id);k.updateBlock(R,{children:H}),k.updateBlock(w,{children:[...w.children,B]}),asyncSetVRange(B,{index:0,length:0})}})}function handleUnindent(k,_,y=0,w=!0){const $=k.getParent(_);if(!$||matchFlavours($,["affine:note"]))return;const B=k.getParent($);if(!B)return;w&&k.captureSync();const R=k.getPreviousSiblings(_),H=k.getNextSiblings(_);k.updateBlock($,{children:R});const j=B.children.indexOf($);k.updateBlock(B,{children:[...B.children.slice(0,j+1),_,...B.children.slice(j+1)]}),k.updateBlock(_,{children:[..._.children,...H]});const q=k.getNextSibling(_);if(matchFlavours(_,["affine:list"])&&_.type==="numbered"){let X=q;for(;X&&matchFlavours(X,["affine:list"])&&_.type==="numbered";)k.updateBlock(X,{}),X=k.getNextSibling(X)}assertExists(_),asyncSetVRange(_,{index:y,length:0})}function handleMultiBlockUnindent(k,_){if(!_.length)return;let y=-1,w;for(let B=0;B<_.length;B++)if(w=k.getParent(_[B]),w&&!matchFlavours(w,["affine:note"])){y=B;break}const $=_.slice(y);for(let B=$.length-1;B>=0;B--){const R=$[B],H=k.getParent(R);assertExists(H),$.includes(H)||handleUnindent(k,R)}}function handleCodeBlockForwardDelete(k,_){return!!matchFlavours(_,["affine:code"])}function handleDatabaseBlockBackspace(k,_){return!!isInsideBlockByFlavour(k,_,"affine:database")}function handleDatabaseBlockForwardDelete(k,_){return!!isInsideBlockByFlavour(k,_,"affine:database")}function handleListBlockBackspace(k,_){if(!matchFlavours(_,["affine:list"]))return!1;const y=k.getParent(_);if(!y)return!1;const w=y.children.indexOf(_),$={type:"text",text:_.text?.clone(),children:_.children};k.captureSync(),k.deleteBlock(_);const B=k.addBlock("affine:paragraph",$,y,w);return asyncFocusRichText(k,B),!0}function handleListBlockForwardDelete(k,_){if(!matchFlavours(_,["affine:list"]))return!1;const y=_.firstChild();if(y){_.text?.join(y.text);const w=y.children;return w?(k.moveBlocks(w,_),k.deleteBlock(y),!0):(k.deleteBlock(y),!0)}else{const w=k.getNextSibling(_);if(w)if(_.text?.join(w.text),w.children){const $=k.getParent(w);return $?(k.moveBlocks(w.children,$,_,!1),k.deleteBlock(w),!0):!1}else return k.deleteBlock(w),!0;else{const $=getNextBlock$1(_);if(!$)return!0;if(_.text?.join($.text),$.children){const B=k.getParent($);return B?(k.moveBlocks($.children,B,k.getParent(_),!1),k.deleteBlock($),!0):!1}else return k.deleteBlock($),!0}}}function handleParagraphOrListSibling(k,_,y,w){if(!matchFlavours(y,["affine:paragraph","affine:list"]))return!1;k.captureSync();const $=y.text?.length||0;return _.text?.length&&y.text?.join(_.text),k.deleteBlock(_,{bringChildrenTo:w}),getVirgoByModel(y)?.setVRange({index:$,length:0}),!0}function handleEmbedDividerCodeSibling(k,_,y){return matchFlavours(y,["affine:image","affine:divider","affine:code","affine:bookmark","affine:attachment"])?(focusBlockByModel(y),_.text?.length||(k.captureSync(),k.deleteBlock(_)),!0):!1}function handleNoPreviousSibling(k,_){const y=_.text,w=document.querySelector(".affine-doc-page-block-title");if(!w)return!1;const B=getModelByElement(w).title;k.captureSync();let R=0;return y&&(R=y.length,B.join(y)),k.getNextSibling(_)?k.deleteBlock(_):y?.clear(),focusTitle(k,B.length-R),!0}function handleParagraphDeleteActions(k,_){const y=k.getParent(_);if(!y)return!1;const w=getPreviousBlock(_);return w?matchFlavours(y,["affine:database"])?(k.deleteBlock(_),focusBlockByModel(w),!0):matchFlavours(y,["affine:note"])?handleParagraphOrListSibling(k,_,w,y)||handleEmbedDividerCodeSibling(k,_,w)||handleUnknownBlockBackspace(w):!1:handleNoPreviousSibling(k,_)}function handleParagraphBlockBackspace(k,_){return matchFlavours(_,["affine:paragraph"])?_.type!=="text"?(k.captureSync(),k.updateBlock(_,{type:"text"}),!0):(handleParagraphDeleteActions(k,_)||handleUnindent(k,_),!0):!1}function handleParagraphBlockForwardDelete(k,_){function y(H,j,q,X){function ee(oe,ie,ae){if(ae&&matchFlavours(ae,["affine:paragraph","affine:list"]))if(ie.text?.join(ae.text),ae.children){const re=oe.getParent(ae);return re?(oe.moveBlocks(ae.children,re,ie,!1),oe.deleteBlock(ae),!0):!1}else return oe.deleteBlock(ae),!0;else{const re=getNextBlock$1(ie);if(!re||!matchFlavours(re,["affine:paragraph","affine:list"]))return!1;if(ie.text?.join(re.text),re.children){const se=oe.getParent(re);return se?(oe.moveBlocks(re.children,se,oe.getParent(ie),!1),oe.deleteBlock(re),!0):!1}else return oe.deleteBlock(re),!0}}function te(oe,ie,ae){if(!ae||!matchFlavours(ae,["affine:paragraph","affine:list"]))return!1;const re=ae.children;return ie.text?.join(ae.text),re&&oe.moveBlocks(re,ie),oe.deleteBlock(ae),!0}const ne=getNextBlock$1(j);return!X&&!ne?!0:te(H,j,X)||ee(H,j,q)}function w(H,j){function q(ee){return!ee||!matchFlavours(ee,["affine:image","affine:divider","affine:code"])?!1:(focusBlockByModel(ee),!0)}function X(ee){return!ee||!matchFlavours(ee,["affine:image","affine:divider","affine:code"])?!1:(focusBlockByModel(ee),!0)}return q(j)||X(H)}if(!matchFlavours(_,["affine:paragraph"]))return!1;const $=k.getParent(_);if(!$)return!1;const B=k.getNextSibling(_),R=_.firstChild();return matchFlavours($,["affine:database"])?!1:y(k,_,B,R)||w(B,R)}function handleUnknownBlockBackspace(k){throw new Error("Failed to handle backspace! Unknown block flavours! flavour:"+k.flavour)}function handleUnknownBlockForwardDelete(k){throw new Error("Failed to handle forwarddelete! Unknown block flavours! flavour:"+k.flavour)}function handleLineStartBackspace(k,_){if(handleListBlockBackspace(k,_)||handleParagraphBlockBackspace(k,_)){handleDatabaseBlockBackspace(k,_);return}handleUnknownBlockBackspace(_)}function handleLineEndForwardDelete(k,_){if(handleCodeBlockForwardDelete(k,_)||handleListBlockForwardDelete(k,_)||handleParagraphBlockForwardDelete(k,_)){handleDatabaseBlockForwardDelete(k,_);return}handleUnknownBlockForwardDelete(_)}const services=new Map;function registerService(k,_){if(services.has(k))return;const y=new _;services.set(k,y)}function getService$1(k){const _=services.get(k);if(!_)throw new Error(`cannot find service by flavour ${k}`);return _}async function json2block(k,_,y){const{convertToPastedIfEmpty:w=!1,textRangePoint:$}=y??{};assertExists($);const{page:B}=k,R=_[0],H=_[_.length-1],j=!k.text?.length&&!w,q=!j&&R.text&&k.text,X=k.text&&H.text,ee=B.getParent(k);if(assertExists(ee),_.length===1){const ie=R?.text?.reduce((re,se)=>re+(se.insert?.length||0),0)??0;if(k.text?.length!==$.index+$.length&&await handleBlockSplit(B,k,$.index,0),q)k.text?.insertList(R.text||[],$.index||0),await addSerializedBlocks(B,R.children||[],k,0),await setRange(k,{index:($.index??0)+ie,length:0});else{const[re]=await addSerializedBlocks(B,_,ee,ee.children.indexOf(k)+1),se=B.getBlockById(re);assertExists(se),se.text&&await setRange(se,{index:ie,length:0})}j&&B.deleteBlock(k);return}await handleBlockSplit(B,k,$.index,0),q&&(k.text?.insertList(R.text||[],$.index||0),await addSerializedBlocks(B,R.children||[],k,0));const te=ee.children.indexOf(k)+(q?1:0),ne=await addSerializedBlocks(B,_.slice(q?1:0),ee,te);j&&B.deleteBlock(k);const oe=B.getBlockById(ne[ne.length-1]);if(assertExists(oe),X){const ie=oe.text?.length||0,ae=B.getNextSibling(oe);oe.text?.join(ae?.text),assertExists(ae),B.deleteBlock(ae),requestAnimationFrame(()=>{setRange(oe,{index:ie,length:0})})}else oe?.text?setRange(oe,{index:oe.text.length,length:0}):requestAnimationFrame(()=>{focusBlockByModel(oe)})}async function setRange(k,_){const y=await asyncGetVirgoByModel(k);y&&(y.setVRange(_),y.syncVRange())}async function addSerializedBlocks(k,_,y,w){const $=[],B=[];for(let R=0;R<_.length;R++){const H=_[R],j=H.flavour,{children:q,text:X,rawText:ee,databaseProps:te,xywh:ne,...oe}=H,ie={...oe,title:H.databaseProps?.title||H.title};let ae;try{k.schema.validate(j,y.flavour),j==="affine:database"?ae=k.addBlock(j,{...ie,views:te?.views},y,w+R):ae=k.addBlock(j,ie,y,w+R)}catch{ae=k.addBlock("affine:paragraph",{type:"text"},y,w+R)}$.push(ae);const re=k.getBlockById(ae);assertExists(re);const se=re?.flavour&&k.getInitialPropsByFlavour(re?.flavour);se&&se.text instanceof Text$1&&H.text&&re?.text?.applyDelta(H.text),re&&H.children.length&&(await addSerializedBlocks(k,H.children,re,0),B.push({model:re,json:H}))}for(const{model:R,json:H}of B){const j=R.flavour;getService$1(j).onBlockPasted(R,{views:H.databaseProps?.views,rowIds:H.databaseProps?.rowIds,cells:H.databaseProps?.cells,columns:H.databaseProps?.columns})}return $}const isTemplateResult=(k,_)=>_===void 0?k?._$litType$!==void 0:k?._$litType$===_;class BaseService{templateResult2String(_){const y=[..._.values,""].map(w=>isTemplateResult(w)?this.templateResult2String(w):w);return _.strings.reduce((w,$,B)=>w+$+y[B],"")}async block2html(_,{childText:y="",begin:w,end:$}={},B){return`${(_.text?.sliceToDelta(w||0,$)||[]).reduce((j,q)=>j+BaseService.deltaLeaf2Html(_,q),"")}${y}`}block2Text(_,{childText:y="",begin:w=0,end:$}={}){return`${(_.text?.toString()||"").slice(w,$)}${y}`}block2Json(_,y,w,$){const B=_.text?.sliceToDelta(w??0,$)??[];return{flavour:_.flavour,type:_.type,text:B,children:y??_.children.map((R,H,j)=>H===j.length-1?getService(R.flavour).block2Json(R,0,$):getService(R.flavour).block2Json(R))}}async json2Block(_,y,w){return json2block(_,y,{textRangePoint:w})}async onBlockPasted(_,y){}static deltaLeaf2Html(_,y){let w=y.insert??"";w=w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");const $=y.attributes;if(!$)return w;if($.code&&(w=`<code>${w}</code>`),$.bold&&(w=`<strong>${w}</strong>`),$.italic&&(w=`<em>${w}</em>`),$.underline&&(w=`<u>${w}</u>`),$.strikethrough&&(w=`<s>${w}</s>`),$.link&&(w=`<a href="${$.link}">${w}</a>`),$.reference){const B=$.reference.pageId,R=_.page.workspace,H=R.meta.pageMetas.find(ee=>ee.id===B),q=`${window.location.origin}/workspace/${R.id}/${B}`,X=H?H.title:"Deleted page";w=`<a href="${q}">${X}</a>`}return w}async getBlobType(_){if(_.type)return _.type;const y=await __vitePreload(()=>import("./browser.74188053.js").then(B=>B.b),["static/browser.74188053.js","static/_commonjsHelpers.de833af9.js"]);window.Buffer===void 0&&(window.Buffer=buffer.Buffer);const w=await _.arrayBuffer();return(await y.fromBuffer(w))?.mime??"image/png"}}class AttachmentBlockService extends BaseService{async block2html(_){return`<p>Attachment-${_.name}</p>`}block2Text(_){return`Attachment-${_.name}`}block2Json(_){const y=cloneAttachmentProperties(_);return{flavour:_.flavour,children:[],...y}}}const DefaultBanner=x$1`<svg
  width="140"
  height="96"
  viewBox="0 0 140 96"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <g clip-path="url(#clip0_3433_80247)">
    <g opacity="0.4">
      <g clip-path="url(#clip1_3433_80247)">
        <g clip-path="url(#clip2_3433_80247)">
          <g opacity="0.8" filter="url(#filter0_f_3433_80247)">
            <ellipse
              cx="45.5713"
              cy="61.2938"
              rx="45.5713"
              ry="61.2938"
              transform="matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)"
              fill="#5076FF"
            />
          </g>
          <g opacity="0.8" filter="url(#filter1_f_3433_80247)">
            <ellipse
              cx="49.6555"
              cy="50.1114"
              rx="49.6555"
              ry="50.1114"
              transform="matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)"
              fill="#77FFCE"
            />
          </g>
          <g opacity="0.8" filter="url(#filter2_f_3433_80247)">
            <path
              d="M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z"
              fill="#35B7E0"
            />
          </g>
          <path
            d="M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z"
            fill="url(#paint0_linear_3433_80247)"
          />
          <path
            d="M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z"
            fill="url(#paint1_linear_3433_80247)"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z"
            fill="white"
            fill-opacity="0.8"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z"
            fill="white"
            fill-opacity="0.8"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z"
            fill="white"
            fill-opacity="0.8"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z"
            fill="white"
            fill-opacity="0.8"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M15.2358 72.0344C15.3511 71.214 16.1096 70.6424 16.93 70.7577L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1322C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0344Z"
            fill="white"
            fill-opacity="0.4"
          />
        </g>
      </g>
    </g>
  </g>
  <defs>
    <filter
      id="filter0_f_3433_80247"
      x="-14.1589"
      y="-38.4709"
      width="172.444"
      height="136.638"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="12"
        result="effect1_foregroundBlur_3433_80247"
      />
    </filter>
    <filter
      id="filter1_f_3433_80247"
      x="-45.8333"
      y="-40.3932"
      width="155.805"
      height="139.072"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="12"
        result="effect1_foregroundBlur_3433_80247"
      />
    </filter>
    <filter
      id="filter2_f_3433_80247"
      x="8.68726"
      y="-25.6425"
      width="166.468"
      height="142.859"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="BackgroundImageFix"
        result="shape"
      />
      <feGaussianBlur
        stdDeviation="12"
        result="effect1_foregroundBlur_3433_80247"
      />
    </filter>
    <linearGradient
      id="paint0_linear_3433_80247"
      x1="102.492"
      y1="40.3698"
      x2="96.2289"
      y2="84.9319"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_3433_80247"
      x1="102.492"
      y1="40.3698"
      x2="96.2289"
      y2="84.9319"
      gradientUnits="userSpaceOnUse"
    >
      <stop offset="0.578125" stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <clipPath id="clip0_3433_80247">
      <rect width="140" height="96" fill="white" />
    </clipPath>
    <clipPath id="clip1_3433_80247">
      <rect
        x="11.7563"
        y="3.38196"
        width="130"
        height="88"
        rx="4"
        transform="rotate(8 11.7563 3.38196)"
        fill="white"
      />
    </clipPath>
    <clipPath id="clip2_3433_80247">
      <rect
        width="130"
        height="88"
        fill="white"
        transform="translate(11.7563 3.38196) rotate(8)"
      />
    </clipPath>
  </defs>
</svg>`,defaultBookmarkProps={url:"",bookmarkTitle:"",description:"",icon:"",image:"",caption:"",crawled:!1},BookmarkBlockSchema=defineBlockSchema({flavour:"affine:bookmark",props:()=>defaultBookmarkProps,metadata:{version:1,role:"content",parent:["affine:note"]}});async function reloadBookmarkBlock(k,_,y=!1){if(window?.apis?.ui?.getBookmarkDataByLink){if((k.crawled||!k.url)&&!y)return;_.loading=!0;const w=await window.apis.ui.getBookmarkDataByLink(k.url);if(!k.page.getBlockById(k.id))return;const{title:$,description:B,icon:R,image:H}=w;k.page.withoutTransact(()=>{k.page.updateBlock(k,{bookmarkTitle:$,description:B,icon:R,image:H,url:k.url,crawled:!0})}),_.loading=!1}}function cloneBookmarkProperties(k){return Object.keys(defaultBookmarkProps).reduce((_,y)=>(_[y]=k[y],_),{})}class BookmarkBlockService extends BaseService{async block2html(_){const y=_.icon?`<img class="bookmark-icon" alt="icon" src="${_.icon}">`:this.templateResult2String(WebIcon16),w=_.caption?`<figcaption class="affine-bookmark-caption">${_.caption}</figcaption>`:"",$=_.image?`<img class="bookmark-image" alt="image" src="${_.image}">`:this.templateResult2String(DefaultBanner);return`
  <figure class="affine-bookmark-block-container">
    <a href="${_.url}" class="affine-bookmark-link bookmark source">
      <div class="affine-bookmark-content-wrapper">
        <div class="affine-bookmark-title">
          <div class="affine-bookmark-icon">
            ${y}
          </div>
          <div class="affine-bookmark-title-content bookmark-title">${_.bookmarkTitle||"Bookmark"}</div>
        </div>
        <div class="affine-bookmark-description bookmark-description">${_.description||_.url}</div>
        <div class="affine-bookmark-url">${_.url}</div>
      </div>
      <div class="affine-bookmark-banner">
        ${$}
      </div>
    </a>
    ${w}
  </figure>
`}block2Text(_){return _.url}block2Json(_){const y=cloneBookmarkProperties(_);return{flavour:_.flavour,children:[],...y}}}var main$1={exports:{}};(function(k,_){(function(y,w){k.exports=w()})(commonjsGlobal,()=>{return y={770:function($,B,R){var H=this&&this.__importDefault||function(ae){return ae&&ae.__esModule?ae:{default:ae}};Object.defineProperty(B,"__esModule",{value:!0}),B.setDefaultDebugCall=B.createOnigScanner=B.createOnigString=B.loadWASM=B.OnigScanner=B.OnigString=void 0;const j=H(R(418));let q=null,X=!1;class ee{static _utf8ByteLength(re){let se=0;for(let le=0,ue=re.length;le<ue;le++){const he=re.charCodeAt(le);let ce=he,ge=!1;if(he>=55296&&he<=56319&&le+1<ue){const be=re.charCodeAt(le+1);be>=56320&&be<=57343&&(ce=65536+(he-55296<<10)|be-56320,ge=!0)}se+=ce<=127?1:ce<=2047?2:ce<=65535?3:4,ge&&le++}return se}constructor(re){const se=re.length,le=ee._utf8ByteLength(re),ue=le!==se,he=ue?new Uint32Array(se+1):null;ue&&(he[se]=le);const ce=ue?new Uint32Array(le+1):null;ue&&(ce[le]=se);const ge=new Uint8Array(le);let be=0;for(let fe=0;fe<se;fe++){const we=re.charCodeAt(fe);let Ce=we,ve=!1;if(we>=55296&&we<=56319&&fe+1<se){const ke=re.charCodeAt(fe+1);ke>=56320&&ke<=57343&&(Ce=65536+(we-55296<<10)|ke-56320,ve=!0)}ue&&(he[fe]=be,ve&&(he[fe+1]=be),Ce<=127?ce[be+0]=fe:Ce<=2047?(ce[be+0]=fe,ce[be+1]=fe):Ce<=65535?(ce[be+0]=fe,ce[be+1]=fe,ce[be+2]=fe):(ce[be+0]=fe,ce[be+1]=fe,ce[be+2]=fe,ce[be+3]=fe)),Ce<=127?ge[be++]=Ce:Ce<=2047?(ge[be++]=192|(1984&Ce)>>>6,ge[be++]=128|(63&Ce)>>>0):Ce<=65535?(ge[be++]=224|(61440&Ce)>>>12,ge[be++]=128|(4032&Ce)>>>6,ge[be++]=128|(63&Ce)>>>0):(ge[be++]=240|(1835008&Ce)>>>18,ge[be++]=128|(258048&Ce)>>>12,ge[be++]=128|(4032&Ce)>>>6,ge[be++]=128|(63&Ce)>>>0),ve&&fe++}this.utf16Length=se,this.utf8Length=le,this.utf16Value=re,this.utf8Value=ge,this.utf16OffsetToUtf8=he,this.utf8OffsetToUtf16=ce}createString(re){const se=re._omalloc(this.utf8Length);return re.HEAPU8.set(this.utf8Value,se),se}}class te{constructor(re){if(this.id=++te.LAST_ID,!q)throw new Error("Must invoke loadWASM first.");this._onigBinding=q,this.content=re;const se=new ee(re);this.utf16Length=se.utf16Length,this.utf8Length=se.utf8Length,this.utf16OffsetToUtf8=se.utf16OffsetToUtf8,this.utf8OffsetToUtf16=se.utf8OffsetToUtf16,this.utf8Length<1e4&&!te._sharedPtrInUse?(te._sharedPtr||(te._sharedPtr=q._omalloc(1e4)),te._sharedPtrInUse=!0,q.HEAPU8.set(se.utf8Value,te._sharedPtr),this.ptr=te._sharedPtr):this.ptr=se.createString(q)}convertUtf8OffsetToUtf16(re){return this.utf8OffsetToUtf16?re<0?0:re>this.utf8Length?this.utf16Length:this.utf8OffsetToUtf16[re]:re}convertUtf16OffsetToUtf8(re){return this.utf16OffsetToUtf8?re<0?0:re>this.utf16Length?this.utf8Length:this.utf16OffsetToUtf8[re]:re}dispose(){this.ptr===te._sharedPtr?te._sharedPtrInUse=!1:this._onigBinding._ofree(this.ptr)}}B.OnigString=te,te.LAST_ID=0,te._sharedPtr=0,te._sharedPtrInUse=!1;class ne{constructor(re){if(!q)throw new Error("Must invoke loadWASM first.");const se=[],le=[];for(let ge=0,be=re.length;ge<be;ge++){const fe=new ee(re[ge]);se[ge]=fe.createString(q),le[ge]=fe.utf8Length}const ue=q._omalloc(4*re.length);q.HEAPU32.set(se,ue/4);const he=q._omalloc(4*re.length);q.HEAPU32.set(le,he/4);const ce=q._createOnigScanner(ue,he,re.length);for(let ge=0,be=re.length;ge<be;ge++)q._ofree(se[ge]);q._ofree(he),q._ofree(ue),ce===0&&function(ge){throw new Error(ge.UTF8ToString(ge._getLastOnigError()))}(q),this._onigBinding=q,this._ptr=ce}dispose(){this._onigBinding._freeOnigScanner(this._ptr)}findNextMatchSync(re,se,le){let ue=X,he=0;if(typeof le=="number"?(8&le&&(ue=!0),he=le):typeof le=="boolean"&&(ue=le),typeof re=="string"){re=new te(re);const ce=this._findNextMatchSync(re,se,ue,he);return re.dispose(),ce}return this._findNextMatchSync(re,se,ue,he)}_findNextMatchSync(re,se,le,ue){const he=this._onigBinding;let ce;if(ce=le?he._findNextOnigScannerMatchDbg(this._ptr,re.id,re.ptr,re.utf8Length,re.convertUtf16OffsetToUtf8(se),ue):he._findNextOnigScannerMatch(this._ptr,re.id,re.ptr,re.utf8Length,re.convertUtf16OffsetToUtf8(se),ue),ce===0)return null;const ge=he.HEAPU32;let be=ce/4;const fe=ge[be++],we=ge[be++];let Ce=[];for(let ve=0;ve<we;ve++){const ke=re.convertUtf8OffsetToUtf16(ge[be++]),me=re.convertUtf8OffsetToUtf16(ge[be++]);Ce[ve]={start:ke,end:me,length:me-ke}}return{index:fe,captureIndices:Ce}}}B.OnigScanner=ne;let oe=!1,ie=null;B.loadWASM=function(ae){if(oe)return ie;let re,se,le,ue;if(oe=!0,function(he){return typeof he.instantiator=="function"}(ae))re=ae.instantiator,se=ae.print;else{let he;(function(ce){return ce.data!==void 0})(ae)?(he=ae.data,se=ae.print):he=ae,re=function(ce){return typeof Response<"u"&&ce instanceof Response}(he)?typeof WebAssembly.instantiateStreaming=="function"?function(ce){return ge=>WebAssembly.instantiateStreaming(ce,ge)}(he):function(ce){return async ge=>{const be=await ce.arrayBuffer();return WebAssembly.instantiate(be,ge)}}(he):function(ce){return ge=>WebAssembly.instantiate(ce,ge)}(he)}return ie=new Promise((he,ce)=>{le=he,ue=ce}),function(he,ce,ge,be){(0,j.default)({print:ce,instantiateWasm:(fe,we)=>{if(typeof performance>"u"){const Ce=()=>Date.now();fe.env.emscripten_get_now=Ce,fe.wasi_snapshot_preview1.emscripten_get_now=Ce}return he(fe).then(Ce=>we(Ce.instance),be),{}}}).then(fe=>{q=fe,ge()})}(re,se,le,ue),ie},B.createOnigString=function(ae){return new te(ae)},B.createOnigScanner=function(ae){return new ne(ae)},B.setDefaultDebugCall=function(ae){X=ae}},418:$=>{var B=(typeof document<"u"&&document.currentScript&&document.currentScript.src,function(R){var H,j,q=(R=R||{})!==void 0?R:{};q.ready=new Promise(function(Oe,Ye){H=Oe,j=Ye});var X,ee=Object.assign({},q),te=!1,ne="";function oe(Oe){return q.locateFile?q.locateFile(Oe,ne):ne+Oe}X=function(Oe){let Ye;return typeof readbuffer=="function"?new Uint8Array(readbuffer(Oe)):(Ye=read(Oe,"binary"),ue(typeof Ye=="object"),Ye)},typeof scriptArgs<"u"&&scriptArgs,typeof onig_print<"u"&&(typeof console>"u"&&(console={}),console.log=onig_print,console.warn=console.error=typeof printErr<"u"?printErr:onig_print);var ie,ae,re=q.print||console.log.bind(console),se=q.printErr||console.warn.bind(console);Object.assign(q,ee),ee=null,q.arguments&&q.arguments,q.thisProgram&&q.thisProgram,q.quit&&q.quit,q.wasmBinary&&(ie=q.wasmBinary),q.noExitRuntime,typeof WebAssembly!="object"&&Ue("no native wasm support detected");var le=!1;function ue(Oe,Ye){Oe||Ue(Ye)}var he,ce,ge,be=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function fe(Oe,Ye,Je){for(var rt=Ye+Je,xe=Ye;Oe[xe]&&!(xe>=rt);)++xe;if(xe-Ye>16&&Oe.buffer&&be)return be.decode(Oe.subarray(Ye,xe));for(var de="";Ye<xe;){var pe=Oe[Ye++];if(128&pe){var Se=63&Oe[Ye++];if((224&pe)!=192){var Le=63&Oe[Ye++];if((pe=(240&pe)==224?(15&pe)<<12|Se<<6|Le:(7&pe)<<18|Se<<12|Le<<6|63&Oe[Ye++])<65536)de+=String.fromCharCode(pe);else{var ye=pe-65536;de+=String.fromCharCode(55296|ye>>10,56320|1023&ye)}}else de+=String.fromCharCode((31&pe)<<6|Se)}else de+=String.fromCharCode(pe)}return de}function we(Oe,Ye){return Oe?fe(ce,Oe,Ye):""}function Ce(Oe){he=Oe,q.HEAP8=new Int8Array(Oe),q.HEAP16=new Int16Array(Oe),q.HEAP32=new Int32Array(Oe),q.HEAPU8=ce=new Uint8Array(Oe),q.HEAPU16=new Uint16Array(Oe),q.HEAPU32=ge=new Uint32Array(Oe),q.HEAPF32=new Float32Array(Oe),q.HEAPF64=new Float64Array(Oe)}q.INITIAL_MEMORY;var ve=[],ke=[],me=[];function Ie(){if(q.preRun)for(typeof q.preRun=="function"&&(q.preRun=[q.preRun]);q.preRun.length;)Ze(q.preRun.shift());lt(ve)}function Fe(){lt(ke)}function Be(){if(q.postRun)for(typeof q.postRun=="function"&&(q.postRun=[q.postRun]);q.postRun.length;)qe(q.postRun.shift());lt(me)}function Ze(Oe){ve.unshift(Oe)}function Re(Oe){ke.unshift(Oe)}function qe(Oe){me.unshift(Oe)}var Me=0,Pe=null;function Qe(Oe){Me++,q.monitorRunDependencies&&q.monitorRunDependencies(Me)}function je(Oe){if(Me--,q.monitorRunDependencies&&q.monitorRunDependencies(Me),Me==0&&Pe){var Ye=Pe;Pe=null,Ye()}}function Ue(Oe){q.onAbort&&q.onAbort(Oe),se(Oe="Aborted("+Oe+")"),le=!0,Oe+=". Build with -sASSERTIONS for more info.";var Ye=new WebAssembly.RuntimeError(Oe);throw j(Ye),Ye}var tt,Ve,nt="data:application/octet-stream;base64,";function et(Oe){return Oe.startsWith(nt)}function st(Oe){try{if(Oe==tt&&ie)return new Uint8Array(ie);if(X)return X(Oe);throw"both async and sync fetching of the wasm failed"}catch(Ye){Ue(Ye)}}function at(){return ie||!te||typeof fetch!="function"?Promise.resolve().then(function(){return st(tt)}):fetch(tt,{credentials:"same-origin"}).then(function(Oe){if(!Oe.ok)throw"failed to load wasm binary file at '"+tt+"'";return Oe.arrayBuffer()}).catch(function(){return st(tt)})}function ct(){var Oe={env:Ke,wasi_snapshot_preview1:Ke};function Ye(xe,de){var pe=xe.exports;q.asm=pe,Ce((ae=q.asm.memory).buffer),q.asm.__indirect_function_table,Re(q.asm.__wasm_call_ctors),je()}function Je(xe){Ye(xe.instance)}function rt(xe){return at().then(function(de){return WebAssembly.instantiate(de,Oe)}).then(function(de){return de}).then(xe,function(de){se("failed to asynchronously prepare wasm: "+de),Ue(de)})}if(Qe(),q.instantiateWasm)try{return q.instantiateWasm(Oe,Ye)}catch(xe){se("Module.instantiateWasm callback failed with error: "+xe),j(xe)}return(ie||typeof WebAssembly.instantiateStreaming!="function"||et(tt)||typeof fetch!="function"?rt(Je):fetch(tt,{credentials:"same-origin"}).then(function(xe){return WebAssembly.instantiateStreaming(xe,Oe).then(Je,function(de){return se("wasm streaming compile failed: "+de),se("falling back to ArrayBuffer instantiation"),rt(Je)})})).catch(j),{}}function lt(Oe){for(;Oe.length>0;)Oe.shift()(q)}function _e(Oe,Ye,Je){ce.copyWithin(Oe,Ye,Ye+Je)}function We(Oe){try{return ae.grow(Oe-he.byteLength+65535>>>16),Ce(ae.buffer),1}catch{}}function Ne(Oe){var Ye,Je=ce.length,rt=2147483648;if((Oe>>>=0)>rt)return!1;for(var xe=1;xe<=4;xe*=2){var de=Je*(1+.2/xe);if(de=Math.min(de,Oe+100663296),We(Math.min(rt,(Ye=Math.max(Oe,de))+(65536-Ye%65536)%65536)))return!0}return!1}et(tt="onig.wasm")||(tt=oe(tt)),Ve=typeof dateNow<"u"?dateNow:()=>performance.now();var $e=[null,[],[]];function Te(Oe,Ye){var Je=$e[Oe];Ye===0||Ye===10?((Oe===1?re:se)(fe(Je,0)),Je.length=0):Je.push(Ye)}function De(Oe,Ye,Je,rt){for(var xe=0,de=0;de<Je;de++){var pe=ge[Ye>>2],Se=ge[Ye+4>>2];Ye+=8;for(var Le=0;Le<Se;Le++)Te(Oe,ce[pe+Le]);xe+=Se}return ge[rt>>2]=xe,0}var Ge,Ke={emscripten_get_now:Ve,emscripten_memcpy_big:_e,emscripten_resize_heap:Ne,fd_write:De};function Ae(Oe){function Ye(){Ge||(Ge=!0,q.calledRun=!0,le||(Fe(),H(q),q.onRuntimeInitialized&&q.onRuntimeInitialized(),Be()))}Me>0||(Ie(),Me>0||(q.setStatus?(q.setStatus("Running..."),setTimeout(function(){setTimeout(function(){q.setStatus("")},1),Ye()},1)):Ye()))}if(ct(),q.___wasm_call_ctors=function(){return(q.___wasm_call_ctors=q.asm.__wasm_call_ctors).apply(null,arguments)},q.___errno_location=function(){return(q.___errno_location=q.asm.__errno_location).apply(null,arguments)},q._omalloc=function(){return(q._omalloc=q.asm.omalloc).apply(null,arguments)},q._ofree=function(){return(q._ofree=q.asm.ofree).apply(null,arguments)},q._getLastOnigError=function(){return(q._getLastOnigError=q.asm.getLastOnigError).apply(null,arguments)},q._createOnigScanner=function(){return(q._createOnigScanner=q.asm.createOnigScanner).apply(null,arguments)},q._freeOnigScanner=function(){return(q._freeOnigScanner=q.asm.freeOnigScanner).apply(null,arguments)},q._findNextOnigScannerMatch=function(){return(q._findNextOnigScannerMatch=q.asm.findNextOnigScannerMatch).apply(null,arguments)},q._findNextOnigScannerMatchDbg=function(){return(q._findNextOnigScannerMatchDbg=q.asm.findNextOnigScannerMatchDbg).apply(null,arguments)},q.stackSave=function(){return(q.stackSave=q.asm.stackSave).apply(null,arguments)},q.stackRestore=function(){return(q.stackRestore=q.asm.stackRestore).apply(null,arguments)},q.stackAlloc=function(){return(q.stackAlloc=q.asm.stackAlloc).apply(null,arguments)},q.dynCall_jiji=function(){return(q.dynCall_jiji=q.asm.dynCall_jiji).apply(null,arguments)},q.UTF8ToString=we,Pe=function Oe(){Ge||Ae(),Ge||(Pe=Oe)},q.preInit)for(typeof q.preInit=="function"&&(q.preInit=[q.preInit]);q.preInit.length>0;)q.preInit.pop()();return Ae(),R.ready});$.exports=B}},w={},function $(B){var R=w[B];if(R!==void 0)return R.exports;var H=w[B]={exports:{}};return y[B].call(H.exports,H,H.exports,$),H.exports}(770);var y,w})})(main$1);var mainExports$1=main$1.exports,main={exports:{}};(function(k,_){(function(y,w){k.exports=w()})(commonjsGlobal,function(){return(()=>{var y={350:($,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.UseOnigurumaFindOptions=B.DebugFlags=void 0,B.DebugFlags={InDebugMode:typeof process<"u"&&!!{}.VSCODE_TEXTMATE_DEBUG},B.UseOnigurumaFindOptions=!1},36:($,B)=>{var R;Object.defineProperty(B,"__esModule",{value:!0}),B.toOptionalTokenType=B.EncodedTokenAttributes=void 0,(R=B.EncodedTokenAttributes||(B.EncodedTokenAttributes={})).toBinaryStr=function(H){let j=H.toString(2);for(;j.length<32;)j="0"+j;return j},R.print=function(H){const j=R.getLanguageId(H),q=R.getTokenType(H),X=R.getFontStyle(H),ee=R.getForeground(H),te=R.getBackground(H);console.log({languageId:j,tokenType:q,fontStyle:X,foreground:ee,background:te})},R.getLanguageId=function(H){return(255&H)>>>0},R.getTokenType=function(H){return(768&H)>>>8},R.containsBalancedBrackets=function(H){return(1024&H)!=0},R.getFontStyle=function(H){return(30720&H)>>>11},R.getForeground=function(H){return(16744448&H)>>>15},R.getBackground=function(H){return(4278190080&H)>>>24},R.set=function(H,j,q,X,ee,te,ne){let oe=R.getLanguageId(H),ie=R.getTokenType(H),ae=R.containsBalancedBrackets(H)?1:0,re=R.getFontStyle(H),se=R.getForeground(H),le=R.getBackground(H);return j!==0&&(oe=j),q!==8&&(ie=q),X!==null&&(ae=X?1:0),ee!==-1&&(re=ee),te!==0&&(se=te),ne!==0&&(le=ne),(oe<<0|ie<<8|ae<<10|re<<11|se<<15|le<<24)>>>0},B.toOptionalTokenType=function(H){return H}},996:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.BasicScopeAttributesProvider=B.BasicScopeAttributes=void 0;const H=R(878);class j{constructor(te,ne){this.languageId=te,this.tokenType=ne}}B.BasicScopeAttributes=j;class q{constructor(te,ne){this._getBasicScopeAttributes=new H.CachedFn(oe=>{const ie=this._scopeToLanguage(oe),ae=this._toStandardTokenType(oe);return new j(ie,ae)}),this._defaultAttributes=new j(te,8),this._embeddedLanguagesMatcher=new X(Object.entries(ne||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(te){return te===null?q._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(te)}_scopeToLanguage(te){return this._embeddedLanguagesMatcher.match(te)||0}_toStandardTokenType(te){const ne=te.match(q.STANDARD_TOKEN_TYPE_REGEXP);if(!ne)return 8;switch(ne[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw new Error("Unexpected match for standard token type!")}}B.BasicScopeAttributesProvider=q,q._NULL_SCOPE_METADATA=new j(0,0),q.STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/;class X{constructor(te){if(te.length===0)this.values=null,this.scopesRegExp=null;else{this.values=new Map(te);const ne=te.map(([oe,ie])=>H.escapeRegExpCharacters(oe));ne.sort(),ne.reverse(),this.scopesRegExp=new RegExp(`^((${ne.join(")|(")}))($|\\.)`,"")}}match(te){if(!this.scopesRegExp)return;const ne=te.match(this.scopesRegExp);return ne?this.values.get(ne[1]):void 0}}},947:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.LineTokens=B.BalancedBracketSelectors=B.StateStack=B.AttributedScopeStack=B.Grammar=B.createGrammar=void 0;const H=R(350),j=R(36),q=R(736),X=R(44),ee=R(792),te=R(583),ne=R(878),oe=R(996),ie=R(47);function ae(be,fe,we,Ce,ve){const ke=q.createMatchers(fe,re),me=ee.RuleFactory.getCompiledRuleId(we,Ce,ve.repository);for(const Ie of ke)be.push({debugSelector:fe,matcher:Ie.matcher,ruleId:me,grammar:ve,priority:Ie.priority})}function re(be,fe){if(fe.length<be.length)return!1;let we=0;return be.every(Ce=>{for(let ve=we;ve<fe.length;ve++)if(se(fe[ve],Ce))return we=ve+1,!0;return!1})}function se(be,fe){if(!be)return!1;if(be===fe)return!0;const we=fe.length;return be.length>we&&be.substr(0,we)===fe&&be[we]==="."}B.createGrammar=function(be,fe,we,Ce,ve,ke,me,Ie){return new le(be,fe,we,Ce,ve,ke,me,Ie)};class le{constructor(fe,we,Ce,ve,ke,me,Ie,Fe){if(this._rootScopeName=fe,this.balancedBracketSelectors=me,this._onigLib=Fe,this._basicScopeAttributesProvider=new oe.BasicScopeAttributesProvider(Ce,ve),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=Ie,this._grammar=ue(we,null),this._injections=null,this._tokenTypeMatchers=[],ke)for(const Be of Object.keys(ke)){const Ze=q.createMatchers(Be,re);for(const Re of Ze)this._tokenTypeMatchers.push({matcher:Re.matcher,type:ke[Be]})}}get themeProvider(){return this._grammarRepository}dispose(){for(const fe of this._ruleId2desc)fe&&fe.dispose()}createOnigScanner(fe){return this._onigLib.createOnigScanner(fe)}createOnigString(fe){return this._onigLib.createOnigString(fe)}getMetadataForScope(fe){return this._basicScopeAttributesProvider.getBasicScopeAttributes(fe)}_collectInjections(){const fe=[],we=this._rootScopeName,Ce=(ve=>ve===this._rootScopeName?this._grammar:this.getExternalGrammar(ve))(we);if(Ce){const ve=Ce.injections;if(ve)for(let me in ve)ae(fe,me,ve[me],this,Ce);const ke=this._grammarRepository.injections(we);ke&&ke.forEach(me=>{const Ie=this.getExternalGrammar(me);if(Ie){const Fe=Ie.injectionSelector;Fe&&ae(fe,Fe,Ie,this,Ie)}})}return fe.sort((ve,ke)=>ve.priority-ke.priority),fe}getInjections(){if(this._injections===null&&(this._injections=this._collectInjections(),H.DebugFlags.InDebugMode&&this._injections.length>0)){console.log(`Grammar ${this._rootScopeName} contains the following injections:`);for(const fe of this._injections)console.log(`  - ${fe.debugSelector}`)}return this._injections}registerRule(fe){const we=++this._lastRuleId,Ce=fe(ee.ruleIdFromNumber(we));return this._ruleId2desc[we]=Ce,Ce}getRule(fe){return this._ruleId2desc[ee.ruleIdToNumber(fe)]}getExternalGrammar(fe,we){if(this._includedGrammars[fe])return this._includedGrammars[fe];if(this._grammarRepository){const Ce=this._grammarRepository.lookup(fe);if(Ce)return this._includedGrammars[fe]=ue(Ce,we&&we.$base),this._includedGrammars[fe]}}tokenizeLine(fe,we,Ce=0){const ve=this._tokenize(fe,we,!1,Ce);return{tokens:ve.lineTokens.getResult(ve.ruleStack,ve.lineLength),ruleStack:ve.ruleStack,stoppedEarly:ve.stoppedEarly}}tokenizeLine2(fe,we,Ce=0){const ve=this._tokenize(fe,we,!0,Ce);return{tokens:ve.lineTokens.getBinaryResult(ve.ruleStack,ve.lineLength),ruleStack:ve.ruleStack,stoppedEarly:ve.stoppedEarly}}_tokenize(fe,we,Ce,ve){let ke;if(this._rootId===-1&&(this._rootId=ee.RuleFactory.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository)),we&&we!==ce.NULL)ke=!1,we.reset();else{ke=!0;const Ze=this._basicScopeAttributesProvider.getDefaultAttributes(),Re=this.themeProvider.getDefaults(),qe=j.EncodedTokenAttributes.set(0,Ze.languageId,Ze.tokenType,null,Re.fontStyle,Re.foregroundId,Re.backgroundId),Me=this.getRule(this._rootId).getName(null,null);let Pe;Pe=Me?he.createRootAndLookUpScopeName(Me,qe,this):he.createRoot("unknown",qe),we=new ce(null,this._rootId,-1,-1,!1,null,Pe,Pe)}fe+=`
`;const me=this.createOnigString(fe),Ie=me.content.length,Fe=new ge(Ce,fe,this._tokenTypeMatchers,this.balancedBracketSelectors),Be=ie._tokenizeString(this,me,ke,0,we,Fe,!0,ve);return X.disposeOnigString(me),{lineLength:Ie,lineTokens:Fe,ruleStack:Be.stack,stoppedEarly:Be.stoppedEarly}}}function ue(be,fe){return(be=ne.clone(be)).repository=be.repository||{},be.repository.$self={$vscodeTextmateLocation:be.$vscodeTextmateLocation,patterns:be.patterns,name:be.scopeName},be.repository.$base=fe||be.repository.$self,be}B.Grammar=le;class he{constructor(fe,we,Ce){this.parent=fe,this.scopePath=we,this.tokenAttributes=Ce}static createRoot(fe,we){return new he(null,new te.ScopeStack(null,fe),we)}static createRootAndLookUpScopeName(fe,we,Ce){const ve=Ce.getMetadataForScope(fe),ke=new te.ScopeStack(null,fe),me=Ce.themeProvider.themeMatch(ke),Ie=he.mergeAttributes(we,ve,me);return new he(null,ke,Ie)}get scopeName(){return this.scopePath.scopeName}equals(fe){return he._equals(this,fe)}static _equals(fe,we){for(;;){if(fe===we||!fe&&!we)return!0;if(!fe||!we||fe.scopeName!==we.scopeName||fe.tokenAttributes!==we.tokenAttributes)return!1;fe=fe.parent,we=we.parent}}static mergeAttributes(fe,we,Ce){let ve=-1,ke=0,me=0;return Ce!==null&&(ve=Ce.fontStyle,ke=Ce.foregroundId,me=Ce.backgroundId),j.EncodedTokenAttributes.set(fe,we.languageId,we.tokenType,null,ve,ke,me)}pushAttributed(fe,we){if(fe===null)return this;if(fe.indexOf(" ")===-1)return he._pushAttributed(this,fe,we);const Ce=fe.split(/ /g);let ve=this;for(const ke of Ce)ve=he._pushAttributed(ve,ke,we);return ve}static _pushAttributed(fe,we,Ce){const ve=Ce.getMetadataForScope(we),ke=fe.scopePath.push(we),me=Ce.themeProvider.themeMatch(ke),Ie=he.mergeAttributes(fe.tokenAttributes,ve,me);return new he(fe,ke,Ie)}getScopeNames(){return this.scopePath.getSegments()}}B.AttributedScopeStack=he;class ce{constructor(fe,we,Ce,ve,ke,me,Ie,Fe){this.parent=fe,this.ruleId=we,this.beginRuleCapturedEOL=ke,this.endRule=me,this.nameScopesList=Ie,this.contentNameScopesList=Fe,this._stackElementBrand=void 0,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=Ce,this._anchorPos=ve}equals(fe){return fe!==null&&ce._equals(this,fe)}static _equals(fe,we){return fe===we||!!this._structuralEquals(fe,we)&&fe.contentNameScopesList.equals(we.contentNameScopesList)}static _structuralEquals(fe,we){for(;;){if(fe===we||!fe&&!we)return!0;if(!fe||!we||fe.depth!==we.depth||fe.ruleId!==we.ruleId||fe.endRule!==we.endRule)return!1;fe=fe.parent,we=we.parent}}clone(){return this}static _reset(fe){for(;fe;)fe._enterPos=-1,fe._anchorPos=-1,fe=fe.parent}reset(){ce._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(fe,we,Ce,ve,ke,me,Ie){return new ce(this,fe,we,Ce,ve,ke,me,Ie)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(fe){return fe.getRule(this.ruleId)}toString(){const fe=[];return this._writeString(fe,0),"["+fe.join(",")+"]"}_writeString(fe,we){return this.parent&&(we=this.parent._writeString(fe,we)),fe[we++]=`(${this.ruleId}, TODO-${this.nameScopesList}, TODO-${this.contentNameScopesList})`,we}withContentNameScopesList(fe){return this.contentNameScopesList===fe?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,fe)}withEndRule(fe){return this.endRule===fe?this:new ce(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,fe,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(fe){let we=this;for(;we&&we._enterPos===fe._enterPos;){if(we.ruleId===fe.ruleId)return!0;we=we.parent}return!1}}B.StateStack=ce,ce.NULL=new ce(null,0,0,0,!1,null,null,null),B.BalancedBracketSelectors=class{constructor(be,fe){this.allowAny=!1,this.balancedBracketScopes=be.flatMap(we=>we==="*"?(this.allowAny=!0,[]):q.createMatchers(we,re).map(Ce=>Ce.matcher)),this.unbalancedBracketScopes=fe.flatMap(we=>q.createMatchers(we,re).map(Ce=>Ce.matcher))}get matchesAlways(){return this.allowAny&&this.unbalancedBracketScopes.length===0}get matchesNever(){return this.balancedBracketScopes.length===0&&!this.allowAny}match(be){for(const fe of this.unbalancedBracketScopes)if(fe(be))return!1;for(const fe of this.balancedBracketScopes)if(fe(be))return!0;return this.allowAny}};class ge{constructor(fe,we,Ce,ve){this.balancedBracketSelectors=ve,this._emitBinaryTokens=fe,this._tokenTypeOverrides=Ce,H.DebugFlags.InDebugMode?this._lineText=we:this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}produce(fe,we){this.produceFromScopes(fe.contentNameScopesList,we)}produceFromScopes(fe,we){if(this._lastTokenEndIndex>=we)return;if(this._emitBinaryTokens){let ve=fe.tokenAttributes,ke=!1;if(this.balancedBracketSelectors?.matchesAlways&&(ke=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){const me=fe.getScopeNames();for(const Ie of this._tokenTypeOverrides)Ie.matcher(me)&&(ve=j.EncodedTokenAttributes.set(ve,0,j.toOptionalTokenType(Ie.type),null,-1,0,0));this.balancedBracketSelectors&&(ke=this.balancedBracketSelectors.match(me))}if(ke&&(ve=j.EncodedTokenAttributes.set(ve,0,8,ke,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===ve)return void(this._lastTokenEndIndex=we);if(H.DebugFlags.InDebugMode){const me=fe.getScopeNames();console.log("  token: |"+this._lineText.substring(this._lastTokenEndIndex,we).replace(/\n$/,"\\n")+"|");for(let Ie=0;Ie<me.length;Ie++)console.log("      * "+me[Ie])}return this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(ve),void(this._lastTokenEndIndex=we)}const Ce=fe.getScopeNames();if(H.DebugFlags.InDebugMode){console.log("  token: |"+this._lineText.substring(this._lastTokenEndIndex,we).replace(/\n$/,"\\n")+"|");for(let ve=0;ve<Ce.length;ve++)console.log("      * "+Ce[ve])}this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:we,scopes:Ce}),this._lastTokenEndIndex=we}getResult(fe,we){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===we-1&&this._tokens.pop(),this._tokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(fe,we),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(fe,we){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===we-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),this._binaryTokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(fe,we),this._binaryTokens[this._binaryTokens.length-2]=0);const Ce=new Uint32Array(this._binaryTokens.length);for(let ve=0,ke=this._binaryTokens.length;ve<ke;ve++)Ce[ve]=this._binaryTokens[ve];return Ce}}B.LineTokens=ge},965:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.parseInclude=B.TopLevelRepositoryReference=B.TopLevelReference=B.RelativeReference=B.SelfReference=B.BaseReference=B.ScopeDependencyProcessor=B.ExternalReferenceCollector=B.TopLevelRepositoryRuleReference=B.TopLevelRuleReference=void 0;const H=R(878);class j{constructor(ce){this.scopeName=ce}toKey(){return this.scopeName}}B.TopLevelRuleReference=j;class q{constructor(ce,ge){this.scopeName=ce,this.ruleName=ge}toKey(){return`${this.scopeName}#${this.ruleName}`}}B.TopLevelRepositoryRuleReference=q;class X{constructor(){this._references=[],this._seenReferenceKeys=new Set,this.visitedRule=new Set}get references(){return this._references}add(ce){const ge=ce.toKey();this._seenReferenceKeys.has(ge)||(this._seenReferenceKeys.add(ge),this._references.push(ce))}}function ee(he,ce,ge,be){const fe=ge.lookup(he.scopeName);if(!fe){if(he.scopeName===ce)throw new Error(`No grammar provided for <${ce}>`);return}const we=ge.lookup(ce);he instanceof j?ne({baseGrammar:we,selfGrammar:fe},be):te(he.ruleName,{baseGrammar:we,selfGrammar:fe,repository:fe.repository},be);const Ce=ge.injections(he.scopeName);if(Ce)for(const ve of Ce)be.add(new j(ve))}function te(he,ce,ge){ce.repository&&ce.repository[he]&&oe([ce.repository[he]],ce,ge)}function ne(he,ce){he.selfGrammar.patterns&&Array.isArray(he.selfGrammar.patterns)&&oe(he.selfGrammar.patterns,{...he,repository:he.selfGrammar.repository},ce),he.selfGrammar.injections&&oe(Object.values(he.selfGrammar.injections),{...he,repository:he.selfGrammar.repository},ce)}function oe(he,ce,ge){for(const be of he){if(ge.visitedRule.has(be))continue;ge.visitedRule.add(be);const fe=be.repository?H.mergeObjects({},ce.repository,be.repository):ce.repository;Array.isArray(be.patterns)&&oe(be.patterns,{...ce,repository:fe},ge);const we=be.include;if(!we)continue;const Ce=ue(we);switch(Ce.kind){case 0:ne({...ce,selfGrammar:ce.baseGrammar},ge);break;case 1:ne(ce,ge);break;case 2:te(Ce.ruleName,{...ce,repository:fe},ge);break;case 3:case 4:const ve=Ce.scopeName===ce.selfGrammar.scopeName?ce.selfGrammar:Ce.scopeName===ce.baseGrammar.scopeName?ce.baseGrammar:void 0;if(ve){const ke={baseGrammar:ce.baseGrammar,selfGrammar:ve,repository:fe};Ce.kind===4?te(Ce.ruleName,ke,ge):ne(ke,ge)}else Ce.kind===4?ge.add(new q(Ce.scopeName,Ce.ruleName)):ge.add(new j(Ce.scopeName))}}}B.ExternalReferenceCollector=X,B.ScopeDependencyProcessor=class{constructor(he,ce){this.repo=he,this.initialScopeName=ce,this.seenFullScopeRequests=new Set,this.seenPartialScopeRequests=new Set,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new j(this.initialScopeName)]}processQueue(){const he=this.Q;this.Q=[];const ce=new X;for(const ge of he)ee(ge,this.initialScopeName,this.repo,ce);for(const ge of ce.references)if(ge instanceof j){if(this.seenFullScopeRequests.has(ge.scopeName))continue;this.seenFullScopeRequests.add(ge.scopeName),this.Q.push(ge)}else{if(this.seenFullScopeRequests.has(ge.scopeName)||this.seenPartialScopeRequests.has(ge.toKey()))continue;this.seenPartialScopeRequests.add(ge.toKey()),this.Q.push(ge)}}};class ie{constructor(){this.kind=0}}B.BaseReference=ie;class ae{constructor(){this.kind=1}}B.SelfReference=ae;class re{constructor(ce){this.ruleName=ce,this.kind=2}}B.RelativeReference=re;class se{constructor(ce){this.scopeName=ce,this.kind=3}}B.TopLevelReference=se;class le{constructor(ce,ge){this.scopeName=ce,this.ruleName=ge,this.kind=4}}function ue(he){if(he==="$base")return new ie;if(he==="$self")return new ae;const ce=he.indexOf("#");if(ce===-1)return new se(he);if(ce===0)return new re(he.substring(1));{const ge=he.substring(0,ce),be=he.substring(ce+1);return new le(ge,be)}}B.TopLevelRepositoryReference=le,B.parseInclude=ue},391:function($,B,R){var H=this&&this.__createBinding||(Object.create?function(q,X,ee,te){te===void 0&&(te=ee),Object.defineProperty(q,te,{enumerable:!0,get:function(){return X[ee]}})}:function(q,X,ee,te){te===void 0&&(te=ee),q[te]=X[ee]}),j=this&&this.__exportStar||function(q,X){for(var ee in q)ee==="default"||Object.prototype.hasOwnProperty.call(X,ee)||H(X,q,ee)};Object.defineProperty(B,"__esModule",{value:!0}),j(R(947),B)},47:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.LocalStackElement=B._tokenizeString=void 0;const H=R(350),j=R(44),q=R(792),X=R(878);class ee{constructor(le,ue){this.stack=le,this.stoppedEarly=ue}}function te(se,le,ue,he,ce,ge,be,fe){const we=le.content.length;let Ce=!1,ve=-1;if(be){const Ie=function(Fe,Be,Ze,Re,qe,Me){let Pe=qe.beginRuleCapturedEOL?0:-1;const Qe=[];for(let je=qe;je;je=je.pop()){const Ue=je.getRule(Fe);Ue instanceof q.BeginWhileRule&&Qe.push({rule:Ue,stack:je})}for(let je=Qe.pop();je;je=Qe.pop()){const{ruleScanner:Ue,findOptions:tt}=oe(je.rule,Fe,je.stack.endRule,Ze,Re===Pe),Ve=Ue.findNextMatchSync(Be,Re,tt);if(H.DebugFlags.InDebugMode&&(console.log("  scanning for while rule"),console.log(Ue.toString())),!Ve){H.DebugFlags.InDebugMode&&console.log("  popping "+je.rule.debugName+" - "+je.rule.debugWhileRegExp),qe=je.stack.pop();break}if(Ve.ruleId!==q.whileRuleId){qe=je.stack.pop();break}Ve.captureIndices&&Ve.captureIndices.length&&(Me.produce(je.stack,Ve.captureIndices[0].start),ae(Fe,Be,Ze,je.stack,Me,je.rule.whileCaptures,Ve.captureIndices),Me.produce(je.stack,Ve.captureIndices[0].end),Pe=Ve.captureIndices[0].end,Ve.captureIndices[0].end>Re&&(Re=Ve.captureIndices[0].end,Ze=!1))}return{stack:qe,linePos:Re,anchorPosition:Pe,isFirstLine:Ze}}(se,le,ue,he,ce,ge);ce=Ie.stack,he=Ie.linePos,ue=Ie.isFirstLine,ve=Ie.anchorPosition}const ke=Date.now();for(;!Ce;){if(fe!==0&&Date.now()-ke>fe)return new ee(ce,!0);me()}return new ee(ce,!1);function me(){H.DebugFlags.InDebugMode&&(console.log(""),console.log(`@@scanNext ${he}: |${le.content.substr(he).replace(/\n$/,"\\n")}|`));const Ie=function(Re,qe,Me,Pe,Qe,je){const Ue=function(st,at,ct,lt,_e,We){const Ne=_e.getRule(st),{ruleScanner:$e,findOptions:Te}=ne(Ne,st,_e.endRule,ct,lt===We);let De=0;H.DebugFlags.InDebugMode&&(De=X.performanceNow());const Ge=$e.findNextMatchSync(at,lt,Te);if(H.DebugFlags.InDebugMode){const Ke=X.performanceNow()-De;Ke>5&&console.warn(`Rule ${Ne.debugName} (${Ne.id}) matching took ${Ke} against '${at}'`),console.log(`  scanning for (linePos: ${lt}, anchorPosition: ${We})`),console.log($e.toString()),Ge&&console.log(`matched rule id: ${Ge.ruleId} from ${Ge.captureIndices[0].start} to ${Ge.captureIndices[0].end}`)}return Ge?{captureIndices:Ge.captureIndices,matchedRuleId:Ge.ruleId}:null}(Re,qe,Me,Pe,Qe,je),tt=Re.getInjections();if(tt.length===0)return Ue;const Ve=function(st,at,ct,lt,_e,We,Ne){let $e,Te=Number.MAX_VALUE,De=null,Ge=0;const Ke=We.contentNameScopesList.getScopeNames();for(let Ae=0,Oe=st.length;Ae<Oe;Ae++){const Ye=st[Ae];if(!Ye.matcher(Ke))continue;const Je=at.getRule(Ye.ruleId),{ruleScanner:rt,findOptions:xe}=ne(Je,at,null,lt,_e===Ne),de=rt.findNextMatchSync(ct,_e,xe);if(!de)continue;H.DebugFlags.InDebugMode&&(console.log(`  matched injection: ${Ye.debugSelector}`),console.log(rt.toString()));const pe=de.captureIndices[0].start;if(!(pe>=Te)&&(Te=pe,De=de.captureIndices,$e=de.ruleId,Ge=Ye.priority,Te===_e))break}return De?{priorityMatch:Ge===-1,captureIndices:De,matchedRuleId:$e}:null}(tt,Re,qe,Me,Pe,Qe,je);if(!Ve)return Ue;if(!Ue)return Ve;const nt=Ue.captureIndices[0].start,et=Ve.captureIndices[0].start;return et<nt||Ve.priorityMatch&&et===nt?Ve:Ue}(se,le,ue,he,ce,ve);if(!Ie)return H.DebugFlags.InDebugMode&&console.log("  no more matches."),ge.produce(ce,we),void(Ce=!0);const Fe=Ie.captureIndices,Be=Ie.matchedRuleId,Ze=!!(Fe&&Fe.length>0)&&Fe[0].end>he;if(Be===q.endRuleId){const Re=ce.getRule(se);H.DebugFlags.InDebugMode&&console.log("  popping "+Re.debugName+" - "+Re.debugEndRegExp),ge.produce(ce,Fe[0].start),ce=ce.withContentNameScopesList(ce.nameScopesList),ae(se,le,ue,ce,ge,Re.endCaptures,Fe),ge.produce(ce,Fe[0].end);const qe=ce;if(ce=ce.parent,ve=qe.getAnchorPos(),!Ze&&qe.getEnterPos()===he)return H.DebugFlags.InDebugMode&&console.error("[1] - Grammar is in an endless loop - Grammar pushed & popped a rule without advancing"),ce=qe,ge.produce(ce,we),void(Ce=!0)}else{const Re=se.getRule(Be);ge.produce(ce,Fe[0].start);const qe=ce,Me=Re.getName(le.content,Fe),Pe=ce.contentNameScopesList.pushAttributed(Me,se);if(ce=ce.push(Be,he,ve,Fe[0].end===we,null,Pe,Pe),Re instanceof q.BeginEndRule){const Qe=Re;H.DebugFlags.InDebugMode&&console.log("  pushing "+Qe.debugName+" - "+Qe.debugBeginRegExp),ae(se,le,ue,ce,ge,Qe.beginCaptures,Fe),ge.produce(ce,Fe[0].end),ve=Fe[0].end;const je=Qe.getContentName(le.content,Fe),Ue=Pe.pushAttributed(je,se);if(ce=ce.withContentNameScopesList(Ue),Qe.endHasBackReferences&&(ce=ce.withEndRule(Qe.getEndWithResolvedBackReferences(le.content,Fe))),!Ze&&qe.hasSameRuleAs(ce))return H.DebugFlags.InDebugMode&&console.error("[2] - Grammar is in an endless loop - Grammar pushed the same rule without advancing"),ce=ce.pop(),ge.produce(ce,we),void(Ce=!0)}else if(Re instanceof q.BeginWhileRule){const Qe=Re;H.DebugFlags.InDebugMode&&console.log("  pushing "+Qe.debugName),ae(se,le,ue,ce,ge,Qe.beginCaptures,Fe),ge.produce(ce,Fe[0].end),ve=Fe[0].end;const je=Qe.getContentName(le.content,Fe),Ue=Pe.pushAttributed(je,se);if(ce=ce.withContentNameScopesList(Ue),Qe.whileHasBackReferences&&(ce=ce.withEndRule(Qe.getWhileWithResolvedBackReferences(le.content,Fe))),!Ze&&qe.hasSameRuleAs(ce))return H.DebugFlags.InDebugMode&&console.error("[3] - Grammar is in an endless loop - Grammar pushed the same rule without advancing"),ce=ce.pop(),ge.produce(ce,we),void(Ce=!0)}else{const Qe=Re;if(H.DebugFlags.InDebugMode&&console.log("  matched "+Qe.debugName+" - "+Qe.debugMatchRegExp),ae(se,le,ue,ce,ge,Qe.captures,Fe),ge.produce(ce,Fe[0].end),ce=ce.pop(),!Ze)return H.DebugFlags.InDebugMode&&console.error("[4] - Grammar is in an endless loop - Grammar is not advancing, nor is it pushing/popping"),ce=ce.safePop(),ge.produce(ce,we),void(Ce=!0)}}Fe[0].end>he&&(he=Fe[0].end,ue=!1)}}function ne(se,le,ue,he,ce){return H.UseOnigurumaFindOptions?{ruleScanner:se.compile(le,ue),findOptions:ie(he,ce)}:{ruleScanner:se.compileAG(le,ue,he,ce),findOptions:0}}function oe(se,le,ue,he,ce){return H.UseOnigurumaFindOptions?{ruleScanner:se.compileWhile(le,ue),findOptions:ie(he,ce)}:{ruleScanner:se.compileWhileAG(le,ue,he,ce),findOptions:0}}function ie(se,le){let ue=0;return se||(ue|=1),le||(ue|=4),ue}function ae(se,le,ue,he,ce,ge,be){if(ge.length===0)return;const fe=le.content,we=Math.min(ge.length,be.length),Ce=[],ve=be[0].end;for(let ke=0;ke<we;ke++){const me=ge[ke];if(me===null)continue;const Ie=be[ke];if(Ie.length===0)continue;if(Ie.start>ve)break;for(;Ce.length>0&&Ce[Ce.length-1].endPos<=Ie.start;)ce.produceFromScopes(Ce[Ce.length-1].scopes,Ce[Ce.length-1].endPos),Ce.pop();if(Ce.length>0?ce.produceFromScopes(Ce[Ce.length-1].scopes,Ie.start):ce.produce(he,Ie.start),me.retokenizeCapturedWithRuleId){const Be=me.getName(fe,be),Ze=he.contentNameScopesList.pushAttributed(Be,se),Re=me.getContentName(fe,be),qe=Ze.pushAttributed(Re,se),Me=he.push(me.retokenizeCapturedWithRuleId,Ie.start,-1,!1,null,Ze,qe),Pe=se.createOnigString(fe.substring(0,Ie.end));te(se,Pe,ue&&Ie.start===0,Ie.start,Me,ce,!1,0),j.disposeOnigString(Pe);continue}const Fe=me.getName(fe,be);if(Fe!==null){const Be=(Ce.length>0?Ce[Ce.length-1].scopes:he.contentNameScopesList).pushAttributed(Fe,se);Ce.push(new re(Be,Ie.end))}}for(;Ce.length>0;)ce.produceFromScopes(Ce[Ce.length-1].scopes,Ce[Ce.length-1].endPos),Ce.pop()}B._tokenizeString=te;class re{constructor(le,ue){this.scopes=le,this.endPos=ue}}B.LocalStackElement=re},974:($,B)=>{function R(X,ee){throw new Error("Near offset "+X.pos+": "+ee+" ~~~"+X.source.substr(X.pos,50)+"~~~")}Object.defineProperty(B,"__esModule",{value:!0}),B.parseJSON=void 0,B.parseJSON=function(X,ee,te){let ne=new H(X),oe=new j,ie=0,ae=null,re=[],se=[];function le(){re.push(ie),se.push(ae)}function ue(){ie=re.pop(),ae=se.pop()}function he(ce){R(ne,ce)}for(;q(ne,oe);){if(ie===0){if(ae!==null&&he("too many constructs in root"),oe.type===3){ae={},te&&(ae.$vscodeTextmateLocation=oe.toLocation(ee)),le(),ie=1;continue}if(oe.type===2){ae=[],le(),ie=4;continue}he("unexpected token in root")}if(ie===2){if(oe.type===5){ue();continue}if(oe.type===7){ie=3;continue}he("expected , or }")}if(ie===1||ie===3){if(ie===1&&oe.type===5){ue();continue}if(oe.type===1){let ce=oe.value;if(q(ne,oe)&&oe.type===6||he("expected colon"),q(ne,oe)||he("expected value"),ie=2,oe.type===1){ae[ce]=oe.value;continue}if(oe.type===8){ae[ce]=null;continue}if(oe.type===9){ae[ce]=!0;continue}if(oe.type===10){ae[ce]=!1;continue}if(oe.type===11){ae[ce]=parseFloat(oe.value);continue}if(oe.type===2){let ge=[];ae[ce]=ge,le(),ie=4,ae=ge;continue}if(oe.type===3){let ge={};te&&(ge.$vscodeTextmateLocation=oe.toLocation(ee)),ae[ce]=ge,le(),ie=1,ae=ge;continue}}he("unexpected token in dict")}if(ie===5){if(oe.type===4){ue();continue}if(oe.type===7){ie=6;continue}he("expected , or ]")}if(ie===4||ie===6){if(ie===4&&oe.type===4){ue();continue}if(ie=5,oe.type===1){ae.push(oe.value);continue}if(oe.type===8){ae.push(null);continue}if(oe.type===9){ae.push(!0);continue}if(oe.type===10){ae.push(!1);continue}if(oe.type===11){ae.push(parseFloat(oe.value));continue}if(oe.type===2){let ce=[];ae.push(ce),le(),ie=4,ae=ce;continue}if(oe.type===3){let ce={};te&&(ce.$vscodeTextmateLocation=oe.toLocation(ee)),ae.push(ce),le(),ie=1,ae=ce;continue}he("unexpected token in array")}he("unknown state")}return se.length!==0&&he("unclosed constructs"),ae};class H{constructor(ee){this.source=ee,this.pos=0,this.len=ee.length,this.line=1,this.char=0}}class j{constructor(){this.value=null,this.type=0,this.offset=-1,this.len=-1,this.line=-1,this.char=-1}toLocation(ee){return{filename:ee,line:this.line,char:this.char}}}function q(X,ee){ee.value=null,ee.type=0,ee.offset=-1,ee.len=-1,ee.line=-1,ee.char=-1;let te,ne=X.source,oe=X.pos,ie=X.len,ae=X.line,re=X.char;for(;;){if(oe>=ie)return!1;if(te=ne.charCodeAt(oe),te!==32&&te!==9&&te!==13){if(te!==10)break;oe++,ae++,re=0}else oe++,re++}if(ee.offset=oe,ee.line=ae,ee.char=re,te===34){for(ee.type=1,oe++,re++;;){if(oe>=ie)return!1;if(te=ne.charCodeAt(oe),oe++,re++,te!==92){if(te===34)break}else oe++,re++}ee.value=ne.substring(ee.offset+1,oe-1).replace(/\\u([0-9A-Fa-f]{4})/g,(se,le)=>String.fromCodePoint(parseInt(le,16))).replace(/\\(.)/g,(se,le)=>{switch(le){case'"':return'"';case"\\":return"\\";case"/":return"/";case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";default:R(X,"invalid escape sequence")}throw new Error("unreachable")})}else if(te===91)ee.type=2,oe++,re++;else if(te===123)ee.type=3,oe++,re++;else if(te===93)ee.type=4,oe++,re++;else if(te===125)ee.type=5,oe++,re++;else if(te===58)ee.type=6,oe++,re++;else if(te===44)ee.type=7,oe++,re++;else if(te===110){if(ee.type=8,oe++,re++,te=ne.charCodeAt(oe),te!==117||(oe++,re++,te=ne.charCodeAt(oe),te!==108)||(oe++,re++,te=ne.charCodeAt(oe),te!==108))return!1;oe++,re++}else if(te===116){if(ee.type=9,oe++,re++,te=ne.charCodeAt(oe),te!==114||(oe++,re++,te=ne.charCodeAt(oe),te!==117)||(oe++,re++,te=ne.charCodeAt(oe),te!==101))return!1;oe++,re++}else if(te===102){if(ee.type=10,oe++,re++,te=ne.charCodeAt(oe),te!==97||(oe++,re++,te=ne.charCodeAt(oe),te!==108)||(oe++,re++,te=ne.charCodeAt(oe),te!==115)||(oe++,re++,te=ne.charCodeAt(oe),te!==101))return!1;oe++,re++}else for(ee.type=11;;){if(oe>=ie)return!1;if(te=ne.charCodeAt(oe),!(te===46||te>=48&&te<=57||te===101||te===69||te===45||te===43))break;oe++,re++}return ee.len=oe-ee.offset,ee.value===null&&(ee.value=ne.substr(ee.offset,ee.len)),X.pos=oe,X.line=ae,X.char=re,!0}},787:function($,B,R){var H=this&&this.__createBinding||(Object.create?function(oe,ie,ae,re){re===void 0&&(re=ae),Object.defineProperty(oe,re,{enumerable:!0,get:function(){return ie[ae]}})}:function(oe,ie,ae,re){re===void 0&&(re=ae),oe[re]=ie[ae]}),j=this&&this.__exportStar||function(oe,ie){for(var ae in oe)ae==="default"||Object.prototype.hasOwnProperty.call(ie,ae)||H(ie,oe,ae)};Object.defineProperty(B,"__esModule",{value:!0}),B.parseRawGrammar=B.INITIAL=B.Registry=void 0;const q=R(391),X=R(50),ee=R(652),te=R(583),ne=R(965);j(R(44),B),B.Registry=class{constructor(oe){this._options=oe,this._syncRegistry=new ee.SyncRegistry(te.Theme.createFromRawTheme(oe.theme,oe.colorMap),oe.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(oe,ie){this._syncRegistry.setTheme(te.Theme.createFromRawTheme(oe,ie))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(oe,ie,ae){return this.loadGrammarWithConfiguration(oe,ie,{embeddedLanguages:ae})}loadGrammarWithConfiguration(oe,ie,ae){return this._loadGrammar(oe,ie,ae.embeddedLanguages,ae.tokenTypes,new q.BalancedBracketSelectors(ae.balancedBracketSelectors||[],ae.unbalancedBracketSelectors||[]))}loadGrammar(oe){return this._loadGrammar(oe,0,null,null,null)}async _loadGrammar(oe,ie,ae,re,se){const le=new ne.ScopeDependencyProcessor(this._syncRegistry,oe);for(;le.Q.length>0;)await Promise.all(le.Q.map(ue=>this._loadSingleGrammar(ue.scopeName))),le.processQueue();return this._grammarForScopeName(oe,ie,ae,re,se)}async _loadSingleGrammar(oe){return this._ensureGrammarCache.has(oe)||this._ensureGrammarCache.set(oe,this._doLoadSingleGrammar(oe)),this._ensureGrammarCache.get(oe)}async _doLoadSingleGrammar(oe){const ie=await this._options.loadGrammar(oe);if(ie){const ae=typeof this._options.getInjections=="function"?this._options.getInjections(oe):void 0;this._syncRegistry.addGrammar(ie,ae)}}async addGrammar(oe,ie=[],ae=0,re=null){return this._syncRegistry.addGrammar(oe,ie),await this._grammarForScopeName(oe.scopeName,ae,re)}_grammarForScopeName(oe,ie=0,ae=null,re=null,se=null){return this._syncRegistry.grammarForScopeName(oe,ie,ae,re,se)}},B.INITIAL=q.StateStack.NULL,B.parseRawGrammar=X.parseRawGrammar},736:($,B)=>{function R(H){return!!H&&!!H.match(/[\w\.:]+/)}Object.defineProperty(B,"__esModule",{value:!0}),B.createMatchers=void 0,B.createMatchers=function(H,j){const q=[],X=function(oe){let ie=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g,ae=ie.exec(oe);return{next:()=>{if(!ae)return null;const re=ae[0];return ae=ie.exec(oe),re}}}(H);let ee=X.next();for(;ee!==null;){let oe=0;if(ee.length===2&&ee.charAt(1)===":"){switch(ee.charAt(0)){case"R":oe=1;break;case"L":oe=-1;break;default:console.log(`Unknown priority ${ee} in scope selector`)}ee=X.next()}let ie=ne();if(q.push({matcher:ie,priority:oe}),ee!==",")break;ee=X.next()}return q;function te(){if(ee==="-"){ee=X.next();const oe=te();return ie=>!!oe&&!oe(ie)}if(ee==="("){ee=X.next();const oe=function(){const ie=[];let ae=ne();for(;ae&&(ie.push(ae),ee==="|"||ee===",");){do ee=X.next();while(ee==="|"||ee===",");ae=ne()}return re=>ie.some(se=>se(re))}();return ee===")"&&(ee=X.next()),oe}if(R(ee)){const oe=[];do oe.push(ee),ee=X.next();while(R(ee));return ie=>j(oe,ie)}return null}function ne(){const oe=[];let ie=te();for(;ie;)oe.push(ie),ie=te();return ae=>oe.every(re=>re(ae))}}},44:($,B)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.disposeOnigString=void 0,B.disposeOnigString=function(R){typeof R.dispose=="function"&&R.dispose()}},50:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.parseRawGrammar=void 0;const H=R(69),j=R(350),q=R(974);B.parseRawGrammar=function(X,ee=null){return ee!==null&&/\.json$/.test(ee)?(te=X,ne=ee,j.DebugFlags.InDebugMode?q.parseJSON(te,ne,!0):JSON.parse(te)):function(oe,ie){return j.DebugFlags.InDebugMode?H.parseWithLocation(oe,ie,"$vscodeTextmateLocation"):H.parsePLIST(oe)}(X,ee);var te,ne}},69:($,B)=>{function R(H,j,q){const X=H.length;let ee=0,te=1,ne=0;function oe(Ve){if(q===null)ee+=Ve;else for(;Ve>0;)H.charCodeAt(ee)===10?(ee++,te++,ne=0):(ee++,ne++),Ve--}function ie(Ve){q===null?ee=Ve:oe(Ve-ee)}function ae(){for(;ee<X;){let Ve=H.charCodeAt(ee);if(Ve!==32&&Ve!==9&&Ve!==13&&Ve!==10)break;oe(1)}}function re(Ve){return H.substr(ee,Ve.length)===Ve&&(oe(Ve.length),!0)}function se(Ve){let nt=H.indexOf(Ve,ee);ie(nt!==-1?nt+Ve.length:X)}function le(Ve){let nt=H.indexOf(Ve,ee);if(nt!==-1){let et=H.substring(ee,nt);return ie(nt+Ve.length),et}{let et=H.substr(ee);return ie(X),et}}X>0&&H.charCodeAt(0)===65279&&(ee=1);let ue=0,he=null,ce=[],ge=[],be=null;function fe(Ve,nt){ce.push(ue),ge.push(he),ue=Ve,he=nt}function we(){if(ce.length===0)return Ce("illegal state stack");ue=ce.pop(),he=ge.pop()}function Ce(Ve){throw new Error("Near offset "+ee+": "+Ve+" ~~~"+H.substr(ee,50)+"~~~")}const ve=function(){if(be===null)return Ce("missing <key>");let Ve={};q!==null&&(Ve[q]={filename:j,line:te,char:ne}),he[be]=Ve,be=null,fe(1,Ve)},ke=function(){if(be===null)return Ce("missing <key>");let Ve=[];he[be]=Ve,be=null,fe(2,Ve)},me=function(){let Ve={};q!==null&&(Ve[q]={filename:j,line:te,char:ne}),he.push(Ve),fe(1,Ve)},Ie=function(){let Ve=[];he.push(Ve),fe(2,Ve)};function Fe(){if(ue!==1)return Ce("unexpected </dict>");we()}function Be(){return ue===1||ue!==2?Ce("unexpected </array>"):void we()}function Ze(Ve){if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function Re(Ve){if(isNaN(Ve))return Ce("cannot parse float");if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function qe(Ve){if(isNaN(Ve))return Ce("cannot parse integer");if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function Me(Ve){if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function Pe(Ve){if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function Qe(Ve){if(ue===1){if(be===null)return Ce("missing <key>");he[be]=Ve,be=null}else ue===2?he.push(Ve):he=Ve}function je(){let Ve=le(">"),nt=!1;return Ve.charCodeAt(Ve.length-1)===47&&(nt=!0,Ve=Ve.substring(0,Ve.length-1)),{name:Ve.trim(),isClosed:nt}}function Ue(Ve){if(Ve.isClosed)return"";let nt=le("</");return se(">"),nt.replace(/&#([0-9]+);/g,function(et,st){return String.fromCodePoint(parseInt(st,10))}).replace(/&#x([0-9a-f]+);/g,function(et,st){return String.fromCodePoint(parseInt(st,16))}).replace(/&amp;|&lt;|&gt;|&quot;|&apos;/g,function(et){switch(et){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&quot;":return'"';case"&apos;":return"'"}return et})}for(;ee<X&&(ae(),!(ee>=X));){const Ve=H.charCodeAt(ee);if(oe(1),Ve!==60)return Ce("expected <");if(ee>=X)return Ce("unexpected end of input");const nt=H.charCodeAt(ee);if(nt===63){oe(1),se("?>");continue}if(nt===33){if(oe(1),re("--")){se("-->");continue}se(">");continue}if(nt===47){if(oe(1),ae(),re("plist")){se(">");continue}if(re("dict")){se(">"),Fe();continue}if(re("array")){se(">"),Be();continue}return Ce("unexpected closed tag")}let et=je();switch(et.name){case"dict":ue===1?ve():ue===2?me():(he={},q!==null&&(he[q]={filename:j,line:te,char:ne}),fe(1,he)),et.isClosed&&Fe();continue;case"array":ue===1?ke():ue===2?Ie():(he=[],fe(2,he)),et.isClosed&&Be();continue;case"key":tt=Ue(et),ue!==1?Ce("unexpected <key>"):be!==null?Ce("too many <key>"):be=tt;continue;case"string":Ze(Ue(et));continue;case"real":Re(parseFloat(Ue(et)));continue;case"integer":qe(parseInt(Ue(et),10));continue;case"date":Me(new Date(Ue(et)));continue;case"data":Pe(Ue(et));continue;case"true":Ue(et),Qe(!0);continue;case"false":Ue(et),Qe(!1);continue}if(!/^plist/.test(et.name))return Ce("unexpected opened tag "+et.name)}var tt;return he}Object.defineProperty(B,"__esModule",{value:!0}),B.parsePLIST=B.parseWithLocation=void 0,B.parseWithLocation=function(H,j,q){return R(H,j,q)},B.parsePLIST=function(H){return R(H,null,null)}},652:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.SyncRegistry=void 0;const H=R(391);B.SyncRegistry=class{constructor(j,q){this._onigLibPromise=q,this._grammars=new Map,this._rawGrammars=new Map,this._injectionGrammars=new Map,this._theme=j}dispose(){for(const j of this._grammars.values())j.dispose()}setTheme(j){this._theme=j}getColorMap(){return this._theme.getColorMap()}addGrammar(j,q){this._rawGrammars.set(j.scopeName,j),q&&this._injectionGrammars.set(j.scopeName,q)}lookup(j){return this._rawGrammars.get(j)}injections(j){return this._injectionGrammars.get(j)}getDefaults(){return this._theme.getDefaults()}themeMatch(j){return this._theme.match(j)}async grammarForScopeName(j,q,X,ee,te){if(!this._grammars.has(j)){let ne=this._rawGrammars.get(j);if(!ne)return null;this._grammars.set(j,H.createGrammar(j,ne,q,X,ee,te,this,await this._onigLibPromise))}return this._grammars.get(j)}}},792:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.CompiledRule=B.RegExpSourceList=B.RegExpSource=B.RuleFactory=B.BeginWhileRule=B.BeginEndRule=B.IncludeOnlyRule=B.MatchRule=B.CaptureRule=B.Rule=B.ruleIdToNumber=B.ruleIdFromNumber=B.whileRuleId=B.endRuleId=void 0;const H=R(878),j=R(965),q=/\\(\d+)/,X=/\\(\d+)/g;B.endRuleId=-1,B.whileRuleId=-2,B.ruleIdFromNumber=function(he){return he},B.ruleIdToNumber=function(he){return he};class ee{constructor(ce,ge,be,fe){this.$location=ce,this.id=ge,this._name=be||null,this._nameIsCapturing=H.RegexSource.hasCaptures(this._name),this._contentName=fe||null,this._contentNameIsCapturing=H.RegexSource.hasCaptures(this._contentName)}get debugName(){const ce=this.$location?`${H.basename(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${ce}`}getName(ce,ge){return this._nameIsCapturing&&this._name!==null&&ce!==null&&ge!==null?H.RegexSource.replaceCaptures(this._name,ce,ge):this._name}getContentName(ce,ge){return this._contentNameIsCapturing&&this._contentName!==null?H.RegexSource.replaceCaptures(this._contentName,ce,ge):this._contentName}}B.Rule=ee;class te extends ee{constructor(ce,ge,be,fe,we){super(ce,ge,be,fe),this.retokenizeCapturedWithRuleId=we}dispose(){}collectPatterns(ce,ge){throw new Error("Not supported!")}compile(ce,ge){throw new Error("Not supported!")}compileAG(ce,ge,be,fe){throw new Error("Not supported!")}}B.CaptureRule=te;class ne extends ee{constructor(ce,ge,be,fe,we){super(ce,ge,be,null),this._match=new se(fe,this.id),this.captures=we,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(ce,ge){ge.push(this._match)}compile(ce,ge){return this._getCachedCompiledPatterns(ce).compile(ce)}compileAG(ce,ge,be,fe){return this._getCachedCompiledPatterns(ce).compileAG(ce,be,fe)}_getCachedCompiledPatterns(ce){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new le,this.collectPatterns(ce,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}}B.MatchRule=ne;class oe extends ee{constructor(ce,ge,be,fe,we){super(ce,ge,be,fe),this.patterns=we.patterns,this.hasMissingPatterns=we.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(ce,ge){for(const be of this.patterns)ce.getRule(be).collectPatterns(ce,ge)}compile(ce,ge){return this._getCachedCompiledPatterns(ce).compile(ce)}compileAG(ce,ge,be,fe){return this._getCachedCompiledPatterns(ce).compileAG(ce,be,fe)}_getCachedCompiledPatterns(ce){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new le,this.collectPatterns(ce,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}}B.IncludeOnlyRule=oe;class ie extends ee{constructor(ce,ge,be,fe,we,Ce,ve,ke,me,Ie){super(ce,ge,be,fe),this._begin=new se(we,this.id),this.beginCaptures=Ce,this._end=new se(ve||"￿",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=ke,this.applyEndPatternLast=me||!1,this.patterns=Ie.patterns,this.hasMissingPatterns=Ie.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(ce,ge){return this._end.resolveBackReferences(ce,ge)}collectPatterns(ce,ge){ge.push(this._begin)}compile(ce,ge){return this._getCachedCompiledPatterns(ce,ge).compile(ce)}compileAG(ce,ge,be,fe){return this._getCachedCompiledPatterns(ce,ge).compileAG(ce,be,fe)}_getCachedCompiledPatterns(ce,ge){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new le;for(const be of this.patterns)ce.getRule(be).collectPatterns(ce,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,ge):this._cachedCompiledPatterns.setSource(0,ge)),this._cachedCompiledPatterns}}B.BeginEndRule=ie;class ae extends ee{constructor(ce,ge,be,fe,we,Ce,ve,ke,me){super(ce,ge,be,fe),this._begin=new se(we,this.id),this.beginCaptures=Ce,this.whileCaptures=ke,this._while=new se(ve,B.whileRuleId),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=me.patterns,this.hasMissingPatterns=me.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(ce,ge){return this._while.resolveBackReferences(ce,ge)}collectPatterns(ce,ge){ge.push(this._begin)}compile(ce,ge){return this._getCachedCompiledPatterns(ce).compile(ce)}compileAG(ce,ge,be,fe){return this._getCachedCompiledPatterns(ce).compileAG(ce,be,fe)}_getCachedCompiledPatterns(ce){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new le;for(const ge of this.patterns)ce.getRule(ge).collectPatterns(ce,this._cachedCompiledPatterns)}return this._cachedCompiledPatterns}compileWhile(ce,ge){return this._getCachedCompiledWhilePatterns(ce,ge).compile(ce)}compileWhileAG(ce,ge,be,fe){return this._getCachedCompiledWhilePatterns(ce,ge).compileAG(ce,be,fe)}_getCachedCompiledWhilePatterns(ce,ge){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new le,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,ge||"￿"),this._cachedCompiledWhilePatterns}}B.BeginWhileRule=ae;class re{static createCaptureRule(ce,ge,be,fe,we){return ce.registerRule(Ce=>new te(ge,Ce,be,fe,we))}static getCompiledRuleId(ce,ge,be){return ce.id||ge.registerRule(fe=>{if(ce.id=fe,ce.match)return new ne(ce.$vscodeTextmateLocation,ce.id,ce.name,ce.match,re._compileCaptures(ce.captures,ge,be));if(ce.begin===void 0){ce.repository&&(be=H.mergeObjects({},be,ce.repository));let we=ce.patterns;return we===void 0&&ce.include&&(we=[{include:ce.include}]),new oe(ce.$vscodeTextmateLocation,ce.id,ce.name,ce.contentName,re._compilePatterns(we,ge,be))}return ce.while?new ae(ce.$vscodeTextmateLocation,ce.id,ce.name,ce.contentName,ce.begin,re._compileCaptures(ce.beginCaptures||ce.captures,ge,be),ce.while,re._compileCaptures(ce.whileCaptures||ce.captures,ge,be),re._compilePatterns(ce.patterns,ge,be)):new ie(ce.$vscodeTextmateLocation,ce.id,ce.name,ce.contentName,ce.begin,re._compileCaptures(ce.beginCaptures||ce.captures,ge,be),ce.end,re._compileCaptures(ce.endCaptures||ce.captures,ge,be),ce.applyEndPatternLast,re._compilePatterns(ce.patterns,ge,be))}),ce.id}static _compileCaptures(ce,ge,be){let fe=[];if(ce){let we=0;for(const Ce in ce){if(Ce==="$vscodeTextmateLocation")continue;const ve=parseInt(Ce,10);ve>we&&(we=ve)}for(let Ce=0;Ce<=we;Ce++)fe[Ce]=null;for(const Ce in ce){if(Ce==="$vscodeTextmateLocation")continue;const ve=parseInt(Ce,10);let ke=0;ce[Ce].patterns&&(ke=re.getCompiledRuleId(ce[Ce],ge,be)),fe[ve]=re.createCaptureRule(ge,ce[Ce].$vscodeTextmateLocation,ce[Ce].name,ce[Ce].contentName,ke)}}return fe}static _compilePatterns(ce,ge,be){let fe=[];if(ce)for(let we=0,Ce=ce.length;we<Ce;we++){const ve=ce[we];let ke=-1;if(ve.include){const me=j.parseInclude(ve.include);switch(me.kind){case 0:case 1:ke=re.getCompiledRuleId(be[ve.include],ge,be);break;case 2:let Ie=be[me.ruleName];Ie&&(ke=re.getCompiledRuleId(Ie,ge,be));break;case 3:case 4:const Fe=me.scopeName,Be=me.kind===4?me.ruleName:null,Ze=ge.getExternalGrammar(Fe,be);if(Ze)if(Be){let Re=Ze.repository[Be];Re&&(ke=re.getCompiledRuleId(Re,ge,Ze.repository))}else ke=re.getCompiledRuleId(Ze.repository.$self,ge,Ze.repository)}}else ke=re.getCompiledRuleId(ve,ge,be);if(ke!==-1){const me=ge.getRule(ke);let Ie=!1;if((me instanceof oe||me instanceof ie||me instanceof ae)&&me.hasMissingPatterns&&me.patterns.length===0&&(Ie=!0),Ie)continue;fe.push(ke)}}return{patterns:fe,hasMissingPatterns:(ce?ce.length:0)!==fe.length}}}B.RuleFactory=re;class se{constructor(ce,ge){if(ce){const be=ce.length;let fe=0,we=[],Ce=!1;for(let ve=0;ve<be;ve++)if(ce.charAt(ve)==="\\"&&ve+1<be){const ke=ce.charAt(ve+1);ke==="z"?(we.push(ce.substring(fe,ve)),we.push("$(?!\\n)(?<!\\n)"),fe=ve+2):ke!=="A"&&ke!=="G"||(Ce=!0),ve++}this.hasAnchor=Ce,fe===0?this.source=ce:(we.push(ce.substring(fe,be)),this.source=we.join(""))}else this.hasAnchor=!1,this.source=ce;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=ge,this.hasBackReferences=q.test(this.source)}clone(){return new se(this.source,this.ruleId)}setSource(ce){this.source!==ce&&(this.source=ce,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(ce,ge){let be=ge.map(fe=>ce.substring(fe.start,fe.end));return X.lastIndex=0,this.source.replace(X,(fe,we)=>H.escapeRegExpCharacters(be[parseInt(we,10)]||""))}_buildAnchorCache(){let ce,ge,be,fe,we=[],Ce=[],ve=[],ke=[];for(ce=0,ge=this.source.length;ce<ge;ce++)be=this.source.charAt(ce),we[ce]=be,Ce[ce]=be,ve[ce]=be,ke[ce]=be,be==="\\"&&ce+1<ge&&(fe=this.source.charAt(ce+1),fe==="A"?(we[ce+1]="￿",Ce[ce+1]="￿",ve[ce+1]="A",ke[ce+1]="A"):fe==="G"?(we[ce+1]="￿",Ce[ce+1]="G",ve[ce+1]="￿",ke[ce+1]="G"):(we[ce+1]=fe,Ce[ce+1]=fe,ve[ce+1]=fe,ke[ce+1]=fe),ce++);return{A0_G0:we.join(""),A0_G1:Ce.join(""),A1_G0:ve.join(""),A1_G1:ke.join("")}}resolveAnchors(ce,ge){return this.hasAnchor&&this._anchorCache?ce?ge?this._anchorCache.A1_G1:this._anchorCache.A1_G0:ge?this._anchorCache.A0_G1:this._anchorCache.A0_G0:this.source}}B.RegExpSource=se;class le{constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(ce){this._items.push(ce),this._hasAnchors=this._hasAnchors||ce.hasAnchor}unshift(ce){this._items.unshift(ce),this._hasAnchors=this._hasAnchors||ce.hasAnchor}length(){return this._items.length}setSource(ce,ge){this._items[ce].source!==ge&&(this._disposeCaches(),this._items[ce].setSource(ge))}compile(ce){if(!this._cached){let ge=this._items.map(be=>be.source);this._cached=new ue(ce,ge,this._items.map(be=>be.ruleId))}return this._cached}compileAG(ce,ge,be){return this._hasAnchors?ge?be?(this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(ce,ge,be)),this._anchorCache.A1_G1):(this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(ce,ge,be)),this._anchorCache.A1_G0):be?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(ce,ge,be)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(ce,ge,be)),this._anchorCache.A0_G0):this.compile(ce)}_resolveAnchors(ce,ge,be){let fe=this._items.map(we=>we.resolveAnchors(ge,be));return new ue(ce,fe,this._items.map(we=>we.ruleId))}}B.RegExpSourceList=le;class ue{constructor(ce,ge,be){this.regExps=ge,this.rules=be,this.scanner=ce.createOnigScanner(ge)}dispose(){typeof this.scanner.dispose=="function"&&this.scanner.dispose()}toString(){const ce=[];for(let ge=0,be=this.rules.length;ge<be;ge++)ce.push("   - "+this.rules[ge]+": "+this.regExps[ge]);return ce.join(`
`)}findNextMatchSync(ce,ge,be){const fe=this.scanner.findNextMatchSync(ce,ge,be);return fe?{ruleId:this.rules[fe.index],captureIndices:fe.captureIndices}:null}}B.CompiledRule=ue},583:($,B,R)=>{Object.defineProperty(B,"__esModule",{value:!0}),B.ThemeTrieElement=B.ThemeTrieElementRule=B.ColorMap=B.fontStyleToString=B.ParsedThemeRule=B.parseTheme=B.StyleAttributes=B.ScopeStack=B.Theme=void 0;const H=R(878);class j{constructor(se,le,ue){this._colorMap=se,this._defaults=le,this._root=ue,this._cachedMatchRoot=new H.CachedFn(he=>this._root.match(he))}static createFromRawTheme(se,le){return this.createFromParsedTheme(te(se),le)}static createFromParsedTheme(se,le){return function(ue,he){ue.sort((ve,ke)=>{let me=H.strcmp(ve.scope,ke.scope);return me!==0?me:(me=H.strArrCmp(ve.parentScopes,ke.parentScopes),me!==0?me:ve.index-ke.index)});let ce=0,ge="#000000",be="#ffffff";for(;ue.length>=1&&ue[0].scope==="";){let ve=ue.shift();ve.fontStyle!==-1&&(ce=ve.fontStyle),ve.foreground!==null&&(ge=ve.foreground),ve.background!==null&&(be=ve.background)}let fe=new oe(he),we=new ee(ce,fe.getId(ge),fe.getId(be)),Ce=new ae(new ie(0,null,-1,0,0),[]);for(let ve=0,ke=ue.length;ve<ke;ve++){let me=ue[ve];Ce.insert(0,me.scope,me.parentScopes,me.fontStyle,fe.getId(me.foreground),fe.getId(me.background))}return new j(fe,we,Ce)}(se,le)}getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(se){if(se===null)return this._defaults;const le=se.scopeName,ue=this._cachedMatchRoot.get(le).find(he=>function(ce,ge){if(ge===null)return!0;let be=0,fe=ge[be];for(;ce;){if(X(ce.scopeName,fe)){if(be++,be===ge.length)return!0;fe=ge[be]}ce=ce.parent}return!1}(se.parent,he.parentScopes));return ue?new ee(ue.fontStyle,ue.foreground,ue.background):null}}B.Theme=j;class q{constructor(se,le){this.parent=se,this.scopeName=le}static from(...se){let le=null;for(let ue=0;ue<se.length;ue++)le=new q(le,se[ue]);return le}push(se){return new q(this,se)}getSegments(){let se=this;const le=[];for(;se;)le.push(se.scopeName),se=se.parent;return le.reverse(),le}toString(){return this.getSegments().join(" ")}}function X(re,se){return se===re||re.startsWith(se)&&re[se.length]==="."}B.ScopeStack=q;class ee{constructor(se,le,ue){this.fontStyle=se,this.foregroundId=le,this.backgroundId=ue}}function te(re){if(!re)return[];if(!re.settings||!Array.isArray(re.settings))return[];let se=re.settings,le=[],ue=0;for(let he=0,ce=se.length;he<ce;he++){let ge,be=se[he];if(!be.settings)continue;if(typeof be.scope=="string"){let ve=be.scope;ve=ve.replace(/^[,]+/,""),ve=ve.replace(/[,]+$/,""),ge=ve.split(",")}else ge=Array.isArray(be.scope)?be.scope:[""];let fe=-1;if(typeof be.settings.fontStyle=="string"){fe=0;let ve=be.settings.fontStyle.split(" ");for(let ke=0,me=ve.length;ke<me;ke++)switch(ve[ke]){case"italic":fe|=1;break;case"bold":fe|=2;break;case"underline":fe|=4;break;case"strikethrough":fe|=8}}let we=null;typeof be.settings.foreground=="string"&&H.isValidHexColor(be.settings.foreground)&&(we=be.settings.foreground);let Ce=null;typeof be.settings.background=="string"&&H.isValidHexColor(be.settings.background)&&(Ce=be.settings.background);for(let ve=0,ke=ge.length;ve<ke;ve++){let me=ge[ve].trim().split(" "),Ie=me[me.length-1],Fe=null;me.length>1&&(Fe=me.slice(0,me.length-1),Fe.reverse()),le[ue++]=new ne(Ie,Fe,he,fe,we,Ce)}}return le}B.StyleAttributes=ee,B.parseTheme=te;class ne{constructor(se,le,ue,he,ce,ge){this.scope=se,this.parentScopes=le,this.index=ue,this.fontStyle=he,this.foreground=ce,this.background=ge}}B.ParsedThemeRule=ne,B.fontStyleToString=function(re){if(re===-1)return"not set";let se="";return 1&re&&(se+="italic "),2&re&&(se+="bold "),4&re&&(se+="underline "),8&re&&(se+="strikethrough "),se===""&&(se="none"),se.trim()};class oe{constructor(se){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(se)){this._isFrozen=!0;for(let le=0,ue=se.length;le<ue;le++)this._color2id[se[le]]=le,this._id2color[le]=se[le]}else this._isFrozen=!1}getId(se){if(se===null)return 0;se=se.toUpperCase();let le=this._color2id[se];if(le)return le;if(this._isFrozen)throw new Error(`Missing color in color map - ${se}`);return le=++this._lastColorId,this._color2id[se]=le,this._id2color[le]=se,le}getColorMap(){return this._id2color.slice(0)}}B.ColorMap=oe;class ie{constructor(se,le,ue,he,ce){this.scopeDepth=se,this.parentScopes=le,this.fontStyle=ue,this.foreground=he,this.background=ce}clone(){return new ie(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(se){let le=[];for(let ue=0,he=se.length;ue<he;ue++)le[ue]=se[ue].clone();return le}acceptOverwrite(se,le,ue,he){this.scopeDepth>se?console.log("how did this happen?"):this.scopeDepth=se,le!==-1&&(this.fontStyle=le),ue!==0&&(this.foreground=ue),he!==0&&(this.background=he)}}B.ThemeTrieElementRule=ie;class ae{constructor(se,le=[],ue={}){this._mainRule=se,this._children=ue,this._rulesWithParentScopes=le}static _sortBySpecificity(se){return se.length===1||se.sort(this._cmpBySpecificity),se}static _cmpBySpecificity(se,le){if(se.scopeDepth===le.scopeDepth){const ue=se.parentScopes,he=le.parentScopes;let ce=ue===null?0:ue.length,ge=he===null?0:he.length;if(ce===ge)for(let be=0;be<ce;be++){const fe=ue[be].length,we=he[be].length;if(fe!==we)return we-fe}return ge-ce}return le.scopeDepth-se.scopeDepth}match(se){if(se==="")return ae._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes));let le,ue,he=se.indexOf(".");return he===-1?(le=se,ue=""):(le=se.substring(0,he),ue=se.substring(he+1)),this._children.hasOwnProperty(le)?this._children[le].match(ue):ae._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes))}insert(se,le,ue,he,ce,ge){if(le==="")return void this._doInsertHere(se,ue,he,ce,ge);let be,fe,we,Ce=le.indexOf(".");Ce===-1?(be=le,fe=""):(be=le.substring(0,Ce),fe=le.substring(Ce+1)),this._children.hasOwnProperty(be)?we=this._children[be]:(we=new ae(this._mainRule.clone(),ie.cloneArr(this._rulesWithParentScopes)),this._children[be]=we),we.insert(se+1,fe,ue,he,ce,ge)}_doInsertHere(se,le,ue,he,ce){if(le!==null){for(let ge=0,be=this._rulesWithParentScopes.length;ge<be;ge++){let fe=this._rulesWithParentScopes[ge];if(H.strArrCmp(fe.parentScopes,le)===0)return void fe.acceptOverwrite(se,ue,he,ce)}ue===-1&&(ue=this._mainRule.fontStyle),he===0&&(he=this._mainRule.foreground),ce===0&&(ce=this._mainRule.background),this._rulesWithParentScopes.push(new ie(se,le,ue,he,ce))}else this._mainRule.acceptOverwrite(se,ue,he,ce)}}B.ThemeTrieElement=ae},878:($,B)=>{function R(q){return Array.isArray(q)?function(X){let ee=[];for(let te=0,ne=X.length;te<ne;te++)ee[te]=R(X[te]);return ee}(q):typeof q=="object"?function(X){let ee={};for(let te in X)ee[te]=R(X[te]);return ee}(q):q}Object.defineProperty(B,"__esModule",{value:!0}),B.performanceNow=B.CachedFn=B.escapeRegExpCharacters=B.isValidHexColor=B.strArrCmp=B.strcmp=B.RegexSource=B.basename=B.mergeObjects=B.clone=void 0,B.clone=function(q){return R(q)},B.mergeObjects=function(q,...X){return X.forEach(ee=>{for(let te in ee)q[te]=ee[te]}),q},B.basename=function q(X){const ee=~X.lastIndexOf("/")||~X.lastIndexOf("\\");return ee===0?X:~ee==X.length-1?q(X.substring(0,X.length-1)):X.substr(1+~ee)};let H=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g;function j(q,X){return q<X?-1:q>X?1:0}B.RegexSource=class{static hasCaptures(q){return q!==null&&(H.lastIndex=0,H.test(q))}static replaceCaptures(q,X,ee){return q.replace(H,(te,ne,oe,ie)=>{let ae=ee[parseInt(ne||oe,10)];if(!ae)return te;{let re=X.substring(ae.start,ae.end);for(;re[0]===".";)re=re.substring(1);switch(ie){case"downcase":return re.toLowerCase();case"upcase":return re.toUpperCase();default:return re}}})}},B.strcmp=j,B.strArrCmp=function(q,X){if(q===null&&X===null)return 0;if(!q)return-1;if(!X)return 1;let ee=q.length,te=X.length;if(ee===te){for(let ne=0;ne<ee;ne++){let oe=j(q[ne],X[ne]);if(oe!==0)return oe}return 0}return ee-te},B.isValidHexColor=function(q){return!!(/^#[0-9a-f]{6}$/i.test(q)||/^#[0-9a-f]{8}$/i.test(q)||/^#[0-9a-f]{3}$/i.test(q)||/^#[0-9a-f]{4}$/i.test(q))},B.escapeRegExpCharacters=function(q){return q.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")},B.CachedFn=class{constructor(q){this.fn=q,this.cache=new Map}get(q){if(this.cache.has(q))return this.cache.get(q);const X=this.fn(q);return this.cache.set(q,X),X}},B.performanceNow=typeof performance>"u"?function(){return Date.now()}:function(){return performance.now()}}},w={};return function $(B){var R=w[B];if(R!==void 0)return R.exports;var H=w[B]={exports:{}};return y[B].call(H.exports,H,H.exports,$),H.exports}(787)})()})})(main);var mainExports=main.exports;const languages=[{id:"abap",scopeName:"source.abap",path:"abap.tmLanguage.json",displayName:"ABAP",samplePath:"abap.sample"},{id:"actionscript-3",scopeName:"source.actionscript.3",path:"actionscript-3.tmLanguage.json",displayName:"ActionScript",samplePath:"actionscript-3.sample"},{id:"ada",scopeName:"source.ada",path:"ada.tmLanguage.json",displayName:"Ada",samplePath:"ada.sample"},{id:"apache",scopeName:"source.apacheconf",path:"apache.tmLanguage.json",displayName:"Apache Conf",samplePath:"apache.sample"},{id:"apex",scopeName:"source.apex",path:"apex.tmLanguage.json",displayName:"Apex",samplePath:"apex.sample"},{id:"apl",scopeName:"source.apl",path:"apl.tmLanguage.json",displayName:"APL",samplePath:"apl.sample",embeddedLangs:["html","xml","css","javascript","json"]},{id:"applescript",scopeName:"source.applescript",path:"applescript.tmLanguage.json",displayName:"AppleScript",samplePath:"applescript.sample"},{id:"ara",scopeName:"source.ara",path:"ara.tmLanguage.json",displayName:"Ara",samplePath:"ara.sample"},{id:"asm",scopeName:"source.asm.x86_64",path:"asm.tmLanguage.json",displayName:"Assembly",samplePath:"asm.sample"},{id:"astro",scopeName:"source.astro",path:"astro.tmLanguage.json",displayName:"Astro",samplePath:"astro.sample",embeddedLangs:["json","javascript","typescript","stylus","sass","css","scss","less","postcss","tsx"]},{id:"awk",scopeName:"source.awk",path:"awk.tmLanguage.json",displayName:"AWK",samplePath:"awk.sample"},{id:"ballerina",scopeName:"source.ballerina",path:"ballerina.tmLanguage.json",displayName:"Ballerina",samplePath:"ballerina.sample"},{id:"bat",scopeName:"source.batchfile",path:"bat.tmLanguage.json",displayName:"Batch",samplePath:"bat.sample",aliases:["batch"]},{id:"beancount",scopeName:"text.beancount",path:"beancount.tmLanguage.json",displayName:"Beancount",samplePath:"beancount.sample"},{id:"berry",scopeName:"source.berry",path:"berry.tmLanguage.json",displayName:"Berry",samplePath:"berry.sample",aliases:["be"]},{id:"bibtex",scopeName:"text.bibtex",path:"bibtex.tmLanguage.json",displayName:"BibTeX",samplePath:"bibtex.sample"},{id:"bicep",scopeName:"source.bicep",path:"bicep.tmLanguage.json",displayName:"Bicep",samplePath:"bicep.sample"},{id:"blade",scopeName:"text.html.php.blade",path:"blade.tmLanguage.json",displayName:"Blade",samplePath:"blade.sample",embeddedLangs:["html","xml","sql","javascript","json","css"]},{id:"c",scopeName:"source.c",path:"c.tmLanguage.json",displayName:"C",samplePath:"c.sample"},{id:"cadence",scopeName:"source.cadence",path:"cadence.tmLanguage.json",displayName:"Cadence",samplePath:"cadence.sample",aliases:["cdc"]},{id:"clarity",scopeName:"source.clar",path:"clarity.tmLanguage.json",displayName:"Clarity",samplePath:"clarity.sample"},{id:"clojure",scopeName:"source.clojure",path:"clojure.tmLanguage.json",displayName:"Clojure",samplePath:"clojure.sample",aliases:["clj"]},{id:"cmake",scopeName:"source.cmake",path:"cmake.tmLanguage.json",displayName:"CMake",samplePath:"cmake.sample"},{id:"cobol",scopeName:"source.cobol",path:"cobol.tmLanguage.json",displayName:"COBOL",samplePath:"cobol.sample",embeddedLangs:["sql","html","java"]},{id:"codeql",scopeName:"source.ql",path:"codeql.tmLanguage.json",displayName:"CodeQL",samplePath:"codeql.sample",aliases:["ql"]},{id:"coffee",scopeName:"source.coffee",path:"coffee.tmLanguage.json",displayName:"CoffeeScript",samplePath:"coffee.sample",embeddedLangs:["javascript"]},{id:"cpp",scopeName:"source.cpp",path:"cpp.tmLanguage.json",displayName:"C++",samplePath:"cpp.sample",aliases:["c++"],embeddedLangs:["glsl","sql"]},{id:"crystal",scopeName:"source.crystal",path:"crystal.tmLanguage.json",displayName:"Crystal",samplePath:"crystal.sample",embeddedLangs:["html","sql","css","c","javascript","shellscript"]},{id:"csharp",scopeName:"source.cs",path:"csharp.tmLanguage.json",displayName:"C#",samplePath:"csharp.sample",aliases:["c#","cs"]},{id:"css",scopeName:"source.css",path:"css.tmLanguage.json",displayName:"CSS",samplePath:"css.sample"},{id:"cue",scopeName:"source.cue",path:"cue.tmLanguage.json",displayName:"CUE",samplePath:"cue.sample"},{id:"cypher",scopeName:"source.cypher",path:"cypher.tmLanguage.json",displayName:"Cypher",samplePath:"cypher.sample",aliases:["cql"]},{id:"d",scopeName:"source.d",path:"d.tmLanguage.json",displayName:"D",samplePath:"d.sample"},{id:"dart",scopeName:"source.dart",path:"dart.tmLanguage.json",displayName:"Dart",samplePath:"dart.sample"},{id:"dax",scopeName:"source.dax",path:"dax.tmLanguage.json",displayName:"DAX",samplePath:"dax.sample"},{id:"diff",scopeName:"source.diff",path:"diff.tmLanguage.json",displayName:"Diff",samplePath:"diff.sample"},{id:"docker",scopeName:"source.dockerfile",path:"docker.tmLanguage.json",displayName:"Docker",samplePath:"docker.sample",aliases:["dockerfile"]},{id:"dream-maker",scopeName:"source.dm",path:"dream-maker.tmLanguage.json",displayName:"Dream Maker",samplePath:"dream-maker.sample"},{id:"elixir",scopeName:"source.elixir",path:"elixir.tmLanguage.json",displayName:"Elixir",samplePath:"elixir.sample",embeddedLangs:["html"]},{id:"elm",scopeName:"source.elm",path:"elm.tmLanguage.json",displayName:"Elm",samplePath:"elm.sample",embeddedLangs:["glsl"]},{id:"erb",scopeName:"text.html.erb",path:"erb.tmLanguage.json",displayName:"ERB",samplePath:"erb.sample",embeddedLangs:["html","ruby"]},{id:"erlang",scopeName:"source.erlang",path:"erlang.tmLanguage.json",displayName:"Erlang",samplePath:"erlang.sample",aliases:["erl"]},{id:"fish",scopeName:"source.fish",path:"fish.tmLanguage.json",displayName:"Fish",samplePath:"fish.sample"},{id:"fsharp",scopeName:"source.fsharp",path:"fsharp.tmLanguage.json",displayName:"F#",samplePath:"fsharp.sample",aliases:["f#","fs"],embeddedLangs:["markdown"]},{id:"gdresource",scopeName:"source.gdresource",path:"gdresource.tmLanguage.json",displayName:"GDResource",samplePath:"gdresource.sample",embeddedLangs:["gdshader","gdscript"]},{id:"gdscript",scopeName:"source.gdscript",path:"gdscript.tmLanguage.json",displayName:"GDScript",samplePath:"gdscript.sample"},{id:"gdshader",scopeName:"source.gdshader",path:"gdshader.tmLanguage.json",displayName:"GDShader",samplePath:"gdshader.sample"},{id:"gherkin",scopeName:"text.gherkin.feature",path:"gherkin.tmLanguage.json",displayName:"Gherkin",samplePath:"gherkin.sample"},{id:"git-commit",scopeName:"text.git-commit",path:"git-commit.tmLanguage.json",displayName:"Git Commit Message",embeddedLangs:["diff"]},{id:"git-rebase",scopeName:"text.git-rebase",path:"git-rebase.tmLanguage.json",displayName:"Git Rebase Message",embeddedLangs:["shellscript"]},{id:"glimmer-js",scopeName:"source.gjs",path:"glimmer-js.tmLanguage.json",displayName:"Glimmer JS",aliases:["gjs"],embeddedLangs:["javascript","handlebars"]},{id:"glimmer-ts",scopeName:"source.gts",path:"glimmer-ts.tmLanguage.json",displayName:"Glimmer TS",aliases:["gts"],embeddedLangs:["typescript","handlebars"]},{id:"glsl",scopeName:"source.glsl",path:"glsl.tmLanguage.json",displayName:"GLSL",samplePath:"glsl.sample",embeddedLangs:["c"]},{id:"gnuplot",scopeName:"source.gnuplot",path:"gnuplot.tmLanguage.json",displayName:"Gnuplot",samplePath:"gnuplot.sample"},{id:"go",scopeName:"source.go",path:"go.tmLanguage.json",displayName:"Go",samplePath:"go.sample"},{id:"graphql",scopeName:"source.graphql",path:"graphql.tmLanguage.json",displayName:"GraphQL",samplePath:"graphql.sample",aliases:["gql"],embeddedLangs:["javascript","typescript","jsx","tsx"]},{id:"groovy",scopeName:"source.groovy",path:"groovy.tmLanguage.json",displayName:"Groovy",samplePath:"groovy.sample"},{id:"hack",scopeName:"source.hack",path:"hack.tmLanguage.json",displayName:"Hack",samplePath:"hack.sample",embeddedLangs:["html","sql"]},{id:"haml",scopeName:"text.haml",path:"haml.tmLanguage.json",displayName:"Ruby Haml",samplePath:"haml.sample",embeddedLangs:["ruby","javascript","sass","coffee","markdown","css"]},{id:"handlebars",scopeName:"text.html.handlebars",path:"handlebars.tmLanguage.json",displayName:"Handlebars",samplePath:"handlebars.sample",aliases:["hbs"],embeddedLangs:["html","css","javascript","yaml"]},{id:"haskell",scopeName:"source.haskell",path:"haskell.tmLanguage.json",displayName:"Haskell",samplePath:"haskell.sample",aliases:["hs"]},{id:"hcl",scopeName:"source.hcl",path:"hcl.tmLanguage.json",displayName:"HashiCorp HCL",samplePath:"hcl.sample"},{id:"hjson",scopeName:"source.hjson",path:"hjson.tmLanguage.json",displayName:"Hjson",samplePath:"hjson.sample"},{id:"hlsl",scopeName:"source.hlsl",path:"hlsl.tmLanguage.json",displayName:"HLSL",samplePath:"hlsl.sample"},{id:"html",scopeName:"text.html.basic",path:"html.tmLanguage.json",displayName:"HTML",samplePath:"html.sample",embeddedLangs:["javascript","css"]},{id:"http",scopeName:"source.http",path:"http.tmLanguage.json",displayName:"HTTP",samplePath:"http.sample",embeddedLangs:["shellscript","json","xml","graphql"]},{id:"imba",scopeName:"source.imba",path:"imba.tmLanguage.json",displayName:"Imba",samplePath:"imba.sample"},{id:"ini",scopeName:"source.ini",path:"ini.tmLanguage.json",displayName:"INI",samplePath:"ini.sample",aliases:["properties"]},{id:"java",scopeName:"source.java",path:"java.tmLanguage.json",displayName:"Java",samplePath:"java.sample"},{id:"javascript",scopeName:"source.js",path:"javascript.tmLanguage.json",displayName:"JavaScript",samplePath:"javascript.sample",aliases:["js"]},{id:"jinja-html",scopeName:"text.html.jinja",path:"jinja-html.tmLanguage.json",displayName:"Jinja",samplePath:"jinja-html.sample",embeddedLangs:["html"]},{id:"jison",scopeName:"source.jison",path:"jison.tmLanguage.json",displayName:"Jison",samplePath:"jison.sample",embeddedLangs:["javascript"]},{id:"json",scopeName:"source.json",path:"json.tmLanguage.json",displayName:"JSON",samplePath:"json.sample"},{id:"json5",scopeName:"source.json5",path:"json5.tmLanguage.json",displayName:"JSON5",samplePath:"json5.sample"},{id:"jsonc",scopeName:"source.json.comments",path:"jsonc.tmLanguage.json",displayName:"JSON with Comments",samplePath:"jsonc.sample"},{id:"jsonl",scopeName:"source.json.lines",path:"jsonl.tmLanguage.json",displayName:"JSON Lines",samplePath:"jsonl.sample"},{id:"jsonnet",scopeName:"source.jsonnet",path:"jsonnet.tmLanguage.json",displayName:"Jsonnet",samplePath:"jsonnet.sample"},{id:"jssm",scopeName:"source.jssm",path:"jssm.tmLanguage.json",displayName:"JSSM",samplePath:"jssm.sample",aliases:["fsl"]},{id:"jsx",scopeName:"source.js.jsx",path:"jsx.tmLanguage.json",displayName:"JSX",samplePath:"jsx.sample"},{id:"julia",scopeName:"source.julia",path:"julia.tmLanguage.json",displayName:"Julia",samplePath:"julia.sample",embeddedLangs:["cpp","python","javascript","r","sql"]},{id:"kotlin",scopeName:"source.kotlin",path:"kotlin.tmLanguage.json",displayName:"Kotlin",samplePath:"kotlin.sample",aliases:["kt","kts"]},{id:"kusto",scopeName:"source.kusto",path:"kusto.tmLanguage.json",displayName:"Kusto",samplePath:"kusto.sample",aliases:["kql"]},{id:"latex",scopeName:"text.tex.latex",path:"latex.tmLanguage.json",displayName:"LaTeX",samplePath:"latex.sample",embeddedLangs:["tex","css","haskell","html","xml","java","lua","julia","ruby","javascript","typescript","python","yaml","rust","scala","gnuplot"]},{id:"less",scopeName:"source.css.less",path:"less.tmLanguage.json",displayName:"Less",samplePath:"less.sample",embeddedLangs:["css"]},{id:"liquid",scopeName:"text.html.liquid",path:"liquid.tmLanguage.json",displayName:"Liquid",samplePath:"liquid.sample",embeddedLangs:["html","css","json","javascript"]},{id:"lisp",scopeName:"source.lisp",path:"lisp.tmLanguage.json",displayName:"Lisp",samplePath:"lisp.sample"},{id:"logo",scopeName:"source.logo",path:"logo.tmLanguage.json",displayName:"Logo",samplePath:"logo.sample"},{id:"lua",scopeName:"source.lua",path:"lua.tmLanguage.json",displayName:"Lua",samplePath:"lua.sample",embeddedLangs:["c"]},{id:"make",scopeName:"source.makefile",path:"make.tmLanguage.json",displayName:"Makefile",samplePath:"make.sample",aliases:["makefile"]},{id:"markdown",scopeName:"text.html.markdown",path:"markdown.tmLanguage.json",displayName:"Markdown",samplePath:"markdown.sample",aliases:["md"],embeddedLangs:["css","html","ini","java","lua","make","perl","r","ruby","php","sql","vb","xml","xsl","yaml","bat","clojure","coffee","c","cpp","diff","docker","git-commit","git-rebase","go","groovy","pug","javascript","json","jsonc","less","objective-c","swift","scss","raku","powershell","python","julia","rust","scala","shellscript","typescript","tsx","csharp","fsharp","dart","handlebars","erlang","elixir","latex","bibtex"]},{id:"marko",scopeName:"text.marko",path:"marko.tmLanguage.json",displayName:"Marko",samplePath:"marko.sample",embeddedLangs:["css","less","scss","javascript"]},{id:"matlab",scopeName:"source.matlab",path:"matlab.tmLanguage.json",displayName:"MATLAB",samplePath:"matlab.sample"},{id:"mdc",scopeName:"text.markdown.mdc",path:"mdc.tmLanguage.json",displayName:"mdc",samplePath:"mdc.sample",embeddedLangs:["markdown","yaml"]},{id:"mdx",scopeName:"source.mdx",path:"mdx.tmLanguage.json",displayName:"MDX",samplePath:"mdx.sample",embeddedLangs:["tsx","toml","yaml","c","clojure","coffee","cpp","csharp","css","diff","docker","elixir","elm","erlang","go","graphql","haskell","html","ini","java","javascript","json","julia","kotlin","less","lua","make","markdown","objective-c","perl","python","r","ruby","rust","scala","scss","shellscript","shellsession","sql","xml","swift","typescript"]},{id:"mermaid",scopeName:"source.mermaid",path:"mermaid.tmLanguage.json",displayName:"Mermaid",samplePath:"mermaid.sample"},{id:"mojo",scopeName:"source.mojo",path:"mojo.tmLanguage.json",displayName:"MagicPython",samplePath:"mojo.sample"},{id:"narrat",scopeName:"source.narrat",path:"narrat.tmLanguage.json",displayName:"Narrat Language",samplePath:"narrat.sample",aliases:["nar"]},{id:"nextflow",scopeName:"source.nextflow",path:"nextflow.tmLanguage.json",displayName:"Nextflow",samplePath:"nextflow.sample",aliases:["nf"]},{id:"nginx",scopeName:"source.nginx",path:"nginx.tmLanguage.json",displayName:"Nginx",samplePath:"nginx.sample",embeddedLangs:["lua"]},{id:"nim",scopeName:"source.nim",path:"nim.tmLanguage.json",displayName:"Nim",samplePath:"nim.sample",embeddedLangs:["c","html","xml","javascript","css","glsl","markdown"]},{id:"nix",scopeName:"source.nix",path:"nix.tmLanguage.json",displayName:"Nix",samplePath:"nix.sample"},{id:"objective-c",scopeName:"source.objc",path:"objective-c.tmLanguage.json",displayName:"Objective-C",samplePath:"objective-c.sample",aliases:["objc"]},{id:"objective-cpp",scopeName:"source.objcpp",path:"objective-cpp.tmLanguage.json",displayName:"Objective-C++",samplePath:"objective-cpp.sample"},{id:"ocaml",scopeName:"source.ocaml",path:"ocaml.tmLanguage.json",displayName:"OCaml",samplePath:"ocaml.sample"},{id:"pascal",scopeName:"source.pascal",path:"pascal.tmLanguage.json",displayName:"Pascal",samplePath:"pascal.sample"},{id:"perl",scopeName:"source.perl",path:"perl.tmLanguage.json",displayName:"Perl",samplePath:"perl.sample",embeddedLangs:["html","xml","css","javascript","sql"]},{id:"php",scopeName:"source.php",path:"php.tmLanguage.json",displayName:"PHP",samplePath:"php.sample",embeddedLangs:["html","xml","sql","javascript","json","css"]},{id:"plsql",scopeName:"source.plsql.oracle",path:"plsql.tmLanguage.json",displayName:"PL/SQL",samplePath:"plsql.sample"},{id:"postcss",scopeName:"source.css.postcss",path:"postcss.tmLanguage.json",displayName:"PostCSS",samplePath:"postcss.sample"},{id:"powerquery",scopeName:"source.powerquery",path:"powerquery.tmLanguage.json",displayName:"PowerQuery",samplePath:"powerquery.sample"},{id:"powershell",scopeName:"source.powershell",path:"powershell.tmLanguage.json",displayName:"PowerShell",samplePath:"powershell.sample",aliases:["ps","ps1"]},{id:"prisma",scopeName:"source.prisma",path:"prisma.tmLanguage.json",displayName:"Prisma",samplePath:"prisma.sample"},{id:"prolog",scopeName:"source.prolog",path:"prolog.tmLanguage.json",displayName:"Prolog",samplePath:"prolog.sample"},{id:"proto",scopeName:"source.proto",path:"proto.tmLanguage.json",displayName:"Protocol Buffer 3",samplePath:"proto.sample"},{id:"pug",scopeName:"text.pug",path:"pug.tmLanguage.json",displayName:"Pug",samplePath:"pug.sample",aliases:["jade"],embeddedLangs:["javascript","css","sass","scss","stylus","coffee","html"]},{id:"puppet",scopeName:"source.puppet",path:"puppet.tmLanguage.json",displayName:"Puppet",samplePath:"puppet.sample"},{id:"purescript",scopeName:"source.purescript",path:"purescript.tmLanguage.json",displayName:"PureScript",samplePath:"purescript.sample"},{id:"python",scopeName:"source.python",path:"python.tmLanguage.json",displayName:"Python",samplePath:"python.sample",aliases:["py"]},{id:"r",scopeName:"source.r",path:"r.tmLanguage.json",displayName:"R",samplePath:"r.sample"},{id:"raku",scopeName:"source.perl.6",path:"raku.tmLanguage.json",displayName:"Raku",samplePath:"raku.sample",aliases:["perl6"]},{id:"razor",scopeName:"text.aspnetcorerazor",path:"razor.tmLanguage.json",displayName:"ASP.NET Razor",samplePath:"razor.sample",embeddedLangs:["html","csharp"]},{id:"reg",scopeName:"source.reg",path:"reg.tmLanguage.json",displayName:"Windows Registry Script",samplePath:"reg.sample"},{id:"rel",scopeName:"source.rel",path:"rel.tmLanguage.json",displayName:"Rel",samplePath:"rel.sample"},{id:"riscv",scopeName:"source.riscv",path:"riscv.tmLanguage.json",displayName:"RISC-V",samplePath:"riscv.sample"},{id:"rst",scopeName:"source.rst",path:"rst.tmLanguage.json",displayName:"reStructuredText",samplePath:"rst.sample",embeddedLangs:["cpp","python","javascript","shellscript","yaml","cmake","ruby"]},{id:"ruby",scopeName:"source.ruby",path:"ruby.tmLanguage.json",displayName:"Ruby",samplePath:"ruby.sample",aliases:["rb"],embeddedLangs:["html","xml","sql","css","c","javascript","shellscript","lua"]},{id:"rust",scopeName:"source.rust",path:"rust.tmLanguage.json",displayName:"Rust",samplePath:"rust.sample",aliases:["rs"]},{id:"sas",scopeName:"source.sas",path:"sas.tmLanguage.json",displayName:"SAS",samplePath:"sas.sample",embeddedLangs:["sql"]},{id:"sass",scopeName:"source.sass",path:"sass.tmLanguage.json",displayName:"Sass",samplePath:"sass.sample"},{id:"scala",scopeName:"source.scala",path:"scala.tmLanguage.json",displayName:"Scala",samplePath:"scala.sample"},{id:"scheme",scopeName:"source.scheme",path:"scheme.tmLanguage.json",displayName:"Scheme",samplePath:"scheme.sample"},{id:"scss",scopeName:"source.css.scss",path:"scss.tmLanguage.json",displayName:"SCSS",samplePath:"scss.sample",embeddedLangs:["css"]},{id:"shaderlab",scopeName:"source.shaderlab",path:"shaderlab.tmLanguage.json",displayName:"ShaderLab",samplePath:"shaderlab.sample",aliases:["shader"],embeddedLangs:["hlsl"]},{id:"shellscript",scopeName:"source.shell",path:"shellscript.tmLanguage.json",displayName:"Shell",samplePath:"shellscript.sample",aliases:["bash","sh","shell","zsh"]},{id:"shellsession",scopeName:"text.shell-session",path:"shellsession.tmLanguage.json",displayName:"Shell Session",samplePath:"shellsession.sample",aliases:["console"],embeddedLangs:["shellscript"]},{id:"smalltalk",scopeName:"source.smalltalk",path:"smalltalk.tmLanguage.json",displayName:"Smalltalk",samplePath:"smalltalk.sample"},{id:"solidity",scopeName:"source.solidity",path:"solidity.tmLanguage.json",displayName:"Solidity",samplePath:"solidity.sample"},{id:"sparql",scopeName:"source.sparql",path:"sparql.tmLanguage.json",displayName:"SPARQL",samplePath:"sparql.sample",embeddedLangs:["turtle"]},{id:"splunk",scopeName:"source.splunk_search",path:"splunk.tmLanguage.json",displayName:"Splunk Query Language",samplePath:"splunk.sample",aliases:["spl"]},{id:"sql",scopeName:"source.sql",path:"sql.tmLanguage.json",displayName:"SQL",samplePath:"sql.sample"},{id:"ssh-config",scopeName:"source.ssh-config",path:"ssh-config.tmLanguage.json",displayName:"SSH Config",samplePath:"ssh-config.sample"},{id:"stata",scopeName:"source.stata",path:"stata.tmLanguage.json",displayName:"Stata",samplePath:"stata.sample",embeddedLangs:["sql"]},{id:"stylus",scopeName:"source.stylus",path:"stylus.tmLanguage.json",displayName:"Stylus",samplePath:"stylus.sample",aliases:["styl"]},{id:"svelte",scopeName:"source.svelte",path:"svelte.tmLanguage.json",displayName:"Svelte",samplePath:"svelte.sample",embeddedLangs:["javascript","typescript","coffee","stylus","sass","css","scss","less","postcss","pug","markdown"]},{id:"swift",scopeName:"source.swift",path:"swift.tmLanguage.json",displayName:"Swift",samplePath:"swift.sample"},{id:"system-verilog",scopeName:"source.systemverilog",path:"system-verilog.tmLanguage.json",displayName:"SystemVerilog",samplePath:"system-verilog.sample"},{id:"tasl",scopeName:"source.tasl",path:"tasl.tmLanguage.json",displayName:"Tasl",samplePath:"tasl.sample"},{id:"tcl",scopeName:"source.tcl",path:"tcl.tmLanguage.json",displayName:"Tcl",samplePath:"tcl.sample"},{id:"tex",scopeName:"text.tex",path:"tex.tmLanguage.json",displayName:"TeX",samplePath:"tex.sample",embeddedLangs:["r"]},{id:"toml",scopeName:"source.toml",path:"toml.tmLanguage.json",displayName:"TOML",samplePath:"toml.sample"},{id:"tsx",scopeName:"source.tsx",path:"tsx.tmLanguage.json",displayName:"TSX",samplePath:"tsx.sample"},{id:"turtle",scopeName:"source.turtle",path:"turtle.tmLanguage.json",displayName:"Turtle",samplePath:"turtle.sample"},{id:"twig",scopeName:"text.html.twig",path:"twig.tmLanguage.json",displayName:"Twig",samplePath:"twig.sample",embeddedLangs:["css","javascript","php","python","ruby"]},{id:"typescript",scopeName:"source.ts",path:"typescript.tmLanguage.json",displayName:"TypeScript",samplePath:"typescript.sample",aliases:["ts"]},{id:"v",scopeName:"source.v",path:"v.tmLanguage.json",displayName:"V",samplePath:"v.sample"},{id:"vb",scopeName:"source.asp.vb.net",path:"vb.tmLanguage.json",displayName:"Visual Basic",samplePath:"vb.sample",aliases:["cmd"]},{id:"verilog",scopeName:"source.verilog",path:"verilog.tmLanguage.json",displayName:"Verilog",samplePath:"verilog.sample"},{id:"vhdl",scopeName:"source.vhdl",path:"vhdl.tmLanguage.json",displayName:"VHDL",samplePath:"vhdl.sample"},{id:"viml",scopeName:"source.viml",path:"viml.tmLanguage.json",displayName:"Vim Script",samplePath:"viml.sample",aliases:["vim","vimscript"]},{id:"vue-html",scopeName:"text.html.vue-html",path:"vue-html.tmLanguage.json",displayName:"Vue HTML",samplePath:"vue-html.sample",embeddedLangs:["vue","javascript"]},{id:"vue",scopeName:"source.vue",path:"vue.tmLanguage.json",displayName:"Vue",samplePath:"vue.sample",embeddedLangs:["html","markdown","pug","stylus","sass","css","scss","less","javascript","typescript","jsx","tsx","json","jsonc","json5","yaml","toml","graphql"]},{id:"vyper",scopeName:"source.vyper",path:"vyper.tmLanguage.json",displayName:"Vyper",samplePath:"vyper.sample",aliases:["vy"]},{id:"wasm",scopeName:"source.wat",path:"wasm.tmLanguage.json",displayName:"WebAssembly",samplePath:"wasm.sample"},{id:"wenyan",scopeName:"source.wenyan",path:"wenyan.tmLanguage.json",displayName:"Wenyan",samplePath:"wenyan.sample",aliases:["文言"]},{id:"wgsl",scopeName:"source.wgsl",path:"wgsl.tmLanguage.json",displayName:"WGSL",samplePath:"wgsl.sample"},{id:"wolfram",scopeName:"source.wolfram",path:"wolfram.tmLanguage.json",displayName:"Wolfram",samplePath:"wolfram.sample"},{id:"xml",scopeName:"text.xml",path:"xml.tmLanguage.json",displayName:"XML",samplePath:"xml.sample",embeddedLangs:["java"]},{id:"xsl",scopeName:"text.xml.xsl",path:"xsl.tmLanguage.json",displayName:"XSL",samplePath:"xsl.sample",embeddedLangs:["xml"]},{id:"yaml",scopeName:"source.yaml",path:"yaml.tmLanguage.json",displayName:"YAML",samplePath:"yaml.sample",aliases:["yml"]},{id:"zenscript",scopeName:"source.zenscript",path:"zenscript.tmLanguage.json",displayName:"ZenScript",samplePath:"zenscript.sample"},{id:"zig",scopeName:"source.zig",path:"zig.tmLanguage.json",displayName:"zig",samplePath:"zig.sample"}];var FontStyle=(k=>(k[k.NotSet=-1]="NotSet",k[k.None=0]="None",k[k.Italic=1]="Italic",k[k.Bold=2]="Bold",k[k.Underline=4]="Underline",k))(FontStyle||{});class StackElementMetadata{static toBinaryStr(_){let y=_.toString(2);for(;y.length<32;)y="0"+y;return y}static printMetadata(_){let y=StackElementMetadata.getLanguageId(_),w=StackElementMetadata.getTokenType(_),$=StackElementMetadata.getFontStyle(_),B=StackElementMetadata.getForeground(_),R=StackElementMetadata.getBackground(_);console.log({languageId:y,tokenType:w,fontStyle:$,foreground:B,background:R})}static getLanguageId(_){return(_&255)>>>0}static getTokenType(_){return(_&768)>>>8}static getFontStyle(_){return(_&14336)>>>11}static getForeground(_){return(_&8372224)>>>15}static getBackground(_){return(_&4286578688)>>>24}static containsBalancedBrackets(_){return(_&1024)!==0}static set(_,y,w,$,B,R){let H=StackElementMetadata.getLanguageId(_),j=StackElementMetadata.getTokenType(_),q=StackElementMetadata.getFontStyle(_),X=StackElementMetadata.getForeground(_),ee=StackElementMetadata.getBackground(_),te=StackElementMetadata.containsBalancedBrackets(_)?1:0;return y!==0&&(H=y),w!==0&&(j=w===8?0:w),$!==-1&&(q=$),B!==0&&(X=B),R!==0&&(ee=R),(H<<0|j<<8|q<<11|te<<10|X<<15|ee<<24)>>>0}}function trimEndSlash(k){return k.endsWith("/")||k.endsWith("\\")?k.slice(0,-1):k}function trimStartDot(k){return k.startsWith("./")?k.slice(2):k}function dirpathparts(k){const _=k.split(/[\/\\]/g);return _.slice(0,_.length-1)}function join(...k){return k.map(trimEndSlash).map(trimStartDot).join("/")}function groupBy(k,_){const y=new Map;for(const w of k){const $=_(w);y.has($)?y.get($).push(w):y.set($,[w])}return y}function createScanner(k,_=!1){const y=k.length;let w=0,$="",B=0,R=16,H=0,j=0,q=0,X=0,ee=0;function te(le,ue){let he=0,ce=0;for(;he<le||!ue;){let ge=k.charCodeAt(w);if(ge>=48&&ge<=57)ce=ce*16+ge-48;else if(ge>=65&&ge<=70)ce=ce*16+ge-65+10;else if(ge>=97&&ge<=102)ce=ce*16+ge-97+10;else break;w++,he++}return he<le&&(ce=-1),ce}function ne(le){w=le,$="",B=0,R=16,ee=0}function oe(){let le=w;if(k.charCodeAt(w)===48)w++;else for(w++;w<k.length&&isDigit(k.charCodeAt(w));)w++;if(w<k.length&&k.charCodeAt(w)===46)if(w++,w<k.length&&isDigit(k.charCodeAt(w)))for(w++;w<k.length&&isDigit(k.charCodeAt(w));)w++;else return ee=3,k.substring(le,w);let ue=w;if(w<k.length&&(k.charCodeAt(w)===69||k.charCodeAt(w)===101))if(w++,(w<k.length&&k.charCodeAt(w)===43||k.charCodeAt(w)===45)&&w++,w<k.length&&isDigit(k.charCodeAt(w))){for(w++;w<k.length&&isDigit(k.charCodeAt(w));)w++;ue=w}else ee=3;return k.substring(le,ue)}function ie(){let le="",ue=w;for(;;){if(w>=y){le+=k.substring(ue,w),ee=2;break}const he=k.charCodeAt(w);if(he===34){le+=k.substring(ue,w),w++;break}if(he===92){if(le+=k.substring(ue,w),w++,w>=y){ee=2;break}switch(k.charCodeAt(w++)){case 34:le+='"';break;case 92:le+="\\";break;case 47:le+="/";break;case 98:le+="\b";break;case 102:le+="\f";break;case 110:le+=`
`;break;case 114:le+="\r";break;case 116:le+="	";break;case 117:const ge=te(4,!0);ge>=0?le+=String.fromCharCode(ge):ee=4;break;default:ee=5}ue=w;continue}if(he>=0&&he<=31)if(isLineBreak(he)){le+=k.substring(ue,w),ee=2;break}else ee=6;w++}return le}function ae(){if($="",ee=0,B=w,j=H,X=q,w>=y)return B=y,R=17;let le=k.charCodeAt(w);if(isWhiteSpace(le)){do w++,$+=String.fromCharCode(le),le=k.charCodeAt(w);while(isWhiteSpace(le));return R=15}if(isLineBreak(le))return w++,$+=String.fromCharCode(le),le===13&&k.charCodeAt(w)===10&&(w++,$+=`
`),H++,q=w,R=14;switch(le){case 123:return w++,R=1;case 125:return w++,R=2;case 91:return w++,R=3;case 93:return w++,R=4;case 58:return w++,R=6;case 44:return w++,R=5;case 34:return w++,$=ie(),R=10;case 47:const ue=w-1;if(k.charCodeAt(w+1)===47){for(w+=2;w<y&&!isLineBreak(k.charCodeAt(w));)w++;return $=k.substring(ue,w),R=12}if(k.charCodeAt(w+1)===42){w+=2;const he=y-1;let ce=!1;for(;w<he;){const ge=k.charCodeAt(w);if(ge===42&&k.charCodeAt(w+1)===47){w+=2,ce=!0;break}w++,isLineBreak(ge)&&(ge===13&&k.charCodeAt(w)===10&&w++,H++,q=w)}return ce||(w++,ee=1),$=k.substring(ue,w),R=13}return $+=String.fromCharCode(le),w++,R=16;case 45:if($+=String.fromCharCode(le),w++,w===y||!isDigit(k.charCodeAt(w)))return R=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return $+=oe(),R=11;default:for(;w<y&&re(le);)w++,le=k.charCodeAt(w);if(B!==w){switch($=k.substring(B,w),$){case"true":return R=8;case"false":return R=9;case"null":return R=7}return R=16}return $+=String.fromCharCode(le),w++,R=16}}function re(le){if(isWhiteSpace(le)||isLineBreak(le))return!1;switch(le){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function se(){let le;do le=ae();while(le>=12&&le<=15);return le}return{setPosition:ne,getPosition:()=>w,scan:_?se:ae,getToken:()=>R,getTokenValue:()=>$,getTokenOffset:()=>B,getTokenLength:()=>w-B,getTokenStartLine:()=>j,getTokenStartCharacter:()=>B-X,getTokenError:()=>ee}}function isWhiteSpace(k){return k===32||k===9}function isLineBreak(k){return k===10||k===13}function isDigit(k){return k>=48&&k<=57}var CharacterCodes;(function(k){k[k.lineFeed=10]="lineFeed",k[k.carriageReturn=13]="carriageReturn",k[k.space=32]="space",k[k._0=48]="_0",k[k._1=49]="_1",k[k._2=50]="_2",k[k._3=51]="_3",k[k._4=52]="_4",k[k._5=53]="_5",k[k._6=54]="_6",k[k._7=55]="_7",k[k._8=56]="_8",k[k._9=57]="_9",k[k.a=97]="a",k[k.b=98]="b",k[k.c=99]="c",k[k.d=100]="d",k[k.e=101]="e",k[k.f=102]="f",k[k.g=103]="g",k[k.h=104]="h",k[k.i=105]="i",k[k.j=106]="j",k[k.k=107]="k",k[k.l=108]="l",k[k.m=109]="m",k[k.n=110]="n",k[k.o=111]="o",k[k.p=112]="p",k[k.q=113]="q",k[k.r=114]="r",k[k.s=115]="s",k[k.t=116]="t",k[k.u=117]="u",k[k.v=118]="v",k[k.w=119]="w",k[k.x=120]="x",k[k.y=121]="y",k[k.z=122]="z",k[k.A=65]="A",k[k.B=66]="B",k[k.C=67]="C",k[k.D=68]="D",k[k.E=69]="E",k[k.F=70]="F",k[k.G=71]="G",k[k.H=72]="H",k[k.I=73]="I",k[k.J=74]="J",k[k.K=75]="K",k[k.L=76]="L",k[k.M=77]="M",k[k.N=78]="N",k[k.O=79]="O",k[k.P=80]="P",k[k.Q=81]="Q",k[k.R=82]="R",k[k.S=83]="S",k[k.T=84]="T",k[k.U=85]="U",k[k.V=86]="V",k[k.W=87]="W",k[k.X=88]="X",k[k.Y=89]="Y",k[k.Z=90]="Z",k[k.asterisk=42]="asterisk",k[k.backslash=92]="backslash",k[k.closeBrace=125]="closeBrace",k[k.closeBracket=93]="closeBracket",k[k.colon=58]="colon",k[k.comma=44]="comma",k[k.dot=46]="dot",k[k.doubleQuote=34]="doubleQuote",k[k.minus=45]="minus",k[k.openBrace=123]="openBrace",k[k.openBracket=91]="openBracket",k[k.plus=43]="plus",k[k.slash=47]="slash",k[k.formFeed=12]="formFeed",k[k.tab=9]="tab"})(CharacterCodes||(CharacterCodes={}));var ParseOptions;(function(k){k.DEFAULT={allowTrailingComma:!1}})(ParseOptions||(ParseOptions={}));function parse$1(k,_=[],y=ParseOptions.DEFAULT){let w=null,$=[];const B=[];function R(j){Array.isArray($)?$.push(j):w!==null&&($[w]=j)}return visit(k,{onObjectBegin:()=>{const j={};R(j),B.push($),$=j,w=null},onObjectProperty:j=>{w=j},onObjectEnd:()=>{$=B.pop()},onArrayBegin:()=>{const j=[];R(j),B.push($),$=j,w=null},onArrayEnd:()=>{$=B.pop()},onLiteralValue:R,onError:(j,q,X)=>{_.push({error:j,offset:q,length:X})}},y),$[0]}function visit(k,_,y=ParseOptions.DEFAULT){const w=createScanner(k,!1),$=[];function B(ve){return ve?()=>ve(w.getTokenOffset(),w.getTokenLength(),w.getTokenStartLine(),w.getTokenStartCharacter()):()=>!0}function R(ve){return ve?()=>ve(w.getTokenOffset(),w.getTokenLength(),w.getTokenStartLine(),w.getTokenStartCharacter(),()=>$.slice()):()=>!0}function H(ve){return ve?ke=>ve(ke,w.getTokenOffset(),w.getTokenLength(),w.getTokenStartLine(),w.getTokenStartCharacter()):()=>!0}function j(ve){return ve?ke=>ve(ke,w.getTokenOffset(),w.getTokenLength(),w.getTokenStartLine(),w.getTokenStartCharacter(),()=>$.slice()):()=>!0}const q=R(_.onObjectBegin),X=j(_.onObjectProperty),ee=B(_.onObjectEnd),te=R(_.onArrayBegin),ne=B(_.onArrayEnd),oe=j(_.onLiteralValue),ie=H(_.onSeparator),ae=B(_.onComment),re=H(_.onError),se=y&&y.disallowComments,le=y&&y.allowTrailingComma;function ue(){for(;;){const ve=w.scan();switch(w.getTokenError()){case 4:he(14);break;case 5:he(15);break;case 3:he(13);break;case 1:se||he(11);break;case 2:he(12);break;case 6:he(16);break}switch(ve){case 12:case 13:se?he(10):ae();break;case 16:he(1);break;case 15:case 14:break;default:return ve}}}function he(ve,ke=[],me=[]){if(re(ve),ke.length+me.length>0){let Ie=w.getToken();for(;Ie!==17;){if(ke.indexOf(Ie)!==-1){ue();break}else if(me.indexOf(Ie)!==-1)break;Ie=ue()}}}function ce(ve){const ke=w.getTokenValue();return ve?oe(ke):(X(ke),$.push(ke)),ue(),!0}function ge(){switch(w.getToken()){case 11:const ve=w.getTokenValue();let ke=Number(ve);isNaN(ke)&&(he(2),ke=0),oe(ke);break;case 7:oe(null);break;case 8:oe(!0);break;case 9:oe(!1);break;default:return!1}return ue(),!0}function be(){return w.getToken()!==10?(he(3,[],[2,5]),!1):(ce(!1),w.getToken()===6?(ie(":"),ue(),Ce()||he(4,[],[2,5])):he(5,[],[2,5]),$.pop(),!0)}function fe(){q(),ue();let ve=!1;for(;w.getToken()!==2&&w.getToken()!==17;){if(w.getToken()===5){if(ve||he(4,[],[]),ie(","),ue(),w.getToken()===2&&le)break}else ve&&he(6,[],[]);be()||he(4,[],[2,5]),ve=!0}return ee(),w.getToken()!==2?he(7,[2],[]):ue(),!0}function we(){te(),ue();let ve=!0,ke=!1;for(;w.getToken()!==4&&w.getToken()!==17;){if(w.getToken()===5){if(ke||he(4,[],[]),ie(","),ue(),w.getToken()===4&&le)break}else ke&&he(6,[],[]);ve?($.push(0),ve=!1):$[$.length-1]++,Ce()||he(4,[],[4,5]),ke=!0}return ne(),ve||$.pop(),w.getToken()!==4?he(8,[4],[]):ue(),!0}function Ce(){switch(w.getToken()){case 3:return we();case 1:return fe();case 10:return ce(!0);default:return ge()}}return ue(),w.getToken()===17?y.allowEmptyContent?!0:(he(4,[],[]),!1):Ce()?(w.getToken()!==17&&he(9,[],[]),!0):(he(4,[],[]),!1)}var ScanError;(function(k){k[k.None=0]="None",k[k.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",k[k.UnexpectedEndOfString=2]="UnexpectedEndOfString",k[k.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",k[k.InvalidUnicode=4]="InvalidUnicode",k[k.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",k[k.InvalidCharacter=6]="InvalidCharacter"})(ScanError||(ScanError={}));var SyntaxKind;(function(k){k[k.OpenBraceToken=1]="OpenBraceToken",k[k.CloseBraceToken=2]="CloseBraceToken",k[k.OpenBracketToken=3]="OpenBracketToken",k[k.CloseBracketToken=4]="CloseBracketToken",k[k.CommaToken=5]="CommaToken",k[k.ColonToken=6]="ColonToken",k[k.NullKeyword=7]="NullKeyword",k[k.TrueKeyword=8]="TrueKeyword",k[k.FalseKeyword=9]="FalseKeyword",k[k.StringLiteral=10]="StringLiteral",k[k.NumericLiteral=11]="NumericLiteral",k[k.LineCommentTrivia=12]="LineCommentTrivia",k[k.BlockCommentTrivia=13]="BlockCommentTrivia",k[k.LineBreakTrivia=14]="LineBreakTrivia",k[k.Trivia=15]="Trivia",k[k.Unknown=16]="Unknown",k[k.EOF=17]="EOF"})(SyntaxKind||(SyntaxKind={}));const parse=parse$1;var ParseErrorCode;(function(k){k[k.InvalidSymbol=1]="InvalidSymbol",k[k.InvalidNumberFormat=2]="InvalidNumberFormat",k[k.PropertyNameExpected=3]="PropertyNameExpected",k[k.ValueExpected=4]="ValueExpected",k[k.ColonExpected=5]="ColonExpected",k[k.CommaExpected=6]="CommaExpected",k[k.CloseBraceExpected=7]="CloseBraceExpected",k[k.CloseBracketExpected=8]="CloseBracketExpected",k[k.EndOfFileExpected=9]="EndOfFileExpected",k[k.InvalidCommentToken=10]="InvalidCommentToken",k[k.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",k[k.UnexpectedEndOfString=12]="UnexpectedEndOfString",k[k.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",k[k.InvalidUnicode=14]="InvalidUnicode",k[k.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",k[k.InvalidCharacter=16]="InvalidCharacter"})(ParseErrorCode||(ParseErrorCode={}));const isWebWorker=typeof self<"u"&&typeof self.WorkerGlobalScope<"u",isNode="process"in globalThis&&typeof process<"u"&&typeof process.release<"u"&&process.release.name==="node",isBun="process"in globalThis&&typeof process<"u"&&typeof process.release<"u"&&process.release.name==="bun",isBrowser=isWebWorker||!isNode&&!isBun;let CDN_ROOT="";const WASM_PATH="dist/";let _onigurumaPromise=null;async function getOniguruma(k){if(!_onigurumaPromise){let _;if(isBrowser)_=mainExports$1.loadWASM({data:await fetch(_resolvePath(join(...dirpathparts(k),"onig.wasm")))});else{const w=require("path").join(require.resolve("vscode-oniguruma"),"../onig.wasm"),B=require("fs").readFileSync(w).buffer;_=mainExports$1.loadWASM(B)}_onigurumaPromise=_.then(()=>({createOnigScanner(y){return mainExports$1.createOnigScanner(y)},createOnigString(y){return mainExports$1.createOnigString(y)}}))}return _onigurumaPromise}function _resolvePath(k){if(isBrowser)return`${CDN_ROOT}${k}`;{const _=require("path");return _.isAbsolute(k)?k:_.resolve(__dirname,"..",k)}}async function _fetchAssets(k){const _=_resolvePath(k);return isBrowser?await fetch(_).then(y=>y.text()):await require("fs").promises.readFile(_,"utf-8")}async function _fetchJSONAssets(k){const _=[],y=await _fetchAssets(k);let w;try{w=JSON.parse(y)}catch{if(w=parse(y,_,{allowTrailingComma:!0}),_.length)throw _[0]}return w}async function fetchTheme(k){let _=await _fetchJSONAssets(k);const y=toShikiTheme(_);if(y.include){const w=await fetchTheme(join(...dirpathparts(k),y.include));w.settings&&(y.settings=w.settings.concat(y.settings)),w.bg&&!y.bg&&(y.bg=w.bg),w.colors&&(y.colors={...w.colors,...y.colors}),delete y.include}return y}async function fetchGrammar(k){return await _fetchJSONAssets(k)}function repairTheme(k){k.settings||(k.settings=[]),!(k.settings[0]&&k.settings[0].settings&&!k.settings[0].scope)&&k.settings.unshift({settings:{foreground:k.fg,background:k.bg}})}function toShikiTheme(k){const _=k.type||"dark",y={name:k.name,type:_,...k,...getThemeDefaultColors(k)};return k.include&&(y.include=k.include),k.tokenColors&&(y.settings=k.tokenColors,delete y.tokenColors),repairTheme(y),y}const VSCODE_FALLBACK_EDITOR_FG={light:"#333333",dark:"#bbbbbb"},VSCODE_FALLBACK_EDITOR_BG={light:"#fffffe",dark:"#1e1e1e"};function getThemeDefaultColors(k){let _,y,w=k.settings?k.settings:k.tokenColors;const $=w?w.find(B=>!B.name&&!B.scope):void 0;return $?.settings?.foreground&&(_=$.settings.foreground),$?.settings?.background&&(y=$.settings.background),!_&&k?.colors?.["editor.foreground"]&&(_=k.colors["editor.foreground"]),!y&&k?.colors?.["editor.background"]&&(y=k.colors["editor.background"]),_||(_=k.type==="light"?VSCODE_FALLBACK_EDITOR_FG.light:VSCODE_FALLBACK_EDITOR_FG.dark),y||(y=k.type==="light"?VSCODE_FALLBACK_EDITOR_BG.light:VSCODE_FALLBACK_EDITOR_BG.dark),{fg:_,bg:y}}class Resolver{constructor(_,y){this.languagesPath="languages/",this.languageMap={},this.scopeToLangMap={},this._onigLibPromise=_,this._onigLibName=y}get onigLib(){return this._onigLibPromise}getOnigLibName(){return this._onigLibName}getLangRegistration(_){return this.languageMap[_]}async loadGrammar(_){const y=this.scopeToLangMap[_];if(!y)return null;if(y.grammar)return y.grammar;const w=await fetchGrammar(languages.includes(y)?`${this.languagesPath}${y.path}`:y.path);return y.grammar=w,w}addLanguage(_){this.languageMap[_.id]=_,_.aliases&&_.aliases.forEach(y=>{this.languageMap[y]=_}),this.scopeToLangMap[_.scopeName]=_}}function tokenizeWithTheme(k,_,y,w,$){let B=y.split(/\r\n|\r|\n/),R=mainExports.INITIAL,H=[],j=[];for(let q=0,X=B.length;q<X;q++){let ee=B[q];if(ee===""){H=[],j.push([]);continue}let te,ne,oe;$.includeExplanation&&(te=w.tokenizeLine(ee,R),ne=te.tokens,oe=0);let ie=w.tokenizeLine2(ee,R),ae=ie.tokens.length/2;for(let re=0;re<ae;re++){let se=ie.tokens[2*re],le=re+1<ae?ie.tokens[2*re+2]:ee.length;if(se===le)continue;let ue=ie.tokens[2*re+1],he=StackElementMetadata.getForeground(ue),ce=_[he],ge=StackElementMetadata.getFontStyle(ue),be=[];if($.includeExplanation){let fe=0;for(;se+fe<le;){let we=ne[oe],Ce=ee.substring(we.startIndex,we.endIndex);fe+=Ce.length,be.push({content:Ce,scopes:explainThemeScopes(k,we.scopes)}),oe++}}H.push({content:ee.substring(se,le),color:ce,fontStyle:ge,explanation:be})}j.push(H),H=[],R=ie.ruleStack}return j}function explainThemeScopes(k,_){let y=[];for(let w=0,$=_.length;w<$;w++){let B=_.slice(0,w),R=_[w];y[w]={scopeName:R,themeMatches:explainThemeScope(k,R,B)}}return y}function matchesOne(k,_){let y=k+".";return k===_||_.substring(0,y.length)===y}function matches$1(k,_,y,w){if(!matchesOne(k,y))return!1;let $=_.length-1,B=w.length-1;for(;$>=0&&B>=0;)matchesOne(_[$],w[B])&&$--,B--;return $===-1}function explainThemeScope(k,_,y){let w=[],$=0;for(let B=0,R=k.settings.length;B<R;B++){let H=k.settings[B],j;if(typeof H.scope=="string")j=H.scope.split(/,/).map(q=>q.trim());else if(Array.isArray(H.scope))j=H.scope;else continue;for(let q=0,X=j.length;q<X;q++){let te=j[q].split(/ /),ne=te[te.length-1],oe=te.slice(0,te.length-1);matches$1(ne,oe,_,y)&&(w[$++]=H,q=X)}}return w}var namedColors=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],decorations={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",9:"strikethrough"};function findSequence(k,_){const y=k.indexOf("\x1B",_);if(y!==-1&&k[y+1]==="["){const w=k.indexOf("m",y);return{sequence:k.substring(y+2,w).split(";"),startPosition:y,position:w+1}}return{position:k.length}}function parseColor(k){const _=k.shift();if(_==="2"){const y=k.splice(0,3).map(w=>Number.parseInt(w));return y.length!==3||y.some(w=>Number.isNaN(w))?void 0:{type:"rgb",rgb:y}}else if(_==="5"){const y=k.shift();if(y)return{type:"table",index:Number(y)}}}function parseSequence(k){const _=[];for(;k.length>0;){const y=k.shift();if(!y)continue;const w=Number.parseInt(y);if(!Number.isNaN(w))if(w===0)_.push({type:"resetAll"});else if(w<=9)decorations[w]&&_.push({type:"setDecoration",value:decorations[w]});else if(w<=29){const $=decorations[w-20];$&&_.push({type:"resetDecoration",value:$})}else if(w<=37)_.push({type:"setForegroundColor",value:{type:"named",name:namedColors[w-30]}});else if(w===38){const $=parseColor(k);$&&_.push({type:"setForegroundColor",value:$})}else if(w===39)_.push({type:"resetForegroundColor"});else if(w<=47)_.push({type:"setBackgroundColor",value:{type:"named",name:namedColors[w-40]}});else if(w===48){const $=parseColor(k);$&&_.push({type:"setBackgroundColor",value:$})}else w===49?_.push({type:"resetBackgroundColor"}):w>=90&&w<=97?_.push({type:"setForegroundColor",value:{type:"named",name:namedColors[w-90+8]}}):w>=100&&w<=107&&_.push({type:"setBackgroundColor",value:{type:"named",name:namedColors[w-100+8]}})}return _}function createAnsiSequenceParser(){let k=null,_=null,y=new Set;return{parse(w){const $=[];let B=0;do{const R=findSequence(w,B),H=R.sequence?w.substring(B,R.startPosition):w.substring(B);if(H.length>0&&$.push({value:H,foreground:k,background:_,decorations:new Set(y)}),R.sequence){const j=parseSequence(R.sequence);for(const q of j)q.type==="resetAll"?(k=null,_=null,y.clear()):q.type==="resetForegroundColor"?k=null:q.type==="resetBackgroundColor"?_=null:q.type==="resetDecoration"&&y.delete(q.value);for(const q of j)q.type==="setForegroundColor"?k=q.value:q.type==="setBackgroundColor"?_=q.value:q.type==="setDecoration"&&y.add(q.value)}B=R.position}while(B<w.length);return $}}}var defaultNamedColorsMap={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function createColorPalette(k=defaultNamedColorsMap){function _(H){return k[H]}function y(H){return`#${H.map(j=>Math.max(0,Math.min(j,255)).toString(16).padStart(2,"0")).join("")}`}let w;function $(){if(w)return w;w=[];for(let q=0;q<namedColors.length;q++)w.push(_(namedColors[q]));let H=[0,95,135,175,215,255];for(let q=0;q<6;q++)for(let X=0;X<6;X++)for(let ee=0;ee<6;ee++)w.push(y([H[q],H[X],H[ee]]));let j=8;for(let q=0;q<24;q++,j+=10)w.push(y([j,j,j]));return w}function B(H){return $()[H]}function R(H){switch(H.type){case"named":return _(H.name);case"rgb":return y(H.rgb);case"table":return B(H.index)}}return{value:R}}function tokenizeAnsiWithTheme(k,_){const y=_.split(/\r?\n/),w=createColorPalette(Object.fromEntries(namedColors.map(B=>[B,k.colors[`terminal.ansi${B[0].toUpperCase()}${B.substring(1)}`]]))),$=createAnsiSequenceParser();return y.map(B=>$.parse(B).map(R=>{let H;R.decorations.has("reverse")?H=R.background?w.value(R.background):k.bg:H=R.foreground?w.value(R.foreground):k.fg,R.decorations.has("dim")&&(H=dimColor(H));let j=FontStyle.None;return R.decorations.has("bold")&&(j|=FontStyle.Bold),R.decorations.has("italic")&&(j|=FontStyle.Italic),R.decorations.has("underline")&&(j|=FontStyle.Underline),{content:R.value,color:H,fontStyle:j}}))}function dimColor(k){const _=k.match(/#([0-9a-f]{3})([0-9a-f]{3})?([0-9a-f]{2})?/);if(_)if(_[3]){const w=Math.round(Number.parseInt(_[3],16)/2).toString(16).padStart(2,"0");return`#${_[1]}${_[2]}${w}`}else return _[2]?`#${_[1]}${_[2]}80`:`#${Array.from(_[1]).map(w=>`${w}${w}`).join("")}80`;const y=k.match(/var\((--shiki-color-ansi-[\w-]+)\)/);return y?`var(${y[1]}-dim)`:k}const defaultElements={pre({className:k,style:_,children:y}){return`<pre class="${k}" style="${_}" tabindex="0">${y}</pre>`},code({children:k}){return`<code>${k}</code>`},line({className:k,children:_}){return`<span class="${k}">${_}</span>`},token({style:k,children:_}){return`<span style="${k}">${_}</span>`}};function renderToHtml(k,_={}){const y=_.bg||"#fff",w=groupBy(_.lineOptions??[],R=>R.line),$=_.elements||{};function B(R="",H={},j){const q=$[R]||defaultElements[R];return q?(j=j.filter(Boolean),q({...H,children:R==="code"?j.join(`
`):j.join("")})):""}return B("pre",{className:"shiki "+(_.themeName||""),style:`background-color: ${y}`},[_.langId?`<div class="language-id">${_.langId}</div>`:"",B("code",{},k.map((R,H)=>{const j=H+1,q=w.get(j)??[],X=getLineClasses(q).join(" ");return B("line",{className:X,lines:k,line:R,index:H},R.map((ee,te)=>{const ne=[`color: ${ee.color||_.fg}`];return ee.fontStyle&FontStyle.Italic&&ne.push("font-style: italic"),ee.fontStyle&FontStyle.Bold&&ne.push("font-weight: bold"),ee.fontStyle&FontStyle.Underline&&ne.push("text-decoration: underline"),B("token",{style:ne.join("; "),tokens:R,token:ee,index:te},[escapeHtml(ee.content)])}))}))])}const htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function escapeHtml(k){return k.replace(/[&<>"']/g,_=>htmlEscapes[_])}function getLineClasses(k){const _=new Set(["line"]);for(const y of k)for(const w of y.classes??[])_.add(w);return Array.from(_)}class Registry extends mainExports.Registry{constructor(_){super(_),this._resolver=_,this.themesPath="themes/",this._resolvedThemes={},this._resolvedGrammars={},this._langGraph=new Map,this._langMap=languages.reduce((y,w)=>(y[w.id]=w,y),{})}getTheme(_){return typeof _=="string"?this._resolvedThemes[_]:_}async loadTheme(_){return typeof _=="string"?(this._resolvedThemes[_]||(this._resolvedThemes[_]=await fetchTheme(`${this.themesPath}${_}.json`)),this._resolvedThemes[_]):(_=toShikiTheme(_),_.name&&(this._resolvedThemes[_.name]=_),_)}async loadThemes(_){return await Promise.all(_.map(y=>this.loadTheme(y)))}getLoadedThemes(){return Object.keys(this._resolvedThemes)}getGrammar(_){return this._resolvedGrammars[_]}async loadLanguage(_){const w={embeddedLanguages:_.embeddedLangs?.reduce(async(B,R,H)=>{if(!this.getLoadedLanguages().includes(R)&&this._resolver.getLangRegistration(R))return await this._resolver.loadGrammar(this._resolver.getLangRegistration(R).scopeName),B[this._resolver.getLangRegistration(R).scopeName]=H+2,B},{}),balancedBracketSelectors:_.balancedBracketSelectors||["*"],unbalancedBracketSelectors:_.unbalancedBracketSelectors||[]},$=await this.loadGrammarWithConfiguration(_.scopeName,1,w);this._resolvedGrammars[_.id]=$,_.aliases&&_.aliases.forEach(B=>{this._resolvedGrammars[B]=$})}async loadLanguages(_){for(const w of _)this.resolveEmbeddedLanguages(w);const y=Array.from(this._langGraph.values());for(const w of y)this._resolver.addLanguage(w);for(const w of y)await this.loadLanguage(w)}getLoadedLanguages(){return Object.keys(this._resolvedGrammars)}resolveEmbeddedLanguages(_){if(this._langGraph.has(_.id)||this._langGraph.set(_.id,_),_.embeddedLangs)for(const y of _.embeddedLangs)this._langGraph.set(y,this._langMap[y])}}function resolveLang(k){return typeof k=="string"?languages.find(_=>_.id===k||_.aliases?.includes(k)):k}function resolveOptions(k){let _=languages,y=k.themes||[],w=k.paths?.wasm?k.paths.wasm.endsWith("/")?k.paths.wasm:k.paths.wasm+"/":WASM_PATH;return k.langs&&(_=k.langs.map(resolveLang)),k.theme&&y.unshift(k.theme),y.length||(y=["nord"]),{_languages:_,_themes:y,_wasmPath:w}}function generateDefaultColorReplacements(){const k={"#000001":"var(--shiki-color-text)","#000002":"var(--shiki-color-background)","#000004":"var(--shiki-token-constant)","#000005":"var(--shiki-token-string)","#000006":"var(--shiki-token-comment)","#000007":"var(--shiki-token-keyword)","#000008":"var(--shiki-token-parameter)","#000009":"var(--shiki-token-function)","#000010":"var(--shiki-token-string-expression)","#000011":"var(--shiki-token-punctuation)","#000012":"var(--shiki-token-link)"};for(let _=0;_<namedColors.length;_++){const y=`#A${_.toString().padStart(5,"0")}`,w=namedColors[_].replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();k[y]=`var(--shiki-color-ansi-${w})`}return k}async function getHighlighter(k){const{_languages:_,_themes:y,_wasmPath:w}=resolveOptions(k),$=new Resolver(getOniguruma(w),"vscode-oniguruma"),B=new Registry($);k.paths?.themes&&(B.themesPath=k.paths.themes.endsWith("/")?k.paths.themes:k.paths.themes+"/"),k.paths?.languages&&($.languagesPath=k.paths.languages.endsWith("/")?k.paths.languages:k.paths.languages+"/");const H=(await B.loadThemes(y))[0];let j;await B.loadLanguages(_);let q=generateDefaultColorReplacements();function X(be){q=be}function ee(be,fe){be.bg=q[be.bg]||be.bg,be.fg=q[be.fg]||be.fg,Object.entries(be.colors).forEach(([we,Ce])=>{be.colors[we]=q[Ce]||Ce}),fe.forEach((we,Ce)=>{fe[Ce]=q[we]||we})}function te(be){const fe=be?B.getTheme(be):H;if(!fe)throw Error(`No theme registration for ${be}`);(!j||j.name!==fe.name)&&(B.setTheme(fe),j=fe);const we=B.getColorMap();return fe.type==="css"&&ee(fe,we),{_theme:fe,_colorMap:we}}function ne(be){const fe=B.getGrammar(be);if(!fe)throw Error(`No language registration for ${be}`);return{_grammar:fe}}function oe(be,fe="text",we,Ce={includeExplanation:!0}){if(isPlaintext$1(fe))return[...be.split(/\r\n|\r|\n/).map(Fe=>[{content:Fe}])];const{_grammar:ve}=ne(fe),{_theme:ke,_colorMap:me}=te(we);return tokenizeWithTheme(ke,me,be,ve,Ce)}function ie(be,fe){const{_theme:we}=te(fe);return tokenizeAnsiWithTheme(we,be)}function ae(be,fe="text",we){let Ce;typeof fe=="object"?Ce=fe:Ce={lang:fe,theme:we};const ve=oe(be,Ce.lang,Ce.theme,{includeExplanation:!1}),{_theme:ke}=te(Ce.theme);return renderToHtml(ve,{fg:ke.fg,bg:ke.bg,lineOptions:Ce?.lineOptions,themeName:ke.name})}function re(be,fe){const we=ie(be,fe?.theme),{_theme:Ce}=te(fe?.theme);return renderToHtml(we,{fg:Ce.fg,bg:Ce.bg,lineOptions:fe?.lineOptions,themeName:Ce.name})}async function se(be){await B.loadTheme(be)}async function le(be){const fe=resolveLang(be);$.addLanguage(fe),await B.loadLanguage(fe)}function ue(){return B.getLoadedThemes()}function he(){return B.getLoadedLanguages()}function ce(be){const{_theme:fe}=te(be);return fe.bg}function ge(be){const{_theme:fe}=te(be);return fe.fg}return{codeToThemedTokens:oe,codeToHtml:ae,ansiToThemedTokens:ie,ansiToHtml:re,getTheme:be=>te(be)._theme,loadTheme:se,loadLanguage:le,getBackgroundColor:ce,getForegroundColor:ge,getLoadedThemes:ue,getLoadedLanguages:he,setColorReplacements:X}}function isPlaintext$1(k){return!k||["plaintext","txt","text"].includes(k)}const DARK_THEME="gh/fisheva/Eva-Theme@master/themes/Eva-Dark",LIGHT_THEME="npm/shiki@0.14.1/themes/github-light",FALLBACK_LANG="Plain Text",PLAIN_TEXT_REGISTRATION={id:FALLBACK_LANG,displayName:FALLBACK_LANG,scopeName:"source.plaintext",path:"PLEASE-DO-NOT-USE-THIS",aliases:["plaintext","txt","text"]},PopularLanguages=["python","c","java","cpp","csharp","vb","javascript","php","sql","asm","pascal","go","swift","matlab","r","rust","ruby","sas","ada","perl","objective-c","cobol","lisp","dart","lua","julia","d","kotlin","logo","scala","haskell","fsharp","scheme","typescript","groovy","abap","prolog","plsql","bash","apex","markdown","json","html","css","diff","jsx","tsx","vue"],POPULAR_LANGUAGES_MAP=PopularLanguages.reduce((k,_,y)=>({[_]:y,...k}),{});function getLanguagePriority(k,_=!1){return _?-1/0:POPULAR_LANGUAGES_MAP[k]??1/0}function isPlaintext(k){return[PLAIN_TEXT_REGISTRATION.id,...PLAIN_TEXT_REGISTRATION.aliases].includes(k.toLowerCase())}const getStandardLanguage=(k,_=!1)=>{if(!k||isPlaintext(k))return null;const y=languages.find($=>$.id.toLowerCase()===k.toLowerCase());return y||(_?null:languages.find($=>$.aliases?.includes(k.toLowerCase()))??null)};class CodeBlockService extends BaseService{constructor(){super(...arguments),this.highlightOptionsGetter=null}setHighlightOptionsGetter(_){this.highlightOptionsGetter=_}setLang(_,y){const $=(y?getStandardLanguage(y):null)?.id??FALLBACK_LANG;_.page.updateBlock(_,{language:$})}async block2html(_,{childText:y="",begin:w,end:$}={}){const B=document.querySelector(`[${BLOCK_ID_ATTR}="${_.id}"] rich-text`);if(!B)return await super.block2html(_,{childText:y,begin:w,end:$});assertExists(this.highlightOptionsGetter,"highlightOptionsGetter is not set");const{lang:R,highlighter:H}=this.highlightOptionsGetter(),j=document.createElement("pre"),q=document.createElement("code");return j.setAttribute("code-lang",_.language),q.innerHTML=Array.from(B.querySelectorAll("v-line")).map(X=>X.textContent+`
`).join(""),j.append(q),H?H.codeToHtml(q.innerHTML,{lang:R,theme:queryCurrentMode()==="dark"?DARK_THEME:LIGHT_THEME})??j.outerHTML:j.outerHTML}block2Json(_,y,w,$){return{...super.block2Json(_,y,w,$),language:_.language}}async json2Block(_,y,w){assertExists(w);const R=y.map(j=>j.text).map(j=>j?.map(q=>q.insert).join("")).join(`
`);_.text?.insert(R,w.index);const H=getVirgoByModel(_);assertExists(H),H.setVRange({index:w.index+w.length,length:0})}}class LegacyDatabaseBlockService extends BaseService{initDatabaseBlock(_,y,w,$,B=!0){const R=_.getBlockById(w);if(assertExists(R),R.initTemplate($),B){const H=_.getParent(y);assertExists(H),_.addBlock("affine:paragraph",{},H.id)}R.applyColumnUpdate()}block2Json(_){const y=[..._.columns],w=_.children.map(B=>B.id),$=_.children?.map(B=>getService$1(B.flavour).block2Json(B));return{flavour:_.flavour,databaseProps:{id:_.id,title:_.title.toString(),rowIds:w,cells:_.cells,columns:y,views:_.views},children:$}}async onBlockPasted(_,y){const{rowIds:w,columns:$,cells:B}=y,R=$.map(q=>q.id);_.deleteColumn(_.id);const H=$.map(q=>_.addColumn("end",q));_.applyColumnUpdate();const j=_.children.map(q=>q.id);w.forEach((q,X)=>{const ee=j[X];R.forEach((te,ne)=>{const ie=B[q]?.[te]?.value;ie&&_.updateCell(ee,{columnId:H[ne],value:ie})})})}}class DividerBlockService extends BaseService{async block2html(){return"<hr/>"}}class ImageBlockService extends BaseService{async block2html(_,y={},w){const $=_.sourceId;let B=$;if(w)if(w.has($))B=w.get($)??"";else{const R=await _.page.blobs.get($);if(R){const H=await this.getBlobType(R);B=`images/${$}.${H.split("/")[1]}`,w.set($,B)}}return`<figure><img src="${B}" alt="${_.caption}"><figcaption>${_.caption}</figcaption></figure>`}block2Text(_,y={}){return _.caption??""}block2Json(_,y,w,$){return{sourceId:_.sourceId,width:_.width,height:_.height,caption:_.caption,flavour:_.flavour,children:[]}}}class ListBlockService extends BaseService{async block2html(_,{childText:y="",begin:w,end:$}={}){let B=await super.block2html(_,{childText:y,begin:w,end:$});const R=_.page.getPreviousSibling(_),H=_.page.getNextSibling(_);switch(_.type){case"bulleted":case"toggle":B=`<li>${B}</li>`;break;case"numbered":B=`<li>${B}</li>`;break;case"todo":B=`<li><input disabled type="checkbox" ${_.checked?"checked":""}>${B}</li>`;break}if(R?.flavour!==_.flavour||R.type!==_.type)switch(_.type){case"bulleted":case"toggle":case"todo":B=`<ul>${B}`;break;case"numbered":B=`<ol>${B}`;break}if(H?.flavour!==_.flavour||H.type!==_.type)switch(_.type){case"bulleted":case"toggle":case"todo":B=`${B}</ul>`;break;case"numbered":B=`${B}</ol>`;break}return B}async json2Block(_,y,w){const $=y[0].flavour!=="affine:list";return json2block(_,y,{textRangePoint:w,convertToPastedIfEmpty:$})}}class NoteBlockService extends BaseService{async json2Block(_,y){await addSerializedBlocks(_.page,y,_,0)}block2Json(_,y,w,$){const B=_.text?.sliceToDelta(w??0,$)??[];return{id:_.id,flavour:_.flavour,text:B,xywh:_.xywh,background:_.background,children:y??_.children.map((R,H,j)=>H===j.length-1?getService(R.flavour).block2Json(R,0,$):getService(R.flavour).block2Json(R))}}}const REFERENCE_NODE=" ",DEFAULT_PAGE_NAME$1="Untitled";class PageBlockService extends BaseService{async block2html(_,{childText:y=""}={}){let w="";if((_.page.meta.tags??[]).length>0){const B=_.page.workspace.meta.properties.tags?.options??[],R=Object.fromEntries(B.map(H=>[H.id,H]));w=`
        <div class="page-meta-data meta-data-expanded">
          <div class="meta-data-expanded-title">
            <div>Page info</div>
          </div>
          <div class="meta-data-expanded-content">
            <div class="meta-data-expanded-item">
              <div class="type">${this.templateResult2String(TagsIcon)}</div>
              <div class="value">
                <div class="tags">
                  ${(_.page.meta.tags??[]).map(H=>{const j=R[H];return j?`<div class="tag" style="background-color: ${j.color}">${j.value}</div>`:""}).join("")}
                </div>
              </div>
            </div>
          </div>
        </div>
      `}return`<header><h1 class="page-title">${_.title.toString()??DEFAULT_PAGE_NAME$1}</h1>${w}</header><div>${y}</div>`}block2Text(_,{childText:y="",begin:w,end:$}={}){return`${(_.title.toString()||"").slice(w||0,$)}${y}`}_getAllSubTexts(_){if(_.flavour==="affine:database")return[];const y=(_.text||[]).filter(w=>!w.attributes?.link);return _.children&&_.children.forEach(w=>{y.push(...this._getAllSubTexts(w))}),y}async json2Block(_,y){if(y.length>0&&(y[0].children.length===0||y[0].flavour==="affine:page")){const R=this._getAllSubTexts(y[0]);_.title.applyDelta(R),y=y.slice(1)}const w=_.page.addBlock("affine:note",{},_.id),$=_.page.getBlockById(w);assertExists($),getService$1("affine:note").json2Block($,y)}}class ParagraphBlockService extends BaseService{async block2html(_,{childText:y="",begin:w,end:$}={}){const B=await super.block2html(_,{childText:"",begin:w,end:$});let R="";switch(_.type){case"text":R=`<p>${B}</p>`,y&&(R=`${R}<div style="padding-left: 26px">${y}</div>`);break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":R=`<${_.type}>${B}</${_.type}>`,y&&(R=`${R}<div style="padding-left: 26px">${y}</div>`);break;case"quote":R=`<blockquote class="quote">${B}</blockquote>`,y&&(R=`<blockquote class="quote">${B}<div style="padding-left: 26px">${y}</div></blockquote>`);break;default:R=B}return R}async json2Block(_,y,w){const $=_.type!=="text";return json2block(_,y,{textRangePoint:w,convertToPastedIfEmpty:$})}}const blockService={"affine:page":PageBlockService,"affine:code":CodeBlockService,"affine:database":LegacyDatabaseBlockService,"affine:paragraph":ParagraphBlockService,"affine:list":ListBlockService,"affine:image":ImageBlockService,"affine:divider":DividerBlockService,"affine:note":NoteBlockService,"affine:bookmark":BookmarkBlockService,"affine:attachment":AttachmentBlockService};function registerAllBlocks(){Object.entries(blockService).forEach(([k,_])=>{registerService(k,_)})}function getServiceOrRegister(k){const _=services.get(k);if(!_){const y=blockService[k]??BaseService,w=registerService(k,y);return w instanceof Promise?w.then(()=>services.get(k)):services.get(k)}return _}function b(k){const _=k.replace(/\n/g,"").replace(/[\s]{2,}/g," ");return`data:image/svg+xml,${encodeURIComponent(_)}`}const p=b(`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M10.6944 8.33487C10.9653 7.67285 11.6283 7.21423 12.3869 7.21423C13.1346 7.21423 13.7895 7.65975 14.0675 8.30642C14.3487 8.13443 14.6802 8.03569 15.0322 8.03569C16.0254 8.03569 16.8548 8.82187 16.8548 9.8214V9.90652C17.103 9.78332 17.383 9.71426 17.6774 9.71426C18.6706 9.71426 19.5 10.5004 19.5 11.5V14.5714C19.5 18.4111 16.3018 21.5 12.3869 21.5C11.4279 21.5 10.5029 21.3687 9.61008 20.9533C8.71611 20.5373 7.89034 19.8532 7.10147 18.8019L5.08581 16.1683C4.51001 15.4567 4.57347 14.4352 5.23 13.797C5.93899 13.1078 7.08249 13.1078 7.79148 13.797L7.79968 13.805C7.84226 13.8483 7.88165 13.889 7.91846 13.9273C7.92006 13.726 7.91977 13.4872 7.91942 13.2045C7.91926 13.0733 7.91909 12.9325 7.91909 12.7817V9.85709C7.91909 8.85756 8.74847 8.07138 9.7417 8.07138C10.0887 8.07138 10.4158 8.16735 10.6944 8.33487ZM10.5643 9.85712C10.5643 9.43634 10.2095 9.07138 9.7417 9.07138C9.27389 9.07138 8.91909 9.43633 8.91909 9.85709V12.7817C8.91909 12.9257 8.91926 13.0621 8.91943 13.1909C8.92002 13.6625 8.92049 14.0329 8.91187 14.307C8.9064 14.481 8.89684 14.6361 8.87748 14.7637C8.8624 14.863 8.82868 15.055 8.70064 15.2061C8.62011 15.3012 8.49922 15.3839 8.34225 15.4068C8.19872 15.4279 8.07952 15.3907 8.00536 15.3581C7.87099 15.299 7.7587 15.1973 7.68787 15.1301C7.60764 15.0539 7.49797 14.9378 7.37723 14.8099C7.28546 14.7128 7.18728 14.6088 7.09077 14.5105C6.76957 14.2021 6.24669 14.2033 5.92703 14.514C5.63861 14.7944 5.614 15.2343 5.86566 15.5423L5.87549 15.5548L7.90002 18.2C8.61071 19.1475 9.31465 19.7129 10.032 20.0466C10.751 20.3812 11.5195 20.5 12.3869 20.5C15.7764 20.5 18.5 17.8323 18.5 14.5714V11.5C18.5 11.0792 18.1452 10.7143 17.6774 10.7143C17.2096 10.7143 16.8548 11.0792 16.8548 11.5V12C16.8548 12.2761 16.6309 12.5 16.3548 12.5C16.0786 12.5 15.8548 12.2761 15.8548 12V9.8214C15.8548 9.40064 15.5 9.03569 15.0322 9.03569C14.5643 9.03569 14.2095 9.40064 14.2095 9.8214V11.1428C14.2095 11.419 13.9857 11.6428 13.7095 11.6428C13.4334 11.6428 13.2095 11.419 13.2095 11.1428V8.99995C13.2095 8.57919 12.8547 8.21423 12.3869 8.21423C11.9191 8.21423 11.5643 8.57919 11.5643 8.99995V11.1428C11.5643 11.419 11.3405 11.6428 11.0643 11.6428C10.7882 11.6428 10.5643 11.419 10.5643 11.1428V9.85712Z"
      fill="black"
    />
    <path
      d="M9.7417 9.07138C10.2095 9.07138 10.5643 9.43634 10.5643 9.85712V11.1428C10.5643 11.419 10.7882 11.6428 11.0643 11.6428C11.3405 11.6428 11.5643 11.419 11.5643 11.1428V8.99995C11.5643 8.57919 11.9191 8.21423 12.3869 8.21423C12.8547 8.21423 13.2095 8.57919 13.2095 8.99995V11.1428C13.2095 11.419 13.4334 11.6428 13.7095 11.6428C13.9857 11.6428 14.2095 11.419 14.2095 11.1428V9.8214C14.2095 9.40064 14.5643 9.03569 15.0322 9.03569C15.5 9.03569 15.8548 9.40064 15.8548 9.8214V12C15.8548 12.2761 16.0786 12.5 16.3548 12.5C16.6309 12.5 16.8548 12.2761 16.8548 12V11.5C16.8548 11.0792 17.2096 10.7143 17.6774 10.7143C18.1452 10.7143 18.5 11.0792 18.5 11.5V14.5714C18.5 17.8323 15.7764 20.5 12.3869 20.5C11.5195 20.5 10.751 20.3812 10.032 20.0466C9.31465 19.7129 8.61071 19.1475 7.90002 18.2L5.87549 15.5548L5.86566 15.5423C5.614 15.2343 5.63861 14.7944 5.92703 14.514C6.24669 14.2033 6.76957 14.2021 7.09077 14.5105C7.18728 14.6088 7.28546 14.7128 7.37723 14.8099C7.49797 14.9378 7.60764 15.0539 7.68787 15.1301C7.7587 15.1973 7.87099 15.299 8.00536 15.3581C8.07952 15.3907 8.19872 15.4279 8.34225 15.4068C8.49922 15.3839 8.62011 15.3012 8.70064 15.2061C8.82868 15.055 8.8624 14.863 8.87748 14.7637C8.89684 14.6361 8.9064 14.481 8.91187 14.307C8.92049 14.0329 8.92002 13.6625 8.91943 13.1909C8.91926 13.0621 8.91909 12.9257 8.91909 12.7817V9.85709C8.91909 9.43633 9.27389 9.07138 9.7417 9.07138Z"
      fill="white"
    />
  </svg>
`),C=b(`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M10.6944 3.62063C10.9653 2.95862 11.6283 2.5 12.3869 2.5C13.3802 2.5 14.2096 3.28619 14.2096 4.28571V4.40655C14.4578 4.28334 14.7378 4.21429 15.0322 4.21429C16.0254 4.21429 16.8548 5.00047 16.8548 6V6.97798C17.103 6.85477 17.383 6.78571 17.6774 6.78571C18.6706 6.78571 19.5 7.5719 19.5 8.57143V14.5714C19.5 18.4111 16.3018 21.5 12.3869 21.5C11.4279 21.5 10.5029 21.3687 9.61009 20.9533C8.71742 20.538 7.89275 19.8553 7.10492 18.8065L3.89715 14.8057C3.31723 14.0938 3.37951 13.0692 4.03749 12.4296C4.74649 11.7404 5.88998 11.7404 6.59897 12.4296C6.60945 12.4398 6.61948 12.4504 6.62902 12.4615L7.19243 13.1145C7.49969 13.4896 7.73216 13.7452 7.90552 13.9094C7.90575 13.9058 7.90599 13.9021 7.90621 13.8984C7.92066 13.6641 7.92009 13.374 7.91941 13.0239C7.91926 12.9461 7.9191 12.8654 7.9191 12.7817V5.14286C7.9191 4.14333 8.74848 3.35714 9.74172 3.35714C10.0887 3.35714 10.4158 3.45312 10.6944 3.62063ZM11.5643 11.1429C11.5643 11.419 11.3405 11.6429 11.0643 11.6429C10.7882 11.6429 10.5643 11.419 10.5643 11.1429V5.14286C10.5643 4.7221 10.2095 4.35714 9.74172 4.35714C9.2739 4.35714 8.9191 4.7221 8.9191 5.14286V12.7817C8.9191 12.858 8.91927 12.9337 8.91943 13.0085C8.92019 13.3597 8.92092 13.6907 8.90432 13.9599C8.89417 14.1245 8.87652 14.2886 8.84181 14.4348C8.80979 14.5696 8.74873 14.7552 8.60644 14.9018C8.43071 15.0827 8.19413 15.142 7.96546 15.0976C7.77497 15.0607 7.60654 14.9565 7.46937 14.8519C7.18917 14.6383 6.84626 14.2699 6.4228 13.7533L5.88792 13.1333C5.56593 12.8348 5.05078 12.8392 4.73453 13.1467C4.44611 13.427 4.4215 13.8669 4.67315 14.175L4.67604 14.1785L7.89011 18.1872L7.90002 18.2C8.6107 19.1476 9.31466 19.7129 10.032 20.0467C10.751 20.3813 11.5195 20.5 12.3869 20.5C15.7764 20.5 18.5 17.8323 18.5 14.5714V8.57143C18.5 8.15067 18.1452 7.78571 17.6774 7.78571C17.2096 7.78571 16.8548 8.15067 16.8548 8.57143V12C16.8548 12.2761 16.6309 12.5 16.3548 12.5C16.0786 12.5 15.8548 12.2761 15.8548 12V6C15.8548 5.57924 15.5 5.21429 15.0322 5.21429C14.5644 5.21429 14.2096 5.57924 14.2096 6V11.1429C14.2096 11.419 13.9857 11.6429 13.7096 11.6429C13.4334 11.6429 13.2096 11.419 13.2096 11.1429V4.28571C13.2096 3.86496 12.8548 3.5 12.3869 3.5C11.9191 3.5 11.5643 3.86496 11.5643 4.28571V11.1429Z"
      fill="black"
    />
    <path
      d="M11.0643 11.6429C11.3405 11.6429 11.5643 11.419 11.5643 11.1429V4.28571C11.5643 3.86496 11.9191 3.5 12.3869 3.5C12.8548 3.5 13.2096 3.86496 13.2096 4.28571V11.1429C13.2096 11.419 13.4334 11.6429 13.7096 11.6429C13.9857 11.6429 14.2096 11.419 14.2096 11.1429V6C14.2096 5.57924 14.5644 5.21429 15.0322 5.21429C15.5 5.21429 15.8548 5.57924 15.8548 6V12C15.8548 12.2761 16.0786 12.5 16.3548 12.5C16.6309 12.5 16.8548 12.2761 16.8548 12V8.57143C16.8548 8.15067 17.2096 7.78571 17.6774 7.78571C18.1452 7.78571 18.5 8.15067 18.5 8.57143V14.5714C18.5 17.8323 15.7764 20.5 12.3869 20.5C11.5195 20.5 10.751 20.3813 10.032 20.0467C9.31466 19.7129 8.6107 19.1476 7.90002 18.2L7.89011 18.1872L4.67604 14.1785L4.67315 14.175C4.4215 13.8669 4.44611 13.427 4.73453 13.1467C5.05078 12.8392 5.56593 12.8348 5.88792 13.1333L6.4228 13.7533C6.84626 14.2699 7.18917 14.6383 7.46937 14.8519C7.60654 14.9565 7.77497 15.0607 7.96546 15.0976C8.19413 15.142 8.43071 15.0827 8.60644 14.9018C8.74873 14.7552 8.80979 14.5696 8.84181 14.4348C8.87652 14.2886 8.89417 14.1245 8.90432 13.9599C8.92092 13.6907 8.92019 13.3597 8.91943 13.0085C8.91927 12.9337 8.9191 12.858 8.9191 12.7817V5.14286C8.9191 4.7221 9.2739 4.35714 9.74172 4.35714C10.2095 4.35714 10.5643 4.7221 10.5643 5.14286V11.1429C10.5643 11.419 10.7882 11.6429 11.0643 11.6429Z"
      fill="white"
    />
  </svg>
`),t=k=>typeof k!="string"?"":k.replace(/-/g,"_").replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z])([A-Z])(?=[a-z])/g,"$1-$2").toLowerCase().replace(/(\D+)(\d+)$/g,"$1-$2").replace(/\s|_/g,"-"),g=(k,_)=>`url(${k}), ${_.join(", ")}`,e="apple-system, BlinkMacSystemFont,'Helvetica Neue', Tahoma, 'PingFang SC', 'Microsoft Yahei', Arial,'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",l={fontFamily:`'Inter', 'Source Sans 3', Poppins, ${e}`,fontSerifFamily:`'Source Serif 4', 'Noto Serif' , serif, 'Cambria', ${e}`,fontMonoFamily:`'Source Code Pro', 'IBM Plex Mono', 'Roboto Mono','Noto Sans Mono', 'Noto Sans CJK',  ${e}`,fontSansFamily:`'Inter', 'Source Sans 3', Poppins, ${e}`,fontNumberFamily:`'Roboto Mono', 'Noto Sans Mono', ${e}`,fontCodeFamily:`'Space Mono', Consolas, Menlo, Monaco, Courier, monospace, ${e}`,fontTitle:"36px",fontH1:"28px",fontH2:"26px",fontH3:"24px",fontH4:"22px",fontH5:"20px",fontH6:"18px",fontBase:"15px",fontSm:"14px",fontXs:"12px",lineHeight:"calc(1em + 8px)",zIndexModal:"1000",zIndexPopover:"1000",paragraphSpace:"8px",popoverRadius:"12px",editorWidth:"944px",editorSidePadding:"96px",zoom:"1",scale:"calc(1 / var(--affine-zoom))",paletteLineYellow:"rgb(255, 211, 56)",paletteLineOrange:"rgb(255, 175, 56)",paletteLineTangerine:"rgb(250, 124, 69)",paletteLineRed:"rgb(237, 63, 63)",paletteLineMagenta:"rgb(230, 96, 164)",paletteLinePurple:"rgb(110, 82, 223)",paletteLineNavy:"rgb(59, 37, 204)",paletteLineBlue:"rgb(79, 144, 255)",paletteLineGreen:"rgb(124, 194, 112)",paletteLineWhite:"rgb(255, 255, 255)",paletteLineBlack:"rgb(35, 35, 35)",paletteLineGrey:"rgb(191, 192, 191)",paletteShapeYellow:"rgb(255, 223, 107)",paletteShapeOrange:"rgb(255, 196, 107)",paletteShapeTangerine:"rgb(251, 161, 121)",paletteShapeRed:"rgb(241, 111, 111)",paletteShapeMagenta:"rgb(237, 140, 189)",paletteShapePurple:"rgb(147, 126, 231)",paletteShapeNavy:"rgb(122, 149, 246)",paletteShapeBlue:"rgb(184, 227, 255)",paletteShapeGreen:"rgb(157, 209, 148)",paletteShapeWhite:"rgb(255, 255, 255)",paletteShapeBlack:"rgb(35, 35, 35)",paletteShapeGrey:"rgb(216, 217, 216)",multiPlayersPurple:"rgba(123,97,255,1)",multiPlayersMagenta:"rgba(245, 49, 179, 1)",multiPlayersRed:"rgba(243,87,52,1)",multiPlayersOrange:"rgba(255, 138, 0, 1)",multiPlayersGreen:"rgba(27, 196, 125, 1)",multiPlayersBlue:"rgba(24, 160, 251, 1)",multiPlayersBrown:"rgba(154, 101, 51, 1)",multiPlayersGrey:"rgba(170, 170, 170, 1)",blue:"rgba(30, 150, 235, 1)",pureBlack:"rgba(0, 0, 0, 1)",pureBlack10:"rgba(0, 0, 0, 0.1)",pureBlack20:"rgba(0, 0, 0, 0.2)",pureBlack80:"rgba(0, 0, 0, 0.8)",pureWhite:"rgba(255, 255, 255, 1)",pureWhite10:"rgba(255, 255, 255, 0.1)",toggleCircleBackgroundColor:"rgba(255, 255, 255, 1)",toggleDisableBackgroundColor:"rgba(119, 117, 125, 1)",toggleCircleShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.25), inset -2px -3px 2px 0px rgba(0, 0, 0, 0.05)",buttonInnerShadow:" 0px 1px 2px 0px rgba(255, 255, 255, 0.25) inset",multiCursorsShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.28)",multiPlayersShadow:"0px 1px 6px 0px rgba(0, 0, 0, 0.16)",grabbingCursor:g(p,["grabbing"]),grabCursor:g(C,["grab"])},n$1={...l,themeMode:"light",brandColor:"#1E96EB",tertiaryColor:"rgba(239, 250, 255, 1)",primaryColor:"#1E96EB",primaryColor04:"rgba(30, 150, 235, 0.04)",secondaryColor:"rgb(125, 145, 255)",blue50:"rgba(239, 250, 255, 1)",blue100:"rgba(219, 244, 254, 1)",blue200:"rgba(191, 236, 254, 1)",blue300:"rgba(147, 226, 253, 1)",blue400:"rgba(96, 207, 250, 1)",blue500:"rgba(58, 181, 247, 1)",blue600:"rgba(30, 150, 235, 1)",blue700:"rgba(28, 129, 217, 1)",blue800:"rgba(30, 103, 175, 1)",blue900:"rgba(30, 87, 138, 1)",blue950:"rgba(23, 54, 84, 1)",backgroundSuccessColor:"rgba(231, 250, 243, 1)",backgroundErrorColor:"rgba(253, 236, 235, 1)",backgroundProcessingColor:"rgba(233, 241, 255, 1)",backgroundWarningColor:"rgba(255, 237, 219, 1)",backgroundPrimaryColor:"rgb(255, 255, 255)",backgroundOverlayPanelColor:"rgb(251, 251, 252)",backgroundSecondaryColor:"rgba(244, 244, 245, 1)",backgroundTertiaryColor:"rgb(238, 238, 238)",backgroundCodeBlock:"rgba(247, 246, 250, 1)",backgroundModalColor:"rgba(0, 0, 0, 0.75)",textPrimaryColor:"rgb(66, 65, 73)",textSecondaryColor:"rgb(142, 141, 145)",textDisableColor:"rgb(169, 169, 173)",textEmphasisColor:"#1E96EB",hoverColor:"rgba(0, 0, 0, 0.04)",hoverColorFilled:"rgb(245, 245, 245)",linkColor:"#1E67AF",quoteColor:"rgba(194, 193, 197, 1)",listColor:"rgba(133, 131, 140, 1)",iconColor:"rgb(119, 117, 125)",iconSecondary:"rgba(119, 117, 125, 0.6)",borderColor:"rgb(227, 226, 228)",dividerColor:"rgb(227, 226, 228)",placeholderColor:"rgb(192, 191, 193)",edgelessGridColor:"rgb(230, 230, 230)",successColor:"rgb(16, 203, 134)",warningColor:"rgb(235, 67, 53)",errorColor:"rgb(235, 67, 53)",processingColor:"rgb(39, 118, 255)",black10:"rgba(0, 0, 0, 0.1)",black30:"rgba(0, 0, 0, 0.3)",black50:"rgba(0, 0, 0, 0.5)",black60:"rgba(0, 0, 0, 0.6)",black80:"rgba(0, 0, 0, 0.8)",black90:"rgba(0, 0, 0, 0.9)",black:"rgb(0, 0, 0)",white10:"rgba(255, 255, 255, 0.1)",white30:"rgba(255, 255, 255, 0.3)",white50:"rgba(255, 255, 255, 0.5)",white60:"rgba(255, 255, 255, 0.6)",white80:"rgba(255, 255, 255, 0.8)",white90:"rgba(255, 255, 255, 0.9)",white:"rgb(255, 255, 255)",tagWhite:"rgba(245, 245, 245, 1)",tagGray:"rgba(227, 226, 224, 1)",tagRed:"rgba(255, 225, 225, 1)",tagOrange:"rgba(255, 233, 201, 1)",tagYellow:"rgba(255, 243, 215, 1)",tagGreen:"rgba(222, 244, 231, 1)",tagTeal:"rgba(222, 244, 243, 1)",tagBlue:"rgba(225, 238, 255, 1)",tagPurple:"rgba(243, 240, 255, 1)",tagPink:"rgba(251, 231, 255, 1)",tooltip:"rgba(0, 0, 0, 1)",menuShadow:"0px 0px 12px rgba(66, 65, 73, 0.14), inset 0px 0px 0px 0.5px rgba(227, 227, 228, 1)",activeShadow:"0px 0px 0px 2px rgba(30, 150, 235, 0.30)",shadow1:"0px 0px 4px 0px rgba(66, 65, 73, 0.14)",shadow2:"0px 0px 12px 0px rgba(66, 65, 73, 0.18)",shadow3:"0px 0px 20px 0px rgba(66, 65, 73, 0.22)",popoverShadow:"0px 0px 30px rgba(75, 75, 75, 0.2), 0px 0px 4px rgba(75, 75, 75, 0.3), inset 0px 0px 0px rgba(227, 226, 228, 1)",floatButtonShadow:"0px 0px 10px rgba(0, 0, 0, 0.05), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.1)",floatButtonShadow1:"0px 4px 6px -3px rgba(66, 65, 73, 0.10), 0px 10px 12px -2px rgba(66, 65, 73, 0.10)",floatButtonShadow2:"0px 4px 4px -2px rgba(66, 65, 73, 0.10), 0px 6px 8px 1px rgba(66, 65, 73, 0.05)",kanbanShadow:"0px 2px 3px 0px rgba(0, 0, 0, 0.05)",cmdShadow:"0px 10px 80px 0px rgba(0, 0, 0, 0.20)",largeButtonEffect:"0px 12px 21px 4px rgba(30, 150, 235, 0.15)",buttonGrayColor:"rgba(245, 245, 245, 1)",cardBackgroundBlue:"linear-gradient(180deg, #F0F3FD 0%, #FCFCFD 100%)",cardBackgroundGreen:"linear-gradient(180deg, #F3F9FD 0%, #FCFCFD 100%)",cardBackgroundGrey:"linear-gradient(180deg, #F1F1F1 0%, #FCFCFD 100%)",windowsCloseButton:"#C42B1C",textHighlightPink:"rgba(255, 206, 206, 1)",textHighlightOrange:"rgba(255, 203, 166, 1)",textHighlightYellow:"rgba(255, 245, 171, 1)",textHighlightGreen:"rgba(197, 251, 224, 1)",textHighlightTeal:"rgba(198, 241, 243, 1)",textHighlightBlue:"rgba(195, 219, 255, 1)",textHighlightPurple:"rgba(227, 222, 255, 1)",textHighlightGrey:"rgba(236, 241, 251, 1)"},i$1={...l,themeMode:"dark",brandColor:"#1E96EB",primaryColor:"#1C9EE4",primaryColor04:"rgba(52, 116, 173, 0.1)",secondaryColor:"rgb(144, 150, 245)",tertiaryColor:"rgb(30, 30, 30)",blue950:"rgba(32, 45, 55, 1)",blue50:"rgba(181, 208, 242, 1)",blue100:"rgba(171, 204, 237, 1)",blue200:"rgba(149, 194, 234, 1)",blue300:"rgba(115, 182, 226, 1)",blue400:"rgba(79, 162, 216, 1)",blue500:"rgba(53, 140, 208, 1)",blue600:"rgba(52, 116, 173, 1)",blue700:"rgba(55, 106, 154, 1)",blue800:"rgba(51, 88, 122, 1)",blue900:"rgba(47, 75, 96, 1)",hoverColor:"rgba(255, 255, 255, 0.1)",hoverColorFilled:"rgb(35, 35, 35)",iconColor:"rgb(168, 168, 160)",iconSecondary:"rgba(168,168,160,0.6)",borderColor:"rgba(46, 46, 46, 1)",dividerColor:"rgb(114, 114, 114)",placeholderColor:"rgb(62, 62, 63)",quoteColor:"rgba(142, 141, 145, 1)",listColor:"rgba(156, 155, 160, 1)",linkColor:"#78BEFF",edgelessGridColor:"rgba(49, 49, 49, 0.35)",successColor:"rgb(13, 162, 107)",warningColor:"rgb(188, 54, 42)",errorColor:"rgb(188, 54, 42)",processingColor:"rgb(31, 94, 204)",textEmphasisColor:"#1E96EB",textPrimaryColor:"rgb(234, 234, 234)",textSecondaryColor:"rgb(156, 156, 160)",textDisableColor:"rgb(119, 117, 125)",black10:"rgba(255, 255, 255, 0.1)",black30:"rgba(255, 255, 255, 0.3)",black50:"rgba(255, 255, 255, 0.5)",black60:"rgba(255, 255, 255, 0.6)",black80:"rgba(255, 255, 255, 0.8)",black90:"rgba(255, 255, 255, 0.9)",black:"rgb(255, 255, 255)",white10:"rgba(0, 0, 0, 0.1)",white30:"rgba(0, 0, 0, 0.3)",white50:"rgba(0, 0, 0, 0.5)",white60:"rgba(0, 0, 0, 0.6)",white80:"rgba(0, 0, 0, 0.8)",white90:"rgba(0, 0, 0, 0.9)",white:"rgb(0, 0, 0)",backgroundCodeBlock:"rgba(46, 44, 52, 1)",backgroundTertiaryColor:"rgb(48, 48, 48)",backgroundProcessingColor:"rgba(22, 32, 48, 1)",backgroundErrorColor:"rgba(46, 26, 24, 1)",backgroundWarningColor:"rgba(48, 35, 19, 1)",backgroundSuccessColor:"rgba(20, 42, 34, 1)",backgroundPrimaryColor:"rgb(20, 20, 20)",backgroundSecondaryColor:"rgba(37, 37, 37, 1)",backgroundModalColor:"rgba(0, 0, 0, 0.5)",backgroundOverlayPanelColor:"rgb(30, 30, 30)",tagBlue:"rgba(8, 67, 136, 1)",tagGreen:"rgba(44, 108, 63, 1)",tagTeal:"rgba(26, 115, 110, 1)",tagWhite:"rgba(67, 67, 67, 1)",tagPurple:"rgba(47, 30, 113, 1)",tagRed:"rgba(111, 50, 50, 1)",tagPink:"rgba(155, 106, 106, 1)",tagYellow:"rgba(150, 132, 49, 1)",tagOrange:"rgba(185, 129, 46, 1)",tagGray:"rgba(41, 41, 41, 1)",tooltip:"rgba(234, 234, 234, 1)",menuShadow:"0px 0px 16px rgba(0, 0, 0, 0.32), 0px 0px 0px 0.5px #2E2E2E inset",activeShadow:"0px 0px 0px 2px rgba(28, 158, 228, 0.30)",shadow1:"0px 0px 4px 0px rgba(0, 0, 0, 0.24)",shadow2:"0px 0px 12px 0px rgba(0, 0, 0, 0.28)",shadow3:"0px 0px 20px 0px rgba(0, 0, 0, 0.32)",popoverShadow:"0px 0px 30px 0px rgba(0, 0, 0, 0.1), 0px 0px 8px 0px rgba(0, 0, 0, 0.18), 0px 0px 0px 0.5px rgba(48, 48, 48, 1) inset",floatButtonShadow:"0px 0px 10px rgba(0, 0, 0, 0.05), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.1)",floatButtonShadow1:"0px 4px 6px -3px rgba(0, 0, 0, 0.1), 0px 10px 12px -2px rgba(0, 0, 0, 0.1)",floatButtonShadow2:"0px 4px 4px -2px rgba(15, 15, 15, 0.1), 0px 6px 8px 1px rgba(15, 15, 15, 0.05)",kanbanShadow:"0px 2px 3px 0px rgba(0, 0, 0, 0.60)",cmdShadow:"0px 16px 80px 0px rgba(0, 0, 0, 0.80)",largeButtonEffect:"0px 12px 20px 4px rgba(28, 158, 228, 0.18)",buttonGrayColor:"rgba(85, 85, 85, 1)",cardBackgroundBlue:"linear-gradient(180deg, #14171F 0%, #202020 100%)",cardBackgroundGreen:"linear-gradient(180deg, #192023 0%, #202020 100%)",cardBackgroundGrey:"linear-gradient(180deg, #313131 0%, #202020 100%)",windowsCloseButton:"#C42B1C",textHighlightPink:"rgba(127, 93, 93, 1)",textHighlightOrange:"rgba(127, 102, 84, 1)",textHighlightYellow:"rgba(137, 133, 90, 1)",textHighlightGreen:"rgba(90, 127, 109, 1)",textHighlightTeal:"rgba(76, 125, 127, 1)",textHighlightBlue:"rgba(72, 95, 127, 1)",textHighlightPurple:"rgba(97, 90, 127, 1)",textHighlightGrey:"rgba(111, 112, 117, 1)"},x=Object.entries(n$1).reduce((k,[_,y])=>(k[`--affine-${t(_)}`]=y,k),{});Object.entries(i$1).reduce((k,[_,y])=>(k[`--affine-${t(_)}`]=y,k),{});const quoteCSSContent=`
  .quote {
    line-height: 26px;
    padding-left: 17px;
    margin-top: var(--affine-paragraph-space);
    padding-top: 10px;
    padding-bottom: 10px;
    position: relative;
    white-space: pre-wrap;
  }
`,quotePseudoElementContent=`
  .quote::after {
    content: '';
    width: 2px;
    height: calc(100% - 20px);
    margin-top: 10px;
    margin-bottom: 10px;
    position: absolute;
    left: 0;
    top: 0;
    background: var(--affine-quote-color);
    border-radius: 18px;
  }
`,cssVariables=Object.keys(x).map(k=>k+": "+x[k]).join(`;
`),globalCSS=i$5`
  :root {
    --affine-editor-width: ${EDITOR_WIDTH}px;

    ${r$2(cssVariables)}
  }
  body {
    font-family: var(--affine-font-family);
    color: var(--affine-text-primary-color);
  }

  .affine-bookmark-block-container {
    width: 100%;
    margin-top: 18px;
    margin-bottom: 18px;
    position: relative;
  }
  .affine-bookmark-block-container .affine-bookmark-link {
    height: 74px;
    box-shadow: var(--affine-shadow-1);
    background: var(--affine-card-background-blue);
    border: 3px solid var(--affine-background-secondary-color);
    border-radius: 12px;
    padding: 16px 24px;
    display: flex;
    cursor: pointer;
    text-decoration: none;
    color: var(--affine-text-primary-color);
    overflow: hidden;
    line-height: calc(1em + 4px);
    position: relative;
  }
  .affine-bookmark-block-container .affine-bookmark-banner {
    width: 140px;
    height: 93px;
    margin-left: 20px;
    border-radius: 8px 8px 0 0;
    overflow: hidden;
    flex-shrink: 0;
  }
  .affine-bookmark-block-container .affine-bookmark-banner img,
  .affine-bookmark-block-container .affine-bookmark-banner svg {
    width: 140px;
    height: 93px;
    object-fit: cover;
  }
  .affine-bookmark-block-container .affine-bookmark-content-wrapper {
    flex-grow: 1;
    overflow: hidden;
  }
  .affine-bookmark-block-container .affine-bookmark-title {
    height: 18px;
    display: flex;
    align-items: center;
    font-size: var(--affine-font-sm);
    font-weight: 600;
  }
  .affine-bookmark-block-container .affine-bookmark-title-content {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-left: 8px;
  }
  .affine-bookmark-block-container .affine-bookmark-icon {
    width: 18px;
    height: 18px;
    color: var(--affine-text-secondary-color);
    flex-shrink: 0;
  }
  .affine-bookmark-block-container .affine-bookmark-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .affine-bookmark-block-container .affine-bookmark-description {
    height: 32px;
    line-height: 16px;
    margin-top: 4px;
    font-size: var(--affine-font-xs);

    display: -webkit-box;
    word-break: break-all;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .affine-bookmark-block-container .affine-bookmark-url {
    font-size: var(--affine-font-xs);
    color: var(--affine-text-secondary-color);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-top: 2px;
  }
  .affine-bookmark-block-container .affine-bookmark-caption {
    width: 100%;
    font-size: var(--affine-font-sm);
    outline: none;
    border: 0;
    font-family: inherit;
    text-align: center;
    color: var(--affine-icon-color);
    background: var(--affine-background-primary-color);
  }
  .affine-bookmark-block-container .affine-bookmark-caption::placeholder {
    color: var(--affine-placeholder-color);
  }
  .affine-bookmark-block-container .affine-bookmark-caption.caption-show {
    display: inline-block;
  }

  .page-meta-data {
    padding: 10px 12px 24px;
    margin: 0 -24px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    background-color: var(--affine-hover-color-filled);
    border-radius: 8px;
  }

  .page-meta-data .meta-data-expanded-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 12px;
    font-weight: 600;
    font-size: 14px;
    color: var(--affine-text-secondary-color);
    border-radius: 4px;
    cursor: pointer;
  }

  .page-meta-data .meta-data-expanded-item {
    display: flex;
    gap: 8px;
  }

  .page-meta-data .meta-data-expanded-item .type {
    display: flex;
    align-items: center;
  }

  .page-meta-data .meta-data-expanded-item .type svg {
    fill: var(--affine-icon-color);
  }

  .page-meta-data .meta-data-expanded-item .value {
    flex: 1;
  }

  .page-meta-data .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .page-meta-data .tag {
    padding: 4px 10px;
    border-radius: 8px;
    color: var(--affine-text-primary-color);
    font-size: 13px;
    line-height: 13px;
    display: flex;
    align-items: center;
    font-weight: 400;
    cursor: pointer;
  }

  blockquote {
    margin-inline-start: 0;
  }

  ${r$2(quoteCSSContent)}
  ${r$2(quotePseudoElementContent)}

  ul {
    padding-inline-start: 1rem;
  }
  li {
    padding-inline-start: 1rem;
  }

  .shiki {
    font-size: var(--affine-font-sm);
    line-height: var(--affine-line-height);
    position: relative;
    padding: 32px 0px 12px 60px;
    background: var(--affine-background-code-block);
    border-radius: 10px;
    margin-top: 24px;
    margin-bottom: 24px;
  }
`,UNTITLED_PAGE_NAME="Untitled",FileExporter={exportFile(k,_){const y=document.createElement("a");y.setAttribute("href",_);const w=getSafeFileName(k);y.setAttribute("download",w),y.style.display="none",document.body.appendChild(y),y.click(),document.body.removeChild(y)},exportTextFile(k,_,y){FileExporter.exportFile(k,"data:"+y+";charset=utf-8,"+encodeURIComponent(_))},async exportHtml(k,_,y,w,$){const B=(await __vitePreload(()=>Promise.resolve().then(()=>jszip_min),void 0)).default,R=k?.trim()??UNTITLED_PAGE_NAME,H=new B;for(const[X,ee]of w){const te=await $.get(X);te&&H.file(ee,te)}H.file(`${R}|${_}.html`,wrapHtmlWithHtmlDocumentText(R,y));const j=await H.generateAsync({type:"blob"}),q=URL.createObjectURL(j);FileExporter.exportFile(`${R}|HTML.zip`,q)},async exportHtmlAsMarkdown(k,_,y,w,$){const B=(await __vitePreload(()=>Promise.resolve().then(()=>jszip_min),void 0)).default,R=(await __vitePreload(()=>import("./turndown.browser.es.efa3c26b.js"),[])).default,H=new R;H.addRule("input",{[Symbol.iterator](){},anchor(ne){return""},big(){return""},blink(){return""},bold(){return""},charAt(ne){return""},charCodeAt(ne){return 0},codePointAt(ne){},concat(ne){return""},endsWith(ne,oe){return!1},fixed(){return""},fontcolor(ne){return""},includes(ne,oe){return!1},indexOf(ne,oe){return 0},italics(){return""},lastIndexOf(ne,oe){return 0},length:0,link(ne){return""},repeat(ne){return""},slice(ne,oe){return""},small(){return""},startsWith(ne,oe){return!1},strike(){return""},sub(){return""},substr(ne,oe){return""},substring(ne,oe){return""},sup(){return""},toLocaleLowerCase(ne){return""},toLocaleUpperCase(ne){return""},toLowerCase(){return""},toString(){return""},toUpperCase(){return""},trim(){return""},valueOf(){return""},fontsize(ne){return""},localeCompare(ne,oe,ie){return 0},match(ne){},normalize(ne){return""},replace(ne,oe){return""},search(ne){return 0},split(ne,oe){return[]},filter:["input"],replacement:function(ne,oe){return oe.getAttribute("checked")===null?"[ ] ":"[x] "}}),H.addRule("codeBlock",{filter:["pre"],replacement:function(ne,oe){return"```"+oe.getAttribute("code-lang")+`
`+oe.textContent+"```\n"}}),H.keep(["del","u"]),H.addRule("bookMark",{filter:function(ne){return ne.nodeName==="DIV"&&ne.classList.contains("affine-bookmark-block-container")},replacement:function(ne,oe){const ie=oe,ae=ie.querySelector(".affine-bookmark-title-content"),re=ie.querySelector(".affine-bookmark-url");return`[${ae?.textContent}](${re?.textContent})
`}}),H.addRule("pageMetaData",{filter:function(ne){return ne.nodeName==="DIV"&&ne.classList.contains("page-meta-data")},replacement:function(ne,oe){const ae=oe.querySelectorAll(".tag");return ae.length>0?`Tags: ${Array.from(ae).map(re=>re.textContent).join(", ")}`:""}});const j=H.turndown(y),q=k?.trim()??UNTITLED_PAGE_NAME,X=new B;for(const[ne,oe]of w){const ie=await $.get(ne);ie&&X.file(oe,ie)}X.file(`${q}|${_}.md`,j);const ee=await X.generateAsync({type:"blob"}),te=URL.createObjectURL(ee);FileExporter.exportFile(`${q}|MarkDown.zip`,te)},exportPng(k,_){const y=k?.trim()||UNTITLED_PAGE_NAME;FileExporter.exportFile(y+".png",_)}};function wrapHtmlWithHtmlDocumentText(k,_){const y=`<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<style>
  ${globalCSS}
</style>`;return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>${k}</title>
  ${y}
</head>
<body>
<div style="margin:0 auto;padding:1rem;max-width:${EDITOR_WIDTH}px">
${_}
</div>
</body>
</html>
`}function getSafeFileName(k){const _=" ",y=/[<>:"/\\|?*\u0000-\u001F]/g,w=/^(con|prn|aux|nul|com\d|lpt\d)$/i,$=/[\u0000-\u001F\u0080-\u009F]/g,B=/\.+$/;function H(ee,te){const ne=te.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),oe=new RegExp(`(?:${ne}){2,}`,"g");return ee.replace(oe,te)}k=k.normalize("NFD").replace(y,_).replace($,_).replace(B,""),k=H(k,_),k=w.test(k)?k+_:k;const j=k.lastIndexOf("."),q=k.slice(0,j).trim(),X=k.slice(j);return k=q.slice(0,Math.max(1,50-X.length))+X,k}class ColumnConfigManager{constructor(){this.map=new Map}getColumn(_){const y=this.map.get(_);if(!y)throw new Error(`${_} is not exist`);return y}register(_,y){const w=new ColumnConfig(_,y);return this.map.set(_,w),w}}class ColumnConfig{constructor(_,y){this.type=_,this.ops=y,this.convertMap=new Map}create(_,y){return{type:this.type,name:_,data:y??this.ops.defaultData()}}defaultData(){return this.ops.defaultData()}createWithId(_,y,w){return{id:_,type:this.type,name:y,data:w??this.ops.defaultData()}}dataType(_){return this.ops.type(_)}toString(_,y){return this.ops.cellToString(_,y)}toJson(_,y){return this.ops.cellToJson(_,y)}formatValue(_,y){return _===void 0?void 0:this.ops.formatValue?.(_,y)??_}fromString(_,y){return this.ops.cellFromString(_,y)}convertCell(_,y,w){return this.convertMap.get(_)?.(y,w)}registerConvert(_,y){this.convertMap.set(_,y)}get name(){return this.ops.name}}const columnManager=new ColumnConfigManager,tUnion=k=>({type:"union",title:"union",list:k}),tArray=k=>({type:"array",title:"array",ele:k}),isTArray=k=>k.type==="array",tTypeVar=(k,_)=>({type:"typeVar",title:"typeVar",name:k,bound:_}),tTypeRef=k=>({type:"typeRef",title:"typeRef",name:k}),tFunction=k=>({type:"function",title:"function",typeVars:k.typeVars??[],args:k.args,rt:k.rt});class DataDefine{constructor(_,y){this.config=_,this.dataMap=y}create(_){return{type:"data",name:this.config.name,data:_}}is(_){return _.type!=="data"?!1:_.name===this.config.name}isByName(_){return _===this.config.name}isSubOf(_){return this.is(_)?!0:this.config.supers.some(y=>y.isSubOf(_))}isSubOfByName(_){return this.isByName(_)?!0:this.config.supers.some(y=>y.isSubOfByName(_))}isSuperOf(_){const y=this.dataMap.get(_.name);if(!y)throw new Error("bug");return y.isSubOfByName(this.config.name)}}const createDataHelper=(...k)=>({create(_){return{name:_,supers:k}},extends(_){return createDataHelper(...k,_)}}),DataHelper=createDataHelper();class Typesystem{constructor(){this.dataMap=new Map}defineData(_){const y=new DataDefine(_,this.dataMap);return this.dataMap.set(_.name,y),y}isDataType(_){return _.type==="data"}isSubtype(_,y,w){if(_.type==="typeRef")return w&&y.type!="typeRef"&&(w[_.name]=y),!0;if(y.type==="typeRef")return w&&(w[y.name]=_),!0;if(tUnknown.is(_))return!0;if(_.type==="union")return _.list.some($=>this.isSubtype($,y,w));if(y.type==="union")return y.list.every($=>this.isSubtype(_,$,w));if(this.isDataType(y)){const $=this.dataMap.get(y.name);if(!$)throw new Error("bug");return this.isDataType(_)?$.isSubOf(_):!1}return _.type==="array"||y.type==="array"?_.type!=="array"||y.type!=="array"?!1:this.isSubtype(_.ele,y.ele,w):!1}subst(_,y){const w=B=>{if(this.isDataType(B))return B;switch(B.type){case"typeRef":return{..._[B.name]};case"union":return tUnion(B.list.map(R=>w(R)));case"array":return tArray(w(B.ele));case"function":throw new Error("TODO")}};return tFunction({args:y.args.map(B=>w(B)),rt:w(y.rt)})}instance(_,y,w,$){const B={..._};return $.args.forEach((R,H)=>{const j=y[H];j&&this.isSubtype(R,j,B)}),this.isSubtype(w,$.rt),this.subst(B,$)}}const typesystem=new Typesystem,tUnknown=typesystem.defineData(DataHelper.create("Unknown")),tNumber=typesystem.defineData({name:"Number",supers:[]}),tString=typesystem.defineData({name:"String",supers:[]}),tRichText=typesystem.defineData({name:"RichText",supers:[tString]}),tBoolean=typesystem.defineData({name:"Boolean",supers:[]}),tDate=typesystem.defineData({name:"Date",supers:[]});typesystem.defineData({name:"URL",supers:[tString]});const tImage=typesystem.defineData({name:"Image",supers:[]});typesystem.defineData({name:"Email",supers:[tString]});typesystem.defineData({name:"Phone",supers:[tString]});const tTag=typesystem.defineData({name:"Tag",supers:[]}),multiSelectColumnTypeName="multi-select",multiSelectPureColumnConfig=columnManager.register(multiSelectColumnTypeName,{name:"Multi-select",type:k=>tArray(tTag.create({tags:k.options})),defaultData:()=>({options:[]}),addGroup:(k,_)=>({options:[..._.options,{id:nanoid(),value:k,color:getTagColor()}]}),formatValue:k=>Array.isArray(k)?k.filter(_=>_!=null):[],cellToString:(k,_)=>k?.map(y=>_.options.find(w=>w.id===y)?.value).join(" "),cellFromString:(k,_)=>{const y=Object.fromEntries(_.options.map(B=>[B.value,B])),w=k.split(",").map(B=>B.trim()).filter(B=>B),$=[];return w.forEach(B=>{if(y[B])$.push(y[B].id);else{const R={id:nanoid(),value:B,color:getTagColor()};_.options.push(R),$.push(R.id)}}),{value:$,data:_}},cellToJson:k=>k??null});multiSelectPureColumnConfig.registerConvert("select",(k,_)=>({column:k,cells:_.map(y=>y?.[0])}));multiSelectPureColumnConfig.registerConvert("rich-text",(k,_)=>{const y=Object.fromEntries(k.options.map(w=>[w.id,w]));return{column:{},cells:_.map(w=>new Text$1(w?.map($=>y[$]?.value??"").join(",")).yText)}});const selectColumnTypeName="select",selectPureColumnConfig=columnManager.register(selectColumnTypeName,{name:"Select",type:k=>tTag.create({tags:k.options}),defaultData:()=>({options:[]}),addGroup:(k,_)=>({options:[..._.options,{id:nanoid(),value:k,color:getTagColor()}]}),cellToString:(k,_)=>_.options.find(y=>y.id===k)?.value??"",cellFromString:(k,_)=>{const y=Object.fromEntries(_.options.map(B=>[B.value,B])),w=k.split(",").map(B=>B.trim()).filter(B=>B);let $="";return w.forEach((B,R)=>{if(y[B])$=y[B].id;else{const H={id:nanoid(),value:B,color:getTagColor()};_.options.push(H),R===0&&($=H.id)}}),{value:$,data:_}},cellToJson:k=>k??null});selectPureColumnConfig.registerConvert("multi-select",(k,_)=>({column:k,cells:_.map(y=>y?[y]:void 0)}));selectPureColumnConfig.registerConvert("rich-text",(k,_)=>{const y=Object.fromEntries(k.options.map(w=>[w.id,w]));return{column:{},cells:_.map(w=>new Text$1(w?y[w]?.value:"").yText)}});const richTextColumnTypeName="rich-text",richTextPureColumnConfig=columnManager.register(richTextColumnTypeName,{name:"Text",type:()=>tRichText.create(),defaultData:()=>({}),cellToString:k=>k?.toString()??"",cellFromString:k=>({value:k}),cellToJson:k=>k?.toString()??null});richTextPureColumnConfig.registerConvert(selectColumnTypeName,(k,_)=>{const y={},w=$=>{if(y[$])return y[$];const B={id:nanoid(),value:$,color:getTagColor()};return y[$]=B,B};return{cells:_.map($=>{const R=$?.toString().split(",")?.[0]?.trim();if(R)return w(R).id}),column:{options:Object.values(y)}}});richTextPureColumnConfig.registerConvert(multiSelectColumnTypeName,(k,_)=>{const y={},w=$=>{if(y[$])return y[$];const B={id:nanoid(),value:$,color:getTagColor()};return y[$]=B,B};return{cells:_.map($=>{const B=[];return $?.toString().split(",")?.forEach(H=>{H=H.trim(),H&&B.push(w(H).id)}),B}),column:{options:Object.values(y)}}});const INLINE_TAGS=["DEL","STRONG","B","EM","I","U","S","SPAN","A","INPUT","MARK","CODE","LABEL","BIG","SMALL","ABBR","CITE","BDI","TIME"];class BaseParser{constructor(_,y,w,$,B,R){this._fetchFileHandler=async H=>{if(this._customFetchFileHandler){const X=await this._customFetchFileHandler(H);if(X&&X.size>0)return X}let j;try{j=await fetch(H,{cache:"no-cache",mode:"cors",headers:{Origin:window.location.origin}})}catch(X){return console.error(X),null}const q=await j.blob();return q.type.startsWith("image/")?q:null},this._nodeParser=async H=>{let j;if(j=await this._contextedContentParser.getParserHtmlText2Block("CustomNodeParser")?.(H),j&&j.length>0)return j;const q=H.tagName;if((H instanceof Text||INLINE_TAGS.includes(q))&&H.textContent?.length)j=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:"text"});else switch(q){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":j=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:q.toLowerCase()});break;case"BLOCKQUOTE":j=await this._contextedContentParser.getParserHtmlText2Block("BlockQuoteParser")?.(H);break;case"P":this._contextedContentParser.context==="Markdown"&&H.firstChild instanceof Text&&(H.firstChild.textContent?.startsWith("[] ")||H.firstChild.textContent?.startsWith("[ ] ")||H.firstChild.textContent?.startsWith("[x] "))?j=await this._contextedContentParser.getParserHtmlText2Block("ListItemParser")?.(H):H.firstChild instanceof HTMLImageElement?j=await this._contextedContentParser.getParserHtmlText2Block("EmbedItemParser")?.(H.firstChild):H.firstElementChild?.tagName==="A"||H.firstElementChild?.getAttribute("href")?.endsWith(".csv")?j=await this._contextedContentParser.getParserHtmlText2Block("TableParser")?.(H.firstChild):j=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:"text"});break;case"LI":j=await this._contextedContentParser.getParserHtmlText2Block("ListItemParser")?.(H);break;case"HR":j=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:divider"});break;case"PRE":j=await this._contextedContentParser.getParserHtmlText2Block("CodeBlockParser")?.(H);break;case"FIGURE":case"IMG":j=await this._contextedContentParser.getParserHtmlText2Block("EmbedItemParser")?.(H);break;case"HEADER":j=await this._contextedContentParser.getParserHtmlText2Block("HeaderParser")?.(H);break;case"TABLE":j=await this._contextedContentParser.getParserHtmlText2Block("TableParser")?.(H);break}if(j&&j.length>0)return j;if(H.childNodes.length>0&&!Array.from(H.childNodes).some(oe=>{if(oe.nodeType===Node.TEXT_NODE)return!1;if(oe.nodeType===Node.ELEMENT_NODE){const ie=oe;return!(INLINE_TAGS.includes(ie.tagName)||ie.tagName.includes("-")&&checkWebComponentIfInline(ie))}return!0})){const oe=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:"text"});if(oe)return oe}const ee=Array.from(H.children).map(async ne=>await this._contextedContentParser.getParserHtmlText2Block("NodeParser")?.(ne)||[]),te=[];for(const ne of ee)te.push(await ne);return te.flat().filter(ne=>ne)},this._blockQuoteParser=async H=>{const j=X=>{const ee=[];return X.forEach(te=>{const ne=te.text?.filter(ie=>ie.insert)||[];ee.length>0&&ne.length>0&&ee.push({insert:`
`}),ee.push(...ne);const oe=j(te.children||[])||[];ee.length>0&&oe.length>0&&ee.push({insert:`
`}),ee.push(...oe)}),ee},q=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:"text"});return q?[{flavour:"affine:paragraph",type:"quote",text:j(q),children:[]}]:null},this._codeBlockParser=async H=>{const j=H.children[0],q=j?.getAttribute("class")?.split("-"),X=H.tagName==="PRE"&&j?.tagName==="CODE",ee=X&&q?.[0]==="language";let te="",ne=FALLBACK_LANG;return ee?(te=j.textContent?.replace(/\n$/,"")??"",ne=getStandardLanguage(q?.[1])?.id||FALLBACK_LANG):X?te=j.textContent?.replace(/\n$/,"")??"":te=H.textContent??"",[{flavour:"affine:code",text:[{insert:te}],children:[],language:ne}]},this._tableParser=async H=>{if(this._customTableParserHandler){const ue=await this._customTableParserHandler(H);if(ue&&ue.length>0)return ue}if(H.tagName!=="TABLE")return[];const j=H.querySelector("thead"),q=H.querySelector("tbody"),X=j?.querySelector("tr"),te=(()=>{let ue=1;return{next:()=>ue++}})(),ne=getTableColumnMeta(X),oe=getTableRows(q,ne);let ie=ne.findIndex(ue=>ue.type==="title");ie=ie!==-1?ie:0;let ae=oe.map(ue=>ue[ie]??"").map(ue=>Array.isArray(ue)?ue.join(""):ue).map(ue=>({flavour:"affine:paragraph",type:"text",text:[{insert:ue}],children:[]}));this._customTableTitleColumnHandler&&(ae=await this._customTableTitleColumnHandler(H)??ae);const re=getTableColumns(ne,oe,te),se=te.next(),le=getTableCells(oe,te,ne,re);return[{flavour:"affine:database",databaseProps:{id:""+se,title:"Database",rowIds:Object.keys(le),cells:le,columns:re,views:[{id:this._page.generateId(),name:"Table View",mode:"table",columns:[],header:ie!==-1?{titleColumn:re[ie].id,iconColumn:"type"}:{},filter:{type:"group",op:"and",conditions:[]}}]},children:ae}]},this._headerParser=async H=>{let j=H;H.getElementsByClassName("page-title").length>0&&(j=H.getElementsByClassName("page-title")[0]);const q=j.tagName;return await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:j,flavour:"affine:page",type:q.toLowerCase()})},this._contentParser=_,this._page=y,this._customFetchFileHandler=w,this._customTextStyleHandler=$,this._customTableParserHandler=B,this._customTableTitleColumnHandler=R}_getTextHighlightColors(){if(!this._textHighlightColors){const _="--affine-text-highlight-";this._textHighlightColors=new Map,Object.keys(x).forEach(y=>{y.startsWith(_)&&this._textHighlightColors?.set(y.substring(_.length),`var(${y})`)})}return this._textHighlightColors}async _commonHTML2Block(_,y,w,$,B=!0){const R=_.childNodes;let H=!1;const j=[],q=[];for(let X=0;X<R.length;X++){const ee=R.item(X);if(ee&&ee.nodeName!=="#comment"&&ee.nodeName!=="STYLE"){if(!H){if(ee instanceof Text){j.push(...this._commonHTML2Text(ee,{},B));continue}const te=ee;if(INLINE_TAGS.includes(te.tagName)||te.tagName.includes("-")&&checkWebComponentIfInline(te)){j.push(...this._commonHTML2Text(ee,{},B));continue}}if(ee instanceof Element){const te=await this._contextedContentParser.getParserHtmlText2Block("NodeParser")?.(ee);te&&q.push(...te)}H=!0}}return j.length===0&&q.length===1?{flavour:y,type:w,checked:$,text:q[0].text,children:q[0].children}:j.length===0&&q.length>0&&y==="affine:list"?{flavour:y,type:w,checked:$,text:q[0].text,children:q.slice(1)}:{flavour:y,type:w,checked:$,text:j,children:q}}_commonHTML2Text(_,y={},w=!0){if(_ instanceof Text){let H=!1;return y.reference&&(H=y.reference.type==="LinkedPage"),(_.textContent||"").split(`
`).map(j=>({insert:H?" ":j,attributes:y}))}const $=_;if($.classList.contains("katex-mathml"))return[];const B=Array.from($.childNodes),R=getTextStyle($,this._getTextHighlightColors());return this._customTextStyleHandler&&this._customTextStyleHandler($,R),B.length?B.reduce((H,j)=>{const q=this._commonHTML2Text(j,{...y,...R},w);return H.push(...q),H},[]).filter(H=>H):w?[]:[{insert:"",attributes:R}]}}const getCorrespondingTableColumnType=k=>{const _={typesSelect:"select",typesMultipleSelect:"multi-select",typesNumber:"number",typesCheckbox:"checkbox",typesText:"rich-text",typesTitle:"title"},y=k?.classList[0]??"typesText";return _[y]||"rich-text"},getIsLink=k=>["A"].includes(k.tagName),getTextStyle=(k,_)=>{const y=k.tagName,w={},$=(k.getAttribute("style")||"").split(";").reduce((B,R)=>{const[H,j]=R.split(":");return H&&j&&(B[H]=j),B},{});if(($["font-weight"]==="bold"||Number($["font-weight"])>400||["STRONG","B","H1","H2","H3","H4","H5","H6"].includes(k.tagName))&&(w.bold=!0),getIsLink(k)){const B=k.getAttribute("href")||k.getAttribute("src");w.link=B}if((y==="EM"||$.fontStyle==="italic")&&(w.italic=!0),(y==="U"||$["text-decoration"]&&$["text-decoration"].indexOf("underline")!==-1||$["border-bottom"])&&(w.underline=!0),y==="CODE"&&(w.code=!0),(y==="S"||y==="DEL"||$["text-decoration"]&&$["text-decoration"].indexOf("line-through")!==-1)&&(w.strike=!0),y==="MARK"){const R=(Array.from(k.classList).find(j=>j.startsWith("highlight-"))??"").split(/[-_]/);let H=R.length>0?R[1]:"";H&&H!=="default"&&(H==="red"?H="pink":H==="gray"&&(H="grey"),H=_.has(H)?H:"yellow",w.background=_.get(H))}return w},checkWebComponentIfInline=k=>window.getComputedStyle(k).display.includes("inline")||k.style.display.includes("inline"),getTableCells=(k,_,y,w)=>{const $={};return y.findIndex(B=>B.type==="title"),k.forEach(B=>{const R=""+_.next();$[R]={},B.forEach((H,j)=>{if(y[j]?.type==="multi-select"&&Array.isArray(H)){$[R][w[j].id]={columnId:w[j].id,value:H.map(q=>y[j]?.optionsMap.get(q)||"")};return}if(y[j]?.type==="select"&&!Array.isArray(H)){$[R][w[j].id]={columnId:w[j].id,value:y[j]?.optionsMap.get(H)||""};return}$[R][w[j].id]={columnId:w[j].id,value:H}})}),$},getTableColumns=(k,_,y)=>{const w=k.map(($,B)=>{if(["select","multi-select"].includes($.type)){const R=_.map(H=>H[B]).flat().filter((H,j,q)=>q.indexOf(H)===j).map(H=>({id:nanoid(),value:H,color:getTagColor()}));return R.map(H=>k[B].optionsMap.set(H.value,H.id)),columnManager.getColumn($.type).createWithId(""+y.next(),$.title,{options:R})}return columnManager.getColumn($.type).createWithId(""+y.next(),$.title)});if(_.length>0){let $=_[0].length;for(let R=1;R<_.length;R++)$=Math.max($,_[R].length);const B=$-w.length;for(let R=0;R<B;R++)w.push(richTextPureColumnConfig.createWithId(""+y.next(),""))}return w},getTableRows=(k,_)=>{const y=[];return k?.querySelectorAll("tr").forEach(w=>{const $=[];w.querySelectorAll("td").forEach((B,R)=>{const H=[];let j=B.textContent?.trim()??"";Array.from(B.children).map(q=>{q.classList.contains("checkbox-on")?j="on":H.push(q.textContent||"")}),$.push(_[R]?.type!=="multi-select"?j:H)}),y.push($)}),y},getTableColumnMeta=k=>{const _=[];return k?.querySelectorAll("th").forEach(y=>{_.push({title:y.textContent?.trim()||"",type:getCorrespondingTableColumnType(y.querySelector("svg")??void 0),optionsMap:new Map})}),_};class MarkdownParser extends BaseParser{constructor(_,y,w,$,B,R){super(_,y,w,$,B,R),this._markdownNodeParser=async H=>this._nodeParser(H),this._markdownCommonParser=async({element:H,flavour:j,type:q,checked:X,ignoreEmptyElement:ee=!0})=>{const te=await this._commonHTML2Block(H,j,q,X,ee);return te?[te]:null},this._markdownListItemParser=async H=>{let q=H.parentElement?.tagName==="OL"?"numbered":"bulleted",X,ee;return((ee=H.firstElementChild)?.tagName==="INPUT"||(ee=H.firstElementChild?.firstElementChild)?.tagName==="INPUT")&&(q="todo",X=ee?.getAttribute("checked")!==null),H.firstChild instanceof Text&&(H.firstChild.textContent?.startsWith("[] ")?(H.firstChild.textContent=H.firstChild.textContent.slice(3),q="todo",X=!1):H.firstChild.textContent?.startsWith("[ ] ")?(H.firstChild.textContent=H.firstChild.textContent.slice(4),q="todo",X=!1):H.firstChild.textContent?.startsWith("[x] ")&&(H.firstChild.textContent=H.firstChild.textContent.slice(4),q="todo",X=!0)),this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:list",type:q,checked:X})},this._markdownBlockQuoteParser=async H=>this._blockQuoteParser(H),this._markdownCodeBlockParser=async H=>this._codeBlockParser(H),this._markdownEmbedItemParser=async H=>{const j=[];if(j.push({insert:""}),H instanceof HTMLImageElement){const q=H.getAttribute("src")||"",X=await this._fetchFileHandler(q);if(!X||X.size===0)return[{flavour:"affine:paragraph",type:"text",children:[],text:[{insert:q,attributes:{link:q}}]}];{const ee=this._page.blobs;assertExists(ee);const te=await ee.set(X);return[{flavour:"affine:image",caption:H.alt,sourceId:te,children:[]}]}}return[{flavour:"affine:paragraph",type:"text",children:[],text:j}]},this._markdownTableParser=async H=>this._tableParser(H),this._markdownHeaderParser=async H=>this._headerParser(H),this._contextedContentParser=_.withContext("Markdown")}registerParsers(){this._contentParser.registerParserHtmlText2Block("MarkdownNodeParser",this._markdownNodeParser),this._contentParser.registerParserHtmlText2Block("MarkdownCommonParser",this._markdownCommonParser),this._contentParser.registerParserHtmlText2Block("MarkdownListItemParser",this._markdownListItemParser),this._contentParser.registerParserHtmlText2Block("MarkdownBlockQuoteParser",this._markdownBlockQuoteParser),this._contentParser.registerParserHtmlText2Block("MarkdownCodeBlockParser",this._markdownCodeBlockParser),this._contentParser.registerParserHtmlText2Block("MarkdownEmbedItemParser",this._markdownEmbedItemParser),this._contentParser.registerParserHtmlText2Block("MarkdownTableParser",this._markdownTableParser),this._contentParser.registerParserHtmlText2Block("MarkdownHeaderParser",this._markdownHeaderParser)}}class NotionHtmlParser extends BaseParser{constructor(_,y,w,$,B,R){super(_,y,w,$,B,R),this._notionHtmlNodeParser=async H=>this._nodeParser(H),this._notionHtmlCommonParser=async({element:H,flavour:j,type:q,checked:X,ignoreEmptyElement:ee=!0})=>{const te=await this._commonHTML2Block(H,j,q,X,ee);return te?[te]:null},this._notionHtmlListItemParser=async H=>{const j=getListItemType(H.parentElement);if(H.firstElementChild?.tagName==="DETAIL"||H.firstElementChild?.firstElementChild?.tagName==="SUMMARY"){const ee=await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H.firstElementChild.firstElementChild,flavour:"affine:list",type:j}),te=H.firstElementChild.childNodes,ne=[];for(let oe=1;oe<te.length;oe++){const ie=te.item(oe);if(ie&&ie instanceof Element){const ae=await this._contextedContentParser.getParserHtmlText2Block("NodeParser")?.(ie);ae&&ne.push(...ae)}}return ee&&ee.length>0&&(ee[0].children=[...ee[0].children||[],...ne]),ee}let q,X;return((X=H.firstElementChild)?.classList.contains("checkbox")||(X=H.firstElementChild?.firstElementChild)?.classList.contains("checkbox"))&&(q=X?.classList.contains("checkbox-on")??!1),this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:list",type:j,checked:q})},this._notionHtmlBlockQuoteParser=async H=>this._blockQuoteParser(H),this._notionHtmlCodeBlockParser=async H=>this._codeBlockParser(H),this._notionHtmlEmbedItemParser=async H=>{const j=[];let q=null,X="";if(H.tagName==="FIGURE"){if(H.children.length===1&&H.children[0].tagName==="A")return await this._contextedContentParser.getParserHtmlText2Block("CommonParser")?.({element:H,flavour:"affine:paragraph",type:"text"});q=H.querySelector("img");const ee=await getCaptionText(H,this._contextedContentParser);j.push(...ee||[]),ee&&ee.length>0&&(X=ee[0].insert||"");const te=H.querySelector(".bookmark.source");if(te){const ne=te?.getAttribute("href")??"",oe=te?.querySelector(".bookmark-title")?.textContent??"Bookmark",ie=te?.querySelector(".bookmark-description")?.textContent??ne,ae=te?.querySelector(".bookmark-icon")?.getAttribute("src")??"",re=te?.querySelector(".bookmark-image")?.getAttribute("src")??"",se=te?.querySelector("figcaption")?.textContent??"";return[{flavour:"affine:bookmark",children:[],url:ne,bookmarkTitle:oe,description:ie,icon:ae,image:re,caption:se}]}}else H instanceof HTMLImageElement&&(q=H,j.push({insert:""}));if(q){if(q.classList.contains("bookmark-icon")){const ne=H.querySelector("a");ne&&(X=ne.getAttribute("href")||""),q=H.querySelector(".bookmark-image")}const ee=q?.getAttribute("src")||"",te=await this._fetchFileHandler(ee);if(!te||te.size===0)return[{flavour:"affine:paragraph",type:"text",children:[],text:[{insert:ee,attributes:{link:ee}}]}];{const ne=this._page.blobs;return assertExists(ne),[{flavour:"affine:image",sourceId:await ne.set(te),children:[],caption:X}]}}return[{flavour:"affine:paragraph",type:"text",children:[],text:j}]},this._notionHtmlTableParser=async H=>this._tableParser(H),this._notionHtmlHeaderParser=async H=>this._headerParser(H),this._contextedContentParser=_.withContext("NotionHtml")}registerParsers(){this._contentParser.registerParserHtmlText2Block("NotionHtmlNodeParser",this._notionHtmlNodeParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlCommonParser",this._notionHtmlCommonParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlListItemParser",this._notionHtmlListItemParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlBlockQuoteParser",this._notionHtmlBlockQuoteParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlCodeBlockParser",this._notionHtmlCodeBlockParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlEmbedItemParser",this._notionHtmlEmbedItemParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlTableParser",this._notionHtmlTableParser),this._contentParser.registerParserHtmlText2Block("NotionHtmlHeaderParser",this._notionHtmlHeaderParser)}}const getCaptionText=async(k,_)=>{const y=k.querySelector("figcaption");if(y){const w=await _.getParserHtmlText2Block("CommonParser")?.({element:y,flavour:"affine:paragraph",type:"text"});if(w&&w.length>0)return w[0].text}return null},getListItemType=k=>{if(assertExists(k),k.tagName==="OL")return"numbered";if(k.tagName==="UL"){if(k.classList.contains("bulleted-list")||k.classList.contains("toggle"))return"bulleted";if(k.classList.contains("to-do-list"))return"todo"}return"bulleted"};class ContentParser{constructor(_,y={}){this.slots={beforeHtml2Block:new Slot},this._parsers={},this.urlPattern=/(?<=\s|^)https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_+.~#?&/=]*)(?=\s|$)/g,registerAllBlocks(),this._page=_,this._imageProxyEndpoint=y?.imageProxyEndpoint,!this._imageProxyEndpoint&&location.protocol==="https:"&&location.hostname.split(".").includes("affine")&&(this._imageProxyEndpoint="https://workers.toeverything.workers.dev/proxy/image"),this._markdownParser=new MarkdownParser(this,_,y.fetchFileHandler,y.textStyleHandler,y.tableParseHandler,y.tableTitleColumnHandler),this._notionHtmlParser=new NotionHtmlParser(this,_,y.fetchFileHandler,y.textStyleHandler,y.tableParseHandler,y.tableTitleColumnHandler),this._markdownParser.registerParsers(),this._notionHtmlParser.registerParsers()}async exportHtml(){const _=this._page.root;if(!_)return;const y=new Map,w=await this.block2Html([this.getSelectedBlock(_)],y);FileExporter.exportHtml(_.title.toString(),_.id,w,y,this._page.blobs)}async exportMarkdown(){const _=this._page.root;if(!_)return;const y=new Map,w=await this.block2Html([this.getSelectedBlock(_)],y);FileExporter.exportHtmlAsMarkdown(_.title.toString(),_.id,w,y,this._page.blobs)}async _checkReady(){const _=location.pathname,y=isPageMode(this._page);return await new Promise(($,B)=>{let R=0;const H=setInterval(async()=>{try{this._checkCanContinueToCanvas(_,y)}catch(ee){clearInterval(H),B(ee)}const j=this._page.root,q=j?getPageBlock(j):null,X=document.querySelector("affine-image-block-loading-card");q&&!X&&(clearInterval(H),$(!0)),R++,R>10*60&&(clearInterval(H),$(!1))},100)})}async edgelessToCanvas(_,y,w,$){if(!this._page.root)return;const R=(await __vitePreload(()=>import("./html2canvas.esm.f16e60ff.js"),[])).default;if(!(R instanceof Function))return;const H=location.pathname,j=isPageMode(this._page),q=getEditorContainer(this._page),X=document.querySelector(".affine-block-children-container");if(!X)return;const ee=window.devicePixelRatio||1,te=document.createElement("canvas");te.width=(y.w+100)*ee,te.height=(y.h+100)*ee;const ne=te.getContext("2d");if(!ne)return;ne.scale(ee,ee),ne.fillStyle=window.getComputedStyle(X).backgroundColor,ne.fillRect(0,0,te.width,te.height);const oe={ignoreElements:function(re){return!!(re.tagName==="AFFINE-BLOCK-HUB"||re.tagName==="EDGELESS-TOOLBAR"||re.classList.contains("dg"))},onclone:function(re,se){se.style.setProperty("transform","none");const le=re.querySelector(".affine-edgeless-layer");le&&le instanceof HTMLElement&&le.style.setProperty("transform","none"),re.querySelectorAll("[style*='box-shadow']").forEach(function(he){he instanceof HTMLElement&&he.style.setProperty("box-shadow","none")})},backgroundColor:window.getComputedStyle(q).backgroundColor,useCORS:!this._imageProxyEndpoint,proxy:this._imageProxyEndpoint},ie=w??_.getSortedElementsByBound(y);for(const re of ie){const se=getBlockElementById(re.id)?.parentElement,le=xywhArrayToObject(re),ue=await R(se,oe);ne.drawImage(ue,le.x-y.x+50,le.y-y.y+50,le.w,le.h),this._checkCanContinueToCanvas(H,j)}const ae=_.surface.viewport.getCanvasByBound(y,$);return ne.drawImage(ae,50,50,y.w,y.h),te}async _docToCanvas(){const _=(await __vitePreload(()=>import("./html2canvas.esm.f16e60ff.js"),[])).default;if(!(_ instanceof Function))return;const y=location.pathname,w=isPageMode(this._page),$=getEditorContainer(this._page),B=$.querySelector(".affine-doc-page-block-container");if(!B)return;const R={ignoreElements:function(j){return j.tagName==="AFFINE-BLOCK-HUB"||j.tagName==="EDGELESS-TOOLBAR"||j.classList.contains("dg")?!0:!!(j.classList.contains("close")&&j.parentElement?.classList.contains("meta-data-expanded-title")||j.classList.contains("expand")&&j.parentElement?.classList.contains("meta-data"))},backgroundColor:window.getComputedStyle($).backgroundColor,useCORS:!this._imageProxyEndpoint,proxy:this._imageProxyEndpoint},H=await _(B,R);return this._checkCanContinueToCanvas(y,w),H}_checkCanContinueToCanvas(_,y){if(location.pathname!==_||isPageMode(this._page)!==y)throw new Error("Unable to export content to canvas")}async _toCanvas(){if(await this._checkReady(),isPageMode(this._page))return await this._docToCanvas();{const _=this._page.root;if(!_)return;const y=getPageBlock(_),w=y.getElementsBound();return assertExists(w),await this.edgelessToCanvas(y,w)}}async exportPng(){if(!this._page.root)return;const y=await this._toCanvas();y&&FileExporter.exportPng(this._page.root.title.toString(),y.toDataURL("PNG"))}async exportPdf(){const _=this._page.root;if(!_)return;const y=await this._toCanvas();if(!y)return;const $=await(await __vitePreload(()=>import("./index.74ffce91.js"),["static/index.74ffce91.js","static/_commonjsHelpers.de833af9.js"])).PDFDocument.create(),B=$.addPage([y.width,y.height]),R=await $.embedPng(y.toDataURL("PNG")),{width:H,height:j}=R.scale(1);B.drawImage(R,{x:0,y:0,width:H,height:j});const q=await $.saveAsBase64({dataUri:!0});FileExporter.exportFile(_.title.toString()+".pdf",q)}async block2Html(_,y){let w="";for(let $=0;$<_.length;$++)w=w+await this._getHtmlInfoBySelectionInfo(_[$],y);return w}async block2Text(_){return(await Promise.all(_.map(y=>this._getTextInfoBySelectionInfo(y)))).reduce((y,w)=>y+w,"")}async htmlText2Block(_,y="NotionHtml"){const w=document.createElement("html");return w.innerHTML=_,w.querySelector("head")?.remove(),this.slots.beforeHtml2Block.emit(w),this._convertHtml2Blocks(w,y)}async file2Blocks(_){const y=_.files;if(!y)return[];const w=y[0];if(!w)return[];const $=this._page.blobs;if(w.type.includes("image"))return[{flavour:"affine:image",sourceId:await $.set(new File([w],w.name,{type:w.type})),children:[]}];if(this._page.awarenessStore.getFlag("enable_attachment_block")){if(w.size>MAX_ATTACHMENT_SIZE)return toast(`You can only upload files less than ${humanFileSize(MAX_ATTACHMENT_SIZE,!0,0)}`),[];try{const B=await $.set(new File([w],w.name,{type:w.type}));return[{flavour:"affine:attachment",name:w.name,sourceId:B,size:w.size,type:w.type,children:[]}]}catch(B){console.error(B),B instanceof Error&&toast(`Failed to upload attachment! ${B.message||B.toString()}`)}}return[]}async markdown2Block(_){const y=this._markdown2Html(_);return this.htmlText2Block(y,"Markdown")}async importMarkdown(_,y){const w=this._markdown2Html(_),$=await this.htmlText2Block(w,"Markdown");await this.importBlocks($,y),this._importMetaDataFromHtml(w)}async importHtml(_,y){const w=await this.htmlText2Block(_,"NotionHtml");await this.importBlocks(w,y),this._importMetaDataFromHtml(_)}async importBlocks(_,y){const w=this._page.getBlockById(y);assertExists(w);const{getServiceOrRegister:$}=await __vitePreload(()=>import("./index.aded783b.js"),["static/index.aded783b.js","static/index.9fb136d3.js","static/directive-helpers.ea3d1013.js","static/_commonjsHelpers.de833af9.js","static/preload-helper.5bd54887.js","static/typeof.b6c3327d.js","static/_commonjs-dynamic-modules.302442b1.js"]);await(await $(w.flavour)).json2Block(w,_)}registerParserHtmlText2Block(_,y){this._parsers[_]=y}withContext(_){return{get context(){return _},getParserHtmlText2Block:y=>this._parsers[_+y]||null}}getParserHtmlText2Block(_){return this._parsers[_]||null}text2blocks(_){return _.replaceAll(`\r
`,`
`).split(`
`).map(y=>{const w=y.split(this.urlPattern),$=y.match(this.urlPattern),B=[];for(let R=0;R<w.length;R++)w[R]&&B.push({insert:w[R]}),$&&$[R]&&B.push({insert:$[R],attributes:{link:$[R]}});return{flavour:"affine:paragraph",type:"text",text:B,children:[]}})}getSelectedBlock(_){return _.flavour==="affine:page"?{model:_,children:_.children.filter(y=>y.flavour==="affine:note").map(y=>this.getSelectedBlock(y))}:{model:_,children:_.children.map(y=>this.getSelectedBlock(y))}}async _getHtmlInfoBySelectionInfo(_,y){const w=_.model,$=[];for(let j=0;j<_.children.length;j++){const q=await this._getHtmlInfoBySelectionInfo(_.children[j],y);q&&$.push(q)}const{getServiceOrRegister:B}=await __vitePreload(()=>import("./index.aded783b.js"),["static/index.aded783b.js","static/index.9fb136d3.js","static/directive-helpers.ea3d1013.js","static/_commonjsHelpers.de833af9.js","static/preload-helper.5bd54887.js","static/typeof.b6c3327d.js","static/_commonjs-dynamic-modules.302442b1.js"]);return await(await B(w.flavour)).block2html(w,{childText:$.join(""),begin:_.startPos,end:_.endPos},y)}async _getTextInfoBySelectionInfo(_){const y=_.model,w=[];for(const R of _.children){const H=await this._getTextInfoBySelectionInfo(R);H&&w.push(H)}const{getServiceOrRegister:$}=await __vitePreload(()=>import("./index.aded783b.js"),["static/index.aded783b.js","static/index.9fb136d3.js","static/directive-helpers.ea3d1013.js","static/_commonjsHelpers.de833af9.js","static/preload-helper.5bd54887.js","static/typeof.b6c3327d.js","static/_commonjs-dynamic-modules.302442b1.js"]);return(await $(y.flavour)).block2Text(y,{childText:w.join(""),begin:_.startPos,end:_.endPos})}async _convertHtml2Blocks(_,y){const w=Array.from(_.children).map(async B=>B.tagName==="STYLE"?[]:await this.withContext(y).getParserHtmlText2Block("NodeParser")?.(B)||[]),$=[];for(const B of w)$.push(await B);return $.flat().filter(B=>B)}_markdown2Html(_){const y={name:"underline",level:"inline",start(H){return H.indexOf("~")},tokenizer(H){const q=/^~([^~]+)~/.exec(H);if(q)return{type:"underline",raw:q[0],text:q[1].trim()}},renderer(H){return`<u>${H.text}</u>`}},w={name:"inlineCode",level:"inline",start(H){return H.indexOf("`")},tokenizer(H){const q=/^(?:`)(`{2,}?|[^`]+)(?:`)$/g.exec(H);if(q)return{type:"inlineCode",raw:q[0],text:q[1].trim()}},renderer(H){return`<code>${H.text}</code>`}},$={name:"pageMetaTags",level:"block",start(H){return H.indexOf("Tags: ")},tokenizer(H){const q=/^Tags: (.*)$/g.exec(H);if(q)return{type:"pageMetaTags",raw:q[0],text:q[1].trim()}},renderer(H){return`<div class="page-meta-data">
          <div class="value">
            <div class="tags">
              ${H.text.split(",").map(j=>`<div class="tag">${j}</div>`).join("")}
            </div>
          </div>
        </div>`}},B=H=>{if(H.type==="list_item"&&H.tokens.length>0&&H.tokens[0].type==="list"&&H.tokens[0].items.length===1){const j=H.tokens[0].items[0];if(j.tokens.length===0||j.tokens.length===1&&j.tokens[0].type==="text"){const q=j.tokens.length===1?j.tokens[0]:{raw:"",text:"",type:"text",tokens:[]},X=j.raw.substring(0,j.raw.length-j.text.length);q.raw=X+q.raw,q.text=X+q.text,q.tokens=q.tokens||[],q.tokens.unshift({type:"text",text:X,raw:X}),H.tokens[0]=q}}};return marked.use({extensions:[y,w,$],walkTokens:B}),marked.parse(_)}_importMetaDataFromHtml(_){const w=this._getMetaDataFromhtmlText(_).tags.map($=>({id:nanoid(),value:$.trim(),color:getTagColor()}));this._page.meta.tags.push(...w.map($=>$.id)),this._page.workspace.meta.setProperties({...this._page.workspace.meta.properties,tags:{...this._page.workspace.meta.properties.tags,options:w}})}_getMetaDataFromhtmlText(_){const y=document.createElement("html");y.innerHTML=_;const w=y.querySelectorAll(".page-meta-data .tags .tag");return{tags:Array.from(w).map($=>$.textContent??"").filter($=>$!=="")}}}let ClipboardItem$1=class{constructor(_,y){this.mimeType=_,this.data=y}hasData(){return this.data!==null&&this.data!==void 0}};class MarkdownUtils{checkIfTextContainsMd(_){_=_.replace(/¨/g,"¨T"),_=_.replace(/\$/g,"¨D"),_=_.replace(/\r\n/g,`
`),_=_.replace(/\r/g,`
`),_=_.replace(/\u00A0/g,"&nbsp;"),_=`

${_}

`,_=MarkdownUtils._detab(_);for(let y=0;y<MarkdownUtils._checkRegArr.length;y++){const w=y===3?`${_}¨0`:_;if(MarkdownUtils._checkRegArr[y].test(w))return!0}return!1}static _detab(_){return _=_.replace(/\t(?=\t)/g," "),_=_.replace(/\t/g,"¨A¨B"),_=_.replace(/¨B(.+?)¨A/g,(y,w)=>{let $=w;const B=4-$.length%4;for(let R=0;R<B;R++)$+=" ";return $}),_=_.replace(/¨A/g," "),_=_.replace(/¨B/g,""),_}}MarkdownUtils._checkRegArr=[/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/m,/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/m,/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/,/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/m,/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]/,/!\[([^\]]*?)][ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/,/!\[([^\]]*?)][ \t]*\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/,/!\[([^\]]*?)][ \t]*\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/,/\[((?:\[[^\]]*]|[^\[\]])*)][ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/,/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]/,/\[((?:\[[^\]]*]|[^\[\]])*)][ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/];const markdownUtils=new MarkdownUtils;var CLIPBOARD_MIMETYPE;(function(k){k.HTML="text/html",k.TEXT="text/plain",k.BLOCKSUITE_PAGE="blocksuite/page",k.BLOCKSUITE_SURFACE="blocksuite/surface",k.BLOCKSUITE_DATABASE="blocksuite/database",k.IMAGE_PNG="image/png"})(CLIPBOARD_MIMETYPE||(CLIPBOARD_MIMETYPE={}));function extractCustomDataFromHTMLString(k,_){return new DOMParser().parseFromString(_,"text/html").querySelector(`blocksuite[data-type="${k}"]`)?.getAttribute("data-clipboard")}function getSurfaceClipboardData(k){const _=k.clipboardData;if(!_)return;const y=_.getData(CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE);if(y)return JSON.parse(y);const w=_.getData(CLIPBOARD_MIMETYPE.HTML),$=extractCustomDataFromHTMLString(CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE,w);if($)return JSON.parse($)}function isPureFileInClipboard(k){const _=k.types;return _.length===1&&_[0]==="Files"||_.length===2&&(_.includes("text/plain")||_.includes("text/html"))&&_.includes("Files")}function performNativeCopy$1(k){let _=!1;const y=document.createElement("textarea");y.value="temp",document.body.appendChild(y),y.select(),y.setSelectionRange(0,y.value.length);const w=$=>{const B=$.clipboardData;B&&k.forEach(R=>B.setData(R.mimeType,R.data)),$.preventDefault(),$.stopPropagation(),y.removeEventListener("copy",w)};y.addEventListener("copy",w);try{_=document.execCommand("copy")}finally{y.removeEventListener("copy",w),document.body.removeChild(y)}return _}function createSurfaceClipboardItems(k){const _=JSON.stringify(k),y=new ClipboardItem$1(CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE,_),w=new ClipboardItem$1(CLIPBOARD_MIMETYPE.HTML,createHTMLStringForCustomData(_,CLIPBOARD_MIMETYPE.BLOCKSUITE_SURFACE));return[y,w]}function createHTMLStringForCustomData(k,_){return`<blocksuite style="display: none" data-type="${_}" data-clipboard="${k.replace(/"/g,"&quot;")}"></blocksuite>`}async function getBlockClipboardInfo(k){if(registerAllBlocks(),k instanceof BaseBlockModel){const _=blockModel2selectBlocksInfo(k);return await generateClipboardInfo(_)}return await generateClipboardInfo(k)}async function generateClipboardInfo(k){const _=k.model,y=[],w=[],$=[];for(let q=0;q<k.children.length;q++){const{html:X,text:ee,json:te}=await getBlockClipboardInfo(k.children[q]);X&&y.push(X),ee&&w.push(ee),$.push(te)}const B=await getService$1(_.flavour),R=await B.block2html(_,{childText:y.join(""),begin:k.startPos,end:k.endPos}),H=B.block2Text(_,{childText:w.join(""),begin:k.startPos,end:k.endPos}),j=B.block2Json(_,$,k.startPos,k.endPos);return{html:R,text:H,json:j}}function blockModel2selectBlocksInfo(k){return{model:k,children:k.children.map(_=>blockModel2selectBlocksInfo(_))}}function selectedModels2selectBlocksInfo(k,_){const y=new Set(k.map(R=>R.id)),w=[],$=new Map,B=new Map;return k.forEach((R,H)=>{for(const te of R.children)if(y.has(te.id))$.set(te.id,R.id);else break;const j=H==0?_?.from.index:void 0;let q;H==k.length-1&&(_?.to?q=_.to.index+_.to.length:_?.from&&(q=_?.from.index+_?.from.length));const X={model:R,startPos:j,endPos:q,children:[]};B.set(R.id,X),(B.get($.get(R.id)??"")?.children??w).push(X)}),w}async function createPageClipboardItems(k,_){const y=selectedModels2selectBlocksInfo(k,_);registerAllBlocks();const w=await Promise.all(y.map(async q=>await getBlockClipboardInfo(q))),$=JSON.stringify(w.filter(q=>q.json).map(q=>q.json)),B=createHTMLStringForCustomData($,CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE),R=new ClipboardItem$1(CLIPBOARD_MIMETYPE.TEXT,w.reduce((q,X,ee)=>`${q}${X.text}${ee===w.length-1?"":`
`}`,"")),H=new ClipboardItem$1(CLIPBOARD_MIMETYPE.HTML,`${w.map(q=>q.html).join("")}${B}`),j=new ClipboardItem$1(CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE,$);return[R,H,j]}async function copyBlocksInPage(k){const _=getSelectedContentModels(k,["text","block"]),y=k.selection.find("text"),w=await createPageClipboardItems(_,y),$=hasNativeSelection()?getCurrentNativeRange():null;return performNativeCopy$1(w),$&&resetNativeSelection($),w}async function copyBlocks(k){const _=await createPageClipboardItems(k),y=hasNativeSelection()?getCurrentNativeRange():null;performNativeCopy$1(_),y&&resetNativeSelection(y)}async function textedClipboardData2Blocks(k,_){if(!_)return[];const y=new ContentParser(k),w=_.getData(CLIPBOARD_MIMETYPE.HTML);if(w){const B=extractCustomDataFromHTMLString(CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE,w);if(B)return JSON.parse(B)}const $=_.getData(CLIPBOARD_MIMETYPE.TEXT);return y.text2blocks($)}async function clipboardData2Blocks(k,_){if(!_)return[];const y=new ContentParser(k);if(isPureFileInClipboard(_))return y.file2Blocks(_);const w=_.getData(CLIPBOARD_MIMETYPE.HTML);if(w){const H=extractCustomDataFromHTMLString(CLIPBOARD_MIMETYPE.BLOCKSUITE_PAGE,w);if(H)return JSON.parse(H)}const $=_.getData(CLIPBOARD_MIMETYPE.TEXT),R=!/<code/.test(w)&&markdownUtils.checkIfTextContainsMd($);if(w&&!R){const H=await y.htmlText2Block(removeFragmentFromHtmlClipboardString(w));if(H.length)return H}return R?await y.markdown2Block($):y.text2blocks($)}function removeFragmentFromHtmlClipboardString(k){return k.replace(/<!--StartFragment-->([^]*)<!--EndFragment-->/g,"$1")}function copyOnPhasorElementWithText(k){const _=getEdgelessCanvasTextEditor(k);if(_){const y=_.vEditor;assertExists(y);const w=y.getVRange();if(w){const $=y.yText.toString().slice(w.index,w.index+w.length),B=new ClipboardItem$1(CLIPBOARD_MIMETYPE.TEXT,$);_.setKeeping(!0),performNativeCopy$1([B]),_.setKeeping(!1),y.rootElement.focus(),y.setVRange(w)}}}function deleteModelsByTextSelection(k,_){_||(_=k.selection.find("text")),assertExists(_);const y=k.page,w=getSelectedContentModels(k,["text"]);if(w.length===0)return null;const $=w[0],B=w[w.length-1];if(!$.text||!B.text)throw new Error("startModel or endModel does not have text");const R=getVirgoByModel($);return assertExists(R),$===B?(y.captureSync(),_.from.index>0&&_.isCollapsed()||($.text.delete(_.from.index,_.from.length),R.setVRange({index:_.from.index,length:0})),$):(y.captureSync(),$.text.delete(_.from.index,_.from.length),B.text.delete(_.to?.index??0,_.to?.length??0),$.text.join(B.text),w.slice(1).forEach(H=>{y.deleteBlock(H)}),R.setVRange({index:_.from.index,length:0}),$)}function prepareConnectorClipboardData(k,_){const y=k.source?.id,w=k.target?.id,$=k.serialize();return y&&!_.find(B=>B.id===y)&&($.source={position:k.absolutePath[0]}),w&&!_.find(B=>B.id===w)&&($.target={position:k.absolutePath[k.absolutePath.length-1]}),$}async function prepareClipboardData(k){return(await Promise.all(k.map(async y=>isTopLevelBlock(y)?(await getBlockClipboardInfo(y)).json:y instanceof ConnectorElement?prepareConnectorClipboardData(y,k):y.serialize()))).filter(y=>!!y)}class EdgelessClipboard{constructor(_,y){this._onCut=w=>{w.preventDefault(),this._onCopy(w);const{state:$,elements:B}=this.selection;if($.editing){deleteModelsByTextSelection(this._edgeless);return}this._page.transact(()=>{deleteElements(this._edgeless,B)}),this.selection.setSelection({editing:!1,elements:[]})},this._onCopy=async w=>{w.preventDefault(),await this.copy()},this._onPaste=async w=>{if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)return;w.preventDefault();const{state:$,elements:B}=this.selection;if($.editing){isPhasorElementWithText(B[0])||this._pasteInTextNote(w);return}if(w.clipboardData&&isPureFileInClipboard(w.clipboardData)){const H=w.clipboardData.files;if(H.length===0)return;const j=[];for(let q=0;q<H.length;q++){const X=H[q];if(X.type.startsWith("image")){const ee=await this._edgeless.page.blobs.set(X);j.push({file:X,sourceId:ee})}}await this._edgeless.addImages(j);return}const R=getSurfaceClipboardData(w);R&&this._pasteShapesAndNotes(R)},this._page=_,this._edgeless=y}init(_=this._page){this._page=_,document.body.addEventListener("cut",this._onCut),document.body.addEventListener("copy",this._onCopy),document.body.addEventListener("paste",this._onPaste)}get toolMgr(){return this._edgeless.tools}get selection(){return this._edgeless.selectionManager}get textSelection(){return this._edgeless.selection.find("text")}get slots(){return this._edgeless.slots}get surface(){return this._edgeless.surface}dispose(){document.body.removeEventListener("cut",this._onCut),document.body.removeEventListener("copy",this._onCopy),document.body.removeEventListener("paste",this._onPaste)}async copy(){const{state:_}=this.selection,y=getCopyElements(this._edgeless,this.selection.elements);if(_.editing){isPhasorElementWithText(y[0])?copyOnPhasorElementWithText(this._edgeless):await copyBlocksInPage(this._edgeless);return}const w=await prepareClipboardData(y),$=createSurfaceClipboardItems(w);performNativeCopy$1($)}async _pasteInTextNote(_){const y=await clipboardData2Blocks(this._page,_.clipboardData);if(!y.length)return;this._page.captureSync(),deleteModelsByTextSelection(this._edgeless);const w=this.textSelection;assertExists(w);const B=getSelectedContentModels(this._edgeless,["text"])[0];assertExists(B),await getService$1(B.flavour).json2Block(B,y,w.from)}_createPhasorElement(_){const y=this.surface.addElement(_.type,_),w=this.surface.pickById(y);return assertExists(w),w}_createPhasorElements(_,y){const w=groupBy$1(_,$=>$.type==="connector"?"connectors":"nonConnectors");return[...w.nonConnectors?.map($=>{const B=$.id;assertExists(B);const R=this._createPhasorElement($);return y.set(B,R.id),R}).filter($=>!!$)??[],...w.connectors?.map($=>{const B=$.source.id;B&&($.source.id=y.get(B)??B);const R=$.target.id;return R&&($.target.id=y.get(R)??R),this._createPhasorElement($)})??[]]}async _createNoteBlocks(_,y){return await Promise.all(_.map(async({id:$,xywh:B,children:R,background:H})=>{assertExists(B);const[j,q,X,ee]=deserializeXYWH(B),te=serializeXYWH(j,q,X,ee),ne=this._page.addBlock("affine:note",{xywh:te,background:H},this._page.root?.id),oe=this._page.getBlockById(ne);return $&&y.set($,ne),assertExists(oe),await addSerializedBlocks(this._page,R,oe,0),ne}))}_getOldCommonBound(_,y){const w=getCommonBound([..._,...y].map(({xywh:$})=>{if(!$)return;const[B,R,H,j]=typeof $=="string"?deserializeXYWH($):$;return{x:B,y:R,w:H,h:j}}).filter($=>!!$));return assertExists(w),w}_emitSelectionChangeAfterPaste(_,y){const w=[..._,...y.filter($=>this._page.getBlockById($)?.flavour==="affine:note")];this.selection.setSelection({editing:!1,elements:w})}async _pasteShapesAndNotes(_){const y=groupBy$1(_,ne=>isTopLevelBlock(ne)?"notes":"elements"),w=new Map,$=await this._createNoteBlocks(y.notes||[],w),B=$.map(ne=>this._page.getBlockById(ne)),R=this._createPhasorElements(y.elements||[],w),{lastMousePos:H}=this.toolMgr,[j,q]=this.surface.toModelCoord(H.x,H.y),X=this._getOldCommonBound(R,B),ee=j-X.w/2,te=q-X.h/2;R.forEach(ne=>{const oe=new Bound(ee+ne.x-X.x,te+ne.y-X.y,ne.w,ne.h);ne instanceof ConnectorElement?this._edgeless.connector.updateXYWH(ne,oe):this.surface.updateElement(ne.id,{xywh:oe.serialize()})}),B.forEach(ne=>{const[oe,ie,ae,re]=deserializeXYWH(ne.xywh),se=new Bound(ee+oe-X.x,te+ie-X.y,ae,re);this._page.updateBlock(ne,{xywh:serializeXYWH(se.x,se.y,se.w,se.h)})}),this._emitSelectionChangeAfterPaste(R.map(ne=>ne.id),$)}async copyAsPng(_,y){const w=_.length,$=y.length;if(w+$===0)return;_.sort(compare$1),y.sort(compare$1);const B=[];_.forEach(q=>{B.push(Bound.deserialize(q.xywh))}),y.forEach(q=>{B.push(Bound.deserialize(q.xywh))});const R=getCommonBound(B);if(!R)return;const j=await new ContentParser(this._page).edgelessToCanvas(this._edgeless,R,_,y);if(assertExists(j),window.apis?.clipboard?.copyAsImageFromString)await window.apis.clipboard?.copyAsImageFromString(j.toDataURL(CLIPBOARD_MIMETYPE.IMAGE_PNG));else{const q=await new Promise((X,ee)=>j.toBlob(te=>te?X(te):ee("Canvas can not export blob"),CLIPBOARD_MIMETYPE.IMAGE_PNG));assertExists(q),await navigator.clipboard.write([new ClipboardItem({[q.type]:q})])}}}class PageClipboard{constructor(_){this._onPaste=async y=>{const w=y.get("clipboardState").raw,$=this._ele.selection.find("text");if(!w.clipboardData||!$)return;w.preventDefault();let B=[];const R=deleteModelsByTextSelection(this._ele,$);if(assertExists(R),["affine:code"].includes(R?.flavour??"")?B=await textedClipboardData2Blocks(this._page,w.clipboardData):B=await clipboardData2Blocks(this._page,w.clipboardData),!B.length)return;this._page.captureSync(),await getService$1(R.flavour).json2Block(R,B,$.from),this._page.captureSync(),this._page.slots.pasted.emit(B)},this._onCopy=async y=>{y.get("clipboardState").raw.preventDefault(),this._page.captureSync(),await this._copyBlocksInPage(),this._page.captureSync(),this._page.slots.copied.emit()},this._onCut=async y=>{const w=y.get("clipboardState").raw,$=this._ele.selection.find("text");if($){w.preventDefault(),await this._onCopy(y),deleteModelsByTextSelection(this._ele,$);return}const B=this._ele.selection.filter("block");w.preventDefault(),await this._onCopy(y),B.forEach(R=>{const H=this._page.getBlockById(R.blockId);H&&this._page.deleteBlock(H)})},this._ele=_}init(_){this._page=_,this._ele.handleEvent("cut",y=>{this._onCut(y)}),this._ele.handleEvent("copy",y=>{this._onCopy(y)}),this._ele.handleEvent("paste",y=>{this._onPaste(y)},{global:!0})}dispose(){}async _copyBlocksInPage(){return await copyBlocksInPage(this._ele)}}class PageKeyboardManager{constructor(_){this.pageElement=_,this._handleDelete=()=>{const y=this._currentSelection.filter(w=>w.is("block"));y.length!==0&&this._page.transact(()=>{const{path:w}=this._replaceBlocksBySelection(y,"affine:paragraph",{});this._selection.set([this._selection.getInstance("text",{from:{index:0,length:0,path:w},to:null})])})},this.pageElement.bindHotKey({"Mod-z":y=>{y.get("defaultState").event.preventDefault(),this._page.canUndo&&this._page.undo()},"Shift-Mod-z":y=>{y.get("defaultState").event.preventDefault(),this._page.canRedo&&this._page.redo()},Backspace:this._handleDelete,Delete:this._handleDelete,"Control-d":this._handleDelete},{global:!0})}get _page(){return this.pageElement.page}get _selection(){return this.pageElement.root.selectionManager}get _currentSelection(){return this._selection.value}_deleteBlocksBySelection(_){const y=[];return _.forEach(w=>{const $=this._page.getBlockById(w.blockId);$&&(y.push(...$.children),this._page.deleteBlock($))}),y}_replaceBlocksBySelection(_,y,w){const $=_[0],B=this._page.getBlockById($.blockId),R=this.pageElement.root.viewStore.viewFromPath("block",$.path);assertExists(B,`Cannot find block ${$.blockId}`),assertExists(R,`Cannot find block view ${$.path.join(" -> ")}`);const H=R.parentPath,j=this._page.getParent(B),q=j?.children.indexOf(B),X=this._deleteBlocksBySelection(_),ee=this._page.addBlock(y,{props:w,children:X},j,q);return{blockId:ee,path:H.concat(ee)}}}function pointIsNotText(k){if(k instanceof Element){const{cursor:_}=window.getComputedStyle(k);return _!=="text"}return!0}function caretFromPoint(k,_){if(document.caretPositionFromPoint)try{const y=document.caretPositionFromPoint(k,_);if(y)return{node:y.offsetNode,offset:y.offset}}catch{}if(document.caretRangeFromPoint){const y=document.caretRangeFromPoint(k,_);if(y)return{node:y.startContainer,offset:y.startOffset}}}function rangeFromCaret(k){const _=document.createRange();return _.setStart(k.node,k.offset),_.setEnd(k.node,k.offset),_}function autoScroll$1(k,_,y=50){const{scrollHeight:w,clientHeight:$,scrollTop:B}=k;let R=B;const H=w-$;let j=0,q=!1;return Math.ceil(B)<H&&$-_<y?(j=y-($-_),q=Math.ceil(R)<H):B>0&&_<y&&(j=_-y,q=R>0),R+=j*.25,q&&B!==R?(k.scrollTop=R,!0):!1}class Gesture{get _selectionManager(){return this.pageElement.root.selectionManager}get _viewportElement(){return this.pageElement.tagName==="AFFINE-DOC-PAGE"?this.pageElement.viewportElement:null}get _rangeManager(){return assertExists(this.pageElement.root.rangeManager),this.pageElement.root.rangeManager}constructor(_){this.pageElement=_,this.isNativeSelection=!1,this._startRange=null,this._rafID=0,this._dragStartHandler=y=>{const w=y.get("pointerState");if(pointIsNotText(w.event.target)){this.isNativeSelection=!1;return}w.button===0&&(this.isNativeSelection=!0,this._selectByCaret(y),w.raw.preventDefault())},this._selectByCaret=y=>{const w=y.get("pointerState"),$=caretFromPoint(w.raw.x,w.raw.y);if(!$)return;const B=rangeFromCaret($);this._startRange=B,($.node instanceof Element?$.node:$.node.parentElement)&&this._rangeManager.renderRange(B)},this._dragMoveHandler=y=>{if(this._clearRaf(),!this.isNativeSelection)return;const w=y.get("pointerState");w.raw.preventDefault();const $=()=>{if(!this._rafID)return;if(this._updateRange(w),this._viewportElement?autoScroll$1(this._viewportElement,w.raw.y):!1){this._rafID=requestAnimationFrame($);return}this._clearRaf()};this._rafID=requestAnimationFrame($)},this._dragEndHandler=()=>{this._clearRaf(),this.isNativeSelection&&(this._startRange=null,this.isNativeSelection=!1)},this._pointerMoveHandler=y=>{if(!this.isNativeSelection)return;y.get("defaultState").event.preventDefault()},this._tripleClickHandler=y=>{const w=y.get("pointerState"),$=caretFromPoint(w.raw.clientX,w.raw.clientY);if(!$||!($.node instanceof Element?$.node:$.node.parentElement))return;const R=document.elementFromPoint(w.x,w.y)?.closest('[data-virgo-root="true"]');if(!R)return;const H=getTextNodesFromElement(R),j=H[0],q=H[H.length-1],X=document.createRange();X.setStart(j,0),X.setEnd(q,Number(q.textContent?.length)),this._rangeManager.renderRange(X)},this._clickHandler=y=>{const w=y.get("pointerState");if(w.button>0)return;if(w.keys.shift){w.raw.preventDefault(),this._updateRange(w);return}(this._selectionManager.value.find(B=>B.is("text"))??null)&&this._selectByCaret(y)},this._doubleClickHandler=y=>{const w=y.get("pointerState"),$=caretFromPoint(w.raw.x,w.raw.y);if(!$)return;const{node:B,offset:R}=$;if(B.nodeType!==Node.TEXT_NODE)return;const H=B.textContent;if(!H||!H[R])return;let j,q;/\W/.test(H[R])?(j=R,q=R+1):(j=H.slice(0,R+1).search(/\w+$/),q=H.slice(R).search(/\W/),q<0?q=H.length:q=q+R);const X=document.createRange();X.setStart(B,j),X.setEnd(B,q),this._rangeManager.renderRange(X)},this._updateRange=y=>{if(!this._startRange)return;const w=caretFromPoint(y.raw.x,y.raw.y);if(!w||w.node.nodeType!==Node.TEXT_NODE||!w.node.parentElement?.closest('[data-virgo-root="true"]'))return;const $=rangeFromCaret(w);this._rangeManager.renderRange(this._startRange,$)},this.pageElement.handleEvent("dragStart",this._dragStartHandler),this.pageElement.handleEvent("dragMove",this._dragMoveHandler),this.pageElement.handleEvent("dragEnd",this._dragEndHandler),this.pageElement.handleEvent("pointerMove",this._pointerMoveHandler),this.pageElement.handleEvent("click",this._clickHandler),this.pageElement.handleEvent("doubleClick",this._doubleClickHandler),this.pageElement.handleEvent("tripleClick",this._tripleClickHandler),this.pageElement.handleEvent("beforeInput",()=>{const y=document.getSelection();this._startRange=y&&y.rangeCount>0?y.getRangeAt(0):null})}_clearRaf(){this._rafID&&(cancelAnimationFrame(this._rafID),this._rafID=0)}}var __decorate$2r=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DocPageBlockComponent=class extends BlockElement{constructor(){super(...arguments),this.keyboardManager=null,this.gesture=null,this.clipboard=new PageClipboard(this),this.getService=getService$1,this._isComposing=!1,this.slots={draggingAreaUpdated:new Slot,selectedRectsUpdated:new Slot,embedRectsUpdated:new Slot,embedEditingStateUpdated:new Slot,pageLinkClicked:new Slot,tagClicked:new Slot},this._titleVEditor=null,this._updateTitleInMeta=()=>{this.page.workspace.setPageMeta(this.page.id,{title:this.model.title.toString()})},this._onTitleKeyDown=_=>{if(_.isComposing||this.page.readonly)return;const y=!this.page.isEmpty,{page:w,model:$}=this;if(_.key==="Enter"&&y){_.preventDefault(),assertExists(this._titleVEditor);const B=this._titleVEditor.getVRange();assertExists(B);const R=$.title.split(B.index),H=w.addBlock("affine:paragraph",{text:R},this._getDefaultNoteBlock(),0);asyncFocusRichText(w,H);return}else if(_.key==="ArrowDown"&&y){_.preventDefault();const B=this._getDefaultNoteBlock(),R=B?.children.find(H=>matchFlavours(H,["affine:paragraph","affine:list","affine:code"]));if(R)asyncFocusRichText(w,R.id);else{const H=w.addBlock("affine:paragraph",{},B,0);asyncFocusRichText(w,H)}return}else _.key==="Tab"&&_.preventDefault()},this._onTitleCopy=_=>{const y=this._titleVEditor;if(!y)return;const w=y.getVRange();if(!w)return;const $=y.yText.toString().substring(w.index,w.index+w.length);_.clipboardData?.setData("text/plain",$)},this._onTitlePaste=_=>{const y=this._titleVEditor;if(!y)return;const w=y.getVRange();if(!w)return;const $=_.clipboardData?.getData("text/plain");if($){const B=$.replace(/(\r\n|\r|\n)/g,`
`);y.insertText(w,B),y.setVRange({index:w.index+B.length,length:0})}}}get titleVEditor(){return assertExists(this._titleVEditor),this._titleVEditor}get viewport(){if(!this.viewportElement)return{left:0,top:0,scrollLeft:0,scrollTop:0,scrollHeight:0,clientHeight:0,clientWidth:0};const{clientHeight:_,clientWidth:y,scrollHeight:w,scrollLeft:$,scrollTop:B}=this.viewportElement,{top:R,left:H}=this.viewportElement.getBoundingClientRect();return{top:R,left:H,clientHeight:_,clientWidth:y,scrollHeight:w,scrollLeft:$,scrollTop:B}}_initTitleVEditor(){const{model:_}=this,y=_.title;this._titleVEditor=new VEditor(y.yText),this._titleVEditor.mount(this._titleContainer),this._titleVEditor.disposables.addFromEvent(this._titleContainer,"keydown",this._onTitleKeyDown),this._titleVEditor.disposables.addFromEvent(this._titleContainer,"paste",this._onTitlePaste),this.addEventListener("copy",this._onTitleCopy),this._disposables.addFromEvent(this._titleContainer,"compositionstart",()=>this._isComposing=!0),this._disposables.addFromEvent(this._titleContainer,"compositionend",()=>this._isComposing=!1),this.model.title.yText.observe(()=>{this._updateTitleInMeta(),this.requestUpdate()}),this._titleVEditor.setReadonly(this.page.readonly)}_createDefaultNoteBlock(){const{page:_}=this,y=_.addBlock("affine:note",{},_.root?.id);return _.getBlockById(y)}_getDefaultNoteBlock(){return this.page.root?.children.find(_=>_.flavour==="affine:note")??this._createDefaultNoteBlock()}updated(_){_.has("model")&&this.model&&!this._titleVEditor&&this._initTitleVEditor()}_initSlotEffects(){this._disposables.add(this.model.childrenUpdated.on(()=>this.requestUpdate()))}_initReadonlyListener(){const _=this.page;let y=_.readonly;this._disposables.add(_.awarenessStore.slots.update.on(()=>{y!==_.readonly&&(y=_.readonly,this._titleVEditor?.setReadonly(y))}))}firstUpdated(){this._initSlotEffects(),this._initReadonlyListener()}connectedCallback(){super.connectedCallback(),this.root.rangeManager?.setConfig({shouldSyncSelection:_=>!!!_?.startContainer.parentElement?.closest("side-layout-modal")}),this.gesture=new Gesture(this),this.keyboardManager=new PageKeyboardManager(this),this.clipboard.init(this.page),this.handleEvent("cut",_=>{const{event:y}=_.get("defaultState"),w=y.target instanceof HTMLElement?y.target:y.target instanceof Node?y.target.parentElement:null;if(w&&w.closest("[data-block-is-title]"))return!0}),this.bindHotKey({ArrowUp:()=>{const _=this.root.viewStore,y=this.root.selectionManager,w=y.value.find(H=>H.is("text")||H.is("block"));if(!w)return;const $=_.findPrev(w.path,(H,j,q)=>{if(H.type==="block"&&q.view===this)return!0});if(!$)return;const B=this.childBlockElements.filter(H=>H.model.flavour==="affine:note"),R=B.indexOf($.view);if(R!==0){const H=B[R-1],j=w.is("text")?H.childBlockElements.reverse().find(q=>!!q.model.text):H.childBlockElements.at(-1);return j?(y.update(q=>q.filter(X=>!X.is("text")&&!X.is("block")).concat([w.is("text")?y.getInstance("text",{from:{path:j.path,index:j.model.text?.length??0,length:0},to:null}):y.getInstance("block",{path:j.path})])),!0):void 0}return y.update(H=>H.filter(j=>!j.is("text")&&!j.is("block")).concat([y.getInstance("text",{from:{path:this.path,index:this.model.title.length,length:0},to:null})])),!0},ArrowDown:()=>{const _=this.root.viewStore,y=this.root.selectionManager,w=y.value.find(H=>H.is("text")||H.is("block"));if(!w)return;const $=_.findPrev(w.path,(H,j,q)=>{if(H.type==="block"&&q.view===this)return!0});if(!$)return;const B=this.childBlockElements.filter(H=>H.model.flavour==="affine:note"),R=B.indexOf($.view);if(R<B.length-1){const H=B[R+1],j=w.is("text")?H.childBlockElements.find(q=>!!q.model.text):H.childBlockElements.at(0);return j?(y.update(q=>q.filter(X=>!X.is("text")&&!X.is("block")).concat([w.is("text")?y.getInstance("text",{from:{path:j.path,index:0,length:0},to:null}):y.getInstance("block",{path:j.path})])),!0):void 0}}}),this.handleEvent("click",_=>{const y=_.get("pointerState");if(y.raw.target!==this&&y.raw.target!==this.viewportElement&&y.raw.target!==this.pageBlockContainer)return;let w,$,B=0;const R=this.model.children.slice().reverse().find(H=>H.flavour==="affine:note"&&!H.hidden);if(!R)w=this.page.addBlock("affine:note",{},this.model.id),$=this.page.addBlock("affine:paragraph",{},w);else{w=R.id;const H=R.children.at(-1);!H||!H.text?$=this.page.addBlock("affine:paragraph",{},w):($=H.id,B=H.text.length??0)}requestAnimationFrame(()=>{this.root.selectionManager.setGroup("note",[this.root.selectionManager.getInstance("text",{from:{path:[this.model.id,w,$],index:B,length:0},to:null})])})})}disconnectedCallback(){super.disconnectedCallback(),this.clipboard.dispose(),this._disposables.dispose(),this.gesture=null,this.keyboardManager=null}render(){const _=(!this.model.title||!this.model.title.length)&&!this._isComposing,y=x$1`
      <div
        data-block-is-title="true"
        class="affine-doc-page-block-title ${_?"affine-doc-page-block-title-empty":""}"
      ></div>
    `,w=x$1`${c$1(this.model.children.filter(R=>!(matchFlavours(R,["affine:note"])&&R.hidden)),R=>R.id,R=>this.renderModel(R))}`,$=x$1`${c$1(Object.entries(this.widgets),([R])=>R,([R,H])=>H)}`,B=x$1`
      <affine-page-meta-data
        .pageElement="${this}"
        .page="${this.page}"
      ></affine-page-meta-data>
    `;return x$1`
      <div class="affine-doc-viewport">
        <div class="affine-doc-page-block-container">
          <div class="affine-doc-page-block-title-container">
            ${y} ${B}
          </div>
          ${w} ${$}
        </div>
      </div>
    `}};DocPageBlockComponent.styles=i$5`
    .affine-doc-viewport {
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
      height: 100%;
    }

    .affine-doc-page-block-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      font-family: var(--affine-font-family);
      font-size: var(--affine-font-base);
      line-height: var(--affine-line-height);
      color: var(--affine-text-primary-color);
      font-weight: 400;
      max-width: var(--affine-editor-width);
      margin: 0 auto;
      /* cursor: crosshair; */
      cursor: default;
      padding-bottom: ${PAGE_BLOCK_PADDING_BOTTOM}px;

      /* Leave a place for drag-handle */
      /* Do not use prettier format this style, or it will be broken */
      /* prettier-ignore */
      padding-left: var(--affine-editor-side-padding, ${PAGE_BLOCK_CHILD_PADDING}px);
      /* prettier-ignore */
      padding-right: var(--affine-editor-side-padding, ${PAGE_BLOCK_CHILD_PADDING}px);
    }

    .affine-doc-page-block-title {
      width: 100%;
      font-size: 40px;
      line-height: 50px;
      font-weight: 700;
      outline: none;
      resize: none;
      border: 0;
      font-family: inherit;
      color: inherit;
      cursor: text;
      padding: 38px 0;
    }

    .affine-doc-page-block-title-empty::before {
      content: 'Title';
      color: var(--affine-placeholder-color);
      position: absolute;
      opacity: 0.5;
    }

    .affine-doc-page-block-title:disabled {
      background-color: transparent;
    }

    /*
    .affine-doc-page-block-title-container {
    }
    */

    .affine-block-element {
      display: block;
    }

    @media print {
      .selected {
        background-color: transparent !important;
      }
    }
  `;__decorate$2r([t$2()],DocPageBlockComponent.prototype,"_isComposing",void 0);__decorate$2r([i$6(".affine-doc-viewport")],DocPageBlockComponent.prototype,"viewportElement",void 0);__decorate$2r([i$6(".affine-doc-page-block-container")],DocPageBlockComponent.prototype,"pageBlockContainer",void 0);__decorate$2r([i$6(".affine-doc-page-block-title")],DocPageBlockComponent.prototype,"_titleContainer",void 0);DocPageBlockComponent=__decorate$2r([e$7("affine-doc-page")],DocPageBlockComponent);function getTextDelta(k){return k.text?k.text.toDelta():[]}async function copyBlock(k){const _="blocksuite/x-c+w",y=getTextDelta(k),w={data:[{type:k.type,flavour:k.flavour,sourceId:k.sourceId,text:y,children:[]}]};return performNativeCopy([{mimeType:_,data:JSON.stringify(w)},{mimeType:"text/plain",data:k.text?.toString()||""}])}function performNativeCopy(k){let _=!1;const y=document.createElement("textarea");y.value="temp",document.body.appendChild(y),y.select(),y.setSelectionRange(0,y.value.length);const w=$=>{const B=$.clipboardData;B&&k.forEach(R=>B.setData(R.mimeType,R.data)),$.preventDefault(),$.stopPropagation(),y.removeEventListener("copy",w)};y.addEventListener("copy",w);try{_=document.execCommand("copy")}finally{y.removeEventListener("copy",w),document.body.removeChild(y)}return _}async function copyCode(k){await copyBlocks([k]),toast("Copied to clipboard")}function getAllowSelectedBlocks(k){const _=[],y=k.children.slice(),w=$=>{for(const B of $)B.flavour!=="affine:note"&&_.push(B),B.children.length&&w(B.children)};return w(y),_}const tooltipStyle=i$5`
  tool-tip {
    font-family: var(--affine-font-family);
    position: absolute;
    inline-size: max-content;
    text-align: center;
    font-size: var(--affine-font-sm);
    padding: 4px 12px;
    color: var(--affine-white);
    background: var(--affine-tooltip);
    opacity: 0;
    transition: opacity 0.2s ease, transform 0.2s ease;
    pointer-events: none;
    user-select: none;

    /* Default is top-start */
    left: 0;
    top: 0;
    border-radius: 4px;
    transform: translate(0, calc(-100% - 8px));
  }
  tool-tip:is([tip-position='top']) {
    left: 50%;
    border-radius: 4px;
    transform: translate(-50%, calc(-100% - 8px));
  }
  tool-tip:is([tip-position='right']) {
    left: unset;
    right: 0;
    transform: translateX(calc(100% + 8px));
    border-radius: 0 4px 4px 4px;
  }
  tool-tip:is([tip-position='left']) {
    left: 0;
    top: 50%;
    transform: translate(calc(-100% - 8px), -50%);
    border-radius: 4px;
  }
  tool-tip:is([tip-position='bottom']) {
    top: unset;
    left: 50%;
    bottom: 0;
    transform: translate(-50%, calc(100% + 8px));
    border-radius: 4px;
  }

  /* work for tip-position='top' */
  tool-tip:is([arrow]):is([tip-position='top']) {
    transform: translate(-50%, calc(-100% - 16px));
  }
  tool-tip:is([arrow]):is([tip-position='top'])::before {
    position: absolute;
    content: '';
    left: 50%;
    bottom: 0;
    transform: translate(-50%, 100%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid var(--affine-tooltip);
    margin-top: -4px;
  }

  /* work for tip-position='right' */
  tool-tip:is([arrow]):is([tip-position='right']) {
    transform: translateX(calc(100% + 16px));
  }
  tool-tip:is([arrow]):is([tip-position='right'])::before {
    position: absolute;
    content: '';
    left: 0;
    bottom: 50%;
    transform: translate(-100%, 50%);
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-right: 6px solid var(--affine-tooltip);
  }

  /* work for tip-position='left' */
  tool-tip:is([arrow]):is([tip-position='left']) {
    transform: translate(calc(-100% - 16px), -50%);
  }
  tool-tip:is([arrow]):is([tip-position='left'])::before {
    content: '';
    position: absolute;
    right: -5px;
    bottom: 50%;
    transform: translateY(50%);
    width: 0;
    height: 0;
    border-top: 5px solid transparent;
    border-bottom: 5px solid transparent;
    border-left: 6px solid var(--affine-tooltip);
  }

  /* work for tip-position='bottom' */
  tool-tip:is([arrow]):is([tip-position='bottom']) {
    transform: translate(-50%, calc(100% + 16px));
  }
  tool-tip:is([arrow]):is([tip-position='bottom'])::before {
    content: '';
    position: absolute;
    left: 50%;
    bottom: 100%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 6px solid var(--affine-tooltip);
  }

  /* work for tip-position='top-end' */
  tool-tip:is([arrow]):is([tip-position='top-end']) {
    transform: translate(-15%, calc(-100% - 16px));
  }
  tool-tip:is([arrow]):is([tip-position='top-end'])::before {
    position: absolute;
    content: '';
    left: 30%;
    bottom: 0;
    transform: translate(-50%, 100%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid var(--affine-tooltip);
  }
  /* work for tip-position='top-start' */
  tool-tip:is([arrow]):is([tip-position='top-start']) {
    transform: translate(-75%, calc(-100% - 16px));
  }
  tool-tip:is([arrow]):is([tip-position='top-start'])::before {
    position: absolute;
    content: '';
    right: 5%;
    bottom: 0;
    transform: translate(-50%, 100%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 6px solid var(--affine-tooltip);
    margin-top: 10px;
  }
  .has-tool-tip {
    position: relative;
  }
  .has-tool-tip:is(:hover, :focus-visible, :active) > tool-tip {
    opacity: 1;
    transition-delay: 200ms;
  }
`;var __decorate$2q=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessToolIconButton=class extends s$2{constructor(){super(),this.disabled=!1,this.coming=!1,this.tipPosition="top",this.arrow=!0,this.active=!1,this.activeMode="color",this.iconContainerPadding=6,this.addEventListener("click",_=>{this.disabled&&(_.stopPropagation(),_.preventDefault())},{capture:!0})}render(){const _=this.coming?"(Coming soon)":this.tooltip,y=`icon-container has-tool-tip active-mode-${this.activeMode}`,w=o$4({"--icon-container-padding":`${this.iconContainerPadding}px`});return x$1`
      <div
        class=${y}
        style=${w}
        role="button"
        ?disabled=${this.disabled}
        ?active=${this.active}
      >
        <slot></slot>
        ${_?x$1`<tool-tip
              inert
              role="tooltip"
              tip-position=${this.tipPosition}
              ?arrow=${this.arrow}
              >${_}</tool-tip
            >`:A}
      </div>
    `}};EdgelessToolIconButton.styles=i$5`
    .icon-container {
      position: relative;
      display: flex;
      align-items: center;
      padding: var(--icon-container-padding);
      color: var(--affine-icon-color);
      border-radius: 4px;
      cursor: pointer;
    }

    .icon-container:hover {
      background: var(--affine-hover-color);
    }

    .icon-container.active-mode-color[active] {
      color: var(--affine-primary-color);
    }

    .icon-container.active-mode-background[active] {
      background: var(--affine-hover-color);
    }

    .icon-container[disabled] {
      pointer-events: none;
      cursor: not-allowed;
    }

    .icon-container[coming] {
      cursor: not-allowed;
      color: var(--affine-text-disable-color);
    }

    ${tooltipStyle}

    tool-tip {
      z-index: 12;
    }

    tool-tip:is([arrow]):is([tip-position='top'])::before {
      margin-top: -4px;
    }
  `;__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"disabled",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"coming",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"tooltip",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"tipPosition",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"arrow",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"active",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"activeMode",void 0);__decorate$2q([n$a({attribute:!1})],EdgelessToolIconButton.prototype,"iconContainerPadding",void 0);EdgelessToolIconButton=__decorate$2q([e$7("edgeless-tool-icon-button")],EdgelessToolIconButton);var __decorate$2p=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class ColorEvent extends Event{constructor(_,{detail:y,composed:w,bubbles:$}){super(_,{bubbles:$,composed:w}),this.detail=y}}const LINE_COLORS=["--affine-palette-line-yellow","--affine-palette-line-orange","--affine-palette-line-tangerine","--affine-palette-line-red","--affine-palette-line-magenta","--affine-palette-line-purple","--affine-palette-line-green","--affine-palette-line-blue","--affine-palette-line-navy","--affine-palette-line-black","--affine-palette-line-grey","--affine-palette-line-white"],GET_DEFAULT_LINE_COLOR=()=>queryCurrentMode()==="dark"?LINE_COLORS[11]:LINE_COLORS[9],DEFAULT_BRUSH_COLOR="--affine-palette-line-blue";function isTransparent(k){return k.toLowerCase()==="--affine-palette-transparent"}function isSameColorWithBackground(k){return["--affine-palette-line-white","--affine-palette-shape-white"].includes(k.toLowerCase())}function TransparentColor(k=!1){const _={position:"relative",width:"16px",height:"16px",stroke:"none"},w=k?x$1`<div style=${o$4({position:"absolute",width:"10px",height:"10px",left:"3px",top:"3.5px",borderRadius:"50%",background:"var(--affine-popover-background)"})}></div>`:A;return x$1`<div style=${o$4(_)}>
    ${TransparentIcon} ${w}
  </div>`}function BorderedHollowCircle(k){const _=isSameColorWithBackground(k)?1:0,y={fill:`var(${k})`,stroke:"var(--affine-border-color)"};return x$1`<svg
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M12.3125 8C12.3125 10.3817 10.3817 12.3125 8 12.3125C5.61827 12.3125 3.6875 10.3817 3.6875 8C3.6875 5.61827 5.61827 3.6875 8 3.6875C10.3817 3.6875 12.3125 5.61827 12.3125 8ZM8 15.5C12.1421 15.5 15.5 12.1421 15.5 8C15.5 3.85786 12.1421 0.5 8 0.5C3.85786 0.5 0.5 3.85786 0.5 8C0.5 12.1421 3.85786 15.5 8 15.5Z"
      stroke-width="${_}"
      style=${o$4(y)}
    />
  </svg> `}function AdditionIcon(k,_){return isTransparent(k)?TransparentColor(_):_?BorderedHollowCircle(k):A}function ColorUnit(k,{hollowCircle:_,letter:y}={}){const w=AdditionIcon(k,!!_),$=_?{}:{background:`var(${k})`},R={display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",borderRadius:"50%",boxSizing:"border-box",overflow:"hidden",...isSameColorWithBackground(k)&&!_?{border:"1px solid var(--affine-border-color)"}:{},...$};return x$1`<div
    class="color-unit"
    style=${o$4(R)}
    aria-label=${k.toLowerCase()}
    data-letter=${y?"A":""}
  >
    ${w}
  </div>`}const colorContainerStyles=i$5`
  .color-container {
    display: flex;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    box-sizing: border-box;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    cursor: pointer;
  }

  .color-container[active] {
    border: 1px solid var(--affine-primary-color);
  }

  .color-unit::before {
    content: attr(data-letter);
    display: block;
    font-size: 12px;
  }
`;let EdgelessColorPanel=class extends s$2{constructor(){super(...arguments),this.value=null,this.options=LINE_COLORS,this.showLetterMark=!1,this.hollowCircle=!1}onSelect(_){this.dispatchEvent(new ColorEvent("select",{detail:_,composed:!0,bubbles:!0})),this.value=_}render(){return c$1(this.options,_=>_,_=>{const y=ColorUnit(_,{hollowCircle:this.hollowCircle,letter:this.showLetterMark});return x$1`
          <div
            class="color-container"
            ?active=${_===this.value}
            @click=${()=>this.onSelect(_)}
          >
            ${y}
          </div>
        `})}};EdgelessColorPanel.styles=i$5`
    :host {
      display: flex;
      width: 200px;
      padding: 10px;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 12px;
      box-sizing: border-box;
      background: var(--affine-popover-background);
    }

    ${colorContainerStyles}
  `;__decorate$2p([n$a({attribute:!1})],EdgelessColorPanel.prototype,"value",void 0);__decorate$2p([n$a({attribute:!1})],EdgelessColorPanel.prototype,"options",void 0);__decorate$2p([n$a({attribute:!1})],EdgelessColorPanel.prototype,"showLetterMark",void 0);__decorate$2p([n$a({attribute:!1})],EdgelessColorPanel.prototype,"hollowCircle",void 0);EdgelessColorPanel=__decorate$2p([e$7("edgeless-color-panel")],EdgelessColorPanel);var __decorate$2o=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessShapeStylePanel=class extends s$2{_onSelect(_){this.value=_,this.onSelect&&this.onSelect(_)}render(){return x$1`
      <div class="shape-style-container">
        <edgeless-tool-icon-button
          class="general-shape-button"
          .tooltip=${"General"}
          .tipPosition=${"top"}
          .active=${this.value===ShapeStyle.General}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect(ShapeStyle.General)}}
        >
          ${GeneralShapeStyleIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          class="scribbled-shape-button"
          .tooltip=${"Scribbled"}
          .tipPosition=${"top"}
          .active=${this.value===ShapeStyle.Scribbled}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect(ShapeStyle.Scribbled)}}
        >
          ${ScribbledShapeStyleIcon}
        </edgeless-tool-icon-button>
      </div>
    `}};EdgelessShapeStylePanel.styles=i$5`
    .shape-style-container {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--affine-background-overlay-panel-color);
      z-index: 2;
      gap: 8px;
      padding: 0;
    }

    edgeless-tool-icon-button svg {
      fill: var(--affine-icon-color);
    }
  `;__decorate$2o([n$a({attribute:!1})],EdgelessShapeStylePanel.prototype,"value",void 0);__decorate$2o([n$a({attribute:!1})],EdgelessShapeStylePanel.prototype,"onSelect",void 0);EdgelessShapeStylePanel=__decorate$2o([e$7("edgeless-shape-style-panel")],EdgelessShapeStylePanel);const ShapeComponentConfig=[{name:"rect",generalIcon:SquareIcon,scribbledIcon:ScribbledSquareIcon,tooltip:"Square",disabled:!1},{name:"ellipse",generalIcon:EllipseIcon,scribbledIcon:ScribbledEllipseIcon,tooltip:"Ellipse",disabled:!1},{name:"diamond",generalIcon:DiamondIcon,scribbledIcon:ScribbledDiamondIcon,tooltip:"Diamond",disabled:!1},{name:"triangle",generalIcon:TriangleIcon,scribbledIcon:ScribbledTriangleIcon,tooltip:"Triangle",disabled:!1},{name:"roundedRect",generalIcon:RoundedRectangleIcon,scribbledIcon:ScribbledRoundedRectangleIcon,tooltip:"Rounded rectangle",disabled:!1}];ShapeComponentConfig.reduce((k,_)=>(k[_.name]=_,k),{});const SHAPE_SUBMENU_WIDTH=464,SHAPE_COLOR_PREFIX="--affine-palette-shape-",LINE_COLOR_PREFIX="--affine-palette-line-";var __decorate$2n=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessShapePanel=class extends s$2{constructor(){super(...arguments),this.shapeStyle=ShapeStyle.Scribbled,this.slots={select:new Slot}}_onSelect(_){this.selectedShape=_,this.slots.select.emit(_)}disconnectedCallback(){this.slots.select.dispose(),super.disconnectedCallback()}render(){return x$1`
      <div class="shape-panel-container">
        ${ShapeComponentConfig.map(({name:_,generalIcon:y,scribbledIcon:w,tooltip:$,disabled:B})=>x$1`
              <edgeless-tool-icon-button
                .disabled=${B}
                .tooltip=${$}
                .active=${this.selectedShape===_}
                .activeMode=${"background"}
                .iconContainerPadding=${2}
                @click=${()=>{B||this._onSelect(_)}}
              >
                ${this.shapeStyle===ShapeStyle.General?y:w}
              </edgeless-tool-icon-button>
            `)}
      </div>
    `}};EdgelessShapePanel.styles=i$5`
    .shape-panel-container {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 40px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
      padding: 0 8px;
      gap: 8px;
      z-index: 2;
    }

    .shape-panel-container svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }
  `;__decorate$2n([n$a({attribute:!1})],EdgelessShapePanel.prototype,"selectedShape",void 0);__decorate$2n([n$a({attribute:!1})],EdgelessShapePanel.prototype,"shapeStyle",void 0);EdgelessShapePanel=__decorate$2n([e$7("edgeless-shape-panel")],EdgelessShapePanel);const NOTE_MIN_WIDTH=200,NOTE_MIN_HEIGHT=20,DEFAULT_NOTE_WIDTH=448,DEFAULT_NOTE_HEIGHT=72,DEFAULT_NOTE_OFFSET_X=30,DEFAULT_NOTE_OFFSET_Y=40,NOTE_OVERLAY_OFFSET_X=6,NOTE_OVERLAY_OFFSET_Y=6,NOTE_OVERLAY_WIDTH=100,NOTE_OVERLAY_HEIGHT=50,NOTE_OVERLAY_CORNER_RADIUS=6,NOTE_OVERLAY_STOKE_COLOR="--affine-border-color",NOTE_OVERLAY_TEXT_COLOR="--affine-icon-color",NOTE_OVERLAY_LIGHT_BACKGROUND_COLOR="rgba(252, 252, 253, 1)",NOTE_OVERLAY_DARK_BACKGROUND_COLOR="rgb(32, 32, 32)",SHAPE_OVERLAY_WIDTH=100,SHAPE_OVERLAY_HEIGHT=100,SHAPE_OVERLAY_OFFSET_X=6,SHAPE_OVERLAY_OFFSET_Y=6,SHAPE_OVERLAY_OPTIONS={seed:666,roughness:DEFAULT_ROUGHNESS,strokeLineDash:[0,0],stroke:"black",strokeWidth:4,fill:"transparent"},DEFAULT_NOTE_CHILD_FLAVOUR="affine:paragraph",DEFAULT_NOTE_CHILD_TYPE="text",DEFAULT_NOTE_TIP="Text",FIT_TO_SCREEN_PADDING=100,EXCLUDING_MOUSE_OUT_CLASS_LIST=["affine-note-mask","affine-edgeless-child-note","affine-block-children-container"],SCRIBBLED_CANVAS_FONT_FAMILY="'Kalam', cursive",GENERAL_CANVAS_FONT_FAMILY="sans-serif",SurfaceColor="#6046FE",NoteColor="#1E96EB",BlendColor="#7D91FF",SHAPE_TEXT_COLOR_PURE_WHITE="white",SHAPE_TEXT_COLOR_PURE_BLACK="black",SHAPE_FILL_COLOR_BLACK="--affine-palette-shape-black";var __decorate$2m=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessFontFamilyPanel=class extends s$2{constructor(){super(...arguments),this.value=GENERAL_CANVAS_FONT_FAMILY}_onSelect(_){this.value=_,this.onSelect&&this.onSelect(_)}render(){return x$1`
      <div class="font-family-container">
        <edgeless-tool-icon-button
          class="general-button"
          .active=${this.value===GENERAL_CANVAS_FONT_FAMILY}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect(GENERAL_CANVAS_FONT_FAMILY)}}
        >
          <div class="font-family-button">General</div>
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          class="scibbled-button"
          .active=${this.value===SCRIBBLED_CANVAS_FONT_FAMILY}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect(SCRIBBLED_CANVAS_FONT_FAMILY)}}
        >
          <div class="font-family-button">Scribbled</div>
        </edgeless-tool-icon-button>
      </div>
    `}};EdgelessFontFamilyPanel.styles=i$5`
    :host {
      display: flex;
    }

    .font-family-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--affine-background-overlay-panel-color);
      gap: 8px;
      padding: 8px;
    }

    .general-button {
      font-family: sans-serif;
    }

    .scibbled-button {
      font-family: Kalam, cursive;
    }
  `;__decorate$2m([n$a({attribute:!1})],EdgelessFontFamilyPanel.prototype,"value",void 0);__decorate$2m([n$a({attribute:!1})],EdgelessFontFamilyPanel.prototype,"onSelect",void 0);EdgelessFontFamilyPanel=__decorate$2m([e$7("edgeless-font-family-panel")],EdgelessFontFamilyPanel);var TEXT_FONT_SIZE;(function(k){k[k.SMALL=12]="SMALL",k[k.MEDIUM=20]="MEDIUM",k[k.LARGE=28]="LARGE",k[k.XLARGE=36]="XLARGE"})(TEXT_FONT_SIZE||(TEXT_FONT_SIZE={}));var __decorate$2l=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const MIN_FONT_SIZE=1,MAX_FONT_SIZE=200;let EdgelessFontSizePanel=class extends s$2{constructor(){super(...arguments),this.minFontSize=MIN_FONT_SIZE,this.maxFontSize=MAX_FONT_SIZE,this._onInputKeyPress=_=>{if(_.key==="Enter"){const y=_.target;if(isNaN(parseInt(y.value))){y.value="";return}let w=parseInt(y.value);w<this.minFontSize?w=this.minFontSize:w>this.maxFontSize&&(w=this.maxFontSize),this._onSelect(w),y.value="",this._onPopperClose()}}}_onSelect(_){this.onSelect&&this.onSelect(_)}_onPopperClose(){this.onPopperCose&&this.onPopperCose()}render(){return x$1`
      <div class="font-size-container">
        <div class="font-size-content">
          <div
            class="font-size-button"
            role="button"
            ?active=${this.fontSize===TEXT_FONT_SIZE.SMALL}
            @click=${()=>{this._onSelect(TEXT_FONT_SIZE.SMALL)}}
          >
            <div class="font-size-button-label">Small</div>
          </div>
          <div
            class="font-size-button"
            role="button"
            ?active=${this.fontSize===TEXT_FONT_SIZE.MEDIUM}
            @click=${()=>{this._onSelect(TEXT_FONT_SIZE.MEDIUM)}}
          >
            <div class="font-size-button-label">Middle</div>
          </div>
          <div
            class="font-size-button"
            role="button"
            ?active=${this.fontSize===TEXT_FONT_SIZE.LARGE}
            @click=${()=>{this._onSelect(TEXT_FONT_SIZE.LARGE)}}
          >
            <div class="font-size-button-label">Large</div>
          </div>
          <div
            class="font-size-button"
            role="button"
            ?active=${this.fontSize===TEXT_FONT_SIZE.XLARGE}
            @click=${()=>{this._onSelect(TEXT_FONT_SIZE.XLARGE)}}
          >
            <div class="font-size-button-label">Huge</div>
          </div>

          <div
            class="font-size-input-container"
            @click=${_=>{_.preventDefault(),_.stopPropagation()}}
          >
            <input
              class="font-size-input"
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              placeholder=${Math.trunc(this.fontSize)}
              @keypress=${this._onInputKeyPress}
            />
          </div>
        </div>
      </div>
    `}};EdgelessFontSizePanel.styles=i$5`
    .font-size-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px 8px;
      background: var(--affine-background-overlay-panel-color);
      border-radius: 8px;
    }

    .font-size-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 64px;
    }

    .font-size-button {
      display: flex;
      align-items: center;
      justify-content: start;
      width: 64px;
      height: 32px;
      padding: 0 8px;
    }

    .font-size-button[active] .font-size-button-label {
      background: var(--affine-hover-color);
    }

    .font-size-button-label {
      text-align: justify;
      font-size: 15px;
      font-style: normal;
      width: 48px;
      height: 24px;
      font-weight: 400;
      line-height: 24px;
      color: var(--affine-icon-color);
      padding: 0 8px;
      border-radius: 4px;
    }

    .font-size-button-label:hover {
      cursor: pointer;
      background: var(--affine-hover-color);
    }

    .font-size-input-container {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .font-size-input {
      width: 48px;
      height: 18px;
      border: 1px solid var(--affine-border-color);
      border-radius: 8px;
      padding: 4px 8px;
    }

    .font-size-input::placeholder {
      color: var(--affine-placeholder-color);
    }

    .font-size-input:focus {
      outline-color: var(--affine-primary-color);
    }

    menu-divider {
      width: 100%;
    }
  `;__decorate$2l([n$a({attribute:!1})],EdgelessFontSizePanel.prototype,"fontSize",void 0);__decorate$2l([n$a({attribute:!1})],EdgelessFontSizePanel.prototype,"onSelect",void 0);__decorate$2l([n$a({attribute:!1})],EdgelessFontSizePanel.prototype,"onPopperCose",void 0);__decorate$2l([n$a({attribute:!1})],EdgelessFontSizePanel.prototype,"minFontSize",void 0);__decorate$2l([n$a({attribute:!1})],EdgelessFontSizePanel.prototype,"maxFontSize",void 0);EdgelessFontSizePanel=__decorate$2l([e$7("edgeless-font-size-panel")],EdgelessFontSizePanel);function generateCursorUrl(k=0,_=i$5`default`){return i$5`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Cg transform='rotate(${k} 16 16)'%3E%3Cpath fill='white' d='M13.7,18.5h3.9l0-1.5c0-1.4-1.2-2.6-2.6-2.6h-1.5v3.9l-5.8-5.8l5.8-5.8v3.9h2.3c3.1,0,5.6,2.5,5.6,5.6v2.3h3.9l-5.8,5.8L13.7,18.5z'/%3E%3Cpath d='M20.4,19.4v-3.2c0-2.6-2.1-4.7-4.7-4.7h-3.2l0,0V9L9,12.6l3.6,3.6v-2.6l0,0H15c1.9,0,3.5,1.6,3.5,3.5v2.4l0,0h-2.6l3.6,3.6l3.6-3.6L20.4,19.4L20.4,19.4z'/%3E%3C/g%3E%3C/svg%3E") 16 16, ${_}`}function listenClickAway(k,_){const y=w=>{w.composedPath().includes(k)||_()};return document.addEventListener("click",y),{dispose:()=>{document.removeEventListener("click",y)}}}const ATTR_SHOW="data-show";function createButtonPopper(k,_,y=()=>{}){function w(){computePosition(k,_,{placement:"top",middleware:[offset$1({mainAxis:14}),flip({fallbackPlacements:["bottom"]})]}).then(({x:j,y:q})=>{Object.assign(_.style,{position:"absolute",zIndex:1,left:`${j}px`,top:`${q}px`})})}const $=()=>{_.setAttribute(ATTR_SHOW,""),w(),y({display:"show"})},B=()=>{_.removeAttribute(ATTR_SHOW),w(),y({display:"hidden"})},R=()=>{_.hasAttribute(ATTR_SHOW)?B():$()},H=listenClickAway(k,()=>B());return{show:$,hide:B,toggle:R,dispose:()=>{H.dispose()}}}function getTooltipWithShortcut(k,_){return x$1`<span>${k}</span
    ><span style="margin-left: 10px;">(${_})</span>`}function readImageSize(k){return new Promise(_=>{const y=new FileReader,w={width:0,height:0};y.addEventListener("load",$=>{const B=new Image;B.onload=()=>{w.width=B.width,w.height=B.height,_(w)},B.onerror=()=>_(w),B.src=y.result}),y.addEventListener("error",()=>_(w)),y.readAsDataURL(k)})}const RESIZE_CURSORS=["ew","nwse","ns","nesw"];function rotateResizeCursor(k){const _=Math.round(k/(Math.PI/4));return RESIZE_CURSORS[_%RESIZE_CURSORS.length]}function calcAngle(k,_,y=0){const w=k.closest(".affine-edgeless-selected-rect")?.getBoundingClientRect();assertExists(w);const{left:$,top:B,right:R,bottom:H}=w,j=Vec.med([$,B],[R,H]);return normalizeDegAngle((Vec.angle(j,_)+y)*180/Math.PI)}function calcAngleWithRotation(k,_,y,w){const $=k.parentElement;assertExists($);const B=$.getAttribute("aria-label");assertExists(B);const{left:R,top:H,right:j,bottom:q,width:X,height:ee}=y,te=Math.min(X,ee),ne=te/X,oe=te/ee,ie=Vec.med([R,H],[j,q]),ae=[0,0];switch(B){case"top-left":{ae[0]=R,ae[1]=H;break}case"top-right":{ae[0]=j,ae[1]=H;break}case"bottom-right":{ae[0]=j,ae[1]=q;break}case"bottom-left":{ae[0]=R,ae[1]=q;break}}const re=new DOMMatrix().translateSelf(ie[0],ie[1]).rotateSelf(w).translateSelf(-ie[0],-ie[1]).transformPoint(new DOMPoint(...ae)),se=new DOMMatrix().translateSelf(re.x,re.y).rotateSelf(w).translateSelf(-re.x,-re.y).scaleSelf(ne,oe,1,re.x,re.y,0).translateSelf(re.x,re.y).rotateSelf(-w).translateSelf(-re.x,-re.y),le=new DOMPoint(...ie).matrixTransform(se);return normalizeDegAngle(Vec.angle([le.x,le.y],_)*180/Math.PI)}function calcAngleEdgeWithRotation(k,_){let y=0;const w=k.parentElement;assertExists(w);const $=w.getAttribute("aria-label");switch(assertExists($),$){case"top":{y=270;break}case"bottom":{y=90;break}case"left":{y=180;break}case"right":{y=0;break}}return y+_}function getResizeLabel(k){const _=k.parentElement;assertExists(_);const y=_.getAttribute("aria-label");return assertExists(y),y}function updateNotesPosition(k,_){for(const y of _){const w=k.querySelector(`[data-note-id="${y.id}"]`);if(w instanceof HTMLElement){const $=getBlockElementById(y.id);assertExists($),computePosition($,w,{placement:"top-start",middleware:[flip(),offset$1({mainAxis:(8+24)*k.surface.viewport.zoom,crossAxis:(4-24)*k.surface.viewport.zoom})]}).then(({x:B,y:R})=>{w.style.top=R+"px",w.style.left=B+"px"})}}}var __decorate$2k=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessChangeTextMenu=class extends WithDisposable(s$2){constructor(){super(...arguments),this._textColorPopperShow=!1,this._fontFamilyPopperShow=!1,this._fontSizePopperShow=!1,this._textAlignPopperShow=!1,this._colorSelectorPopper=null,this._textAlignPopper=null,this._textFontFamilyPopper=null,this._textFontSizePopper=null,this._getMostCommonFontFamily=_=>{const y=countBy(_,$=>$.fontFamily),w=maxBy(Object.entries(y),([$,B])=>B);return w?w[0]:GENERAL_CANVAS_FONT_FAMILY},this._getMostCommonFontSize=_=>{const y=countBy(_,$=>$.fontSize),w=maxBy(Object.entries(y),([$,B])=>B);return w?Number(w[0]):TEXT_FONT_SIZE.MEDIUM},this._getMostCommonColor=_=>{const y=countBy(_,$=>$.color),w=maxBy(Object.entries(y),([$,B])=>B);return w?w[0]:GET_DEFAULT_LINE_COLOR()},this._getMostCommonAlign=_=>{const y=countBy(_,$=>$.textAlign),w=maxBy(Object.entries(y),([$,B])=>B);return w?w[0]:"left"},this._areAllelementsBold=_=>_.every(y=>y.bold),this._areAllelementsItalic=_=>_.every(y=>y.italic),this._updateElementBound=_=>{if(this.elementType==="text"){const w=normalizeTextBound(_,new Bound(_.x,_.y,_.w,_.h));this.surface.updateElement(_.id,{xywh:w.serialize()})}else{const w=normalizeShapeBound(_,new Bound(_.x,_.y,_.w,_.h));this.surface.updateElement(_.id,{xywh:w.serialize()})}},this._setTextColor=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{color:_})})},this._setTextAlign=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{textAlign:_})})},this._setFontFamily=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{fontFamily:_}),this._updateElementBound(y)})},this._setFontSize=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{fontSize:_}),this._updateElementBound(y)})},this._setTextBold=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{bold:_}),this._updateElementBound(y)})},this._setTextItalic=_=>{this.elementType,this.elements.forEach(y=>{this.surface.updateElement(y.id,{italic:_}),this._updateElementBound(y)})},this._getFontSizeLabel=_=>{switch(_){case TEXT_FONT_SIZE.SMALL:return"Small";case TEXT_FONT_SIZE.MEDIUM:return"Middle";case TEXT_FONT_SIZE.LARGE:return"Large";case TEXT_FONT_SIZE.XLARGE:return"Huge";default:return Math.trunc(_)}}}firstUpdated(_){const y=this._disposables;this.elementType==="text"&&(this._colorSelectorPopper=createButtonPopper(this._textColorButton,this._textColorMenu,({display:w})=>{this._textColorPopperShow=w==="show"}),y.add(this._colorSelectorPopper),this._textFontFamilyPopper=createButtonPopper(this._textFontFamilyButton,this._textFontFamilyMenu,({display:w})=>{this._fontFamilyPopperShow=w==="show"}),y.add(this._textFontFamilyPopper)),this._textAlignPopper=createButtonPopper(this._textAlignButton,this._textAlignMenu,({display:w})=>{this._textAlignPopperShow=w==="show"}),y.add(this._textAlignPopper),this._textFontSizePopper=createButtonPopper(this._textFontSizeButton,this._textFontSizeMenu,({display:w})=>{this._fontSizePopperShow=w==="show"}),y.add(this._textFontSizePopper),super.firstUpdated(_)}render(){const _=this._getMostCommonColor(this.elements),y=this._getMostCommonAlign(this.elements),w=this._getMostCommonFontFamily(this.elements),$=this._getMostCommonFontSize(this.elements),B=this._areAllelementsBold(this.elements),R=this._areAllelementsItalic(this.elements);return x$1`
      ${this.elementType==="shape"?A:x$1`
            <edgeless-tool-icon-button
              class="text-color-button"
              .tooltip=${this._textColorPopperShow?"":"Text Color"}
              .tipPosition=${"bottom"}
              .active=${!1}
              .activeMode=${"background"}
              .iconContainerPadding=${2}
              @click=${()=>this._colorSelectorPopper?.toggle()}
            >
              <div class="text-color-unit-container">
                ${ColorUnit(_)}
              </div>
            </edgeless-tool-icon-button>
            <div class="color-panel-container text-color">
              <edgeless-color-panel
                .value=${_}
                .options=${LINE_COLORS}
                @select=${H=>{this._setTextColor(H.detail)}}
              ></edgeless-color-panel>
            </div>
            <component-toolbar-menu-divider></component-toolbar-menu-divider>
          `}

      <edgeless-tool-icon-button
        class="text-font-size-button"
        .tooltip=${this._fontFamilyPopperShow?"":"Font Size"}
        .tipPosition=${"bottom"}
        .active=${!1}
        .iconContainerPadding=${2}
        @click=${()=>this._textFontSizePopper?.toggle()}
      >
        <div class="font-size-button-group">
          <div class="selected-font-size-label">
            ${this._getFontSizeLabel($)}
          </div>
          <div class="arrow-down-icon">${ShapeArrowDownSmallIcon}</div>
        </div>
      </edgeless-tool-icon-button>
      <div class="font-size-panel-container text-font-size">
        <edgeless-font-size-panel
          .fontSize=${$}
          .onSelect=${H=>{this._setFontSize(H)}}
          .onPopperCose=${()=>this._textFontSizePopper?.hide()}
        ></edgeless-font-size-panel>
      </div>

      <component-toolbar-menu-divider></component-toolbar-menu-divider>

      <div class="font-style-container">
        ${this.elementType==="shape"?A:x$1`<edgeless-tool-icon-button
                class="text-font-family-button"
                .tooltip=${this._fontSizePopperShow?"":"Font"}
                .tipPosition=${"bottom"}
                .active=${!1}
                .iconContainerPadding=${2}
                @click=${()=>this._textFontFamilyPopper?.toggle()}
              >
                <div class="button-with-arrow-group">
                  ${FontFamilyIcon} ${SmallArrowDownIcon}
                </div>
              </edgeless-tool-icon-button>
              <div class="font-family-panel-container text-font-family">
                <edgeless-font-family-panel
                  .value=${w}
                  .onSelect=${H=>{this._setFontFamily(H)}}
                ></edgeless-font-family-panel>
              </div>`}

        <edgeless-tool-icon-button
          class="text-bold-button"
          .tooltip=${"Bold"}
          .tipPosition=${"bottom"}
          .active=${B}
          .iconContainerPadding=${2}
          .activeMode=${"background"}
          @click=${()=>this._setTextBold(!B)}
        >
          ${BoldIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          .tooltip=${"Italic"}
          .tipPosition=${"bottom"}
          .active=${R}
          .iconContainerPadding=${2}
          .activeMode=${"background"}
          @click=${()=>this._setTextItalic(!R)}
        >
          ${ItalicIcon}
        </edgeless-tool-icon-button>
      </div>

      <component-toolbar-menu-divider></component-toolbar-menu-divider>

      <edgeless-tool-icon-button
        class="text-align-button"
        .tooltip=${this._textAlignPopperShow?"":"Alignment"}
        .tipPosition=${"bottom"}
        .active=${!1}
        .iconContainerPadding=${2}
        @click=${()=>this._textAlignPopper?.toggle()}
      >
        <div class="button-with-arrow-group">
          ${y==="left"?TextAlignLeftIcon:y==="center"?TextAlignCenterIcon:TextAlignRightIcon}
          ${SmallArrowDownIcon}
        </div>
      </edgeless-tool-icon-button>
      <div class="align-panel-container text-align">
        <edgeless-align-panel
          .value=${y}
          .onSelect=${H=>{this._setTextAlign(H)}}
        ></edgeless-align-panel>
      </div>
    `}};EdgelessChangeTextMenu.styles=i$5`
    :host {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      color: var(--affine-text-primary-color);
      stroke: none;
      fill: currentColor;
    }

    .text-color-unit-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 20px;
      height: 20px;
    }

    .color-panel-container,
    .align-panel-container.text-align,
    .font-size-panel-container,
    .font-family-panel-container {
      display: none;
      justify-content: center;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
    }

    .color-panel-container[data-show],
    .align-panel-container[data-show],
    .font-size-panel-container[data-show],
    .font-family-panel-container[data-show] {
      display: block;
    }

    .button-with-arrow-group {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .font-size-button-group {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 72px;
      height: 24px;
    }

    .font-size-button-group .selected-font-size-label {
      width: 52px;
      height: 20px;
      line-height: 20px;
      font-size: 16px;
      font-family: 'Avenir Next';
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
    }

    .font-size-button-group .arrow-down-icon {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .selected-font-size {
      align-self: end;
    }

    .font-style-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .text-align-button svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }

    component-toolbar-menu-divider {
      margin: 0 12px;
    }
  `;__decorate$2k([n$a({attribute:!1})],EdgelessChangeTextMenu.prototype,"elements",void 0);__decorate$2k([n$a({attribute:!1})],EdgelessChangeTextMenu.prototype,"elementType",void 0);__decorate$2k([n$a({attribute:!1})],EdgelessChangeTextMenu.prototype,"surface",void 0);__decorate$2k([n$a({attribute:!1})],EdgelessChangeTextMenu.prototype,"slots",void 0);__decorate$2k([t$2()],EdgelessChangeTextMenu.prototype,"_textColorPopperShow",void 0);__decorate$2k([t$2()],EdgelessChangeTextMenu.prototype,"_fontFamilyPopperShow",void 0);__decorate$2k([t$2()],EdgelessChangeTextMenu.prototype,"_fontSizePopperShow",void 0);__decorate$2k([t$2()],EdgelessChangeTextMenu.prototype,"_textAlignPopperShow",void 0);__decorate$2k([i$6(".text-color-button")],EdgelessChangeTextMenu.prototype,"_textColorButton",void 0);__decorate$2k([i$6(".color-panel-container.text-color")],EdgelessChangeTextMenu.prototype,"_textColorMenu",void 0);__decorate$2k([i$6(".text-align-button")],EdgelessChangeTextMenu.prototype,"_textAlignButton",void 0);__decorate$2k([i$6(".align-panel-container.text-align")],EdgelessChangeTextMenu.prototype,"_textAlignMenu",void 0);__decorate$2k([i$6(".text-font-family-button")],EdgelessChangeTextMenu.prototype,"_textFontFamilyButton",void 0);__decorate$2k([i$6(".font-family-panel-container")],EdgelessChangeTextMenu.prototype,"_textFontFamilyMenu",void 0);__decorate$2k([i$6(".text-font-size-button")],EdgelessChangeTextMenu.prototype,"_textFontSizeButton",void 0);__decorate$2k([i$6(".font-size-panel-container")],EdgelessChangeTextMenu.prototype,"_textFontSizeMenu",void 0);EdgelessChangeTextMenu=__decorate$2k([e$7("edgeless-change-text-menu")],EdgelessChangeTextMenu);var __decorate$2j=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let ComponentToolbarMenuDivider=class extends s$2{constructor(){super(...arguments),this.vertical=!1}render(){return x$1` <div class="divider-container">
      <div class="divider"></div>
    </div>`}};ComponentToolbarMenuDivider.styles=i$5`
    .divider-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 4px;
      height: 24px;
    }

    .divider {
      width: 1px;
      height: 100%;
      background-color: var(--affine-border-color);
    }
  `;__decorate$2j([n$a({attribute:!1})],ComponentToolbarMenuDivider.prototype,"vertical",void 0);ComponentToolbarMenuDivider=__decorate$2j([e$7("component-toolbar-menu-divider")],ComponentToolbarMenuDivider);const lineSizeButtonStyles=[i$5`
    .edgeless-component-line-size-button {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 16px;
      height: 16px;
    }

    .edgeless-component-line-size-button div {
      border-radius: 50%;
      background-color: var(--affine-icon-color);
    }

    .edgeless-component-line-size-button.size-s div {
      width: 4px;
      height: 4px;
    }
    .edgeless-component-line-size-button.size-l div {
      width: 10px;
      height: 10px;
    }
  `],lineStyleButtonStyles=[i$5`
    .edgeless-component-line-style-button {
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--affine-icon-color);
    }

    .line-style-button:nth-of-type(2),
    .line-style-button:nth-of-type(3) {
      margin-left: 8px;
    }
  `];function getModeIcon(k){switch(k){case"solid":return StraightLineIcon;case"dash":return DashLineIcon;case"none":return BanIcon}}function getModeTooltip(k){return{solid:"Solid",dash:"Dash",none:"None"}[k]}function LineStyleButton({className:k,mode:_,active:y,tooltip:w,onClick:$}){const B=`edgeless-component-line-style-button mode-${_} ${y?"active":""}`,R=getModeIcon(_),H=w!==void 0?w:getModeTooltip(_);return x$1`<edgeless-tool-icon-button
    class=${k??""}
    .active=${y??!1}
    .activeMode=${"background"}
    .tooltip=${H}
    .iconContainerPadding=${2}
    @click=${$}
  >
    <div class=${B}>${R}</div>
  </edgeless-tool-icon-button>`}const panelWrapperStyle=[i$5`
    .edgeless-component-panel-wrapper {
      display: flex;
      padding: 4px;
      justify-content: center;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
    }
  `];function PanelWrapper({children:k,className:_}){const y=`edgeless-component-panel-wrapper ${_||""}`;return x$1`<div class=${y}>${k}</div>`}const lineStylesPanelStyles=[panelWrapperStyle,lineStyleButtonStyles];function LineStylesPanel({onClick:k,selectedLineSize:_,selectedLineStyle:y,lineStyle:w=["solid","dash","none"]}={}){const $=x$1`
    <edgeless-line-width-panel
      .selectedSize=${_}
      @select=${R=>{k?.({type:"size",value:R.detail})}}
    ></edgeless-line-width-panel>
  `,B=c$1(w,R=>R,R=>LineStyleButton({className:"line-style-button",mode:R,active:R===y,onClick:()=>{k?.({type:"lineStyle",value:R})}}));return PanelWrapper({className:"line-style-panel",children:x$1`
      ${$}
      <component-toolbar-menu-divider></component-toolbar-menu-divider>
      ${B}
    `})}var __decorate$2i=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const ICON_BUTTON_PADDING_TWO=2;function getMostCommonShape(k){const _=countBy(k,w=>w.shapeType==="rect"&&w.radius?"roundedRect":w.shapeType),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:null}function getMostCommonFillColor(k){const _=countBy(k,w=>w.filled?w.fillColor:"--affine-palette-transparent"),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:null}function getMostCommonStrokeColor(k){const _=countBy(k,w=>w.strokeColor),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:null}function getMostCommonLineSize(k){const _=countBy(k,w=>w.strokeWidth),y=maxBy(Object.entries(_),([w,$])=>$);return y?Number(y[0]):LineWidth.LINE_WIDTH_FOUR}function getMostCommonLineStyle(k){const _=countBy(k,w=>{switch(w.strokeStyle){case StrokeStyle.Solid:return"solid";case StrokeStyle.Dashed:return"dash";case StrokeStyle.None:return"none"}}),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:null}function doesAllShapesContainText(k){return k.every(_=>_.text)}function getMostCommonShapeStyle(k){const _=countBy(k,w=>w.shapeStyle),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:ShapeStyle.Scribbled}const FILL_COLORS=["--affine-palette-shape-yellow","--affine-palette-shape-orange","--affine-palette-shape-tangerine","--affine-palette-shape-red","--affine-palette-shape-magenta","--affine-palette-shape-purple","--affine-palette-shape-green","--affine-palette-shape-blue","--affine-palette-shape-navy","--affine-palette-shape-black","--affine-palette-shape-white","--affine-palette-transparent"],DEFAULT_SHAPE_FILL_COLOR=FILL_COLORS[11],STROKE_COLORS=["--affine-palette-line-yellow","--affine-palette-line-orange","--affine-palette-line-tangerine","--affine-palette-line-red","--affine-palette-line-magenta","--affine-palette-line-purple","--affine-palette-line-green","--affine-palette-line-blue","--affine-palette-line-navy","--affine-palette-line-black","--affine-palette-line-white","--affine-palette-transparent"],DEFAULT_SHAPE_STROKE_COLOR=STROKE_COLORS[0];let EdgelessChangeShapeButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.elements=[],this._popperShow=!1,this._shapePanelPopper=null,this._shapeStyleMenuPopper=null,this._fillColorMenuPopper=null,this._strokeColorMenuPopper=null,this._lineStylesPanelPopper=null}_getTextColor(_){return _===SHAPE_FILL_COLOR_BLACK?SHAPE_TEXT_COLOR_PURE_WHITE:SHAPE_TEXT_COLOR_PURE_BLACK}_setShapeFillColor(_){const y=this._getTextColor(_),w=!isTransparent(_);this.elements.forEach($=>{this.surface.updateElement($.id,{filled:w,fillColor:_,color:y})})}_setShapeStrokeColor(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{strokeColor:_})})}_setShapeStrokeWidth(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{strokeWidth:_})})}_setShapeStrokeStyle(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{strokeStyle:_})})}_setShapeStyles({type:_,value:y}){if(_==="size"){const w=y;this._setShapeStrokeWidth(w)}else if(_==="lineStyle")switch(y){case"solid":{this._setShapeStrokeStyle(StrokeStyle.Solid);break}case"dash":{this._setShapeStrokeStyle(StrokeStyle.Dashed);break}case"none":{this._setShapeStrokeStyle(StrokeStyle.None);break}}}_setShapeStyle(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{shapeStyle:_,fontFamily:_===ShapeStyle.General?GENERAL_CANVAS_FONT_FAMILY:SCRIBBLED_CANVAS_FONT_FAMILY})})}firstUpdated(_){const y=this._disposables;this._shapePanelPopper=createButtonPopper(this._changeShapeButton,this._shapePanel,({display:w})=>{this._popperShow=w==="show"}),y.add(this._shapePanelPopper),y.add(this._shapePanel.slots.select.on(w=>{const $=w==="roundedRect"?{shapeType:"rect",radius:.1}:{shapeType:w,radius:0};this.page.captureSync(),this.elements.forEach(B=>{this.surface.updateElement(B.id,$)})})),this._fillColorMenuPopper=createButtonPopper(this._fillColorButton,this._fillColorMenu,({display:w})=>{this._popperShow=w==="show"}),y.add(this._fillColorMenuPopper),this._strokeColorMenuPopper=createButtonPopper(this._strokeColorButton,this._strokeColorMenu,({display:w})=>{this._popperShow=w==="show"}),y.add(this._strokeColorMenuPopper),this._lineStylesPanelPopper=createButtonPopper(this._lineStylesButton,this._lineStylesPanel,({display:w})=>{this._popperShow=w==="show"}),y.add(this._lineStylesPanelPopper),this._shapeStyleMenuPopper=createButtonPopper(this._shapeStyleButton,this._shapeStyleMenu,({display:w})=>{this._popperShow=w==="show"}),y.add(this._shapeStyleMenuPopper),super.firstUpdated(_)}render(){const _=getMostCommonShape(this.elements),y=getMostCommonFillColor(this.elements)??FILL_COLORS[0],w=getMostCommonStrokeColor(this.elements)??STROKE_COLORS[0],$=getMostCommonLineSize(this.elements)??LineWidth.LINE_WIDTH_FOUR,B=getMostCommonLineStyle(this.elements)??"solid",R=getMostCommonShapeStyle(this.elements)??ShapeStyle.Scribbled;return x$1`
      <div class="change-shape-toolbar-container">
        <edgeless-tool-icon-button
          .tooltip=${this._popperShow?"":"Switch Type"}
          .tipPosition=${"bottom"}
          .active=${!1}
          .iconContainerPadding=${ICON_BUTTON_PADDING_TWO}
          @click=${()=>this._shapePanelPopper?.toggle()}
        >
          <div class="change-shape-button">
            ${ChangeShapeIcon} ${ShapeArrowDownSmallIcon}
          </div>
        </edgeless-tool-icon-button>
        <edgeless-shape-panel
          .selectedShape=${_}
          .shapeStyle=${R}
        >
        </edgeless-shape-panel>

        <component-toolbar-menu-divider></component-toolbar-menu-divider>

        <edgeless-tool-icon-button
          .tooltip=${this._popperShow?"":"Style"}
          .tipPosition=${"bottom"}
          .active=${!1}
          .iconContainerPadding=${ICON_BUTTON_PADDING_TWO}
          @click=${()=>this._shapeStyleMenuPopper?.toggle()}
        >
          <div class="shape-style-button">
            ${R===ShapeStyle.General?GeneralShapeStyleIcon:ScribbledShapeStyleIcon}
            ${ShapeArrowDownSmallIcon}
          </div>
        </edgeless-tool-icon-button>
        <div class="shape-style-panel-container">
          <edgeless-shape-style-panel
            .value=${R}
            .onSelect=${H=>{this._setShapeStyle(H)}}
          >
          </edgeless-shape-style-panel>
        </div>

        <component-toolbar-menu-divider></component-toolbar-menu-divider>

        <edgeless-tool-icon-button
          class="fill-color-button"
          .tooltip=${this._popperShow?"":"Fill color"}
          .tipPosition=${"bottom"}
          .active=${!1}
          .iconContainerPadding=${ICON_BUTTON_PADDING_TWO}
          @click=${()=>this._fillColorMenuPopper?.toggle()}
        >
          <div class="fill-color-container">
            ${ColorUnit(y)}
          </div>
        </edgeless-tool-icon-button>
        <div class="color-panel-container fill-color">
          <edgeless-color-panel
            .value=${y}
            .options=${FILL_COLORS}
            @select=${H=>this._setShapeFillColor(H.detail)}
          >
          </edgeless-color-panel>
        </div>

        <edgeless-tool-icon-button
          class="stroke-color-button"
          .tooltip=${this._popperShow?"":"Border color"}
          .tipPosition=${"bottom"}
          .active=${!1}
          .iconContainerPadding=${ICON_BUTTON_PADDING_TWO}
          @click=${()=>this._strokeColorMenuPopper?.toggle()}
        >
          <div class="stroke-color-container">
            ${ColorUnit(w,{hollowCircle:!0})}
          </div>
        </edgeless-tool-icon-button>
        <div class="color-panel-container stroke-color">
          <edgeless-color-panel
            .value=${w}
            .options=${STROKE_COLORS}
            .hollowCircle=${!0}
            @select=${H=>this._setShapeStrokeColor(H.detail)}
          >
          </edgeless-color-panel>
        </div>

        <component-toolbar-menu-divider></component-toolbar-menu-divider>

        <edgeless-tool-icon-button
          .tooltip=${this._popperShow?"":"Border style"}
          .tipPosition=${"bottom"}
          .active=${!1}
          .iconContainerPadding=${ICON_BUTTON_PADDING_TWO}
          @click=${()=>this._lineStylesPanelPopper?.toggle()}
        >
          <div class="line-styles-button">
            ${LineStyleIcon} ${ShapeArrowDownSmallIcon}
          </div>
        </edgeless-tool-icon-button>
        ${LineStylesPanel({selectedLineSize:$,selectedLineStyle:B,onClick:H=>{this._setShapeStyles(H)}})}
        ${doesAllShapesContainText(this.elements)?x$1` <component-toolbar-menu-divider></component-toolbar-menu-divider>
              <edgeless-change-text-menu
                .elements=${this.elements}
                .elementType=${"shape"}
                .surface=${this.surface}
                .slots=${this.slots}
              ></edgeless-change-text-menu>`:A}
      </div>
    `}};EdgelessChangeShapeButton.styles=[lineSizeButtonStyles,lineStylesPanelStyles,i$5`
      .change-shape-toolbar-container {
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--affine-text-primary-color);
        stroke: none;
        fill: currentColor;
      }

      edgeless-shape-panel {
        display: none;
      }

      edgeless-shape-panel[data-show] {
        display: flex;
      }

      .change-shape-button,
      .shape-style-button,
      .line-styles-button {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .change-shape-button svg,
      .shape-style-button svg,
      .line-styles-button svg {
        fill: var(--affine-icon-color);
      }

      .stroke-color-button {
        margin-left: 12px;
      }

      .fill-color-container,
      .stroke-color-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 20px;
        height: 20px;
      }

      .color-panel-container,
      .shape-style-panel-container {
        display: none;
        justify-content: center;
        align-items: center;
        background: var(--affine-background-overlay-panel-color);
        box-shadow: var(--affine-shadow-2);
        border-radius: 8px;
      }

      .shape-style-panel-container {
        padding: 8px;
      }

      .color-panel-container[data-show],
      .shape-style-panel-container[data-show] {
        display: flex;
      }

      .shape-color-button-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 24px;
        height: 24px;
        box-sizing: border-box;
        border-radius: 4px;
        cursor: pointer;
      }

      .shape-color-button-indicator div {
        border-radius: 50%;
        width: 16px;
        height: 16px;
      }

      .line-style-panel {
        display: none;
        padding: 6px;
      }

      .line-style-panel component-toolbar-menu-divider {
        margin: 0 8px;
      }

      .line-style-panel[data-show] {
        display: flex;
      }

      component-toolbar-menu-divider {
        margin: 0 12px;
      }
    `];__decorate$2i([n$a({attribute:!1})],EdgelessChangeShapeButton.prototype,"elements",void 0);__decorate$2i([n$a({attribute:!1})],EdgelessChangeShapeButton.prototype,"page",void 0);__decorate$2i([n$a({attribute:!1})],EdgelessChangeShapeButton.prototype,"surface",void 0);__decorate$2i([n$a({attribute:!1})],EdgelessChangeShapeButton.prototype,"slots",void 0);__decorate$2i([t$2()],EdgelessChangeShapeButton.prototype,"_popperShow",void 0);__decorate$2i([i$6(".change-shape-button")],EdgelessChangeShapeButton.prototype,"_changeShapeButton",void 0);__decorate$2i([i$6("edgeless-shape-panel")],EdgelessChangeShapeButton.prototype,"_shapePanel",void 0);__decorate$2i([i$6(".shape-style-button")],EdgelessChangeShapeButton.prototype,"_shapeStyleButton",void 0);__decorate$2i([i$6(".shape-style-panel-container")],EdgelessChangeShapeButton.prototype,"_shapeStyleMenu",void 0);__decorate$2i([i$6(".fill-color-button")],EdgelessChangeShapeButton.prototype,"_fillColorButton",void 0);__decorate$2i([i$6(".color-panel-container.fill-color")],EdgelessChangeShapeButton.prototype,"_fillColorMenu",void 0);__decorate$2i([i$6(".stroke-color-button")],EdgelessChangeShapeButton.prototype,"_strokeColorButton",void 0);__decorate$2i([i$6(".color-panel-container.stroke-color")],EdgelessChangeShapeButton.prototype,"_strokeColorMenu",void 0);__decorate$2i([i$6(".line-styles-button")],EdgelessChangeShapeButton.prototype,"_lineStylesButton",void 0);__decorate$2i([i$6(".line-style-panel")],EdgelessChangeShapeButton.prototype,"_lineStylesPanel",void 0);EdgelessChangeShapeButton=__decorate$2i([e$7("edgeless-change-shape-button")],EdgelessChangeShapeButton);const CodeBlockSchema=defineBlockSchema({flavour:"affine:code",props:k=>({text:k.Text(),language:FALLBACK_LANG}),metadata:{version:1,role:"content",parent:["affine:note","affine:paragraph","affine:list"],children:[]}});class DataViewBlockModel extends BaseBlockModel{constructor(){super(),this.created.on(()=>{this.views.length||this.addView("table")})}addView(_){this.page.captureSync();const y=this.page.generateId();return this.page.transact(()=>{this.views.push({id:y,mode:_,columns:[],name:_,filter:{type:"group",op:"and",conditions:[]}})}),y}deleteView(_){this.page.captureSync(),this.page.transact(()=>{this.views=this.views.filter(y=>y.id!==_)})}updateView(_,y){this.page.transact(()=>{this.views=this.views.map(w=>w.id!==_?w:{...w,...y(w)})}),this.applyViewsUpdate()}applyViewsUpdate(){this.page.updateBlock(this,{views:this.views})}}const DataViewBlockSchema=defineBlockSchema({flavour:"affine:data-view",props:()=>({views:[]}),metadata:{role:"hub",version:1,parent:["affine:note"],children:["affine:paragraph","affine:list"]},toModel:()=>new DataViewBlockModel}),titleColumnTypeName="title",titlePureColumnConfig=columnManager.register(titleColumnTypeName,{name:"Title",type:()=>tRichText.create(),defaultData:()=>({}),cellToString:k=>k?.toString()??"",cellFromString:k=>({value:k}),cellToJson:k=>k?.toString()??null});class ViewManager{constructor(){this.map=new Map}getView(_){const y=this.map.get(_);if(!y)throw new Error(`${_} is not exist`);return y}register(_,y){this.map.set(_,{...y,type:_})}get all(){return Array.from(this.map.values())}}const viewManager=new ViewManager;class ViewRendererManager{constructor(){this.map=new Map}getView(_){const y=this.map.get(_);if(!y)throw new Error(`${_} is not exist`);return y}register(_,y){this.map.set(_,{...y,type:_})}get all(){return Array.from(this.map.values())}}const viewRendererManager=new ViewRendererManager;function insertPositionToIndex(k,_,y=w=>w.id){return typeof k=="object"?_.findIndex($=>y($)===k.id)+(k.before?0:1):k==null||k==="start"?0:k==="end"?_.length:_.findIndex(w=>y(w)===k)+1}class DatabaseBlockModel extends BaseBlockModel{getViewList(){return this.views}initEmpty(_){this.addColumn("start",titlePureColumnConfig.create(titlePureColumnConfig.name)),this.addView(_)}initConvert(_){this.addColumn("end",multiSelectPureColumnConfig.create("Tag",{options:[]})),this.initEmpty(_)}initTemplate(_){const y=[nanoid(),nanoid(),nanoid()],w=this.addColumn("end",selectPureColumnConfig.create("Status",{options:[{id:y[0],color:getTagColor(),value:"TODO"},{id:y[1],color:getTagColor(),value:"In Progress"},{id:y[2],color:getTagColor(),value:"Done"}]}));for(let $=0;$<4;$++){const B=this.page.addBlock("affine:paragraph",{text:new this.page.Text(`Task ${$+1}`)},this.id);this.updateCell(B,{columnId:w,value:y[$]})}this.initEmpty(_)}addView(_){const y=this.page.generateId(),w=viewManager.getView(_),$=w.init(this,y,w.defaultName);return this.page.transact(()=>{this.views.push($)}),$}deleteView(_){this.page.captureSync(),this.page.transact(()=>{this.views=this.views.filter(y=>y.id!==_)})}updateView(_,y){this.page.transact(()=>{this.views=this.views.map(w=>w.id!==_?w:{...w,...y(w)})}),this.applyViewsUpdate()}applyViewsUpdate(){this.page.updateBlock(this,{views:this.views})}applyColumnUpdate(){this.page.updateBlock(this,{columns:this.columns})}findColumnIndex(_){return this.columns.findIndex(y=>y.id===_)}getColumn(_){return this.columns.find(y=>y.id===_)}addColumn(_,y){const w=y.id??this.page.generateId();return this.columns.find($=>$.id===w)||this.page.transact(()=>{const $={...y,id:w};this.columns.splice(insertPositionToIndex(_,this.columns),0,$)}),w}updateColumn(_,y){const w=this.columns.findIndex($=>$.id===_);if(w!=null)return this.page.transact(()=>{const $=this.columns[w];this.columns[w]={...$,...y($)}}),_}deleteColumn(_){const y=this.findColumnIndex(_);y<0||this.page.transact(()=>{this.columns.splice(y,1)})}getCell(_,y){if(y==="title")return{columnId:"title",value:_};const $=this.cells[_]?.[y]??null;return $?{columnId:$.columnId,value:$.value}:null}updateCell(_,y){_ in this.cells||(this.cells[_]={}),this.page.transact(()=>{this.cells[_][y.columnId]={columnId:y.columnId,value:y.value}})}copyCellsByColumn(_,y){this.page.transact(()=>{Object.keys(this.cells).forEach(w=>{const $=this.cells[w][_];$&&(this.cells[w][y]={...$,columnId:y})})})}updateCells(_,y){this.page.transact(()=>{Object.entries(y).forEach(([w,$])=>{this.cells[w][_]={columnId:_,value:$}})})}}const migration$1={toV3:k=>{const _=nanoid(),y=k.titleColumnName,w=k.titleColumnWidth;delete k.titleColumnName,delete k.titleColumnWidth,k.columns.unshift({id:_,type:"title",name:y,data:{}}),k.views.forEach($=>{$.mode==="table"&&$.columns.unshift({id:_,width:w})})}},DatabaseBlockSchema=defineBlockSchema({flavour:"affine:database",props:k=>({views:[],title:k.Text(""),cells:{},columns:[]}),metadata:{role:"hub",version:3,parent:["affine:note"],children:["affine:paragraph","affine:list"]},toModel:()=>new DatabaseBlockModel,onUpgrade:(k,_,y)=>{_<3&&y>=3&&migration$1.toV3(k)}}),DividerBlockSchema=defineBlockSchema({flavour:"affine:divider",metadata:{version:1,role:"content",children:[]}}),defaultImageProps={caption:"",sourceId:"",width:0,height:0},ImageBlockSchema=defineBlockSchema({flavour:"affine:image",props:()=>defaultImageProps,metadata:{version:1,role:"content"}}),ListBlockSchema=defineBlockSchema({flavour:"affine:list",props:k=>({type:"bulleted",text:k.Text(),checked:!1}),metadata:{version:1,role:"content",parent:["affine:note","affine:database","affine:list","affine:paragraph"]}}),NOTE_COLORS$1=["--affine-background-secondary-color","--affine-tag-yellow","--affine-tag-red","--affine-tag-green","--affine-tag-blue","--affine-tag-purple"],DEFAULT_NOTE_COLOR$1=NOTE_COLORS$1[0],NoteBlockSchema=defineBlockSchema({flavour:"affine:note",props:()=>({xywh:`[0,0,${EDITOR_WIDTH},95]`,background:DEFAULT_NOTE_COLOR$1,index:"a0",hidden:!1}),metadata:{version:1,role:"hub",parent:["affine:page"],children:["affine:paragraph","affine:list","affine:code","affine:divider","affine:database","affine:data-view","affine:image","affine:note-block-*","affine:bookmark","affine:attachment"]}});class PageBlockModel extends BaseBlockModel{constructor(){super(),this.created.on(()=>{this.page.slots.blockUpdated.on(({type:_})=>{_==="add"&&this.page.workspace.setPageMeta(this.page.id,{title:this.title.toString()})})})}}const PageBlockSchema=defineBlockSchema({flavour:"affine:page",props:k=>({title:k.Text()}),metadata:{version:2,role:"root"},toModel:()=>new PageBlockModel}),ParagraphBlockSchema=defineBlockSchema({flavour:"affine:paragraph",props:k=>({type:"text",text:k.Text()}),metadata:{version:1,role:"content",parent:["affine:note","affine:database","affine:paragraph","affine:list"]}}),migration={toV4:k=>{const{elements:_}=k;Object.keys(_).forEach(y=>{const w=_[y],$=w.type;if($==="shape"||$==="text"){const B=w.isBold,R=w.isItalic;delete w.isBold,delete w.isItalic,B&&(w.bold=!0),R&&(w.italic=!0)}else if($==="connector"){const B=w.source,R=w.target;if(!B.position&&(!B.id||!_[B.id])){delete _[y];return}if(!R.id&&(!R.id||!_[R.id])){delete _[y];return}}})}},SurfaceBlockSchema=defineBlockSchema({flavour:"affine:surface",props:()=>({elements:{}}),metadata:{version:4,role:"hub",parent:["affine:page"],children:[]},onUpgrade:(k,_,y)=>{_<4&&y>=4&&migration.toV4(k)}}),AffineSchemas=[CodeBlockSchema,ParagraphBlockSchema,PageBlockSchema,ListBlockSchema,NoteBlockSchema,DividerBlockSchema,ImageBlockSchema,SurfaceBlockSchema,BookmarkBlockSchema],__unstableSchemas=[DatabaseBlockSchema,DataViewBlockSchema,AttachmentBlockSchema];var __decorate$2h=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const listIconMap={bulleted:BulletedListIcon,numbered:NumberedListIcon,todo:CheckBoxIcon,toggle:BulletedListIcon};class TOCBlockPreview extends WithDisposable(s$2){connectedCallback(){super.connectedCallback(),this._disposables.add(this.block.page.slots.onYEvent.on(({event:_})=>{_ instanceof YTextEvent&&_.path[0]===this.block.id&&this.requestUpdate()})),this._disposables.add(this.block.propsUpdated.on(()=>this.requestUpdate()))}renderBlockByFlavour(){const{block:_}=this;switch(_.flavour){case"affine:paragraph":return x$1`
          ${_.type==="quote"?x$1`<span class="icon">${QuoteIcon}</span>`:A}
          <span class="text subtype ${_.type}"
            >${_.text.toString()}</span
          >
        `;case"affine:list":return x$1`
          <span class="icon">${listIconMap[_.type]}</span>
          <span class="text">${_.text.toString()}</span>
        `;case"affine:bookmark":return x$1`
          <span class="icon">${BookmarkIcon}</span>
          <span class="text"
            >${_.bookmarkTitle||_.url||"Bookmark"}</span
          >
        `;case"affine:code":return x$1`
          <span class="icon">${CodeBlockIcon}</span>
          <span class="text">${_.language}</span>
        `;case"affine:database":return x$1`
          <span class="icon">${DatabaseTableViewIcon}</span>
          <span class="text">${_.title||"Database"}</span>
        `;case"affine:image":return x$1`
          <span class="icon">${ImageIcon}</span>
          <span class="text">${_.caption||""}</span>
        `;case"affine:attachment":return x$1`
          <span class="icon">${AttachmentIcon}</span>
          <span class="text">${_.name}</span>
        `;case"affine:data-view":return x$1`
          <span class="icon">${DatabaseKanbanViewIcon}</span>
          <span class="text">Database View</span>
        `;case"affine:divider":return x$1`
          <span class="icon">${DividerIcon}</span>
          <span class="text">Divider</span>
        `;default:return _.flavour}}render(){return x$1`<div class="edgeless-toc-block-preview">
      ${this.renderBlockByFlavour()}
    </div>`}}TOCBlockPreview.styles=i$5`
    :host {
      display: block;
      width: 156%;
    }

    .edgeless-toc-block-preview {
      white-space: nowrap;
      line-height: 15px;
      display: flex;
      justify-content: start;
      align-items: center;
      gap: 5px;
    }

    .icon {
      color: var(--affine-icon-color);
      display: flex;
      align-items: center;
    }

    .icon > svg {
      width: 12px;
      height: 12px;
      fill: currentColor;
    }

    .text {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;

      font-size: 12px;
      transform: scale(0.625);
      transform-origin: center left;
      color: var(--affine-text-primary-color);
    }
    .subtype.h1,
    .subtype.h2,
    .subtype.h3 .subtype.h4 {
      font-weight: bolder;
    }
  `;__decorate$2h([n$a({attribute:!1})],TOCBlockPreview.prototype,"block",void 0);var __decorate$2g=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class TOCNoteCard extends WithDisposable(s$2){constructor(){super(...arguments),this.invisible=!1}connectedCallback(){super.connectedCallback(),this._disposables.add(this.note.childrenUpdated.on(()=>this.requestUpdate())),this._disposables.add(this.note.propsUpdated.on(()=>this.requestUpdate()));const _=new MutationObserver(()=>this.requestUpdate());_.observe(this.ownerDocument.documentElement,{subtree:!1,childList:!1,attributes:!0,attributeFilter:["data-theme"]}),this._disposables.add(()=>_.disconnect())}_dispatchReorderEvent(_){const y=new CustomEvent("reorder",{detail:{currentNumber:this.number,targetNumber:_,index:this.index}});this.dispatchEvent(y)}_dispatchSelectEvent(_){const y=new CustomEvent("select",{detail:{id:this.note.id,selected:this.status!=="selected",number:this.number,multiselect:_.shiftKey}});this.dispatchEvent(y)}_dispatchDragEvent(_){_.preventDefault();const{clientX:y,clientY:w}=_,$=on$1(this.ownerDocument,"mousemove",B=>{if(Math.abs(y-B.clientX)<5&&Math.abs(w-B.clientY)<5)return;this.status!=="selected"&&this._dispatchSelectEvent(B);const R=new CustomEvent("drag",{detail:{clientX:B.clientX,clientY:B.clientY,pageX:B.pageX,pageY:B.pageY}});this.dispatchEvent(R),$()});once(this.ownerDocument,"mouseup",()=>{$()})}_dispatchFitViewEvent(_){_.stopPropagation();const y=new CustomEvent("fitview",{detail:{block:this.note}});this.dispatchEvent(y)}_moveForward(){this.number>1&&this._dispatchReorderEvent(this.number-1)}_moveBackward(){this._dispatchReorderEvent(this.number+1)}render(){if(this.note.isEmpty())return A;const _=queryCurrentMode(),{pos:y,stackOrder:w,width:$}=this,{children:B}=this.note,R=B.length>4,[H,j]=pickArray(B,[0,1]),[q,X]=R?pickArray(B,[B.length-2,B.length-1]):[B[2],B[3]];return x$1`
      <div
        data-invisible="${this.invisible?"true":"false"}"
        class="card-container ${this.status??""} ${_}"
        style=${this.status==="dragging"?o$4({transform:`translate(${y.x-16}px, ${y.y-9}px) rotate(${w===0?3:1}deg)`,width:$?`${$}px`:void 0}):A}
      >
        <div class="card-wrapper">
          <div class="action">
            <div
              class="handle"
              @mousedown=${this._dispatchDragEvent}
            ></div>
            <span
              class="switch"
              role="button"
              style="top: 0; left:0;"
              @click=${this._moveForward}
            >${ArrowIcon}</span>
            <span
              class="switch"
              role="button"
              style="transform:rotate(0.5turn); bottom: 0; left: 0;"
              @click=${this._moveBackward}
            >${ArrowIcon}</span
            >
          </div>
        </div>
        <div
          class="card-preview"
          @mousedown=${this._dispatchDragEvent}
          @click=${this._dispatchSelectEvent}
          @dblclick=${this._dispatchFitViewEvent}
        >
          <div class="card-number">
            ${this.invisible?HiddenIcon:x$1`<span class="number">${this.number}</span>`}
          </div>
          <div class="card-content">
            ${H?x$1`<edgeless-toc-block-preview
                    .block=${H}
                  ></edgeless-toc-block-preview>`:A}
            ${j?x$1`<edgeless-toc-block-preview
                    .block=${j}
                  ></edgeless-toc-block-preview>`:A}
            ${R?x$1`<div class="card-ellipsis">
                    <div class="dash"></div>
                    <div class="dots">
                      <div class="dot"></div>
                      <div class="dot"></div>
                      <div class="dot"></div>
                    </div>
                    <div class="dash"></div>
                  </div>`:null}
            ${q?x$1`<edgeless-toc-block-preview
                    .block=${q}
                  ></edgeless-toc-block-preview>`:A}
            ${X?x$1`<edgeless-toc-block-preview
                    .block=${X}
                  ></edgeless-toc-block-preview>`:A}
            </div>
          </div>
        </div>
      </div>
    `}}TOCNoteCard.styles=i$5`
    :host {
      display: block;
      position: relative;
    }

    .card-container {
      position: relative;

      height: 136px;
      padding: 9px 11px 7px;
      box-sizing: border-box;
    }

    .card-wrapper {
      position: absolute;
      top: 0px;
      left: -8px;

      display: flex;
      align-items: center;

      box-sizing: border-box;
      width: calc(100% + 4px);
      height: 100%;

      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0);
      transition: background-color 0.2s ease-out;
      user-select: none;
    }

    .action {
      flex-grow: 1;
      opacity: 0;
      position: relative;
      height: 100px;
      width: 16px;
      transition: opacity 0.2s ease-out;
    }

    .action:hover {
      opacity: 1;
    }

    .action > .handle {
      position: absolute;
      left: 0;
      top: 16px;
      width: 17px;
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
    }

    .action > .handle::after {
      content: '';
      width: 2px;
      height: 21px;
      border-radius: 1px;
      transition: height 0.2s 0.5s ease-out;
      background-color: var(--affine-icon-secondary);
    }

    .action > .switch {
      color: var(--affine-icon-secondary);
      position: absolute;
      display: block;
      transition: opacity 0.2s 0.5s ease-out;
      cursor: pointer;
    }

    .handle:hover::after {
      height: 51px;
    }
    .handle:hover ~ .switch {
      pointer-events: none;
      opacity: 0;
    }

    .card-preview {
      overflow: hidden;
      position: relative;

      box-sizing: border-box;
      height: 120px;
      padding: 7px 12px;

      border-radius: 8px;
      outline: 2px solid var(--affine-background-primary-color);
      background-color: var(--affine-background-primary-color);
      box-shadow: 0px 0px 12px 0px rgba(66, 65, 73, 0.18);

      cursor: default;
      user-select: none;

      transition: border-color 0.2s ease-out;
    }

    .card-preview:hover {
      outline: 2px solid var(--affine-blue-500);
      background: linear-gradient(
          180deg,
          rgba(218, 233, 255, 0.2) 0%,
          rgba(255, 255, 255, 0) 100%
        ),
        #fff;
    }

    .card-number {
      box-sizing: border-box;
      display: flex;
      width: 20px;
      height: 20px;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-radius: 4px;
      background: var(--light-affine-blue-affine-blue-600, #1e96eb);
      color: var(--affine-white);
    }

    .card-number > .number {
      text-align: center;
      font-size: 12px;
      font-family: var(--affine-font-family);
      font-weight: 600;
      line-height: 16px;
    }

    .card-content {
      font-family: var(--affine-font-family);
      user-select: none;
    }

    .card-ellipsis {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 16px;
      gap: 10px;
      padding: 0 10px;
    }

    .card-ellipsis .dash {
      width: 60px;
      height: 1px;
      background-color: var(--affine-black-30);
      flex-grow: 1;
    }

    .card-ellipsis .dots {
      display: flex;
      padding: 5px 10px;
      border-radius: 8px;
      background: var(--affine-white, #fff);
      box-shadow: 0px 0px 1px 0px rgba(0, 0, 0, 0.15);
      gap: 2.5px;
    }

    .card-ellipsis .dots .dot {
      height: 3.5px;
      width: 3.5px;
      border-radius: 50%;
      background-color: var(--affine-icon-secondary);
    }

    .card-container.dragging {
      pointer-events: none;
      transform-origin: 16px 9px;
      position: fixed;
      top: 0;
      left: 0;
      contain: size layout paint;
      z-index: calc(var(--affine-z-index-popover, 0) + 3);
    }

    .card-container:hover .card-wrapper {
      background-color: var(--affine-hover-color, rgba(0, 0, 0, 0.04));
    }

    .card-container.placeholder {
      pointer-events: none;
      opacity: 0.5;
    }

    .card-container[data-invisible='true'] .action {
      visibility: hidden;
    }

    .card-container.dragging .card-preview,
    .card-container.placeholder .card-preview,
    .card-container.selected .card-preview {
      outline: 2px solid var(--affine-blue-500);
      background: linear-gradient(
          180deg,
          rgba(218, 233, 255, 0.2) 0%,
          rgba(255, 255, 255, 0) 100%
        ),
        #fff;
    }

    .dark.card-container.dragging .card-preview,
    .dark.card-container.placeholder .card-preview,
    .dark.card-container.selected .card-preview,
    .dark.card-container .card-preview:hover {
      background: linear-gradient(
          180deg,
          rgba(147, 146, 139, 0.2) 0%,
          rgba(255, 255, 255, 0) 100%
        ),
        #000;
    }

    .card-container[data-invisible='true'] .card-preview:hover,
    .card-container[data-invisible='true'] .card-preview {
      background: none;
      outline: none;
      box-shadow: none;
      border: 1px dashed var(--affine-border-color);
    }
    .card-container[data-invisible='true'] .card-wrapper {
      background: none;
    }
  `;__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"page",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"note",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"index",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"number",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"stackOrder",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"pos",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"width",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"status",void 0);__decorate$2g([n$a({attribute:!1})],TOCNoteCard.prototype,"invisible",void 0);function startDragging(k,_){const{doc:y,host:w,container:$,page:B,onDragMove:R,onDragEnd:H,tocListContainer:j,start:q}=_,X=lastN(k,2).map((le,ue,he)=>{const ce=new TOCNoteCard;return ce.page=B,ce.note=le.note,ce.index=le.index,ce.number=le.number,ce.status="dragging",ce.stackOrder=he.length-1-ue,ce.pos=q,ce.width=_.width,ce}),ee=createMaskElement(y),te=j.getBoundingClientRect(),ne=Array.from(j.children);let oe;$.renderRoot.appendChild(ee),$.renderRoot.append(...X);const ie=le=>le.clientX>=te.left&&le.clientX<=te.right&&le.clientY>=te.top&&le.clientY<=te.bottom,ae=on$1($,"mousemove",le=>{if(X.forEach(ue=>{ue.pos={x:le.clientX,y:le.clientY}}),!ie(le)){oe=void 0,R?.(oe);return}oe=0;for(const ue of ne){if(ue.invisible||!ue.note)break;const he=te.top+ue.offsetTop-j.scrollTop,ce=he+ue.offsetHeight/2,ge=he+ue.offsetHeight;if(le.clientY>=he&&le.clientY<=ge){oe=le.clientY>ce?oe+1:oe,R?.(oe);return}++oe}R?.(oe)});let re=!1;once(w,"mouseup",()=>{re||(re=!0,X.forEach(le=>$.renderRoot.removeChild(le)),$.renderRoot.removeChild(ee),ae(),H?.(oe))})}function createMaskElement(k){const _=k.createElement("div");return _.style.height="100vh",_.style.width="100vw",_.style.position="fixed",_.style.left="0",_.style.top="0",_.style.zIndex="calc(var(--affine-z-index-popover, 0) + 3)",_.style.cursor="grabbing",_}var __decorate$2f=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class TOCNotesPanel extends WithDisposable(s$2){constructor(){super(...arguments),this._dragging=!1,this._notes=[],this._hiddenNotes=[],this._selected=[],this._noteElementHeight=0,this._changedFlag=!1}get edgeless(){return this.ownerDocument.querySelector("affine-edgeless-page")}get viewportPadding(){return this.fitPadding?[0,0,0,0].map((_,y)=>Number.isFinite(this.fitPadding[y])?this.fitPadding[y]:_):[0,0,0,0]}connectedCallback(){super.connectedCallback();const{slots:_,root:y}=this.page,w=y?[y.childrenUpdated,_.blockUpdated]:[_.blockUpdated];_.rootAdded.on($=>{this._disposables.add($.childrenUpdated.on(()=>this._updateNotes()))}),w.forEach($=>{this._disposables.add($.on(()=>this._updateNotes()))}),this._updateNotes()}disconnectedCallback(){if(super.disconnectedCallback(),!this._changedFlag&&this._oldViewport){const _=this.edgeless;if(!_)return;_.surface.viewport.setViewport(this._oldViewport.zoom,[this._oldViewport.center.x,this._oldViewport.center.y],!0)}}_updateNotes(){const _=this.page.root;if(this._dragging)return;if(!_){this._notes=[];return}const y=[],w=[],$=this._selected.reduce((R,H)=>(R.add(H),R),new Set),B=[];_.children.forEach((R,H)=>{if(!matchFlavours(R,["affine:note"]))return;const j={note:R,index:H,number:H+1};R.hidden?w.push(j):(y.push(j),$.has(R.id)&&B.push(R.id))}),this._notes=y,this._hiddenNotes=w,this._selected=B}_reorder(_){if(_.detail.targetNumber>this._notes.length)return;const{currentNumber:y,targetNumber:w}=_.detail,$=this._notes[y-1],B=this._notes[w-1],R=this.page.root;assertExists(R),this._changedFlag=!0,this.page.moveBlocks([$.note],R,B.note,w<y)}_moveBlocks(_,y,w,$,B){if(!B.length||!this.page.root)return;const R=y.map(te=>w.get(te).note),H=new Set(R),j=_===$.length?$[_-1].index+1:$[_].index,q=B.slice(0,j).filter(te=>!H.has(te)),X=B.slice(j).filter(te=>!H.has(te)),ee=[...q,...R,...X];this._changedFlag=!0,this.page.updateBlock(this.page.root,{children:ee})}_selectNote(_){const{selected:y,id:w,multiselect:$}=_.detail;y?$?(this._selected.push(w),this.requestUpdate("_selected")):this._selected=[w]:this._selected=this._selected.filter(B=>B!==w),this.edgeless?.selectionManager.setSelection({elements:this._selected,editing:!1})}_drag(_){if(!this._selected.length||!this.page.root)return;this._dragging=!0;const y=this.page.root.children.slice(),w=this._notes,$=this._notes.reduce((j,q,X)=>(j.set(q.note.id,{...q,number:X+1}),j),new Map),B=this._selected.slice(),R=B.map(j=>{const q=$.get(j);return{note:q.note,element:this.renderRoot.querySelector(`[data-note-id="${q.note.id}"]`),index:q.index,number:q.number}}),H=R[0].element.clientWidth;this._noteElementHeight=R[0].element.offsetHeight,startDragging(R,{width:H,container:this,doc:this.ownerDocument,host:this.host??this.ownerDocument,page:this.page,start:{x:_.detail.clientX,y:_.detail.clientY},tocListContainer:this.panelListElement,onDragEnd:j=>{this._dragging=!1,this.insertIndex=void 0,j!==void 0&&this._moveBlocks(j,B,$,w,y)},onDragMove:j=>{this.insertIndex=j}})}firstUpdated(){this._zoomToFit()}_zoomToFit(){const _=this.edgeless;if(!_)return;const{surface:y}=_,w=_.getElementsBound();w&&(this._oldViewport={zoom:y.viewport.zoom,center:{x:y.viewport.center.x,y:y.viewport.center.y}},y.viewport.setViewportByBound(new Bound(w.x,w.y,w.w,w.h),this.viewportPadding,!0))}_fitToElement(_){const y=this.edgeless;if(!y)return;const{block:w}=_.detail,$=Bound.deserialize(w.xywh);y.surface.viewport.setViewportByBound($,this.viewportPadding,!0)}_jumpToHidden(){if(!this._hiddenNotes.length)return;const _=this._hiddenNotes[0].note.id;this.renderRoot.querySelector(`[data-note-id="${_}"]`)?.scrollIntoView({behavior:"smooth",block:"start"})}render(){const _=new Set(this._selected);return x$1`
      <div class="navigation-panel-container">
        <div class="panel-header">
          <div class="panel-info">
            <span class="icon">${CardIcon}</span>
            <span class="content">
              <span class="count">${this._notes.length}</span> cards show on
              page
            </span>
          </div>
          <div
            class="panel-info"
            style="cursor: pointer;"
            @click=${this._jumpToHidden}
          >
            <span class="icon">${HiddenCardIcon}</span>
            <span class="content">
              <span class="count">${this._hiddenNotes.length}</span> cards
              hidden
            </span>
            <span class="action">
              <span
                class="icon"
                role="button"
                style="position: relative; top: 1px;"
              >
                ${DualLinkIcon}
              </span>
            </span>
          </div>
        </div>
        <div class="panel-list">
          ${this.insertIndex!==void 0?x$1`<div
                class="insert-indicator"
                style="transform: translateY(${this.insertIndex*this._noteElementHeight+10}px)"
              ></div>`:A}
          ${this._notes.length?c$1(this._notes,y=>y.note.id,(y,w)=>x$1`
                  <edgeless-note-toc-card
                    data-note-id=${y.note.id}
                    .note=${y.note}
                    .number=${w+1}
                    .index=${y.index}
                    .page=${this.page}
                    .status=${_.has(y.note.id)?this._dragging?"placeholder":"selected":void 0}
                    style=${this.insertIndex!==void 0&&w>=this.insertIndex?"transform: translateY(20px)":""}
                    @reorder=${this._reorder}
                    @select=${this._selectNote}
                    @drag=${this._drag}
                    @fitview=${this._fitToElement}
                  ></edgeless-note-toc-card>
                `):x$1`${A}`}
          ${this._hiddenNotes.length>0?x$1`<div class="title">Hidden on Page</div>`:A}
          ${this._hiddenNotes.length?c$1(this._hiddenNotes,y=>y.note.id,(y,w)=>x$1`<edgeless-note-toc-card
                  data-note-id=${y.note.id}
                  .note=${y.note}
                  .number=${w+1}
                  .index=${y.index}
                  .page=${this.page}
                  .invisible=${!0}
                  style=${this.insertIndex!==void 0?"transform: translateY(20px)":""}
                  @fitview=${this._fitToElement}
                ></edgeless-note-toc-card>`):A}
        </div>
      </div>
    `}}TOCNotesPanel.styles=i$5`
    :host {
      display: block;
      width: 100%;
      height: 100%;
    }

    .navigation-panel-container {
      background-color: var(--affine-background-overlay-panel-color);
      padding: 17.5px 16px;
      box-sizing: border-box;

      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 8px;

      height: 100%;
    }

    .panel-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    .panel-info {
      font-size: 12px;
      font-family: var(--affine-font-family);
      color: var(--affine-text-secondary-color);

      display: flex;
      align-items: center;
      gap: 14px;
      align-self: stretch;
      height: 20px;
    }

    .panel-info .content {
      flex: 1 0 0;
    }

    .panel-info .icon {
      height: 16px;
      color: var(--affine-icon-color);
      fill: currentColor;
    }

    .panel-info .icon > svg {
      height: 16px;
    }

    .panel-info .action {
      display: flex;
      align-items: center;
    }

    .panel-info .action .icon,
    .panel-info .action .icon > svg {
      height: 12px;
    }

    .panel-info .count {
      font-family: var(--affine-number-font-family);
      font-weight: 600;
    }

    .panel-list {
      position: relative;
      left: -8px;

      flex-grow: 1;
      width: calc(100% + 4px);
      padding-left: 8px;

      overflow-y: scroll;
    }

    .panel-list .title {
      font-size: 12px;
      line-height: 14.5px;
      font-weight: bolder;
      color: var(--affine-text-secondary-color);
      font-family: var(--affine-font-sans-family);
      padding-left: 16px;
      margin: 21px 0 9px 0;
    }

    .insert-indicator {
      height: 2px;
      border-radius: 1px;
      background-color: var(--affine-blue-affine-blue-600, #1e96eb);
      position: absolute;
      contain: layout size;
      width: 235px;
      left: 16px;
    }
  `;__decorate$2f([t$2()],TOCNotesPanel.prototype,"_dragging",void 0);__decorate$2f([t$2()],TOCNotesPanel.prototype,"_notes",void 0);__decorate$2f([t$2()],TOCNotesPanel.prototype,"_hiddenNotes",void 0);__decorate$2f([n$a({attribute:!1})],TOCNotesPanel.prototype,"page",void 0);__decorate$2f([n$a({attribute:!1})],TOCNotesPanel.prototype,"insertIndex",void 0);__decorate$2f([t$2()],TOCNotesPanel.prototype,"_selected",void 0);__decorate$2f([i$6(".panel-list")],TOCNotesPanel.prototype,"panelListElement",void 0);__decorate$2f([n$a({attribute:!1})],TOCNotesPanel.prototype,"host",void 0);__decorate$2f([n$a({attribute:!1})],TOCNotesPanel.prototype,"fitPadding",void 0);var __decorate$2e=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class LineWidthEvent extends Event{constructor(_,{detail:y,composed:w,bubbles:$}){super(_,{bubbles:$,composed:w}),this.detail=y}}let EdgelessLineWidthPanel=class extends WithDisposable(s$2){constructor(){super(...arguments),this.selectedSize=LineWidth.LINE_WIDTH_TWO,this.hasTooltip=!0,this._dragConfig=null,this._updateIconsColor=()=>{if(!this._dragHandle.offsetParent){requestAnimationFrame(()=>this._updateIconsColor());return}const _=this._dragHandle.getBoundingClientRect(),y=_.left+_.width/2,w=Array.from(this._lineWidthIcons),$=w.filter(R=>{const H=R.getBoundingClientRect();return H.left+H.width/2<y}),B=w.filter(R=>{const H=R.getBoundingClientRect();return H.left+H.width/2>y});$.forEach(R=>R.style.backgroundColor="var(--affine-icon-color)"),B.forEach(R=>R.style.backgroundColor="var(--affine-border-color)")},this._getDragHandlePosition=(_,y)=>{const w=_.clientX,{boundLeft:$,bottomLineWidth:B,stepWidth:R,containerWidth:H}=y;let j;w<=$?j=0:w-$>=H?j=100:j=Math.floor((w-$)/R);const X=(B-4)/100;return j*X},this._onPointerDown=_=>{_.preventDefault();const{left:y,width:w}=this._lineWidthPanel.getBoundingClientRect(),$=this._bottomLine.getBoundingClientRect().width;this._dragConfig={stepWidth:w/100,boundLeft:y,containerWidth:w,bottomLineWidth:$},this._onPointerMove(_)},this._onPointerMove=_=>{if(_.preventDefault(),!this._dragConfig)return;const y=this._getDragHandlePosition(_,this._dragConfig);this._dragHandle.style.left=`${y}%`,this._lineWidthOverlay.style.width=`${y}%`,this._updateIconsColor()},this._onPointerUp=_=>{if(_.preventDefault(),!this._dragConfig)return;const y=this._getDragHandlePosition(_,this._dragConfig);this._updateLineWidthPanelByDragHandlePosition(y),this._dragConfig=null},this._onPointerOut=_=>{if(_.preventDefault(),!this._dragConfig)return;const y=this._getDragHandlePosition(_,this._dragConfig);this._updateLineWidthPanelByDragHandlePosition(y),this._dragConfig=null}}_updateLineWidthPanel(_){if(!this._lineWidthOverlay)return;let y=0,w=0;switch(_){case LineWidth.LINE_WIDTH_TWO:y=0;break;case LineWidth.LINE_WIDTH_FOUR:y=16,w=1;break;case LineWidth.LINE_WIDTH_SIX:y=32,w=2;break;case LineWidth.LINE_WIDTH_EIGHT:y=48,w=3;break;case LineWidth.LINE_WIDTH_TEN:y=64,w=4;break;default:y=80,w=4}w+=4,this._lineWidthOverlay.style.width=`${y}%`,this._dragHandle.style.left=`${y}%`,this._dragHandle.style.transform=`translateY(-50%) translateX(${w}px)`,this._updateIconsColor()}_updateLineWidthPanelByDragHandlePosition(_){let y=this.selectedSize;_<=12?y=LineWidth.LINE_WIDTH_TWO:_>12&&_<=26?y=LineWidth.LINE_WIDTH_FOUR:_>26&&_<=40?y=LineWidth.LINE_WIDTH_SIX:_>40&&_<=54?y=LineWidth.LINE_WIDTH_EIGHT:_>54&&_<=68?y=LineWidth.LINE_WIDTH_TEN:y=LineWidth.LINE_WIDTH_TWELVE,this._updateLineWidthPanel(y),this._onSelect(y)}_onSelect(_){_!==this.selectedSize&&(this.dispatchEvent(new LineWidthEvent("select",{detail:_,composed:!0,bubbles:!0})),this.selectedSize=_)}firstUpdated(){this._updateLineWidthPanel(this.selectedSize),this._disposables.addFromEvent(this,"pointerdown",this._onPointerDown),this._disposables.addFromEvent(this,"pointermove",this._onPointerMove),this._disposables.addFromEvent(this,"pointerup",this._onPointerUp),this._disposables.addFromEvent(this,"pointerout",this._onPointerOut)}disconnectedCallback(){this._disposables.dispose()}render(){return x$1`<div
      class="line-width-panel has-tool-tip"
      @mousedown="${_=>_.preventDefault()}"
    >
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="line-width-button">
        <div class="line-width-icon"></div>
      </div>
      <div class="drag-handle"></div>
      <div class="bottom-line"></div>
      <div class="line-width-overlay"></div>
      ${this.hasTooltip?x$1`<tool-tip inert role="tooltip" tip-position="top" arrow>
            Thickness
          </tool-tip>`:A}
    </div>`}};EdgelessLineWidthPanel.styles=i$5`
    :host {
      display: flex;
      box-sizing: border-box;
      background: var(--affine-popover-background);
    }

    .line-width-panel {
      display: flex;
      flex-direction: row-reverse;
      align-items: center;
      justify-content: space-between;
      position: relative;
      width: 108px;
      margin: 4px 0;
      cursor: default;
    }

    .line-width-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      z-index: 2;
    }

    .line-width-icon {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background-color: var(--affine-border-color);
    }

    .line-width-button:nth-child(1) {
      margin-right: 0;
    }

    .line-width-button:nth-child(6) {
      margin-left: 0;
    }

    .drag-handle {
      position: absolute;
      left: 0;
      top: 50%;
      width: 8px;
      height: 8px;
      transform: translateY(-50%) translateX(4px);
      border-radius: 50%;
      background-color: var(--affine-icon-color);
      z-index: 3;
    }

    .bottom-line,
    .line-width-overlay {
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      height: 1px;
      background-color: var(--affine-border-color);
      position: absolute;
    }

    .bottom-line {
      width: calc(100% - 16px);
      background-color: var(--affine-border-color);
    }

    .line-width-overlay {
      width: 0;
      background-color: var(--affine-icon-color);
      z-index: 1;
    }

    ${tooltipStyle}

    tool-tip {
      z-index: 12;
      top: -8px;
    }
  `;__decorate$2e([n$a({attribute:!1})],EdgelessLineWidthPanel.prototype,"selectedSize",void 0);__decorate$2e([n$a({attribute:!1})],EdgelessLineWidthPanel.prototype,"hasTooltip",void 0);__decorate$2e([i$6(".line-width-panel.has-tool-tip")],EdgelessLineWidthPanel.prototype,"_lineWidthPanel",void 0);__decorate$2e([i$6(".line-width-overlay")],EdgelessLineWidthPanel.prototype,"_lineWidthOverlay",void 0);__decorate$2e([e$5(".line-width-icon")],EdgelessLineWidthPanel.prototype,"_lineWidthIcons",void 0);__decorate$2e([i$6(".bottom-line")],EdgelessLineWidthPanel.prototype,"_bottomLine",void 0);__decorate$2e([i$6(".drag-handle")],EdgelessLineWidthPanel.prototype,"_dragHandle",void 0);EdgelessLineWidthPanel=__decorate$2e([e$7("edgeless-line-width-panel")],EdgelessLineWidthPanel);var __decorate$2d=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function getMostCommonColor$1(k){const _=countBy(k,w=>w.color),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:GET_DEFAULT_LINE_COLOR()}function getMostCommonSize(k){const _=countBy(k,w=>w.lineWidth),y=maxBy(Object.entries(_),([w,$])=>$);return y?Number(y[0]):LineWidth.LINE_WIDTH_FOUR}let EdgelessChangeBrushButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.elements=[],this._popperShow=!1,this._selectedColor=null,this._selectedSize=LineWidth.LINE_WIDTH_FOUR,this._colorPanelPopper=null}_setLineWidth(_){this.page.captureSync(),this.elements.forEach(y=>{y.lineWidth!==_&&this.surface.updateElement(y.id,{lineWidth:_})})}_setBrushColor(_){this.page.captureSync(),this.elements.forEach(y=>{y.color!==_&&this.surface.updateElement(y.id,{color:_})}),_&&this._selectedColor!==_&&(this._selectedColor=_)}firstUpdated(_){const y=this._disposables;this._colorPanelPopper=createButtonPopper(this,this._colorPanel,({display:w})=>{this._popperShow=w==="show"}),y.add(this._colorPanelPopper),super.firstUpdated(_)}render(){this._selectedColor=getMostCommonColor$1(this.elements);const _={backgroundColor:`var(${this._selectedColor})`};return this._selectedSize=getMostCommonSize(this.elements),x$1`
      <edgeless-line-width-panel
        .selectedSize=${this._selectedSize}
        @select=${y=>this._setLineWidth(y.detail)}
      >
      </edgeless-line-width-panel>
      <menu-divider .vertical=${!0}></menu-divider>
      <edgeless-tool-icon-button
        .tooltip=${this._popperShow?"":"Color"}
        .active=${!1}
        .iconContainerPadding=${2}
        @click=${()=>this._colorPanelPopper?.toggle()}
      >
        <div class="brush-color-button">
          <div style=${o$4(_)}></div>
        </div>
      </edgeless-tool-icon-button>
      <div class="color-panel-container">
        <edgeless-color-panel
          .value=${this._selectedColor}
          @select=${y=>this._setBrushColor(y.detail)}
        >
        </edgeless-color-panel>
      </div>
    `}};EdgelessChangeBrushButton.styles=i$5`
    :host {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      color: var(--affine-text-primary-color);
      fill: currentColor;
    }

    menu-divider {
      height: 24px;
      margin: 0 5px;
    }

    .color-panel-container {
      display: none;
      justify-content: center;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
    }

    .color-panel-container[data-show] {
      display: flex;
    }

    .brush-size-button,
    .brush-color-button {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 24px;
      box-sizing: border-box;
      border-radius: 4px;
      cursor: pointer;
    }

    .brush-size-button div,
    .brush-color-button div {
      border-radius: 50%;
      background-color: var(--affine-icon-color);
    }

    .brush-color-button div {
      width: 16px;
      height: 16px;
    }
  `;__decorate$2d([n$a({attribute:!1})],EdgelessChangeBrushButton.prototype,"elements",void 0);__decorate$2d([n$a({attribute:!1})],EdgelessChangeBrushButton.prototype,"page",void 0);__decorate$2d([n$a({attribute:!1})],EdgelessChangeBrushButton.prototype,"surface",void 0);__decorate$2d([n$a({attribute:!1})],EdgelessChangeBrushButton.prototype,"slots",void 0);__decorate$2d([t$2()],EdgelessChangeBrushButton.prototype,"_popperShow",void 0);__decorate$2d([t$2()],EdgelessChangeBrushButton.prototype,"_selectedColor",void 0);__decorate$2d([t$2()],EdgelessChangeBrushButton.prototype,"_selectedSize",void 0);__decorate$2d([i$6(".color-panel-container")],EdgelessChangeBrushButton.prototype,"_colorPanel",void 0);EdgelessChangeBrushButton=__decorate$2d([e$7("edgeless-change-brush-button")],EdgelessChangeBrushButton);var __decorate$2c=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessMenuButton=class extends WithDisposable(s$2){firstUpdated(){this._menuPopper=createButtonPopper(this,this._panelWrapper),this._disposables.add(this._menuPopper)}render(){const{iconInfo:_}=this;return x$1`<edgeless-tool-icon-button
        .tooltip=${_.tooltip}
        .tipPosition=${"bottom"}
        @click=${()=>this._menuPopper.toggle()}
      >
        ${_.icon}
      </edgeless-tool-icon-button>
      <div class="edgeless-component-panel-wrapper">
        ${this.menuChildren}
      </div> `}};EdgelessMenuButton.styles=i$5`
    .edgeless-component-panel-wrapper {
      display: none;
      padding: 4px;
      justify-content: center;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
    }

    .edgeless-component-panel-wrapper[data-show] {
      display: flex;
    }
  `;__decorate$2c([n$a({attribute:!1})],EdgelessMenuButton.prototype,"iconInfo",void 0);__decorate$2c([n$a({attribute:!1})],EdgelessMenuButton.prototype,"menuChildren",void 0);__decorate$2c([i$6(".edgeless-component-panel-wrapper")],EdgelessMenuButton.prototype,"_panelWrapper",void 0);EdgelessMenuButton=__decorate$2c([e$7("edgeless-menu-button")],EdgelessMenuButton);var __decorate$2b=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function getMostCommonColor(k){const _=countBy(k,w=>w.stroke),y=maxBy(Object.entries(_),([w,$])=>$);return y?y[0]:GET_DEFAULT_LINE_COLOR()}function getMostCommonMode(k){const _=countBy(k,w=>w.mode),y=maxBy(Object.entries(_),([w,$])=>$);return y?Number(y[0]):null}function getMostCommonLineWidth(k){const _=countBy(k,w=>w.strokeWidth),y=maxBy(Object.entries(_),([w,$])=>$);return y?Number(y[0]):LineWidth.LINE_WIDTH_FOUR}let EdgelessChangeConnectorButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.elements=[]}_setConnectorMode(_){this.page.captureSync(),this.elements.forEach(y=>{y.mode!==_&&this.surface.updateElement(y.id,{mode:_})})}_setConnectorRough(_){this.page.captureSync(),this.elements.forEach(y=>{y.rough!==_&&this.surface.updateElement(y.id,{rough:_})})}_setConnectorColor(_){this.page.captureSync();let y=!1;this.elements.forEach(w=>{w.stroke!==_&&(y=!0,this.surface.updateElement(w.id,{stroke:_}))}),y&&this.requestUpdate()}_setConnectorStrokeWidth(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{strokeWidth:_})})}_setConnectorStrokeStyle(_){this.elements.forEach(y=>{this.surface.updateElement(y.id,{strokeStyle:_})})}render(){const _=getMostCommonColor(this.elements),y=getMostCommonMode(this.elements),w=getMostCommonLineWidth(this.elements)??LineWidth.LINE_WIDTH_FOUR;return x$1`
      <edgeless-menu-button
        class="connector-color-button"
        .iconInfo=${{icon:x$1`${ColorUnit(_)}`,tooltip:"Color"}}
        .menuChildren=${x$1` <edgeless-color-panel
          .value=${_}
          @select=${$=>this._setConnectorColor($.detail)}
        >
        </edgeless-color-panel>`}
      ></edgeless-menu-button>

      <menu-divider .vertical=${!0}></menu-divider>

      <edgeless-menu-button
        class="line-styles-button"
        .iconInfo=${{icon:x$1`${LineStyleIcon}${SmallArrowDownIcon}`,tooltip:"Border style"}}
        .menuChildren=${x$1`
          <edgeless-line-width-panel
            .selectedSize=${w}
            @select=${$=>{this._setConnectorStrokeWidth($.detail)}}
          ></edgeless-line-width-panel>
          <edgeless-tool-icon-button
            class=${`edgeless-component-line-style-button-${StrokeStyle.Solid}`}
            .tooltip=${"Solid"}
            @click=${()=>this._setConnectorStrokeStyle(StrokeStyle.Solid)}
          >
            ${StraightLineIcon}
          </edgeless-tool-icon-button>
          <edgeless-tool-icon-button
            class=${`edgeless-component-line-style-button-${StrokeStyle.Dashed}`}
            .tooltip=${"Dash"}
            @click=${()=>this._setConnectorStrokeStyle(StrokeStyle.Dashed)}
          >
            ${DashLineIcon}
          </edgeless-tool-icon-button>
        `}
      >
      </edgeless-menu-button>

      <menu-divider .vertical=${!0}></menu-divider>

      <edgeless-menu-button
        .iconInfo=${{icon:x$1`${RoughIcon}${SmallArrowDownIcon}`,tooltip:"Style"}}
        .menuChildren=${x$1`
          <edgeless-tool-icon-button
            .tooltip=${"General"}
            @click=${()=>this._setConnectorRough(!1)}
          >
            ${GeneralStyleIcon}
          </edgeless-tool-icon-button>
          <edgeless-tool-icon-button
            .tooltip=${"Scribbled"}
            @click=${()=>this._setConnectorRough(!0)}
          >
            ${ScribbledStyleIcon}
          </edgeless-tool-icon-button>
        `}
      >
      </edgeless-menu-button>

      <menu-divider .vertical=${!0}></menu-divider>

      <edgeless-menu-button
        .iconInfo=${{icon:x$1`${y===ConnectorMode.Straight?ConnectorLIcon:ConnectorXIcon}${SmallArrowDownIcon}`,tooltip:"Connector Shape"}}
        .menuChildren=${x$1`
          <edgeless-tool-icon-button
            .tooltip=${"Straight"}
            @click=${()=>this._setConnectorMode(ConnectorMode.Straight)}
          >
            ${ConnectorLIcon}
          </edgeless-tool-icon-button>
          <edgeless-tool-icon-button
            .tooltip=${"Elbowed"}
            @click=${()=>this._setConnectorMode(ConnectorMode.Orthogonal)}
          >
            ${ConnectorXIcon}
          </edgeless-tool-icon-button>
        `}
      >
      </edgeless-menu-button>
    `}};EdgelessChangeConnectorButton.styles=[i$5`
      :host {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        color: var(--affine-text-primary-color);
        fill: currentColor;
      }

      menu-divider {
        height: 24px;
      }
    `];__decorate$2b([n$a({attribute:!1})],EdgelessChangeConnectorButton.prototype,"edgeless",void 0);__decorate$2b([n$a({attribute:!1})],EdgelessChangeConnectorButton.prototype,"elements",void 0);__decorate$2b([n$a({attribute:!1})],EdgelessChangeConnectorButton.prototype,"page",void 0);__decorate$2b([n$a({attribute:!1})],EdgelessChangeConnectorButton.prototype,"surface",void 0);EdgelessChangeConnectorButton=__decorate$2b([e$7("edgeless-change-connector-button")],EdgelessChangeConnectorButton);var __decorate$2a=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessOneRowColorPanel=class extends EdgelessColorPanel{};EdgelessOneRowColorPanel.styles=i$5`
    :host {
      display: flex;
      width: 442px;
      padding: 0 2px;
      gap: 18px;
      box-sizing: border-box;
      background: var(--affine-popover-background);
    }

    ${colorContainerStyles}
  `;EdgelessOneRowColorPanel=__decorate$2a([e$7("edgeless-one-row-color-panel")],EdgelessOneRowColorPanel);var __decorate$29=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessShapeMenu=class extends WithDisposable(s$2){constructor(){super(...arguments),this._setShapeType=_=>{if(this.edgelessTool.type!=="shape")return;const{fillColor:y,strokeColor:w,shapeStyle:$}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"shape",shape:_,fillColor:y,strokeColor:w,shapeStyle:$})},this._setStrokeColor=_=>{if(this.edgelessTool.type!=="shape")return;const{shape:y,shapeStyle:w}=this.edgelessTool;let{fillColor:$}=this.edgelessTool;w===ShapeStyle.General&&($=_.replace(LINE_COLOR_PREFIX,SHAPE_COLOR_PREFIX)),this.edgeless.slots.edgelessToolUpdated.emit({type:"shape",shape:y,fillColor:$,strokeColor:_,shapeStyle:w})},this._setShapeStyle=_=>{if(this.edgelessTool.type!=="shape")return;const{shape:y,strokeColor:w}=this.edgelessTool;let{fillColor:$}=this.edgelessTool;_===ShapeStyle.General?$=w.replace(LINE_COLOR_PREFIX,SHAPE_COLOR_PREFIX):$=DEFAULT_SHAPE_FILL_COLOR,this.edgeless.slots.edgelessToolUpdated.emit({type:"shape",shape:y,fillColor:$,strokeColor:w,shapeStyle:_})}}render(){if(this.edgelessTool.type!=="shape")return A;const{shape:_,strokeColor:y,shapeStyle:w}=this.edgelessTool;return x$1`
      <div class="shape-menu-container">
        <edgeless-slide-menu .menuWidth=${SHAPE_SUBMENU_WIDTH}>
          <div class="menu-content">
            <div class="shape-style-container">
              <edgeless-tool-icon-button
                .tooltip=${"General"}
                .tipPosition=${"top-end"}
                .iconContainerPadding=${2}
                .active=${w===ShapeStyle.General}
                .activeMode=${"background"}
                @click=${()=>{this._setShapeStyle(ShapeStyle.General)}}
              >
                ${GeneralShapeStyleIcon}
              </edgeless-tool-icon-button>
              <edgeless-tool-icon-button
                .tooltip=${"Scribbled"}
                .iconContainerPadding=${2}
                .active=${w===ShapeStyle.Scribbled}
                .activeMode=${"background"}
                @click=${()=>{this._setShapeStyle(ShapeStyle.Scribbled)}}
              >
                ${ScribbledShapeStyleIcon}
              </edgeless-tool-icon-button>
            </div>
            <menu-divider .vertical=${!0}></menu-divider>
            <div class="shape-type-container">
              ${ShapeComponentConfig.map(({name:$,generalIcon:B,scribbledIcon:R,tooltip:H})=>x$1`
                    <edgeless-tool-icon-button
                      .tooltip=${H}
                      .active=${_===$}
                      .activeMode=${"background"}
                      .iconContainerPadding=${2}
                      @click=${()=>{this._setShapeType($)}}
                    >
                      ${w===ShapeStyle.General?B:R}
                    </edgeless-tool-icon-button>
                  `)}
            </div>
            <menu-divider .vertical=${!0}></menu-divider>
            <edgeless-one-row-color-panel
              .value=${y}
              @select=${$=>this._setStrokeColor($.detail)}
            ></edgeless-one-row-color-panel>
          </div>
        </edgeless-slide-menu>
      </div>
    `}};EdgelessShapeMenu.styles=i$5`
    :host {
      display: flex;
      position: absolute;
      z-index: -1;
    }
    .shape-menu-container {
      display: flex;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px 8px 0 0;
      border: 1px solid var(--affine-border-color);
      position: relative;
      cursor: default;
    }
    .menu-content {
      display: flex;
      align-items: center;
    }
    .shape-type-container,
    .shape-style-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
    }
    .shape-type-container svg,
    .shape-style-container svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }
    menu-divider {
      height: 24px;
      margin: 0 9px;
    }
  `;__decorate$29([n$a({attribute:!1})],EdgelessShapeMenu.prototype,"edgelessTool",void 0);__decorate$29([n$a({attribute:!1})],EdgelessShapeMenu.prototype,"edgeless",void 0);EdgelessShapeMenu=__decorate$29([e$7("edgeless-shape-menu")],EdgelessShapeMenu);var __decorate$28=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessChangeNoteButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.notes=[],this._popperShow=!1,this._colorSelectorPopper=null}_renderSelectedColor(_){const y={backgroundColor:`var(${_})`};return x$1`<div class="selected-background" style=${o$4(y)}>
      A
    </div>`}_setBlockBackground(_){this.notes.forEach(y=>{this.page.updateBlock(y,{background:_})})}_setNoteHidden(_,y){this.page.updateBlock(_,{hidden:y});const w=this.page.getParent(_);assertExists(w);const $=w.children.filter(R=>matchFlavours(R,["affine:note"])),B=$[$.length-1];!y&&_!==B&&this.page.moveBlocks([_],w,B,!1),this.requestUpdate()}updated(_){const y=this._disposables;this._colorSelector&&(this._colorSelectorPopper=createButtonPopper(this._colorSelectorButton,this._colorSelector,({display:w})=>{this._popperShow=w==="show"}),y.add(this._colorSelectorPopper)),super.updated(_)}render(){if(this.notes.length!==1)return A;const _=this.notes[0],y=this.page.getParent(_);assertExists(y);const w=y.children.filter(H=>matchFlavours(H,["affine:note"])&&!H.hidden),$=_.background,B=w.indexOf(_)+1,R=this.page.awarenessStore.getFlag("enable_note_index");return _.hidden?x$1`
        ${R?x$1`<div class="note-status hidden">
              <span>${HiddenIcon}</span>
            </div>`:A}
        <div
          @click=${()=>this._setNoteHidden(_,!_.hidden)}
          class="note-status-button hidden"
        >
          <span class="unhover"><span>Hidden on page mode</span></span>
          <span class="hover">${NoteIcon}<span>Show on page</span></span>
        </div>
      `:x$1`
        ${R?x$1`<div class="note-status">
              <span>${B}</span>
            </div>`:A}
        <div
          @click=${()=>this._setNoteHidden(_,!_.hidden)}
          class="note-status-button unhover"
        >
          <span class="unhover">${NoteIcon}<span>On page</span></span>
          <span class="hover">${HiddenIcon}<span>Hidden</span></span>
        </div>
        <edgeless-tool-icon-button
          .tooltip=${this._popperShow?"":"Color"}
          .active=${!1}
          @click=${()=>this._colorSelectorPopper?.toggle()}
        >
          ${this._renderSelectedColor($)}
        </edgeless-tool-icon-button>
        <edgeless-color-panel
          .value=${$}
          .options=${NOTE_COLORS$1}
          .showLetterMark=${!0}
          @select=${H=>{this._setBlockBackground(H.detail)}}
        ></edgeless-color-panel>
      `}};EdgelessChangeNoteButton.styles=i$5`
    :host {
      display: flex;
      color: var(--affine-text-primary-color);
      fill: currentColor;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    edgeless-color-panel {
      display: none;
      width: 108px;
      height: 68px;
      padding: 8px 12px;
      flex-wrap: wrap;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
    }

    edgeless-color-panel[data-show] {
      display: flex;
    }

    .selected-background {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 20px;
      height: 20px;
      box-sizing: border-box;
      border-radius: 50%;
      color: var(--affine-text-primary-color);
      font-size: 12px;
    }

    .note-status {
      display: flex;
      align-items: center;
      text-align: center;
      justify-content: center;
      gap: 10px;
      width: 24px;
      height: 24px;
      background: var(--affine-blue-600);
      border-radius: 4px;
      color: var(--affine-white);
      font-size: 12px;
      font-family: Avenir Next;
      font-weight: 600;
      line-height: 16px;
    }

    .note-status > span {
      display: flex;
      padding: 4px 6px;
      width: 24px;
      flex-direction: column;
    }

    .note-status.hidden > span {
      display: flex;
      padding: 4px;
    }

    .note-status-button {
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--affine-text-secondary-color);
      width: 74px;
      height: 24px;
      padding: 4px 8px;
    }

    .note-status-button.hidden {
      width: 126px;
    }

    .note-status-button:hover {
      background: var(--affine-hover-color);
      border-radius: 8px;
    }

    .note-status-button .hover {
      display: none;
    }
    .note-status-button:hover .hover {
      display: flex;
    }
    .note-status-button:hover .unhover {
      display: none;
    }

    .note-status-button svg {
      width: 20px;
      height: 20px;
    }

    .note-status-button > span {
      font-size: 12px;
      font-family: Avenir Next;
      font-style: normal;
      font-weight: 600;
      line-height: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2px;
    }
  `;__decorate$28([n$a({attribute:!1})],EdgelessChangeNoteButton.prototype,"notes",void 0);__decorate$28([n$a({attribute:!1})],EdgelessChangeNoteButton.prototype,"page",void 0);__decorate$28([n$a({attribute:!1})],EdgelessChangeNoteButton.prototype,"slots",void 0);__decorate$28([t$2()],EdgelessChangeNoteButton.prototype,"_popperShow",void 0);__decorate$28([i$6("edgeless-tool-icon-button")],EdgelessChangeNoteButton.prototype,"_colorSelectorButton",void 0);__decorate$28([i$6("edgeless-color-panel")],EdgelessChangeNoteButton.prototype,"_colorSelector",void 0);EdgelessChangeNoteButton=__decorate$28([e$7("edgeless-change-note-button")],EdgelessChangeNoteButton);var __decorate$27=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessAlignPanel=class extends s$2{constructor(){super(...arguments),this.value="left"}_onSelect(_){this.value=_,this.onSelect&&this.onSelect(_)}render(){return x$1`
      <div class="align-panel-container">
        <edgeless-tool-icon-button
          .tooltip=${"Left"}
          .active=${this.value==="left"}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect("left")}}
        >
          ${TextAlignLeftIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          .tooltip=${"Center"}
          .active=${this.value==="center"}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect("center")}}
        >
          ${TextAlignCenterIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          .tooltip=${"Right"}
          .active=${this.value==="right"}
          .activeMode=${"background"}
          .iconContainerPadding=${2}
          @click=${()=>{this._onSelect("right")}}
        >
          ${TextAlignRightIcon}
        </edgeless-tool-icon-button>
      </div>
    `}};EdgelessAlignPanel.styles=i$5`
    :host {
      display: block;
      z-index: 2;
    }
    .align-panel-container {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--affine-background-overlay-panel-color);
      border-radius: 8px;
      padding: 8px;
      gap: 8px;
    }
    .align-panel-container svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }
  `;__decorate$27([n$a({attribute:!1})],EdgelessAlignPanel.prototype,"value",void 0);__decorate$27([n$a({attribute:!1})],EdgelessAlignPanel.prototype,"onSelect",void 0);EdgelessAlignPanel=__decorate$27([e$7("edgeless-align-panel")],EdgelessAlignPanel);var __decorate$26=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessChangeTextButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.texts=[]}render(){return x$1`<div class="change-text-container">
      <edgeless-change-text-menu
        .elements=${this.texts}
        .elementType=${"text"}
        .surface=${this.surface}
        .slots=${this.slots}
      ></edgeless-change-text-menu>
    </div>`}};EdgelessChangeTextButton.styles=i$5`
    :host {
      display: flex;
    }

    .change-text-container {
      display: flex;
    }
  `;__decorate$26([n$a({attribute:!1})],EdgelessChangeTextButton.prototype,"texts",void 0);__decorate$26([n$a({attribute:!1})],EdgelessChangeTextButton.prototype,"page",void 0);__decorate$26([n$a({attribute:!1})],EdgelessChangeTextButton.prototype,"surface",void 0);__decorate$26([n$a({attribute:!1})],EdgelessChangeTextButton.prototype,"slots",void 0);EdgelessChangeTextButton=__decorate$26([e$7("edgeless-change-text-button")],EdgelessChangeTextButton);var __decorate$25=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessAddFrameButton=class extends WithDisposable(s$2){render(){return x$1`<edgeless-tool-icon-button
      .iconContainerPadding=${2}
      @click=${()=>{this.edgeless.frame.createFrameOnSelected()}}
    >
      ${AddFrameButtonIcon}
    </edgeless-tool-icon-button>`}};__decorate$25([n$a({attribute:!1})],EdgelessAddFrameButton.prototype,"edgeless",void 0);EdgelessAddFrameButton=__decorate$25([e$7("edgeless-add-frame-button")],EdgelessAddFrameButton);var __decorate$24=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const ACTIONS=[{icon:FrameIcon,name:"Frame Section",type:"create-frame"},{type:"divider"},{icon:BringToFrontIcon,name:"Bring to front",type:"front"},{icon:BringForwardIcon,name:"Bring forward",type:"forward"},{icon:SendBackwardIcon,name:"Send backward",type:"backward"},{icon:SendToBackIcon,name:"Send to back",type:"back"},{type:"divider"},{icon:MoreCopyIcon,name:"Copy",type:"copy"},{icon:CopyAsPngIcon,name:"Copy as PNG",type:"copy-as-png"},{icon:MoreDuplicateIcon,name:"Duplicate",type:"duplicate"},{type:"divider"},{icon:MoreDeleteIcon,name:"Delete",type:"delete"}],FRAME_ACTIONS=[{icon:FrameIcon,name:"Frame Section",type:"create-frame"},{type:"divider"},{icon:MoreCopyIcon,name:"Copy",type:"copy"},{icon:CopyAsPngIcon,name:"Copy as PNG",type:"copy-as-png"},{icon:MoreDuplicateIcon,name:"Duplicate",type:"duplicate"},{type:"divider"},{icon:MoreDeleteIcon,name:"Delete",type:"delete"}];function Actions(k,_){return c$1(k,y=>y.type,y=>y.type==="divider"?x$1`<menu-divider></menu-divider>`:x$1`<div
            class="action-item ${y.type}"
            @click=${()=>_(y)}
            ?data-disabled=${y.disabled}
          >
            ${y.icon}${y.name}
          </div>`)}let EdgelessMoreButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.elements=[],this.vertical=!1,this._popperShow=!1,this._actionsMenuPopper=null,this._runAction=async({type:_})=>{const y=this.edgeless.selectionManager;switch(_){case"copy":{this.edgeless.clipboard.copy();break}case"duplicate":{await duplicate(this.edgeless,y.elements);break}case"delete":{this._delete();break}case"copy-as-png":{const{notes:w,shapes:$}=this._splitElements();this.slots.copyAsPng.emit({notes:w,shapes:$});break}case"create-frame":{this.edgeless.frame.createFrameOnSelected();break}case"front":case"forward":case"backward":case"back":{const{notes:w,shapes:$}=this._splitElements();w.length&&this.slots.reorderingNotesUpdated.emit({elements:w,type:_}),$.length&&this.slots.reorderingShapesUpdated.emit({elements:$,type:_});break}}this._actionsMenuPopper?.hide()}}get page(){return this.edgeless.page}get selection(){return this.edgeless.selectionManager}get slots(){return this.edgeless.slots}get surface(){return this.edgeless.surface}_splitElements(){const{notes:_,shapes:y}=groupBy$1(this.selection.elements,w=>isTopLevelBlock(w)?"notes":"shapes");return{notes:_??[],shapes:y??[]}}_delete(){this.page.captureSync(),deleteElements(this.edgeless,this.selection.elements),this.selection.setSelection({elements:[],editing:!1})}firstUpdated(_){const y=this._disposables;this._actionsMenuPopper=createButtonPopper(this,this._actionsMenu,({display:w})=>{this._popperShow=w==="show"}),y.add(this._actionsMenuPopper),super.firstUpdated(_)}render(){const _=this.edgeless.selectionManager,y=Actions(_.elements.some(w=>w instanceof FrameElement)?FRAME_ACTIONS:ACTIONS,this._runAction);return x$1`
      <edgeless-tool-icon-button
        .tooltip=${this._popperShow?"":"More"}
        .active=${!1}
        .iconContainerPadding=${2}
        @click=${()=>this._actionsMenuPopper?.toggle()}
      >
        ${this.vertical?MoreVerticalIcon:MoreHorizontalIcon}
      </edgeless-tool-icon-button>
      <div class="more-actions-container">${y}</div>
    `}};EdgelessMoreButton.styles=i$5`
    :host {
      display: block;
      color: var(--affine-text-primary-color);
      fill: currentColor;
      font-family: var(--affine-font-family);
    }

    .more-actions-container {
      display: none;
      width: 164px;
      padding: 8px;
      justify-content: center;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
      font-size: 16px;
      line-height: 22px;
    }

    .more-actions-container[data-show] {
      display: block;
    }

    .action-item {
      display: flex;
      white-space: nowrap;
      height: 32px;
      box-sizing: border-box;
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
      align-items: center;
      gap: 8px;
    }

    menu-divider {
      width: 88%;
      position: relative;
      left: 8px;
    }

    .action-item:hover {
      background-color: var(--affine-hover-color);
    }
    .action-item:hover.delete {
      background-color: var(--affine-background-error-color);
      color: var(--affine-error-color);
    }

    .action-item[data-disabled] {
      cursor: not-allowed;
    }
  `;__decorate$24([n$a({attribute:!1})],EdgelessMoreButton.prototype,"elements",void 0);__decorate$24([n$a({attribute:!1})],EdgelessMoreButton.prototype,"edgeless",void 0);__decorate$24([n$a({attribute:!1})],EdgelessMoreButton.prototype,"vertical",void 0);__decorate$24([t$2()],EdgelessMoreButton.prototype,"_popperShow",void 0);__decorate$24([i$6(".more-actions-container")],EdgelessMoreButton.prototype,"_actionsMenu",void 0);EdgelessMoreButton=__decorate$24([e$7("edgeless-more-button")],EdgelessMoreButton);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*o(k,_){const y=typeof _=="function";if(k!==void 0){let w=-1;for(const $ of k)w>-1&&(yield y?_(w):_),w++,yield $}}class VirgoInput{constructor(_){this.yDoc=new Doc,this._active=!0,this.type="default",this.maxLength=1/0;const{yText:y=this.yDoc.getText(VirgoInput.Y_TEXT_NAME),maxLength:w,type:$}=_,B=y.toString();if(w&&(this.maxLength=w,B.length>w))throw new Error("The text exceeds the limit length.");if($&&(this.type=$),y instanceof YText)if(y.doc)this.yText=y,this.yDoc=y.doc;else throw new Error("Y.Text should be bind to Y.Doc.");else this.yText=this.yDoc.getText(VirgoInput.Y_TEXT_NAME),this.yText.insert(0,B);this.undoManager=new UndoManager(this.yText,{trackedOrigins:new Set([this.yDoc.clientID])}),this.undoManager.on("stack-item-added",R=>{const H=this.vEditor.getVRange();R.stackItem.meta.set("v-range",H)}),this.undoManager.on("stack-item-popped",R=>{const H=R.stackItem.meta.get("v-range");H&&this.vEditor.setVRange(H)}),this.vEditor=new VEditor(this.yText,{hooks:{beforeinput:R=>{const{vRange:H}=R;let j=this.vEditor.yTextString;return H.length>0&&(j=`${j.substring(0,H.index)}${j.substring(H.index+H.length)}`),`${j.substring(0,H.index)}${R.data??""}${j.substring(H.index)}`.length>=this.maxLength?null:(this.undoManager.stopCapturing(),R)},compositionEnd:R=>{const{vRange:H}=R;let j=this.vEditor.yText.toString();H.length>0&&(j=`${j.substring(0,H.index)}${j.substring(H.index+H.length)}`);const q=`${j.substring(0,H.index)}${R.data}${j.substring(H.index)}`;let X=!0;return q.length>=this.maxLength&&(R.data="",X=!1),X&&this.undoManager.stopCapturing(),R}}})}mount(_){this.vEditor.disposables.addFromEvent(_,"paste",y=>{y.stopPropagation();const w=y.clipboardData?.getData("text/plain")?.replace(/(\r\n|\r|\n)/g,`
`);if(!w)return;const $=this.vEditor.getVRange();if($){$.length>0&&this.vEditor.yText.delete($.index,$.length);const B=this.vEditor.yText.length,R=this.maxLength-B;if(R<=0)return;const H=w.length>R?w.slice(0,R):w;this.vEditor.insertText($,H),this.vEditor.setVRange({index:$.index+H.length,length:0}),this.undoManager.stopCapturing()}}),this.vEditor.disposables.addFromEvent(_,"keydown",y=>{y instanceof KeyboardEvent&&(y.ctrlKey||y.metaKey)&&(y.key==="z"||y.key==="Z")&&(y.preventDefault(),y.shiftKey?this.redo():this.undo())}),this.vEditor.disposables.addFromEvent(_,"blur",()=>{if(this.type==="number"){const y=this.yText.toString(),w=parseFloat(y),$=isNaN(w)?"":w.toString();y!==$&&(this.setActive(!1),this.setValue($),requestAnimationFrame(()=>{this.setActive(!0)}))}}),this.vEditor.mount(_)}unmount(){this.vEditor.unmount()}get value(){return this.yText.toString()}get active(){return this._active}setActive(_){this._active=_}setValue(_){if(_.length>this.maxLength)throw new Error("The text exceeds the limit length.");this.yText.delete(0,this.yText.length),this.yText.insert(0,_),this.vEditor.setVRange({index:_.length,length:0}),this.undoManager.stopCapturing()}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}}VirgoInput.Y_TEXT_NAME="Y_TEXT_NAME";var __decorate$23=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessFrameTitleEditor=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._vInput=null,this._frame=null,this._edgeless=null}get vEditor(){return assertExists(this._vInput),this._vInput.vEditor}mount(_,y){this._frame=_,this._edgeless=y,this._vInput=new VirgoInput({yText:this._frame.title}),this.requestUpdate(),requestAnimationFrame(()=>{assertExists(this._vInput),assertExists(this._frame),this._vInput.mount(this._virgoContainer),this._edgeless?.surface.updateElementLocalRecord(this._frame.id,{titleHide:!0});const w=this._edgeless?.dispatcher;assertExists(w),this.disposables.addFromEvent(this._virgoContainer,"blur",()=>{this._unmount()}),this.disposables.add(w.add("click",()=>!0)),this.disposables.add(w.add("doubleClick",()=>!0)),this.disposables.add(w.add("keyDown",$=>$.get("keyboardState").raw.key==="Enter"?(this._unmount(),!0):(requestAnimationFrame(()=>{this.requestUpdate()}),!1))),this._disposables.add(y.slots.viewportUpdated.on(()=>{this.requestUpdate()}))})}_unmount(){this._vInput?.unmount(),this._disposables.dispose(),assertExists(this._frame),this._edgeless?.surface.updateElementLocalRecord(this._frame.id,{titleHide:!1}),this.remove(),assertExists(this._edgeless),this._edgeless.selectionManager.setSelection({elements:[],editing:!1}),this._frame=null}render(){const _=this._edgeless?.surface.viewport;let y=o$4({});if(_&&this._frame&&this._edgeless){const w=this._frame.padding,$=_.zoom,B=this._frame.gridBound,R=this._frame.radius,[H,j]=_.toViewCoord(B.x,B.y);y=o$4({position:"absolute",left:H+"px",top:j+"px",minWidth:"8px",borderRadius:R+"px",fontSize:"16px",fontFamily:"sans-serif",color:"white",background:this._frame.color,outline:"none",padding:`${w[1]*$}px ${w[0]*$}px`,lineHeight:"initial",zIndex:"1"})}return x$1`<div style=${y} class="virgo-container"></div>`}};__decorate$23([i$6(".virgo-container")],EdgelessFrameTitleEditor.prototype,"_virgoContainer",void 0);EdgelessFrameTitleEditor=__decorate$23([e$7("edgeless-frame-title-editor")],EdgelessFrameTitleEditor);const COLOR_VARIABLES=["--affine-brand-color","--affine-primary-color","--affine-secondary-color","--affine-tertiary-color","--affine-hover-color","--affine-icon-color","--affine-icon-secondary","--affine-border-color","--affine-divider-color","--affine-placeholder-color","--affine-quote-color","--affine-link-color","--affine-edgeless-grid-color","--affine-success-color","--affine-warning-color","--affine-error-color","--affine-processing-color","--affine-text-emphasis-color","--affine-text-primary-color","--affine-text-secondary-color","--affine-text-disable-color","--affine-black-10","--affine-black-30","--affine-black-50","--affine-black-60","--affine-black-80","--affine-black-90","--affine-black","--affine-white-10","--affine-white-30","--affine-white-50","--affine-white-60","--affine-white-80","--affine-white-90","--affine-white","--affine-background-code-block","--affine-background-tertiary-color","--affine-background-processing-color","--affine-background-error-color","--affine-background-warning-color","--affine-background-success-color","--affine-background-primary-color","--affine-background-secondary-color","--affine-background-modal-color","--affine-background-overlay-panel-color","--affine-tag-blue","--affine-tag-green","--affine-tag-teal","--affine-tag-white","--affine-tag-purple","--affine-tag-red","--affine-tag-pink","--affine-tag-yellow","--affine-tag-orange","--affine-tag-gray","--affine-palette-line-yellow","--affine-palette-line-orange","--affine-palette-line-tangerine","--affine-palette-line-red","--affine-palette-line-magenta","--affine-palette-line-purple","--affine-palette-line-navy","--affine-palette-line-blue","--affine-palette-line-green","--affine-palette-line-white","--affine-palette-line-black","--affine-palette-line-grey","--affine-palette-shape-yellow","--affine-palette-shape-orange","--affine-palette-shape-tangerine","--affine-palette-shape-red","--affine-palette-shape-magenta","--affine-palette-shape-purple","--affine-palette-shape-navy","--affine-palette-shape-blue","--affine-palette-shape-green","--affine-palette-shape-white","--affine-palette-shape-black","--affine-palette-shape-grey","--affine-tooltip"],SIZE_VARIABLES=["--affine-font-h-1","--affine-font-h-2","--affine-font-h-3","--affine-font-h-4","--affine-font-h-5","--affine-font-h-6","--affine-font-base","--affine-font-sm","--affine-font-xs","--affine-line-height","--affine-z-index-modal","--affine-z-index-popover"],FONT_FAMILY_VARIABLES=["--affine-font-family","--affine-font-number-family","--affine-font-code-family"],VARIABLES=["--affine-editor-width","--affine-theme-mode","--affine-editor-mode","--affine-palette-transparent","--affine-popover-shadow","--affine-menu-shadow","--affine-float-button-shadow","--affine-shadow-1","--affine-shadow-2","--affine-shadow-3","--affine-paragraph-space","--affine-popover-radius","--affine-zoom","--affine-scale",...SIZE_VARIABLES,...COLOR_VARIABLES,...FONT_FAMILY_VARIABLES];function isCssVariable(k){return VARIABLES.includes(k)}var __decorate$22=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessShapeTextEditor=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._vInput=null,this._element=null,this._edgeless=null,this._keeping=!1,this._resizeObserver=null}get vEditor(){return assertExists(this._vInput),this._vInput.vEditor}setKeeping(_){this._keeping=_}_updateHeight(){const _=this._edgeless,y=this._element;if(_&&y){const w=this._virgoContainer.getBoundingClientRect().height/_.surface.viewport.zoom;w>y.h&&(_.surface.updateElement(y.id,{xywh:new Bound(y.x,y.y,y.w,w).serialize()}),this._virgoContainer.style.minHeight=`${w}px`),_.selectionManager.setSelection({elements:[y.id],editing:!0})}}mount(_,y){if(_.text)this._element=_;else{const w=new YText;y.surface.updateElement(_.id,{text:w,color:GET_DEFAULT_LINE_COLOR()});const $=y.surface.pickById(_.id);if($ instanceof ShapeElement&&$.text)this._element=$;else throw new Error("Failed to mount shape editor because of no text or element type mismatch.")}this._edgeless=y,assertExists(this._element),assertExists(this._element.text,"Failed to mount shape editor because of no text."),this._vInput=new VirgoInput({yText:this._element.text}),this._vInput.vEditor.slots.updated.on(()=>{this._updateHeight()}),this.disposables.add(y.slots.viewportUpdated.on(()=>{this.requestUpdate(),requestAnimationFrame(()=>{this._updateHeight()})})),this.requestUpdate(),requestAnimationFrame(()=>{assertExists(this._element),this._edgeless?.surface.updateElementLocalRecord(this._element.id,{textDisplay:!1}),assertExists(this._vInput),this._vInput.mount(this._virgoContainer);const w=this._edgeless?.dispatcher;assertExists(w),this._disposables.addFromEvent(this._virgoContainer,"blur",()=>{this._keeping||this._unmount()}),this._disposables.add(w.add("click",()=>!0)),this._disposables.add(w.add("doubleClick",()=>!0))})}_unmount(){this._resizeObserver?.disconnect(),this._resizeObserver=null,this._vInput?.unmount(),assertExists(this._element),this._edgeless?.surface.updateElementLocalRecord(this._element.id,{textDisplay:!0}),this.remove(),assertExists(this._edgeless),this._edgeless.selectionManager.setSelection({elements:[],editing:!1})}render(){const _=this._edgeless?.surface.viewport;let y=o$4({});if(_&&this._element&&this._edgeless){const w=_.zoom,$=getSelectedRect([this._element]),[B,R]=this._edgeless.surface.toViewCoord($.left,$.top);y=o$4({position:"absolute",left:B+"px",top:R+"px",width:$.width+"px",minHeight:$.height+"px",fontSize:this._element.fontSize+"px",fontFamily:this._element.fontFamily,lineHeight:"initial",outline:"none",transform:`scale(${w}, ${w})`,transformOrigin:"top left",color:isCssVariable(this._element.color)?`var(${this._element.color})`:this._element.color,padding:SHAPE_TEXT_PADDING+"px",textAlign:this._element.textAlign,display:"grid",gridTemplateColumns:"100%",alignItems:this._element.textVerticalAlign==="center"?"center":this._element.textVerticalAlign==="bottom"?"end":"start",alignContent:"center",gap:"0",zIndex:"1"})}return x$1`<div style=${y} class="virgo-container"></div>`}};__decorate$22([i$6(".virgo-container")],EdgelessShapeTextEditor.prototype,"_virgoContainer",void 0);EdgelessShapeTextEditor=__decorate$22([e$7("edgeless-shape-text-editor")],EdgelessShapeTextEditor);var __decorate$21=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessTextEditor=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._vInput=null,this._element=null,this._edgeless=null,this._keeping=!1}get vEditor(){return assertExists(this._vInput),this._vInput.vEditor}setKeeping(_){this._keeping=_}_syncRect(){const _=this._edgeless,y=this._element;if(_&&y){const w=this._virgoContainer.getBoundingClientRect(),$=Array.from(this._virgoContainer.querySelectorAll("v-line")),B=$[0].getBoundingClientRect().height;_.surface.updateElement(y.id,{xywh:new Bound(y.x,y.y,w.width/_.surface.viewport.zoom,$.length/_.surface.viewport.zoom*B).serialize()})}}mount(_,y){this._element=_,this._edgeless=y,this._vInput=new VirgoInput({yText:this._element.text}),this._vInput.vEditor.slots.updated.on(()=>{this._syncRect()}),this._disposables.add(y.slots.viewportUpdated.on(()=>{this.requestUpdate(),requestAnimationFrame(()=>{this._syncRect()})})),this.requestUpdate(),requestAnimationFrame(()=>{assertExists(this._vInput),assertExists(this._element),this._edgeless?.surface.updateElementLocalRecord(this._element.id,{display:!1}),this._vInput.mount(this._virgoContainer);const w=this._edgeless?.dispatcher;assertExists(w),this._disposables.addFromEvent(this._virgoContainer,"blur",()=>{this._keeping||this._unmount()}),this._disposables.add(w.add("click",()=>!0)),this._disposables.add(w.add("doubleClick",()=>!0))})}_unmount(){this._vInput?.unmount(),assertExists(this._element),assertExists(this._edgeless),this._edgeless?.surface.updateElementLocalRecord(this._element.id,{display:!0}),this._element?.text.length===0&&deleteElements(this._edgeless,[this._element]),this.remove(),assertExists(this._edgeless),this._edgeless.selectionManager.setSelection({elements:[],editing:!1})}render(){const _=this._edgeless?.surface.viewport;let y=o$4({});if(_&&this._element&&this._edgeless){const w=_.zoom,$=getSelectedRect([this._element]),[B,R]=this._edgeless.surface.toViewCoord($.left,$.top);y=o$4({position:"absolute",minWidth:"2px",left:`${B}px`,top:`${R}px`,fontSize:`${this._element.fontSize}px`,fontFamily:this._element.fontFamily,lineHeight:"initial",outline:"none",transform:`scale(${w}, ${w})`,transformOrigin:"top left",color:isCssVariable(this._element.color)?`var(${this._element.color})`:this._element.color,zIndex:"10",textAlign:this._element.textAlign,marginRight:"-100%"})}return x$1`<div style=${y} class="virgo-container"></div>`}};__decorate$21([i$6(".virgo-container")],EdgelessTextEditor.prototype,"_virgoContainer",void 0);EdgelessTextEditor=__decorate$21([e$7("edgeless-text-editor")],EdgelessTextEditor);function mountTextEditor(k,_,y){const w=y?k.getCursorByCoord(y):k.text.length,$=new EdgelessTextEditor;_.pageBlockContainer.appendChild($),$.mount(k,_),$.vEditor?.focusByIndex(w),_.tools.switchToDefaultMode({elements:[k.id],editing:!0})}function mountShapeEditor(k,_){const y=new EdgelessShapeTextEditor;_.pageBlockContainer.appendChild(y),y.mount(k,_),y.vEditor?.focusEnd(),_.tools.switchToDefaultMode({elements:[k.id],editing:!0})}function mountFrameEditor(k,_){const y=new EdgelessFrameTitleEditor;_.pageBlockContainer.appendChild(y),y.mount(k,_),y.vEditor?.focusEnd(),_.tools.switchToDefaultMode({elements:[k.id],editing:!0})}function addText(k,_){if(!k.surface.pickTop(_.x,_.y)){const[w,$]=k.surface.viewport.toModelCoord(_.x,_.y),B=k.surface.addElement("text",{xywh:new Bound(w,$,32,32).serialize(),text:new YText,textAlign:"left",fontSize:24,color:GET_DEFAULT_LINE_COLOR(),bold:!1,italic:!1});k.page.captureSync();const R=k.surface.pickById(B);assertExists(R),R instanceof TextElement&&mountTextEditor(R,k)}}var __decorate$20=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessComponentToolbar=class extends WithDisposable(s$2){constructor(){super(...arguments),this._updateOnSelectedChange=_=>{const y=typeof _=="string"?_:_.id;this.selection.has(y)&&this.requestUpdate()}}get page(){return this.edgeless.page}get selection(){return this.edgeless.selectionManager}get slots(){return this.edgeless.slots}get surface(){return this.edgeless.surface}_groupSelected(){return groupBy$1(this.selection.elements,y=>isTopLevelBlock(y)?"note":y.type)}_getShapeButton(_){return _?.length?x$1`<edgeless-change-shape-button
          .elements=${_}
          .page=${this.page}
          .surface=${this.surface}
          .slots=${this.slots}
        >
        </edgeless-change-shape-button>`:A}_getBrushButton(_){return _?.length?x$1`<edgeless-change-brush-button
          .elements=${_}
          .page=${this.page}
          .surface=${this.surface}
          .slots=${this.slots}
        >
        </edgeless-change-brush-button>`:A}_getConnectorButton(_){return _?.length?x$1` <edgeless-change-connector-button
          .elements=${_}
          .page=${this.page}
          .surface=${this.surface}
          .slots=${this.slots}
          .edgeless=${this.edgeless}
        >
        </edgeless-change-connector-button>`:A}_getNoteButton(_){return _?.length===1?x$1`<edgeless-change-note-button
          .notes=${_}
          .page=${this.page}
          .surface=${this.surface}
          .slots=${this.slots}
        >
        </edgeless-change-note-button>`:A}_getTextButton(_){return _?.length?x$1`<edgeless-change-text-button
          .texts=${_}
          .page=${this.page}
          .surface=${this.surface}
          .slots=${this.slots}
        >
        </edgeless-change-text-button>`:A}_getFrameButton(_){return _?.length===1?x$1`
          <edgeless-tool-icon-button
            .tooltip=${"Rename"}
            .tipPosition=${"bottom"}
            @click=${()=>mountFrameEditor(_[0],this.edgeless)}
          >
            ${RenameIcon}Rename
          </edgeless-tool-icon-button>
        `:A}connectedCallback(){super.connectedCallback(),this._disposables.add(this.selection.slots.updated.on(()=>{this.requestUpdate()})),this._disposables.add(this.edgeless.page.slots.blockUpdated.on(this._updateOnSelectedChange)),pickValues(this.edgeless.surface.slots,["elementAdded","elementRemoved","elementUpdated"]).forEach(_=>this._disposables.add(_.on(this._updateOnSelectedChange)))}_getCreateFrameButton(){return x$1`<edgeless-add-frame-button
      .edgeless=${this.edgeless}
    ></edgeless-add-frame-button>`}render(){const _=this._groupSelected(),{edgeless:y}=this,{shape:w,brush:$,connector:B,note:R,text:H,frame:j}=_,X=atLeastNMatches(Object.values(_),te=>!!te.length,2)?[]:[this._getShapeButton(w),this._getBrushButton($),this._getConnectorButton(B),this._getNoteButton(R),this._getTextButton(H),this._getFrameButton(j)].filter(te=>!!te&&te!==A);this.selection.state.elements.length>1&&(X.unshift(x$1`<component-toolbar-menu-divider></component-toolbar-menu-divider>`),X.unshift(this._getCreateFrameButton()));const ee=X.at(-1);return(typeof ee=="symbol"||!ee?.strings[0].includes("component-toolbar-menu-divider"))&&X.push(x$1`<component-toolbar-menu-divider></component-toolbar-menu-divider>`),x$1`<div
      class="edgeless-component-toolbar-container"
      @pointerdown=${stopPropagation}
    >
      ${o(X,()=>"")}
      <edgeless-more-button
        .edgeless=${y}
        .vertical=${!0}
      ></edgeless-more-button>
    </div>`}};EdgelessComponentToolbar.styles=i$5`
    :host {
      display: block;
      position: absolute;
      user-select: none;
    }

    :host([data-show]) {
      display: block;
    }

    .edgeless-component-toolbar-container {
      display: flex;
      align-items: center;
      height: 40px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-menu-shadow);
      border-radius: 8px;
      padding: 0 8px;
    }

    component-toolbar-menu-divider {
      margin: 0 12px;
    }
  `;__decorate$20([n$a({attribute:!1})],EdgelessComponentToolbar.prototype,"edgeless",void 0);EdgelessComponentToolbar=__decorate$20([e$7("edgeless-component-toolbar")],EdgelessComponentToolbar);var __decorate$1$=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessConnectorHandle=class extends WithDisposable(s$2){constructor(){super(...arguments),this._lastZoom=1}firstUpdated(){const{edgeless:_}=this,{viewport:y}=_.surface;this._lastZoom=y.zoom,this.edgeless.slots.viewportUpdated.on(()=>{y.zoom!==this._lastZoom&&(this._lastZoom=y.zoom,this.requestUpdate())}),this._bindEvent()}_capPointerDown(_,y){const{edgeless:w,connector:$,_disposables:B}=this;_.stopPropagation(),B.addFromEvent(document,"pointermove",R=>{const{clientX:H,clientY:j}=R,q=w.surface.viewport.boundingClientRect,X=w.surface.viewport.toModelCoord(H-q.left,j-q.top);w.connector.updateConnection($,X,y),this.requestUpdate()}),B.addFromEvent(document,"pointerup",()=>{w.connector.clear(),w.page.captureSync(),B.dispose(),this._disposables=new DisposableGroup,this._bindEvent()})}_bindEvent(){this._disposables.addFromEvent(this._startHandler,"pointerdown",_=>{this._capPointerDown(_,"source")}),this._disposables.addFromEvent(this._endHandler,"pointerdown",_=>{this._capPointerDown(_,"target")})}render(){const{surface:_}=this.edgeless,{path:y}=this.connector,w=_.viewport.zoom,$={position:"absolute",left:`${y[0][0]*w}px`,top:`${y[0][1]*w}px`},B={position:"absolute",left:`${y[y.length-1][0]*w}px`,top:`${y[y.length-1][1]*w}px`};return x$1`
      <div class="line-controller line-start" style=${o$4($)}></div>
      <div class="line-controller line-end" style=${o$4(B)}></div>
    `}};EdgelessConnectorHandle.styles=i$5`
    .line-controller {
      position: absolute;
      width: 9px;
      height: 9px;
      box-sizing: border-box;
      border-radius: 50%;
      border: 2px solid var(--affine-text-emphasis-color);
      background-color: var(--affine-background-primary-color);
      transform: translate(-50%, -50%);
      cursor: pointer;
      z-index: 10;
      pointer-events: all;
      /**
             * Fix: pointerEvent stops firing after a short time.
             * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,
             * up to the one that implements the gesture (in other words, the first containing scrolling element)
             * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action
             */
      touch-action: none;
    }
    .line-controller-hidden {
      display: none;
    }
  `;__decorate$1$([n$a({attribute:!1})],EdgelessConnectorHandle.prototype,"connector",void 0);__decorate$1$([n$a({attribute:!1})],EdgelessConnectorHandle.prototype,"edgeless",void 0);__decorate$1$([i$6(".line-start")],EdgelessConnectorHandle.prototype,"_startHandler",void 0);__decorate$1$([i$6(".line-end")],EdgelessConnectorHandle.prototype,"_endHandler",void 0);EdgelessConnectorHandle=__decorate$1$([e$7("edgeless-connector-handle")],EdgelessConnectorHandle);var __decorate$1_=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},Direction;(function(k){k[k.Right=0]="Right",k[k.Bottom=1]="Bottom",k[k.Left=2]="Left",k[k.Top=3]="Top"})(Direction||(Direction={}));class AutoCompleteOverlay extends Overlay{constructor(){super(...arguments),this.linePoints=[],this.shapePoints=[],this.stroke=""}render(_,y){this.linePoints.length&&this.shapePoints.length&&(_.setLineDash([2,2]),_.strokeStyle=this.stroke,_.beginPath(),this.linePoints.forEach((w,$)=>{$===0?_.moveTo(w[0],w[1]):_.lineTo(w[0],w[1])}),this.shapePoints.forEach((w,$)=>{$===0?_.moveTo(w[0],w[1]):_.lineTo(w[0],w[1])}),_.closePath(),_.stroke())}}const MAIN_GAP=100,SECOND_GAP=20;function nextBound(k,_,y){const w=Bound.deserialize(_.xywh),{x:$,y:B,w:R,h:H}=w;let j,q=0;switch(k){case Direction.Right:q=0;break;case Direction.Bottom:q=90;break;case Direction.Left:q=180;break;case Direction.Top:q=270;break}q=normalizeDegAngle(q+_.rotate),q>=45&&q<=135?j=new Bound($,B+H+MAIN_GAP,R,H):q>=135&&q<=225?j=new Bound($-R-MAIN_GAP,B,R,H):q>=225&&q<=315?j=new Bound($,B-H-MAIN_GAP,R,H):j=new Bound($+R+MAIN_GAP,B,R,H);function X(ne){return!y.some(oe=>ne.isIntersectWithBound(getGridBound(oe)))}let ee=0;function te(){ee++;const ne=Math.ceil(ee/2),oe=j.clone();switch(k){case Direction.Right:case Direction.Left:oe.y=ee%2===1?j.y-(H+SECOND_GAP)*ne:j.y+(H+SECOND_GAP)*ne;break;case Direction.Bottom:case Direction.Top:oe.x=ee%2===1?j.x-(R+SECOND_GAP)*ne:j.x+(R+SECOND_GAP)*ne;break}return X(oe)?oe:te()}return X(j)?j:te()}function getPosition(k){let _=[],y=[];switch(k){case Direction.Right:_=[1,.5],y=[0,.5];break;case Direction.Bottom:_=[.5,1],y=[.5,0];break;case Direction.Left:_=[0,.5],y=[1,.5];break;case Direction.Top:_=[.5,0],y=[.5,1];break}return{startPosition:_,endPosition:y}}let EdgelessAutoComplete=class extends WithDisposable(s$2){constructor(){super(...arguments),this._isMoving=!1,this._overlay=new AutoCompleteOverlay,this._timer=null,this._onPointerDown=(_,y)=>{const{surface:w}=this.edgeless,$=w.viewport.boundingClientRect,B=w.viewport.toModelCoord(_.clientX-$.left,_.clientY-$.top);if(!this.edgeless.dispatcher)return;let R;this._disposables.addFromEvent(document,"pointermove",H=>{const j=w.viewport.toModelCoord(H.clientX-$.left,H.clientY-$.top);if(Vec.dist(B,j)>8&&!this._isMoving){this._isMoving=!0;const{startPosition:q}=getPosition(y);R=this._addConnector({id:this._current.id,position:q},{position:j})}this._isMoving&&(assertExists(R),this.edgeless.connector.updateConnection(R,j,"target"))}),this._disposables.addFromEvent(document,"pointerup",()=>{this._isMoving?R&&!R.target.id&&this._generateShapeOnDrag(y,R):this._generateShapeOnClick(y),this._isMoving=!1,this.edgeless.connector.clear(),this._disposables.dispose(),this._disposables=new DisposableGroup})}}get _selected(){return this.edgeless.selectionManager.elements}get _current(){return this._selected[0]}firstUpdated(){this._disposables.add(this.edgeless.selectionManager.slots.updated.on(()=>{this._overlay.linePoints=[],this._overlay.shapePoints=[]}))}_addConnector(_,y){const{surface:w}=this.edgeless,$=w.addElement("connector",{mode:ConnectorMode.Orthogonal,strokeWidth:2,stroke:this._current.strokeColor,source:_,target:y});return w.pickById($)}_createShape(){return this.edgeless.surface.addElement(this._current.type,{...this._current.serialize(),text:new YText})}_generateShapeOnClick(_){const{surface:y}=this.edgeless,w=this._computeNextShape(_),$=this._createShape();y.updateElement($,{xywh:w.serialize()});const{startPosition:B,endPosition:R}=getPosition(_);this._addConnector({id:this._current.id,position:B},{id:$,position:R}),this.edgeless.selectionManager.setSelection({elements:[$],editing:!1})}_generateShapeOnDrag(_,y){const{surface:w}=this.edgeless,$=Bound.deserialize(this._current.xywh),{w:B,h:R}=$,H=y.target.position;assertExists(H);const j=y.path.length,q=normalizeDegAngle(toDegree(Vec.angle(y.path[j-2],y.path[j-1]))),X=this._createShape();let ee,te;q>=45&&q<=135?(ee=new Bound(H[0]-B/2,H[1],B,R),te=[.5,0]):q>=135&&q<=225?(ee=new Bound(H[0]-B,H[1]-R/2,B,R),te=[1,.5]):q>=225&&q<=315?(ee=new Bound(H[0]-B/2,H[1]-R,B,R),te=[.5,1]):(ee=new Bound(H[0],H[1]-R/2,B,R),te=[0,.5]),w.updateElement(X,{xywh:ee.serialize()}),w.updateElement(y.id,{target:{id:X,position:te}}),this.edgeless.selectionManager.setSelection({elements:[X],editing:!1}),this.edgeless.page.captureSync()}_showNextShape(_){const{surface:y}=this.edgeless;y.viewport.addOverlay(this._overlay);const w=this._computeNextShape(_),$=this._computeLine(_,this._current,w);this._overlay.stroke=this.edgeless.computeValue(this._current.strokeColor),this._overlay.linePoints=$,this._overlay.shapePoints=rotatePoints$1(ShapeMethodsMap[this._current.shapeType].points(w),w.center,this._current.rotate),y.refresh()}_computeNextShape(_){const y=this.edgeless.connector.getConnecttedElements(this._current).filter(w=>w instanceof ShapeElement);return nextBound(_,this._current,y)}_computeLine(_,y,w){const $=getGridBound(this._current),{startPosition:B,endPosition:R}=getPosition(_),H={xywh:w.serialize(),rotate:y.rotate,shapeType:y.shapeType},j=y.getRelativePointLocation(B),q=y.getRelativePointLocation.call(H,R);return this.edgeless.connector.generateOrthogonalConnectorPath({startBound:$,endBound:w,startPoint:j,endPoint:q})}render(){if(!(this._selected.length===1&&this._selected[0]instanceof ShapeElement&&!this._isMoving))return this.edgeless.surface.viewport.removeOverlay(this._overlay),A;const{selectedRect:_}=this,y=72,w=44,$=[Direction.Right,Direction.Bottom,Direction.Left,Direction.Top].map(B=>{let R="";switch(B){case Direction.Top:R+=`translate(${_.width/2}px, ${-w/2}px)`;break;case Direction.Right:R+=`translate(${_.width+w/2}px, ${_.height/2}px)`,R+="rotate(90deg)";break;case Direction.Bottom:R+=`translate(${_.width/2}px, ${_.height+w/2}px)`,R+="rotate(180deg)";break;case Direction.Left:R+=`translate(${-w/2}px, ${_.height/2}px)`,R+="rotate(-90deg)";break}return R+=`translate(${-y/2}px, ${-w/2}px)`,x$1`<div
        class="edgeless-auto-complete-arrow-wrapper"
        style=${o$4({transform:R,transformOrigin:"left top"})}
      >
        <div
          class="edgeless-auto-complete-arrow"
          @mouseenter=${()=>{this._timer=setTimeout(()=>this._showNextShape(B),300)}}
          @mouseleave=${()=>{this._timer&&clearTimeout(this._timer),this.edgeless.surface.viewport.removeOverlay(this._overlay)}}
          @pointerdown=${H=>{this._onPointerDown(H,B)}}
        >
          ${AutoCompleteArrowIcon}
        </div>
      </div>`});return x$1`<div
      class="edgeless-auto-complete-container"
      style=${o$4({top:_.top+"px",left:_.left+"px",width:_.width+"px",height:_.height+"px",transform:`rotate(${_.rotate}deg)`})}
    >
      ${$}
    </div>`}};EdgelessAutoComplete.styles=i$5`
    .edgeless-auto-complete-container {
      position: absolute;
      z-index: 1;
      pointer-events: none;
    }
    .edgeless-auto-complete-arrow-wrapper {
      width: 72px;
      height: 44px;
      position: absolute;
      z-index: 1;
      pointer-events: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .edgeless-auto-complete-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 19px;
      cursor: pointer;
      pointer-events: auto;
      transition: background 0.3s linear, box-shadow 0.2s linear;
    }
    .edgeless-auto-complete-arrow-wrapper:hover
      > .edgeless-auto-complete-arrow {
      border: 1px solid var(--affine-border-color);
      box-shadow: var(--affine-shadow-1);
      background: var(--affine-white);
    }

    .edgeless-auto-complete-arrow-wrapper
      > .edgeless-auto-complete-arrow:hover {
      border: 1px solid var(--affine-white-10);
      box-shadow: var(--affine-shadow-1);
      background: var(--affine-primary-color);
    }

    .edgeless-auto-complete-arrow svg {
      fill: #77757d;
    }
    .edgeless-auto-complete-arrow:hover svg {
      fill: #ffffff;
    }
  `;__decorate$1_([n$a({attribute:!1})],EdgelessAutoComplete.prototype,"edgeless",void 0);__decorate$1_([n$a({attribute:!1})],EdgelessAutoComplete.prototype,"selectedRect",void 0);__decorate$1_([t$2()],EdgelessAutoComplete.prototype,"_isMoving",void 0);EdgelessAutoComplete=__decorate$1_([e$7("edgeless-auto-complete")],EdgelessAutoComplete);var HandleDirection;(function(k){k.Left="left",k.Top="top",k.Right="right",k.Bottom="bottom",k.TopLeft="top-left",k.BottomLeft="bottom-left",k.TopRight="top-right",k.BottomRight="bottom-right"})(HandleDirection||(HandleDirection={}));function ResizeHandle(k,_,y,w){const $=j=>{j.stopPropagation(),_&&_(j,k)},B=j=>q=>{if(q.stopPropagation(),q.buttons===1||!y)return;const{clientX:X,clientY:ee}=q,te=q.target;y(!0,{type:j,point:[X,ee],target:te})},R=j=>{j.stopPropagation(),!(j.buttons===1||!y)&&y(!1)},H=k===HandleDirection.Top||k===HandleDirection.Bottom||k===HandleDirection.Left||k===HandleDirection.Right?A:x$1`<div
          class="rotate"
          @pointerover=${B("rotate")}
          @pointerout=${R}
        ></div>`;return x$1`<div
    class="handle"
    aria-label=${k}
    @pointerdown=${$}
  >
    ${H}
    <div
      class="resize${w&&" transparent-handle"}"
      @pointerover=${B("resize")}
      @pointerout=${R}
    ></div>
  </div>`}function ResizeHandles(k,_,y){const w=()=>{const R=ResizeHandle(HandleDirection.TopLeft,_,y),H=ResizeHandle(HandleDirection.TopRight,_,y),j=ResizeHandle(HandleDirection.BottomLeft,_,y),q=ResizeHandle(HandleDirection.BottomRight,_,y);return{handleTopLeft:R,handleTopRight:H,handleBottomLeft:j,handleBottomRight:q}},$=R=>{const H=ResizeHandle(HandleDirection.Left,_,y,R),j=ResizeHandle(HandleDirection.Right,_,y,R);return{handleLeft:H,handleRight:j}},B=R=>{const H=ResizeHandle(HandleDirection.Top,_,y,R),j=ResizeHandle(HandleDirection.Bottom,_,y,R);return{handleTop:H,handleBottom:j}};switch(k){case"corner":{const{handleTopLeft:R,handleTopRight:H,handleBottomLeft:j,handleBottomRight:q}=w();return x$1`
        ${R}
        ${H}
        ${j}
        ${q}
      `}case"edge":{const{handleLeft:R,handleRight:H}=$();return x$1`${R} ${H}`}case"all":{const{handleTopLeft:R,handleTopRight:H,handleBottomLeft:j,handleBottomRight:q}=w(),{handleLeft:X,handleRight:ee}=$(!0),{handleTop:te,handleBottom:ne}=B(!0);return x$1`
        ${R}
        ${te}
        ${H}
        ${ee}
        ${q}
        ${ne}
        ${j}
        ${X}
      `}case"none":return A}}const SHIFT_LOCKING_ANGLE=Math.PI/12;class HandleResizeManager{constructor(_,y,w,$){this.slots={resizeEnd:new Slot},this._dragDirection=HandleDirection.Left,this._dragPos={start:{x:0,y:0},end:{x:0,y:0}},this._rotate=0,this._originalRect=new DOMRect,this._currentRect=new DOMRect,this._origin={x:0,y:0},this._resizeMode="none",this._zoom=1,this._bounds=new Map,this._aspectRatio=1,this._locked=!1,this._shiftKey=!1,this._rotation=!1,this._target=null,this.onPointerDown=(B,R)=>{if(B.stopPropagation(),this._locked=!1,this._target=B.target,this._dragDirection=R,this._dragPos.start={x:B.x,y:B.y},this._dragPos.end={x:B.x,y:B.y},this._rotation=this._target.classList.contains("rotate"),this._rotation){const q=this._target.closest(".affine-edgeless-selected-rect")?.getBoundingClientRect();assertExists(q);const{left:X,top:ee,right:te,bottom:ne}=q,oe=(X+te)/2,ie=(ee+ne)/2;this._origin={x:oe,y:ie}}this._onDragStart();const H=({x:q,y:X,shiftKey:ee})=>{if(this._resizeMode!=="none"){if(this._shiftKey=ee,this._dragPos.end={x:q,y:X},this._rotation){this._onRotate(this._shiftKey);return}this._onResize(this._shiftKey)}},j=q=>{this._onDragEnd();const{x:X,y:ee,width:te,height:ne}=this._currentRect;this._originalRect=new DOMRect(X,ee,te,ne),this._locked=!0,this._shiftKey=!1,this._rotation=!1,this._dragPos={start:{x:0,y:0},end:{x:0,y:0}},this.slots.resizeEnd.emit(),document.removeEventListener("pointermove",H),document.removeEventListener("pointerup",j)};document.addEventListener("pointermove",H),document.addEventListener("pointerup",j)},this._onDragStart=_,this._onResizeMove=y,this._onRotateMove=w,this._onDragEnd=$}get currentRect(){return this._currentRect}get originalRect(){return this._originalRect}updateState(_,y,w,$,B){this._resizeMode=_,this._rotate=y,this._zoom=w,$&&(this._currentRect.x=$.x,this._currentRect.y=$.y,this._originalRect.x=this._currentRect.x,this._originalRect.y=this._currentRect.y),B&&(this._originalRect=B,this._aspectRatio=B.width/B.height,this._currentRect=DOMRect.fromRect(B))}updateRectPosition(_){return this._currentRect.x+=_.x,this._currentRect.y+=_.y,this._originalRect.x=this._currentRect.x,this._originalRect.y=this._currentRect.y,this._originalRect}updateBounds(_){this._bounds=_}_onResize(_=!1){const{_aspectRatio:y,_dragDirection:w,_dragPos:$,_rotate:B,_resizeMode:R,_zoom:H,_target:j,_originalRect:q,_currentRect:X}=this;assertExists(j);const ee=R==="all",te=R==="corner",{start:{x:ne,y:oe},end:{x:ie,y:ae}}=$,{left:re,top:se,right:le,bottom:ue}=q,he={w:le-re,h:ue-se,cx:(re+le)/2,cy:(se+ue)/2},ce={...he},ge={x:1,y:1},be={x:1,y:1},fe={x:1,y:1},we=new DOMPoint(0,0),Ce=new DOMPoint(0,0),ve=(ie-ne)/H,ke=(ae-oe)/H,me=new DOMMatrix().translateSelf(he.cx,he.cy).rotateSelf(B).translateSelf(-he.cx,-he.cy);if(te||ee){switch(w){case HandleDirection.TopLeft:{fe.x=-1,fe.y=-1,we.x=le,we.y=ue,Ce.x=re,Ce.y=se;break}case HandleDirection.TopRight:{fe.x=1,fe.y=-1,we.x=re,we.y=ue,Ce.x=le,Ce.y=se;break}case HandleDirection.BottomRight:{fe.x=1,fe.y=1,we.x=re,we.y=se,Ce.x=le,Ce.y=ue;break}case HandleDirection.BottomLeft:{fe.x=-1,fe.y=1,we.x=le,we.y=se,Ce.x=re,Ce.y=ue;break}case HandleDirection.Left:{fe.x=-1,fe.y=1,we.x=le,we.y=he.cy,Ce.x=re,Ce.y=he.cy;break}case HandleDirection.Right:{fe.x=1,fe.y=1,we.x=re,we.y=he.cy,Ce.x=le,Ce.y=he.cy;break}case HandleDirection.Top:{const et=(re+le)/2;fe.x=1,fe.y=-1,we.x=et,we.y=ue,Ce.x=et,Ce.y=se;break}case HandleDirection.Bottom:{const et=(re+le)/2;fe.x=1,fe.y=1,we.x=et,we.y=se,Ce.x=et,Ce.y=ue;break}}_||(_=this._bounds.size>1);const Me=we.matrixTransform(me);let Pe=Ce.matrixTransform(me);if(Pe.x+=ve,Pe.y+=ke,w===HandleDirection.Left||w===HandleDirection.Right||w===HandleDirection.Top||w===HandleDirection.Bottom){const et=Ce.matrixTransform(me),st=[0,0],[[at,ct]]=rotatePoints$1([[et.x,et.y]],st,-B),[[lt,_e]]=rotatePoints$1([[Pe.x,Pe.y]],st,-B),We={x:0,y:0};w===HandleDirection.Left||w===HandleDirection.Right?(We.x=lt,We.y=ct):(We.x=at,We.y=_e);const[[Ne,$e]]=rotatePoints$1([[We.x,We.y]],st,B);Pe.x=Ne,Pe.y=$e}const Qe=(Me.x+Pe.x)/2,je=(Me.y+Pe.y)/2,Ue=new DOMMatrix().translateSelf(Qe,je).rotateSelf(-B).translateSelf(-Qe,-je),tt=Me.matrixTransform(Ue),Ve=Pe.matrixTransform(Ue);switch(w){case HandleDirection.TopLeft:{ce.w=tt.x-Ve.x,ce.h=tt.y-Ve.y;break}case HandleDirection.TopRight:{ce.w=Ve.x-tt.x,ce.h=tt.y-Ve.y;break}case HandleDirection.BottomRight:{ce.w=Ve.x-tt.x,ce.h=Ve.y-tt.y;break}case HandleDirection.BottomLeft:{ce.w=tt.x-Ve.x,ce.h=Ve.y-tt.y;break}case HandleDirection.Left:{ce.w=tt.x-Ve.x;break}case HandleDirection.Right:{ce.w=Ve.x-tt.x;break}case HandleDirection.Top:{ce.h=tt.y-Ve.y;break}case HandleDirection.Bottom:{ce.h=Ve.y-tt.y;break}}ce.cx=(Ve.x+tt.x)/2,ce.cy=(Ve.y+tt.y)/2,ge.x=ce.w/he.w,ge.y=ce.h/he.h,be.x=ge.x<0?-1:1,be.y=ge.y<0?-1:1;const nt=w===HandleDirection.TopLeft||w===HandleDirection.TopRight||w===HandleDirection.BottomRight||w===HandleDirection.BottomLeft;if(_&&nt){const et=Math.abs(ce.w/ce.h);y<et?(ge.y=Math.abs(ge.x)*be.y,ce.h=ge.y*he.h):(ge.x=Math.abs(ge.y)*be.x,ce.w=ge.x*he.w),Ce.x=we.x+ce.w*fe.x,Ce.y=we.y+ce.h*fe.y,Pe=Ce.matrixTransform(me),ce.cx=(Me.x+Pe.x)/2,ce.cy=(Me.y+Pe.y)/2}}else{switch(w){case HandleDirection.Left:{fe.x=-1,we.x=le,Ce.x=re+ve,ce.w=we.x-Ce.x;break}case HandleDirection.Right:{fe.x=1,we.x=re,Ce.x=le+ve,ce.w=Ce.x-we.x;break}}ge.x=ce.w/he.w,be.x=ge.x<0?-1:1,Math.abs(ce.w)<NOTE_MIN_WIDTH&&(ce.w=NOTE_MIN_WIDTH*be.x,ge.x=ce.w/he.w,Ce.x=we.x+ce.w*fe.x),ce.cx=(Ce.x+we.x)/2}const Ie=Math.abs(ce.w),Fe=Math.abs(ce.h),Be=ce.cx-Ie/2,Ze=ce.cy-Fe/2;X.x=Be,X.y=Ze,X.width=Ie,X.height=Fe;const Re=new Map;let qe;if(te||ee)if(this._bounds.size===1)qe=(Me,Pe)=>{Re.set(Pe,{bound:new Bound(Be,Ze,Ie,Fe)})};else{const Me=we.matrixTransform(me),Pe=new DOMMatrix().translateSelf(Me.x,Me.y).rotateSelf(B).translateSelf(-Me.x,-Me.y).scaleSelf(ge.x,ge.y,1,Me.x,Me.y,0).translateSelf(Me.x,Me.y).rotateSelf(-B).translateSelf(-Me.x,-Me.y);qe=({bound:{x:Qe,y:je,w:Ue,h:tt}},Ve)=>{const nt=Qe+Ue/2,et=je+tt/2,st=new DOMPoint(nt,et).matrixTransform(Pe),at=Math.abs(Ue*ge.x),ct=Math.abs(tt*ge.y);Re.set(Ve,{bound:new Bound(st.x-at/2,st.y-ct/2,at,ct)})}}else{const Me=new DOMMatrix().scaleSelf(ge.x,ge.y,1,we.x,we.y,0);qe=({bound:{x:Pe,y:Qe,w:je,h:Ue},rotate:tt=0},Ve)=>{const nt=Pe+je/2,et=Qe+Ue/2,st=new DOMPoint(nt,et).matrixTransform(Me);let at,ct;if(tt){const{width:lt}=getQuadBoundsWithRotation({x:Pe,y:Qe,w:je,h:Ue,rotate:tt}),_e=lt/2;if(st.y=et,X.width<=lt)at=je*(X.width/lt),ct=at/(je/Ue),st.x=X.left+X.width/2;else{const We=(nt-_e-q.left)/q.width,Ne=X.left+We*X.width+_e;st.x=Math.max(X.left+_e,Math.min(Ne,X.left+X.width-_e)),at=je,ct=Ue}}else at=Math.abs(je*ge.x),ct=Math.abs(Ue*ge.y);Re.set(Ve,{bound:new Bound(st.x-at/2,st.y-ct/2,at,ct)})}}this._bounds.forEach(qe),this._onResizeMove(Re)}_onRotate(_=!1){const{_originalRect:{left:y,top:w,right:$,bottom:B},_dragPos:{start:{x:R,y:H},end:{x:j,y:q}},_origin:{x:X,y:ee},_rotate:te}=this,ne=Math.atan2(H-ee,R-X);let ie=Math.atan2(q-ee,j-X)-ne;if(_){const le=te*Math.PI/180;let ue=le+ie;ue+=SHIFT_LOCKING_ANGLE/2,ue-=ue%SHIFT_LOCKING_ANGLE,ie=ue-le}const ae=ie*180/Math.PI;let re=j,se=q;if(_){const le=new DOMPoint(R,H).matrixTransform(new DOMMatrix().translateSelf(X,ee).rotateSelf(ae).translateSelf(-X,-ee));re=le.x,se=le.y}this._onRotateMove({x:(y+$)/2,y:(w+B)/2},ae),this._dragPos.start={x:re,y:se},this._rotate+=ae}onPressShiftKey(_){if(this._target&&!this._locked&&this._shiftKey!==_){if(this._shiftKey=_,this._rotation){this._onRotate(this._shiftKey);return}this._onResize(this._shiftKey)}}}var __decorate$1Z=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function randomColor$1(){return`hsl(${Math.floor(Math.random()*360).toString()}, 75%, 65%)`}let EdgelessRemoteSelection=class extends WithDisposable(s$2){constructor(){super(...arguments),this._remoteRects={},this._updateRemoteRects=()=>{const{zoom:_,selection:y,surface:w,remoteColorMap:$}=this,B=y.remoteSelection,R={};Object.entries(B).forEach(([H,j])=>{if(j.elements.length===0)return;const q=j.elements.map(ae=>this.edgeless.getElementModel(ae)).filter(ae=>ae),X=getSelectedRect(q);if(X.width===0||X.height===0)return;const[ee,te]=w.toViewCoord(X.left,X.top),[ne,oe]=[X.width*_,X.height*_];$.has(H)||$.set(H,randomColor$1());let ie=0;if(q.length===1){const ae=q[0];isTopLevelBlock(ae)||(ie=ae.rotate??0)}R[H]={width:ne,height:oe,borderStyle:"solid",left:ee,top:te,rotate:ie}}),this._remoteRects=R},this._updateOnElementChange=_=>{const y=typeof _=="string"?_:_.id;this.selection.hasRemote(y)&&this._updateRemoteRects()}}get selection(){return this.edgeless.selectionManager}get surface(){return this.edgeless.surface}get zoom(){return this.surface.viewport.zoom}get page(){return this.edgeless.page}connectedCallback(){super.connectedCallback();const{_disposables:_,surface:y,page:w}=this;Object.values(pick(y.slots,["elementAdded","elementRemoved","elementUpdated"])).forEach($=>{_.add($.on(this._updateOnElementChange))}),_.add(this.selection.slots.remoteUpdated.on(this._updateRemoteRects)),_.add(w.slots.yBlockUpdated.on(this._updateOnElementChange)),_.add(y.viewport.slots.viewportUpdated.on(this._updateRemoteRects)),this._updateRemoteRects()}render(){const{_remoteRects:_,remoteColorMap:y}=this;return x$1`<div class="affine-edgeless-remote-selection">
      ${c$1(Object.entries(_),w=>w[0],([w,$])=>x$1`<div
            data-client-id=${w}
            class="affine-edgeless-remote-rect"
            style=${o$4({pointerEvents:"none",width:`${$.width}px`,height:`${$.height}px`,borderStyle:$.borderStyle,borderColor:`${y.get(w)}`,transform:`translate(${$.left}px, ${$.top}px) rotate(${$.rotate}deg)`})}
          ></div>`)}
    </div>`}};EdgelessRemoteSelection.styles=i$5`
    :host {
      pointer-events: none;
    }

    .affine-edgeless-remote-rect {
      position: absolute;
      top: 0;
      left: 0;
      border-radius: 4px;
      box-sizing: border-box;
      border-width: 3px;
      z-index: 1;
    }
  `;__decorate$1Z([n$a({attribute:!1})],EdgelessRemoteSelection.prototype,"edgeless",void 0);__decorate$1Z([n$a({attribute:!1})],EdgelessRemoteSelection.prototype,"remoteColorMap",void 0);__decorate$1Z([t$2()],EdgelessRemoteSelection.prototype,"_remoteRects",void 0);EdgelessRemoteSelection=__decorate$1Z([e$7("edgeless-remote-selection")],EdgelessRemoteSelection);var __decorate$1Y=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessSelectedRect=class extends WithDisposable(s$2){constructor(){super(),this._selectedRect={width:0,height:0,borderWidth:0,borderStyle:"solid",borderRadius:0,left:0,top:0,rotate:0},this._toolbarVisible=!1,this._toolbarPosition={x:0,y:0},this._remoteColorMap=new Map,this._cursorRotate=0,this._onDragStart=()=>{this._toolbarVisible=!1,this._updateResizeManagerState(!1)},this._onDragMove=_=>{const{page:y,selection:w,surface:$}=this,B=new Map(w.elements.map(R=>[R.id,R]));_.forEach(({bound:R},H)=>{const j=B.get(H);if(j)if(isTopLevelBlock(j)){let q=deserializeXYWH(j.xywh)[3];q<NOTE_MIN_HEIGHT&&(q=NOTE_MIN_HEIGHT),y.updateBlock(j,{xywh:serializeXYWH(R.x,R.y,R.w,q)})}else if(j instanceof TextElement){const q=R.h/j.h;R.w=j.w*q,$.updateElement(H,{xywh:R.serialize(),fontSize:j.fontSize*q})}else j instanceof ShapeElement&&(R=normalizeShapeBound(j,R)),$.updateElement(H,{xywh:R.serialize()})})},this._onDragRotate=(_,y)=>{const{surface:w,selection:$}=this,B=new DOMMatrix().translateSelf(_.x,_.y).rotateSelf(y).translateSelf(-_.x,-_.y);$.elements.filter(H=>!isTopLevelBlock(H)&&H.type!=="connector").forEach(H=>{const{id:j,rotate:q}=H,[X,ee,te,ne]=H.deserializeXYWH(),oe=new DOMPoint(X+te/2,ee+ne/2).matrixTransform(B);w.updateElement(j,{xywh:serializeXYWH(oe.x-te/2,oe.y-ne/2,te,ne),rotate:normalizeDegAngle(q+y)})}),this._updateCursor(!0,{type:"rotate",angle:y})},this._onDragEnd=()=>{this._updateCursor(!1),this._toolbarVisible=!0},this._updateCursor=(_,y)=>{let w="default";if(_&&y){const{type:$,target:B,point:R}=y;let{angle:H}=y;if($==="rotate")B&&R&&(H=calcAngle(B,R,45)),this._cursorRotate+=H||0,w=generateCursorUrl(this._cursorRotate).toString();else{if(this.resizeMode==="edge")w="ew";else if(B&&R){const j=getResizeLabel(B),{width:q,height:X,left:ee,top:te}=this._selectedRect;j==="top"||j==="bottom"||j==="left"||j==="right"?H=calcAngleEdgeWithRotation(B,this._selectedRect.rotate):H=calcAngleWithRotation(B,R,new DOMRect(ee,te,q,X),this._selectedRect.rotate),w=rotateResizeCursor(H*Math.PI/180)}w+="-resize"}}else this._cursorRotate=0;this.slots.cursorUpdated.emit(w)},this._updateResizeManagerState=_=>{const{_resizeManager:y,_selectedRect:w,resizeMode:$,zoom:B,selection:{elements:R}}=this,H=getSelectedRect(R);R.length>1&&(_=!0),y.updateState($,w.rotate,B,_?void 0:H,_?H:void 0),y.updateBounds(getSelectableBounds(R))},this._updateOnViewportChange=()=>{this._updateSelectedRect()},this._updateOnSelectionChange=()=>{this._updateSelectedRect(),this._updateResizeManagerState(!0),this.selection.editing?this._toolbarVisible=!1:this._toolbarVisible=!0},this._updateOnElementChange=_=>{const y=typeof _=="string"?_:_.id;this.selection.has(y)&&this._updateSelectedRect()},this._resizeManager=new HandleResizeManager(this._onDragStart,this._onDragMove,this._onDragRotate,this._onDragEnd),this.addEventListener("pointerdown",stopPropagation),this._disposables.add(this._resizeManager.slots.resizeEnd.on(()=>{this.selection.elements.forEach(_=>{_ instanceof FrameElement&&this.edgeless.frame.calculateFrameColor(_)})}))}get selection(){return this.edgeless.selectionManager}get page(){return this.edgeless.page}get slots(){return this.edgeless.slots}get surface(){return this.edgeless.surface}get zoom(){return this.surface.viewport.zoom}get resizeMode(){const _=this.selection.elements;let y=!0,w=!0,$=!1;for(const B of _)isTopLevelBlock(B)?$=!0:(B.type!=="connector"&&(y=!1),B.type!=="shape"&&(w=!1));return $?"edge":y?"none":w?"all":"corner"}_shouldRenderSelection(_){return _=_??this.selection.elements,_.length>0&&(!this.selection.editing||!isPhasorElementWithText(_[0]))}async _updateToolbarPosition(){if(!this._toolbarVisible||!this._shouldRenderSelection()||this.page.readonly)return;(!this._selectedRectEl||!this._componentToolbar)&&await this.updateComplete,this._componentToolbar.isUpdatePending&&await this._componentToolbar.updateComplete;const _=this._componentToolbar,y=edgelessElementsBound(this.selection.elements),{viewport:w}=this.edgeless.surface,[$,B]=w.toViewCoord(y.x,y.y),R=_.getBoundingClientRect(),H=34;let j=B-R.height-H;j<0&&(j=B+y.h*w.zoom+H),this._toolbarPosition={x:$,y:j}}_updateSelectedRect(){const{surface:_,zoom:y,selection:w}=this,$=w.elements,B=getSelectedRect($),[R,H]=_.toViewCoord(B.left,B.top),[j,q]=[B.width*y,B.height*y];let X=0;if($.length===1){const te=$[0];isTopLevelBlock(te)||(X=te.rotate??0)}const ee=$.length===1&&isTopLevelBlock($[0])&&matchFlavours($[0],["affine:note"])&&$[0].hidden;this._selectedRect={width:j,height:q,borderWidth:w.editing?2:1,borderStyle:ee?"dashed":"solid",borderRadius:8*y,left:R,top:H,rotate:X}}firstUpdated(){const{_disposables:_,page:y,slots:w,selection:$,surface:B,edgeless:R}=this;_.add(w.viewportUpdated.on(this._updateOnViewportChange)),Object.values(pick(B.slots,["elementAdded","elementRemoved","elementUpdated"])).forEach(H=>{_.add(H.on(this._updateOnElementChange))}),_.add(w.pressShiftKeyUpdated.on(H=>this._resizeManager.onPressShiftKey(H))),_.add($.slots.updated.on(this._updateOnSelectionChange)),_.add(y.slots.blockUpdated.on(this._updateOnElementChange)),_.add(R.slots.readonlyUpdated.on(()=>this.requestUpdate()))}updated(_){(_.has("_selectedRect")||_.has("_toolbarVisible")&&this._toolbarVisible)&&this._updateToolbarPosition()}_canRotate(){return!this.selection.elements.some(_=>_ instanceof FrameElement)}render(){const{selection:_,_remoteColorMap:y}=this,w=_.elements;if(!this._shouldRenderSelection(w))return x$1`<edgeless-remote-selection
        .edgeless=${this.edgeless}
        .remoteColorMap=${y}
      ></edgeless-remote-selection>`;const{edgeless:$,page:B,resizeMode:R,_resizeManager:H,_selectedRect:j,_toolbarPosition:q,_updateCursor:X}=this,te=!_.editing&&!B.readonly?ResizeHandles(R,(oe,ie)=>{oe.target.classList.contains("rotate")&&!this._canRotate()||H.onPointerDown(oe,ie)},(oe,ie)=>{ie?.type==="rotate"&&!this._canRotate()||X(oe,ie)}):A,ne=w.length===1&&w[0]instanceof ConnectorElement?x$1`<edgeless-connector-handle
            .connector=${w[0]}
            .edgeless=${$}
          ></edgeless-connector-handle>`:A;return x$1`
      <edgeless-remote-selection
        .edgeless=${$}
        .remoteColorMap=${y}
      ></edgeless-remote-selection>
      ${B.readonly?A:x$1`<edgeless-auto-complete
            .edgeless=${$}
            .selectedRect=${j}
          >
          </edgeless-auto-complete>`}
      <div
        class="affine-edgeless-selected-rect"
        style=${o$4({width:`${j.width}px`,height:`${j.height}px`,borderWidth:`${j.borderWidth}px`,borderStyle:j.borderStyle,borderRadius:`${j.borderRadius}px`,transform:`translate(${j.left}px, ${j.top}px) rotate(${j.rotate}deg)`})}
        disabled="true"
      >
        ${te} ${ne}
      </div>
      ${this._toolbarVisible&&!B.readonly?x$1`<edgeless-component-toolbar
            style=${o$4({left:`${q.x}px`,top:`${q.y}px`})}
            .edgeless=${$}
          >
          </edgeless-component-toolbar>`:A}
    `}};EdgelessSelectedRect.enabledWarnings=[];EdgelessSelectedRect.styles=i$5`
    :host {
      display: block;
      user-select: none;
    }

    .affine-edgeless-selected-rect {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: center center;
      border-radius: 0;
      pointer-events: none;
      box-sizing: border-box;
      z-index: 1;
      border-color: var(--affine-blue);
      border-width: var(--affine-border-width);
      border-style: solid;
      transform: translate(0, 0) rotate(0);
    }

    .affine-edgeless-selected-rect .handle {
      position: absolute;
      user-select: none;
      outline: none;
      pointer-events: auto;

      /**
       * Fix: pointerEvent stops firing after a short time.
       * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,
       * up to the one that implements the gesture (in other words, the first containing scrolling element)
       * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action
       */
      touch-action: none;
    }

    .affine-edgeless-selected-rect .handle[aria-label^='top-'],
    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] {
      width: 18px;
      height: 18px;
      box-sizing: border-box;
      z-index: 10;
    }

    .affine-edgeless-selected-rect .handle[aria-label^='top-'] .resize,
    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] .resize {
      position: absolute;
      width: 12px;
      height: 12px;
      box-sizing: border-box;
      border-radius: 50%;
      border: 2px var(--affine-blue) solid;
      background: white;
    }

    .affine-edgeless-selected-rect .handle[aria-label^='top-'] .rotate,
    .affine-edgeless-selected-rect .handle[aria-label^='bottom-'] .rotate {
      position: absolute;
      width: 12px;
      height: 12px;
      box-sizing: border-box;
      background: transparent;
    }

    /* -18 + 6.5 */
    .affine-edgeless-selected-rect .handle[aria-label='top-left'] {
      left: -12px;
      top: -12px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top-left'] .resize {
      right: 0;
      bottom: 0;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top-left'] .rotate {
      right: 6px;
      bottom: 6px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='top-right'] {
      top: -12px;
      right: -12px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top-right'] .resize {
      left: 0;
      bottom: 0;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top-right'] .rotate {
      left: 6px;
      bottom: 6px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] {
      right: -12px;
      bottom: -12px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] .resize {
      left: 0;
      top: 0;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom-right'] .rotate {
      left: 6px;
      top: 6px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] {
      bottom: -12px;
      left: -12px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] .resize {
      right: 0;
      top: 0;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom-left'] .rotate {
      right: 6px;
      top: 6px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='top'],
    .affine-edgeless-selected-rect .handle[aria-label='bottom'],
    .affine-edgeless-selected-rect .handle[aria-label='left'],
    .affine-edgeless-selected-rect .handle[aria-label='right'] {
      border: 0;
      background: transparent;
    }

    .affine-edgeless-selected-rect .handle[aria-label='left'],
    .affine-edgeless-selected-rect .handle[aria-label='right'] {
      top: 0;
      bottom: 0;
      height: 100%;
      width: 6px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='top'],
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] {
      left: 0;
      right: 0;
      width: 100%;
      height: 6px;
    }

    /* calc(-1px - (6px - 1px) / 2) = -3.5px */
    .affine-edgeless-selected-rect .handle[aria-label='left'] {
      left: -3.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='right'] {
      right: -3.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top'] {
      top: -3.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] {
      bottom: -3.5px;
    }

    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize,
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize,
    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize,
    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize {
      width: 100%;
      height: 100%;
    }

    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after,
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after,
    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after,
    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {
      position: absolute;
      width: 7px;
      height: 7px;
      box-sizing: border-box;
      border-radius: 6px;
      z-index: 10;
      border: 2px var(--affine-blue) solid;
      content: '';
      background: white;
    }

    .affine-edgeless-selected-rect
      .handle[aria-label='top']
      .transparent-handle:after,
    .affine-edgeless-selected-rect
      .handle[aria-label='bottom']
      .transparent-handle:after,
    .affine-edgeless-selected-rect
      .handle[aria-label='left']
      .transparent-handle:after,
    .affine-edgeless-selected-rect
      .handle[aria-label='right']
      .transparent-handle:after {
      opacity: 0;
    }

    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after,
    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {
      top: calc(50% - 6px);
    }

    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after,
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after {
      left: calc(50% - 6px);
    }

    .affine-edgeless-selected-rect .handle[aria-label='left'] .resize:after {
      left: -0.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='right'] .resize:after {
      right: -0.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='top'] .resize:after {
      top: -0.5px;
    }
    .affine-edgeless-selected-rect .handle[aria-label='bottom'] .resize:after {
      bottom: -0.5px;
    }

    edgeless-component-toolbar {
      /* greater than handle */
      z-index: 11;
    }
  `;__decorate$1Y([n$a({attribute:!1})],EdgelessSelectedRect.prototype,"edgeless",void 0);__decorate$1Y([i$6("edgeless-component-toolbar")],EdgelessSelectedRect.prototype,"_componentToolbar",void 0);__decorate$1Y([i$6(".affine-edgeless-selected-rect")],EdgelessSelectedRect.prototype,"_selectedRectEl",void 0);__decorate$1Y([t$2()],EdgelessSelectedRect.prototype,"_selectedRect",void 0);__decorate$1Y([t$2()],EdgelessSelectedRect.prototype,"_toolbarVisible",void 0);__decorate$1Y([t$2()],EdgelessSelectedRect.prototype,"_toolbarPosition",void 0);EdgelessSelectedRect=__decorate$1Y([e$7("edgeless-selected-rect")],EdgelessSelectedRect);var __decorate$1X=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessToolbarButton=class extends EdgelessToolIconButton{render(){return x$1` ${super.render()} `}};EdgelessToolbarButton.styles=i$5`
    .icon-container {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      color: var(--affine-icon-color);
      border-radius: 4px;
      cursor: pointer;
    }

    .icon-container.active-mode-color[active] {
      color: var(--affine-primary-color);
    }

    .icon-container.active-mode-background[active] {
      background: var(--affine-hover-color);
    }

    .icon-container[disabled] {
      pointer-events: none;
      cursor: not-allowed;
    }

    .icon-container[coming] {
      cursor: not-allowed;
      color: var(--affine-text-disable-color);
    }

    ${tooltipStyle}

    tool-tip {
      z-index: 12;
    }
  `;EdgelessToolbarButton=__decorate$1X([e$7("edgeless-toolbar-button")],EdgelessToolbarButton);var __decorate$1W=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createShapeMenuPopper(k){const _=document.createElement("edgeless-shape-menu");assertExists(k.shadowRoot),k.shadowRoot.appendChild(_);const y=110,w=-40;return Object.assign(_.style,{left:`${y}px`,top:`${w}px`}),{element:_,dispose:()=>{_.remove()}}}let EdgelessShapeToolButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this.shapeStyle=ShapeStyle.Scribbled,this._shapeToolLocalState=null,this._shapeMenu=null}_toggleShapeMenu(){this._shapeMenu?(this._shapeMenu.dispose(),this._shapeMenu=null):(this._shapeMenu=createShapeMenuPopper(this),this._shapeMenu.element.edgelessTool=this.edgelessTool,this._shapeMenu.element.edgeless=this.edgeless)}updated(_){_.has("edgelessTool")&&(this.edgelessTool.type!=="shape"&&(this._shapeMenu?.dispose(),this._shapeMenu=null),this._shapeMenu&&(this._shapeMenu.element.edgelessTool=this.edgelessTool,this._shapeMenu.element.edgeless=this.edgeless))}_setShapeIconColor(_){this._shapeIconShapeGroup.style.fill=`var(${_})`}_tryLoadShapeLocalState(){const _="blocksuite:"+this.edgeless.page.id+":edgelessShape",y=sessionStorage.getItem(_);let w=null;return y&&(w=JSON.parse(y)),w}connectedCallback(){super.connectedCallback(),this._shapeToolLocalState=this._tryLoadShapeLocalState(),this.updateComplete.then(()=>{const _=this._shapeToolLocalState?.strokeColor??DEFAULT_SHAPE_STROKE_COLOR;this._setShapeIconColor(_)}),this._disposables.add(this.edgeless.slots.edgelessToolUpdated.on(_=>{if(_.type!=="shape"){this._shapeMenu?.dispose(),this._shapeMenu=null;return}const y={shape:_.shape,fillColor:_.fillColor,shapeStyle:_.shapeStyle,strokeColor:_.strokeColor};sessionStorage.setItem("blocksuite:"+this.edgeless.page.id+":edgelessShape",JSON.stringify(y)),this._shapeToolLocalState=y;const w=_.strokeColor;this._setShapeIconColor(w)}))}disconnectedCallback(){this._disposables.dispose(),this._shapeMenu?.dispose(),this._shapeMenu=null,super.disconnectedCallback()}render(){const _=this.edgelessTool?.type;return x$1`
      <edgeless-toolbar-button
        .tooltip=${this._shapeMenu?"":getTooltipWithShortcut("Shape","S")}
        .active=${_==="shape"}
        .activeMode=${"background"}
        .iconContainerPadding=${0}
        @click=${()=>{this.setEdgelessTool({type:"shape",shape:this._shapeToolLocalState?.shape??"rect",fillColor:this._shapeToolLocalState?.fillColor??DEFAULT_SHAPE_FILL_COLOR,strokeColor:this._shapeToolLocalState?.strokeColor??DEFAULT_SHAPE_STROKE_COLOR,shapeStyle:this._shapeToolLocalState?.shapeStyle??ShapeStyle.Scribbled}),this._toggleShapeMenu()}}
      >
        <div class="shape-button-group">
          ${EdgelessGeneralShapeIcon} ${ArrowUpIcon}
        </div>
      </edgeless-toolbar-button>
    `}};EdgelessShapeToolButton.styles=i$5`
    .shape-button-group {
      display: block;
      position: relative;
      width: 72px;
      height: 48px;
    }

    edgeless-toolbar-button svg {
      transition: 0.3s ease-in-out;
    }

    edgeless-toolbar-button:hover svg {
      scale: 1.15;
    }

    edgeless-toolbar-button svg + svg {
      position: absolute;
      top: 6px;
      right: 4px;
    }
  `;__decorate$1W([n$a({attribute:!1})],EdgelessShapeToolButton.prototype,"edgelessTool",void 0);__decorate$1W([n$a({attribute:!1})],EdgelessShapeToolButton.prototype,"edgeless",void 0);__decorate$1W([n$a({attribute:!1})],EdgelessShapeToolButton.prototype,"setEdgelessTool",void 0);__decorate$1W([n$a({attribute:!1})],EdgelessShapeToolButton.prototype,"shapeStyle",void 0);__decorate$1W([i$6(".shape-icon-shape-group")],EdgelessShapeToolButton.prototype,"_shapeIconShapeGroup",void 0);EdgelessShapeToolButton=__decorate$1W([e$7("edgeless-shape-tool-button")],EdgelessShapeToolButton);var __decorate$1V=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const DEFAULT_MENU_WIDTH=468;let EdgelessSlideMenu=class extends WithDisposable(s$2){constructor(){super(...arguments),this.menuWidth=DEFAULT_MENU_WIDTH,this.showNext=!0,this._onNextSlideButtonClick=()=>{const{clientWidth:_}=this._slideMenuContent,y=Math.abs(parseInt(getComputedStyle(this._slideMenuContent).left));if(y<_-this.menuWidth){const w=Math.min(_-this.menuWidth-y,this.menuWidth);this._slideMenuContent.style.left=`${-(y+w)}px`}},this._onPreviousSlideButtonClick=()=>{const _=Math.abs(parseInt(getComputedStyle(this._slideMenuContent).left));if(_>0){const y=Math.min(_,this.menuWidth);this._slideMenuContent.style.left=`${-_+y}px`}}}firstUpdated(){this._disposables.addFromEvent(this._slideMenuContent,"transitionend",()=>{this._previousSlideButton.style.opacity="1",this._nextSlideButton.style.opacity="1";const _=Math.abs(parseInt(getComputedStyle(this._slideMenuContent).left));_===0?this._previousSlideButton.style.opacity="0":_===this._slideMenuContent.clientWidth-this.menuWidth&&(this._nextSlideButton.style.opacity="0")})}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}render(){const _=o$4({"--menu-width":`${this.menuWidth}px`});return x$1`
      <div>
        <div
          class="previous-slide-button"
          @click=${this._onPreviousSlideButtonClick}
        >
          ${ArrowRightSmallIcon}
        </div>
        <div class="menu-container" style=${_}>
          <div class="slide-menu-content">
            <slot></slot>
          </div>
        </div>
        <div
          style=${o$4({display:this.showNext?"normal":"none"})}
          class="next-slide-button"
          @click=${this._onNextSlideButtonClick}
        >
          ${ArrowRightSmallIcon}
        </div>
      </div>
    `}};EdgelessSlideMenu.styles=i$5`
    .menu-container {
      display: flex;
      align-items: center;
      width: var(--menu-width);
      overflow-x: clip;
      position: relative;
      height: 40px;
      background: transparent;
      box-sizing: border-box;
      padding: 0 18px;
    }
    .slide-menu-content {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      left: 0;
      top: 0;
      height: 40px;
      transition: left 0.5s ease-in-out;
      padding: 0 16px;
    }
    .next-slide-button,
    .previous-slide-button {
      align-items: center;
      justify-content: center;
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1px solid var(--affine-border-color);
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      transition: transform 0.3s ease-in-out, opacity 0.5s ease-in-out;
      z-index: 12;
    }
    .next-slide-button {
      display: flex;
      opacity: 1;
      top: 50%;
      right: 0;
      transform: translate(50%, -50%) scale(0.75);
    }
    .next-slide-button:hover {
      cursor: pointer;
      transform: translate(50%, -50%) scale(1);
    }
    .previous-slide-button {
      opacity: 0;
      top: 50%;
      left: 0;
      transform: translate(-50%, -50%) scale(0.75);
    }
    .previous-slide-button:hover {
      cursor: pointer;
      transform: translate(-50%, -50%) scale(1);
    }
    .previous-slide-button svg {
      transform: rotate(180deg);
    }
  `;__decorate$1V([n$a({attribute:!1})],EdgelessSlideMenu.prototype,"menuWidth",void 0);__decorate$1V([n$a({attribute:!1})],EdgelessSlideMenu.prototype,"showNext",void 0);__decorate$1V([i$6(".next-slide-button")],EdgelessSlideMenu.prototype,"_nextSlideButton",void 0);__decorate$1V([i$6(".previous-slide-button")],EdgelessSlideMenu.prototype,"_previousSlideButton",void 0);__decorate$1V([i$6(".slide-menu-content")],EdgelessSlideMenu.prototype,"_slideMenuContent",void 0);EdgelessSlideMenu=__decorate$1V([e$7("edgeless-slide-menu")],EdgelessSlideMenu);var __decorate$1U=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessBrushMenu=class extends WithDisposable(s$2){constructor(){super(...arguments),this._setBrushColor=_=>{if(this.edgelessTool.type!=="brush")return;const{lineWidth:y}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"brush",color:_,lineWidth:y})},this._setLineWidth=_=>{if(this.edgelessTool.type!=="brush")return;const{color:y}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"brush",color:y,lineWidth:_})}}render(){if(this.edgelessTool.type!=="brush")return A;const{color:_,lineWidth:y}=this.edgelessTool;return x$1`
      <div class="container">
        <edgeless-slide-menu>
          <div class="menu-content">
            <edgeless-line-width-panel
              .selectedSize=${y}
              @select=${w=>this._setLineWidth(w.detail)}
            >
            </edgeless-line-width-panel>
            <menu-divider .vertical=${!0}></menu-divider>
            <edgeless-one-row-color-panel
              .value=${_}
              @select=${w=>this._setBrushColor(w.detail)}
            ></edgeless-one-row-color-panel>
          </div>
        </edgeless-slide-menu>
      </div>
    `}};EdgelessBrushMenu.styles=i$5`
    :host {
      display: flex;
      position: absolute;
      z-index: -1;
    }

    .container {
      display: flex;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border: 1px solid var(--affine-border-color);
      border-radius: 8px 8px 0 0;
      position: relative;
      cursor: default;
    }

    .menu-content {
      display: flex;
      align-items: center;
    }

    menu-divider {
      height: 24px;
      margin: 0 9px;
    }
  `;__decorate$1U([n$a({attribute:!1})],EdgelessBrushMenu.prototype,"edgelessTool",void 0);__decorate$1U([n$a({attribute:!1})],EdgelessBrushMenu.prototype,"edgeless",void 0);EdgelessBrushMenu=__decorate$1U([e$7("edgeless-brush-menu")],EdgelessBrushMenu);var __decorate$1T=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createBrushMenuPopper(k){const _=document.createElement("edgeless-brush-menu");assertExists(k.shadowRoot),k.shadowRoot.appendChild(_);const y=110,w=-40;return Object.assign(_.style,{left:`${y}px`,top:`${w}px`}),{element:_,dispose:()=>{_.remove()}}}let EdgelessBrushToolButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._brushMenu=null}_toggleBrushMenu(){this._brushMenu?(this._brushMenu.dispose(),this._brushMenu=null):(this._brushMenu=createBrushMenuPopper(this),this._brushMenu.element.edgelessTool=this.edgelessTool,this._brushMenu.element.edgeless=this.edgeless)}_setBrushColor(_){this._brushHeadRect.style.fill=`var(${_})`,this._brushMidlineRect.style.fill=`var(${_})`,this._brushMidlineStroke.style.stroke=`var(${_})`}_tryLoadBrushStateLocalColor(){const _="blocksuite:"+this.edgeless.page.id+":edgelessBrush",y=sessionStorage.getItem(_);let w=null;return y&&(w=JSON.parse(y).color),w}updated(_){_.has("edgelessTool")&&(this.edgelessTool.type!=="brush"&&(this._brushMenu?.dispose(),this._brushMenu=null),this._brushMenu&&(this._brushMenu.element.edgelessTool=this.edgelessTool,this._brushMenu.element.edgeless=this.edgeless))}connectedCallback(){super.connectedCallback(),this.updateComplete.then(()=>{let _=this._tryLoadBrushStateLocalColor();_||(_=DEFAULT_BRUSH_COLOR),this._setBrushColor(_)}),this._disposables.add(this.edgeless.slots.edgelessToolUpdated.on(_=>{_.type==="brush"?this._setBrushColor(_.color):(this._brushMenu?.dispose(),this._brushMenu=null)}))}disconnectedCallback(){this._disposables.dispose(),this._brushMenu?.dispose(),this._brushMenu=null,super.disconnectedCallback()}render(){const _=this.edgelessTool?.type;return x$1`
      <edgeless-toolbar-button
        .tooltip=${this._brushMenu?"":getTooltipWithShortcut("Pen","P")}
        .active=${_==="brush"}
        @click=${()=>{this.setEdgelessTool({type:"brush",lineWidth:LineWidth.LINE_WIDTH_FOUR,color:DEFAULT_BRUSH_COLOR}),this._toggleBrushMenu()}}
      >
        <div class="edgeless-brush-button">
          <div class=${_==="brush"?"active-mode":""}></div>
          ${EdgelessPenIcon}
          <div class="arrow-up-icon">${ArrowUpIcon}</div>
        </div>
      </edgeless-toolbar-button>
    `}};EdgelessBrushToolButton.styles=i$5`
    :host {
      display: flex;
    }
    .edgeless-brush-button {
      position: relative;
      height: 66px;
      width: 40px;
      overflow-y: hidden;
    }
    #edgeless-pen-icon {
      position: absolute;
      top: 10px;
      left: 3px;
      transition: top 0.3s ease-in-out;
    }
    .active-mode {
      height: 66px;
      width: 40px;
      top: 10px;
      position: absolute;
      border-top-left-radius: 30px;
      border-top-right-radius: 30px;
      background: var(--affine-hover-color);
    }
    #edgeless-pen-icon:hover {
      top: 2px;
    }
    .arrow-up-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      right: 2px;
      top: 12px;
      width: 14px;
      height: 14px;
      fill: var(--affine-icon-color);
    }
    .arrow-up-icon:hover {
      background: var(--affine-hover-color);
    }
  `;__decorate$1T([n$a({attribute:!1})],EdgelessBrushToolButton.prototype,"edgelessTool",void 0);__decorate$1T([n$a({attribute:!1})],EdgelessBrushToolButton.prototype,"edgeless",void 0);__decorate$1T([n$a({attribute:!1})],EdgelessBrushToolButton.prototype,"setEdgelessTool",void 0);__decorate$1T([i$6(".brush-head-rect")],EdgelessBrushToolButton.prototype,"_brushHeadRect",void 0);__decorate$1T([i$6(".brush-midline-rect")],EdgelessBrushToolButton.prototype,"_brushMidlineRect",void 0);__decorate$1T([i$6(".brush-midline-stroke")],EdgelessBrushToolButton.prototype,"_brushMidlineStroke",void 0);EdgelessBrushToolButton=__decorate$1T([e$7("edgeless-brush-tool-button")],EdgelessBrushToolButton);var __decorate$1S=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const CONNECTOR_SUBMENU_WIDTH=474;function ConnectorModeButtonGroup(k,_){if(k.type!=="connector")return A;const{mode:y}=k,w=getTooltipWithShortcut("Straight","L"),$=getTooltipWithShortcut("Elbowed","X");return x$1`
    <div class="connector-mode-button-group">
      <edgeless-tool-icon-button
        .active=${y===ConnectorMode.Straight}
        .activeMode=${"background"}
        .iconContainerPadding=${2}
        .tooltip=${w}
        @click=${()=>_(ConnectorMode.Straight)}
      >
        ${ConnectorLWithArrowIcon}
      </edgeless-tool-icon-button>
      <edgeless-tool-icon-button
        .active=${y===ConnectorMode.Orthogonal}
        .activeMode=${"background"}
        .iconContainerPadding=${2}
        .tooltip=${$}
        @click=${()=>_(ConnectorMode.Orthogonal)}
      >
        ${ConnectorXWithArrowIcon}
      </edgeless-tool-icon-button>
    </div>
  `}let EdgelessConnectorMenu=class extends s$2{constructor(){super(...arguments),this._setConnectorColor=_=>{if(this.edgelessTool.type!=="connector")return;const{mode:y,strokeWidth:w}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"connector",color:_,mode:y,strokeWidth:w})},this._setConnectorMode=_=>{if(this.edgelessTool.type!=="connector")return;const{color:y,strokeWidth:w}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"connector",color:y,mode:_,strokeWidth:w})},this._setConnectorStrokeWidth=_=>{if(this.edgelessTool.type!=="connector")return;const{color:y,mode:w}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"connector",color:y,mode:w,strokeWidth:_})}}render(){if(this.edgelessTool.type!=="connector")return A;const{color:_,strokeWidth:y}=this.edgelessTool,w=ConnectorModeButtonGroup(this.edgelessTool,this._setConnectorMode);return x$1`
      <div class="connector-submenu-container">
        <edgeless-slide-menu .menuWidth=${CONNECTOR_SUBMENU_WIDTH}>
          <div class="connector-submenu-content">
            ${w}
            <div class="submenu-divider"></div>
            <edgeless-line-width-panel
              .selectedSize=${y}
              @select=${$=>this._setConnectorStrokeWidth($.detail)}
            >
            </edgeless-line-width-panel>
            <div class="submenu-divider"></div>
            <edgeless-one-row-color-panel
              .value=${_}
              @select=${$=>this._setConnectorColor($.detail)}
            ></edgeless-one-row-color-panel>
          </div>
        </edgeless-slide-menu>
      </div>
    `}};EdgelessConnectorMenu.styles=i$5`
    :host {
      position: absolute;
      display: flex;
      z-index: -1;
    }

    .connector-submenu-container {
      display: flex;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border: 1px solid var(--affine-border-color);
      border-radius: 8px 8px 0 0;
      cursor: default;
    }

    .connector-submenu-content {
      display: flex;
      height: 24px;
      align-items: center;
      justify-content: center;
    }

    .connector-mode-button-group {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
    }

    .connector-mode-button-group > edgeless-tool-icon-button svg {
      fill: var(--affine-icon-color);
    }

    .submenu-divider {
      width: 1px;
      height: 24px;
      margin: 0 16px;
      background-color: var(--affine-border-color);
      display: inline-block;
    }

    ${tooltipStyle}

    tool-tip {
      z-index: 12;
    }
  `;__decorate$1S([n$a({attribute:!1})],EdgelessConnectorMenu.prototype,"edgelessTool",void 0);__decorate$1S([n$a({attribute:!1})],EdgelessConnectorMenu.prototype,"edgeless",void 0);EdgelessConnectorMenu=__decorate$1S([e$7("edgeless-connector-menu")],EdgelessConnectorMenu);var __decorate$1R=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createConnectorMenuPopper(k){const _=document.createElement("edgeless-connector-menu");assertExists(k.shadowRoot),k.shadowRoot.appendChild(_);const y=110,w=-40;return Object.assign(_.style,{left:`${y}px`,top:`${w}px`}),{element:_,dispose:()=>{_.remove()}}}let EdgelessConnectorToolButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._connectorMenu=null}_toggleMenu(){this._connectorMenu?(this._connectorMenu.dispose(),this._connectorMenu=null):(this._connectorMenu=createConnectorMenuPopper(this),this._connectorMenu.element.edgelessTool=this.edgelessTool,this._connectorMenu.element.edgeless=this.edgeless)}updated(_){_.has("edgelessTool")&&(this.edgelessTool.type!=="connector"&&(this._connectorMenu?.dispose(),this._connectorMenu=null),this._connectorMenu&&(this._connectorMenu.element.edgelessTool=this.edgelessTool,this._connectorMenu.element.edgeless=this.edgeless))}connectedCallback(){super.connectedCallback(),this._disposables.add(this.edgeless.slots.edgelessToolUpdated.on(_=>{_.type!=="connector"&&(this._connectorMenu?.dispose(),this._connectorMenu=null)}))}disconnectedCallback(){this._connectorMenu?.dispose(),this._connectorMenu=null,super.disconnectedCallback()}render(){const _=this.edgelessTool?.type;return x$1`
      <edgeless-toolbar-button
        .tooltip=${this._connectorMenu?"":"Connector"}
        .active=${_==="connector"}
        .activeMode=${"background"}
        class="edgeless-connector-button"
        @click=${()=>{this.setEdgelessTool({type:"connector",mode:ConnectorMode.Orthogonal,color:GET_DEFAULT_LINE_COLOR(),strokeWidth:LineWidth.LINE_WIDTH_TWO}),this._toggleMenu()}}
      >
        ${EdgelessConnectorIcon}
      </edgeless-toolbar-button>
    `}};EdgelessConnectorToolButton.styles=i$5`
    :host {
      display: flex;
    }
    .edgeless-connector-button {
      display: flex;
      position: relative;
    }
    edgeless-toolbar-button svg {
      transition: 0.3s ease-in-out;
    }
    edgeless-toolbar-button:hover svg {
      transform: scale(1.15);
    }
  `;__decorate$1R([n$a({attribute:!1})],EdgelessConnectorToolButton.prototype,"edgelessTool",void 0);__decorate$1R([n$a({attribute:!1})],EdgelessConnectorToolButton.prototype,"edgeless",void 0);__decorate$1R([n$a({attribute:!1})],EdgelessConnectorToolButton.prototype,"setEdgelessTool",void 0);EdgelessConnectorToolButton=__decorate$1R([e$7("edgeless-connector-tool-button")],EdgelessConnectorToolButton);var __decorate$1Q=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DragIndicator=class extends s$2{constructor(){super(...arguments),this.rect=null}render(){if(!this.rect)return null;const{left:_,top:y,width:w,height:$}=this.rect,B=o$4({width:`${w}px`,height:`${$}px`,transform:`translate(${_}px, ${y}px)`});return x$1`<div class="affine-drag-indicator" style=${B}></div>`}};DragIndicator.styles=i$5`
    .affine-drag-indicator {
      position: absolute;
      top: 0;
      left: 0;
      background: var(--affine-primary-color);
      transition-property: width, height, transform;
      transition-duration: 100ms;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-delay: 0s;
      transform-origin: 0 0;
      pointer-events: none;
      z-index: 2;
    }
  `;__decorate$1Q([n$a({attribute:!1})],DragIndicator.prototype,"rect",void 0);DragIndicator=__decorate$1Q([e$7("affine-drag-indicator")],DragIndicator);var __decorate$1P=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const BLOCKHUB_TEXT_ITEMS=[{flavour:"affine:paragraph",type:"text",name:"Text",description:"Start typing with plain text.",icon:TextIcon,tooltip:"Drag/Click to insert Text block"},{flavour:"affine:paragraph",type:"h1",name:"Heading 1",description:"Headings in the largest font.",icon:Heading1Icon,tooltip:"Drag/Click to insert Heading 1"},{flavour:"affine:paragraph",type:"h2",name:"Heading 2",description:"Headings in the 2nd font size.",icon:Heading2Icon,tooltip:"Drag/Click to insert Heading 2"},{flavour:"affine:paragraph",type:"h3",name:"Heading 3",description:"Headings in the 3rd font size.",icon:Heading3Icon,tooltip:"Drag/Click to insert Heading 3"},{flavour:"affine:paragraph",type:"h4",name:"Heading 4",description:"Heading in the 4th font size.",icon:Heading4Icon,tooltip:"Drag/Click to insert Heading 4"},{flavour:"affine:paragraph",type:"h5",name:"Heading 5",description:"Heading in the 5th font size.",icon:Heading5Icon,tooltip:"Drag/Click to insert Heading 5"},{flavour:"affine:paragraph",type:"h6",name:"Heading 6",description:"Heading in the 6th font size.",icon:Heading6Icon,tooltip:"Drag/Click to insert Heading 6"},{flavour:"affine:code",type:null,name:"Code Block",description:"Capture a code snippet.",icon:CodeBlockIcon,tooltip:"Drag/Click to insert Code Block"},{flavour:"affine:paragraph",type:"quote",name:"Quote",description:"Capture a quote.",icon:QuoteIcon,tooltip:"Drag/Click to insert Quote"},{flavour:"affine:divider",type:null,name:"Divider",description:"A visual divider.",icon:DividerIcon,tooltip:"A visual divider"}],BLOCKHUB_LIST_ITEMS=[{flavour:"affine:list",type:"bulleted",name:"Bulleted List",description:"A simple bulleted list.",icon:BulletedListIcon,tooltip:"Drag/Click to insert Bulleted List"},{flavour:"affine:list",type:"numbered",name:"Numbered List",description:"A list with numbering.",icon:NumberedListIcon,tooltip:"Drag/Click to insert Numbered List"},{flavour:"affine:list",type:"todo",name:"To-do List",description:"Track tasks with a to-do list.",icon:CheckBoxIcon,tooltip:"Drag/Click to insert To-do List"}],BLOCKHUB_FILE_ITEMS=[{flavour:"affine:image",type:"image",name:"Image",description:"Upload images.",icon:ImageIcon,tooltip:"Drag/Click to insert Image"},{flavour:"affine:bookmark",type:"bookmark",name:"Bookmark",description:"Insert a link in card view.",icon:BookmarkIcon,tooltip:"Drag/Click to insert Bookmark"}],styles$o=i$5`
  affine-block-hub {
    position: absolute;
    z-index: 1;
    user-select: none;
  }

  @media print {
    affine-block-hub {
      display: none;
    }
  }

  .affine-block-hub-container {
    width: 274px;
    position: absolute;
    right: calc(100% + 8px);
    overflow-y: unset;
    display: none;
    justify-content: center;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
    font-size: var(--affine-font-sm);
    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-menu-shadow);
    border-radius: 8px;
  }

  .affine-block-hub-container[type='text'] {
    top: unset;
    bottom: 0;
    transform: unset;
    right: calc(100% + 4px);
  }

  .visible {
    display: block;
  }

  .invisible {
    display: none;
  }

  .card-container-wrapper {
    width: 100%;
    display: flex;
    justify-content: center;
    position: relative;
  }

  .card-container {
    display: flex;
    position: relative;
    align-items: center;
    width: 250px;
    height: 54px;
    background: var(--affine-white-80);
    box-shadow: var(--affine-shadow-1);
    border-radius: 8px;
    margin-bottom: 12px;
    cursor: grab;
    top: 0;
    left: 0;
    transition: all 0.1s ease-in-out;
  }

  .card-icon-container {
    display: flex;
    align-items: center;
    position: absolute;
    right: 12px;
  }

  .card-icon-container > svg {
    width: 20px;
    height: 20px;
  }

  .card-container-inner:hover .card-container {
    background: var(--affine-hover-color);
    top: -2px;
    left: -2px;
  }

  .card-container-inner:hover .card-container.grabbing {
    top: unset;
    left: unset;
    box-shadow: var(--affine-shadow-2);
  }

  .card-description-container {
    display: block;
    width: 190px;
    color: var(--affine-text-primary-color);
    font-size: var(--affine-font-base);
    line-height: var(--affine-line-height);
    margin: 8px 0 8px 12px;
    text-align: justify;
  }

  .affine-block-hub-container .description {
    font-size: var(--affine-font-sm);
    line-height: var(--affine-line-height);
    color: var(--affine-text-secondary-color);
    white-space: pre;
  }

  .grabbing {
    cursor: grabbing;
  }

  .grab {
    cursor: grab;
  }

  .affine-block-hub-title-container {
    margin: 16px 0 20px 12px;
    color: var(--affine-text-secondary-color);
    font-size: var(--affine-font-base);
    user-select: none;
  }

  .prominent {
    z-index: 1;
  }

  .block-hub-menu-container {
    display: flex;
    font-family: var(--affine-font-family);
    flex-flow: column;
    justify-content: center;
    align-items: center;
    position: fixed;
    width: 44px;
    background: var(--affine-background-primary-color);
    border-radius: 8px;
  }

  .block-hub-menu-container[expanded] {
    box-shadow: var(--affine-menu-shadow);
    background: var(--affine-background-overlay-panel-color);
  }

  .block-hub-icon-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 8px;
    position: relative;
    border-radius: 4px;
    color: var(--affine-icon-color);
    height: 36px;
  }
  .block-hub-icon-container svg {
    width: 24px;
    height: 24px;
  }

  .block-hub-icon-container[selected='true'] {
    background: var(--affine-hover-color);
  }

  .block-hub-icon-container:hover {
    background: var(--affine-hover-color);
    border-radius: 4px;
  }

  .new-icon {
    width: 44px;
    height: 44px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border-radius: 8px;
    color: var(--affine-icon-color);
  }

  .new-icon-in-edgeless {
    box-shadow: var(--affine-menu-shadow);
  }
  .block-hub-menu-container[expanded] .new-icon {
    border-radius: 4px;
    box-shadow: unset;
  }

  .new-icon:hover {
    box-shadow: var(--affine-menu-shadow);
    background: var(--affine-white);
  }

  .icon-expanded {
    width: 36px;
    height: 36px;
  }

  .icon-expanded:hover {
    background: var(--affine-hover-color);
  }

  [role='menuitem'] tool-tip {
    font-size: var(--affine-font-sm);
  }

  .block-hub-icons-container {
    width: 100%;
    overflow: hidden;
    transition: all 0.2s cubic-bezier(0, 0, 0.55, 1.6);
  }

  .block-hub-icons-container > .divider {
    height: 1px;
    width: 36px;
    background: var(--affine-border-color);
    margin: 4px 0;
  }

  ${tooltipStyle}
`,TRANSITION_DELAY=200,BOTTOM_OFFSET=70,RIGHT_OFFSET=24,TOP_DISTANCE=24;function shouldDisplayCard(k,_,y,w){return _&&y&&w===k}function BlockHubCards(k,_,y,w,$,B,R){const H=w<800,j=o$4({maxHeight:`${w}px`,overflowY:H?"scroll":"unset"});return x$1`
    <div
      class="affine-block-hub-container ${$?"visible":""}"
      style="${j}"
      type=${_}
    >
      <div class="affine-block-hub-title-container">${y}</div>
      ${k.map(({flavour:q,type:X,name:ee,description:te,icon:ne,tooltip:oe},ie)=>x$1`
            <div class="card-container-wrapper">
              <div class="card-container-inner">
                <div
                  class="card-container has-tool-tip ${B?"grabbing":""}"
                  draggable="true"
                  affine-flavour=${q}
                  affine-type=${X??""}
                >
                  <div class="card-description-container">
                    <div>${ee}</div>
                    <div class="description">${te}</div>
                  </div>
                  <div class="card-icon-container">${ne}</div>
                  <tool-tip
                    tip-position=${H&&ie===k.length-1?"top":"bottom"}
                    style="${R?"":"display: none"}; z-index: ${k.length-ie}"
                    arrow
                    >${oe}</tool-tip
                  >
                </div>
              </div>
            </div>
          `)}
    </div>
  `}function BlockHubMenu(k,_,y,w,$,B,R,H){const q=(k?5:4)*44+10,X=BlockHubCards(BLOCKHUB_LIST_ITEMS,"list","List",R,shouldDisplayCard("list",_,$,w),y,B),ee=BlockHubCards(BLOCKHUB_FILE_ITEMS.filter(({flavour:te})=>te==="affine:bookmark"?H.awarenessStore.getFlag("enable_bookmark_operation"):!0),"file","Content & Media",R,shouldDisplayCard("file",_,$,w),y,B);return x$1`
    <div
      class="block-hub-icons-container"
      ?transition=${_}
      style="height: ${_?`${q}px`:"0"};"
    >
      <div
        class="block-hub-icon-container has-tool-tip ${y?"grabbing":"grab"}"
        selected=${w==="blank"?"true":"false"}
        type="blank"
        draggable="true"
        affine-flavour="affine:paragraph"
        affine-type="text"
      >
        ${BlockHubRoundedRectangleIcon}
        <tool-tip
          inert
          role="tooltip"
          tip-position="left"
          arrow
          ?hidden=${!B}
          >Drag to insert blank line
        </tool-tip>
      </div>
      <div
        class="block-hub-icon-container"
        type="text"
        selected=${w==="text"?"true":"false"}
      >
        ${TextIconLarge}
      </div>
      <div
        class="block-hub-icon-container"
        type="list"
        selected=${w==="list"?"true":"false"}
      >
        ${X} ${NumberedListIconLarge}
      </div>
      <div
        class="block-hub-icon-container"
        type="file"
        selected=${w==="file"?"true":"false"}
      >
        ${ee} ${EmbedIcon}
      </div>
      ${k?x$1`
            <div
              class="block-hub-icon-container has-tool-tip"
              type="database"
              draggable="true"
              affine-flavour="affine:database"
              selected=${w==="database"?"true":"false"}
            >
              ${DatabaseTableViewIcon}
              <tool-tip
                inert
                role="tooltip"
                tip-position="left"
                arrow
                ?hidden=${!B}
              >
                Drag to create a database
              </tool-tip>
            </div>
          `:null}
      <div class="divider"></div>
    </div>
  `}let BlockHub=class extends WithDisposable(ShadowlessElement){constructor(_){super(),this._expanded=!1,this._isGrabbing=!1,this._visibleCardType=null,this._showTooltip=!0,this._inEdgelessMode=!1,this._maxHeight=2e3,this._currentClientX=0,this._currentClientY=0,this._isCardListVisible=!1,this._lastDroppingTarget=null,this._lastDroppingType="none",this._lastDraggingFlavour=null,this._timer=null,this._onTransitionStart=y=>{this._timer&&clearTimeout(this._timer),this._expanded?(this._blockHubMenuContainer.style.padding="4px",this._timer=window.setTimeout(()=>{this._blockHubIconsContainer.style.overflow="unset"},TRANSITION_DELAY)):(this._blockHubMenuContainer.style.padding="0 4px",this._timer=window.setTimeout(()=>{this._blockHubIconsContainer.style.overflow="hidden"},TRANSITION_DELAY))},this._onClickOutside=y=>{const w=y.target;w instanceof HTMLElement&&!w.closest("affine-block-hub")&&this._hideCardList()},this._onClickCard=(y,w)=>{const $=w.getAttribute("affine-type");assertExists($);const B={flavour:w.getAttribute("affine-flavour")??""};$&&(B.type=$),this._onClickCardCallback(B)},this._onBlockHubButtonClick=y=>{this._expanded=!this._expanded,this._expanded||this._hideCardList()},this._onDragStart=y=>{this._showTooltip=!1,assertExists(y.dataTransfer),y.dataTransfer.effectAllowed="move";const w=y.target,$=w.getAttribute("affine-type"),B={flavour:w.getAttribute("affine-flavour")};$&&(B.type=$),y.dataTransfer.setData("affine/block-hub",JSON.stringify(B)),this._lastDraggingFlavour=B.flavour,this._onDragStartCallback()},this._onMouseDown=y=>{IS_FIREFOX&&(this._currentClientX=y.clientX,this._currentClientY=y.clientY)},this._onDrag=y=>{this._hideCardList();let w=y.clientX,$=y.clientY;if(IS_FIREFOX&&(w=this._currentClientX,$=this._currentClientY),!this._indicator||this._indicator.rect&&this._indicator.rect.left===w&&this._indicator.rect.top===$)return;const B=new Point(w,$),{container:R,rect:H,scale:j}=this.getHoveringNoteState(B.clone());if(!H){this._resetDropState();return}const q=getClosestBlockElementByPoint(B,{container:R,rect:H,snapToEdge:{x:!1,y:!0}},j);if(!q){this._resetDropState();return}let X="none",ee=null,te=null;const ne=getModelByBlockElement(q),oe=calcDropTarget(B,ne,q,[],j,this._lastDraggingFlavour);oe&&(X=oe.type,ee=oe.rect,te=oe.modelState),this._lastDroppingType=X,this._indicator.rect=ee,this._lastDroppingTarget=te},this._onDragOver=y=>(y.preventDefault(),!1),this._onDragOverDocument=y=>{if(!IS_FIREFOX)throw new Error("FireFox only");this._currentClientX=y.clientX,this._currentClientY=y.clientY},this._onDragEnd=y=>{this._showTooltip=!0,this._isGrabbing=!1,this._lastDraggingFlavour=null,this._resetDropState()},this._resetDropState=()=>{this._lastDroppingType="none",this._indicator.rect=null,this._lastDroppingTarget=null},this._onDrop=y=>{assertExists(y.dataTransfer),y.dataTransfer.getData("affine/block-hub")&&this._onDropCallback(y,this._indicator?.rect?.min??new Point(y.clientX,y.clientY),this._lastDroppingTarget,this._lastDroppingType)},this._onCardMouseDown=y=>{this._isGrabbing=!0},this._onCardMouseUp=y=>{this._isGrabbing=!1},this._onBlankMenuMouseDown=()=>{this._isGrabbing=!0},this._onBlankMenuMouseUp=()=>{this._isGrabbing=!1},this._onBlockHubMenuMouseOver=y=>{const $=y.currentTarget.getAttribute("type");assertExists($),this._isCardListVisible=!0,this._visibleCardType=$},this._onBlockHubEntryMouseOver=()=>{this._isCardListVisible=!1},this._onResize=()=>{const y=document.body.getBoundingClientRect();this._maxHeight=y.height-TOP_DISTANCE-BOTTOM_OFFSET},this._page=_.page,this._mouseRoot=_.mouseRoot,this._enableDatabase=_.enableDatabase,this.getAllowedBlocks=_.getAllowedBlocks,this.getHoveringNoteState=_.getHoveringNoteState,this._onDragStartCallback=_.onDragStart,this._onDropCallback=_.onDrop,this._onClickCardCallback=_.onClickCard}connectedCallback(){super.connectedCallback();const _=this._disposables;_.addFromEvent(this,"dragstart",this._onDragStart),_.addFromEvent(this,"drag",this._onDrag),_.addFromEvent(this,"dragend",this._onDragEnd),_.addFromEvent(this._mouseRoot,"dragover",this._onDragOver),_.addFromEvent(this._mouseRoot,"drop",this._onDrop),_.addFromEvent(this,"mousedown",this._onMouseDown),_.add(this._mouseRoot.slots.pageModeSwitched.on(y=>{this._inEdgelessMode=y==="edgeless"})),IS_FIREFOX&&_.addFromEvent(this._mouseRoot,"dragover",this._onDragOverDocument),this._onResize()}firstUpdated(){const _=this._disposables;this._blockHubCards.forEach(y=>{_.addFromEvent(y,"mousedown",this._onCardMouseDown),_.addFromEvent(y,"mouseup",this._onCardMouseUp),_.addFromEvent(y,"click",w=>this._onClickCard(w,y))});for(const y of this._blockHubMenus)_.addFromEvent(y,"mouseover",this._onBlockHubMenuMouseOver),y.getAttribute("type")==="blank"&&(_.addFromEvent(y,"mousedown",this._onBlankMenuMouseDown),_.addFromEvent(y,"mouseup",this._onBlankMenuMouseUp));_.addFromEvent(this._blockHubMenuEntry,"mouseover",this._onBlockHubEntryMouseOver),_.addFromEvent(document,"click",this._onClickOutside),_.addFromEvent(this._blockHubButton,"click",this._onBlockHubButtonClick),_.addFromEvent(this._blockHubButton,"mousedown",y=>{y.preventDefault()}),_.addFromEvent(this._blockHubIconsContainer,"transitionstart",this._onTransitionStart),_.addFromEvent(window,"resize",this._onResize),this._indicator=document.querySelector("affine-drag-indicator"),this._indicator||(this._indicator=document.createElement("affine-drag-indicator"),document.body.appendChild(this._indicator))}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}toggleMenu(){this._expanded=!this._expanded,this._expanded||this._hideCardList()}_hideCardList(){this._visibleCardType&&(this._visibleCardType=null,this._isCardListVisible=!1)}render(){const _=BlockHubMenu(this._enableDatabase,this._expanded,this._isGrabbing,this._visibleCardType,this._isCardListVisible,this._showTooltip,this._maxHeight,this._page),y=BlockHubCards(BLOCKHUB_TEXT_ITEMS,"text","Text block",this._maxHeight,shouldDisplayCard("text",this._expanded,this._isCardListVisible,this._visibleCardType),this._isGrabbing,this._showTooltip),w=o$3({"icon-expanded":this._expanded,"new-icon-in-edgeless":this._inEdgelessMode&&!this._expanded,"has-tool-tip":!0,"new-icon":!0});return x$1`
      <div
        class="block-hub-menu-container"
        ?expanded=${this._expanded}
        style="bottom: ${BOTTOM_OFFSET}px; right: ${RIGHT_OFFSET}px;"
      >
        ${_}
        <div class=${w} role="menuitem" style="cursor:pointer;">
          ${this._expanded?CrossIcon:BlockHubIcon}
          <tool-tip
            class=${this._expanded?"invisible":""}
            inert
            tip-position="left"
            role="tooltip"
            arrow
            >Insert blocks
          </tool-tip>
        </div>
        ${y}
      </div>
    `}};BlockHub.styles=styles$o;__decorate$1P([n$a({attribute:!1})],BlockHub.prototype,"getAllowedBlocks",void 0);__decorate$1P([n$a({attribute:!1})],BlockHub.prototype,"getHoveringNoteState",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_expanded",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_isGrabbing",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_visibleCardType",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_showTooltip",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_inEdgelessMode",void 0);__decorate$1P([t$2()],BlockHub.prototype,"_maxHeight",void 0);__decorate$1P([e$5(".card-container")],BlockHub.prototype,"_blockHubCards",void 0);__decorate$1P([e$5(".block-hub-icon-container[type]")],BlockHub.prototype,"_blockHubMenus",void 0);__decorate$1P([i$6(".new-icon")],BlockHub.prototype,"_blockHubButton",void 0);__decorate$1P([i$6(".block-hub-icons-container")],BlockHub.prototype,"_blockHubIconsContainer",void 0);__decorate$1P([i$6(".block-hub-menu-container")],BlockHub.prototype,"_blockHubMenuContainer",void 0);__decorate$1P([i$6('[role="menuitem"]')],BlockHub.prototype,"_blockHubMenuEntry",void 0);BlockHub=__decorate$1P([e$7("affine-block-hub")],BlockHub);const NOTE_MENU_ITEMS=BLOCKHUB_TEXT_ITEMS.concat(BLOCKHUB_LIST_ITEMS).filter(k=>k.name!=="Divider").map(k=>({icon:k.icon,tooltip:k.type!=="text"?k.tooltip.replace("Drag/Click to insert ",""):"Text",childFlavour:k.flavour,childType:k.type})),NOTE_MENU_WIDTH=442,TOP_END_TOOLTIP_TYPE=["text","h1"],TOP_START_TOOLTIP_TYPE=["bulleted","numbered","todo"];var __decorate$1O=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessNoteMenu=class extends WithDisposable(s$2){_updateNoteTool(_,y,w){if(this.edgelessTool.type!=="note")return;const{background:$}=this.edgelessTool;this.edgeless.slots.edgelessToolUpdated.emit({type:"note",background:$,childFlavour:_,childType:y,tip:w})}_getTooltipPosition(_){return _?TOP_END_TOOLTIP_TYPE.includes(_)?"top-end":TOP_START_TOOLTIP_TYPE.includes(_)?"top-start":"top":"top"}render(){if(this.edgelessTool.type!=="note")return A;const{childType:_}=this.edgelessTool;return x$1`
      <div class="note-menu-container">
        <edgeless-slide-menu .menuWidth=${NOTE_MENU_WIDTH}>
          <div class="menu-content">
            <div class="button-group-label">Blocks</div>
            <div class="button-group-container">
              ${NOTE_MENU_ITEMS.map(y=>x$1`
                  <edgeless-tool-icon-button
                    .active=${_===y.childType}
                    .activeMode=${"background"}
                    .iconContainerPadding=${2}
                    .tooltip=${y.tooltip}
                    .tipPosition=${this._getTooltipPosition(y.childType)}
                    @click=${()=>this._updateNoteTool(y.childFlavour,y.childType,y.tooltip)}
                  >
                    ${y.icon}
                  </edgeless-tool-icon-button>
                `)}
            </div>
          </div>
        </edgeless-slide-menu>
      </div>
    `}};EdgelessNoteMenu.styles=i$5`
    :host {
      position: absolute;
      display: flex;
      z-index: -1;
    }
    .note-menu-container {
      display: flex;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px 8px 0 0;
      border: 1px solid var(--affine-border-color);
      position: relative;
      cursor: default;
    }
    .menu-content {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .button-group-label {
      font-family: 'Inter';
      font-size: 12px;
      font-weight: 400;
      font-style: normal;
      display: flex;
      text-align: center;
      color: var(--light-text-color-text-secondary-color, #8e8d91);
      width: 38px;
      height: 20px;
      line-height: 20px;
      margin-right: 16px;
    }
    .button-group-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      fill: var(--affine-icon-color);
    }
  `;__decorate$1O([n$a({attribute:!1})],EdgelessNoteMenu.prototype,"edgelessTool",void 0);__decorate$1O([n$a({attribute:!1})],EdgelessNoteMenu.prototype,"edgeless",void 0);EdgelessNoteMenu=__decorate$1O([e$7("edgeless-note-menu")],EdgelessNoteMenu);var __decorate$1N=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const NOTE_COLORS=["--affine-background-secondary-color","--affine-tag-yellow","--affine-tag-red","--affine-tag-green","--affine-tag-blue","--affine-tag-purple"],DEFAULT_NOTE_COLOR=NOTE_COLORS[0];function createNoteMenuPopper$1(k){const _=document.createElement("edgeless-note-menu");assertExists(k.shadowRoot),k.shadowRoot.appendChild(_);const y=110,w=-40;return Object.assign(_.style,{left:`${y}px`,top:`${w}px`}),{element:_,dispose:()=>{_.remove()}}}let EdgelessNoteToolButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._noteMenu=null}_toggleNoteMenu(){this._noteMenu?(this._noteMenu.dispose(),this._noteMenu=null):(this._noteMenu=createNoteMenuPopper$1(this),this._noteMenu.element.edgelessTool=this.edgelessTool,this._noteMenu.element.edgeless=this.edgeless)}updated(_){_.has("edgelessTool")&&(this.edgelessTool.type!=="note"&&(this._noteMenu?.dispose(),this._noteMenu=null),this._noteMenu&&(this._noteMenu.element.edgelessTool=this.edgelessTool,this._noteMenu.element.edgeless=this.edgeless))}connectedCallback(){super.connectedCallback(),this._disposables.add(this.edgeless.slots.edgelessToolUpdated.on(_=>{_.type!=="note"&&(this._noteMenu?.dispose(),this._noteMenu=null)}))}disconnectedCallback(){this._noteMenu?.dispose(),this._noteMenu=null,super.disconnectedCallback()}render(){const _=this.edgelessTool?.type;return x$1`
      <edgeless-tool-icon-button
        .tooltip=${this._noteMenu?"":getTooltipWithShortcut("Note","N")}
        .active=${_==="note"}
        .activeMode=${"background"}
        @click=${()=>{this.setEdgelessTool({type:"note",background:DEFAULT_NOTE_COLOR,childFlavour:"affine:paragraph",childType:"text",tip:"Text"}),this._toggleNoteMenu()}}
      >
        ${NoteIcon} ${ArrowUpIcon}
      </edgeless-tool-icon-button>
    `}};EdgelessNoteToolButton.styles=i$5`
    :host {
      display: flex;
    }

    edgeless-tool-icon-button svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }

    edgeless-tool-icon-button svg + svg {
      margin-left: 8px;
    }
  `;__decorate$1N([n$a({attribute:!1})],EdgelessNoteToolButton.prototype,"edgelessTool",void 0);__decorate$1N([n$a({attribute:!1})],EdgelessNoteToolButton.prototype,"edgeless",void 0);__decorate$1N([n$a({attribute:!1})],EdgelessNoteToolButton.prototype,"setEdgelessTool",void 0);EdgelessNoteToolButton=__decorate$1N([e$7("edgeless-note-tool-button")],EdgelessNoteToolButton);var __decorate$1M=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessFrameOrderMenu=class extends WithDisposable(s$2){firstUpdated(){this._bindEvent()}_bindEvent(){this._disposables.addFromEvent(this._container,"pointerdown",_=>{const w=_.target.closest(".draggable");if(!w)return;const $=w.querySelector(".draggable-title")?.cloneNode(!0);$.style.fontFamily="sans-serif",$.style.position="absolute",$.style.zIndex="1000",$.style.fontFamily="sans-serif",this.edgeless.editorContainer.appendChild($);const B=w.getBoundingClientRect(),R=document.createElement("div");R.style.position="absolute",R.style.zIndex="1000",R.style.width=B.width+"px",R.style.height="1px",R.style.backgroundColor="blue",R.hidden=!0,this.edgeless.editorContainer.appendChild(R);const H=_.clientX-B.left,j=_.clientY-B.top;q(_.clientX,_.clientY);function q(ie,ae){$.style.left=ie-H+"px",$.style.top=ae-j+"px"}const X=Number(w.getAttribute("index"));let ee=-1;const te=B.top-B.height*X-B.height/2,ne=te+B.height*this.frames.length;function oe(ie){return ie.clientY>=te&&ie.clientY<=ne}this._disposables.addFromEvent(document,"pointermove",ie=>{if(q(ie.clientX,ie.clientY),oe(ie)&&(ee=parseInt((ie.pageY-te)/B.height+""),ee!==X&&ee!==X+1)){R.hidden=!1,R.style.left=B.left+"px",R.style.top=te+B.height/2+ee*B.height+"px";return}ee=-1,R.hidden=!0}),this._disposables.addFromEvent(document,"pointerup",()=>{if(ee!==-1&&ee>=0&&ee<=this.frames.length-1){const ie=this.frames[ee-1]?.index||null,ae=this.frames[ee].index||null,re=this.frames[X];this.edgeless.surface.updateIndexes([generateKeyBetween(ie,ae)],[re]),this.edgeless.page.captureSync(),this.updateFrames(),this.requestUpdate()}$.remove(),R.remove(),this._disposables.dispose(),this._disposables=new DisposableGroup,this._bindEvent()})})}render(){const _=c$1(this.frames,y=>y.id,(y,w)=>x$1` <div
        class="draggable"
        id=${y.id}
        index=${w}
      >
        <div class="draggable-bar"></div>
        <div class="draggable-title">${y.title}</div>
        <div class="draggable-index">${w+1}</div>
        <div></div>
      </div>`);return x$1`
      <div class="container">
        <div class="edgeless-frame-order-title">Frame Order</div>
        <div class="edgeelss-frame-order-items-container">${_}</div>
      </div>
    `}};EdgelessFrameOrderMenu.styles=i$5`
    :host {
      position: absolute;
      z-index: 1;
    }
    .container {
      width: 237px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
      padding: 8px;
    }

    .edgeless-frame-order-title {
      color: #8e8d91;
      border-bottom: 1px solid var(--affine-divider-color);
      font-size: 12px;
      padding-bottom: 6px;
      margin-bottom: 10px;
    }

    .edgeelss-frame-order-items-container {
      display: flex;
      flex-direction: column;
    }

    .draggable {
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: baseline;
      padding: 5px 8px;
    }

    .draggable:hover {
      background: #f5f5f5;
      .draggable-bar {
        background: #c0bfc1;
      }
    }

    .draggable-bar {
      width: 4px;
      height: 12px;
      background: rgba(192, 191, 193, 0.2);
      margin-right: 8px;
    }
    .draggable-title {
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .draggable-index {
      color: #8e8d91;
      width: 26px;
    }
  `;__decorate$1M([n$a({attribute:!1})],EdgelessFrameOrderMenu.prototype,"edgeless",void 0);__decorate$1M([n$a({attribute:!1})],EdgelessFrameOrderMenu.prototype,"frames",void 0);__decorate$1M([n$a({attribute:!1})],EdgelessFrameOrderMenu.prototype,"updateFrames",void 0);__decorate$1M([i$6(".edgeelss-frame-order-items-container")],EdgelessFrameOrderMenu.prototype,"_container",void 0);EdgelessFrameOrderMenu=__decorate$1M([e$7("edgeless-frame-order-menu")],EdgelessFrameOrderMenu);var __decorate$1L=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessFrameOrderButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._menuShow=!1}firstUpdated(){this._edgelessFrameOrderMenu.hidden=!this._menuShow}_toggleMenu(){this._menuShow=!this._menuShow,this._edgelessFrameOrderMenu.hidden=!this._menuShow,this._menuShow&&computePosition(this,this._edgelessFrameOrderMenu,{placement:"top",middleware:[offset$1({mainAxis:10})]}).then(({x:_,y})=>{Object.assign(this._edgelessFrameOrderMenu.style,{left:`${_}px`,top:`${y}px`})})}render(){return x$1`
      <edgeless-tool-icon-button
        @click=${()=>{this._toggleMenu()}}
      >
        ${FrameOrderAdjustmentIcon}
      </edgeless-tool-icon-button>
      <edgeless-frame-order-menu
        .edgeless=${this.edgeless}
        .frames=${this.frames}
        .updateFrames=${this.updateFrames}
      >
      </edgeless-frame-order-menu>
    `}};__decorate$1L([n$a({attribute:!1})],EdgelessFrameOrderButton.prototype,"edgeless",void 0);__decorate$1L([n$a({attribute:!1})],EdgelessFrameOrderButton.prototype,"frames",void 0);__decorate$1L([n$a({attribute:!1})],EdgelessFrameOrderButton.prototype,"updateFrames",void 0);__decorate$1L([i$6("edgeless-frame-order-menu")],EdgelessFrameOrderButton.prototype,"_edgelessFrameOrderMenu",void 0);__decorate$1L([t$2()],EdgelessFrameOrderButton.prototype,"_menuShow",void 0);EdgelessFrameOrderButton=__decorate$1L([e$7("edgeless-frame-order-button")],EdgelessFrameOrderButton);var __decorate$1K=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const FrameConfig=[{name:"1:1",wh:[1200,1200]},{name:"4:3",wh:[1600,1200]},{name:"16:9",wh:[1600,900]},{name:"2:1",wh:[1600,800]}];let EdgelessFrameMenu=class extends WithDisposable(s$2){render(){if(this.edgelessTool.type!=="frame")return A;const{edgeless:_}=this;return x$1`
      <div class="frame-menu-container">
        <edgeless-slide-menu .menuWidth=${290} .showNext=${!1}>
          <div class="menu-content">
            <div class="frame-add-button custom">Custom</div>
            <menu-divider .vertical=${!0}></menu-divider>
            ${c$1(FrameConfig,y=>y.name,(y,w)=>x$1`
                <div
                  @click=${()=>{const $=_.frame.frames,B=_.surface.viewport.center,R=new Bound(B.x-y.wh[0]/2,B.y-y.wh[1]/2,y.wh[0],y.wh[1]),H=_.surface.addElement("frame",{title:new YText(`Frame ${$.length+1}`),batch:"a0",xywh:R.serialize()});_.page.captureSync();const j=_.surface.pickById(H);assertExists(j),_.tools.setEdgelessTool({type:"default"}),_.selectionManager.setSelection({elements:[j.id],editing:!1})}}
                  class="frame-add-button ${w}"
                >
                  ${y.name}
                </div>
              `)}
          </div>
        </edgeless-slide-menu>
      </div>
    `}};EdgelessFrameMenu.styles=i$5`
    :host {
      position: absolute;
      display: flex;
      z-index: -1;
    }
    .frame-menu-container {
      display: flex;
      align-items: center;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px 8px 0 0;
      border: 1px solid var(--affine-border-color);
      position: relative;
      cursor: default;
    }
    .menu-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
    }

    .frame-add-button {
      border: 1px solid rgba(227, 226, 228, 1);
      border-radius: 2px;
      cursor: pointer;
      font-size: 10px;
      font-weight: 400;
      line-height: 12px;
      letter-spacing: 0px;
      text-align: center;
      max-height: 20.49px;
      height: 20.49px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .frame-add-button:nth-of-type(1) {
      padding: 0px 3px;
    }

    .frame-add-button:nth-of-type(2) {
      width: 20.49px;
    }

    .frame-add-button:nth-of-type(3) {
      width: 27.31px;
    }
    .frame-add-button:nth-of-type(4) {
      width: 36.42px;
    }
    .frame-add-button:nth-of-type(5) {
      width: 40.97px;
    }
    .custom {
      background: rgba(0, 0, 0, 0.04);
      border: 0.640185px solid #e3e2e4;
      border-radius: 2px;
      color: #424149;
    }

    menu-divider {
      height: 20px;
    }
  `;__decorate$1K([n$a({attribute:!1})],EdgelessFrameMenu.prototype,"edgelessTool",void 0);__decorate$1K([n$a({attribute:!1})],EdgelessFrameMenu.prototype,"edgeless",void 0);EdgelessFrameMenu=__decorate$1K([e$7("edgeless-frame-menu")],EdgelessFrameMenu);var __decorate$1J=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createFrameMenuPopper(k){const _=document.createElement("edgeless-frame-menu");assertExists(k.shadowRoot),k.shadowRoot.appendChild(_);const y=90,w=-40;return Object.assign(_.style,{left:`${y}px`,top:`${w}px`}),{element:_,dispose:()=>{_.remove()}}}let EdgelessFrameToolButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._frameMenu=null}_toggleFrameMenu(){this._frameMenu?(this._frameMenu.dispose(),this._frameMenu=null):(this._frameMenu=createFrameMenuPopper(this),this._frameMenu.element.edgelessTool=this.edgelessTool,this._frameMenu.element.edgeless=this.edgeless)}updated(_){_.has("edgelessTool")&&(this.edgelessTool.type!=="frame"&&(this._frameMenu?.dispose(),this._frameMenu=null),this._frameMenu&&(this._frameMenu.element.edgelessTool=this.edgelessTool,this._frameMenu.element.edgeless=this.edgeless))}connectedCallback(){super.connectedCallback(),this._disposables.add(this.edgeless.slots.edgelessToolUpdated.on(_=>{_.type!=="frame"&&(this._frameMenu?.dispose(),this._frameMenu=null)}))}disconnectedCallback(){this._frameMenu?.dispose(),this._frameMenu=null,super.disconnectedCallback()}render(){const _=this.edgelessTool?.type;return x$1`
      <edgeless-tool-icon-button
        .tooltip=${this._frameMenu?"":getTooltipWithShortcut("Frame","F")}
        .active=${_==="frame"}
        .activeMode=${"background"}
        .iconContainerPadding=${0}
        @click=${()=>{this.setEdgelessTool({type:"frame"}),this._toggleFrameMenu()}}
      >
        <div class="frame-button-group">${LargeFrameIcon} ${ArrowUpIcon}</div>
      </edgeless-tool-icon-button>
    `}};EdgelessFrameToolButton.styles=i$5`
    :host {
      display: flex;
    }

    .frame-button-group {
      display: flex;
      position: relative;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
    }

    edgeless-tool-icon-button svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }

    edgeless-tool-icon-button svg + svg {
      position: absolute;
      top: 2px;
      right: 0px;
    }
  `;__decorate$1J([n$a({attribute:!1})],EdgelessFrameToolButton.prototype,"edgelessTool",void 0);__decorate$1J([n$a({attribute:!1})],EdgelessFrameToolButton.prototype,"edgeless",void 0);__decorate$1J([n$a({attribute:!1})],EdgelessFrameToolButton.prototype,"setEdgelessTool",void 0);EdgelessFrameToolButton=__decorate$1J([e$7("edgeless-frame-tool-button")],EdgelessFrameToolButton);var __decorate$1I=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessToolbar=class extends WithDisposable(s$2){constructor(_){super(),this._frames=[],this._currentFrameIndex=0,this._timer=null,this._index=-1,this.setEdgelessTool=y=>{this.edgeless.tools.setEdgelessTool(y)},this._imageLoading=!1,this._trySaveBrushStateLocalRecord=()=>{const y=this.edgeless.tools.edgelessTool,{type:w}=y;w==="brush"&&sessionStorage.setItem("blocksuite:"+this.edgeless.page.id+":edgelessBrush",JSON.stringify({color:y.color,lineWidth:y.lineWidth}))},this.edgeless=_,this._frames=_.frame.frames.sort(compare$1)}get edgelessTool(){return this.edgeless.edgelessTool}async _addImages(){this._imageLoading=!0;const _=await uploadImageFromLocal(this.edgeless.page.blobs);if(!_.length){this._imageLoading=!1;return}await this.edgeless.addImages(_),this._imageLoading=!1}_updateFrames(){this._frames=this.edgeless.frame.frames.sort(compare$1)}_nextFrame(){const _=this._frames,y=0,w=_.length-1;this._currentFrameIndex===_.length-1?toast("You have reached the last frame"):this._currentFrameIndex=clamp$1(this._currentFrameIndex+1,y,w)}_previousFrame(){const _=this._frames,y=0,w=_.length-1;this._currentFrameIndex===0?toast("You have reached the first frame"):this._currentFrameIndex=clamp$1(this._currentFrameIndex-1,y,w)}firstUpdated(){const{_disposables:_,edgeless:y}=this,{slots:w,surface:$}=y;y.bindHotKey({ArrowLeft:()=>{const{type:B}=this.edgelessTool;B==="frameNavigator"&&this._previousFrame()},ArrowRight:()=>{const{type:B}=this.edgelessTool;B==="frameNavigator"&&this._nextFrame()}},{global:!0}),_.add(w.edgelessToolUpdated.on(()=>{this._trySaveBrushStateLocalRecord(),this.requestUpdate()})),_.add($.slots.elementAdded.on(B=>{$.pickById(B)instanceof FrameElement&&this._updateFrames()})),_.add($.slots.elementRemoved.on(({element:B})=>{B instanceof FrameElement&&this._updateFrames()})),_.add($.slots.elementUpdated.on(({id:B,props:R})=>{$.pickById(B)instanceof FrameElement&&"index"in R&&this._updateFrames()})),_.add(w.viewportUpdated.on(()=>this.requestUpdate())),_.add(y.slots.readonlyUpdated.on(()=>{this.requestUpdate()}))}updated(_){const{type:y}=this.edgelessTool;if(_.has("_currentFrameIndex")&&y==="frameNavigator"){const w=this._currentFrameIndex,$=this.edgeless.surface.viewport,B=this._frames[w];if(B){const R=Bound.deserialize(B.xywh);$.setViewportByBound(R,[40,60,40,60],!0)}}}_toggleFullScreen(){document.fullscreenElement?(this._timer&&clearTimeout(this._timer),document.exitFullscreen()):(launchIntoFullscreen(this.edgeless.editorContainer),this._timer=setTimeout(()=>{this._currentFrameIndex=this._index},400))}get frameNavigatorContent(){const _=this._currentFrameIndex,y=this._frames,w=y[_];return x$1`
      <edgeless-tool-icon-button
        .tooltip=${"Previous"}
        @click=${()=>this._previousFrame()}
      >
        ${FrameNavigatorPrevIcon}
      </edgeless-tool-icon-button>
      <div class="edgeless-frame-navigator">
        <span
          class="edgeless-frame-navigator-title"
          @click=${()=>this._currentFrameIndex=this._currentFrameIndex+0}
          >${w?.title??"no frame"}</span
        >
        <span class="edgeless-frame-navigator-count"
          >${y.length===0?0:_+1}/${y.length}</span
        >
      </div>
      <edgeless-tool-icon-button
        .tooltip=${"Next"}
        @click=${()=>this._nextFrame()}
      >
        ${FrameNavigatorNextIcon}
      </edgeless-tool-icon-button>
      <div class="short-divider"></div>
      <edgeless-frame-order-button
        .frames=${this._frames}
        .updateFrames=${this._updateFrames.bind(this)}
        .edgeless=${this.edgeless}
      >
      </edgeless-frame-order-button>
      <edgeless-tool-icon-button
        .tooltip=${document.fullscreenElement?"Exit Full Screen":"Enter Full Screen"}
        @click=${()=>{this._toggleFullScreen()}}
      >
        ${document.fullscreenElement?PresentationExitFullScreenIcon:PresentationFullScreenIcon}
      </edgeless-tool-icon-button>
      <div class="short-divider"></div>
      <div
        class="edgeless-frame-navigator-stop"
        @click=${()=>{this.setEdgelessTool({type:"default"}),document.fullscreenElement&&this._toggleFullScreen()}}
      >
        Stop
      </div>
    `}_renderTools(){const{page:_}=this.edgeless,{type:y}=this.edgelessTool;return _.readonly?A:x$1`
      <div class="full-divider"></div>
      <div class="brush-and-eraser">
        <edgeless-brush-tool-button
          .edgelessTool=${this.edgelessTool}
          .edgeless=${this.edgeless}
          .setEdgelessTool=${this.setEdgelessTool}
        ></edgeless-brush-tool-button>
        <edgeless-toolbar-button
          .tooltip=${getTooltipWithShortcut("Eraser","E")}
          .active=${y==="eraser"}
          .activeMode=${"background"}
          @click=${()=>this.setEdgelessTool({type:"eraser"})}
        >
          <div class="eraser-button">${EdgelessEraserIcon}</div>
        </edgeless-toolbar-button>
      </div>
      <div class="edgeless-toolbar-right-part">
        <edgeless-toolbar-button
          class="transform-button"
          .tooltip=${getTooltipWithShortcut("Text","T")}
          .active=${y==="text"}
          .activeMode=${"background"}
          @click=${()=>this.setEdgelessTool({type:"text"})}
        >
          ${EdgelessTextIcon}
        </edgeless-toolbar-button>
        <edgeless-toolbar-button
          class="transform-button"
          .disabled=${this._imageLoading}
          .activeMode=${"background"}
          .tooltip=${"Image"}
          @click=${()=>this._addImages()}
        >
          ${EdgelessImageIcon}
        </edgeless-toolbar-button>
        <edgeless-shape-tool-button
          .edgelessTool=${this.edgelessTool}
          .edgeless=${this.edgeless}
          .setEdgelessTool=${this.setEdgelessTool}
        ></edgeless-shape-tool-button>
        <edgeless-connector-tool-button
          .edgelessTool=${this.edgelessTool}
          .edgeless=${this.edgeless}
          .setEdgelessTool=${this.setEdgelessTool}
        ></edgeless-connector-tool-button>
      </div>
    `}get defaultContent(){const{page:_}=this.edgeless,{type:y}=this.edgelessTool;return x$1`<div class="edgeless-toolbar-left-part">
        <edgeless-tool-icon-button
          .tooltip=${getTooltipWithShortcut("Select","V")}
          .active=${y==="default"}
          .activeMode=${"background"}
          .iconContainerPadding=${4}
          @click=${()=>this.setEdgelessTool({type:"default"})}
        >
          ${SelectIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          .tooltip=${getTooltipWithShortcut("Hand","H")}
          .active=${y==="pan"}
          .activeMode=${"background"}
          .iconContainerPadding=${4}
          @click=${()=>this.setEdgelessTool({type:"pan",panning:!1})}
        >
          ${HandIcon}
        </edgeless-tool-icon-button>

        ${_.readonly?A:x$1` <edgeless-frame-tool-button
              .edgelessTool=${this.edgelessTool}
              .setEdgelessTool=${this.setEdgelessTool}
              .edgeless=${this.edgeless}
            ></edgeless-frame-tool-button>`}

        <edgeless-tool-icon-button
          .tooltip=${"Presentation"}
          .iconContainerPadding=${4}
          @click=${()=>{this._index=this._currentFrameIndex,this.edgeless.selectionManager.elements[0]instanceof FrameElement&&(this._index=this._frames.findIndex(w=>w.id===this.edgeless.selectionManager.elements[0].id)),this.setEdgelessTool({type:"frameNavigator"}),this._frames.length===0&&toast("The presentation requires at least 1 frame. You can firstly create a frame.",5e3),this._toggleFullScreen()}}
        >
          ${FrameNavigatorIcon}
        </edgeless-tool-icon-button>
      </div>

      ${_.readonly?A:x$1`
            <div class="short-divider"></div>
            <edgeless-note-tool-button
              .edgelessTool=${this.edgelessTool}
              .edgeless=${this.edgeless}
              .setEdgelessTool=${this.setEdgelessTool}
            ></edgeless-note-tool-button>
          `}
      ${this._renderTools()} `}render(){const{type:_}=this.edgelessTool,y=_==="frameNavigator"?this.frameNavigatorContent:this.defaultContent;return x$1`
      <div
        class="edgeless-toolbar-container"
        @dblclick=${stopPropagation}
        @mousedown=${stopPropagation}
        @mouseup=${stopPropagation}
        @pointerdown=${stopPropagation}
      >
        ${y}
      </div>
    `}};EdgelessToolbar.styles=i$5`
    :host {
      position: absolute;
      z-index: 3;
      bottom: 28px;
      left: calc(50%);
      display: flex;
      justify-content: center;
      transform: translateX(-50%);
      user-select: none;
      font-family: var(--affine-font-family);
    }
    .edgeless-toolbar-container {
      display: flex;
      align-items: center;
      flex-direction: row;
      padding: 0 20px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border: 1px solid var(--affine-border-color);
      border-radius: 40px;
      min-height: 52px;
    }
    .edgeless-toolbar-container[level='second'] {
      position: absolute;
      bottom: 8px;
      transform: translateY(-100%);
    }
    .edgeless-toolbar-container[hidden] {
      display: none;
    }
    .edgeless-toolbar-left-part {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .edgeless-toolbar-left-part svg {
      fill: var(--affine-icon-color);
      stroke: none;
    }
    .short-divider {
      width: 1px;
      height: 24px;
      margin: 0 10px;
      background-color: var(--affine-border-color);
    }
    .full-divider {
      width: 1px;
      height: 100%;
      margin: 0 12px;
      background-color: var(--affine-border-color);
    }
    .brush-and-eraser {
      display: flex;
      margin-left: 8px;
    }
    .eraser-button {
      position: relative;
      height: 66px;
      width: 30px;
      overflow-y: hidden;
    }
    #edgeless-eraser-icon {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      transition: top 0.3s ease-in-out;
    }
    #edgeless-eraser-icon:hover {
      top: 2px;
    }
    .edgeless-toolbar-right-part {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-left: 12px;
    }
    .transform-button svg {
      transition: 0.3s ease-in-out;
    }
    .transform-button:hover svg {
      transform: scale(1.15);
    }

    .edgeless-frame-navigator {
      width: 145px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .edgeless-frame-navigator-title {
      display: inline-block;
      cursor: pointer;
      color: #424149;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      margin-right: 8px;
    }

    .edgeless-frame-navigator-count {
      color: #8e8d91;
    }
    .edgeless-frame-navigator-stop {
      background: #eb4335;
      color: #ffffff;
      box-shadow: 0px 1px 2px 0px #ffffff40 inset;
      padding: 4px 10px;
      border-radius: 8px;
      cursor: pointer;
    }
  `;__decorate$1I([t$2()],EdgelessToolbar.prototype,"_frames",void 0);__decorate$1I([t$2({hasChanged(){return!0}})],EdgelessToolbar.prototype,"_currentFrameIndex",void 0);EdgelessToolbar=__decorate$1I([e$7("edgeless-toolbar")],EdgelessToolbar);var __decorate$1H=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessHoverRect$1=class extends WithDisposable(s$2){firstUpdated(){this._disposables.add(this.edgeless.slots.hoverUpdated.on(()=>this.requestUpdate())),this._disposables.add(this.edgeless.slots.viewportUpdated.on(()=>this.requestUpdate())),this._disposables.add(this.edgeless.selectionManager.slots.updated.on(()=>this.requestUpdate()))}render(){const{edgeless:_}=this,y=_.tools.getHoverState();if(!y||_.selectionManager.state.editing)return A;const w=y.rect,$=isTopLevelBlock(y.content)&&matchFlavours(y.content,["affine:note"]),B={left:w.x+"px",top:w.y+"px",width:w.width+"px",height:w.height+"px",backgroundColor:$?"var(--affine-hover-color)":""};return x$1`
      <div class="affine-edgeless-hover-rect" style=${o$4(B)}></div>
    `}};EdgelessHoverRect$1.styles=i$5`
    :host {
      pointer-events: none;
    }
    .affine-edgeless-hover-rect {
      position: absolute;
      top: 0;
      left: 0;
      border-radius: 0;
      pointer-events: none;
      box-sizing: border-box;
      z-index: 1;
      border: var(--affine-border-width) solid var(--affine-blue);
    }
  `;__decorate$1H([n$a({attribute:!1})],EdgelessHoverRect$1.prototype,"edgeless",void 0);EdgelessHoverRect$1=__decorate$1H([e$7("edgeless-hover-rect")],EdgelessHoverRect$1);var __decorate$1G=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessHoverRect=class extends WithDisposable(s$2){firstUpdated(){this._disposables.add(this.edgeless.slots.hoverUpdated.on(()=>this.requestUpdate()))}render(){const _=this.edgeless.tools.draggingArea;if(_===null)return A;const y={left:_.left+"px",top:_.top+"px",width:_.width+"px",height:_.height+"px"};return x$1`
      <div class="affine-edgeless-dragging-area" style=${o$4(y)}></div>
    `}};EdgelessHoverRect.styles=i$5`
    .affine-edgeless-dragging-area {
      position: absolute;
      background: var(--affine-hover-color);
      z-index: 1;
      pointer-events: none;
    }
  `;__decorate$1G([n$a({attribute:!1})],EdgelessHoverRect.prototype,"edgeless",void 0);EdgelessHoverRect=__decorate$1G([e$7("edgeless-dragging-area-rect")],EdgelessHoverRect);var __decorate$1F=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessNoteMask=class extends WithDisposable(s$2){createRenderRoot(){return this}firstUpdated(){this._disposables.add(this.edgeless.selectionManager.slots.updated.on(()=>{this.requestUpdate()}))}render(){return this.edgeless.selectionManager.state.editing&&this.edgeless.selectionManager.state.elements.includes(this.model.id)?A:x$1`
      <div class="affine-note-mask" style=${o$4({position:"absolute",top:"0",left:"0",bottom:"0",right:"0",zIndex:"1",pointerEvents:"auto"})}></div>
    `}};__decorate$1F([n$a({attribute:!1})],EdgelessNoteMask.prototype,"edgeless",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessNoteMask.prototype,"model",void 0);EdgelessNoteMask=__decorate$1F([e$7("edgeless-note-mask")],EdgelessNoteMask);let EdgelessChildNote=class extends s$2{createRenderRoot(){return this}render(){const{model:_,renderer:y,index:w}=this,{xywh:$,background:B}=_,[R,H,j,q]=deserializeXYWH($),X=_.hidden,ee={position:"absolute",zIndex:`${w}`,width:j+"px",transform:`translate(${R}px, ${H}px)`,padding:`${EDGELESS_BLOCK_CHILD_PADDING}px`,border:`${EDGELESS_BLOCK_CHILD_BORDER_WIDTH}px ${X?"dashed":"solid"} var(--affine-black-10)`,borderRadius:"8px",boxSizing:"border-box",background:X?"transparent":`var(${B??DEFAULT_NOTE_COLOR$1})`,boxShadow:X?void 0:"var(--affine-shadow-3)",pointerEvents:"all",overflow:"hidden",transformOrigin:"0 0"};return x$1`
      <div
        class="affine-edgeless-child-note"
        style=${o$4(ee)}
        data-model-height="${q}"
      >
        ${y(_)}
        <edgeless-note-mask
          .edgeless=${this.edgeless}
          .model=${this.model}
        ></edgeless-note-mask>
      </div>
    `}};__decorate$1F([n$a({attribute:!1})],EdgelessChildNote.prototype,"index",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessChildNote.prototype,"model",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessChildNote.prototype,"renderer",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessChildNote.prototype,"edgeless",void 0);EdgelessChildNote=__decorate$1F([e$7("edgeless-child-note")],EdgelessChildNote);let EdgelessNotesContainer=class extends WithDisposable(s$2){createRenderRoot(){return this}render(){const{notes:_,renderer:y}=this;return x$1`
      ${c$1(_,w=>w.id,(w,$)=>x$1`<edgeless-child-note
          .index=${$}
          .model=${w}
          .renderer=${y}
          .edgeless=${this.edgeless}
        ></edgeless-child-note>`)}
    `}};__decorate$1F([n$a({attribute:!1})],EdgelessNotesContainer.prototype,"notes",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessNotesContainer.prototype,"edgeless",void 0);__decorate$1F([n$a({attribute:!1})],EdgelessNotesContainer.prototype,"renderer",void 0);EdgelessNotesContainer=__decorate$1F([e$7("edgeless-notes-container")],EdgelessNotesContainer);function getClosestEditorContainer(k){const _=k.closest("editor-container");return assertExists(_),_}function listenToThemeChange(k,_){return getClosestEditorContainer(k).themeObserver.on(_)}function getThemePropertyValue(k,_){return getClosestEditorContainer(k).themeObserver.cssVariables?.[_]}var webfontloader={exports:{}};(function(k){(function(){function _(ye,Ee,He){return ye.call.apply(ye.bind,arguments)}function y(ye,Ee,He){if(!ye)throw Error();if(2<arguments.length){var ze=Array.prototype.slice.call(arguments,2);return function(){var Xe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xe,ze),ye.apply(Ee,Xe)}}return function(){return ye.apply(Ee,arguments)}}function w(ye,Ee,He){return w=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?_:y,w.apply(null,arguments)}var $=Date.now||function(){return+new Date};function B(ye,Ee){this.a=ye,this.o=Ee||ye,this.c=this.o.document}var R=!!window.FontFace;function H(ye,Ee,He,ze){if(Ee=ye.c.createElement(Ee),He)for(var Xe in He)He.hasOwnProperty(Xe)&&(Xe=="style"?Ee.style.cssText=He[Xe]:Ee.setAttribute(Xe,He[Xe]));return ze&&Ee.appendChild(ye.c.createTextNode(ze)),Ee}function j(ye,Ee,He){ye=ye.c.getElementsByTagName(Ee)[0],ye||(ye=document.documentElement),ye.insertBefore(He,ye.lastChild)}function q(ye){ye.parentNode&&ye.parentNode.removeChild(ye)}function X(ye,Ee,He){Ee=Ee||[],He=He||[];for(var ze=ye.className.split(/\s+/),Xe=0;Xe<Ee.length;Xe+=1){for(var ot=!1,it=0;it<ze.length;it+=1)if(Ee[Xe]===ze[it]){ot=!0;break}ot||ze.push(Ee[Xe])}for(Ee=[],Xe=0;Xe<ze.length;Xe+=1){for(ot=!1,it=0;it<He.length;it+=1)if(ze[Xe]===He[it]){ot=!0;break}ot||Ee.push(ze[Xe])}ye.className=Ee.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function ee(ye,Ee){for(var He=ye.className.split(/\s+/),ze=0,Xe=He.length;ze<Xe;ze++)if(He[ze]==Ee)return!0;return!1}function te(ye){return ye.o.location.hostname||ye.a.location.hostname}function ne(ye,Ee,He){function ze(){dt&&Xe&&ot&&(dt(it),dt=null)}Ee=H(ye,"link",{rel:"stylesheet",href:Ee,media:"all"});var Xe=!1,ot=!0,it=null,dt=He||null;R?(Ee.onload=function(){Xe=!0,ze()},Ee.onerror=function(){Xe=!0,it=Error("Stylesheet failed to load"),ze()}):setTimeout(function(){Xe=!0,ze()},0),j(ye,"head",Ee)}function oe(ye,Ee,He,ze){var Xe=ye.c.getElementsByTagName("head")[0];if(Xe){var ot=H(ye,"script",{src:Ee}),it=!1;return ot.onload=ot.onreadystatechange=function(){it||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(it=!0,He&&He(null),ot.onload=ot.onreadystatechange=null,ot.parentNode.tagName=="HEAD"&&Xe.removeChild(ot))},Xe.appendChild(ot),setTimeout(function(){it||(it=!0,He&&He(Error("Script load timeout")))},ze||5e3),ot}return null}function ie(){this.a=0,this.c=null}function ae(ye){return ye.a++,function(){ye.a--,se(ye)}}function re(ye,Ee){ye.c=Ee,se(ye)}function se(ye){ye.a==0&&ye.c&&(ye.c(),ye.c=null)}function le(ye){this.a=ye||"-"}le.prototype.c=function(ye){for(var Ee=[],He=0;He<arguments.length;He++)Ee.push(arguments[He].replace(/[\W_]+/g,"").toLowerCase());return Ee.join(this.a)};function ue(ye,Ee){this.c=ye,this.f=4,this.a="n";var He=(Ee||"n4").match(/^([nio])([1-9])$/i);He&&(this.a=He[1],this.f=parseInt(He[2],10))}function he(ye){return be(ye)+" "+(ye.f+"00")+" 300px "+ce(ye.c)}function ce(ye){var Ee=[];ye=ye.split(/,\s*/);for(var He=0;He<ye.length;He++){var ze=ye[He].replace(/['"]/g,"");ze.indexOf(" ")!=-1||/^\d/.test(ze)?Ee.push("'"+ze+"'"):Ee.push(ze)}return Ee.join(",")}function ge(ye){return ye.a+ye.f}function be(ye){var Ee="normal";return ye.a==="o"?Ee="oblique":ye.a==="i"&&(Ee="italic"),Ee}function fe(ye){var Ee=4,He="n",ze=null;return ye&&((ze=ye.match(/(normal|oblique|italic)/i))&&ze[1]&&(He=ze[1].substr(0,1).toLowerCase()),(ze=ye.match(/([1-9]00|normal|bold)/i))&&ze[1]&&(/bold/i.test(ze[1])?Ee=7:/[1-9]00/.test(ze[1])&&(Ee=parseInt(ze[1].substr(0,1),10)))),He+Ee}function we(ye,Ee){this.c=ye,this.f=ye.o.document.documentElement,this.h=Ee,this.a=new le("-"),this.j=Ee.events!==!1,this.g=Ee.classes!==!1}function Ce(ye){ye.g&&X(ye.f,[ye.a.c("wf","loading")]),ke(ye,"loading")}function ve(ye){if(ye.g){var Ee=ee(ye.f,ye.a.c("wf","active")),He=[],ze=[ye.a.c("wf","loading")];Ee||He.push(ye.a.c("wf","inactive")),X(ye.f,He,ze)}ke(ye,"inactive")}function ke(ye,Ee,He){ye.j&&ye.h[Ee]&&(He?ye.h[Ee](He.c,ge(He)):ye.h[Ee]())}function me(){this.c={}}function Ie(ye,Ee,He){var ze=[],Xe;for(Xe in Ee)if(Ee.hasOwnProperty(Xe)){var ot=ye.c[Xe];ot&&ze.push(ot(Ee[Xe],He))}return ze}function Fe(ye,Ee){this.c=ye,this.f=Ee,this.a=H(this.c,"span",{"aria-hidden":"true"},this.f)}function Be(ye){j(ye.c,"body",ye.a)}function Ze(ye){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+ce(ye.c)+";"+("font-style:"+be(ye)+";font-weight:"+(ye.f+"00")+";")}function Re(ye,Ee,He,ze,Xe,ot){this.g=ye,this.j=Ee,this.a=ze,this.c=He,this.f=Xe||3e3,this.h=ot||void 0}Re.prototype.start=function(){var ye=this.c.o.document,Ee=this,He=$(),ze=new Promise(function(it,dt){function ht(){$()-He>=Ee.f?dt():ye.fonts.load(he(Ee.a),Ee.h).then(function(pt){1<=pt.length?it():setTimeout(ht,25)},function(){dt()})}ht()}),Xe=null,ot=new Promise(function(it,dt){Xe=setTimeout(dt,Ee.f)});Promise.race([ot,ze]).then(function(){Xe&&(clearTimeout(Xe),Xe=null),Ee.g(Ee.a)},function(){Ee.j(Ee.a)})};function qe(ye,Ee,He,ze,Xe,ot,it){this.v=ye,this.B=Ee,this.c=He,this.a=ze,this.s=it||"BESbswy",this.f={},this.w=Xe||3e3,this.u=ot||null,this.m=this.j=this.h=this.g=null,this.g=new Fe(this.c,this.s),this.h=new Fe(this.c,this.s),this.j=new Fe(this.c,this.s),this.m=new Fe(this.c,this.s),ye=new ue(this.a.c+",serif",ge(this.a)),ye=Ze(ye),this.g.a.style.cssText=ye,ye=new ue(this.a.c+",sans-serif",ge(this.a)),ye=Ze(ye),this.h.a.style.cssText=ye,ye=new ue("serif",ge(this.a)),ye=Ze(ye),this.j.a.style.cssText=ye,ye=new ue("sans-serif",ge(this.a)),ye=Ze(ye),this.m.a.style.cssText=ye,Be(this.g),Be(this.h),Be(this.j),Be(this.m)}var Me={D:"serif",C:"sans-serif"},Pe=null;function Qe(){if(Pe===null){var ye=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Pe=!!ye&&(536>parseInt(ye[1],10)||parseInt(ye[1],10)===536&&11>=parseInt(ye[2],10))}return Pe}qe.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=$(),Ue(this)};function je(ye,Ee,He){for(var ze in Me)if(Me.hasOwnProperty(ze)&&Ee===ye.f[Me[ze]]&&He===ye.f[Me[ze]])return!0;return!1}function Ue(ye){var Ee=ye.g.a.offsetWidth,He=ye.h.a.offsetWidth,ze;(ze=Ee===ye.f.serif&&He===ye.f["sans-serif"])||(ze=Qe()&&je(ye,Ee,He)),ze?$()-ye.A>=ye.w?Qe()&&je(ye,Ee,He)&&(ye.u===null||ye.u.hasOwnProperty(ye.a.c))?Ve(ye,ye.v):Ve(ye,ye.B):tt(ye):Ve(ye,ye.v)}function tt(ye){setTimeout(w(function(){Ue(this)},ye),50)}function Ve(ye,Ee){setTimeout(w(function(){q(this.g.a),q(this.h.a),q(this.j.a),q(this.m.a),Ee(this.a)},ye),0)}function nt(ye,Ee,He){this.c=ye,this.a=Ee,this.f=0,this.m=this.j=!1,this.s=He}var et=null;nt.prototype.g=function(ye){var Ee=this.a;Ee.g&&X(Ee.f,[Ee.a.c("wf",ye.c,ge(ye).toString(),"active")],[Ee.a.c("wf",ye.c,ge(ye).toString(),"loading"),Ee.a.c("wf",ye.c,ge(ye).toString(),"inactive")]),ke(Ee,"fontactive",ye),this.m=!0,st(this)},nt.prototype.h=function(ye){var Ee=this.a;if(Ee.g){var He=ee(Ee.f,Ee.a.c("wf",ye.c,ge(ye).toString(),"active")),ze=[],Xe=[Ee.a.c("wf",ye.c,ge(ye).toString(),"loading")];He||ze.push(Ee.a.c("wf",ye.c,ge(ye).toString(),"inactive")),X(Ee.f,ze,Xe)}ke(Ee,"fontinactive",ye),st(this)};function st(ye){--ye.f==0&&ye.j&&(ye.m?(ye=ye.a,ye.g&&X(ye.f,[ye.a.c("wf","active")],[ye.a.c("wf","loading"),ye.a.c("wf","inactive")]),ke(ye,"active")):ve(ye.a))}function at(ye){this.j=ye,this.a=new me,this.h=0,this.f=this.g=!0}at.prototype.load=function(ye){this.c=new B(this.j,ye.context||this.j),this.g=ye.events!==!1,this.f=ye.classes!==!1,lt(this,new we(this.c,ye),ye)};function ct(ye,Ee,He,ze,Xe){var ot=--ye.h==0;(ye.f||ye.g)&&setTimeout(function(){var it=Xe||null,dt=ze||null||{};if(He.length===0&&ot)ve(Ee.a);else{Ee.f+=He.length,ot&&(Ee.j=ot);var ht,pt=[];for(ht=0;ht<He.length;ht++){var ut=He[ht],ft=dt[ut.c],gt=Ee.a,mt=ut;if(gt.g&&X(gt.f,[gt.a.c("wf",mt.c,ge(mt).toString(),"loading")]),ke(gt,"fontloading",mt),gt=null,et===null)if(window.FontFace){var mt=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),yt=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);et=mt?42<parseInt(mt[1],10):!yt}else et=!1;et?gt=new Re(w(Ee.g,Ee),w(Ee.h,Ee),Ee.c,ut,Ee.s,ft):gt=new qe(w(Ee.g,Ee),w(Ee.h,Ee),Ee.c,ut,Ee.s,it,ft),pt.push(gt)}for(ht=0;ht<pt.length;ht++)pt[ht].start()}},0)}function lt(ye,Ee,He){var Xe=[],ze=He.timeout;Ce(Ee);var Xe=Ie(ye.a,He,ye.c),ot=new nt(ye.c,Ee,ze);for(ye.h=Xe.length,Ee=0,He=Xe.length;Ee<He;Ee++)Xe[Ee].load(function(it,dt,ht){ct(ye,ot,it,dt,ht)})}function _e(ye,Ee){this.c=ye,this.a=Ee}_e.prototype.load=function(ye){function Ee(){if(ot["__mti_fntLst"+ze]){var it=ot["__mti_fntLst"+ze](),dt=[],ht;if(it)for(var pt=0;pt<it.length;pt++){var ut=it[pt].fontfamily;it[pt].fontStyle!=null&&it[pt].fontWeight!=null?(ht=it[pt].fontStyle+it[pt].fontWeight,dt.push(new ue(ut,ht))):dt.push(new ue(ut))}ye(dt)}else setTimeout(function(){Ee()},50)}var He=this,ze=He.a.projectId,Xe=He.a.version;if(ze){var ot=He.c.o;oe(this.c,(He.a.api||"https://fast.fonts.net/jsapi")+"/"+ze+".js"+(Xe?"?v="+Xe:""),function(it){it?ye([]):(ot["__MonotypeConfiguration__"+ze]=function(){return He.a},Ee())}).id="__MonotypeAPIScript__"+ze}else ye([])};function We(ye,Ee){this.c=ye,this.a=Ee}We.prototype.load=function(ye){var Ee,He,ze=this.a.urls||[],Xe=this.a.families||[],ot=this.a.testStrings||{},it=new ie;for(Ee=0,He=ze.length;Ee<He;Ee++)ne(this.c,ze[Ee],ae(it));var dt=[];for(Ee=0,He=Xe.length;Ee<He;Ee++)if(ze=Xe[Ee].split(":"),ze[1])for(var ht=ze[1].split(","),pt=0;pt<ht.length;pt+=1)dt.push(new ue(ze[0],ht[pt]));else dt.push(new ue(ze[0]));re(it,function(){ye(dt,ot)})};function Ne(ye,Ee){ye?this.c=ye:this.c=$e,this.a=[],this.f=[],this.g=Ee||""}var $e="https://fonts.googleapis.com/css";function Te(ye,Ee){for(var He=Ee.length,ze=0;ze<He;ze++){var Xe=Ee[ze].split(":");Xe.length==3&&ye.f.push(Xe.pop());var ot="";Xe.length==2&&Xe[1]!=""&&(ot=":"),ye.a.push(Xe.join(ot))}}function De(ye){if(ye.a.length==0)throw Error("No fonts to load!");if(ye.c.indexOf("kit=")!=-1)return ye.c;for(var Ee=ye.a.length,He=[],ze=0;ze<Ee;ze++)He.push(ye.a[ze].replace(/ /g,"+"));return Ee=ye.c+"?family="+He.join("%7C"),0<ye.f.length&&(Ee+="&subset="+ye.f.join(",")),0<ye.g.length&&(Ee+="&text="+encodeURIComponent(ye.g)),Ee}function Ge(ye){this.f=ye,this.a=[],this.c={}}var Ke={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Ae={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Oe={i:"i",italic:"i",n:"n",normal:"n"},Ye=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Je(ye){for(var Ee=ye.f.length,He=0;He<Ee;He++){var ze=ye.f[He].split(":"),Xe=ze[0].replace(/\+/g," "),ot=["n4"];if(2<=ze.length){var it,dt=ze[1];if(it=[],dt)for(var dt=dt.split(","),ht=dt.length,pt=0;pt<ht;pt++){var ut;if(ut=dt[pt],ut.match(/^[\w-]+$/)){var ft=Ye.exec(ut.toLowerCase());if(ft==null)ut="";else{if(ut=ft[2],ut=ut==null||ut==""?"n":Oe[ut],ft=ft[1],ft==null||ft=="")ft="4";else var gt=Ae[ft],ft=gt||(isNaN(ft)?"4":ft.substr(0,1));ut=[ut,ft].join("")}}else ut="";ut&&it.push(ut)}0<it.length&&(ot=it),ze.length==3&&(ze=ze[2],it=[],ze=ze?ze.split(","):it,0<ze.length&&(ze=Ke[ze[0]])&&(ye.c[Xe]=ze))}for(ye.c[Xe]||(ze=Ke[Xe])&&(ye.c[Xe]=ze),ze=0;ze<ot.length;ze+=1)ye.a.push(new ue(Xe,ot[ze]))}}function rt(ye,Ee){this.c=ye,this.a=Ee}var xe={Arimo:!0,Cousine:!0,Tinos:!0};rt.prototype.load=function(ye){var Ee=new ie,He=this.c,ze=new Ne(this.a.api,this.a.text),Xe=this.a.families;Te(ze,Xe);var ot=new Ge(Xe);Je(ot),ne(He,De(ze),ae(Ee)),re(Ee,function(){ye(ot.a,ot.c,xe)})};function de(ye,Ee){this.c=ye,this.a=Ee}de.prototype.load=function(ye){var Ee=this.a.id,He=this.c.o;Ee?oe(this.c,(this.a.api||"https://use.typekit.net")+"/"+Ee+".js",function(ze){if(ze)ye([]);else if(He.Typekit&&He.Typekit.config&&He.Typekit.config.fn){ze=He.Typekit.config.fn;for(var Xe=[],ot=0;ot<ze.length;ot+=2)for(var it=ze[ot],dt=ze[ot+1],ht=0;ht<dt.length;ht++)Xe.push(new ue(it,dt[ht]));try{He.Typekit.load({events:!1,classes:!1,async:!0})}catch{}ye(Xe)}},2e3):ye([])};function pe(ye,Ee){this.c=ye,this.f=Ee,this.a=[]}pe.prototype.load=function(ye){var Ee=this.f.id,He=this.c.o,ze=this;Ee?(He.__webfontfontdeckmodule__||(He.__webfontfontdeckmodule__={}),He.__webfontfontdeckmodule__[Ee]=function(Xe,ot){for(var it=0,dt=ot.fonts.length;it<dt;++it){var ht=ot.fonts[it];ze.a.push(new ue(ht.name,fe("font-weight:"+ht.weight+";font-style:"+ht.style)))}ye(ze.a)},oe(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+te(this.c)+"/"+Ee+".js",function(Xe){Xe&&ye([])})):ye([])};var Se=new at(window);Se.a.c.custom=function(ye,Ee){return new We(Ee,ye)},Se.a.c.fontdeck=function(ye,Ee){return new pe(Ee,ye)},Se.a.c.monotype=function(ye,Ee){return new _e(Ee,ye)},Se.a.c.typekit=function(ye,Ee){return new de(Ee,ye)},Se.a.c.google=function(ye,Ee){return new rt(Ee,ye)};var Le={load:w(Se.load,Se)};k.exports?k.exports=Le:(window.WebFont=Le,window.WebFontConfig&&Se.load(window.WebFontConfig))})()})(webfontloader);var webfontloaderExports=webfontloader.exports;const WebfontLoader=getDefaultExportFromCjs(webfontloaderExports);class FontLoader{constructor(){this.slots={loaded:new Slot}}load(_){WebfontLoader.load({custom:{families:_},active:()=>{_.forEach(y=>this.slots.loaded.emit(y))}})}}function rBound(k,_=!1){const y=Bound.deserialize(k.xywh);return isTopLevelBlock(k)?{...y,rotate:0}:{...y,rotate:_?-k.rotate:k.rotate}}function isConnectorAndBindingsAllSelected(k,_){if(!_.find(H=>H.id===k.id))return!1;const{source:w,target:$}=k,B=_.find(H=>H.id===w?.id),R=_.find(H=>H.id===$?.id);return!!(!w.id&&!$.id||!w.id&&R||!$.id&&B||B&&R)}function getAnchors(k){const _=Bound.deserialize(k.xywh),y=10,w=[],$=isTopLevelBlock(k)?0:k.rotate;return[[_.center[0],_.y-y],[_.center[0],_.maxY+y],[_.x-y,_.center[1]],[_.maxX+y,_.center[1]]].map(B=>getPointFromBoundsWithRotation({..._,rotate:$},B)).forEach(B=>{const R=connectableIntersectLine(k,[_.center,B]);assertExists(R);const H=getPointFromBoundsWithRotation({..._,rotate:-$},R[0]);w.push({point:R[0],coord:_.toRelative(H)})}),w}function connectableIntersectLine(k,_){return isTopLevelBlock(k)?linePolygonIntersects(_[0],_[1],Bound.deserialize(k.xywh).points):k.intersectWithLine(_[0],_[1])}function getConnectableRelativePosition(k,_){if(isTopLevelBlock(k)){const y=Bound.deserialize(k.xywh),w=y.getRelativePoint(_),$=polygonGetPointTangent(y.points,w);return new PointLocation(w,$)}else return k.getRelativePointLocation(_)}function connectableHitTest(k,_){return isTopLevelBlock(k)?Bound.deserialize(k.xywh).isPointInBound(_):k.hitTest(_[0],_[1],{ignoreTransparent:!1})}function getNearestConnectableAnchor(k,_){const y=getAnchors(k);return closestPoint(y.map(w=>w.point),_)}function closestPoint(k,_){const y=k.map(w=>({p:w,d:Vec.dist(w,_)}));return y.sort((w,$)=>w.d-$.d),y[0].p}function computePoints(k,_,y,w,$,B,R,H){k=downscalePrecision(k),_=downscalePrecision(_),y=downscalePrecision(y),w=downscalePrecision(w);const j=getConnectablePoints(k,_,y,w,$,B,R,H),q=j.points;return y=j.nextStartPoint,w=j.lastEndPoint,[filterConnectablePoints(filterConnectablePoints(q,R?.expand(-1)??null),H?.expand(-1)??null),k,_,y,w]}function downscalePrecision(k){return[Number(k[0].toFixed(2)),Number(k[1].toFixed(2)),k[2]??0]}function filterConnectablePoints(k,_){return k.filter(y=>_?!_.isPointInBound(y):!0)}function pushWithPriority(k,_,y=0){k.push(..._.map(w=>[...w,y]))}function pushLineIntersectsToPoints(k,_,y,w=0){const $=lineIntersects(_[0],_[1],y[0],y[1],!0);$&&pushWithPriority(k,[$],w)}function pushOuterPoints(k,_,y,w){_&&y&&w&&(pushWithPriority(k,w.getVerticesAndMidpoints()),pushWithPriority(k,[w.center],2),[_.upperLine,_.horizontalLine,_.lowerLine,y.upperLine,y.horizontalLine,y.lowerLine].forEach($=>{pushLineIntersectsToPoints(k,$,w.leftLine,0),pushLineIntersectsToPoints(k,$,w.rightLine,0)}),[_.leftLine,_.verticalLine,_.rightLine,y.leftLine,y.verticalLine,y.rightLine].forEach($=>{pushLineIntersectsToPoints(k,$,w.upperLine,0),pushLineIntersectsToPoints(k,$,w.lowerLine,0)}))}function pushBoundMidPoint(k,_,y,w,$){if(_.maxX<y.x){const B=(_.maxX+y.x)/2;[w.horizontalLine,$.horizontalLine,w.upperLine,w.lowerLine,$.upperLine,$.lowerLine].forEach((R,H)=>{pushLineIntersectsToPoints(k,R,[[B,0],[B,1]],H===0||H===1?6:3)})}if(_.maxY<y.y){const B=(_.maxY+y.y)/2;[w.verticalLine,$.verticalLine,w.leftLine,w.rightLine,$.leftLine,$.rightLine].forEach((R,H)=>{pushLineIntersectsToPoints(k,R,[[0,B],[1,B]],H===0||H===1?6:3)})}}function pushGapMidPoint(k,_,y,w,$,B){if(almostEqual(_[1],y.y,.02)||almostEqual(_[1],y.maxY,.02)){const R=[y.upperLine,y.lowerLine,w.upperLine,w.lowerLine].map(j=>lineIntersects(_,[_[0],_[1]+1],j[0],j[1],!0));R.sort((j,q)=>j[1]-q[1]);const H=Vec.lrp(R[1],R[2],.5);pushWithPriority(k,[H],6),[$.leftLine,$.rightLine,B.leftLine,B.rightLine].forEach(j=>{pushLineIntersectsToPoints(k,[H,[H[0]+1,H[1]]],j,0)})}else{const R=[y.leftLine,y.rightLine,w.leftLine,w.rightLine].map(j=>lineIntersects(_,[_[0]+1,_[1]],j[0],j[1],!0));R.sort((j,q)=>j[0]-q[0]);const H=Vec.lrp(R[1],R[2],.5);pushWithPriority(k,[H],6),[$.upperLine,$.lowerLine,B.upperLine,B.lowerLine].forEach(j=>{pushLineIntersectsToPoints(k,[H,[H[0],H[1]+1]],j,0)})}}function removeDulicatePoints(k){k=k.map(downscalePrecision),k.sort((_,y)=>_[0]-y[0]);for(let _=1;_<k.length-1;_++){const y=k[_],w=k[_-1];almostEqual(y[0],w[0],.02)&&(y[0]=w[0])}k.sort((_,y)=>_[1]-y[1]);for(let _=1;_<k.length-1;_++){const y=k[_],w=k[_-1];almostEqual(y[1],w[1],.02)&&(y[1]=w[1])}k.sort((_,y)=>_[0]<y[0]?-1:_[0]>y[0]?1:_[1]<y[1]?-1:_[1]>y[1]?1:0);for(let _=1;_<k.length;_++){const y=k[_],w=k[_-1];if(almostEqual(y[0],w[0],.02)&&almostEqual(y[1],w[1],.02)){y[2]<=w[2]?k.splice(_,1):k.splice(_-1,1),_--;continue}}return k}function getConnectablePoints(k,_,y,w,$,B,R,H){const j=Bound.fromPoints([k,_]),q=R&&H&&R.unite(H);let X=[y,w];pushWithPriority(X,j.getVerticesAndMidpoints()),(!$||!B)&&pushWithPriority(X,[j.center],3),q&&pushOuterPoints(X,R,H,q),$&&B&&(assertExists(R),assertExists(H),pushGapMidPoint(X,k,$,B,R,H),pushGapMidPoint(X,_,B,$,H,R),pushBoundMidPoint(X,$,B,R,H),pushBoundMidPoint(X,B,$,H,R)),R&&(pushWithPriority(X,R.getVerticesAndMidpoints()),pushWithPriority(X,R.include(w).points)),H&&(pushWithPriority(X,H.getVerticesAndMidpoints()),pushWithPriority(X,H.include(y).points)),X=removeDulicatePoints(X);const ee=X.map(ne=>ne[0]+","+ne[1]).sort();ee.forEach((ne,oe)=>{if(oe!==0&&ne===ee[oe-1])throw new Error("duplicate point")});const te=[y,w].map(ne=>X.find(oe=>almostEqual(oe[0],ne[0],.02)&&almostEqual(oe[1],ne[1],.02)));return assertExists(te[0]),assertExists(te[1]),{points:X,nextStartPoint:te[0],lastEndPoint:te[1]}}function getDirectPath(k,_){if(almostEqual(k[0],_[0],.02)||almostEqual(k[1],_[1],.02))return[k,_];{const y=Vec.sub(_,k),w=[k[0],k[1]+y[1]];return[k,w,_]}}function mergePath(k){if(k.length===0)return[];const _=[[k[0][0],k[0][1]]];for(let y=1;y<k.length-1;y++){const w=k[y],$=k[y-1],B=k[y+1];almostEqual($[0],w[0],.02)&&almostEqual(w[0],B[0],.02)||almostEqual($[1],w[1],.02)&&almostEqual(w[1],B[1],.02)||_.push([w[0],w[1]])}_.push(k[k.length-1]);for(let y=0;y<_.length-1;y++){const w=_[y],$=_[y+1];try{assertEquals(almostEqual(w[0],$[0],.02)||almostEqual(w[1],$[1],.02),!0)}catch{console.log(k),console.log(_)}}return _}function computeOffset(k,_){const y=[20,20,20,20],w=[20,20,20,20];if(!(k&&_))return[y,w];let $=isOverlap$1(k.upperLine,_.lowerLine,0,!1),B;return $&&k.upperLine[0][1]>_.lowerLine[0][1]&&(B=Vec.distanceToLineSegment(k.upperLine[0],k.upperLine[1],_.lowerLine[0],!1),y[1]=Math.max(Math.min(B/2,y[1]),0)),$=isOverlap$1(k.rightLine,_.leftLine,1,!1),$&&k.rightLine[0][0]<_.leftLine[0][0]&&(B=Vec.distanceToLineSegment(k.rightLine[0],k.rightLine[1],_.leftLine[0],!1),y[2]=Math.max(Math.min(B/2,y[2]),0)),$=isOverlap$1(k.lowerLine,_.upperLine,0,!1),$&&k.lowerLine[0][1]<_.upperLine[0][1]&&(B=Vec.distanceToLineSegment(k.lowerLine[0],k.lowerLine[1],_.upperLine[0],!1),y[3]=Math.max(Math.min(B/2,y[3]),0)),y[0]=w[2]=Math.min(y[0],w[2])===0?20:Math.min(y[0],w[2]),y[1]=w[3]=Math.min(y[1],w[3])===0?20:Math.min(y[1],w[3]),y[2]=w[0]=Math.min(y[2],w[0])===0?20:Math.min(y[2],w[0]),y[3]=w[1]=Math.min(y[3],w[1])===0?20:Math.min(y[3],w[1]),[y,w]}function getNextPoint(k,_,y=10,w=10,$=10,B=10){const R=Array.from(_);if(almostEqual(k.x,R[0]))R[0]-=y;else if(almostEqual(k.y,R[1]))R[1]-=w;else if(almostEqual(k.maxX,R[0]))R[0]+=$;else if(almostEqual(k.maxY,R[1]))R[1]+=B;else{const H=Vec.normalize(Vec.sub(R,k.center)),j=H[0]>0?1:-1,q=H[1]>0?1:-1;if((Math.abs(_.tangent[0])<Math.abs(_.tangent[1])?0:1)===0)if(j>0){const ee=lineIntersects(k.rightLine[0],k.rightLine[1],R,[k.maxX+10,R[1]]);assertExists(ee),R[0]=ee[0]+y}else{const ee=lineIntersects(k.leftLine[0],k.leftLine[1],R,[k.x-10,R[1]]);assertExists(ee),R[0]=ee[0]-y}else if(q>0){const ee=lineIntersects(k.lowerLine[0],k.lowerLine[1],R,[R[0],k.maxY+10]);assertExists(ee),R[1]=ee[1]+w}else{const ee=lineIntersects(k.upperLine[0],k.upperLine[1],R,[R[0],k.y-10]);assertExists(ee),R[1]=ee[1]-w}}return R}function computeNextStartEndPoint(k,_,y,w,$,B){const R=y&&$?getNextPoint(y,k,$[0],$[1],$[2],$[3]):k,H=w&&B?getNextPoint(w,_,B[0],B[1],B[2],B[3]):_;return[R,H]}function adjustStartEndPoint(k,_,y=null,w=null){w||(Math.abs(_[0]-k[0])>Math.abs(_[1]-k[1])?_[0]+=sign(_[0]-k[0])*20:_[1]+=sign(_[1]-k[1])*20),y||(Math.abs(_[0]-k[0])>Math.abs(_[1]-k[1])?k[0]-=sign(_[0]-k[0])*20:k[1]-=sign(_[1]-k[1])*20)}class ConnectionOverlay extends Overlay{constructor(){super(...arguments),this.points=[],this.highlightPoint=null,this.bound=null}render(_){const y=this.surface.viewport.zoom;this.points.forEach(w=>{_.beginPath(),_.arc(w[0],w[1],3/y,0,Math.PI*2),_.fillStyle="white",_.strokeStyle="blue",_.fill(),_.stroke()}),this.highlightPoint&&(_.beginPath(),_.arc(this.highlightPoint[0],this.highlightPoint[1],3/y,0,Math.PI*2),_.fillStyle="blue",_.strokeStyle="blue",_.fill(),_.stroke()),this.bound&&(_.beginPath(),_.rect(this.bound.x,this.bound.y,this.bound.w,this.bound.h),_.fillStyle="rgba(211, 211, 211, 0.3)",_.fill())}clear(){this.points=[],this.highlightPoint=null,this.bound=null}}class EdgelessConnectorManager{constructor(_){this._edgeless=_,this._aStarRunner=null,this._connectionOverlay=new ConnectionOverlay,this._edgeless.surface.viewport.addOverlay(this._connectionOverlay),this._connectionOverlay.surface=this._edgeless.surface}_findConnectablesInViewport(){const{surface:_,page:y}=this._edgeless,{viewport:w}=_,$=_.pickByBound(Bound.from(w.viewportBounds)).filter(R=>R.connectable),B=y.getBlockByFlavour("affine:note").filter(R=>w.isInViewport(Bound.deserialize(R.xywh)));return[...$,...B]}searchConnection(_,y=[]){const{_connectionOverlay:w}=this,{surface:$}=this._edgeless,B=this._findConnectablesInViewport();w.clear();let R=null;for(let H=0;H<B.length;H++){const j=B[H];if(y.includes(j.id))continue;const q=Bound.deserialize(j.xywh);if(!Bound.from(getBoundsWithRotation(rBound(j))).expand(10).isPointInBound(_))continue;const ee=getAnchors(j);w.points=ee.map(ne=>ne.point);for(let ne=0;ne<ee.length;ne++){const oe=ee[ne];Vec.dist(oe.point,_)<4&&(w.highlightPoint=oe.point,R={id:j.id,position:oe.coord})}if(R)break;const te=this._getConnectableNearestPoint(j,_);if(Vec.dist(te,_)<8){w.highlightPoint=te;const ne=getPointFromBoundsWithRotation(rBound(j,!0),te);$.refresh(),R={id:j.id,position:q.toRelative(ne).map(oe=>clamp$1(oe,0,1))}}if(R)break;connectableHitTest(j,_)&&(R={id:j.id})}return R||(R={position:_}),$.refresh(),R}hasRelatedElement(_){const{source:y,target:w}=_;return!(y.id&&!getEdgelessElement(this._edgeless,y.id)||w.id&&!getEdgelessElement(this._edgeless,w.id))}clear(){this._connectionOverlay.points=[],this._connectionOverlay.highlightPoint=null,this._connectionOverlay.bound=null,this._edgeless.surface.refresh()}_getConnectableNearestPoint(_,y){return isTopLevelBlock(_)?polygonNearestPoint(Bound.deserialize(_.xywh).points,y):_.getNearestPoint(y)}updateConnection(_,y,w){const{surface:$}=this._edgeless,B=_.id,H=_[w==="source"?"target":"source"]?.id,j=this.searchConnection(y,H?[H]:[]);$.updateElement(B,{[w]:j})}updatePath(_,y){const{surface:w}=this._edgeless,$=y??this._generateConnectorPath(_)??[],B=getBoundFromPoints($),R=$.map(H=>Vec.sub(H,[B.x,B.y]));_.path=R,_.xywh=B.serialize(),w.refresh()}updateXYWH(_,y){const{surface:w}=this._edgeless,$=Bound.deserialize(_.xywh),B=Vec.sub([y.x,y.y],[$.x,$.y]),R={},{source:H,target:j}=_;!H.id&&H.position&&(R.source={position:Vec.add(H.position,B)}),!j.id&&j.position&&(R.target={position:Vec.add(j.position,B)}),R.xywh=y.serialize(),w.updateElement(_.id,R)}_generateConnectorPath(_){const{mode:y}=_;if(y===ConnectorMode.Straight)return this._generateStraightConnectorPath(_);{const w=this._getConnectorEndElement(_,"source"),$=this._getConnectorEndElement(_,"target"),[B,R]=this._computeStartEndPoint(_),H=w?Bound.from(getBoundsWithRotation(rBound(w))):null,j=$?Bound.from(getBoundsWithRotation(rBound($))):null;return this.generateOrthogonalConnectorPath({startPoint:B,endPoint:R,startBound:H,endBound:j})}}_generateStraightConnectorPath(_){const{source:y,target:w}=_;if(y.id&&!y.position&&w.id&&!w.position){const $=this._getConnectorEndElement(_,"source"),B=this._getConnectorEndElement(_,"target"),R=Bound.deserialize($.xywh),H=Bound.deserialize(B.xywh),j=getNearestConnectableAnchor($,H.center),q=getNearestConnectableAnchor(B,R.center);return[j,q]}else{const $=this._getConnectionPoint(_,"target"),B=this._getConnectionPoint(_,"source");return(B&&$&&[B,$])??[]}}_prepareOrthogonalConnectorInfo(_){const{startBound:y,endBound:w,startPoint:$,endPoint:B}=_,[R,H]=computeOffset(y,w),[j,q]=computeNextStartEndPoint($,B,y,w,R,H),X=y?y.expand(R[0],R[1],R[2],R[3]):null,ee=w?w.expand(H[0],H[1],H[2],H[3]):null;return[$,B,j,q,y,w,X,ee]}_computeStartEndPoint(_){const{source:y,target:w}=_,$=this._getConnectorEndElement(_,"source"),B=this._getConnectorEndElement(_,"target");let R,H;if(y.id&&!y.position&&w.id&&!w.position){assertExists($),assertExists(B);const j=getAnchors($),q=getAnchors(B);let X=1/0,ee=new PointLocation,te=new PointLocation;for(const ne of j)for(const oe of q){const ie=Vec.dist(ne.point,oe.point);ie+.1<X&&(X=ie,ee=ne.point,te=oe.point)}R=ee,H=te}else R=this._getConnectionPoint(_,"source"),H=this._getConnectionPoint(_,"target");return[R,H]}generateOrthogonalConnectorPath(_){const y=this._prepareOrthogonalConnectorInfo(_);let[w,$,B,R]=y;const[,,,,H,j,q,X]=y,ee=[],te=[];if(H&&ee.push(H.clone()),j&&ee.push(j.clone()),q&&te.push(q.clone()),X&&te.push(X.clone()),H&&j&&H.isPointInBound($)&&j.isPointInBound(w)||H&&q?.isPointInBound($,0)||j&&X?.isPointInBound(w,0))return getDirectPath(w,$);const ne=computePoints(w,$,B,R,H,j,q,X),oe=ne[0];[,w,$,B,R]=ne,adjustStartEndPoint(w,$,H,j),this._aStarRunner=new AStarRunner(oe,B,R,w,$,ee,te),this._aStarRunner.run();let ie=this._aStarRunner.path;return j||ie.pop(),H||ie.shift(),ie=mergePath(ie),ie}_getConnectorEndElement(_,y){const{surface:w,page:$}=this._edgeless,B=_[y].id;return B?w.pickById(B)??$.getBlockById(B):null}_getConnectionPoint(_,y){const w=_[y],$=y==="source"?"target":"source";if(w.id){const B=this._getConnectorEndElement(_,y);if(assertExists(B),w.position)return getConnectableRelativePosition(B,w.position);{const R=this._getConnectionPoint(_,$);return getNearestConnectableAnchor(B,R)}}else return assertExists(w.position),PointLocation.fromVec(w.position)}syncConnectorPos(_){this.getConnecttedConnectors(_).forEach(w=>this.updatePath(w))}detachConnectors(_){const y=this._edgeless.surface;_.forEach(w=>{this.getConnecttedConnectors([w]).forEach($=>{const B=$.absolutePath;$.source.id===w.id?y.updateElement($.id,{source:{position:B[0]}}):$.target.id===w.id&&y.updateElement($.id,{target:{position:B[B.length-1]}})})})}getConnecttedConnectors(_){const{surface:y}=this._edgeless,w=new Set(_.map(R=>R.id)),$=y.getElements().filter(R=>R.type==="connector"),B=[];return $.forEach(R=>{(R.source.id&&w.has(R.source.id)||R.target.id&&w.has(R.target.id))&&B.push(R)}),B}getConnecttedElements(_){const{surface:y}=this._edgeless,w=y.getElements().filter(B=>B.type==="connector"),$=[];return w.forEach(B=>{B.source.id===_.id&&B.target.id?$.push(getEdgelessElement(this._edgeless,B.target.id)):B.target.id===_.id&&B.source.id&&$.push(getEdgelessElement(this._edgeless,B.source.id))}),$}}class EdgelessToolController{constructor(_){this._draggingArea=null,this.enableHover=!1,this._edgeless=_}get draggingArea(){return this._draggingArea}get _surface(){return this._edgeless.surface}get _page(){return this._edgeless.page}get _blocks(){return this._edgeless.sortedNotes}}var DefaultModeDragType;(function(k){k.ContentMoving="content-moving",k.Selecting="selecting",k.NativeEditing="native-editing",k.None="none",k.PreviewDragging="preview-dragging",k.AltCloning="alt-cloning"})(DefaultModeDragType||(DefaultModeDragType={}));class DefaultToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"default"},this.enableHover=!0,this.dragType=DefaultModeDragType.None,this._dragStartPos={x:0,y:0},this._dragLastPos={x:0,y:0},this._lastMoveDelta={x:0,y:0},this._lock=!1,this._isDoubleClickedOnMask=!1,this._alignBound=new Bound,this._selectedBounds=[],this._toBeMoved=[],this._frames=new Set}get draggingArea(){return this.dragType===DefaultModeDragType.Selecting?{start:new DOMPoint(this._dragStartPos.x,this._dragStartPos.y),end:new DOMPoint(this._dragLastPos.x,this._dragLastPos.y)}:null}get selection(){return this._edgeless.selectionManager}get selectedBlocks(){return this.selection.selectedBlocks}get state(){return this.selection.state}get isActive(){return this.selection.state.editing}_pick(_,y,w){const{surface:$}=this._edgeless,[B,R]=$.viewport.toModelCoord(_,y),H=$.pickTop(B,R,w);return H||pickTopBlock(this._blocks,B,R)}_setNoneSelectionState(){this.selection.empty||(this.selection.setSelection({elements:[],editing:!1}),resetNativeSelection(null))}_setSelectionState(_,y){this.selection.setSelection({elements:_,editing:y})}_handleClickOnSelected(_,y){const{elements:w,editing:$}=this.state;if(this.selection.setSelectedBlocks([]),$&&w.length===1&&w[0]===_.id){handleNativeRangeAtPoint(y.raw.clientX,y.raw.clientY);return}if(!y.keys.shift&&w.length===1&&isTopLevelBlock(_)&&(w[0]===_.id&&!$||$&&w[0]!==_.id)){this._setSelectionState([_.id],!0),requestAnimationFrame(()=>{handleNativeRangeAtPoint(y.raw.clientX,y.raw.clientY)}),this.selection.setSelectedBlocks([]);return}if(y.keys.shift){const B=[...w];w.includes(_.id)?this._setSelectionState(B.filter(R=>R!==_.id),!1):this._setSelectionState([...B,_.id],!1)}else this._setSelectionState([_.id],!1)}_handleSurfaceDragMove(_,y,w){this._lock||(this._lock=!0,this._page.captureSync());const{surface:$}=this._edgeless,B=y.clone();B.x+=w.x,B.y+=w.y,_ instanceof ConnectorElement&&this._edgeless.connector.updateXYWH(_,B),$.setElementBound(_.id,B)}_handleBlockDragMove(_,y,w){const $=y.clone();$.x+=w.x,$.y+=w.y,this._page.updateBlock(_,{xywh:$.serialize()}),this.selectedBlocks.length&&this.selection.setSelectedBlocks(this.selectedBlocks)}_isInSelectedRect(_,y){const w=this.selection.elements;if(!w.length)return!1;const $=getCommonBound(w.map(H=>{if(isTopLevelBlock(H)){const[j,q,X,ee]=deserializeXYWH(getXYWH(H));return{x:j,y:q,w:X,h:ee}}return H})),[B,R]=this._surface.toModelCoord(_,y);return!!($&&isPointIn$1($,B,R))}_isDraggable(_){return!(_ instanceof ConnectorElement&&!isConnectorAndBindingsAllSelected(_,this._toBeMoved))}_forceUpdateSelection(_,y=!1,w={x:0,y:0}){this._edgeless.slots.selectedRectUpdated.emit({type:_===DefaultModeDragType.Selecting?"select":"move",delta:w,dragging:y})}onContainerPointerDown(){}onContainerClick(_){const y=this._pick(_.x,_.y);y?this._handleClickOnSelected(y,_):this._setNoneSelectionState(),this._isDoubleClickedOnMask=!1}onContainerContextMenu(){}onContainerDblClick(_){const y=this._pick(_.x,_.y,{pierce:!1,expand:10});if(y){if(y instanceof TextElement){const[w,$]=this._edgeless.surface.viewport.toModelCoord(_.x,_.y);mountTextEditor(y,this._edgeless,{x:w,y:$});return}if(y instanceof ShapeElement){mountShapeEditor(y,this._edgeless);return}if(y instanceof FrameElement){mountFrameEditor(y,this._edgeless);return}}else{addText(this._edgeless,_);return}if(_.raw.target&&_.raw.target instanceof HTMLElement&&_.raw.target.classList.contains("affine-note-mask")){this.onContainerClick(_),this._isDoubleClickedOnMask=!0;return}}onContainerTripleClick(){this._isDoubleClickedOnMask}_determineDragType(_){if(this._isInSelectedRect(_.x,_.y))return this.state.editing?DefaultModeDragType.NativeEditing:DefaultModeDragType.ContentMoving;{const y=this._pick(_.x,_.y);return y?(this._setSelectionState([y.id],!1),DefaultModeDragType.ContentMoving):DefaultModeDragType.Selecting}}async _cloneContent(){this._lock=!0;const{surface:_}=this._edgeless,y=await Promise.all(this._toBeMoved.map(async w=>await this._cloneSelected(w,_)));this._setSelectionState(y.map(w=>w.id),!1)}async _cloneSelected(_,y){if(isTopLevelBlock(_)){const w=this._edgeless.getService("affine:note"),$=this._page.addBlock("affine:note",{xywh:_.xywh},this._page.root?.id),B=this._page.getBlockById($);return assertExists(B),await w.json2Block(B,w.block2Json(_).children),this._page.getBlockById($)}else{const w=y.addElement(_.type,_.serialize());return y.pickById(w)}}_addFrames(){this.selection.elements.forEach(_=>{if(_ instanceof FrameElement)this._frames.add(_);else{const y=this._edgeless.frame.selectFrame([_]);y&&this._frames.add(y)}})}async onContainerDragStart(_){let y=this._determineDragType(_);const w=this.selection.elements,$=new Set(w);w.forEach(B=>{B instanceof FrameElement&&this._edgeless.frame.getElementsInFrame(B).forEach(R=>$.add(R))}),this._toBeMoved=Array.from($),_.keys.alt&&y===DefaultModeDragType.ContentMoving&&(y=DefaultModeDragType.AltCloning,await this._cloneContent()),this._addFrames(),this.initializeDragState(_,y)}initializeDragState(_,y){const{x:w,y:$}=_;this.dragType=y,this._dragStartPos={x:w,y:$},this._dragLastPos={x:w,y:$},this._alignBound=this._edgeless.snap.setupAlignables(this._toBeMoved),this._selectedBounds=this._toBeMoved.map(B=>Bound.deserialize(B.xywh))}onContainerDragMove(_){const y=this._edgeless.surface.viewport.zoom;switch(this.dragType){case DefaultModeDragType.Selecting:{const w=this._dragStartPos.x,$=this._dragStartPos.y,B=Math.min(w,_.x),R=Math.min($,_.y),[H,j]=this._surface.toModelCoord(B,R),q=Math.abs(w-_.x),X=Math.abs($-_.y),{zoom:ee}=this._surface.viewport,te=new Bound(H,j,q/ee,X/ee),ne=pickBlocksByBound(this._blocks,te),oe=this._surface.pickByBound(te);this._setSelectionState([...ne.map(ie=>ie.id),...oe.map(ie=>ie.id)],!1),this._forceUpdateSelection(this.dragType,!0);break}case DefaultModeDragType.AltCloning:case DefaultModeDragType.ContentMoving:{if(this._toBeMoved.every(q=>!this._isDraggable(q)))return;const w=(_.x-this._dragStartPos.x)/y,$=(_.y-this._dragStartPos.y)/y,B=this._alignBound.clone();B.x+=w,B.y+=$;const R=this._edgeless.snap.align(B),H={x:w+R.dx,y:$+R.dy};this._toBeMoved.forEach((q,X)=>{if(isPhasorElement(q)){if(!this._isDraggable(q))return;this._handleSurfaceDragMove(q,this._selectedBounds[X],H)}else this._handleBlockDragMove(q,this._selectedBounds[X],H)});const j=this._edgeless.frame.selectFrame(this._toBeMoved);j?this._edgeless.frame.setHighlight(j):this._edgeless.frame.clearHighlight(),this._forceUpdateSelection(this.dragType,!0,{x:H.x-this._lastMoveDelta.x,y:H.y-this._lastMoveDelta.y}),this._lastMoveDelta=H;break}case DefaultModeDragType.NativeEditing:break}this._dragLastPos={x:_.x,y:_.y}}onContainerDragEnd(){this._lock&&(this._page.captureSync(),this._lock=!1),!this.isActive&&(this._dragStartPos={x:0,y:0},this._dragLastPos={x:0,y:0},this._selectedBounds=[],this._lastMoveDelta={x:0,y:0},this._edgeless.snap.cleanupAlignables(),this._edgeless.frame.clearHighlight(),this._addFrames(),this._frames.forEach(_=>{this._edgeless.frame.calculateFrameColor(_)}),this._frames.clear(),this._toBeMoved=[],this._forceUpdateSelection(this.dragType),this.dragType=DefaultModeDragType.None)}onContainerMouseMove(){}onContainerMouseOut(_){}onPressShiftKey(_){}beforeModeSwitch(){}afterModeSwitch(){}}var __decorate$1E=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const buttonStyle=i$5`
  .slicer-button {
    display: flex;
    box-sizing: border-box;
    border-radius: 10px;
    padding: 5px;
    justify-content: center;
    align-items: center;
    color: var(--affine-icon-color);
    border: 1px solid var(--affine-border-color);
    background-color: var(--affine-hover-color-filled);
    cursor: pointer;
  }
`;let NoteSlicerButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._externalButton=null,this._popupButton=()=>{if(!this._externalButton)return;const _=this._externalButton;requestAnimationFrame(()=>{const y=this._button.getBoundingClientRect();this._button.style.visibility="hidden",_.show(y),_.addEventListener("transitionend",()=>{this._dispatchIndicatorEvent()},{once:!0})})},this._dispatchClipEvent=()=>{const _=new CustomEvent("clip");this.dispatchEvent(_)}}_createExternalButton(){const _=document.createElement("affine-note-slicer-popupbutton");document.body.appendChild(_),this._externalButton=_,this._disposables.addFromEvent(this._externalButton,"click",this._dispatchClipEvent),this._disposables.add(()=>{document.body.removeChild(_),this._externalButton=null})}_dispatchEnterButtonEvent(){const _=new CustomEvent("popupbutton");this.dispatchEvent(_)}_dispatchIndicatorEvent(){const _=new CustomEvent("showindicator");this.dispatchEvent(_)}firstUpdated(){this._externalButton||this._createExternalButton()}show(){this._button.addEventListener("transitionend",this._popupButton,{once:!0}),this._button.classList.add("slideout")}reset(){this._button.removeEventListener("transitionend",this._popupButton),this._button.classList.remove("slideout"),this._button.style.removeProperty("visibility"),this._externalButton?.reset()}render(){return x$1`<button
      class="slicer-button"
      @mouseenter=${this._dispatchEnterButtonEvent}
    >
      ${CutIcon}
    </button>`}};NoteSlicerButton.styles=[buttonStyle,i$5`
      .slicer-button {
        transform: translate3d(-50%, 0, 0);
        transition: transform 0.1s ease-out;
      }

      .slicer-button.slideout {
        transform: translate3d(-150%, 0, 0) translate3d(3px, 0, 0);
      }
    `];__decorate$1E([i$6(".slicer-button")],NoteSlicerButton.prototype,"_button",void 0);NoteSlicerButton=__decorate$1E([e$7("note-slicer-button")],NoteSlicerButton);let PopupNoteSlicerButton=class extends WithDisposable(s$2){constructor(){super(...arguments),this._rafId=0}show(_){this.style.display="block",this.style.transform=`translate3d(${_.x}px, ${_.y}px, 0)`;const y=requestAnimationFrame(()=>{this.style.transition="transform 0.1s 0.1s ease-in-out",this.style.transform=`translate3d(${_.x+_.width*.8}px, ${_.y}px, 0) scale(1.2)`,y===this._rafId&&(this._rafId=0)});this._rafId=y}reset(){this._rafId&&cancelAnimationFrame(this._rafId),this.style.removeProperty("display"),this.style.removeProperty("transform"),this.style.removeProperty("transition")}render(){return x$1`<button class="slicer-button">${CutIcon}</button>`}};PopupNoteSlicerButton.styles=[buttonStyle,i$5`
      :host {
        display: none;
        position: absolute;
        left: 0;
        top: 0;
        z-index: calc(var(--affine-z-index-popover, 0) + 2);
        transform-origin: center center;
      }
    `];PopupNoteSlicerButton=__decorate$1E([e$7("affine-note-slicer-popupbutton")],PopupNoteSlicerButton);var __decorate$1D=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NoteSlicerIndicator=class extends WithDisposable(s$2){show(){requestAnimationFrame(()=>{this.style.visibility="visible",requestAnimationFrame(()=>{this.style.transform=`translate(${this.offset}px, 0)`,this.style.width=`${this.width}px`})})}reset(){this.style.removeProperty("visibility"),this.style.removeProperty("transform"),this.style.removeProperty("width")}render(){return x$1` <div class="indicator-line"></div> `}};NoteSlicerIndicator.styles=i$5`
    :host {
      visibility: hidden;
      z-index: 1;
      width: 1px;
      transition: width 0.1s ease-in-out;
    }

    .indicator-line {
      height: 2px;
      box-shadow: 0px 4px 11px #3ab4f7;
      border-radius: 1px;
      background-color: var(--affine-blue-500);
    }
  `;__decorate$1D([n$a({attribute:!1})],NoteSlicerIndicator.prototype,"width",void 0);__decorate$1D([n$a({attribute:!1})],NoteSlicerIndicator.prototype,"offset",void 0);NoteSlicerIndicator=__decorate$1D([e$7("note-slicer-indicator")],NoteSlicerIndicator);function findClosestBlock(k,_){const y=Array.from(k.querySelectorAll(".affine-note-block-container > .affine-block-children-container > [data-block-id]"));let w=Number.POSITIVE_INFINITY,$=null;if(!y.length)return null;for(const B of y){const R=B.getBoundingClientRect(),H=Math.abs(R.y+R.height/2-_.y);if(H<=w)w=H,$=B;else return $}return $}var __decorate$1C=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NoteSlicer=class extends WithDisposable(s$2){constructor(){super(...arguments),this._lastPosition=null,this._noteModel=null,this._blockModel=null,this._lastPointerState=null}connectedCallback(){super.connectedCallback(),this.edgelessPage.service&&(this._disposables.add(this.edgelessPage.service.uiEventDispatcher.add("pointerMove",_=>{const y=_.get("pointerState");this._lastPointerState=y,this._updateVisibility(this._lastPointerState)})),this._disposables.add(this.edgelessPage.service.uiEventDispatcher.add("wheel",()=>{this._hide()})),this._disposables.add(this.edgelessPage.page.slots.blockUpdated.on(()=>{this._lastPointerState&&this._updateVisibility(this._lastPointerState)})))}get selection(){return this.edgelessPage.selectionManager}get _notHovering(){return this.edgelessPage.edgelessTool.type!=="default"||this.edgelessPage.tools.currentController.dragType!==DefaultModeDragType.None}get _zoom(){return this.edgelessPage?.surface?.viewport.zoom??1}_updateVisibility(_){const y=this.selection.elements[0];if(this._zoom<.4||this._notHovering||!y||!isTopLevelBlock(y)){this._hide();return}const w=this._getEditingState(_,y);w?this._show(_,w):this._hide()}_getEditingState(_,y){const w=getBlockElementByModel(y);assertExists(w);const{raw:{clientX:$,clientY:B}}=_,R=findClosestBlock(w,new Point($,B));if(!R)return null;const H=getRectByBlockElement(R),j=B<=H.y+H.height/2,q=j?R.previousElementSibling:R.nextElementSibling;if(!q)return null;const X=getModelByBlockElement(R),ee=getModelByBlockElement(q),te=q.getBoundingClientRect(),ne=j?te:H,oe=j?H:te;return{note:y,noteElement:w,upperBlock:j?ee:X,upperBlockElement:j?q:R,gapRect:new DOMRect(ne.x,ne.y+ne.height,ne.width,oe.y-(ne.y+ne.height))}}_show(_,y){const{note:w,noteElement:$,upperBlock:B,upperBlockElement:R,gapRect:H}=y;if(!$.parentElement){this._hide();return}const j=w===this._noteModel,X=$.parentElement.getBoundingClientRect(),[ee,te]=deserializeXYWH(w.xywh),ne=ee*this._zoom,oe=te*this._zoom-X.top+H.top+H.height/2,ie=te+R.offsetHeight+R.offsetTop;if(this._lastPosition)if(!almostEqual$1(ne,this._lastPosition.transformX)||!almostEqual$1(oe,this._lastPosition.transformY))this.style.zIndex&&this.style.removeProperty("z-index"),this._slicerButton?.reset(),this._indicatorLine?.reset();else return;this._noteModel=w,this._blockModel=B,this._lastPosition={transformX:ne,transformY:oe,width:$.offsetWidth*this._zoom,gapRect:H,sliceVerticalPos:ie},requestAnimationFrame(()=>{this.style.display==="block"&&j?this.style.transition="transform .2s ease-in-out":(this.style.display="block",this.style.removeProperty("transition")),this.style.transform=`translate3d(calc(var(--affine-edgeless-x) + ${ne}px), calc(var(--affine-edgeless-y) + ${oe}px), 0) translate3d(0, -50%, 0)`})}_hide(){this.style.removeProperty("z-index"),this.style.removeProperty("display"),this._slicerButton?.reset(),this._indicatorLine?.reset(),this._lastPosition=null,this._blockModel=null,this._noteModel=null,this._lastPointerState=null}_showIndicator(){this._lastPosition&&this._indicatorLine?.show()}_popupButton(){this.style.zIndex="1",this._slicerButton.show()}_clipNote(){if(!this._blockModel||!this._noteModel||!this._lastPosition)return;const _=this.edgelessPage.page,{index:y,xywh:w,background:$,children:B}=this._noteModel,R=B.findIndex(te=>te.id===this._blockModel?.id),H=B.slice(R+1),{sliceVerticalPos:j}=this._lastPosition,[q,,X]=deserializeXYWH(w),ee=_.addBlock("affine:note",{background:$,xywh:serializeXYWH(q,j+EDGELESS_BLOCK_CHILD_PADDING+30,X,DEFAULT_NOTE_HEIGHT),index:y+1},_.root?.id);_.moveBlocks(H,_.getBlockById(ee)),this.selection.setSelectedBlocks([]),this._hide()}render(){return x$1`<div class="affine-note-slicer-container">
      <note-slicer-button
        .edgelessPage=${this.edgelessPage}
        @showindicator=${this._showIndicator}
        @popupbutton=${this._popupButton}
        @clip=${this._clipNote}
      ></note-slicer-button>
      <note-slicer-indicator
        .offset=${EDGELESS_BLOCK_CHILD_PADDING*this._zoom-20}
        .width=${this._lastPosition?.width??0}
      ></note-slicer-indicator>
    </div> `}};NoteSlicer.styles=i$5`
    :host {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
    }

    .affine-note-slicer-container {
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
  `;__decorate$1C([n$a({attribute:!1})],NoteSlicer.prototype,"edgelessPage",void 0);__decorate$1C([i$6("note-slicer-button")],NoteSlicer.prototype,"_slicerButton",void 0);__decorate$1C([i$6("note-slicer-indicator")],NoteSlicer.prototype,"_indicatorLine",void 0);__decorate$1C([t$2()],NoteSlicer.prototype,"_lastPosition",void 0);NoteSlicer=__decorate$1C([e$7("affine-note-slicer")],NoteSlicer);function EdgelessNotesStatus(k,_){if(!k.page.awarenessStore.getFlag("enable_note_index"))return A;const y=k.selectionManager.state,w=y.elements.length===1,$=k.getElementModel(y.elements[0]);if(!w||!(isTopLevelBlock($)&&matchFlavours($,["affine:note"])))return A;const B=_.filter(H=>H.id!==$.id),R=_.filter(H=>!H.hidden);return requestAnimationFrame(()=>{updateNotesPosition(k,B)}),x$1`<div class="affine-edgeless-notes-status">
    ${B.map(H=>{const j=R.indexOf(H);return x$1`<div
        data-note-id=${H.id}
        style=${o$4({position:"absolute",top:"-32px",left:"4px",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",gap:"10px",width:"24px",height:"24px",background:"var(--affine-blue-600)",color:"var(--affine-white)",borderRadius:"4px",fontSize:"12px",fontWeight:"600",lineHeight:"16px"})}
      >
        ${H.hidden?x$1`<span
              style=${o$4({display:"flex",padding:"4px"})}
              >${HiddenIcon}</span
            >`:x$1`<span
              style=${o$4({display:"flex",padding:"4px 6px",flexDirection:"column"})}
              >${j+1}</span
            >`}
      </div>`})}
  </div>`}var __decorate$1B=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessZoomToolbar=class extends WithDisposable(s$2){_isVerticalBar(){return this.layout==="vertical"}constructor(_){super(),this.layout="horizontal",this.setEdgelessTool=y=>{this.edgeless.tools.setEdgelessTool(y)},this.edgeless=_}get edgelessTool(){return this.edgeless.edgelessTool}get zoom(){return this.viewport.zoom}get viewport(){return this.edgeless.surface.viewport}_setZoomByStep(_){this.viewport.smoothZoom(clamp$2(this.zoom+_,ZOOM_MIN,ZOOM_MAX))}_zoomToFit(){const{centerX:_,centerY:y,zoom:w}=this.edgeless.getFitToScreenData();this.viewport.setViewport(w,[_,y],!0)}setZoomByAction(_){switch(_){case"fit":this._zoomToFit();break;case"reset":this.viewport.smoothZoom(1);break;case"in":case"out":this._setZoomByStep(ZOOM_STEP*(_==="in"?1:-1))}}firstUpdated(){const{_disposables:_,edgeless:{slots:y}}=this;_.add(y.edgelessToolUpdated.on(()=>this.requestUpdate())),_.add(y.viewportUpdated.on(()=>this.requestUpdate()))}render(){const _=`${Math.round(this.zoom*100)}%`,y=`edgeless-zoom-toolbar-container ${this.layout}`;return x$1`
      <div
        class=${y}
        @dblclick=${stopPropagation}
        @mousedown=${stopPropagation}
        @mouseup=${stopPropagation}
        @pointerdown=${stopPropagation}
      >
        <edgeless-tool-icon-button
          .tooltip=${"Fit to screen"}
          .tipPosition=${this._isVerticalBar()?"right":"top-end"}
          .arrow=${!this._isVerticalBar()}
          @click=${()=>this._zoomToFit()}
        >
          ${ViewBarIcon}
        </edgeless-tool-icon-button>
        <edgeless-tool-icon-button
          .tooltip=${"Zoom out"}
          .tipPosition=${this._isVerticalBar()?"right":"top"}
          .arrow=${!this._isVerticalBar()}
          @click=${()=>this._setZoomByStep(-ZOOM_STEP)}
        >
          ${MinusIcon}
        </edgeless-tool-icon-button>
        <span class="zoom-percent" @click=${()=>this.viewport.smoothZoom(1)}>
          ${_}
        </span>
        <edgeless-tool-icon-button
          .tooltip=${"Zoom in"}
          .tipPosition=${this._isVerticalBar()?"right":"top"}
          .arrow=${!this._isVerticalBar()}
          @click=${()=>this._setZoomByStep(ZOOM_STEP)}
        >
          ${PlusIcon}
        </edgeless-tool-icon-button>
      </div>
    `}};EdgelessZoomToolbar.styles=i$5`
    :host {
      position: absolute;
      bottom: 20px;
      left: 12px;
      z-index: var(--affine-z-index-popover);
      display: flex;
      justify-content: center;
      user-select: none;
    }

    .edgeless-zoom-toolbar-container {
      display: flex;
      align-items: center;
      background: transparent;
      border-radius: 8px;
      fill: currentcolor;
    }

    .edgeless-zoom-toolbar-container.horizantal {
      flex-direction: row;
    }

    .edgeless-zoom-toolbar-container.vertical {
      flex-direction: column;
      width: 40px;
      background-color: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      border: 1px solid var(--affine-border-color);
      border-radius: 8px;
    }

    .edgeless-zoom-toolbar-container[level='second'] {
      position: absolute;
      bottom: 8px;
      transform: translateY(-100%);
    }

    .edgeless-zoom-toolbar-container[hidden] {
      display: none;
    }

    .zoom-percent {
      display: block;
      box-sizing: border-box;
      width: 48px;
      height: 32px;
      line-height: 22px;
      padding: 5px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      text-align: center;
      cursor: pointer;
      color: var(--affine-icon-color);
    }

    .zoom-percent:hover {
      color: var(--affine-primary-color);
      background-color: var(--affine-hover-color);
    }
  `;__decorate$1B([n$a({attribute:!1})],EdgelessZoomToolbar.prototype,"layout",void 0);__decorate$1B([n$a({attribute:!1})],EdgelessZoomToolbar.prototype,"edgeless",void 0);EdgelessZoomToolbar=__decorate$1B([e$7("edgeless-zoom-toolbar")],EdgelessZoomToolbar);var __decorate$1A=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function createNoteMenuPopper(k,_){const y=new EdgelessZoomToolbar(_);return assertExists(k.shadowRoot),y.layout="vertical",k.shadowRoot.appendChild(y),computePosition(k,y,{placement:"top"}).then(({x:w,y:$})=>{Object.assign(y.style,{left:`${w}px`,top:`${$-10}px`})}),{element:y,dispose:()=>{y.remove()}}}let ZoomBarToggleButton=class extends s$2{_toggleNoteMenu(){this._zoomBar?(this._zoomBar.dispose(),this._zoomBar=null,this._popperShow=!1):(this._zoomBar=createNoteMenuPopper(this,this.edgeless),this._zoomBar.element.edgeless=this.edgeless,this._zoomBar.element.edgeless=this.edgeless,this._popperShow=!0)}constructor(_){super(),this._popperShow=!1,this._zoomBar=null,this.edgeless=_}disconnectedCallback(){this._zoomBar?.dispose(),this._zoomBar=null,this._popperShow=!1,super.disconnectedCallback()}render(){return x$1`
      <div class="toggle-button" @pointerdown=${stopPropagation}>
        <edgeless-tool-icon-button
          class=${this._popperShow?"actived":"non-actived"}
          .tooltip=${"Toggle Zoom Tool Bar"}
          .tipPosition=${"right"}
          .active=${this._popperShow}
          .arrow=${!1}
          .activeMode=${"background"}
          @click=${()=>this._toggleNoteMenu()}
        >
          ${MoreIcon}
        </edgeless-tool-icon-button>
      </div>
    `}};ZoomBarToggleButton.styles=i$5`
    :host {
      display: flex;
      position: absolute;
      bottom: 20px;
      left: 12px;
    }
    .toggle-button {
      display: flex;
      position: relative;
    }
    edgeless-zoom-toolbar {
      position: absolute;
      bottom: initial;
    }
  `;__decorate$1A([n$a({attribute:!1})],ZoomBarToggleButton.prototype,"edgeless",void 0);__decorate$1A([t$2()],ZoomBarToggleButton.prototype,"_popperShow",void 0);ZoomBarToggleButton=__decorate$1A([e$7("zoom-bar-toggle-button")],ZoomBarToggleButton);class EdgelessPageKeyboardManager extends PageKeyboardManager{constructor(_){super(_),this.pageElement=_,this._shouldRevertMode=!1,this._lastMode=null,this.pageElement.bindHotKey({v:()=>{this._setEdgelessTool(_,{type:"default"})},t:()=>{this._setEdgelessTool(_,{type:"text"})},l:()=>{this._setEdgelessTool(_,{type:"connector",mode:ConnectorMode.Straight,color:GET_DEFAULT_LINE_COLOR(),strokeWidth:LineWidth.LINE_WIDTH_TWO})},x:()=>{this._setEdgelessTool(_,{type:"connector",mode:ConnectorMode.Orthogonal,color:GET_DEFAULT_LINE_COLOR(),strokeWidth:LineWidth.LINE_WIDTH_TWO})},h:()=>{this._setEdgelessTool(_,{type:"pan",panning:!1})},n:()=>{this._setEdgelessTool(_,{type:"note",background:DEFAULT_NOTE_COLOR,childFlavour:DEFAULT_NOTE_CHILD_FLAVOUR,childType:DEFAULT_NOTE_CHILD_TYPE,tip:DEFAULT_NOTE_TIP})},p:()=>{this._setEdgelessTool(_,{type:"brush",color:GET_DEFAULT_LINE_COLOR(),lineWidth:LineWidth.Thin})},e:()=>{this._setEdgelessTool(_,{type:"eraser"})},s:()=>{const y=this._tryLoadShapeLocalState();this._setEdgelessTool(_,{type:"shape",shape:y?.shape??"rect",fillColor:y?.fillColor??DEFAULT_SHAPE_FILL_COLOR,strokeColor:y?.strokeColor??DEFAULT_SHAPE_STROKE_COLOR,shapeStyle:y?.shapeStyle??ShapeStyle.Scribbled})},f:()=>{this.pageElement.selectionManager.elements.length!==0&&!this.pageElement.selectionManager.editing?this.pageElement.frame.createFrameOnSelected():this.pageElement.selectionManager.editing||this._setEdgelessTool(_,{type:"frame"})},"Mod-a":y=>{this.pageElement.selectionManager.editing||(y.get("defaultState").event.preventDefault(),this.pageElement.selectionManager.setSelection({elements:[...this.pageElement.notes.map(w=>w.id),...this.pageElement.surface.getElements().map(w=>w.id)],editing:!1}))},"Mod-1":y=>{y.get("defaultState").event.preventDefault(),this.pageElement.slots.zoomUpdated.emit("fit")},"Mod--":y=>{y.get("defaultState").event.preventDefault(),this.pageElement.slots.zoomUpdated.emit("out")},"Mod-0":y=>{y.get("defaultState").event.preventDefault(),this.pageElement.slots.zoomUpdated.emit("reset")},"Mod-=":y=>{y.get("defaultState").event.preventDefault(),this.pageElement.slots.zoomUpdated.emit("in")},Backspace:()=>{this._delete()},Delete:()=>{this._delete()},Space:y=>{const w=y.get("defaultState").event;w instanceof KeyboardEvent&&this._space(w)},ArrowUp:()=>{this._move("ArrowUp")},ArrowDown:()=>{this._move("ArrowDown")},ArrowLeft:()=>{this._move("ArrowLeft")},ArrowRight:()=>{this._move("ArrowRight")}},{global:!0}),this.pageElement.handleEvent("keyDown",y=>{const w=y.get("defaultState").event;w instanceof KeyboardEvent&&this._shift(w)}),this.pageElement.handleEvent("keyUp",y=>{const w=y.get("defaultState").event;w instanceof KeyboardEvent&&this._shift(w)})}_space(_){const y=this.pageElement,{edgelessTool:w}=y.tools,{state:$}=y.selectionManager;if(_.type==="keydown"){if(w.type==="pan"||w.type==="default"&&$.editing)return;this._shouldRevertMode=!0,this._lastMode=w,this._setEdgelessTool(y,{type:"pan",panning:!1});return}_.type==="keyup"&&(w.type==="pan"&&this._shouldRevertMode&&this._lastMode&&this._setEdgelessTool(y,this._lastMode),this._shouldRevertMode=!1)}_shift(_){const y=this.pageElement;_.key.toLowerCase()==="shift"&&_.shiftKey?y.slots.pressShiftKeyUpdated.emit(!0):y.slots.pressShiftKeyUpdated.emit(!1)}_delete(){const _=this.pageElement;_.selectionManager.editing||(deleteElements(_,_.selectionManager.elements),_.selectionManager.clear(),_.selectionManager.setSelection(_.selectionManager.state))}_tryLoadShapeLocalState(){const _="blocksuite:"+this.pageElement.page.id+":edgelessShape",y=sessionStorage.getItem(_);let w=null;return y&&(w=JSON.parse(y)),w}_setEdgelessTool(_,y,w=!1){!w&&_.selectionManager.editing||_.tools.setEdgelessTool(y)}_move(_){const y=this.pageElement;if(y.selectionManager.editing)return;const{elements:w}=y.selectionManager;w.forEach($=>{const B=Bound.deserialize($.xywh).clone();switch(_){case"ArrowUp":B.y--;break;case"ArrowLeft":B.x--;break;case"ArrowRight":B.x++;break;case"ArrowDown":B.y++;break}isPhasorElement($)?($ instanceof ConnectorElement&&this.pageElement.connector.updateXYWH($,B),this.pageElement.surface.setElementBound($.id,B)):this.pageElement.page.updateBlock($,{xywh:B.serialize()}),this.pageElement.slots.hoverUpdated.emit()})}}class BrushToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"brush",color:GET_DEFAULT_LINE_COLOR(),lineWidth:4},this._draggingElementId=null,this._draggingPathPoints=null}onContainerPointerDown(){}onContainerClick(){}onContainerContextMenu(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerDragStart(_){if(!this._page.awarenessStore.getFlag("enable_surface"))return;this._page.captureSync();const{viewport:y}=this._edgeless.surface,[w,$]=y.toModelCoord(_.point.x,_.point.y),{color:B,lineWidth:R}=this.tool,H=[[w,$]],j=this._surface.addElement("brush",{points:H,color:B,lineWidth:R});this._draggingElementId=j,this._draggingPathPoints=H}onContainerDragMove(_){if(!this._page.awarenessStore.getFlag("enable_surface")||!this._draggingElementId)return;assertExists(this._draggingElementId),assertExists(this._draggingPathPoints);const{lineWidth:y}=this.tool,[w,$]=this._edgeless.surface.toModelCoord(_.point.x,_.point.y),B=[...this._draggingPathPoints,[w,$]];this._draggingPathPoints=B,this._surface.updateElement(this._draggingElementId,{points:B,lineWidth:y})}onContainerDragEnd(){this._draggingElementId=null,this._draggingPathPoints=null,this._page.captureSync()}onContainerMouseMove(){}onContainerMouseOut(){}onPressShiftKey(_){}beforeModeSwitch(){}afterModeSwitch(_){this._tryLoadBrushStateLocalRecord(_)}_tryLoadBrushStateLocalRecord(_){if(_.type!=="brush")return;const y="blocksuite:"+this._edgeless.page.id+":edgelessBrush",w=sessionStorage.getItem(y);if(w)try{const{color:$,lineWidth:B}=JSON.parse(w);this._edgeless.slots.edgelessToolUpdated.emit({type:"brush",color:$??"black",lineWidth:B??LineWidth.Thin})}catch{}}}class ConnectorToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"connector"},this._connector=null,this._source=null,this._startPoint=null}onContainerClick(){}onContainerContextMenu(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerPointerDown(_){this._startPoint=this._surface.viewport.toModelCoord(_.x,_.y),this._source=this._edgeless.connector.searchConnection(this._startPoint)}onContainerDragStart(){if(!this._page.awarenessStore.getFlag("enable_surface"))return;assertExists(this._source),assertExists(this._startPoint),this._page.captureSync();const{mode:_,color:y,strokeWidth:w}=this.tool,{_surface:$}=this,B=$.addElement("connector",{stroke:y,mode:_,controllers:[],strokeWidth:w,strokeStyle:StrokeStyle.Solid,source:this._source,target:{position:this._startPoint}});this._connector=$.pickById(B)}onContainerDragMove(_){if(!this._page.awarenessStore.getFlag("enable_surface"))return;assertExists(this._connector);const{connector:y}=this._edgeless,{viewport:w}=this._surface,$=w.toModelCoord(_.x,_.y),B=y.searchConnection($,this._connector.source.id?[this._connector.source.id]:[]);this._surface.updateElement(this._connector.id,{target:B})}onContainerDragEnd(){assertExists(this._connector),this._edgeless.connector.clear(),this._page.captureSync(),this._edgeless.tools.switchToDefaultMode({elements:[this._connector.id],editing:!1}),this._connector=null}onContainerMouseMove(_){const{connector:y,surface:w}=this._edgeless,{viewport:$}=w,B=$.toModelCoord(_.x,_.y);y.searchConnection(B)}onContainerMouseOut(){}onPressShiftKey(_){}beforeModeSwitch(){}afterModeSwitch(){this._edgeless.connector.clear()}}class EraserOverlay extends Overlay{constructor(){super(...arguments),this.d=""}render(_){_.globalAlpha=.33;const y=new Path2D(this.d);_.fillStyle="#aaa",_.fill(y)}}class EraserToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"eraser"},this._overlay=new EraserOverlay,this._timestamp=0,this._timer=0,this._eraserPoints=[],this._prevPoint=[],this._prevEraserPoint=[],this._erasables=new Set,this._eraseTargets=new Set,this._loop=()=>{const _=Date.now(),y=_-this._timestamp;let w=!1;if(this._prevEraserPoint!==this._prevPoint&&(w=!0,this._eraserPoints.push(this._prevPoint),this._prevEraserPoint=this._prevPoint),y>32&&this._eraserPoints.length>1&&(w=!0,this._eraserPoints.splice(0,Math.ceil(this._eraserPoints.length*.1)),this._timestamp=_),w){const $=this._surface.viewport.zoom,B=getSvgPathFromStroke(getStroke(this._eraserPoints,{size:16/$,start:{taper:!0}}));this._overlay.d=B,this._edgeless.surface.refresh()}this._timer=requestAnimationFrame(this._loop)}}onContainerPointerDown(){}toModelCoord(_){return this._surface.viewport.toModelCoord(_.x,_.y)}onContainerDragStart(_){this._page.captureSync();const{point:y}=_,[w,$]=this.toModelCoord(y);this._eraserPoints=[[w,$]],this._prevPoint=[w,$],this._erasables=new Set([...this._surface.getElements(),...this._page.getBlockByFlavour("affine:note")]),this._loop(),this._edgeless.surface.viewport.addOverlay(this._overlay)}onContainerDragMove(_){const y=this.toModelCoord(_.point),w=this._surface;this._erasables.forEach($=>{if(!this._eraseTargets.has($))if(isTopLevelBlock($)){const B=Bound.deserialize($.xywh);if(linePolygonIntersects(this._prevPoint,y,B.points)){this._eraseTargets.add($);const R=getBlockElementById($.id);R&&(R.style.opacity="0.3")}}else $.intersectWithLine(this._prevPoint,y)&&(this._eraseTargets.add($),w.updateElementLocalRecord($.id,{opacity:.3}))}),this._prevPoint=y}beforeModeSwitch(){this._eraseTargets.forEach(_=>{if(isTopLevelBlock(_)){const y=getBlockElementById(_.id);y&&(y.style.opacity="1")}else this._surface.updateElementLocalRecord(_.id,{opacity:1})}),this._reset()}_reset(){cancelAnimationFrame(this._timer),this._edgeless.surface.viewport.removeOverlay(this._overlay),this._erasables.clear(),this._eraseTargets.clear()}onContainerDragEnd(){deleteElements(this._edgeless,Array.from(this._eraseTargets)),this._reset(),this._page.captureSync()}onContainerClick(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerMouseMove(){}onContainerMouseOut(){}onContainerContextMenu(){}onPressShiftKey(_){}afterModeSwitch(_){}}class PresentToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"frameNavigator"}}onContainerPointerDown(){}onContainerDragStart(){}onContainerDragMove(){}onContainerDragEnd(){}onContainerClick(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerMouseMove(){}onContainerMouseOut(){}onContainerContextMenu(){}onPressShiftKey(){}beforeModeSwitch(){}afterModeSwitch(){}}class FrameToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"frame"},this._startPoint=null,this._frameElement=null}_toModelCoord(_){return this._surface.viewport.toModelCoord(_.x,_.y)}onContainerPointerDown(){}onContainerDragStart(_){this._page.captureSync();const{point:y}=_;this._startPoint=this._toModelCoord(y)}onContainerDragMove(_){const y=this._edgeless,w=this._toModelCoord(_.point),$=this._surface;if(assertExists(this._startPoint),!(Vec.dist(this._startPoint,w)<8&&!this._frameElement)){if(!this._frameElement){const B=y.frame.frames,R=y.surface.addElement("frame",{title:new YText(`Frame ${B.length+1}`),batch:"a0",xywh:Bound.fromPoints([this._startPoint,w]).serialize()});this._frameElement=$.pickById(R);return}assertExists(this._frameElement),$.updateElement(this._frameElement.id,{xywh:Bound.fromPoints([this._startPoint,w]).serialize()})}}onContainerDragEnd(){this._frameElement&&(this._edgeless.tools.setEdgelessTool({type:"default"}),this._edgeless.selectionManager.setSelection({elements:[this._frameElement.id],editing:!1}),this._page.captureSync()),this._frameElement=null,this._startPoint=null}onContainerClick(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerMouseMove(){}onContainerMouseOut(){}onContainerContextMenu(){}onPressShiftKey(){}beforeModeSwitch(){}afterModeSwitch(){}}function addNote(k,_,y,w=DEFAULT_NOTE_WIDTH,$){const B=k.addNoteWithPoint(new Point(y.point.x,y.point.y),{width:w});_.addBlock($.childFlavour,{type:$.childType},B),k.slots.edgelessToolUpdated.emit({type:"default"}),requestAnimationFrame(()=>{const H=(_.root?.children.filter(j=>j.flavour==="affine:note")??[]).find(j=>j.id===B);H&&(k.selectionManager.setSelection({elements:[H.id],editing:!0}),k.updateComplete.then(()=>{handleNativeRangeAtPoint(y.raw.clientX,y.raw.clientY),requestAnimationFrame(()=>{k.selectionManager.slots.updated.once(({editing:j})=>{const q=_.getBlockById(B);assertExists(q),!j&&isEmpty(q)&&_.deleteBlock(H)})})}))})}const drawRectangle=(k,_,y)=>{k.rect(_+SHAPE_OVERLAY_OFFSET_X,y+SHAPE_OVERLAY_OFFSET_Y,SHAPE_OVERLAY_WIDTH,SHAPE_OVERLAY_HEIGHT)},drawTriangle=(k,_,y)=>{k.moveTo(_+SHAPE_OVERLAY_WIDTH/2,y),k.lineTo(_,y+SHAPE_OVERLAY_HEIGHT),k.lineTo(_+SHAPE_OVERLAY_WIDTH,y+SHAPE_OVERLAY_HEIGHT)},drawDiamond=(k,_,y)=>{k.lineTo(_+SHAPE_OVERLAY_WIDTH/2,y),k.lineTo(_+SHAPE_OVERLAY_WIDTH,y+SHAPE_OVERLAY_HEIGHT/2),k.lineTo(_+SHAPE_OVERLAY_WIDTH/2,y+SHAPE_OVERLAY_HEIGHT),k.lineTo(_,y+SHAPE_OVERLAY_HEIGHT/2)},drawEllipse=(k,_,y)=>{k.ellipse(_+SHAPE_OVERLAY_WIDTH/2,y+SHAPE_OVERLAY_HEIGHT/2,SHAPE_OVERLAY_WIDTH/2,SHAPE_OVERLAY_HEIGHT/2,0,0,2*Math.PI)},drawRoundedRect=(k,_,y)=>{const w=SHAPE_OVERLAY_WIDTH+40,$=SHAPE_OVERLAY_HEIGHT,B=.1,R=Math.min(w*B,$*B);k.moveTo(_+R,y),k.arcTo(_+w,y,_+w,y+$,R),k.arcTo(_+w,y+$,_,y+$,R),k.arcTo(_,y+$,_,y,R),k.arcTo(_,y,_+w,y,R)},drawGeneralShape=(k,_,y,w,$)=>{switch(k.strokeStyle=$.stroke??"",k.lineWidth=$.strokeWidth??2,k.fillStyle=$.fill??"#FFFFFF00",k.beginPath(),_){case"rect":drawRectangle(k,y,w);break;case"triangle":drawTriangle(k,y,w);break;case"diamond":drawDiamond(k,y,w);break;case"ellipse":drawEllipse(k,y,w);break;case"roundedRect":drawRoundedRect(k,y,w);break;default:throw new Error(`Unknown shape type: ${_}`)}k.closePath(),k.fill(),k.stroke()};class Shape{constructor(_,y,w,$,B){this.x=_,this.y=y,this.type="rect",this.options=$,this.shapeStyle=B}}class RectShape extends Shape{draw(_,y){this.shapeStyle===ShapeStyle.Scribbled?y.rectangle(this.x+SHAPE_OVERLAY_OFFSET_X,this.y+SHAPE_OVERLAY_OFFSET_Y,SHAPE_OVERLAY_WIDTH,SHAPE_OVERLAY_HEIGHT,this.options):drawGeneralShape(_,"rect",this.x,this.y,this.options)}}class TriangleShape extends Shape{draw(_,y){this.shapeStyle===ShapeStyle.Scribbled?y.polygon([[this.x+SHAPE_OVERLAY_WIDTH/2,this.y],[this.x,this.y+SHAPE_OVERLAY_HEIGHT],[this.x+SHAPE_OVERLAY_WIDTH,this.y+SHAPE_OVERLAY_HEIGHT]],this.options):drawGeneralShape(_,"triangle",this.x,this.y,this.options)}}class DiamondShape extends Shape{draw(_,y){this.shapeStyle===ShapeStyle.Scribbled?y.polygon([[this.x+SHAPE_OVERLAY_WIDTH/2,this.y],[this.x+SHAPE_OVERLAY_WIDTH,this.y+SHAPE_OVERLAY_HEIGHT/2],[this.x+SHAPE_OVERLAY_WIDTH/2,this.y+SHAPE_OVERLAY_HEIGHT],[this.x,this.y+SHAPE_OVERLAY_HEIGHT/2]],this.options):drawGeneralShape(_,"diamond",this.x,this.y,this.options)}}class EllipseShape extends Shape{draw(_,y){this.shapeStyle===ShapeStyle.Scribbled?y.ellipse(this.x+SHAPE_OVERLAY_WIDTH/2,this.y+SHAPE_OVERLAY_HEIGHT/2,SHAPE_OVERLAY_WIDTH,SHAPE_OVERLAY_HEIGHT,this.options):drawGeneralShape(_,"ellipse",this.x,this.y,this.options)}}class RoundedRectShape extends Shape{draw(_,y){if(this.shapeStyle===ShapeStyle.Scribbled){const $=Math.min(SHAPE_OVERLAY_WIDTH*.1,SHAPE_OVERLAY_HEIGHT*.1),B=this.x+$,R=this.x+SHAPE_OVERLAY_WIDTH+40-$,H=this.y+$,j=this.y+SHAPE_OVERLAY_HEIGHT-$,q=`
          M${B},${this.y} L${R},${this.y} 
          A${$},${$} 0 0 1 ${R},${H} 
          L${R},${j} 
          A${$},${$} 0 0 1 ${R-$},${j} 
          L${B+$},${j} 
          A${$},${$} 0 0 1 ${B},${j-$} 
          L${B},${H} 
          A${$},${$} 0 0 1 ${B+$},${this.y}
        `;y.path(q,this.options)}else drawGeneralShape(_,"roundedRect",this.x,this.y,this.options)}}class ShapeFactory{static createShape(_,y,w,$,B){switch(w){case"rect":return new RectShape(_,y,w,$,B);case"triangle":return new TriangleShape(_,y,w,$,B);case"diamond":return new DiamondShape(_,y,w,$,B);case"ellipse":return new EllipseShape(_,y,w,$,B);case"roundedRect":return new RoundedRectShape(_,y,w,$,B);default:throw new Error(`Unknown shape type: ${w}`)}}}class ToolOverlay extends Overlay{constructor(_){super(),this.x=0,this.y=0,this.globalAlpha=0,this.edgeless=_,this.disposables=new DisposableGroup,this.disposables.add(this.edgeless.slots.viewportUpdated.on(()=>{const y=this.edgeless.tools.lastMousePos.x,w=this.edgeless.tools.lastMousePos.y,[$,B]=this.edgeless.surface.toModelCoord(y,w);this.x=$,this.y=B}))}dispose(){this.disposables.dispose()}render(_,y){}}class ShapeOverlay extends ToolOverlay{constructor(_,y,w,$){super(_),this.shape=ShapeFactory.createShape(this.x,this.y,y,w,$),this.disposables.add(this.edgeless.slots.edgelessToolUpdated.on(B=>{if(B.type!=="shape")return;const R=B.shape,H=B.shapeStyle,j=getComputedStyle(_),q=j.getPropertyValue(B.strokeColor),X=j.getPropertyValue(B.fillColor),ee={...w,stroke:q,fill:X};this.shape=ShapeFactory.createShape(this.x,this.y,R,ee,H),this.edgeless.surface.refresh()}))}render(_,y){_.globalAlpha=this.globalAlpha,this.shape.x=this.x,this.shape.y=this.y,this.shape.draw(_,y)}}class NoteOverlay extends ToolOverlay{_getOverlayText(_){return _[0].toUpperCase()+_.slice(1)}constructor(_){super(_),this.text="",this.themeMode="light",this.globalAlpha=0,this.disposables.add(this.edgeless.slots.edgelessToolUpdated.on(y=>{y.type==="note"&&(this.text=this._getOverlayText(y.tip),this.edgeless.surface.refresh())}))}render(_){_.globalAlpha=this.globalAlpha;const y=this.x+NOTE_OVERLAY_OFFSET_X,w=this.y+NOTE_OVERLAY_OFFSET_Y,$=getComputedStyle(this.edgeless);_.strokeStyle=$.getPropertyValue(NOTE_OVERLAY_STOKE_COLOR),_.fillStyle=this.themeMode==="light"?NOTE_OVERLAY_LIGHT_BACKGROUND_COLOR:NOTE_OVERLAY_DARK_BACKGROUND_COLOR,_.lineWidth=4,_.beginPath(),_.moveTo(y+NOTE_OVERLAY_CORNER_RADIUS,w),_.lineTo(y+NOTE_OVERLAY_WIDTH-NOTE_OVERLAY_CORNER_RADIUS,w),_.quadraticCurveTo(y+NOTE_OVERLAY_WIDTH,w,y+NOTE_OVERLAY_WIDTH,w+NOTE_OVERLAY_CORNER_RADIUS),_.lineTo(y+NOTE_OVERLAY_WIDTH,w+NOTE_OVERLAY_HEIGHT-NOTE_OVERLAY_CORNER_RADIUS),_.quadraticCurveTo(y+NOTE_OVERLAY_WIDTH,w+NOTE_OVERLAY_HEIGHT,y+NOTE_OVERLAY_WIDTH-NOTE_OVERLAY_CORNER_RADIUS,w+NOTE_OVERLAY_HEIGHT),_.lineTo(y+NOTE_OVERLAY_CORNER_RADIUS,w+NOTE_OVERLAY_HEIGHT),_.quadraticCurveTo(y,w+NOTE_OVERLAY_HEIGHT,y,w+NOTE_OVERLAY_HEIGHT-NOTE_OVERLAY_CORNER_RADIUS),_.lineTo(y,w+NOTE_OVERLAY_CORNER_RADIUS),_.quadraticCurveTo(y,w,y+NOTE_OVERLAY_CORNER_RADIUS,w),_.closePath(),_.stroke(),_.fill(),_.fillStyle=$.getPropertyValue(NOTE_OVERLAY_TEXT_COLOR);let B=16;for(_.font=`${B}px Arial`,_.textAlign="left",_.textBaseline="middle";_.measureText(this.text).width>NOTE_OVERLAY_WIDTH-20;)B-=1,_.font=`${B}px Arial`;_.fillText(this.text,y+10,w+NOTE_OVERLAY_HEIGHT/2)}}class NoteToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"note",background:"--affine-background-secondary-color",childFlavour:"affine:paragraph",childType:"text",tip:"Text"},this._dragStartEvent=null,this._noteOverlay=null}_addNote(_,y=DEFAULT_NOTE_WIDTH,w){addNote(this._edgeless,this._page,_,y,w)}onContainerPointerDown(){}onContainerClick(_){this._clearOverlay();const{childFlavour:y,childType:w}=this.tool,$={childFlavour:y,childType:w};this._addNote(_,DEFAULT_NOTE_WIDTH,$)}onContainerContextMenu(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerDragStart(_){this._clearOverlay(),this._dragStartEvent=_,this._draggingArea={start:new DOMPoint(_.x,_.y),end:new DOMPoint(_.x,_.y)}}onContainerDragMove(_){this._draggingArea&&(this._draggingArea.end=new DOMPoint(_.x,_.y),this._edgeless.slots.hoverUpdated.emit())}onContainerDragEnd(_){const{childFlavour:y,childType:w}=this.tool,$={childFlavour:y,childType:w};if(this._dragStartEvent){const B=_.x>this._dragStartEvent.x?this._dragStartEvent:_,R=Math.max(Math.abs(_.x-this._dragStartEvent.x),DEFAULT_NOTE_WIDTH);this._addNote(B,R,$)}this._dragStartEvent=null,this._draggingArea=null}_updateOverlayPosition(_,y){this._noteOverlay&&(this._noteOverlay.x=_,this._noteOverlay.y=y,this._edgeless.surface.refresh())}_clearOverlay(){this._noteOverlay&&(this._noteOverlay.dispose(),this._edgeless.surface.viewport.removeOverlay(this._noteOverlay),this._noteOverlay=null,this._edgeless.surface.refresh())}_hideOverlay(){this._noteOverlay&&(this._noteOverlay.globalAlpha=0,this._edgeless.surface.refresh())}onContainerMouseMove(_){if(!this._noteOverlay)return;this._noteOverlay.globalAlpha===0&&(this._noteOverlay.globalAlpha=1);const[y,w]=this._surface.viewport.toModelCoord(_.x,_.y);this._updateOverlayPosition(y,w)}onContainerMouseOut(_){_.raw.relatedTarget&&hasClassNameInList(_.raw.relatedTarget,EXCLUDING_MOUSE_OUT_CLASS_LIST)||this._hideOverlay()}onPressShiftKey(_){}beforeModeSwitch(){this._clearOverlay()}afterModeSwitch(_){_.type==="note"&&(this._noteOverlay=new NoteOverlay(this._edgeless),this._noteOverlay.text=_.tip,this._noteOverlay.themeMode=queryCurrentMode(),this._edgeless.surface.viewport.addOverlay(this._noteOverlay))}}class PanToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"pan"},this._lastPoint=null}onContainerClick(){}onContainerContextMenu(){}onContainerPointerDown(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerDragStart(_){this._page.awarenessStore.getFlag("enable_surface")&&(this._lastPoint=[_.x,_.y],this._edgeless.slots.edgelessToolUpdated.emit({type:"pan",panning:!0}))}onContainerDragMove(_){if(!this._page.awarenessStore.getFlag("enable_surface")||!this._lastPoint)return;const{viewport:y}=this._edgeless.surface,{zoom:w}=y,[$,B]=this._lastPoint,R=$-_.x,H=B-_.y;this._lastPoint=[_.x,_.y],y.applyDeltaCenter(R/w,H/w)}onContainerDragEnd(){this._lastPoint=null,this._edgeless.slots.edgelessToolUpdated.emit({type:"pan",panning:!1})}onContainerMouseMove(){}onContainerMouseOut(){}onPressShiftKey(_){}beforeModeSwitch(){}afterModeSwitch(){}}class ShapeToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"shape",shape:"rect",fillColor:DEFAULT_SHAPE_FILL_COLOR,strokeColor:DEFAULT_SHAPE_STROKE_COLOR,shapeStyle:ShapeStyle.Scribbled},this._draggingElementId=null,this._shapeOverlay=null,this._draggingArea=null}_addNewShape(_,y,w){const{viewport:$}=this._edgeless.surface,[B,R]=$.toModelCoord(_.point.x,_.point.y),H=new Bound(B,R,y,w),{shape:j,fillColor:q,strokeColor:X,shapeStyle:ee}=this.tool,te=j==="roundedRect"?"rect":j;return this._surface.addElement("shape",{shapeType:te,xywh:H.serialize(),strokeColor:X,fillColor:q,filled:!isTransparent(q),radius:j==="roundedRect"?.1:0,strokeWidth:4,strokeStyle:StrokeStyle.Solid,shapeStyle:ee})}onContainerClick(_){if(!this._page.awarenessStore.getFlag("enable_surface"))return;this._clearOverlay(),this._page.captureSync();let y=SHAPE_OVERLAY_WIDTH;this.tool.shape==="roundedRect"&&(y+=40);const w=this._addNewShape(_,y,SHAPE_OVERLAY_HEIGHT),$=this._surface.pickById(w);assertExists($),this._edgeless.tools.switchToDefaultMode({elements:[$.id],editing:!1})}onContainerContextMenu(){}onContainerPointerDown(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerDragStart(_){if(!this._page.awarenessStore.getFlag("enable_surface"))return;this._clearOverlay(),this._page.captureSync();const y=this._addNewShape(_,0,0);this._draggingElementId=y,this._draggingArea={start:new DOMPoint(_.x,_.y),end:new DOMPoint(_.x,_.y)}}onContainerDragMove(_){this._page.awarenessStore.getFlag("enable_surface")&&(assertExists(this._draggingElementId),assertExists(this._draggingArea),this._draggingArea.end=new DOMPoint(_.x,_.y),this._resize(_.keys.shift||this._edgeless.tools.shiftKey))}onContainerDragEnd(){const _=this._draggingElementId;assertExists(_),this._draggingElementId=null,this._draggingArea=null,this._page.captureSync();const y=this._surface.pickById(_);assertExists(y),this._edgeless.tools.switchToDefaultMode({elements:[y.id],editing:!1})}onPressShiftKey(_){this._draggingElementId&&this._resize(_)}_resize(_=!1){const{_draggingElementId:y,_draggingArea:w,_edgeless:$}=this;assertExists(y),assertExists(w);const{surface:B}=$,{viewport:R}=B,{zoom:H}=R,{start:{x:j,y:q},end:X}=w;let{x:ee,y:te}=X;if(_){const se=Math.abs(ee-j),le=Math.abs(te-q),ue=Math.max(se,le);ee=j+(ee>j?ue:-ue),te=q+(te>q?ue:-ue)}const[ne,oe]=R.toModelCoord(Math.min(j,ee),Math.min(q,te)),ie=Math.abs(j-ee)/H,ae=Math.abs(q-te)/H,re=new Bound(ne,oe,ie,ae);B.setElementBound(y,re)}_updateOverlayPosition(_,y){this._shapeOverlay&&(this._shapeOverlay.x=_,this._shapeOverlay.y=y,this._edgeless.surface.refresh())}_clearOverlay(){this._shapeOverlay&&(this._shapeOverlay.dispose(),this._edgeless.surface.viewport.removeOverlay(this._shapeOverlay),this._shapeOverlay=null,this._edgeless.surface.refresh())}_hideOverlay(){this._shapeOverlay&&(this._shapeOverlay.globalAlpha=0,this._edgeless.surface.refresh())}onContainerMouseMove(_){if(!this._shapeOverlay)return;this._shapeOverlay.globalAlpha===0&&(this._shapeOverlay.globalAlpha=1);const[y,w]=this._surface.viewport.toModelCoord(_.x,_.y);this._updateOverlayPosition(y,w)}onContainerMouseOut(_){_.raw.relatedTarget&&hasClassNameInList(_.raw.relatedTarget,EXCLUDING_MOUSE_OUT_CLASS_LIST)||this._hideOverlay()}beforeModeSwitch(){this._clearOverlay()}afterModeSwitch(_){if(_.type!=="shape")return;const y=SHAPE_OVERLAY_OPTIONS,w=getComputedStyle(this._edgeless);y.stroke=w.getPropertyValue(_.strokeColor),y.fill=w.getPropertyValue(_.fillColor),this._shapeOverlay=new ShapeOverlay(this._edgeless,_.shape,y,_.shapeStyle),this._edgeless.surface.viewport.addOverlay(this._shapeOverlay)}}class TextToolController extends EdgelessToolController{constructor(){super(...arguments),this.tool={type:"text"}}onContainerClick(_){addText(this._edgeless,_)}onContainerContextMenu(){}onContainerPointerDown(){}onContainerDblClick(){}onContainerTripleClick(){}onContainerDragStart(){}onContainerDragMove(){}onContainerDragEnd(){}onContainerMouseMove(){}onContainerMouseOut(){}onPressShiftKey(_){}beforeModeSwitch(){}afterModeSwitch(){}}function shouldFilterMouseEvent(k){const _=k.target;return!_||!(_ instanceof HTMLElement)?!1:_.tagName==="INPUT"||_.tagName==="FORMAT-QUICK-BAR"||_.tagName==="AFFINE-DRAG-HANDLE"||_.tagName==="EDGELESS-TOOLBAR"||_.tagName==="EDGELESS-ZOOM-TOOLBAR"||_.tagName==="ZOOM-BAR-TOGGLE-BUTTON"}class EdgelessToolsManager{get selection(){return this.container.selectionManager}get surface(){return this.container.surface}get lastMousePos(){return this._lastMousePos}get edgelessTool(){return this._edgelessTool}set edgelessTool(_){this._edgelessTool=_,this._controllers[this._edgelessTool.type].tool=this._edgelessTool}get currentController(){return this._controllers[this.edgelessTool.type]}get draggingArea(){if(!this.currentController.draggingArea)return null;const{start:_,end:y}=this.currentController.draggingArea,w=Math.min(_.x,y.x),$=Math.min(_.y,y.y),B=Math.max(_.x,y.x),R=Math.max(_.y,y.y);return new DOMRect(w,$,B-w,R-$)}get shiftKey(){return this._shiftKey}set shiftKey(_){this._shiftKey=_,this.currentController.onPressShiftKey(_)}get page(){return this.container.page}constructor(_,y){this.container=_,this.dispatcher=y,this._edgelessTool={type:"default"},this._lastMousePos={x:0,y:0},this._rightClickTimer=null,this._shiftKey=!1,this._disposables=new DisposableGroup,this._add=(w,$)=>{this._disposables.add(this.dispatcher.add(w,$))},this._onContainerDragStart=w=>{if(!(this.page.readonly&&this.edgelessTool.type!=="pan")&&!(w.button===2&&this.edgelessTool.type!=="pan"))return this.currentController.onContainerDragStart(w)},this._onContainerDragMove=w=>{if(!(this.page.readonly&&this.edgelessTool.type!=="pan")&&!(w.button===2&&this.edgelessTool.type!=="pan"))return this.currentController.onContainerDragMove(w)},this._onContainerDragEnd=w=>{if(!(this.page.readonly&&this.edgelessTool.type!=="pan")&&!(w.button===2&&this.edgelessTool.type!=="pan"))return this.currentController.onContainerDragEnd(w)},this._onContainerClick=w=>this.currentController.onContainerClick(w),this._onContainerDblClick=w=>this.currentController.onContainerDblClick(w),this._onContainerTripleClick=w=>this.currentController.onContainerTripleClick(w),this._onContainerPointerMove=w=>(this._updateLastMousePos(w),this.container.slots.hoverUpdated.emit(),this._controllers[this.edgelessTool.type].onContainerMouseMove(w)),this._onContainerPointerOut=w=>this._controllers[this.edgelessTool.type].onContainerMouseOut(w),this._onContainerContextMenu=w=>{w.event.preventDefault();const $=new PointerEventState({event:w.event,rect:this.dispatcher.root.getBoundingClientRect(),startX:0,startY:0,last:null}),B=this.edgelessTool;B.type!=="pan"&&!this._rightClickTimer&&(this._rightClickTimer={edgelessTool:B,timeStamp:w.event.timeStamp,timer:window.setTimeout(()=>{this._controllers.pan.onContainerDragStart($)},233)})},this._onContainerPointerDown=w=>{if(!isMiddleButtonPressed(w.raw))return this.page.readonly?void 0:this.currentController.onContainerPointerDown(w);const $=this._edgelessTool,B=R=>{isMiddleButtonPressed(R)||(this.setEdgelessTool($),document.removeEventListener("pointerup",B,!1),document.removeEventListener("pointerover",B,!1))};this.dispatcher.disposables.addFromEvent(document,"pointerover",B),this.dispatcher.disposables.addFromEvent(document,"pointerup",B),this.setEdgelessTool({type:"pan",panning:!0})},this._onContainerPointerUp=w=>{if(w.button===2&&this._rightClickTimer){const{timer:$,timeStamp:B,edgelessTool:R}=this._rightClickTimer;w.raw.timeStamp-B>233?this.container.slots.edgelessToolUpdated.emit(R):clearTimeout($),this._rightClickTimer=null}},this.setEdgelessTool=(w,$={blockId:"",elements:[],editing:!1})=>{if(this.edgelessTool===w)return;const B=this.edgelessTool.type;this._controllers[B].beforeModeSwitch(w),this._controllers[w.type].beforeModeSwitch(w),w.type==="default"&&!$.elements.length&&this.selection.lastState&&($=this.selection.lastState),this.container.slots.edgelessToolUpdated.emit(w),this.selection.setSelection($),this._controllers[B].afterModeSwitch(w),this._controllers[w.type].afterModeSwitch(w)},this._controllers={default:new DefaultToolController(this.container),text:new TextToolController(this.container),shape:new ShapeToolController(this.container),brush:new BrushToolController(this.container),pan:new PanToolController(this.container),note:new NoteToolController(this.container),connector:new ConnectorToolController(this.container),eraser:new EraserToolController(this.container),frame:new FrameToolController(this.container),frameNavigator:new PresentToolController(this.container)},this._initMouseAndWheelEvents()}_updateLastMousePos(_){this._lastMousePos={x:_.x,y:_.y}}async _initMouseAndWheelEvents(){this.container.surface||await new Promise(_=>requestAnimationFrame(_)),this._add("dragStart",_=>{const y=_.get("pointerState");shouldFilterMouseEvent(y.raw)||(!isInsidePageTitle(y.raw.target)&&!isDatabaseInput(y.raw.target)&&!isInsideEdgelessTextEditor(y.raw.target)&&y.raw.preventDefault(),this._onContainerDragStart(y))}),this._add("dragMove",_=>{const y=_.get("pointerState");shouldFilterMouseEvent(y.raw)||(!isInsidePageTitle(y.raw.target)&&!isDatabaseInput(y.raw.target)&&!isInsideEdgelessTextEditor(y.raw.target)&&y.raw.preventDefault(),this._onContainerDragMove(y))}),this._add("dragEnd",_=>{const y=_.get("pointerState");!isInsidePageTitle(y.raw.target)&&!isDatabaseInput(y.raw.target)&&!isInsideEdgelessTextEditor(y.raw.target)&&y.raw.preventDefault(),this._onContainerDragEnd(y)}),this._add("click",_=>{const y=_.get("pointerState");!isInsidePageTitle(y.raw.target)&&!isDatabaseInput(y.raw.target)&&!isInsideEdgelessTextEditor(y.raw.target)&&y.raw.preventDefault(),this._onContainerClick(y)}),this._add("doubleClick",_=>{const y=_.get("pointerState");shouldFilterMouseEvent(y.raw)||this._onContainerDblClick(y)}),this._add("tripleClick",_=>{const y=_.get("pointerState");shouldFilterMouseEvent(y.raw)||this._onContainerTripleClick(y)}),this._add("pointerMove",_=>{const y=_.get("pointerState");shouldFilterMouseEvent(y.raw)||(!isInsidePageTitle(y.raw.target)&&!isDatabaseInput(y.raw.target)&&!isInsideEdgelessTextEditor(y.raw.target)&&y.raw.preventDefault(),this._onContainerPointerMove(y))}),this._add("pointerDown",_=>{const y=_.get("pointerState");this._onContainerPointerDown(y)}),this._add("pointerUp",_=>{const y=_.get("pointerState");this._onContainerPointerUp(y)}),this._add("pointerOut",_=>{const y=_.get("pointerState");this._onContainerPointerOut(y)}),this._add("contextMenu",_=>{const y=_.get("defaultState");this._onContainerContextMenu(y)}),this._add("wheel",_=>{const w=_.get("defaultState").event;if(!(w instanceof WheelEvent))return;w.preventDefault();const $=this.container,{viewport:B}=$.surface;if(isPinchEvent(w)){const R=$.getBoundingClientRect(),[H,j]=$.surface.toModelCoord(w.clientX-R.x,w.clientY-R.y),q=normalizeWheelDeltaY(w.deltaY,B.zoom);B.setZoom(q,new Point(H,j))}else{const R=w.deltaX/B.zoom,H=w.deltaY/B.zoom;B.applyDeltaCenter(R,H)}})}getHoverState(){if(!this.currentController.enableHover)return null;const{surface:_}=this.container,y=(this.page.root?.children??[]).filter(q=>q.flavour==="affine:note"),{x:w,y:$}=this._lastMousePos,[B,R]=_.toModelCoord(w,$),H=_.pickTop(B,R)||pickTopBlock(y,B,R);if(!H||this.selection?.editing)return null;const j=getXYWH(H);return{rect:getSelectionBoxBound(_.viewport,j),content:H}}switchToDefaultMode(_){this.setEdgelessTool({type:"default"},_)}clear(){}dispose(){this._disposables.dispose()}}const MIN_FRAME_WIDTH=800,MIN_FRAME_HEIGHT=640,FRAME_PADDING=40;class FrameOverlay extends Overlay{constructor(){super(...arguments),this.bound=null}render(_,y){if(!this.bound)return;const{x:w,y:$,w:B,h:R}=this.bound;_.beginPath(),_.fillStyle="#3AB5F70A",_.roundRect(w,$,B,R,8),_.fill()}}class EdgelessFrameManager{constructor(_){this._edgeless=_,this._frameOverlay=new FrameOverlay,this._edgeless.surface.viewport.addOverlay(this._frameOverlay)}get frames(){return this._edgeless.surface.getElementsByType("frame")}selectFrame(_){const y=this._edgeless.frame.frames;if(!_.some(w=>w instanceof FrameElement)&&y.length!==0){const w=edgelessElementsBound(_);for(let $=y.length-1;$>=0;$--){const B=y[$];if(Bound.deserialize(B.xywh).contains(w))return B}}return null}setHighlight(_){const y=Bound.deserialize(_.xywh);this._frameOverlay.bound=y,this._edgeless.surface.refresh()}clearHighlight(){this._frameOverlay.bound=null}getElementsInFrame(_){const y=Bound.deserialize(_.xywh),w=this._edgeless.surface.viewport.gridManager.search(y,!0).filter($=>!($ instanceof FrameElement));return w.push(...this._edgeless.page.getBlockByFlavour("affine:note").filter($=>y.contains(Bound.deserialize($.xywh)))),w}calculateFrameColor(_){const y=this.getElementsInFrame(_);let w="";y.forEach($=>{isTopLevelBlock($)?(w||(w=NoteColor),w===SurfaceColor&&(w=BlendColor)):(w||(w=SurfaceColor),w==NoteColor&&(w=BlendColor))}),w=w||NoteColor,_.color=w,this._edgeless.surface.refresh()}createFrameOnSelected(){const{_edgeless:_}=this,{surface:y}=_,w=this.frames;let $=edgelessElementsBound(_.selectionManager.elements);if($=$.expand(FRAME_PADDING),$.w<MIN_FRAME_WIDTH){const H=(MIN_FRAME_WIDTH-$.w)/2;$=$.expand(H,0)}if($.h<MIN_FRAME_HEIGHT){const H=(MIN_FRAME_HEIGHT-$.h)/2;$=$.expand(0,H)}const B=_.surface.addElement("frame",{title:new YText(`Frame ${w.length+1}`),batch:"a0",xywh:$.serialize()});_.page.captureSync();const R=y.pickById(B);assertExists(R),_.selectionManager.setSelection({elements:[R.id],editing:!1})}}class EdgelessSelectionManager{get empty(){return this.state.isEmpty()}get editing(){return this.state.editing}get elements(){return this.state.elements.reduce((_,y)=>{const w=this.container.getElementModel(y);return w&&w.id&&_.push(w),_},[])}get _selection(){return this.container.root.selectionManager}_setState(_){this.lastState=this.state,this.state=_,this._selectedElements=new Set(_.elements)}mount(){this.disposable.add(this._selection.slots.changed.on(_=>{const y=_.find(w=>w.type==="surface");this.state.isEmpty()&&(!y||y.isEmpty())||(this._setState(y??SurfaceSelection.fromJSON({elements:[],editing:!1})),this.slots.updated.emit(this.state))})),this.disposable.add(this._selection.slots.remoteChanged.on(_=>{const y={},w=new Set;Object.keys(_).forEach($=>{_[$].forEach(R=>{R.is("surface")&&(y[$]=R,R.elements.forEach(H=>w.add(H)))})}),this.remoteSelection=y,this._remoteSelectedElements=w,this.slots.remoteUpdated.emit()}))}constructor(_){this.disposable=new DisposableGroup,this.slots={updated:new Slot,blocksUpdated:new Slot,remoteUpdated:new Slot},this.lastState=null,this.state=SurfaceSelection.fromJSON({blockId:"",editing:!1,elements:[]}),this.remoteSelection={},this.selectedBlocks=[],this._selectedElements=new Set,this._remoteSelectedElements=new Set,this.container=_,this.mount()}hasRemote(_){return this._remoteSelectedElements.has(_)}has(_){return this._selectedElements.has(_)}setSelection(_){const y=this._selection.getInstance("surface",_.elements,_.editing);this._selection.setGroup("edgeless",[y])}setSelectedBlocks(_){this.selectedBlocks=_,this.slots.blocksUpdated.emit(_)}clear(){this.setSelection({blockId:"",elements:[],editing:!1})}dispose(){this.disposable.dispose()}}class NoteResizeObserver{constructor(){this._cachedElements=new Map,this._lastRects=new Map,this.slots={resize:new Slot},this._onResize=_=>{const y=new Map;_.forEach(w=>{const B=w.target.closest(`[${BLOCK_ID_ATTR}]`)?.getAttribute(BLOCK_ID_ATTR);if(!B)return;const R=this._lastRects.get(B);R&&almostEqual$1(R.x,w.contentRect.x)&&almostEqual$1(R.y,w.contentRect.y)&&almostEqual$1(R.width,w.contentRect.width)&&almostEqual$1(R.height,w.contentRect.height)||(y.set(B,[w.contentRect,R]),this._lastRects.set(B,w.contentRect))}),y.size&&this.slots.resize.emit(y)},this._observer=new ResizeObserver(throttle$1(this._onResize,1e3/60))}resetListener(_){const y=new Set(this._cachedElements.keys());_.root?.children.forEach(w=>{if(!matchFlavours(w,["affine:note"]))return;const $=w.id;y.delete($);const R=getBlockElementByModel(w)?.querySelector(".affine-note-block-container"),H=this._cachedElements.get($);if(H){if(R===H)return;this._observer.unobserve(H),this._cachedElements.delete($)}R&&(this._lastRects.set($,R.getBoundingClientRect()),this._observer.observe(R),this._cachedElements.set($,R))}),y.forEach(w=>{const $=this._cachedElements.get(w);$&&this._observer.unobserve($)})}dispose(){this._observer.disconnect(),this.slots.resize.dispose(),this._cachedElements.clear(),this._lastRects.clear()}}const ALIGN_THRESHOLD=5;class EdgelessSnapManager extends Overlay{constructor(_){super(),this.container=_,this._alignableBounds=[],this._intraGraphicAlignLines=[],this._distributedAlignLines=[]}_getBoundsWithRotationByAlignable(_){const y=isTopLevelBlock(_)?0:_.rotate,[w,$,B,R]=deserializeXYWH(_.xywh);return Bound.from(getBoundsWithRotation({x:w,y:$,w:B,h:R,rotate:y}))}setupAlignables(_){if(_.length===0)return new Bound;const{page:y,surface:w}=this.container,$=this.container.connector.getConnecttedConnectors(_),{viewport:B}=w,R=Bound.from(B.viewportBounds);B.addOverlay(this);const H=y.getBlockByFlavour("affine:note"),j=w.getElements(),q=[..._,...$];return this._alignableBounds=[],[...H,...j].forEach(X=>{const ee=this._getBoundsWithRotationByAlignable(X);R.isIntersectWithBound(ee)&&!q.includes(X)&&this._alignableBounds.push(ee)}),_.reduce((X,ee)=>{const te=this._getBoundsWithRotationByAlignable(ee);return X.unite(te)},Bound.deserialize(_[0].xywh))}cleanupAlignables(){const{viewport:_}=this.container.surface;this._alignableBounds=[],this._intraGraphicAlignLines=[],this._distributedAlignLines=[],_.removeOverlay(this)}align(_){const y={dx:0,dy:0},w=ALIGN_THRESHOLD,{surface:$}=this.container,{viewport:B}=$;this._intraGraphicAlignLines=[],this._distributedAlignLines=[];for(const R of this._alignableBounds){const H=this._calculateClosestDistances(_,R);H.absXDistance<w&&this._updateXAlignPoint(y,_,R,H),H.absYDistance<w&&this._updateYAlignPoint(y,_,R,H)}return y.dx===0&&this._alignDistributeHorizontally(y,_,w,B),y.dy===0&&this._alignDistributeVertically(y,_,w,B),this._draw(),y}_calculateClosestDistances(_,y){const w=y.center[0]-_.center[0],$=y.center[1]-_.center[1],B=y.minX-_.center[0],R=y.maxX-_.center[0],H=y.minY-_.center[1],j=y.maxY-_.center[1],q=y.minX-_.minX,X=y.maxX-_.minX,ee=y.minX-_.maxX,te=y.maxX-_.maxX,ne=y.minY-_.minY,oe=y.maxY-_.minY,ie=y.minY-_.maxY,ae=y.maxY-_.maxY,re=[w,B,R,q,X,ee,te],se=[$,H,j,ne,oe,ie,ae],le=re.map(Math.abs),ue=se.map(Math.abs),he=Math.min(...le),ce=Math.min(...ue),ge=le.indexOf(he),be=ue.indexOf(ce);return{absXDistance:he,absYDistance:ce,xDistance:re[ge],yDistance:se[be],indexX:ge,indexY:be}}_updateXAlignPoint(_,y,w,$){const B=$.indexX;_.dx=$.xDistance;const R=[w.center[0],w.minX,w.maxX,y.minX+_.dx,y.minX+_.dx,y.maxX+_.dx,y.maxX+_.dx][B];this._intraGraphicAlignLines[0]=[new Point(R,y.center[1]),new Point(R,w.center[1])]}_updateYAlignPoint(_,y,w,$){const B=$.indexY;_.dy=$.yDistance;const R=[w.center[1],w.minY,w.maxY,y.minY+_.dy,y.minY+_.dy,y.maxY+_.dy,y.maxY+_.dy][B];this._intraGraphicAlignLines[1]=[new Point(y.center[0],R),new Point(w.center[0],R)]}_alignDistributeHorizontally(_,y,w,$){const B=[];this._alignableBounds.forEach(j=>{j.isHorizontalCross(y)&&B.push(j)});let R=1/0,H=1/0;for(let j=0;j<B.length;j++)for(let q=j+1;q<B.length;q++){let X=B[j],ee=B[q];if(!X.isHorizontalCross(ee)||X.isIntersectWithBound(ee))continue;if(ee.maxX<X.minX){const oe=ee;ee=X,X=oe}let te=0;const ne=()=>{if(R=Math.abs(y.center[0]-te),R<=w&&R<H){H=R,_.dx=te-y.center[0];const oe=[X.minY,X.maxY,ee.minY,ee.maxY].sort((se,le)=>se-le),ie=(oe[1]+oe[2])/2,ae=2/$.zoom,re=[te-y.w/2-ae,te+y.w/2+ae,ee.minX,ee.maxX,X.minX,X.maxX].sort((se,le)=>se-le);this._distributedAlignLines[0]=[new Point(re[1],ie),new Point(re[2],ie)],this._distributedAlignLines[1]=[new Point(re[3],ie),new Point(re[4],ie)]}};X.horizontalDistance(ee)>y.w&&(te=(X.maxX+ee.minX)/2,ne()),te=X.minX-(ee.minX-X.maxX)-y.w/2,ne(),te=ee.minX-X.maxX+ee.maxX+y.w/2,ne()}}_alignDistributeVertically(_,y,w,$){const B=[];this._alignableBounds.forEach(j=>{j.isVerticalCross(y)&&B.push(j)});let R=1/0,H=1/0;for(let j=0;j<B.length;j++)for(let q=j+1;q<B.length;q++){let X=B[j],ee=B[q];if(!X.isVerticalCross(ee)||X.isIntersectWithBound(ee))continue;if(ee.maxY<X.minX){const oe=X;X=ee,ee=oe}let te=0;const ne=()=>{if(R=Math.abs(y.center[1]-te),R<=w&&R<H){H=R,_.dy=te-y.center[1];const oe=[X.minX,X.maxX,ee.minX,ee.maxX].sort((se,le)=>se-le),ie=(oe[1]+oe[2])/2,ae=2/$.zoom,re=[te-y.h/2-ae,te+y.h/2+ae,ee.minY,ee.maxY,X.minY,X.maxY].sort((se,le)=>se-le);this._distributedAlignLines[3]=[new Point(ie,re[1]),new Point(ie,re[2])],this._distributedAlignLines[4]=[new Point(ie,re[3]),new Point(ie,re[4])]}};X.verticalDistance(ee)>y.h&&(te=(X.maxY+ee.minY)/2,ne()),te=X.minY-(ee.minY-X.maxY)-y.h/2,ne(),te=ee.minY-X.maxY+ee.maxY+y.h/2,ne()}}_draw(){const{surface:_}=this.container;_.refresh()}render(_){if(this._intraGraphicAlignLines.length===0&&this._distributedAlignLines.length===0)return;const{viewport:y}=this.container.surface,w=1/y.zoom,$=5/y.zoom;_.strokeStyle="#1672F3",_.lineWidth=w,_.beginPath(),this._intraGraphicAlignLines.forEach(B=>{let R="";if(B[0].x===B[1].x){const H=B[0].x,j=Math.min(B[0].y,B[1].y),q=Math.max(B[0].y,B[1].y);R=`M${H},${j-$}L${H},${q}`}else{const H=B[0].y,j=Math.min(B[0].x,B[1].x),q=Math.max(B[0].x,B[1].x);R=`M${j-$},${H}L${q+$},${H}`}_.stroke(new Path2D(R))}),this._distributedAlignLines.forEach(B=>{const R=10/y.zoom;let H="";if(B[0].x===B[1].x){const j=B[0].x,q=Math.min(B[0].y,B[1].y)+$,X=Math.max(B[0].y,B[1].y)-$;H=`M${j},${q}L${j},${X}
        M${j-R},${q}L${j+R},${q}
        M${j-R},${X}L${j+R},${X} `}else{const j=B[0].y,q=Math.min(B[0].x,B[1].x)+$,X=Math.max(B[0].x,B[1].x)-$;H=`M${q},${j}L${X},${j}
        M${q},${j-R}L${q},${j+R}
        M${X},${j-R}L${X},${j+R}`}_.stroke(new Path2D(H))})}}var __decorate$1z=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let EdgelessPageBlockComponent=class extends BlockElement{constructor(){super(...arguments),this.components={toolbar:null,zoomToolbar:null,zoomBarToggleButton:null},this.keyboardManager=null,this.gesture=null,this.showGrid=!0,this.edgelessTool={type:"default"},this._rectsOfSelectedBlocks=[],this._edgelessLayerWillChange=!1,this.clipboard=new EdgelessClipboard(this.page,this),this.slots={viewportUpdated:new Slot,selectedRectUpdated:new Slot,hoverUpdated:new Slot,edgelessToolUpdated:new Slot,reorderingNotesUpdated:new Slot,reorderingShapesUpdated:new Slot,zoomUpdated:new Slot,pressShiftKeyUpdated:new Slot,cursorUpdated:new Slot,elementSizeUpdated:new Slot,copyAsPng:new Slot,subpageLinked:new Slot,subpageUnlinked:new Slot,pageLinkClicked:new Slot,tagClicked:new Slot,readonlyUpdated:new Slot},this.indexes={max:"a0",min:"a0"},this.getService=getService$1,this._editorContainer=null,this._resizeObserver=null,this._noteResizeObserver=new NoteResizeObserver,this.reorderNotes=({elements:_,type:y})=>{const w=($,B)=>{this.updateIndexes($,B,R=>{const H=R[0];H<this.indexes.min&&(this.indexes.min=H);const j=R[R.length-1];j>this.indexes.max&&(this.indexes.max=j)})};switch(y){case"front":this._reorderTo(_,()=>({start:this.indexes.max,end:null}),w);break;case"forward":this._reorder(_,$=>({start:generateKeyBetween(null,$[0].index),end:null}),()=>this.getSortedElementsWithViewportBounds(_),bringForward,w);break;case"backward":this._reorder(_,$=>({start:null,end:$[$.length-1].index}),()=>this.getSortedElementsWithViewportBounds(_),sendBackward,w);break;case"back":this._reorderTo(_,()=>({start:null,end:this.indexes.min}),w);break}},this.reorderShapes=({elements:_,type:y})=>{const{surface:w}=this,$=w.getBatch(w.defaultBatch),B=(R,H)=>{this.surface.updateIndexes(R,H,j=>{const q=j[0];q<$.min&&($.min=q);const X=j[j.length-1];X>$.max&&($.max=X)})};switch(y){case"front":this._reorderTo(_,()=>({start:$.max,end:null}),B);break;case"forward":this._reorder(_,R=>({start:generateKeyBetween(null,R[0].index),end:null}),()=>this.surface.getSortedElementsWithViewportBounds(),bringForward,B);break;case"backward":this._reorder(_,R=>({start:null,end:R[R.length-1].index}),()=>this.surface.getSortedElementsWithViewportBounds(),sendBackward,B);break;case"back":this._reorderTo(_,()=>({start:null,end:$.min}),B);break}}}get readonly(){return this.page.readonly}get notes(){return this.model.children.filter(_=>_.flavour==="affine:note")}get sortedNotes(){return this.notes.sort(compare$1)}get dispatcher(){return this.service?.uiEventDispatcher}get editorContainer(){return this._editorContainer?this._editorContainer:(this._editorContainer=this.closest("editor-container"),assertExists(this._editorContainer),this._editorContainer)}computeValue(_){const{parentElement:y}=this;if(assertExists(y),isCssVariable(_)){const w=getThemePropertyValue(y,_);return w===void 0&&console.error(new Error(`All variables should have a value. Please check for any dirty data or variable renaming.Variable: ${_}`)),w??_}return _}_initSurface(){const _=this.model.children.find($=>$.flavour==="affine:surface");assertExists(_);const y=_.originProp("elements");this.surface=new SurfaceManager(y,this.computeValue.bind(this),()=>this.readonly);const{surface:w}=this;this._disposables.add(w.slots.elementAdded.on($=>{const B=this.surface.pickById($);if(assertExists(B),B instanceof ConnectorElement){if(!this.connector.hasRelatedElement(B))return;this.connector.updatePath(B)}else B instanceof FrameElement&&this.frame.calculateFrameColor(B)})),this._disposables.add(w.slots.elementUpdated.on(({id:$,props:B})=>{("xywh"in B||"rotate"in B)&&this.slots.elementSizeUpdated.emit($);const R=w.pickById($);assertExists(R),R instanceof ConnectorElement&&("target"in B||"source"in B||"mode"in B)&&this.connector.updatePath(R)})),this._disposables.add(listenToThemeChange(this,()=>{this.surface.refresh()}))}_handleToolbarFlag(){const _=()=>{const y=new EdgelessToolbar(this),w=new EdgelessZoomToolbar(this),$=new ZoomBarToggleButton(this);this.appendChild(y),this.appendChild(w),this.appendChild($),this.components.toolbar=y,this.components.zoomToolbar=w,this.components.zoomBarToggleButton=$};this.page.awarenessStore.getFlag("enable_edgeless_toolbar")&&!this.components.toolbar&&!this.components.zoomToolbar&&!this.components.zoomBarToggleButton&&_(),this._disposables.add(this.page.awarenessStore.slots.update.subscribe(y=>y.state?.flags.enable_edgeless_toolbar,y=>{if(y){if(this.components.toolbar)return;_();return}this.components.toolbar?.remove(),this.components.zoomToolbar?.remove(),this.components.zoomBarToggleButton?.remove(),this.components.toolbar=null,this.components.zoomToolbar=null,this.components.zoomBarToggleButton=null},{filter:y=>y.id===this.page.doc.clientID}))}_initSlotEffects(){const{_disposables:_,slots:y,selectionManager:w,page:$,surface:B}=this;_.add($.slots.yBlockUpdated.on(({id:j,props:q})=>{const X=$.getBlockById(j);X&&X.flavour==="affine:note"&&"prop:xywh"in q&&this.slots.elementSizeUpdated.emit(j)})),_.add(y.elementSizeUpdated.on(j=>{const q=getEdgelessElement(this,j);q&&this.connector.syncConnectorPos([q])})),_.add(B.viewport.slots.viewportUpdated.on(({zoom:j,center:q})=>{this.slots.viewportUpdated.emit({zoom:j,center:q})}));let R=null;_.add(y.viewportUpdated.on(()=>{this._edgelessLayerWillChange||(this._edgelessLayerWillChange=!0,requestAnimationFrame(()=>{this.edgelessLayer&&this.edgelessLayer.style.willChange!=="transform"&&(this.edgelessLayer.style.willChange="transform")})),R&&clearTimeout(R),R=setTimeout(()=>{this._edgelessLayerWillChange=!1,R=null,requestAnimationFrame(()=>{this.edgelessLayer&&this.edgelessLayer.style.removeProperty("will-change")})},150)})),_.add(y.viewportUpdated.on(()=>{const j=this.style.getPropertyValue("--affine-zoom"),q=this.surface.viewport.zoom;(!j||+j!==q)&&this.style.setProperty("--affine-zoom",`${q}`);const{showGrid:X}=this,{zoom:ee,viewportX:te,viewportY:ne}=this.surface.viewport,{grid:oe,gap:ie,translateX:ae,translateY:re}=getBackgroundGrid(te,ne,ee,X);this.pageBlockContainer.style.setProperty("--affine-edgeless-gap",`${ie}px`),this.pageBlockContainer.style.setProperty("--affine-edgeless-grid",oe),this.pageBlockContainer.style.setProperty("--affine-edgeless-x",`${ae}px`),this.pageBlockContainer.style.setProperty("--affine-edgeless-y",`${re}px`),this.selectionManager.selectedBlocks.length&&this.selectionManager.setSelectedBlocks([...this.selectionManager.selectedBlocks]),updateNotesPosition(this,this.notes)})),_.add(w.slots.blocksUpdated.on(j=>{this.selectionManager.selectedBlocks=j,requestAnimationFrame(()=>{this._rectsOfSelectedBlocks=j.map(getRectByBlockElement)})})),_.add(y.edgelessToolUpdated.on(j=>{this.edgelessTool=j,y.cursorUpdated.emit(getCursorMode(j))})),_.add(this.page.slots.historyUpdated.on(()=>{this.requestUpdate()})),_.add(this.tools),_.add(this.selectionManager),_.add(this.surface),_.add(this._noteResizeObserver),_.add(this._noteResizeObserver.slots.resize.on(j=>{const q=this.page;j.forEach(([X,ee],te)=>{const ne=q.getBlockById(te),{index:oe,xywh:ie}=ne,[ae,re,se,le]=deserializeXYWH(ie);oe<this.indexes.min?this.indexes.min=oe:oe>this.indexes.max&&(this.indexes.max=oe);const ue=X.height+EDGELESS_BLOCK_CHILD_PADDING*2+EDGELESS_BLOCK_CHILD_BORDER_WIDTH*2;if(!almostEqual$1(ue,le)){const he=()=>{q.updateBlock(ne,{xywh:JSON.stringify([ae,re,se,Math.round(ue)])})};ee&&!almostEqual$1(X.width,ee.width)?he():q.withoutTransact(he)}}),y.selectedRectUpdated.emit({type:"resize"})})),_.add(y.reorderingNotesUpdated.on(this.reorderNotes)),_.add(y.reorderingShapesUpdated.on(this.reorderShapes)),_.add(y.zoomUpdated.on(j=>this.components.zoomToolbar?.setZoomByAction(j))),_.add(y.pressShiftKeyUpdated.on(j=>{this.tools.shiftKey=j})),_.add(y.cursorUpdated.on(throttle$1(j=>{this.style.cursor=j},144)));let H=!0;_.add(y.copyAsPng.on(({notes:j,shapes:q})=>{H&&(H=!1,this.clipboard.copyAsPng(j,q).then(()=>toast("Copied to clipboard")).catch(()=>toast("Failed to copy as PNG")).finally(()=>{H=!0}))}))}_reorderTo(_,y,w){reorderTo(_,compare$1,y,($,B,R)=>generateNKeysBetween($,B,R),w)}_reorder(_,y,w,$,B){reorder(_,compare$1,w,y,$,(R,H,j)=>generateNKeysBetween(R,H,j),B)}updateIndexes(_,y,w){let $,B=0,R;const H=y.length;for(;B<H;B++)$=_[B],R=y[B],R.index!==$&&this.page.updateBlock(R,{index:$});w(_)}getElementModel(_){return this.page.getBlockById(_)??this.surface.pickById(_)??null}getSortedElementsWithViewportBounds(_){const y=this.surface.viewport.viewportBounds;return this.sortedNotes.filter(w=>_.includes(w)?!0:intersects(y,xywhArrayToObject(w)))}getSortedElementsByBound(_){return this.sortedNotes.filter(y=>intersects(_,xywhArrayToObject(y)))}addNoteWithPoint(_,y={}){const{width:w=DEFAULT_NOTE_WIDTH,height:$=DEFAULT_NOTE_HEIGHT,offsetX:B=DEFAULT_NOTE_OFFSET_X,offsetY:R=DEFAULT_NOTE_OFFSET_Y,parentId:H=this.page.root?.id,noteIndex:j}=y,[q,X]=this.surface.toModelCoord(_.x,_.y);return this.page.addBlock("affine:note",{xywh:serializeXYWH(q-B,X-R,w,$),index:this.indexes.max},H,j)}addNewNote(_,y,w){this.page.captureSync();const{left:$,top:B}=this.surface.viewport;y.x-=$,y.y-=B;const R=this.addNoteWithPoint(y,w),H=this.page.addBlocks(_.map(({flavour:j,...q})=>(assertExists(j),{flavour:j,blockProps:q})),R);return{noteId:R,ids:H}}addImage(_,y){const w={width:_.width??0,height:_.height??0};delete _.width,delete _.height;const $=this.pageBlockContainer.getBoundingClientRect(),{width:B,height:R}=$;if(w.width&&w.height){const te=B>100?B-100:B,ne=R>100?R-100:R,oe=te/ne,ie=w.width/w.height;oe>=1?(w.height=Math.min(w.height,ne),w.width=w.height*ie):(w.width=Math.min(w.width,te),w.height=w.width/ie)}const{zoom:H}=this.surface.viewport;if(y||(y=new Point(0,0)),y.x===0&&y.y===0){const{centerX:te,centerY:ne}=this.surface.viewport,[oe,ie]=this.surface.toViewCoord(te,ne);y.x=oe,y.y=ie}const j=y.x,q=y.y;let X=0,ee=0;return H>1?(X=j-w.width/2,ee=q-w.height/2):(X=j-w.width*H/2,ee=q-w.height*H/2),this.addNewNote([_],new Point(X,ee),w)}async addImages(_,y){const w=[];for(const{file:H,sourceId:j}of _){const q=await readImageSize(H);w.push({flavour:"affine:image",sourceId:j,...q})}const $=w.map(H=>this.addImage(H,y)),{noteId:B}=$[$.length-1],R=this.notes.find(H=>H.id===B);assertExists(R),this.tools.switchToDefaultMode({elements:[R.id],editing:!1})}setSelection(_,y=!0,w,$){const B=this.notes.find(R=>R.id===_);assertExists(B),requestAnimationFrame(()=>{this.selectionManager.setSelectedBlocks([]),this.selectionManager.setSelection({elements:[B.id],editing:!1}),this.updateComplete.then(()=>{w?asyncFocusRichText(this.page,w):$&&handleNativeRangeAtPoint($.x,$.y)})})}getElementsBound(){const _=[];this.notes.forEach(w=>{_.push(Bound.deserialize(w.xywh))});const y=this.surface.getElementsBound();return y&&_.push(y),getCommonBound(_)}update(_){_.has("page")&&(this._initSurface(),this.connector=new EdgelessConnectorManager(this),this.frame=new EdgelessFrameManager(this),this.snap=new EdgelessSnapManager(this),this.surface.init()),_.has("edgelessTool")&&(this.tools.edgelessTool=this.edgelessTool),super.update(_)}_initResizeEffect(){const _=new ResizeObserver(y=>{this.surface.onResize(),this.selectionManager.setSelectedBlocks([...this.selectionManager.selectedBlocks]),this.selectionManager.setSelection(this.selectionManager.state)});_.observe(this.pageBlockContainer),this._resizeObserver=_}_initPixelRatioChangeEffect(){let _;const y=()=>{_&&(this.surface?.onResize(),_.removeEventListener("change",y)),_=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),_.addEventListener("change",y)};y()}_initNoteHeightUpdate(){const _=throttle$1(()=>{requestAnimationFrame(()=>{this._noteResizeObserver.resetListener(this.page)})},16,{leading:!0}),y=w=>{w&&this._disposables.add(w.childrenUpdated.on(_))};y(this.page.root),this._disposables.add(this.page.slots.rootAdded.on(w=>y(w)))}_initFontloader(){this.fontLoader||(this.fontLoader=new FontLoader),this._disposables.add(this.fontLoader.slots.loaded.on(_=>{_!=="Kalam:n4,n7"||!this.surface||this.surface.getElementsByType("text").length>0&&this.surface.refresh()})),this.fontLoader.load(["Kalam:n4,n7"])}_initReadonlyListener(){const _=this.page;let y=_.readonly;this._disposables.add(_.awarenessStore.slots.update.on(()=>{y!==_.readonly&&(y=_.readonly,this.slots.readonlyUpdated.emit(y),this.requestUpdate())}))}firstUpdated(){this._initSlotEffects(),this._initResizeEffect(),this._initPixelRatioChangeEffect(),this._initNoteHeightUpdate(),this._initFontloader(),this._initReadonlyListener(),this.clipboard.init(this.page),requestAnimationFrame(()=>{this.surface.attach(this._surfaceContainer),this._noteResizeObserver.resetListener(this.page),this._tryLoadViewportLocalRecord()||this._initViewport(),this._handleToolbarFlag(),this.requestUpdate()})}_tryLoadViewportLocalRecord(){const{viewport:_}=this.surface,y="blocksuite:"+this.page.id+":edgelessViewport",w=sessionStorage.getItem(y);if(w)try{const{x:$,y:B,zoom:R}=JSON.parse(w);return _.setViewport(R,[$,B]),!0}catch{return!1}return!1}getFitToScreenData(_=[0,0,0,0]){const y=[];this.notes.forEach(te=>{y.push(Bound.deserialize(te.xywh))});const w=this.surface.getElementsBound();w&&y.push(w);const[$,B,R,H]=_,{viewport:j}=this.surface;let{centerX:q,centerY:X,zoom:ee}=j;if(y.length){const{width:te,height:ne}=j,oe=getCommonBound(y);assertExists(oe),ee=Math.min((te-FIT_TO_SCREEN_PADDING-(B+H))/oe.w,(ne-FIT_TO_SCREEN_PADDING-($+R))/oe.h),ee=clamp$1(ee,ZOOM_MIN,ZOOM_MAX),q=oe.x+(oe.w+B/ee)/2-H/ee/2,X=oe.y+(oe.h+R/ee)/2-$/ee/2}else ee=1;return{zoom:ee,centerX:q,centerY:X}}_initViewport(){const{zoom:_,centerX:y,centerY:w}=this.getFitToScreenData(),{viewport:$}=this.surface;$.setViewport(_,[y,w])}updated(_){super.updated(_)}connectedCallback(){super.connectedCallback(),this.root.rangeManager?.setConfig({shouldSyncSelection:_=>!!!_?.startContainer.parentElement?.closest("side-layout-modal")}),this.gesture=new Gesture(this),this.keyboardManager=new EdgelessPageKeyboardManager(this),this.handleEvent("selectionChange",()=>{const _=this.root.selectionManager.value.find(w=>w.is("surface"));if(!_)return;if(this.surface.pickById(_.elements[0]))return!0}),this.mouseRoot=this.parentElement,this.selectionManager=new EdgelessSelectionManager(this),this.tools=new EdgelessToolsManager(this,this.root.uiEventDispatcher)}disconnectedCallback(){super.disconnectedCallback(),this.clipboard.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this.gesture=null,this.keyboardManager=null,this.tools.clear(),this.tools.dispose(),this.selectionManager.dispose()}render(){this.setAttribute(BLOCK_ID_ATTR,this.model.id);const{_rectsOfSelectedBlocks:_,sortedNotes:y,surface:w,readonly:$}=this,{viewport:B}=w,{left:R,top:H}=B,j=x$1`${c$1(Object.entries(this.widgets),([q])=>q,([q,X])=>X)}`;return x$1`
      <div class="affine-edgeless-surface-block-container">
        <!-- attach canvas later in Phasor -->
      </div>
      <div class="affine-edgeless-page-block-container">
        <div class="affine-block-children-container edgeless">
          ${$?A:x$1`<affine-note-slicer
                .edgelessPage=${this}
              ></affine-note-slicer>`}
          <div class="affine-edgeless-layer">
            <edgeless-notes-container
              .edgeless=${this}
              .notes=${y}
              .renderer=${this.renderModel.bind(this)}
            ></edgeless-notes-container>
          </div>
        </div>
        <affine-selected-blocks
          .mouseRoot=${this.mouseRoot}
          .state=${{rects:_,grab:!1}}
          .offset=${{x:-R,y:-H}}
        ></affine-selected-blocks>
        <edgeless-hover-rect .edgeless=${this}> </edgeless-hover-rect>
        <edgeless-dragging-area-rect
          .edgeless=${this}
        ></edgeless-dragging-area-rect>
        <edgeless-selected-rect .edgeless=${this}></edgeless-selected-rect>
        ${EdgelessNotesStatus(this,this.notes)} ${j}
      </div>
    `}};EdgelessPageBlockComponent.styles=i$5`
    .affine-edgeless-page-block-container {
      position: relative;
      box-sizing: border-box;
      overflow: hidden;
      height: 100%;
      font-family: var(--affine-font-family);
      font-size: var(--affine-font-base);
      line-height: var(--affine-line-height);
      color: var(--affine-text-primary-color);
      font-weight: 400;
    }

    .affine-edgeless-surface-block-container {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .affine-edgeless-surface-block-container canvas {
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
      pointer-events: none;
    }

    .affine-block-children-container.edgeless {
      padding-left: 0;
      position: relative;
      overflow: hidden;
      height: 100%;
      /**
       * Fix: pointerEvent stops firing after a short time.
       * When a gesture is started, the browser intersects the touch-action values of the touched element and its ancestors,
       * up to the one that implements the gesture (in other words, the first containing scrolling element)
       * https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action
       */
      touch-action: none;

      background-size: var(--affine-edgeless-gap) var(--affine-edgeless-gap);
      background-position: var(--affine-edgeless-x) var(--affine-edgeless-y);
      background-color: var(--affine-background-primary-color);
      background-image: var(--affine-edgeless-grid);
      z-index: 0;
    }

    .affine-edgeless-layer {
      position: absolute;
      top: 0;
      left: 0;
      contain: layout style size;
      transform: translate(var(--affine-edgeless-x), var(--affine-edgeless-y))
        scale(var(--affine-zoom));
    }

    .affine-edgeless-block-child {
      position: absolute;
      transform-origin: center;
      box-sizing: border-box;
      border: 2px solid var(--affine-white-10);
      border-radius: 8px;
      box-shadow: var(--affine-shadow-3);
      pointer-events: all;
    }

    @media screen and (max-width: 1200px) {
      edgeless-zoom-toolbar {
        display: none;
      }
    }

    @media screen and (min-width: 1200px) {
      zoom-bar-toggle-button {
        display: none;
      }
    }

    @media print {
      .selected {
        background-color: transparent !important;
      }
    }
  `;__decorate$1z([t$2()],EdgelessPageBlockComponent.prototype,"edgelessTool",void 0);__decorate$1z([t$2()],EdgelessPageBlockComponent.prototype,"_rectsOfSelectedBlocks",void 0);__decorate$1z([i$6(".affine-edgeless-surface-block-container")],EdgelessPageBlockComponent.prototype,"_surfaceContainer",void 0);__decorate$1z([i$6(".affine-edgeless-page-block-container")],EdgelessPageBlockComponent.prototype,"pageBlockContainer",void 0);__decorate$1z([i$6(".affine-edgeless-layer")],EdgelessPageBlockComponent.prototype,"edgelessLayer",void 0);EdgelessPageBlockComponent=__decorate$1z([e$7("affine-edgeless-page")],EdgelessPageBlockComponent);async function onModelTextUpdated(k,_){const y=await asyncGetRichTextByModel(k);assertExists(y,"RichText is not ready yet."),await y.updateComplete;const w=y.vEditor;assertExists(w,"VEditor is not ready yet."),w.slots.updated.once(()=>{_&&_(y)})}async function onModelElementUpdated(k,_){const y=await asyncGetBlockElementByModel(k);y&&_(y)}function updateBlockElementType(k,_,y){if(k.length===0)return[];const w=k[0].root,$=k[0].page;k.every(oe=>oe.page===$)||console.error("Not all models have the same page instance, the result for update text type may not be correct",k),$.captureSync();const R=k.map(oe=>oe.model);if(_==="affine:code"){const oe=mergeToCodeModel(R),ie=$.getBlockById(oe);if(!ie)throw new Error("Failed to get model after merge code block!");return[ie]}if(_==="affine:divider"){const oe=R.at(-1);if(!oe)return[];const ie=$.getParent(oe);if(!ie)return[];const ae=ie.children.indexOf(oe),re=$.getNextSibling(oe);let se=re?.id;const le=$.addBlock("affine:divider",{},ie,ae+1);re||(se=$.addBlock("affine:paragraph",{},ie)),asyncFocusRichText($,se);const ue=$.getBlockById(le);if(!ue)throw new Error("Failed to get model after add divider block!");return[ue]}const H=[];R.forEach(oe=>{if(assertFlavours(oe,["affine:paragraph","affine:list","affine:code"]),oe.flavour===_){$.updateBlock(oe,{type:y}),H.push(oe);return}const ie=transformModel(oe,_,{type:y}),ae=$.getBlockById(ie);if(!ae)throw new Error("Failed to get new model after transform block!");H.push(ae)});const j=H[0],q=H[H.length-1],X=H.map(oe=>onModelTextUpdated(oe)),ee=w.selectionManager,te=ee.find("text"),ne=ee.filter("block");if(te){const oe=ee.getInstance("text",{from:{path:te.from.path.slice(0,-1).concat(j.id),index:te.from.index,length:te.from.length},to:te.to?{path:te.to.path.slice(0,-1).concat(q.id),index:te.to.index,length:te.to.length}:null});return Promise.all(X).then(()=>{ee.setGroup("note",[oe])}),H}return ne.length!==0&&requestAnimationFrame(()=>{const oe=H.map(ie=>ee.getInstance("block",{path:ne[0].path.slice(0,-1).concat(ie.id)}));ee.setGroup("note",oe)}),H}var __decorate$1y=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LinkMockSelection=class extends s$2{constructor(_){super(),this.rects=_}render(){return x$1`
      ${this.rects.map(_=>x$1`<div
          style="${o$4({position:"absolute",width:`${_.width}px`,height:`${_.height}px`,top:`${_.top}px`,left:`${_.left}px`,backgroundColor:"rgba(35, 131, 226, 0.28)"})}"
        ></div>`)}
    `}};LinkMockSelection=__decorate$1y([e$7("link-mock-selection")],LinkMockSelection);function clearMarksOnDiscontinuousInput(k){let _=k.getVRange();const y=k.slots.vRangeUpdated.on(([w,$])=>{_&&w&&($==="native"&&w.index===_.index||$!=="native"&&w.index===_.index+1)?_=w:(k.resetMarks(),y.dispose())})}var __decorate$1x=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let IconButton=class extends s$2{constructor(){super(),this.size=null,this.width=null,this.height=null,this.text=null,this.disabled=void 0,this.addEventListener("keypress",_=>{this.disabled||_.key==="Enter"&&this.click()}),this.addEventListener("click",_=>{this.disabled===!0&&(_.preventDefault(),_.stopPropagation())},{capture:!0})}connectedCallback(){super.connectedCallback(),this.tabIndex=0;const _="28px";if(this.size&&(this.width||this.height))throw new Error("Cannot set both size and width/height on an icon-button");let y=this.width??_,w=this.height??_;this.size&&(y=this.size,w=this.size),this.style.setProperty("--button-width",typeof y=="string"?y:`${y}px`),this.style.setProperty("--button-height",typeof w=="string"?w:`${w}px`)}render(){return x$1`<slot></slot>${this.text?x$1`<span class="text">${this.text}</span>`:""}<slot name="suffix"></slot>`}};IconButton.styles=i$5`
    :host {
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      border: none;
      width: var(--button-width);
      height: var(--button-height);
      border-radius: 4px;
      background: transparent;
      cursor: pointer;
      user-select: none;
      font-family: var(--affine-font-family);
      color: var(--affine-text-primary-color);
      pointer-events: auto;
    }

    :host > .text {
      flex: 1;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    ::slotted(svg) {
      color: var(--affine-icon-color);
    }

    :host(:hover) {
      background: var(--affine-hover-color);
    }

    :host(:active) {
      background: transparent;
    }

    :host([disabled]),
    :host(:disabled) {
      background: transparent;
      color: var(--affine-text-disable-color);
      fill: var(--affine-text-disable-color);
      cursor: not-allowed;
    }

    /* You can add a 'hover' attribute to the button to show the hover style */
    :host([hover]) {
      background: var(--affine-hover-color);
    }

    /* You can add a 'active' attribute to the button to revert the active style */
    :host([active]) {
      fill: var(--affine-primary-color);
      color: var(--affine-primary-color);
    }

    :host(:active[active]) {
      background: transparent;
      fill: var(--affine-icon-color);
    }
  `;__decorate$1x([n$a()],IconButton.prototype,"size",void 0);__decorate$1x([n$a()],IconButton.prototype,"width",void 0);__decorate$1x([n$a()],IconButton.prototype,"height",void 0);__decorate$1x([n$a()],IconButton.prototype,"text",void 0);__decorate$1x([n$a({attribute:!0,type:Boolean})],IconButton.prototype,"disabled",void 0);IconButton=__decorate$1x([e$7("icon-button")],IconButton);const ALLOWED_SCHEMES=["http","https","ftp","sftp","mailto","tel"],MAIL_REGEX=/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,URL_REGEX=new RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,6}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");function normalizeUrl(k){return ALLOWED_SCHEMES.find(w=>k.startsWith(w+":"))?k:MAIL_REGEX.test(k)?"mailto:"+k:"http://"+k}const isValidUrl=k=>{if(!k)return!1;const _=normalizeUrl(k);if(_===k){try{new URL(_)}catch{return!1}return!0}return URL_REGEX.test(_)},COMMON_TLDS=["com","org","net","edu","gov","co","io","me","moe","mil","top","dev","xyz","info","cat","ru","de","jp","uk","pro"],isCommonTLD=k=>{const _=k.hostname.split(".").pop();return _?COMMON_TLDS.includes(_):!1},isStrictUrl=k=>{if(!isValidUrl(k))return!1;const _=new URL(normalizeUrl(k));return!!isCommonTLD(_)},editLinkStyle=i$5`
  .affine-link-edit-popover {
    box-sizing: border-box;
    width: 404px;
    height: 112px;
    padding: 12px;
    box-shadow: var(--affine-shadow-2);
    background: var(--affine-background-overlay-panel-color);
    border-radius: 8px;
    display: grid;
    grid-template-columns: auto auto auto;
    grid-template-rows: repeat(2, 1fr);
    gap: 12px;
    grid-template-areas:
      'text-area .'
      'link-area btn';
    justify-items: center;
    align-items: center;
    /* breaks 'basic link' test in chromium */
    /* user-select: none; */
  }

  .affine-edit-text-area {
    grid-area: text-area;
    width: 338px;
    display: grid;
    gap: 6px;
    grid-template-columns: auto auto auto;
    grid-template-rows: repeat(1, 1fr);
    grid-template-areas: 'text span text-input';
    justify-items: center;
    align-items: center;
    user-select: none;
  }

  .affine-edit-link-area {
    grid-area: link-area;
    width: 338px;
    display: grid;
    gap: 6px;
    grid-template-columns: auto auto auto;
    grid-template-rows: repeat(1, 1fr);
    grid-template-areas: 'link span link-input';
    justify-items: center;
    align-items: center;
  }

  .affine-link-popover-dividing-line {
    grid-area: span;
  }
  .affine-edit-text-text {
    grid-area: text;
  }

  .affine-edit-text-input {
    grid-area: text-input;
  }

  .affine-edit-link-text {
    grid-area: link;
  }

  .affine-edit-link-input {
    grid-area: link-input;
  }

  .affine-confirm-button {
    grid-area: btn;
    user-select: none;
    fill: var(--affine-primary-color);
  }
  .affine-confirm-button[disabled],
  .affine-confirm-button:disabled {
    fill: var(--affine-icon-color);
  }
`,linkPopoverStyle=i$5`
  .popover-container {
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-base);
    font-style: normal;
    line-height: 24px;
    color: var(--affine-text-primary-color);
    z-index: var(--affine-z-index-popover);
    animation: affine-popover-fade-in 0.2s ease;
  }

  @keyframes affine-popover-fade-in {
    from {
      opacity: 0;
      transform: translateY(-3px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .overlay-mask {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: var(--affine-z-index-popover);
  }
  .affine-edit-text-area {
    border: 1px solid var(--affine-border-color);
    outline: none;
    border-radius: 10px;
    background: transparent;
  }
  .affine-edit-text-area:focus-within {
    border: 1px solid var(--affine-primary-color);
  }
  .affine-edit-link-area {
    border: 1px solid var(--affine-border-color);
    outline: none;
    border-radius: 10px;
    background: transparent;
  }
  .affine-edit-link-area:focus-within {
    border: 1px solid var(--affine-primary-color);
  }

  label {
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-sm);
    box-sizing: border-box;
    padding: 6px 0 6px 12px;
    color: var(--affine-icon-color);
  }

  input {
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-base);
    box-sizing: border-box;
    padding: 6px 12px 6px 0;
    width: 260px;
    height: 34px;
    color: inherit;
    border: none;
    background: transparent;
  }
  input::placeholder {
    color: var(--affine-placeholder-color);
  }
  input:focus {
    outline: none;
  }
  input:focus ~ label,
  input:active ~ label {
    color: var(--affine-primary-color);
  }

  .affine-link-popover {
    display: flex;
    align-items: center;
    height: 40px;
    padding: 0 12px;

    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 8px;
  }

  .affine-link-popover-input {
    border: none;
  }
  .affine-link-popover-input::placeholder {
    color: var(--affine-placeholder-color);
  }
  .affine-link-popover-input:focus {
    border: none;
  }

  .affine-link-preview {
    width: 260px;
    height: 28px;
    display: flex;
    align-items: center;
    user-select: none;
    cursor: pointer;
    white-space: nowrap;
  }

  .affine-link-popover-dividing-line {
    margin: 0 6px;
    width: 1px;
    height: 20px;
    background-color: var(--affine-border-color);
  }

  ${editLinkStyle}
  ${tooltipStyle}
`;var __decorate$1w=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LinkPopover=class extends s$2{constructor(){super(...arguments),this.left="0",this.top="0",this.type="create",this.showMask=!0,this.text="",this.previewLink="",this.showBookmarkOperation=!1,this._bodyOverflowStyle="",this._disableConfirm=!0}connectedCallback(){super.connectedCallback(),this.showMask&&(this._bodyOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden")}firstUpdated(_){super.firstUpdated(_),this.linkInput&&this.linkInput.focus()}disconnectedCallback(){super.disconnectedCallback(),this.showMask&&(document.body.style.overflow=this._bodyOverflowStyle)}_hide(){this.dispatchEvent(new CustomEvent("updateLink",{detail:{type:"cancel"}}))}_onConfirm(){if(this._disableConfirm)return;if(!this.linkInput)throw new Error("Failed to update link! Link input not found!");const _=normalizeUrl(this.linkInput.value),y=this.textInput?.value??void 0;_&&this.dispatchEvent(createEvent("updateLink",{type:"confirm",link:_,text:y}))}_onCopy(){navigator.clipboard.writeText(this.previewLink),toast("Copied link to clipboard")}_onUnlink(){this.dispatchEvent(createEvent("updateLink",{type:"remove"}))}_onLinkToCard(){this.dispatchEvent(new CustomEvent("updateLink",{detail:{type:"toBookmark"}}))}_onEdit(){this.dispatchEvent(createEvent("editLink",null)),this._disableConfirm=!1}_onInput(){if(!this.linkInput)throw new Error("Failed to update link! Link input not found!");const _=isValidUrl(this.linkInput.value);this._disableConfirm=!_}_onKeydown(_){_.stopPropagation(),_.key==="Enter"&&!_.isComposing&&(_.preventDefault(),this._onConfirm())}confirmBtnTemplate(){return x$1`<icon-button
      class="affine-confirm-button"
      ?disabled=${this._disableConfirm}
      @click=${this._onConfirm}
      >${ConfirmIcon}</icon-button
    >`}createLinkTemplate(){return x$1`<div class="affine-link-popover">
      <input
        id="link-input"
        class="affine-link-popover-input"
        type="text"
        spellcheck="false"
        placeholder="Paste or type a link"
        value=${this.previewLink}
        @keydown=${this._onKeydown}
        @input=${this._onInput}
      />
      <span class="affine-link-popover-dividing-line"></span>
      ${this.confirmBtnTemplate()}
    </div>`}previewTemplate(){return x$1`<div class="affine-link-popover">
      <div class="affine-link-preview has-tool-tip" @click=${this._onCopy}>
        <tool-tip inert role="tooltip">Click to copy link</tool-tip>
        <span style="overflow: hidden;">${this.previewLink}</span>
      </div>
      <span class="affine-link-popover-dividing-line"></span>
      ${this.showBookmarkOperation?x$1`<icon-button
              class="has-tool-tip"
              data-testid="unlink"
              @click=${this._onLinkToCard}
            >
              ${BookmarkIcon}
              <tool-tip inert role="tooltip">Turn into Card view</tool-tip>
            </icon-button>
            <span class="affine-link-popover-dividing-line"></span>`:""}
      <icon-button
        class="has-tool-tip"
        data-testid="unlink"
        @click=${this._onUnlink}
      >
        ${UnlinkIcon}
        <tool-tip inert role="tooltip">Remove</tool-tip>
      </icon-button>

      <icon-button
        class="has-tool-tip"
        data-testid="edit"
        @click=${this._onEdit}
      >
        ${EditIcon}
        <tool-tip inert role="tooltip">Edit</tool-tip>
      </icon-button>
    </div>`}simpleTemplate(){return!this.previewLink?this.createLinkTemplate():this.previewTemplate()}editTemplate(){return x$1`<div class="affine-link-edit-popover">
      <div class="affine-edit-text-area">
        <input
          class="affine-edit-text-input"
          id="text-input"
          type="text"
          placeholder="Enter text"
          value=${this.text}
          @keydown=${this._onKeydown}
        />
        <span class="affine-link-popover-dividing-line"></span>
        <label class="affine-edit-text-text" for="text-input">Text</label>
      </div>
      <div class="affine-edit-link-area">
        <input
          id="link-input"
          class="affine-edit-link-input"
          type="text"
          spellcheck="false"
          placeholder="Paste or type a link"
          value=${this.previewLink}
          @keydown=${this._onKeydown}
        />
        <span class="affine-link-popover-dividing-line"></span>
        <label class="affine-edit-link-text" for="link-input">Link</label>
      </div>
      ${this.confirmBtnTemplate()}
    </div>`}render(){const _=this.showMask?x$1`<div class="overlay-mask" @click="${this._hide}"></div>`:x$1``,y=this.type==="create"?this.simpleTemplate():this.editTemplate();return x$1`
      <div class="overlay-root">
        ${_}
        <div
          class="popover-container"
          style="position: absolute; left: ${this.left}; top: ${this.top};${this.style.cssText}"
        >
          ${y}
        </div>
      </div>
    `}};LinkPopover.styles=linkPopoverStyle;__decorate$1w([n$a()],LinkPopover.prototype,"left",void 0);__decorate$1w([n$a()],LinkPopover.prototype,"top",void 0);__decorate$1w([n$a()],LinkPopover.prototype,"type",void 0);__decorate$1w([n$a({type:Boolean})],LinkPopover.prototype,"showMask",void 0);__decorate$1w([n$a()],LinkPopover.prototype,"text",void 0);__decorate$1w([n$a()],LinkPopover.prototype,"previewLink",void 0);__decorate$1w([n$a({type:Boolean})],LinkPopover.prototype,"showBookmarkOperation",void 0);__decorate$1w([t$2()],LinkPopover.prototype,"_bodyOverflowStyle",void 0);__decorate$1w([t$2()],LinkPopover.prototype,"_disableConfirm",void 0);__decorate$1w([i$6("#text-input")],LinkPopover.prototype,"textInput",void 0);__decorate$1w([i$6("#link-input")],LinkPopover.prototype,"linkInput",void 0);__decorate$1w([i$6(".popover-container")],LinkPopover.prototype,"popoverContainer",void 0);LinkPopover=__decorate$1w([e$7("edit-link-panel")],LinkPopover);function calcSafeCoordinate({positioningPoint:k,objRect:_={width:0,height:0},boundaryRect:y=document.body.getBoundingClientRect(),offsetX:w=0,offsetY:$=0,edgeGap:B=20}){const R=clamp$2(k.x+w,B,y.width-_.width-B),H=k.y+$;return{x:R,y:H}}function compareTopAndBottomSpace(k,_=document.body,y=20){const w=k.getBoundingClientRect(),$=_.getBoundingClientRect(),B=w.top-$.top,R=$.bottom-w.bottom,H=B>R?"top":"bottom";return{placement:H,height:(H==="top"?B:R)-y}}function getPopperPosition(k,_,{gap:y=12,offsetY:w=5}={}){k||console.warn("The popper element is not exist. Popper position maybe incorrect");const{placement:$,height:B}=compareTopAndBottomSpace(_,document.body,y+w),R=_.getBoundingClientRect(),H={x:R.x,y:R.y+($==="bottom"?R.height:0)},j=document.body.getBoundingClientRect(),q=k?.getBoundingClientRect(),X=calcSafeCoordinate({positioningPoint:H,objRect:q,boundaryRect:j,offsetY:$==="bottom"?w:-w});return{placement:$,height:B,x:`${X.x}px`,y:$==="bottom"?`${X.y}px`:`calc(${X.y}px - 100%)`}}function updatePosition(k,_){const y=_.getBoundingClientRect(),w=5,$=calcSafeCoordinate({positioningPoint:{x:y.x,y:y.top+y.height+w},objRect:k.popoverContainer?.getBoundingClientRect(),offsetY:w});k.left=`${$.x}px`,k.top=`${$.y}px`}function createEditLinkElement(k,_,{showMask:y,previewLink:w,model:$}){const B=$.page,R=new LinkPopover;return R.showMask=y,R.previewLink=w,R.showBookmarkOperation=!!B.awarenessStore.getFlag("enable_bookmark_operation")&&!isInsideBlockByFlavour(B,$,"affine:database"),_.appendChild(R),requestAnimationFrame(()=>{updatePosition(R,k)}),R}function bindHoverState(k,_,y){let $;const B=()=>{clearTimeout($)},R=()=>{$=window.setTimeout(()=>{y.abort()},300)},H=()=>{y.abort()};k.addEventListener("mouseover",B),k.addEventListener("mouseout",R),_.addEventListener("mouseover",B),_.addEventListener("mouseout",R);const j=getModelByElement(k),X=getDocPage(j.page)?.viewportElement;return X?.addEventListener("scroll",H),()=>{k.removeEventListener("mouseover",B),k.removeEventListener("mouseout",R),_.removeEventListener("mouseover",B),_.removeEventListener("mouseout",R),X?.removeEventListener("scroll",H)}}async function showLinkPopover({anchorEl:k,model:_,container:y=document.body,text:w="",link:$="",showMask:B=!0,interactionKind:R="always",abortController:H=new AbortController}){if(assertExists(k,"Can't show tooltip without anchor element!"),H.signal.aborted)return Promise.resolve({type:"cancel"});const j=createEditLinkElement(k,y,{showMask:B,previewLink:$,model:_}),q=R==="hover"?bindHoverState(k,j,H):noop;return new Promise(X=>{H.signal.addEventListener("abort",()=>{j.remove(),X({type:"cancel"})}),j.addEventListener("editLink",()=>{H.signal.aborted||(j.type="edit",j.showMask=!0,j.text=w,q(),requestAnimationFrame(()=>{updatePosition(j,k)}))}),j.addEventListener("updateLink",ee=>{H.signal.aborted||(j.remove(),X(ee.detail))})})}function formatByTextSelection(k,_,y,w){const $=getSelectedContentModels(k,["text"]);if($.length===0)throw new Error("No selected models");const B=k.root.rangeManager;assertExists(B);const{from:R,to:H}=_,j=$[0],q=$[$.length-1];if(_.isCollapsed()){const ee=getVirgoByModel(j),te=ee?.getDeltaByRangeIndex(R.index);if(!ee||!te)return;ee.setMarks({...ee.marks,[y]:ee.marks&&ee.marks[y]||te.attributes&&te.attributes[y]?null:w}),clearMarksOnDiscontinuousInput(ee);return}if(_.isInSameBlock()){if(matchFlavours(j,["affine:code"]))return;getVirgoByModel(j)?.slots.updated.once(()=>{B.syncTextSelectionToRange(_)}),j.text?.format(R.index,R.length,{[y]:w});return}matchFlavours(j,["affine:code"])||j.text?.format(R.index,R.length,{[y]:w}),matchFlavours(q,["affine:code"])||q.text?.format(H?.index??0,H?.length??0,{[y]:w}),$.slice(1,-1).filter(ee=>!matchFlavours(ee,["affine:code"])).forEach(ee=>{ee.text?.format(0,ee.text.length,{[y]:w})});const X=$.filter(ee=>!matchFlavours(ee,["affine:code"])).map(ee=>new Promise(te=>{const ne=getVirgoByModel(ee);ne?.slots.updated.once(()=>{te(ne)})}));Promise.all(X).then(()=>{B.syncTextSelectionToRange(_)})}function toggleLink(k,_){if(_.isCollapsed()||!_.isInSameBlock())return;const y=getSelectedContentModels(k,["text"]);if(y.length===0)return;const[w]=y,$=k.page,B=getVirgoByModel(w);assertExists(B);const R=_.from;if(B.getFormat(R).link){$.captureSync(),B.formatText(R,{link:null}),B.setVRange(R);return}const q=(()=>{const X=getCurrentNativeRange(),ee=Array.from(X.getClientRects()),te=getEditorContainer($),ne=te.getBoundingClientRect(),oe=new LinkMockSelection(ee.map(ie=>new DOMRect(ie.left-ne.left,ie.top-ne.top,ie.width,ie.height)));return te.appendChild(oe),()=>{te.removeChild(oe)}})();showLinkPopover({anchorEl:B.rootElement,model:w}).then(X=>{if(X.type!=="confirm"){q();return}const ee=X.link;q(),$.captureSync(),B.formatText(R,{link:ee}),B.setVRange(R)})}var __decorate$1v=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let CounterBlock=class extends s$2{constructor(){super(),this.count=0}async _notify(){this.count++,await this.updateComplete;const _={detail:this.count,bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("block-count-update",_))}render(){return x$1` <div @click=${this._notify}>${this.count}</div> `}};__decorate$1v([n$a({attribute:!1})],CounterBlock.prototype,"count",void 0);CounterBlock=__decorate$1v([e$7("counter-block")],CounterBlock);const inlineMarkdownMatches=[{name:"bolditalic",pattern:/(?:\*\*\*)([^\s\*](?:[^*]*?[^\s\*])?)(?:\*\*\*)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{bold:!0,italic:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:H+R.length-3,length:3}),k.deleteText({index:H,length:3}),k.setVRange({index:H+R.length-6,length:0}),VKEYBOARD_PREVENT_DEFAULT}},{name:"bold",pattern:/(?:\*\*)([^\s\*](?:[^*]*?[^\s\*])?)(?:\*\*)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{bold:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:H+R.length-2,length:2}),k.deleteText({index:H,length:2}),k.setVRange({index:H+R.length-4,length:0}),VKEYBOARD_PREVENT_DEFAULT}},{name:"italic",pattern:/(?:\*)([^\s\*](?:[^*]*?[^\s\*])?)(?:\*)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{italic:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:H+R.length-1,length:1}),k.deleteText({index:H,length:1}),k.setVRange({index:H+R.length-2,length:0}),VKEYBOARD_PREVENT_DEFAULT}},{name:"strikethrough",pattern:/(?:~~)([^\s~](?:[^~]*?[^\s~])?)(?:~~)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{strike:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:H+R.length-2,length:2}),k.deleteText({index:H,length:2}),k.setVRange({index:H+R.length-4,length:0}),VKEYBOARD_PREVENT_DEFAULT}},{name:"underthrough",pattern:/(?:~)([^\s~](?:[^~]*?[^\s~])?)(?:~)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{underline:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:y.index-1,length:1}),k.deleteText({index:H,length:1}),k.setVRange({index:H+R.length-2,length:0}),VKEYBOARD_PREVENT_DEFAULT}},{name:"code",pattern:/(?:`)([^\s`](?:[^`]*?[^\s`])?)(?:`)$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=w.exec(_);if(!B)return VKEYBOARD_ALLOW_DEFAULT;const R=B[0],H=y.index-R.length;return _.match(/^([* \n]+)$/g)?VKEYBOARD_ALLOW_DEFAULT:(k.insertText({index:H+R.length,length:0}," "),$.stopCapturing(),k.formatText({index:H,length:R.length},{code:!0}),k.deleteText({index:H+R.length,length:1}),k.deleteText({index:H+R.length-1,length:1}),k.deleteText({index:H,length:1}),k.setVRange({index:H+R.length-2,length:0}),VKEYBOARD_PREVENT_DEFAULT)}},{name:"link",pattern:/(?:\[(.+?)\])(?:\((.+?)\))$/g,action:({vEditor:k,prefixText:_,vRange:y,pattern:w,undoManager:$})=>{const B=_.search(w),R=_.match(w)?.[0],H=_.match(/(?:\[(.*?)\])/g)?.[0],j=_.match(/(?:\((.*?)\))/g)?.[0];if(B===-1||!R||!H||!j)return VKEYBOARD_ALLOW_DEFAULT;const q=y.index-R.length;return k.insertText({index:y.index,length:0}," "),$.stopCapturing(),k.formatText({index:q,length:H.length},{link:j.slice(1,j.length-1)}),k.deleteText({index:y.index+R.length,length:1}),k.deleteText({index:y.index-j.length-1,length:j.length+1}),k.deleteText({index:q,length:1}),k.setVRange({index:q+H.length-1,length:0}),VKEYBOARD_PREVENT_DEFAULT}}];function tryFormatInlineStyle(k,_){const{vEditor:y,prefixText:w,vRange:$}=k;for(const B of inlineMarkdownMatches)if(w.match(B.pattern))return B.action({vEditor:y,prefixText:w,vRange:$,pattern:B.pattern,undoManager:_});return VKEYBOARD_ALLOW_DEFAULT}function tryConvertBlock(k,_,y,w,$){if(!w.match(/^(\d+\.|-|\*|\[ ?\]|\[x\]|(#){1,6}|(-){3}|(\*){3}|>|```([a-zA-Z0-9]*))$/))return VKEYBOARD_ALLOW_DEFAULT;const[,B]=y.getLine($.index);if(B>w.length)return VKEYBOARD_ALLOW_DEFAULT;const R=matchFlavours(_,["affine:paragraph"]),H=R&&_.type.startsWith("h"),j=R&&isEqual$1(_.type,"quote"),q=matchFlavours(_,["affine:code"]);if(H||j||q)return VKEYBOARD_ALLOW_DEFAULT;const X=w.match(/^```([a-zA-Z0-9]*)$/g);if(X){if(_.flavour==="affine:paragraph"&&_.type==="quote")return VKEYBOARD_ALLOW_DEFAULT;const te=_.page;te.captureSync();const ne=te.getParent(_);assertExists(ne);const oe=ne.children.indexOf(_);te.deleteBlock(_);const ie=te.addBlock("affine:code",{language:getStandardLanguage(X[0].slice(3))?.id??FALLBACK_LANG},ne,oe),ae=te.getBlockById(ie);return assertExists(ae),asyncSetVRange(ae,{index:0,length:0}),VKEYBOARD_PREVENT_DEFAULT}let ee=!1;switch(w.trim()){case"[]":case"[ ]":ee=convertToList(k,_,"todo",w,{checked:!1});break;case"[x]":ee=convertToList(k,_,"todo",w,{checked:!0});break;case"-":case"*":ee=convertToList(k,_,"bulleted",w);break;case"***":case"---":ee=convertToDivider(k,_,w);break;case"#":ee=convertToParagraph(k,_,"h1",w);break;case"##":ee=convertToParagraph(k,_,"h2",w);break;case"###":ee=convertToParagraph(k,_,"h3",w);break;case"####":ee=convertToParagraph(k,_,"h4",w);break;case"#####":ee=convertToParagraph(k,_,"h5",w);break;case"######":ee=convertToParagraph(k,_,"h6",w);break;case">":ee=convertToParagraph(k,_,"quote",w);break;default:ee=convertToList(k,_,"numbered",w)}return ee?VKEYBOARD_PREVENT_DEFAULT:VKEYBOARD_ALLOW_DEFAULT}const EDGE_IGNORED_ATTRIBUTES=["code","reference"],GLOBAL_IGNORED_ATTRIBUTES=["reference"],autoIdentifyLink=k=>{if(k.attributes?.link&&k.data===" "){delete k.attributes.link;return}if(k.attributes?.link){const H=k.vEditor.deltaService.getDeltasByVRange(k.vRange).filter(([oe])=>oe.attributes?.link)[0],[j,{index:q,length:X}]=H,ee=k.vRange.index-q;if(j.attributes?.link!==j.insert){if(ee===X){delete k.attributes.link;return}return}const te=j.insert.slice(0,ee)+k.data+j.insert.slice(ee);if(!isStrictUrl(te)){k.vEditor.resetText({index:q,length:X}),delete k.attributes.link;return}k.vEditor.formatText({index:q,length:X},{link:te}),k.attributes={...k.attributes,link:te};return}const[_]=k.vEditor.getLine(k.vRange.index),y=k.data||"",w=`${_.textContent.slice(0,k.vRange.index)}${y}`.split(" "),$=w[w.length-1];if(!isStrictUrl($))return;const R=k.vRange.index+y.length-$.length;k.vEditor.formatText({index:R,length:$.length},{link:$}),k.attributes={...k.attributes,link:$}};let ifPrefixSpace=!1;const onVBeforeinput=k=>{const{vEditor:_,vRange:y,data:w,raw:$}=k;if(y.length!==0)return k;const B=_.getDeltasByVRange(y);if($.inputType==="insertText"&&w===" "?ifPrefixSpace=!0:w!==". "&&w!=="。 "&&(ifPrefixSpace=!1),ifPrefixSpace&&(w===". "||w==="。 ")&&(k.data=" "),w&&w.length>0&&w!==`
`&&(B.length>1||B.length===1&&y.index!==0)){const{attributes:R}=B[0][0];(B.length!==1||y.index===_.yText.length)&&EDGE_IGNORED_ATTRIBUTES.forEach(H=>{delete R?.[H]}),GLOBAL_IGNORED_ATTRIBUTES.forEach(H=>{delete R?.[H]}),k.attributes=R??{}}return autoIdentifyLink(k),k},onVCompositionEnd=k=>{const{vEditor:_,vRange:y,data:w}=k;if(y.length!==0)return k;const $=_.getDeltasByVRange(y);if(w&&w.length>0&&w!==`
`&&($.length>1||$.length===1&&y.index!==0)){const B=$[0][0].attributes;($.length!==1||y.index===_.yText.length)&&EDGE_IGNORED_ATTRIBUTES.forEach(R=>{delete B?.[R]}),GLOBAL_IGNORED_ATTRIBUTES.forEach(R=>{delete B?.[R]}),k.attributes=B??{}}return autoIdentifyLink(k),k},affineTextAttributes=baseTextAttributes.extend({reference:z.object({type:z.enum(["Subpage","LinkedPage"]),pageId:z.string()}).optional(),background:z.string().optional().catch(void 0)});var __decorate$1u=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let RichText=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.readonly=!1,this._vEditor=null}get virgoContainer(){return this._virgoContainer}get vEditor(){return this._vEditor}_init(){if(this._vEditor)throw new Error("vEditor already exists.");this._vEditor=new VEditor(this.yText,{isEmbed:w=>!!w.attributes?.reference,hooks:{beforeinput:onVBeforeinput,compositionEnd:onVCompositionEnd}}),this._vEditor.setAttributeSchema(this.textSchema.attributesSchema),this._vEditor.setAttributeRenderer(this.textSchema.textRenderer()),assertExists(this._vEditor);const _=this._vEditor,y=createVirgoKeyDownHandler(this._vEditor,{inputRule:{key:" ",handler:w=>tryFormatInlineStyle(w,this.undoManager)}});assertExists(this.virgoContainer),_.disposables.addFromEvent(this.virgoContainer,"keydown",y),_.mount(this.virgoContainer),_.setReadonly(this.readonly)}_unmount(){this.vEditor?.mounted&&this.vEditor.unmount(),this._vEditor=null}connectedCallback(){super.connectedCallback(),assertExists(this.yText,"rich-text need yText to init."),assertExists(this.undoManager,"rich-text need undoManager to init."),assertExists(this.textSchema,"rich-text need textSchema to init."),this.updateComplete.then(()=>{this._unmount(),this._init(),this.disposables.add({dispose:()=>{this._unmount()}})})}updated(){this._vEditor&&this._vEditor.setReadonly(this.readonly)}render(){return x$1`<div class="affine-rich-text virgo-editor"></div>`}};RichText.styles=i$5`
    .affine-rich-text {
      height: 100%;
      width: 100%;
      outline: none;
      cursor: text;
    }

    v-line {
      scroll-margin-top: 50px;
      scroll-margin-bottom: 30px;
    }
  `;__decorate$1u([i$6(".affine-rich-text")],RichText.prototype,"_virgoContainer",void 0);__decorate$1u([n$a({attribute:!1})],RichText.prototype,"yText",void 0);__decorate$1u([n$a({attribute:!1})],RichText.prototype,"undoManager",void 0);__decorate$1u([n$a({attribute:!1})],RichText.prototype,"textSchema",void 0);__decorate$1u([n$a({attribute:!1})],RichText.prototype,"readonly",void 0);RichText=__decorate$1u([e$7("rich-text")],RichText);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function n(k,_,y){return k?_():y?.()}function getClosestPageBlockComponent(k){return k.closest("affine-edgeless-page, affine-page-block")}const getSelection$1=k=>k.root.selectionManager,getView=k=>k.root.viewStore,pathToBlock=(k,_)=>getView(k).viewFromPath("block",_),ensureBlockInContainer=(k,_)=>_.contains(k)&&k!==_;function getNextSibling(k,_){const y=getView(k),w=y.findNext(k.path,$=>{if(!($.type!=="block"||$.view.contains(k))&&!(_&&!_($.view)))return!0});return w?y.viewFromPath("block",w.path):null}function getPrevSibling(k,_){const y=getView(k),w=y.findPrev(k.path,$=>{if($.type==="block"&&!(_&&!_($.view)))return!0});return w?y.viewFromPath("block",w.path):null}function getLastGrandChild(k){const _=getView(k);let y=k;return _.walkThrough((w,$,B)=>{if(w.children.filter(R=>R.type==="block").length===0&&B.children.filter(R=>R.type==="block").at(-1)===w)return y=w.view,!0},k.path),y}function setBlockSelection(k){const _=getSelection$1(k),y=k.path;_.update(w=>w.filter($=>!$.is("text")&&!$.is("block")).concat(_.getInstance("block",{path:y})))}function setTextSelectionBySide(k,_){const y=getSelection$1(k),w=k.path;y.setGroup("note",[y.getInstance("text",{from:{path:w,index:_?k.model.text?.length??0:0,length:0},to:null})])}function getBlockSelectionBySide(k,_){return getSelection$1(k).value.filter(B=>B.is("block")).at(_?-1:0)??null}function getTextSelection(k){return getSelection$1(k).find("text")}function getAnchorBlockSelection(k){const w=getSelection$1(k).value.filter($=>$.is("text")||$.is("block")).find($=>PathFinder.equals($.path,k.path));return w||null}function getNextBlock(k,_){const y=getAnchorBlockSelection(k);if(!y)return null;const $=getView(k).viewFromPath("block",y.path);if(!$)return null;let B=null;return $.childBlockElements[0]&&(B=$.childBlockElements[0]),B||(B=getNextSibling($,_)),B&&!B.contains($)?B:null}function getPrevBlock(k,_){const y=getAnchorBlockSelection(k);if(!y)return null;const $=getView(k).viewFromPath("block",y.path);if(!$)return null;let B=getPrevSibling($,_);return B?(B.contains($)||(B=getLastGrandChild(B)),B&&B!==k?B:null):null}function selectBetween(k,_,y){const w=getSelection$1(k);if(PathFinder.equals(k.path,_.path)){setBlockSelection(_);return}const $=[...w.value];$.every(H=>!PathFinder.equals(H.path,_.path))&&(y?$.push(w.getInstance("block",{path:_.path})):$.unshift(w.getInstance("block",{path:_.path})));let B=!1;const R=$.filter(H=>PathFinder.equals(H.path,k.path)||PathFinder.equals(H.path,_.path)?(B=!B,!0):B);w.update(H=>H.filter(j=>!j.is("text")&&!j.is("block")).concat(R))}function getCurrentCaretPos(k){const _=document.getSelection();if(!_||_.rangeCount===0)return null;const w=_.getRangeAt(0).getClientRects();return k?w[w.length-1]:w[0]}function horizontalGetNextCaret(k,_,y=!1,w=5){if(!document.getSelection())return;const B=getCurrentCaretPos(!y);if(!B)return;const R=_.getBoundingClientRect();let H={x:Math.max(k.x,R.left,B.x),y:y?Math.min(k.y,B.y):Math.max(k.y,B.y)},j=caretFromPoint(H.x,H.y);const q=caretFromPoint(H.x,H.y),X=()=>!j||!q||!_.contains(j.node)?!1:B&&Math.abs(B.y-H.y)<w?!0:j.node.nodeType!==Node.TEXT_NODE;for(;X();)H={x:H.x,y:H.y+(y?-1*w:w)},j=caretFromPoint(H.x,H.y);if(!j||!j.node.parentElement?.closest("[data-virgo-root]")){const ee=getTextNodesFromElement(_),te=y?ee[ee.length-1]:ee[0];return{node:te,offset:y?te.textContent?.length??0:0}}return j}function horizontalMoveCursorToNextText(k,_,y=!1){const w=document.getSelection();if(!w)return;const $=horizontalGetNextCaret(k,_,y);if(!$)return;const{node:B,offset:R}=$,H=document.createRange();return H.setStart(B,R),w.removeAllRanges(),w.addRange(H),B.parentElement?.scrollIntoView({block:"nearest"}),{caret:$,range:H}}function moveCursorToNextBlockElement(k){const _=getCurrentCaretPos(!0);if(!_||!k)return;const y=horizontalMoveCursorToNextText({x:_.right,y:k.getBoundingClientRect().top??0},k);if(y){const w=k.closest("affine-doc-page")?.viewportElement;w&&autoScroll$1(w,y.range.getBoundingClientRect().bottom)}}function moveCursorToPrevBlockElement(k){const _=getCurrentCaretPos(!1);if(!_||!k)return;const y=horizontalMoveCursorToNextText({x:_.left,y:k.getBoundingClientRect().bottom-2},k,!0);if(y){const w=k.closest("affine-doc-page")?.viewportElement;w&&autoScroll$1(w,y.range.getBoundingClientRect().top)}}const bracketPairs=[{name:"parenthesis",left:"(",right:")"},{name:"square bracket",left:"[",right:"]"},{name:"curly bracket",left:"{",right:"}"},{name:"single quote",left:"'",right:"'"},{name:"double quote",left:'"',right:'"'},{name:"angle bracket",left:"<",right:">"},{name:"fullwidth single quote",left:"‘",right:"’"},{name:"fullwidth double quote",left:"“",right:"”"},{name:"fullwidth parenthesis",left:"（",right:"）"},{name:"fullwidth square bracket",left:"【",right:"】"},{name:"fullwidth angle bracket",left:"《",right:"》"},{name:"corner bracket",left:"「",right:"」"},{name:"white corner bracket",left:"『",right:"』"}];function handleCommonStyle({blockElement:k,type:_,style:y,value:w}){if(_==="text"){const $=k.selection.find("text");assertExists($),formatByTextSelection(k,$,y,w)}else{const $=k.selection.filter("block"),B=k.root.viewStore;for(const R of $){const H=B.viewFromPath("block",R.path);H&&H.model.text&&H.model.text.format(0,H.model.text.length,{[y]:w})}}}const INLINE_UNSUPPORTED_MODELS=["affine:code","affine:attachment","affine:bookmark"];function noneInlineUnsupportedBlockSelected(k){return!getSelectedContentModels(k,["text","block"]).every(y=>INLINE_UNSUPPORTED_MODELS.includes(y.flavour))}const inlineFormatConfig=[{id:"bold",name:"Bold",icon:BoldIcon,hotkey:"Mod-b",activeWhen:k=>"bold"in k,showWhen:k=>noneInlineUnsupportedBlockSelected(k),action:({blockElement:k,type:_,format:y})=>{handleCommonStyle({blockElement:k,type:_,style:"bold",value:y.bold?null:!0})}},{id:"italic",name:"Italic",icon:ItalicIcon,hotkey:"Mod-i",activeWhen:k=>"italic"in k,showWhen:k=>noneInlineUnsupportedBlockSelected(k),action:({blockElement:k,type:_,format:y})=>{handleCommonStyle({blockElement:k,type:_,style:"italic",value:y.italic?null:!0})}},{id:"underline",name:"Underline",icon:UnderlineIcon,hotkey:"Mod-u",activeWhen:k=>"underline"in k,showWhen:k=>noneInlineUnsupportedBlockSelected(k),action:({blockElement:k,type:_,format:y})=>{handleCommonStyle({blockElement:k,type:_,style:"underline",value:y.underline?null:!0})}},{id:"strike",name:"Strikethrough",icon:StrikethroughIcon,hotkey:"Mod-shift-s",activeWhen:k=>"strike"in k,showWhen:k=>noneInlineUnsupportedBlockSelected(k),action:({blockElement:k,type:_,format:y})=>{handleCommonStyle({blockElement:k,type:_,style:"strike",value:y.strike?null:!0})}},{id:"code",name:"Code",icon:CodeIcon,hotkey:"Mod-e",activeWhen:k=>"code"in k,showWhen:k=>noneInlineUnsupportedBlockSelected(k),action:({blockElement:k,type:_,format:y})=>{handleCommonStyle({blockElement:k,type:_,style:"code",value:y.code?null:!0})}},{id:"link",name:"Link",icon:LinkIcon,hotkey:"Mod-k",activeWhen:k=>"link"in k,showWhen:k=>{const _=k.selection.find("text"),y=getSelectedContentModels(k,["text","block"]);return!!_&&y.length===1&&noneInlineUnsupportedBlockSelected(k)&&!getCombinedFormatInTextSelection(k,_,!0).reference},action:({blockElement:k})=>{const _=k.selection.find("text");assertExists(_),toggleLink(k,_)}}];function findTextNode(k){if(k.nodeType===Node.TEXT_NODE)return k;for(let _=0;_<k.childNodes.length;_++){const y=findTextNode(k.childNodes[_]);if(y)return y}return null}function findNextTextNode(k,_=y=>y===document.body){for(;k.parentNode;){const y=k.parentNode;if(!y)return console.warn("Failed to find text node from node! no parent node",k),null;const w=Array.from(y.childNodes).indexOf(k);if(w===-1)return console.warn("Failed to find text node from node! no node index",k),null;for(let $=w+1;$<y.childNodes.length;$++){const B=findTextNode(y.childNodes[$]);if(B)return B}if(_(y))return null;k=y}return null}function shiftRange(k){if(!k.collapsed)throw new Error("Failed to shift range! expected a collapsed range");const _=k.startContainer;if(!(_.nodeType===Node.TEXT_NODE||_.nodeType===Node.COMMENT_NODE||_.nodeType===Node.CDATA_SECTION_NODE))return null;const w=_.textContent;if(typeof w!="string")throw new Error("Failed to shift range! unexpected startContainer");if(w.length>k.startOffset){const H=k.cloneRange();return H.setStart(k.startContainer,k.startOffset+1),H.setEnd(k.startContainer,k.startOffset+1),H}const B=findNextTextNode(_,H=>H instanceof HTMLElement&&H.contentEditable==="true");if(!B)return null;const R=k.cloneRange();return R.setStart(B,0),R.setEnd(B,0),R}function isAtLineEdge(k){if(!k.collapsed)return!1;const _=shiftRange(k);if(!_)return!1;const y=_.getBoundingClientRect();return k.getBoundingClientRect().top===y.top?!1:_}function checkFirstLine(k,_){if(!k.collapsed)throw new Error("Failed to determine if the caret is at the first line! expected a collapsed range but got"+k);if(!_.contains(k.commonAncestorContainer))throw new Error("Failed to determine if the caret is at the first line! expected the range to be inside the container but got"+k+" and "+_);const y=_.getBoundingClientRect(),w=k.getBoundingClientRect();if(w.left===0&&w.top===0)return!0;const $=w.height;return y.top>w.top-$/2}function checkLastLine(k,_){if(!k.collapsed)throw new Error("Failed to determine if the caret is at the last line! expected a collapsed range but got"+k);if(!_.contains(k.commonAncestorContainer))throw new Error("Failed to determine if the caret is at the first line! expected the range to be inside the container but got"+k+" and "+_);const y=_.getBoundingClientRect(),w=k.getBoundingClientRect();if(w.left===0&&w.bottom===0)return!0;const $=w.height;if(w.bottom+$/2>y.bottom)return!0;const R=isAtLineEdge(k);if(!R)return!1;const H=R.getBoundingClientRect(),j=H.height;return H.bottom+j/2>y.bottom}function isCollapsedAtBlockStart(k){const _=k.getVRange();return _?.index===0&&_?.length===0}function isCollapsedAtBlockEnd(k){const _=k.getVRange();return _?.index===k.yText.length&&_?.length===0}function onSoftEnter(k,_){return _.insertText(k,`
`),_.setVRange({index:k.index+1,length:0}),VKEYBOARD_PREVENT_DEFAULT}function hardEnter(k,_,y,w,$=!1){const B=k.page;w.stopPropagation();const R=B.getParent(k),H=R?.lastChild()===k,j=matchFlavours(k,["affine:list"])&&k.text.length===0;if(assertExists(k.text,"Failed to hardEnter! model.text not exists!"),j&&R&&matchFlavours(R,["affine:note","affine:database"])&&k.children.length===0)return handleLineStartBackspace(B,k),VKEYBOARD_PREVENT_DEFAULT;if(j&&H)return handleUnindent(B,k,_.index),VKEYBOARD_PREVENT_DEFAULT;const q=k.text.length===_.index,X=isSoftEnterable(k);if(q&&X){if(matchFlavours(k,["affine:code"]))return $?(handleBlockEndEnter(B,k),VKEYBOARD_PREVENT_DEFAULT):(onSoftEnter(_,y),VKEYBOARD_PREVENT_DEFAULT);const te=k.text.toString(),ne=te===`
`||te.endsWith(`
`);return X&&!ne||$?(onSoftEnter(_,y),VKEYBOARD_PREVENT_DEFAULT):(k.text.delete(_.index-1,1),handleBlockEndEnter(B,k),VKEYBOARD_PREVENT_DEFAULT)}return q||$?(handleBlockEndEnter(B,k),VKEYBOARD_PREVENT_DEFAULT):isSoftEnterable(k)?(onSoftEnter(_,y),VKEYBOARD_PREVENT_DEFAULT):(handleBlockSplit(B,k,_.index,_.length),VKEYBOARD_PREVENT_DEFAULT)}function isSoftEnterable(k){return matchFlavours(k,["affine:code"])?!0:matchFlavours(k,["affine:paragraph"])?k.type==="quote":!1}function onBackspace(k,_,y){return isCollapsedAtBlockStart(y)?k.flavour==="affine:code"?VKEYBOARD_ALLOW_DEFAULT:(_.stopPropagation(),handleLineStartBackspace(k.page,k),VKEYBOARD_PREVENT_DEFAULT):(_.stopPropagation(),VKEYBOARD_ALLOW_DEFAULT)}function onForwardDelete(k,_,y){return _.stopPropagation(),isCollapsedAtBlockEnd(y)?(handleLineEndForwardDelete(k.page,k),VKEYBOARD_PREVENT_DEFAULT):VKEYBOARD_ALLOW_DEFAULT}const bindContainerHotkey=k=>{const _=k.root.selectionManager,y=k.model,w=()=>(_.update(q=>q.map(X=>PathFinder.equals(X.path,k.path)?_.getInstance("block",{path:k.path}):X)),k.querySelector("[data-virgo-root]")?.blur(),!0),$=q=>(_.update(X=>X.map(ee=>PathFinder.equals(ee.path,k.path)?_.getInstance("text",{from:{path:k.path,index:q?0:k.model.text?.length??0,length:0},to:null}):ee)),!0),B=()=>{const q=k.querySelector("[data-virgo-root]");if(!q)throw new Error("Virgo root not found");return q.virgoEditor},R=q=>{const X=q.getVRange();assertExists(X);const[ee,te]=q.getTextPoint(X.index);return ee.textContent?ee.textContent.slice(0,te):""},H=q=>{q.get("defaultState").event.preventDefault()},j=()=>(_.update(q=>q.map(X=>PathFinder.equals(X.path,k.path)?_.getInstance("text",{from:{path:k.path,index:0,length:k.model.text?.length??0},to:null}):X)),!0);k.bindHotKey({ArrowUp:q=>{if(!k.selected?.is("text"))return;const X=B(),ee=X.getVRange();assertExists(ee),ee.length!==0&&X.setVRange({index:ee.index,length:0});const te=X.toDomRange({index:ee.index,length:0});if(assertExists(te),checkFirstLine(te,X.rootElement)){H(q);return}return!0},ArrowDown:q=>{if(!k.selected?.is("text"))return;const X=B(),ee=X.getVRange();assertExists(ee),ee.length!==0&&X.setVRange({index:ee.index,length:0});const te=X.toDomRange({index:ee.index,length:0});if(assertExists(te),checkLastLine(te,X.rootElement)&&getNextBlock(k)){H(q);return}return!0},ArrowRight:q=>{if(k.selected?.is("block"))return $(!1);if(!k.selected?.is("text"))return;const X=B(),ee=X.getVRange();if(assertExists(ee),ee.length===0&&ee.index===X.yText.length){H(q);return}return!0},ArrowLeft:q=>{if(k.selected?.is("block"))return $(!0);if(!k.selected?.is("text"))return;const ee=B().getVRange();if(assertExists(ee),ee.length===0&&ee.index===0){H(q);return}return!0},Escape:()=>{if(k.selected?.is("text"))return w()},Enter:q=>{if(k.selected?.is("block"))return $(!1);if(!k.selected?.is("text"))return;k.model.page.captureSync();const X=B(),ee=X.getVRange();if(assertExists(ee),!tryConvertBlock(y.page,y,X,R(X),ee))return H(q),!0;const te=q.get("keyboardState");return hardEnter(y,ee,X,te.raw),H(q),!0},"Shift-Enter":()=>{if(!k.selected?.is("text"))return;const q=B(),X=q.getVRange();return assertExists(X),q.insertText(X,`
`),q.setVRange({index:X.index+1,length:0}),!0},"Mod-Enter":q=>{if(!k.selected?.is("text"))return;const X=q.get("keyboardState"),ee=B(),te=ee.getVRange();return assertExists(te),hardEnter(y,te,ee,X.raw,!0),H(q),!0},Space:q=>{if(!k.selected?.is("text"))return;const X=B(),ee=X.getVRange();assertExists(ee);const te=R(X);return tryConvertBlock(y.page,y,X,te,ee)||H(q),!0},"Mod-a":q=>{if(H(q),!k.selected?.is("text"))return;const X=k.selected,ee=k.querySelector("[data-virgo-root]");return X.from.index===0&&X.from.length===ee?.virgoEditor.yText.length?w():j()},Tab:q=>{if(!(k.selected?.is("block")||k.selected?.is("text")))return;const X=k.closest("affine-doc-page,affine-edgeless-page");if(!X)return;if(getSelectedContentModels(X,["text"]).length===1){const oe=B().getVRange();return assertExists(oe),handleIndent(y.page,y,oe.index),H(q),!0}const te=getSelectedContentModels(X,["text","block"]);return handleMultiBlockIndent(k.page,te),!0},"Shift-Tab":q=>{if(!(k.selected?.is("block")||k.selected?.is("text")))return;const X=k.closest("affine-doc-page,affine-edgeless-page");if(!X)return;if(getSelectedContentModels(X,["text"]).length===1){const oe=B().getVRange();return assertExists(oe),handleUnindent(y.page,y,oe.index),H(q),!0}const te=getSelectedContentModels(X,["text","block"]);return handleMultiBlockUnindent(k.page,te),!0},Backspace:q=>{if(!k.selected?.is("text"))return;const X=q.get("keyboardState"),ee=B();return onBackspace(y,X.raw,ee)||H(q),!0},Delete:q=>{if(!k.selected?.is("text"))return;const X=q.get("keyboardState"),ee=B();return onForwardDelete(y,X.raw,ee)||H(q),!0}}),inlineFormatConfig.forEach(q=>{q.hotkey&&k.bindHotKey({[q.hotkey]:X=>{if(k.page.readonly)return;const ee=k.selection.find("text");if(!ee)return;H(X);const te=getCombinedFormatInTextSelection(k,ee);return q.action({blockElement:k,type:"text",format:te}),!0}})}),bracketPairs.forEach(q=>{k.bindHotKey({[q.left]:X=>{if(k.page.readonly)return;const ee=k.selection.find("text");if(!ee||ee.isCollapsed()&&!matchFlavours(k.model,["affine:code"])||!ee.isInSameBlock())return;H(X);const te=B(),ne=te.getVRange();assertExists(ne);const oe=te.yText.toString().slice(ne.index,ne.index+ne.length);return te.insertText(ne,q.left+oe+q.right),te.setVRange({index:ne.index+1,length:ne.length}),!0}})}),k.bindHotKey({"`":q=>{if(k.page.readonly)return;const X=k.selection.find("text");if(!X||X.isCollapsed()||!X.isInSameBlock())return;H(q);const ee=B(),te=ee.getVRange();return assertExists(te),ee.formatText(te,{code:!0}),ee.setVRange({index:te.index,length:te.length}),!0}})},attributeRenderer=()=>(k,_)=>{const y=x$1`<affine-text .delta=${k}></affine-text>`;if(!k.attributes)return y;const w=k.attributes;return w.link?(w.reference&&console.error("Invalid attributes: link and reference cannot be used together",k),x$1`<affine-link .delta=${k}></affine-link>`):w.reference?x$1`<affine-reference
        .delta=${k}
        .selected=${_}
      ></affine-reference>`:y};var __decorate$1t=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function tipsPlaceholderPreventDefault(k){k.preventDefault()}function TipsPlaceholder(k,_){if(!matchFlavours(k,["affine:paragraph"]))throw new Error("TipsPlaceholder can't be used for this model");if(k.type==="text"){if(!isPageMode(k.page))return x$1`<div class="tips-placeholder" style=${o$4(_)}>
        Type '/' for commands
      </div> `;const w=document.querySelector("affine-block-hub");return w?x$1`
      <div
        class="tips-placeholder"
        @click=${()=>{if(!w)throw new Error("Failed to find blockHub!");w.toggleMenu()}}
        @pointerdown=${tipsPlaceholderPreventDefault}
        style=${o$4(_)}
      >
        Click ${BlockHubIcon20} to insert blocks, type '/' for commands
      </div>
    `:x$1`<div class="tips-placeholder" style=${o$4(_)}>
        Type '/' for commands
      </div>`}return x$1`<div class="tips-placeholder">${{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",quote:""}[k.type]}</div> `}let ParagraphBlockComponent=class extends BlockElement{constructor(){super(...arguments),this.tipsPos={top:"50%",transform:"translateY(-50%)",left:"2px"},this._tipsPlaceholderTemplate=x$1``,this._isComposing=!1,this._isFocus=!1,this.textSchema={attributesSchema:affineTextAttributes,textRenderer:attributeRenderer},this._placeholderDisposables=new DisposableGroup,this._updatePlaceholder=()=>{if(this.model.text.length!==0||this._isComposing){this._tipsPlaceholderTemplate=x$1``;return}if(this.model.type==="text"&&!this._isFocus){this._tipsPlaceholderTemplate=x$1``;return}if(this._richTextElement){const _=this._richTextElement.parentElement?.getBoundingClientRect(),y=this._richTextElement.getBoundingClientRect(),w=y.top-_.top,$=y.left-_.left;this.tipsPos={top:`${w}px`,transform:"",left:`${$+2}px`}}this._tipsPlaceholderTemplate=TipsPlaceholder(this.model,this.tipsPos)},this._onFocusIn=()=>{this._isFocus=!0,this._updatePlaceholder(),this.model.text.yText.observe(this._updatePlaceholder),this._placeholderDisposables.add(()=>this.model.text.yText.unobserve(this._updatePlaceholder)),this._placeholderDisposables.addFromEvent(this,"compositionstart",()=>{this._isComposing=!0,this._updatePlaceholder()}),this._placeholderDisposables.addFromEvent(this,"compositionend",()=>{this._isComposing=!1,this._updatePlaceholder()})},this._onFocusOut=()=>{this._isFocus=!1,this._updatePlaceholder(),this._placeholderDisposables.dispose(),this._placeholderDisposables=new DisposableGroup},this.isInDatabase=()=>{let _=this.parentElement;for(;_&&_!==document.body;){if(_.tagName.toLowerCase()==="affine-database")return!0;_=_.parentElement}return!1}}connectedCallback(){super.connectedCallback(),this._updatePlaceholder(),bindContainerHotkey(this)}firstUpdated(){this.model.propsUpdated.on(()=>{this._updatePlaceholder(),this.requestUpdate()}),this.model.childrenUpdated.on(()=>this.requestUpdate())}render(){const{type:_}=this.model,y=this.isInDatabase()?"":this._tipsPlaceholderTemplate,w=x$1`<div
      class="affine-block-children-container"
      style="padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px"
    >
      ${this.content}
    </div>`;return x$1`
      <div class="affine-paragraph-block-container ${_}">
        <div class="affine-paragraph-rich-text-wrapper">
          ${y}
          <rich-text
            .yText=${this.model.text.yText}
            .undoManager=${this.model.page.history}
            .textSchema=${this.textSchema}
            .readonly=${this.model.page.readonly}
            @focusin=${this._onFocusIn}
            @focusout=${this._onFocusOut}
            style=${o$4({fontWeight:/^h[1-6]$/.test(_)?"600":void 0})}
          ></rich-text>
        </div>
        ${w}
        ${n(this.selected?.is("block"),()=>x$1`<affine-block-selection></affine-block-selection>`)}
      </div>
    `}};ParagraphBlockComponent.styles=i$5`
    .affine-paragraph-block-container {
      position: relative;
      border-radius: 4px;
    }
    .affine-paragraph-rich-text-wrapper {
      position: relative;
    }
    code {
      font-size: calc(var(--affine-font-base) - 4px);
    }
    .h1 {
      font-size: var(--affine-font-h-1);
      line-height: calc(1em + 12px);
      margin-top: 18px;
      margin-bottom: 10px;
    }
    .h1 code {
      font-size: calc(var(--affine-font-base) + 8px);
    }
    .h2 {
      font-size: var(--affine-font-h-2);
      line-height: calc(1em + 10px);
      margin-top: 14px;
      margin-bottom: 10px;
    }
    .h2 code {
      font-size: calc(var(--affine-font-base) + 6px);
    }
    .h3 {
      font-size: var(--affine-font-h-3);
      line-height: calc(1em + 8px);
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .h3 code {
      font-size: calc(var(--affine-font-base) + 4px);
    }
    .h4 {
      font-size: var(--affine-font-h-4);
      line-height: calc(1em + 10px);
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .h4 code {
      font-size: calc(var(--affine-font-base) + 2px);
    }
    .h5 {
      font-size: var(--affine-font-h-5);
      line-height: calc(1em + 8px);
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .h5 code {
      font-size: calc(var(--affine-font-base));
    }
    .h6 {
      font-size: var(--affine-font-h-6);
      line-height: calc(1em + 8px);
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .h6 code {
      font-size: calc(var(--affine-font-base) - 2px);
    }
    .quote {
      line-height: 26px;
      padding-left: 17px;
      margin-top: var(--affine-paragraph-space);
      padding-top: 10px;
      padding-bottom: 10px;
      position: relative;
    }
    .quote::after {
      content: '';
      width: 2px;
      height: calc(100% - 20px);
      margin-top: 10px;
      margin-bottom: 10px;
      position: absolute;
      left: 0;
      top: 0;
      background: var(--affine-quote-color);
      border-radius: 18px;
    }
    .text {
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: var(--affine-font-base);
    }

    .tips-placeholder {
      position: absolute;
      display: flex;
      align-items: center;
      gap: 4px;
      pointer-events: none;
      color: var(--affine-placeholder-color);
      fill: var(--affine-placeholder-color);
    }

    .tips-placeholder > svg {
      cursor: pointer;
      pointer-events: all;
    }
    .tips-placeholder > svg:hover {
      fill: var(--affine-primary-color);
    }
  `;__decorate$1t([t$2()],ParagraphBlockComponent.prototype,"tipsPos",void 0);__decorate$1t([t$2()],ParagraphBlockComponent.prototype,"_tipsPlaceholderTemplate",void 0);__decorate$1t([t$2()],ParagraphBlockComponent.prototype,"_isComposing",void 0);__decorate$1t([t$2()],ParagraphBlockComponent.prototype,"_isFocus",void 0);__decorate$1t([i$6("rich-text")],ParagraphBlockComponent.prototype,"_richTextElement",void 0);ParagraphBlockComponent=__decorate$1t([e$7("affine-paragraph")],ParagraphBlockComponent);const listPrefix=i$5`
  .affine-list-block__prefix {
    display: flex;
    color: var(--affine-blue-700);
    font-size: var(--affine-font-sm);
    user-select: none;
    position: relative;
  }

  .affine-list-block__numbered {
    min-width: 22px;
    height: 24px;
    margin-left: 2px;
  }

  .affine-list-block__todo-prefix {
    display: flex;
    align-items: center;
    cursor: pointer;
    width: 24px;
    height: 24px;
    color: var(--affine-icon-color);
  }

  .affine-list-block__todo-prefix > svg {
    width: 20px;
    height: 20px;
  }
`,styles$n=i$5`
  .affine-list-block-container {
    box-sizing: border-box;
    border-radius: 4px;
    padding: 4px 0;
    position: relative;
  }
  .affine-list-block-container--first {
    margin-top: 14px;
  }
  .affine-list-block-container .affine-list-block-container {
    margin-top: 0;
  }
  .affine-list-rich-text-wrapper {
    display: flex;
    position: relative;
  }
  .affine-list-rich-text-wrapper rich-text {
    flex: 1;
  }

  .affine-list--checked {
    color: var(--affine-text-secondary-color);
  }

  ${listPrefix}
`;function number2letter(k){const _="a".charCodeAt(0),w="z".charCodeAt(0)-_+1;let $="";for(;k>=0;)$=String.fromCharCode(k%w+_)+$,k=Math.floor(k/w)-1;return $}function number2roman(k){const _={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};let y="";for(const w in _)for(;k>=_[w];)y+=w,k-=_[w];return y}function getPrefix(k,_){const y=[()=>_+1,number2letter,()=>number2roman(_+1)];return y[k%y.length](_)}function getNumberPrefix(k,_){const y=getPrefix(_,k);return y.toString().length>1?`${y}.`:`${y} .`}const point1=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="6" cy="12" r="2" fill="currentColor" />
    </svg>
  `,point2=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M6 13.5C6.82843 13.5 7.5 12.8284 7.5 12C7.5 11.1716 6.82843 10.5 6 10.5C5.17157 10.5 4.5 11.1716 4.5 12C4.5 12.8284 5.17157 13.5 6 13.5ZM6 14C7.10457 14 8 13.1046 8 12C8 10.8954 7.10457 10 6 10C4.89543 10 4 10.8954 4 12C4 13.1046 4.89543 14 6 14Z"
        fill="currentColor"
      />
    </svg>
  `,point3=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M5.60561 10.1634C5.82342 9.94555 6.17658 9.94555 6.39439 10.1634L7.83664 11.6056C8.05445 11.8234 8.05445 12.1766 7.83664 12.3944L6.39439 13.8366C6.17658 14.0545 5.82342 14.0545 5.60561 13.8366L4.16336 12.3944C3.94555 12.1766 3.94555 11.8234 4.16336 11.6056L5.60561 10.1634Z"
        fill="currentColor"
      />
    </svg>
  `,point4=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.44224 12L6 10.5578L4.55776 12L6 13.4422L7.44224 12ZM6.39439 10.1634C6.17658 9.94555 5.82342 9.94555 5.60561 10.1634L4.16336 11.6056C3.94555 11.8234 3.94555 12.1766 4.16336 12.3944L5.60561 13.8366C5.82342 14.0545 6.17658 14.0545 6.39439 13.8366L7.83664 12.3944C8.05445 12.1766 8.05445 11.8234 7.83664 11.6056L6.39439 10.1634Z"
        fill="currentColor"
      />
    </svg>
  `,toggleRight=(k=!0)=>x$1`
    <svg
      xmlns="http://www.w3.org/2000/svg"
      data-is-toggle-icon="true"
      width="1em"
      height="1em"
      viewBox="0 0 20 20"
    >
      <path
        data-is-toggle-icon="true"
        fill="currentColor"
        opacity="${k?"1":"0.6"}"
        d="m15.795 11.272l-8 5A1.5 1.5 0 0 1 5.5 15V5a1.5 1.5 0 0 1 2.295-1.272l8 5a1.5 1.5 0 0 1 0 2.544Z"
      />
    </svg>
  `,toggleDown=()=>x$1`
    <svg
      xmlns="http://www.w3.org/2000/svg"
      data-is-toggle-icon="true"
      width="1em"
      height="1em"
      viewBox="0 0 20 20"
      @mousedown="${()=>{}}"
    >
      <path
        data-is-toggle-icon="true"
        fill="currentColor"
        d="m8.728 15.795l-5-8A1.5 1.5 0 0 1 5 5.5h10a1.5 1.5 0 0 1 1.272 2.295l-5 8a1.5 1.5 0 0 1-2.544 0Z"
      />
    </svg>
  `,checkboxChecked=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M3.25 6C3.25 4.48122 4.48122 3.25 6 3.25H18C19.5188 3.25 20.75 4.48122 20.75 6V18C20.75 19.5188 19.5188 20.75 18 20.75H6C4.48122 20.75 3.25 19.5188 3.25 18V6ZM16.5303 9.53033C16.8232 9.23744 16.8232 8.76256 16.5303 8.46967C16.2374 8.17678 15.7626 8.17678 15.4697 8.46967L10.5 13.4393L9.03033 11.9697C8.73744 11.6768 8.26256 11.6768 7.96967 11.9697C7.67678 12.2626 7.67678 12.7374 7.96967 13.0303L9.96967 15.0303C10.2626 15.3232 10.7374 15.3232 11.0303 15.0303L16.5303 9.53033Z"
        fill="#1E96EB"
      />
    </svg>
  `,checkboxUnchecked=()=>x$1`
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H18C18.6904 4.75 19.25 5.30964 19.25 6V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6Z"
        fill="currentColor"
      />
    </svg>
  `,playCheckAnimation=async(k,{left:_=0,size:y=20}={})=>{const w=document.createElement("div");w.classList.add("affine-check-animation"),y<20&&console.warn("If the size is less than 20, the animation may be abnormal."),w.style.cssText=`
    position: absolute;
    width: ${y}px;
    height: ${y}px;
    border-radius: 50%;
  `,w.style.left=`${_}px`,k.appendChild(w),await w.animate([{boxShadow:"0 -18px 0 -8px #1e96eb, 16px -8px 0 -8px #1e96eb, 16px 8px 0 -8px #1e96eb, 0 18px 0 -8px #1e96eb, -16px 8px 0 -8px #1e96eb, -16px -8px 0 -8px #1e96eb"}],{duration:240,easing:"ease",fill:"forwards"}).finished,await w.animate([{boxShadow:"0 -36px 0 -10px transparent, 32px -16px 0 -10px transparent, 32px 16px 0 -10px transparent, 0 36px 0 -10px transparent, -32px 16px 0 -10px transparent, -32px -16px 0 -10px transparent"}],{duration:360,easing:"ease",fill:"forwards"}).finished,w.remove()},points=[point1(),point2(),point3(),point4()];function ListIcon(k,_,y,w,$){switch(k.type){case"bulleted":return x$1`<div class="affine-list-block__prefix" @click=${$}>
        ${points[y%points.length]}
      </div>`;case"numbered":return x$1`<div
        class="affine-list-block__prefix affine-list-block__numbered"
        @click=${$}
      >
        ${getNumberPrefix(_,y)}
      </div>`;case"todo":return x$1`<div
        class="affine-list-block__prefix affine-list-block__todo-prefix"
        @click=${$}
      >
        ${k.checked?checkboxChecked():checkboxUnchecked()}
      </div>`;case"toggle":return x$1`<div class="affine-list-block__prefix" @click=${$}>
        ${w?toggleDown():toggleRight(k.children.length>0)}
      </div>`;default:return console.error("Unknown list type",k.type,k),null}}const getIndex=k=>{const _=k.page.getParent(k)?.children||[],y=_.findIndex($=>$===k);let w=0;for(let $=0;$<y;$++)_[$].flavour===k.flavour&&_[$].type===k.type?w+=1:w=0;return w},getListDeep=k=>{let _=0,y=k.page.getParent(k);for(;y?.flavour===k.flavour;)_++,y=k.page.getParent(y);return _},getListInfo=k=>{const _=getListDeep(k),y=getIndex(k);return{deep:_,index:y}};var __decorate$1s=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let ListBlockComponent=class extends BlockElement{constructor(){super(...arguments),this.showChildren=!0,this.textSchema={attributesSchema:affineTextAttributes,textRenderer:attributeRenderer},this._onClickIcon=_=>{if(_.stopPropagation(),this.model.type==="toggle"){this.showChildren=!this.showChildren;return}else if(this.model.type==="todo"){this.model.page.captureSync();const y={checked:!this.model.checked};if(this.model.page.updateBlock(this.model,y),this.model.checked){const w=this.querySelector(".affine-list-block__todo-prefix");assertExists(w),playCheckAnimation(w)}return}this._select()}}_select(){const _=this.root.selectionManager;_.update(y=>y.filter(w=>!w.is("text")&&!w.is("block")).concat(_.getInstance("block",{path:this.path})))}firstUpdated(){this.model.propsUpdated.on(()=>this.requestUpdate()),this.model.childrenUpdated.on(()=>this.requestUpdate())}connectedCallback(){super.connectedCallback(),bindContainerHotkey(this)}render(){const{deep:_,index:y}=getListInfo(this.model),{model:w,showChildren:$,_onClickIcon:B}=this,R=ListIcon(w,y,_,$,B),j=y===0&&_===0?"affine-list-block-container--first":"",q=this.model.type==="todo"&&this.model.checked?"affine-list--checked":"",X=x$1`<div
      class="affine-block-children-container"
      style="padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px"
    >
      ${this.content}
    </div>`;return x$1`
      <div class=${`affine-list-block-container ${j}`}>
        <div class=${`affine-list-rich-text-wrapper ${q}`}>
          ${R}
          <rich-text
            .yText=${this.model.text.yText}
            .undoManager=${this.model.page.history}
            .textSchema=${this.textSchema}
            .readonly=${this.model.page.readonly}
          ></rich-text>
        </div>
        ${this.showChildren?X:A}
        ${n(this.selected?.is("block"),()=>x$1`<affine-block-selection></affine-block-selection>`)}
      </div>
    `}};ListBlockComponent.styles=styles$n;__decorate$1s([t$2()],ListBlockComponent.prototype,"showChildren",void 0);ListBlockComponent=__decorate$1s([e$7("affine-list")],ListBlockComponent);function isPageComponent(k){return k.tagName==="AFFINE-DOC-PAGE"||k.tagName==="AFFINE-EDGELESS-PAGE"}const styles$m=i$5`
  :host {
    position: fixed;
    inset: 0;
    z-index: var(--affine-z-index-modal);
  }
  .overlay-mask {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: var(--affine-z-index-modal);
  }
  .modal-container {
    position: absolute;
    z-index: var(--affine-z-index-modal);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 720px;
    padding: 24px 40px;
    border-radius: 24px;
    background: var(--affine-background-overlay-panel-color);
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-header-title {
    color: var(--affine-text-primary-color);
    font-size: 20px;
    font-weight: 600;
  }
  .modal-header-close-icon {
    display: flex;
    align-items: center;
    color: var(--affine-icon-color);
    cursor: pointer;
  }
  .modal-header-close-icon svg {
    width: 24px;
    height: 24px;
  }
  .modal-footer {
    color: var(--affine-text-secondary-color);
    font-size: 14px;
    text-align: center;
  }
  .modal-body {
    padding: 24px 0;
  }
  .modal-desc {
    margin-bottom: 38px;
    color: var(--affine-text-primary-color);
    font-size: 14px;
  }
  .modal-view-container {
    display: flex;
    justify-content: center;
    gap: 18px;
  }
  .modal-view-item {
    display: flex;
    flex-direction: column;
    gap: 6px;
    cursor: pointer;
  }
  .modal-view-item.coming-soon {
    cursor: not-allowed;
  }
  .modal-view-item.coming-soon .modal-view-item-content {
    pointer-events: none;
  }
  .modal-view-item-content:hover {
    background: var(--affine-hover-color);
  }
  .modal-view-item-content:hover .modal-view-item-text,
  .modal-view-item-content:hover svg {
    fill: var(--affine-primary-color);
    color: var(--affine-primary-color);
  }
  .modal-view-item-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 18px 0;
    gap: 6px;
    width: 108px;
    border: 2px solid var(--affine-border-color);
    border-radius: 8px;
  }
  .modal-view-item-icon {
    width: 42px;
    height: 42px;
  }
  .modal-view-item-icon svg {
    width: 42px;
    height: 42px;
    fill: var(--affine-black-50);
  }
  .modal-view-item-text {
    font-size: 14px;
    color: var(--affine-black-50);
  }
  .modal-view-item-description {
    font-size: 12px;
    color: var(--affine-text-secondary-color);
    text-align: center;
  }
`;var __decorate$1r=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const databaseViews=[{type:"table",text:"Table view",icon:DatabaseTableViewIcon},{type:"kanban",text:"Kanban view",icon:DatabaseKanbanViewIcon}],AFFINE_DATABASE_CONVERT_WIDGET_TAG="affine-database-convert-widget",DATABASE_CONVERT_WHITE_LIST=["affine:list","affine:paragraph"];let AffineDatabaseConvertWidget=class extends WidgetElement{firstUpdated(){this.style.display="none"}_convertToDatabase(_){const y=this.pageElement;if(!isPageComponent(y))throw new Error("database convert widget must be hosted in page component");const w=getSelectedContentModels(y,["text","block"]);if(w.length===0)return;this.page.captureSync();const $=this.page.getParent(w[0]);assertExists($);const B=this.page.addBlock("affine:database",{},$,$.children.indexOf(w[0])),R=this.page.getBlockById(B);assertExists(R),R.initConvert(_),R.applyColumnUpdate(),this.page.moveBlocks(w,R),this.pageElement.root.selectionManager.clear(),this.style.display="none"}render(){return x$1` <div class="${AFFINE_DATABASE_CONVERT_WIDGET_TAG}">
      <div
        @click="${()=>{this.style.display="none"}}"
        class="overlay-mask"
      ></div>
      <div class="modal-container">
        <div class="modal-header">
          <div class="modal-header-title">Select Database View</div>
          <div class="modal-header-close-icon">${DatabaseSearchClose}</div>
        </div>
        <div class="modal-body">
          <div class="modal-desc">
            Group as Database can quickly convert selected blocks into Database
            for easy structuring of data.
          </div>
          <div class="modal-view-container">
            ${databaseViews.map(_=>x$1`
                <div
                  class="modal-view-item ${_.type}"
                  @click="${()=>this._convertToDatabase(_.type)}"
                >
                  <div class="modal-view-item-content">
                    <div class="modal-view-item-icon">${_.icon}</div>
                    <div class="modal-view-item-text">${_.text}</div>
                  </div>
                  <div class="modal-view-item-description">
                    ${_.description}
                  </div>
                </div>
              `)}
          </div>
        </div>
        <div class="modal-footer">More views are on the way.</div>
      </div>
    </div>`}};AffineDatabaseConvertWidget.styles=styles$m;AffineDatabaseConvertWidget=__decorate$1r([e$7(AFFINE_DATABASE_CONVERT_WIDGET_TAG)],AffineDatabaseConvertWidget);const actionConfig=[{id:"copy",name:"Copy",disabledToolTip:void 0,icon:CopyIcon,hotkey:void 0,showWhen:()=>!0,enabledWhen:()=>!0,action:k=>{copyBlocksInPage(k),toast("Copied to clipboard")}},{id:"convert-to-database",name:"Group as Database",disabledToolTip:"Contains Block types that cannot be converted to Database",icon:DatabaseTableViewIcon20,hotkey:"Mod-g",showWhen:k=>{const _=getSelectedContentModels(k,["text","block"]);if(_.length===0)return!1;const y=_[0];return assertExists(y),!matchFlavours(y,["affine:database"])},enabledWhen:k=>{const $=k.root.selectionManager.value.filter(B=>B instanceof BlockSelection$1).map(B=>k.page.getBlockById(B.blockId)).filter(B=>!!B);return $.length===0?!1:$.every(B=>DATABASE_CONVERT_WHITE_LIST.includes(B.flavour))},action:k=>{const _=k.root.viewStore.viewFromPath("widget",k.path.concat(AFFINE_DATABASE_CONVERT_WIDGET_TAG));assertExists(_),_.style.display="block"}}],moveBlockConfig=[{name:"Move Up",hotkey:["Mod-Alt-ArrowUp","Mod-Shift-ArrowUp"],action:k=>{const _=getTextSelection(k);if(_){const w=pathToBlock(k,_.from.path);if(!w)return;const $=getPrevBlock(w,R=>!!R.model.text);if(!$)return;const B=k.page.getParent($.model);return B?(k.page.moveBlocks([w.model],B,$.model,!0),!0):void 0}const y=getBlockSelectionBySide(k,!0);if(y){const w=pathToBlock(k,y.path);if(!w)return;const $=getPrevBlock(w);if(!$)return;const B=k.page.getParent($.model);return!B||B.flavour==="affine:page"?void 0:(k.page.moveBlocks([w.model],B,$.model,!0),!0)}}},{name:"Move Down",hotkey:["Mod-Alt-ArrowDown","Mod-Shift-ArrowDown"],action:k=>{const _=getTextSelection(k);if(_){const w=pathToBlock(k,_.from.path);if(!w)return;const $=getNextBlock(w,R=>!!R.model.text);if(!$)return;const B=k.page.getParent($.model);return B?(k.page.moveBlocks([w.model],B,$.model,!1),!0):void 0}const y=getBlockSelectionBySide(k,!0);if(y){const w=pathToBlock(k,y.path);if(!w)return;const $=getNextBlock(w);if(!$)return;const B=k.page.getParent($.model);return B?(k.page.moveBlocks([w.model],B,$.model,!1),!0):void 0}}}],paragraphConfig=[{flavour:"affine:paragraph",type:"text",name:"Text",hotkey:["Mod-Alt-0","Mod-Shift-0"],icon:TextIcon},{flavour:"affine:paragraph",type:"h1",name:"Heading 1",hotkey:["Mod-Alt-1","Mod-Shift-1"],icon:Heading1Icon},{flavour:"affine:paragraph",type:"h2",name:"Heading 2",hotkey:["Mod-Alt-2","Mod-Shift-2"],icon:Heading2Icon},{flavour:"affine:paragraph",type:"h3",name:"Heading 3",hotkey:["Mod-Alt-3","Mod-Shift-3"],icon:Heading3Icon},{flavour:"affine:paragraph",type:"h4",name:"Heading 4",hotkey:["Mod-Alt-4","Mod-Shift-4"],icon:Heading4Icon},{flavour:"affine:paragraph",type:"h5",name:"Heading 5",hotkey:["Mod-Alt-5","Mod-Shift-5"],icon:Heading5Icon},{flavour:"affine:paragraph",type:"h6",name:"Heading 6",hotkey:["Mod-Alt-6","Mod-Shift-6"],icon:Heading6Icon},{flavour:"affine:list",type:"bulleted",name:"Bulleted List",hotkey:["Mod-Alt-8","Mod-Shift-8"],icon:BulletedListIcon},{flavour:"affine:list",type:"numbered",name:"Numbered List",hotkey:["Mod-Alt-9","Mod-Shift-9"],icon:NumberedListIcon},{flavour:"affine:list",type:"todo",name:"To-do List",hotkey:null,icon:CheckBoxIcon},{flavour:"affine:code",type:void 0,name:"Code Block",hotkey:["Mod-Alt-c"],icon:CodeBlockIcon},{flavour:"affine:paragraph",type:"quote",name:"Quote",hotkey:null,icon:QuoteIcon},{flavour:"affine:divider",type:"divider",name:"Divider",hotkey:["Mod-Alt-d","Mod-Shift-d"],icon:DividerIcon}],bindHotKey=k=>{let _=null,y=null,w=!1;const $=()=>{_=null,y=null};k.handleEvent("keyDown",B=>{B.get("keyboardState").raw.key!=="Shift"&&$()}),k.handleEvent("compositionStart",()=>{w=!0}),k.handleEvent("compositionEnd",()=>{w=!1}),k.bindHotKey({ArrowDown:()=>{if($(),w)return!0;const B=getTextSelection(k);if(B){const q=B.to??B.from,X=pathToBlock(k,q.path);if(!X)return;const ee=getNextBlock(X,te=>!!te.model.text);return ee?(moveCursorToNextBlockElement(ee),!0):void 0}const R=getBlockSelectionBySide(k,!0);if(!R)return;const H=pathToBlock(k,R.path);if(!H)return;const j=getNextBlock(H);if(!(!j||!ensureBlockInContainer(j,k)))return setBlockSelection(j),!0},ArrowUp:()=>{if($(),w)return!0;const B=getTextSelection(k);if(B){const q=B.from,X=pathToBlock(k,q.path);if(!X)return;const ee=getPrevBlock(X,te=>!!te.model.text);return ee?(moveCursorToPrevBlockElement(ee),!0):void 0}const R=getBlockSelectionBySide(k,!1);if(!R)return;const H=pathToBlock(k,R.path);if(!H)return;const j=getPrevBlock(H);if(!(!j||!ensureBlockInContainer(j,k)))return setBlockSelection(j),!0},ArrowLeft:()=>{if($(),w)return!0;const B=getTextSelection(k);if(!B)return;const R=B.from,H=pathToBlock(k,R.path);if(!H)return;const j=getPrevBlock(H,q=>!!q.model.text);if(j)return setTextSelectionBySide(j,!0),!0},ArrowRight:()=>{if($(),w)return!0;const B=getTextSelection(k);if(!B)return;const R=B.to??B.from,H=pathToBlock(k,R.path);if(!H)return;const j=getNextBlock(H,q=>!!q.model.text);if(j)return setTextSelectionBySide(j,!1),!0},"Shift-ArrowDown":()=>{if(_||(_=getBlockSelectionBySide(k,!0)),!_)return null;const B=pathToBlock(k,_.path);if(!B)return null;if(y=getNextBlock(y??B),!!y&&ensureBlockInContainer(y,k))return selectBetween(B,y,!0),!0},"Shift-ArrowUp":()=>{if(_||(_=getBlockSelectionBySide(k,!1)),!_)return null;const B=pathToBlock(k,_.path);if(!B)return null;if(y=getPrevBlock(y??B),!!y&&ensureBlockInContainer(y,k))return selectBetween(B,y,!1),!0},Escape:()=>getBlockSelectionBySide(k,!0)?(k.root.selectionManager.update(H=>H.filter(j=>!j.is("block"))),!0):void 0,Enter:()=>{const B=getBlockSelectionBySide(k,!0);if(!B)return;const R=k.root.viewStore.viewFromPath("block",B.path);if(!R)return;const H=k.page,{model:j}=R,q=H.getParent(j);if(!q)return;const X=q.children.indexOf(j)??void 0,ee=H.addBlock("affine:paragraph",{},q,X+1),te=R.root.selectionManager,ne=te.getInstance("text",{from:{path:R.parentPath.concat(ee),index:0,length:0},to:null});return te.update(oe=>oe.filter(ie=>!ie.is("block")).concat(ne)),!0},"Mod-a":B=>{B.get("defaultState").event.preventDefault();const R=k.root.viewStore,H=k.root.selectionManager,j=[];R.walkThrough(q=>(q.type==="block"&&j.push(H.getInstance("block",{path:q.path})),null),k.path),H.update(q=>q.filter(X=>!X.is("block")).concat(j))}}),actionConfig.forEach(B=>{B.hotkey&&k.bindHotKey({[B.hotkey]:R=>{const H=k.closest("affine-doc-page,affine-edgeless-page");H&&B.showWhen(H)&&(R.get("defaultState").event.preventDefault(),B.action(H))}})}),paragraphConfig.forEach(B=>{B.hotkey&&B.hotkey.forEach(R=>{k.bindHotKey({[R]:H=>{const j=k.root.selectionManager;H.get("defaultState").event.preventDefault();const q=getSelectedContentBlockElements(k,["text","block"]),X=updateBlockElementType(q,B.flavour,B.type);if(B.flavour!=="affine:code")return;const[ee]=X;return onModelElementUpdated(ee,()=>{const te=getBlockElementByModel(ee);assertExists(te),j.setGroup("note",[new TextSelection({from:{path:te.path,index:0,length:ee.text?.length??0},to:null})])}),!0}})})}),moveBlockConfig.forEach(B=>{B.hotkey.forEach(R=>{k.bindHotKey({[R]:H=>{H.get("defaultState").event.preventDefault(),B.action(k)}})})})};var __decorate$1q=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NoteBlockComponent=class extends BlockElement{connectedCallback(){super.connectedCallback(),bindHotKey(this)}firstUpdated(){this._disposables.add(this.model.propsUpdated.on(()=>this.requestUpdate())),this._disposables.add(this.model.childrenUpdated.on(()=>this.requestUpdate()))}render(){return x$1`
      <div class="affine-note-block-container">
        <div class="affine-block-children-container">${this.content}</div>
      </div>
    `}};NoteBlockComponent.styles=i$5`
    .affine-note-block-container {
      display: flow-root;
    }
    .affine-note-block-container.selected {
      background-color: var(--affine-hover-color);
    }
  `;NoteBlockComponent=__decorate$1q([e$7("affine-note")],NoteBlockComponent);var __decorate$1p=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DividerBlockComponent=class extends BlockElement{connectedCallback(){super.connectedCallback()}firstUpdated(){this.model.propsUpdated.on(()=>this.requestUpdate()),this.model.childrenUpdated.on(()=>this.requestUpdate())}render(){const _=x$1`<div
      class="affine-block-children-container"
      style="padding-left: ${BLOCK_CHILDREN_CONTAINER_PADDING_LEFT}px"
    >
      ${this.content}
    </div>`;return x$1`
      <div class="affine-divider-block-container">
        <hr />
        ${_}
        ${this.selected?.is("block")?x$1`<affine-block-selection></affine-block-selection>`:null}
      </div>
    `}};DividerBlockComponent.styles=i$5`
    .affine-divider-block-container {
      position: relative;
      width: 100%;
      height: 1px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 18px 8px;
      margin-top: var(--affine-paragraph-space);
    }
    hr {
      border: none;
      border-top: 1px solid var(--affine-divider-color);
      width: 100%;
    }
  `;DividerBlockComponent=__decorate$1p([e$7("affine-divider")],DividerBlockComponent);var __decorate$1o=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function affineTextStyles(k,_){let y="";k.underline&&(y+="underline"),k.strike&&(y+=" line-through");let w={};return k.code&&(w={"font-family":"var(--affine-font-code-family)",background:"var(--affine-background-code-block)",color:"var(--affine-text-primary-color)","border-radius":"4px",padding:"3px 6px","font-variant-ligatures":"none","line-height":"var(--affine-font-base)",border:"1px solid var(--affine-border-color)"}),o$4({"font-weight":k.bold?"bold":"normal","font-style":k.italic?"italic":"normal","background-color":k.background?k.background:void 0,"text-decoration":y.length>0?y:"none",...w,..._})}let AffineText=class extends ShadowlessElement{constructor(){super(...arguments),this.delta={insert:ZERO_WIDTH_SPACE}}render(){const _=this.delta.attributes?affineTextStyles(this.delta.attributes):o$4({});return this.delta.attributes?.code?x$1`<code style=${_}
        ><v-text .str=${this.delta.insert}></v-text
      ></code>`:x$1`<span style=${_}
      ><v-text .str=${this.delta.insert}></v-text
    ></span>`}};AffineText.styles=i$5`
    affine-text {
      white-space: break-spaces;
      word-break: break-word;
    }
  `;__decorate$1o([n$a({type:Object})],AffineText.prototype,"delta",void 0);AffineText=__decorate$1o([e$7("affine-text")],AffineText);var __decorate$1n=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AffineLink=class extends ShadowlessElement{get link(){const _=this.delta.attributes?.link;return _||""}constructor(){super(),this.delta={insert:ZERO_WIDTH_SPACE},this.popoverHoverOpenDelay=150,this._popoverTimer=0,this._isHovering=!1,this.addEventListener("mouseenter",this.onHover),this.addEventListener("mouseleave",this._onHoverEnd)}onHover(_){this._isHovering||(this._isHovering=!0,getModelByElement(this).page.readonly)||(this._popoverTimer=window.setTimeout(()=>{this.onDelayHover(_)},this.popoverHoverOpenDelay))}async onDelayHover(_){if(!(_.target instanceof HTMLElement)||!document.contains(_.target))return;const y=getModelByElement(this),w=this.delta.insert,$=await showLinkPopover({anchorEl:_.target,model:y,text:w,link:this.link,showMask:!1,interactionKind:"hover"});if($.type==="confirm"){const B=$.link,R=$.text,H=R!==w;this._updateLink(B,H?R:void 0);return}if($.type==="remove"){this._updateLink();return}if($.type==="toBookmark"){this._onConvertToBookmark();return}}_updateLink(_,y){const w=getModelByElement(this),{page:$}=w,B=this.delta.insert,R=this.delta.attributes,H=this.querySelector('[data-virgo-text="true"]');assertExists(H);const j=Array.from(H.childNodes).find(te=>te instanceof Text);assertExists(j);const q=this.closest("rich-text");assertExists(q);const X=VEditor.textPointToDomPoint(j,0,q.virgoContainer);assertExists(X);const ee=q.vEditor;if(assertExists(ee),_)y?($.captureSync(),ee.deleteText({index:X.index,length:j.length}),ee.insertText({index:X.index,length:0},y),ee.formatText({index:X.index,length:y.length},{link:_})):($.captureSync(),ee.formatText({index:X.index,length:B.length},{link:_}));else{$.captureSync();const te={...R};delete te.link,ee.formatText({index:X.index,length:B.length},te,{mode:"replace"})}}_onConvertToBookmark(){const _=getModelByElement(this),{page:y}=_,w=this.querySelector('[data-virgo-text="true"]');assertExists(w);const $=Array.from(w.childNodes).find(X=>X instanceof Text);assertExists($);const B=this.closest("rich-text");assertExists(B);const R=VEditor.textPointToDomPoint($,0,B.virgoContainer);assertExists(R);const H=B.vEditor;assertExists(H);const j=y.getParent(_);assertExists(j);const q=j.children.indexOf(_);y.addBlock("affine:bookmark",{url:this.link,title:this.delta.insert},j,q+1),H.deleteText({index:R.index,length:$.length})}_onHoverEnd(){this._isHovering=!1,clearTimeout(this._popoverTimer)}_onMouseUp(){const _=this.querySelector("a");assertExists(_),_.isContentEditable&&(_.contentEditable="false",setTimeout(()=>{_.removeAttribute("contenteditable")},0))}render(){const _=this.delta.attributes?affineTextStyles(this.delta.attributes):o$4({});return x$1`<a
      href=${this.link}
      rel="noopener noreferrer"
      target="_blank"
      style=${_}
      @mouseup=${this._onMouseUp}
      ><v-text .str=${this.delta.insert}></v-text
    ></a>`}};AffineLink.styles=i$5`
    affine-link > a {
      white-space: nowrap;
      word-break: break-word;
      color: var(--affine-link-color);
      fill: var(--affine-link-color);
      text-decoration: none;
      cursor: pointer;
    }

    affine-link > a:hover [data-virgo-text='true'] {
      text-decoration: underline;
    }

    affine-link > a > v-text {
      white-space: break-spaces;
    }
  `;__decorate$1n([n$a({type:Object})],AffineLink.prototype,"delta",void 0);__decorate$1n([n$a({attribute:!1})],AffineLink.prototype,"popoverHoverOpenDelay",void 0);__decorate$1n([t$2()],AffineLink.prototype,"_popoverTimer",void 0);AffineLink=__decorate$1n([e$7("affine-link")],AffineLink);var __decorate$1m=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AffineReference=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.delta={insert:ZERO_WIDTH_SPACE,attributes:{}},this.selected=!1,this._refAttribute={type:"LinkedPage",pageId:"0"},this._updateRefMeta=_=>{const y=this.delta.attributes?.reference;assertExists(y,"Failed to get reference attribute!"),this._refAttribute=y;const w=_.workspace.meta.pageMetas.find($=>$.id===y.pageId);this._refMeta=w?{...w}:void 0}}connectedCallback(){super.connectedCallback(),this.delta.insert!==REFERENCE_NODE&&console.error(`Reference node must be initialized with '${REFERENCE_NODE}', but got '${this.delta.insert}'`);const _=getModelByElement(this),y=_.page;this._updateRefMeta(y),this._disposables.add(_.page.workspace.slots.pagesUpdated.on(()=>this._updateRefMeta(y)))}_onClick(){const _=this._refMeta,y=getModelByElement(this);if(!_){console.warn("The page is deleted",this._refAttribute.pageId);return}if(_.id===y.page.id)return;const w=_.id,$=y.page.root;assertExists($);const B=getBlockElementById($?.id);assertExists(B),B.slots.pageLinkClicked.emit({pageId:w})}render(){const _=this._refMeta,y=!_,w=y?"Deleted page":_.title,$=this.delta.attributes;assertExists($,"Failed to get attributes!");const B=$.reference?.type;assertExists(B,"Unable to get reference type!");const R=affineTextStyles($,y?{color:"var(--affine-text-disable-color)",textDecoration:"line-through",fill:"var(--affine-text-disable-color)"}:{});return x$1`<span
      data-selected=${this.selected}
      class="affine-reference"
      style=${R}
      @click=${this._onClick}
      >${B==="LinkedPage"?FontLinkedPageIcon:FontPageIcon}<span
        data-title=${w||DEFAULT_PAGE_NAME$1}
        class="affine-reference-title"
        >${w||DEFAULT_PAGE_NAME$1}</span
      ><v-text .str=${ZERO_WIDTH_NON_JOINER}></v-text
    ></span>`}};AffineReference.styles=i$5`
    .affine-reference {
      white-space: nowrap;
      word-break: break-word;
      color: var(--affine-text-primary-color);
      fill: var(--affine-icon-color);
      border-radius: 4px;
      text-decoration: none;
      cursor: pointer;
      user-select: none;
      padding: 1px 4px 1px 2px;
      margin: 0 2px;
    }
    .affine-reference:hover {
      background: var(--affine-hover-color);
    }

    .affine-reference[data-selected='true'] {
      background: var(--affine-hover-color);
    }

    .affine-reference-title {
      margin-left: 4px;
      border-bottom: 0.5px solid var(--affine-divider-color);
      transition: border 0.2s ease-out;
    }
    .affine-reference-title:hover {
      border-bottom: 0.5px solid var(--affine-icon-color);
    }

    .affine-reference > span {
      white-space: break-spaces;
    }
  `;__decorate$1m([n$a({type:Object})],AffineReference.prototype,"delta",void 0);__decorate$1m([n$a({type:Boolean})],AffineReference.prototype,"selected",void 0);__decorate$1m([t$2()],AffineReference.prototype,"_refMeta",void 0);AffineReference=__decorate$1m([e$7("affine-reference")],AffineReference);class LRUCache{constructor(_){this.maxSize=_,this.cache=new Map}get(_){const y=this.cache.get(_);return y===void 0?null:(this.cache.delete(_),this.cache.set(_,y),y)}set(_,y){if(this.cache.size>=this.maxSize){const w=this.cache.keys().next().value;this.cache.delete(w)}this.cache.set(_,y)}}const highlightCache=new LRUCache(100);var __decorate$1l=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AffineCodeLine=class extends ShadowlessElement{constructor(){super(...arguments),this.delta={insert:ZERO_WIDTH_SPACE},this.highlightOptionsGetter=null}render(){assertExists(this.highlightOptionsGetter,"highlightOptionsGetter is not set");const{lang:_,highlighter:y}=this.highlightOptionsGetter();if(!y||!y.getLoadedLanguages().includes(_))return x$1`<span
        ><v-text
          .str=${this.delta.insert}
          .styles=${{"word-wrap":"break-word"}}
        ></v-text
      ></span>`;const w=queryCurrentMode(),$=`${this.delta.insert}-${_}-${w}`,B=highlightCache.get($);let R=[{content:this.delta.insert}];B?R=B:(R=y.codeToThemedTokens(this.delta.insert,_,w==="dark"?DARK_THEME:LIGHT_THEME)[0],highlightCache.set($,R));const H=R.map(j=>x$1`<v-text
        .str=${j.content}
        .styles=${{"word-wrap":"break-word",color:j.color}}
      ></v-text>`);return x$1`<span>${H}</span>`}};__decorate$1l([n$a({type:Object})],AffineCodeLine.prototype,"delta",void 0);__decorate$1l([n$a({attribute:!1})],AffineCodeLine.prototype,"highlightOptionsGetter",void 0);AffineCodeLine=__decorate$1l([e$7("affine-code-line")],AffineCodeLine);var __decorate$1k=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const notFoundIcon=x$1`<svg
  width="25"
  height="24"
  viewBox="0 0 25 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M14.5 3H8.3C6.61984 3 5.77976 3 5.13803 3.32698C4.57354 3.6146 4.1146 4.07354 3.82698 4.63803C3.5 5.27976 3.5 6.11984 3.5 7.8V16.2C3.5 17.8802 3.5 18.7202 3.82698 19.362C4.1146 19.9265 4.57354 20.3854 5.13803 20.673C5.77976 21 6.61984 21 8.3 21H12.5L15.5 18L11.5 14L12.8418 12.6582C12.8197 12.6391 12.7979 12.6205 12.7762 12.6022C12.4696 12.3444 12.1366 12.1162 11.7278 11.987C11.1185 11.7945 10.4637 11.8016 9.85866 12.0072C9.45274 12.1452 9.12474 12.3806 8.82383 12.645C8.82383 12.645 6.60291 14.8415 5.5 15.9308V6.6C5.5 6.03995 5.5 5.75992 5.60899 5.54601C5.70487 5.35785 5.85785 5.20487 6.04601 5.10899C6.25992 5 6.53995 5 7.1 5H12.5L14.5 3ZM13.304 7.80408C13.1102 8.15931 13 8.56677 13 9C13 9.94759 13.5271 10.7719 14.3041 11.1959L15.5 10L13.304 7.80408ZM15.4156 11.4986L16.9142 10L13.9514 7.03724C14.3773 6.7008 14.9152 6.5 15.5 6.5C16.8806 6.5 18 7.61914 18 9C18 10.3809 16.8806 11.5 15.5 11.5C15.4718 11.5 15.4437 11.4995 15.4156 11.4986ZM13.5691 13.3451C13.6352 13.4103 13.7029 13.4775 13.7724 13.5464L14.7645 14.5302C15.0059 14.2937 15.2246 14.0861 15.4261 13.9167C15.7329 13.6587 16.0663 13.4302 16.4756 13.3011C17.0855 13.1087 17.7409 13.1162 18.3463 13.3226C18.7524 13.4611 19.0805 13.6971 19.3813 13.9622C19.4202 13.9965 19.4598 14.0322 19.5 14.0694V6.6C19.5 6.03995 19.5 5.75992 19.391 5.54601C19.2951 5.35785 19.1422 5.20487 18.954 5.10899C18.7401 5 18.4601 5 17.9 5H13.9143L15.9143 3H16.7C18.3802 3 19.2202 3 19.862 3.32698C20.4265 3.6146 20.8854 4.07354 21.173 4.63803C21.5 5.27976 21.5 6.11984 21.5 7.8V16.2C21.5 17.8802 21.5 18.7202 21.173 19.362C20.8854 19.9265 20.4265 20.3854 19.862 20.673C19.2202 21 18.3802 21 16.7 21H13.9143L16.9142 18L12.9142 14L13.5691 13.3451Z"
    fill="#6880FF"
  />
</svg>`,ELEMENT_TAG$2="affine-image-block-not-found-card";let AffineImageBlockNotFoundCard=class extends ShadowlessElement{render(){return x$1`
      <div class="affine-image-block-not-found-card">${notFoundIcon}</div>
    `}};AffineImageBlockNotFoundCard.styles=i$5`
    .affine-image-block-not-found-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      margin: 0 auto;
      border: 1px solid var(--affine-border-color);
      border-radius: 10px;
      background: var(--affine-background-primary-color);
    }
  `;AffineImageBlockNotFoundCard=__decorate$1k([e$7(ELEMENT_TAG$2)],AffineImageBlockNotFoundCard);var __decorate$1j=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const ELEMENT_TAG$1="affine-image-block-circle-loading";let AffineImageBlockCircleLoading=class extends ShadowlessElement{render(){return x$1`<div class="affine-image-block-container">
      <div class="affine-image-block-loading"></div>
    </div>`}};AffineImageBlockCircleLoading.styles=i$5`
    @keyframes affine-image-block-rotate {
      from {
        rotate: 0deg;
      }
      to {
        rotate: 360deg;
      }
    }

    .affine-image-block-container {
      width: 24px;
      height: 24px;
      overflow: hidden;
    }

    .affine-image-block-loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      position: relative;
      background: conic-gradient(rgba(255, 255, 255, 0.31), #6880ff);
      border-radius: 50%;
      animation: affine-image-block-rotate 1s infinite ease-in;
    }

    .affine-image-block-loading::before {
      content: '';
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      top: 2px;
      left: 2px;
    }
  `;AffineImageBlockCircleLoading=__decorate$1j([e$7(ELEMENT_TAG$1)],AffineImageBlockCircleLoading);var __decorate$1i=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const ELEMENT_TAG="affine-image-block-loading-card";let AffineImageBlockLoadingCard=class extends ShadowlessElement{constructor(){super(...arguments),this.content="Loading content..."}render(){return x$1`
      <div class="affine-image-block-loading-card">
        <affine-image-block-circle-loading></affine-image-block-circle-loading>
        <div class="affine-image-block-content">${this.content}</div>
      </div>
    `}};AffineImageBlockLoadingCard.styles=i$5`
    .affine-image-block-loading-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      margin: 0 auto;
      border: 1px solid #ebeeff;
      border-radius: 10px;
      background: #fbfbff;
    }

    .affine-image-block-content {
      height: 30px;
      line-height: 22px;
      padding-top: 8px;
      color: var(--affine-primary-color);
      font-size: 16px;
      font-weight: 400;
    }
  `;__decorate$1i([n$a()],AffineImageBlockLoadingCard.prototype,"content",void 0);AffineImageBlockLoadingCard=__decorate$1i([e$7(ELEMENT_TAG)],AffineImageBlockLoadingCard);var __decorate$1h=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let Portal=class extends s$2{constructor(){super(...arguments),this.container=document.body,this.template=x$1``,this._portalRoot=null}disconnectedCallback(){super.disconnectedCallback(),this._portalRoot?.remove()}createRenderRoot(){const _=document.createElement("div");return _.classList.add("blocksuite-portal"),this.container.append(_),this._portalRoot=_,_}render(){return this.template}};__decorate$1h([n$a({attribute:!1})],Portal.prototype,"container",void 0);__decorate$1h([n$a({attribute:!1})],Portal.prototype,"template",void 0);Portal=__decorate$1h([e$7("blocksuite-portal")],Portal);function createSimplePortal({template:k,container:_=document.body,abortController:y=new AbortController,renderOptions:w,shadowDom:$=!0,identifyWrapper:B=!0}){const R=document.createElement("div");B&&R.classList.add("blocksuite-portal"),$&&R.attachShadow({mode:"open"}),y.signal.addEventListener("abort",()=>{R.remove()});const H=$?R.shadowRoot:R;assertExists(H);let j=0;const q=X=>{if(X!==j){console.warn("Potentially infinite recursion! Please clean up the old event listeners before `updatePortal`");return}j++;const ee=j,te=k instanceof Function?k({updatePortal:()=>q(ee)}):k;assertExists(te),D(te,H,w)};return q(j),_.append(R),R}function createLitPortal({computePosition:k,abortController:_=new AbortController,...y}){const w=new Slot,$=y.template,B=$ instanceof Function?({updatePortal:H})=>$({updatePortal:H,positionSlot:w}):$,R=createSimplePortal({...y,abortController:_,template:B});if(k){R.style.position="fixed",R.style.left="0",R.style.top="0";const{referenceElement:H,...j}=k,q=k.autoUpdate??{},X=()=>{k.abortWhenRefRemoved!==!1&&H instanceof Element&&!H.isConnected&&_.abort(),computePosition(H,R,j).then(ee=>{const{x:te,y:ne}=ee;R.style.left=`${te}px`,R.style.top=`${ne}px`,w.emit(ee)})};if(!q)X();else{const te=autoUpdate(H,R,X,q===!0?{}:q);_.signal.addEventListener("abort",()=>{te()})}}return R}async function getImageBlob(k){const _=await getBlobByModel(k);if(!_)return null;if(!_.type){const y=await __vitePreload(()=>import("./browser.74188053.js").then(B=>B.b),["static/browser.74188053.js","static/_commonjsHelpers.de833af9.js"]);window.Buffer===void 0&&(window.Buffer=buffer.Buffer);const w=await _.arrayBuffer(),$=await y.fromBuffer(w);return $?.mime.match(/^image\/(gif|png|jpe?g)$/)?new Blob([w],{type:$.mime}):null}return _}function convertToString(k){return new Promise(_=>{const y=new FileReader;y.addEventListener("load",w=>_(y.result)),y.addEventListener("error",()=>_(null)),y.readAsDataURL(k)})}function convertToPng(k){return new Promise(_=>{const y=new FileReader;y.addEventListener("load",w=>{const $=new Image;$.onload=()=>{const B=document.createElement("canvas");B.width=$.width,B.height=$.height;const R=B.getContext("2d");assertExists(R),R.drawImage($,0,0),B.toBlob(_,"image/png")},$.onerror=()=>_(null),$.src=y.result}),y.addEventListener("error",()=>_(null)),y.readAsDataURL(k)})}async function copyImage(k){let _=await getImageBlob(k);if(_)try{if(window.apis?.clipboard?.copyAsImageFromString){const y=await convertToString(_);if(!y)throw new Error("Cant convert a blob to data URL.");await window.apis.clipboard?.copyAsImageFromString(y)}else{if(_.type!=="image/png"&&(_=await convertToPng(_)),!_)return;await navigator.clipboard.write([new ClipboardItem({[_.type]:_})])}toast("Copied image to clipboard")}catch(y){console.error(y)}}async function downloadImage(k){const _=await getImageBlob(k);_&&downloadBlob(_,"image")}function focusCaption(k){const _=getBlockElementByModel(k);assertExists(_);const y=_.querySelector(".affine-embed-wrapper-caption");y.classList.add("caption-show"),y.focus()}async function getBlobByModel(k){return assertExists(k.sourceId),await k.page.blobs.get(k.sourceId)}function ImageOptionsTemplate({anchor:k,model:_,blob:y,abortController:w}){const{onHover:$,onHoverLeave:B}=createDelayHoverSignal(w);return k.addEventListener("mouseover",$),k.addEventListener("mouseleave",B),w.signal.addEventListener("abort",()=>{k.removeEventListener("mouseover",$),k.removeEventListener("mouseleave",B)}),x$1`
    <style>
      .affine-embed-editing-state-container > div {
        display: block;
        z-index: var(--affine-z-index-popover);
      }

      .embed-editing-state {
        box-sizing: border-box;
        box-shadow: var(--affine-shadow-2);
        border-radius: 8px;
        list-style: none;
        padding: 4px;
        background-color: var(--affine-background-overlay-panel-color);
        margin: 0;
      }
      .has-tool-tip.delete-image-button:hover {
        background: var(--affine-background-error-color);
        fill: var(--affine-error-color);
        color: var(--affine-error-color);
      }
      ${tooltipStyle}
    </style>

    <div
      class="affine-embed-editing-state-container"
      @pointerdown=${stopPropagation}
      @mouseover=${$}
      @mouseout=${B}
    >
      <div class="embed-editing-state">
        <icon-button
          class="has-tool-tip"
          size="32px"
          @click=${()=>{w.abort(),turnImageIntoCardView(_,y)}}
        >
          ${BookmarkIcon}
          <tool-tip inert role="tooltip">Turn into Card view</tool-tip>
        </icon-button>
        <icon-button
          class="has-tool-tip"
          size="32px"
          @click=${()=>focusCaption(_)}
        >
          ${CaptionIcon}
          <tool-tip inert tip-position="right" role="tooltip">Caption</tool-tip>
        </icon-button>
        <icon-button
          class="has-tool-tip"
          size="32px"
          @click=${()=>downloadImage(_)}
        >
          ${DownloadIcon}
          <tool-tip inert tip-position="right" role="tooltip"
            >Download</tool-tip
          >
        </icon-button>
        <icon-button
          class="has-tool-tip"
          size="32px"
          @click=${()=>copyImage(_)}
        >
          ${CopyIcon}
          <tool-tip inert tip-position="right" role="tooltip"
            >Copy to clipboard</tool-tip
          >
        </icon-button>
        <icon-button
          class="has-tool-tip delete-image-button"
          size="32px"
          @click="${()=>{w.abort(),_.page.deleteBlock(_)}}"
        >
          ${DeleteIcon}
          <tool-tip inert tip-position="right" role="tooltip">Delete</tool-tip>
        </icon-button>
      </div>
    </div>
  `}class ImageResizeManager{constructor(){this._activeComponent=null,this._imageContainer=null,this._imageCenterX=0,this._dragMoveTarget="right",this._zoom=1}onStart(_){const y=_.raw.target;this._activeComponent=getClosestBlockElementByElement(y);const w=getClosestPageBlockComponent(this._activeComponent);w&&isEdgelessPage(w)?this._zoom=w.surface.viewport.zoom:this._zoom=1,this._imageContainer=y.closest(".resizable-img"),assertExists(this._imageContainer);const $=this._imageContainer.getBoundingClientRect();this._imageCenterX=$.left+$.width/2,y.className.includes("right")?this._dragMoveTarget="right":this._dragMoveTarget="left"}onMove(_){assertExists(this._activeComponent);const y=this._activeComponent,w=this._imageContainer;assertExists(w);const $=y.querySelector("img");assertExists($);let B=0;this._dragMoveTarget==="right"?B=(_.raw.pageX-this._imageCenterX)*2:B=(this._imageCenterX-_.raw.pageX)*2;const R=50;B<R&&(B=R),B>y.getBoundingClientRect().width&&(B=y.getBoundingClientRect().width);const H=B*($.naturalHeight/$.naturalWidth),j=w.getBoundingClientRect();j.width===B&&j.height===H||requestAnimationFrame(()=>{w.style.width=(B/this._zoom).toFixed(2)+"px",w.style.height=(H/this._zoom).toFixed(2)+"px"})}onEnd(){assertExists(this._activeComponent),assertExists(this._imageContainer);const _=getModelByElement(this._activeComponent);_.page.captureSync();const{width:y,height:w}=this._imageContainer.getBoundingClientRect();_.page.updateBlock(_,{width:y/this._zoom,height:w/this._zoom})}}function ImageSelectedRectsContainer(){return x$1`
    <style>
      .affine-page-selected-embed-rects-container {
        position: absolute;
        border: 2px solid var(--affine-primary-color);
        left: 0;
        top: 0;
        width: 100%;
        height: calc(100% + 1px);
        user-select: none;
        pointer-events: none;
        box-sizing: border-box;
        line-height: 0;
      }

      .affine-page-selected-embed-rects-container .resize {
        position: absolute;
        padding: 5px;
        pointer-events: auto;
        z-index: 1;
      }

      .affine-page-selected-embed-rects-container .resize-inner {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: white;
        border: 2px solid var(--affine-primary-color);
        pointer-events: none;
      }

      .affine-page-selected-embed-rects-container .resize.top-left {
        left: 0;
        top: 0;
        transform: translate(-50%, -50%);
        cursor: nwse-resize; /*resizer cursor*/
      }
      .affine-page-selected-embed-rects-container .resize.top-right {
        right: 0;
        top: 0;
        transform: translate(50%, -50%);
        cursor: nesw-resize;
      }
      .affine-page-selected-embed-rects-container .resize.bottom-left {
        left: 0;
        bottom: 0;
        transform: translate(-50%, 50%);
        cursor: nesw-resize;
      }
      .affine-page-selected-embed-rects-container .resize.bottom-right {
        right: 0;
        bottom: 0;
        transform: translate(50%, 50%);
        cursor: nwse-resize;
      }
    </style>
    <div class="affine-page-selected-embed-rects-container resizable resizes">
      <div class="resize top-left">
        <div class="resize-inner"></div>
      </div>
      <div class="resize top-right">
        <div class="resize-inner"></div>
      </div>
      <div class="resize bottom-left">
        <div class="resize-inner"></div>
      </div>
      <div class="resize bottom-right">
        <div class="resize-inner"></div>
      </div>
    </div>
  `}var __decorate$1g=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},ImageBlockComponent_1;let ImageBlockComponent=ImageBlockComponent_1=class extends BlockElement{constructor(){super(...arguments),this._imageState="loading",this._focused=!1,this._retryCount=0,this._fetchError=_=>{this._imageState="waitUploaded",this._retryCount++,console.warn("Cannot find blob, retrying",this._retryCount),this._retryCount<ImageBlockComponent_1.maxRetryCount?setTimeout(()=>{this._fetchImage()},1e3*this._retryCount):(console.error(_),this._imageState="failed")},this._fetchImage=()=>{if(this._imageState==="ready")return;this.model.page.blobs.get(this.model.sourceId).then(y=>{y?(this._blob=y,this._source=URL.createObjectURL(y),this._imageState="ready"):this._fetchError(new Error("Cannot find blob"))}).catch(this._fetchError)}}connectedCallback(){super.connectedCallback(),this._imageState="loading",this._fetchImage(),this._disposables.add(this.model.page.workspace.slots.blobUpdate.on(this._fetchImage)),this._bindKeymap(),this._handleSelection(),this._observeDrag(),setTimeout(()=>this._observePosition())}disconnectedCallback(){this._source&&URL.revokeObjectURL(this._source),super.disconnectedCallback()}firstUpdated(_){super.firstUpdated(_);const{width:y,height:w}=this.model;y&&w&&(this.resizeImg.style.width=y+"px",this.resizeImg.style.height=w+"px"),this.updateComplete.then(()=>{this._caption=this.model?.caption??"",this._caption.length>0&&this._input.classList.add("caption-show")}),this.addEventListener("click",()=>{document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()})}_onInputChange(){this._caption=this._input.value,this.model.page.updateBlock(this.model,{caption:this._caption})}_onInputBlur(){this._caption||this._input.classList.remove("caption-show")}_observeDrag(){const _=new ImageResizeManager;let y=!1;this._disposables.add(this.root.uiEventDispatcher.add("dragStart",w=>{const $=w.get("pointerState"),B=$.event.target;return B&&B instanceof HTMLElement&&this.contains(B)&&B.classList.contains("resize")?(y=!0,_.onStart($),!0):!1})),this._disposables.add(this.root.uiEventDispatcher.add("dragMove",w=>{const $=w.get("pointerState");return y?(_.onMove($),!0):!1})),this._disposables.add(this.root.uiEventDispatcher.add("dragEnd",()=>y?(y=!1,_.onEnd(),!0):!1))}_observePosition(){const _=this.resizeImg;let y=null;this._disposables.addFromEvent(_,"mouseover",()=>{if(y?.isConnected)return;const w=new AbortController;y=createLitPortal({template:ImageOptionsTemplate({anchor:_,model:this.model,blob:this._blob,abortController:w}),computePosition:{referenceElement:_,placement:"right-start",middleware:[offset$1({mainAxis:12,crossAxis:10}),shift({crossAxis:!0,padding:{top:PAGE_HEADER_HEIGHT+12,bottom:12,right:12}})],autoUpdate:!0},abortController:w})})}_handleSelection(){const _=this.root.selectionManager;this._disposables.add(_.slots.changed.on(y=>{const w=y.find($=>PathFinder.equals($.path,this.path)&&$.is("image"));this._focused=!!w})),this.handleEvent("click",()=>(_.update(y=>y.filter(w=>!["text","block","image"].includes(w.type)).concat(_.getInstance("image",{path:this.path}))),!0)),this.handleEvent("click",()=>{this._focused&&_.update(y=>y.filter(w=>!(w.is("image")&&PathFinder.equals(w.path,this.path))))},{global:!0})}_bindKeymap(){const _=this.root.selectionManager,y=()=>{const w=this.page.getParent(this.model);if(!w)return;const $=w.children.indexOf(this.model),B=this.page.addBlock("affine:paragraph",{},w,$+1);requestAnimationFrame(()=>{_.update(R=>R.filter(H=>!H.is("image")).concat(_.getInstance("text",{from:{path:this.parentPath.concat(B),index:0,length:0},to:null})))})};this.bindHotKey({Escape:()=>(_.update(w=>w.map($=>$.is("image")&&PathFinder.equals($.path,this.path)?_.getInstance("block",{path:this.path}):$)),!0),Delete:()=>{if(this._focused)return y(),this.page.deleteBlock(this.model),!0},Backspace:()=>{if(this._focused)return y(),this.page.deleteBlock(this.model),!0},Enter:()=>{if(this._focused)return y(),!0}})}_imageResizeBoardTemplate(){return!this._focused||this._imageState!=="ready"?null:ImageSelectedRectsContainer()}render(){const _={width:"unset",height:"unset"},{width:y,height:w}=this.model;y&&w&&(_.width=`${y}px`,_.height=`${w}px`);const $={waitUploaded:x$1`<affine-image-block-loading-card
        content="Delivering content..."
      ></affine-image-block-loading-card>`,loading:x$1`<affine-image-block-loading-card
        content="Loading content..."
      ></affine-image-block-loading-card>`,ready:x$1`<img src=${this._source} draggable="false" />`,failed:x$1`<affine-image-block-not-found-card></affine-image-block-not-found-card>`}[this._imageState];return x$1`
      <div style="position: relative;">
        <div class="affine-image-wrapper">
          <div class="resizable-img" style=${o$4(_)}>
            ${$} ${this._imageResizeBoardTemplate()}
          </div>
        </div>
        ${this.selected?.is("block")?x$1`<affine-block-selection></affine-block-selection>`:null}
      </div>

      <div class="affine-embed-block-container">
        <div class="affine-embed-wrapper">
          <input
            .disabled=${this.model.page.readonly}
            placeholder="Write a caption"
            class="affine-embed-wrapper-caption"
            value=${this._caption}
            @input=${this._onInputChange}
            @blur=${this._onInputBlur}
            @click=${stopPropagation}
            @keydown=${stopPropagation}
            @keyup=${stopPropagation}
            @pointerdown=${stopPropagation}
            @pointerup=${stopPropagation}
            @pointermove=${stopPropagation}
            @paste=${stopPropagation}
            @cut=${stopPropagation}
            @copy=${stopPropagation}
          />
        </div>
      </div>
    `}};ImageBlockComponent.maxRetryCount=3;ImageBlockComponent.styles=i$5`
    affine-image {
      display: block;
    }
    .affine-embed-wrapper {
      text-align: center;
      margin-bottom: 18px;
    }
    .affine-embed-wrapper-caption {
      width: 100%;
      font-size: var(--affine-font-sm);
      outline: none;
      border: 0;
      font-family: inherit;
      text-align: center;
      color: var(--affine-icon-color);
      display: none;
      background: transparent;
    }
    .affine-embed-wrapper-caption::placeholder {
      color: var(--affine-placeholder-color);
    }

    .affine-embed-wrapper .caption-show {
      display: inline-block;
    }

    .affine-image-wrapper {
      padding: 8px;
      width: 100%;
      text-align: center;
      line-height: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 18px;
    }

    .affine-image-wrapper img {
      max-width: 100%;
      margin: auto;
      width: 100%;
    }

    .resizable-img {
      position: relative;
      border-radius: 8px;
    }

    .resizable-img img {
      width: 100%;
    }

    /* hover area */
    .resizable-img::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 50px;
      height: 100%;
      transform: translateX(100%);
    }
  `;__decorate$1g([i$6("input")],ImageBlockComponent.prototype,"_input",void 0);__decorate$1g([i$6(".resizable-img")],ImageBlockComponent.prototype,"resizeImg",void 0);__decorate$1g([t$2()],ImageBlockComponent.prototype,"_caption",void 0);__decorate$1g([t$2()],ImageBlockComponent.prototype,"_source",void 0);__decorate$1g([t$2()],ImageBlockComponent.prototype,"_imageState",void 0);__decorate$1g([t$2()],ImageBlockComponent.prototype,"_focused",void 0);ImageBlockComponent=ImageBlockComponent_1=__decorate$1g([e$7("affine-image")],ImageBlockComponent);class ImageSelection extends BaseSelection{equals(_){return _ instanceof ImageSelection?PathFinder.equals(this.path,_.path):!1}toJSON(){return{type:this.type,path:this.path}}static fromJSON(_){return new ImageSelection({path:_.path})}}ImageSelection.type="image";ImageSelection.group="note";class ImageService extends BlockService{mounted(){super.mounted(),this.selectionManager.register(ImageSelection)}}var __decorate$1f=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let SurfaceBlockComponent=class extends BlockElement{render(){return A}};SurfaceBlockComponent=__decorate$1f([e$7("affine-surface")],SurfaceBlockComponent);var __decorate$1e=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const renderUniLit=(k,_,y)=>x$1` <uni-lit
    .uni="${k}"
    .props="${_}"
    .ref="${y?.ref}"
    style=${y?.style?o$4(y?.style):""}
  ></uni-lit>`;let UniLit=class extends ShadowlessElement{get expose(){return this.uniReturn?.expose}mount(){this.uniReturn=this.uni?.(this,this.props),this.ref&&(this.ref.value=this.uniReturn?.expose)}unmount(){this.uniReturn?.unmount()}connectedCallback(){super.connectedCallback(),this.mount()}disconnectedCallback(){super.disconnectedCallback(),this.unmount()}updated(_){super.updated(_),_.has("uni")?(this.unmount(),this.mount()):_.has("props")&&this.uniReturn?.update(this.props)}render(){return x$1``}};__decorate$1e([n$a({attribute:!1})],UniLit.prototype,"uni",void 0);__decorate$1e([n$a({attribute:!1})],UniLit.prototype,"props",void 0);__decorate$1e([n$a({attribute:!1})],UniLit.prototype,"ref",void 0);UniLit=__decorate$1e([e$7("uni-lit")],UniLit);const createUniComponentFromWebComponent=k=>(_,y)=>{const w=new k;return Object.assign(w,y),_.appendChild(w),{update:$=>{Object.assign(w,$)},unmount:()=>{w.remove()},expose:w}};class Matcher{constructor(_=typesystem.isSubtype.bind(typesystem)){this._match=_,this.list=[]}register(_,y){this.list.push({type:_,data:y})}match(_){for(const y of this.list)if(this._match(y.type,_))return y.data}allMatched(_){const y=[];for(const w of this.list)this._match(w.type,_)&&y.push(w);return y}allMatchedData(_){const y=[];for(const w of this.list)this._match(w.type,_)&&y.push(w.data);return y}findData(_){return this.list.find(y=>_(y.data))?.data}find(_){return this.list.find(_)}all(){return this.list}isMatched(_,y){return this._match(_,y)}}const groupByMatcher=new Matcher;var __decorate$1d=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class BaseGroup extends WithDisposable(ShadowlessElement){}__decorate$1d([n$a({attribute:!1})],BaseGroup.prototype,"data",void 0);__decorate$1d([n$a({attribute:!1})],BaseGroup.prototype,"updateData",void 0);__decorate$1d([n$a({attribute:!1})],BaseGroup.prototype,"value",void 0);__decorate$1d([n$a({attribute:!1})],BaseGroup.prototype,"updateValue",void 0);__decorate$1d([n$a({attribute:!1})],BaseGroup.prototype,"readonly",void 0);var __decorate$1c=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NumberGroupView=class extends BaseGroup{constructor(){super(...arguments),this._click=()=>{this.readonly||popMenu(this,{options:{input:{initValue:this.value?`${this.value*10}`:"",onComplete:_=>{const y=Number.parseFloat(_);Number.isNaN(y)||this.updateValue?.(y)}},items:[]}})}}render(){return this.value==null?x$1` <div>Ungroups</div>`:this.value>=10?x$1` <div
        @click="${this._click}"
        class="data-view-group-title-number-view"
      >
        >= 100
      </div>`:x$1` <div
      @click="${this._click}"
      class="data-view-group-title-number-view"
    >
      ${this.value*10} - ${this.value*10+9}
    </div>`}};NumberGroupView.styles=i$5`
    .data-view-group-title-number-view {
      border-radius: 8px;
      padding: 4px 8px;
      width: max-content;
      cursor: pointer;
    }

    .data-view-group-title-number-view:hover {
      background-color: var(--affine-hover-color);
    }
  `;NumberGroupView=__decorate$1c([e$7("data-view-group-title-number-view")],NumberGroupView);var __decorate$1b=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let SelectGroupView=class extends BaseGroup{constructor(){super(...arguments),this._click=()=>{this.readonly||popMenu(this,{options:{input:{initValue:this.tag?.value??"",onComplete:_=>{this.updateData?.({...this.data,options:this.data.options.map(y=>y.id===this.value?{...y,value:_}:y)})}},items:[]}})}}get tag(){return this.data.options.find(_=>_.id===this.value)}render(){const _=this.tag;if(!_)return x$1` <div>Ungroups</div>`;const y=o$4({backgroundColor:_.color});return x$1` <div
      @click="${this._click}"
      class="data-view-group-title-select-view"
    >
      <div class="tag" style="${y}">${_.value}</div>
    </div>`}};SelectGroupView.styles=i$5`
    .data-view-group-title-select-view {
      width: 100%;
      cursor: pointer;
    }

    .tag {
      padding: 0 8px;
      border-radius: 4px;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  `;SelectGroupView=__decorate$1b([e$7("data-view-group-title-select-view")],SelectGroupView);var __decorate$1a=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let StringGroupView=class extends BaseGroup{constructor(){super(...arguments),this._click=()=>{this.readonly||popMenu(this,{options:{input:{initValue:this.value??"",onComplete:_=>{this.updateValue?.(_)}},items:[]}})}}render(){return this.value?x$1` <div
      @click="${this._click}"
      class="data-view-group-title-string-view"
    >
      ${this.value}
    </div>`:x$1` <div>Ungroups</div>`}};StringGroupView.styles=i$5`
    .data-view-group-title-string-view {
      border-radius: 8px;
      padding: 4px 8px;
      width: max-content;
      cursor: pointer;
    }

    .data-view-group-title-string-view:hover {
      background-color: var(--affine-hover-color);
    }
  `;StringGroupView=__decorate$1a([e$7("data-view-group-title-string-view")],StringGroupView);const ungroups={key:"Ungroups",value:null};groupByMatcher.register(tTag.create(),{name:"select",groupName:(k,_)=>tTag.is(k)&&k.data?k.data.tags.find(y=>y.id===_)?.value??"":"",defaultKeys:k=>tTag.is(k)&&k.data?[ungroups,...k.data.tags.map(_=>({key:_.id,value:_.id}))]:[ungroups],valuesGroup:(k,_)=>k==null?[ungroups]:[{key:`${k}`,value:k}],view:createUniComponentFromWebComponent(SelectGroupView)});groupByMatcher.register(tArray(tTag.create()),{name:"multi-select",groupName:(k,_)=>tTag.is(k)&&k.data?k.data.tags.find(y=>y.id===_)?.value??"":"",defaultKeys:k=>isTArray(k)&&tTag.is(k.ele)&&k.ele.data?[ungroups,...k.ele.data.tags.map(_=>({key:_.id,value:_.id}))]:[ungroups],valuesGroup:(k,_)=>k==null?[ungroups]:Array.isArray(k)&&k.length?k.map(y=>({key:`${y}`,value:y})):[ungroups],addToGroup:(k,_)=>Array.isArray(_)?[..._,k]:k?[k]:[],removeFromGroup:(k,_)=>Array.isArray(_)?_.filter(y=>y!==k):_,view:createUniComponentFromWebComponent(SelectGroupView)});groupByMatcher.register(tString.create(),{name:"text",groupName:(k,_)=>`${_??""}`,defaultKeys:k=>[ungroups],valuesGroup:(k,_)=>k?[{key:`g:${k}`,value:k}]:[ungroups],view:createUniComponentFromWebComponent(StringGroupView)});groupByMatcher.register(tNumber.create(),{name:"number",groupName:(k,_)=>`${_??""}`,defaultKeys:k=>[ungroups],valuesGroup:(k,_)=>typeof k!="number"?[ungroups]:[{key:`g:${Math.floor(k/10)}`,value:Math.floor(k/10)}],addToGroup:k=>typeof k=="number"?k*10:void 0,view:createUniComponentFromWebComponent(NumberGroupView)});var __decorate$19=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DataViewHeaderViews=class extends WithDisposable(ShadowlessElement){_addViewMenu(_){popFilterableSimpleMenu(_.target,viewManager.all.map(y=>({type:"action",name:y.defaultName,icon:x$1`<uni-lit
            .uni=${viewRendererManager.getView(y.type).icon}
          ></uni-lit>`,select:()=>{this.model.page.captureSync();const w=this.model.addView(y.type);this.setViewId(w.id),this.model.applyViewsUpdate()}})))}_showMore(_){popFilterableSimpleMenu(_.target,[...this.model.views.map(y=>({type:"action",icon:x$1`<uni-lit
          .uni=${viewRendererManager.getView(y.mode).icon}
        ></uni-lit>`,name:y.name,select:()=>{this.setViewId(y.id)}})),{type:"group",name:"",hide:()=>this.model.page.readonly,children:()=>viewManager.all.map(y=>({type:"action",name:`Create ${y.defaultName}`,icon:x$1`<uni-lit
                .uni=${viewRendererManager.getView(y.type).icon}
              ></uni-lit>`,select:()=>{this.model.page.captureSync();const w=this.model.addView(y.type);this.setViewId(w.id),this.model.applyViewsUpdate()}}))}])}_clickView(_,y){if(this.currentView!==y){this.setViewId(y);return}if(this.model.page.readonly)return;const w=this.model.views.find($=>$.id===y);w&&popMenu(_.target,{options:{input:{initValue:w.name,onComplete:$=>{this.model.updateView(w.id,B=>({name:$})),this.model.applyViewsUpdate()}},items:[{type:"action",name:"Delete",icon:DeleteIcon,select:()=>{this.model.deleteView(w.id),this.model.applyViewsUpdate()},class:"delete-item"}]}})}connectedCallback(){super.connectedCallback(),this.model.propsUpdated.on(()=>{this.requestUpdate()})}renderMore(){return this.model.views.length<=3?this.model.page.readonly?void 0:x$1`<div
        class="database-view-button"
        @click="${this._addViewMenu}"
      >
        ${AddCursorIcon}
      </div>`:x$1`
      <div class="database-view-button" @click="${this._showMore}">
        ${this.model.views.length-3} More
      </div>
    `}render(){const _=this.model.views,y=_.findIndex($=>$.id===this.currentView),w=y>2?[..._.slice(0,2),_[y]]:_.slice(0,3);return x$1`
      ${c$1(w,$=>$.id,$=>{const B=o$3({"database-view-button":!0,active:this.currentView===$.id});return x$1` <div
            class="${B}"
            @click="${R=>this._clickView(R,$.id)}"
          >
            <uni-lit
              class="icon"
              .uni="${viewRendererManager.getView($.mode).icon}"
            ></uni-lit>
            <div class="name">${$.name}</div>
          </div>`})}
      ${this.renderMore()}
    `}};DataViewHeaderViews.styles=i$5`
    data-view-header-views {
      display: flex;
      user-select: none;
    }
    data-view-header-views::-webkit-scrollbar-thumb {
      width: 1px;
    }

    .database-view-button {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      display: flex;
      align-items: center;
      color: var(--affine-text-secondary-color);
      white-space: nowrap;
    }

    .database-view-button .name {
      height: 22px;
      max-width: 100px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .database-view-button .icon {
      margin-right: 6px;
    }

    .database-view-button .icon svg {
      width: 16px;
      height: 16px;
    }

    .database-view-button.active {
      color: var(--affine-text-primary-color);
      background-color: var(--affine-hover-color);
    }
  `;__decorate$19([n$a({attribute:!1})],DataViewHeaderViews.prototype,"model",void 0);__decorate$19([n$a({attribute:!1})],DataViewHeaderViews.prototype,"currentView",void 0);__decorate$19([n$a({attribute:!1})],DataViewHeaderViews.prototype,"setViewId",void 0);DataViewHeaderViews=__decorate$19([e$7("data-view-header-views")],DataViewHeaderViews);const DATABASE_TITLE_LENGTH=50;var __decorate$18=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DatabaseTitle=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.compositionInput=!1,this.titleVInput=null,this._handleKeyDown=_=>{if(_.key==="Enter"){_.preventDefault(),this.onPressEnterKey?.();return}},this._onTitleFocus=()=>{this.titleVInput?.setActive(!0)},this._onTitleBlur=()=>{this.titleVInput?.setActive(!1)}}firstUpdated(){this._initTitleVEditor();const _=this._disposables;_.addFromEvent(this._titleContainer,"focus",this._onTitleFocus),_.addFromEvent(this._titleContainer,"blur",this._onTitleBlur),_.addFromEvent(this._titleContainer,"compositionstart",()=>{this.compositionInput=!0}),_.addFromEvent(this._titleContainer,"compositionend",()=>{this.compositionInput=!1});const y=w=>w.stopPropagation();this._disposables.addFromEvent(this,"pointerdown",y),this._disposables.addFromEvent(this,"pointermove",y)}_initTitleVEditor(){this.titleVInput=new VirgoInput({yText:this.titleText.yText,maxLength:DATABASE_TITLE_LENGTH}),this.titleVInput.vEditor.disposables.addFromEvent(this._titleContainer,"keydown",this._handleKeyDown),this.titleText.yText.observe(()=>{this.requestUpdate()}),this.titleVInput.mount(this._titleContainer),this.titleVInput.vEditor.setReadonly(this.readonly)}render(){const _=(!this.titleText||!this.titleText.length)&&!this.compositionInput,y=o$3({"database-title":!0,"database-title-empty":_});return x$1`<div class="affine-database-title">
      <div
        class="${y}"
        data-block-is-database-title="true"
        title="${this.titleText.toString()}"
      ></div>
    </div>`}};DatabaseTitle.styles=i$5`
    .affine-database-title {
      flex: 1;
      height: 28px;
      min-width: 100px;
      width: max-content;
    }

    .database-title {
      height: 30px;
      font-size: 20px;
      font-weight: 600;
      line-height: 28px;
      color: var(--affine-text-primary-color);
      font-family: inherit;
      /* overflow-x: scroll; */
      overflow: hidden;
      cursor: text;
    }

    .database-title [data-virgo-text='true'] {
      display: block;
      white-space: pre !important;
    }

    .database-title.ellipsis [data-virgo-text='true'] {
      white-space: nowrap !important;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .database-title:focus {
      outline: none;
    }

    .database-title:disabled {
      background-color: transparent;
    }

    .database-title-empty::before {
      content: 'Untitled';
      position: absolute;
      pointer-events: none;
      color: var(--affine-text-primary-color);
    }

    .database-title-empty:focus::before {
      color: var(--affine-placeholder-color);
    }
  `;__decorate$18([n$a({attribute:!1})],DatabaseTitle.prototype,"titleText",void 0);__decorate$18([n$a({attribute:!1})],DatabaseTitle.prototype,"readonly",void 0);__decorate$18([n$a({attribute:!1})],DatabaseTitle.prototype,"onPressEnterKey",void 0);__decorate$18([t$2()],DatabaseTitle.prototype,"compositionInput",void 0);__decorate$18([i$6(".database-title")],DatabaseTitle.prototype,"_titleContainer",void 0);DatabaseTitle=__decorate$18([e$7("affine-database-title")],DatabaseTitle);const propertyMatcher=new Matcher((k,_)=>{if(k.type!=="function")return!1;const w=typesystem.subst(Object.fromEntries(k.typeVars?.map($=>[$.name,$.bound])??[]),k).args[0];return w&&typesystem.isSubtype(w,_)});propertyMatcher.register(tFunction({args:[tString.create()],rt:tNumber.create()}),{name:"Length",impl:k=>typeof k!="string"?0:k.length});propertyMatcher.register(tFunction({args:[tDate.create()],rt:tNumber.create()}),{name:"Day of month",impl:k=>typeof k!="number"?0:new Date(k).getDate()});propertyMatcher.register(tFunction({args:[tDate.create()],rt:tNumber.create()}),{name:"Day of week",impl:k=>typeof k!="number"?0:new Date(k).getDay()});propertyMatcher.register(tFunction({args:[tDate.create()],rt:tNumber.create()}),{name:"Month of year",impl:k=>typeof k!="number"?0:new Date(k).getMonth()+1});propertyMatcher.register(tFunction({args:[tArray(tUnknown.create())],rt:tNumber.create()}),{name:"Size",impl:k=>Array.isArray(k)?k.length:0});var __decorate$17=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let VariableRefView=class extends WithDisposable(ShadowlessElement){get field(){if(this.data)return this.data.type==="ref"?this.data.name:this.data.ref.name}get fieldLabel(){const _=this.field;if(_)return this.vars.find(y=>y.id===_)?.name}get property(){if(this.data&&this.data.type!=="ref")return this.data.propertyFuncName}selectField(){popSelectField(this.fieldSelect,{vars:this.vars,onSelect:_=>this.setData(_)})}selectProperty(){const _=this.field,y=this.vars.find($=>$.id===_)?.type;if(!y||!_)return;const w=propertyMatcher.allMatchedData(y);popFilterableSimpleMenu(this.propertySelect,w.map($=>({type:"action",name:$.name,select:()=>{this.setData({type:"property",ref:{type:"ref",name:_},propertyFuncName:$.name})}})))}render(){return x$1`
      <div style="display:flex;align-items:center;">
        <div style="display:flex;align-items:center;">
          <span class="field-select" @click="${this.selectField}"
            >${this.fieldLabel}</span
          >
        </div>
        <div style="display:flex;align-items:center;">
          ${this.property&&x$1`<span style="margin-right: 4px;">${"'s"}</span>`}
          <!-- <PlainSelect
            :value="propertyName"
            @update:value="setPropertyName"
            :options="propertyOptions"
          ></PlainSelect> -->
        </div>
      </div>
    `}};VariableRefView.styles=i$5`
    .field-select {
      cursor: pointer;
    }

    .property-select {
      cursor: pointer;
      padding: 0 2px;
    }
  `;__decorate$17([n$a({attribute:!1})],VariableRefView.prototype,"data",void 0);__decorate$17([n$a({attribute:!1})],VariableRefView.prototype,"setData",void 0);__decorate$17([n$a({attribute:!1})],VariableRefView.prototype,"vars",void 0);__decorate$17([i$6(".field-select")],VariableRefView.prototype,"fieldSelect",void 0);__decorate$17([i$6(".property-select")],VariableRefView.prototype,"propertySelect",void 0);VariableRefView=__decorate$17([e$7("variable-ref-view")],VariableRefView);const popSelectField=(k,_)=>{popFilterableSimpleMenu(k,_.vars.map(y=>({type:"action",name:y.name,select:()=>{_.onSelect({type:"ref",name:y.id})}})))},renderLiteral=(k,_,y)=>{const w=literalMatcher.match(k);if(w)return w.render(k,_,y)},popLiteralEdit=(k,_,y,w)=>{const $=literalMatcher.match(_);if(!$)return;$.component.create(_,y,w)._popEdit(k)},literalMatcher=new Matcher;function isVisible(k){return!!k&&!!(k.offsetWidth||k.offsetHeight||k.getClientRects().length)}function onClickOutside(k,_,y="click",w=!1){const $=R=>{const H=R.composedPath&&R.composedPath();(H?H.indexOf(k)<0:!k.contains(R.target)&&isVisible(k))&&(_(k,R.target),w||B())};document.addEventListener(y,$);const B=()=>{document.removeEventListener(y,$)};return B}const getResultInRange=(k,_,y)=>Math.max(_,Math.min(y,k)),createDatabasePopup=(k,_,y)=>{k.parentElement?.append(_),computePosition(k,_,{middleware:[autoPlacement()]}).then(({x:w,y:$})=>{Object.assign(_.style,{left:`${w}px`,top:`${$}px`})}),onClickOutside(_,()=>{_.remove(),y?.onClose?.()},"mousedown")};var __decorate$16=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class LiteralElement extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.mode="show"}showValue(){return this.value?.toString()??"[]"}doneValue(){return this.value}done(){this.onChange(this.doneValue())}show(){return x$1` <span @click="${this.popEdit}">${this.showValue()}</span> `}edit(){return x$1``}static create(_,y,w){const $=new this;return $.type=_,$.value=y,$.onChange=B=>{w(B),$.value=B,$.remove()},$}_popEdit(_=this){const y=this.constructor.create(this.type,this.value,this.onChange);y.mode="edit",y.style.position="absolute",y.style.zIndex="999",createDatabasePopup(_,y,{onClose:()=>{y.done()}})}popEdit(){this._popEdit()}render(){return this.mode==="show"?this.show():this.edit()}}__decorate$16([n$a({attribute:!1})],LiteralElement.prototype,"type",void 0);__decorate$16([n$a({attribute:!1})],LiteralElement.prototype,"value",void 0);__decorate$16([n$a({attribute:!1})],LiteralElement.prototype,"onChange",void 0);__decorate$16([n$a({attribute:!1})],LiteralElement.prototype,"mode",void 0);class ArrayLiteral extends LiteralElement{_add(_){popLiteralEdit(_.target,this.type.ele,void 0,y=>{const w=[...this.value??[],y];this.onChange(w)})}show(){const _=Array.isArray(this.value)?this.value:[],y=this.type;return x$1`
      <div style="display: flex;align-items:center;">
        ${c$1(_,(w,$)=>{const B=y.ele;return x$1`<span>
            ${$!==0?",":""}
            ${renderLiteral(B,w,R=>{this.onChange(_.map((H,j)=>$!==j?H:R))})}
          </span>`})}
        <div @click="${this._add}">+</div>
      </div>
    `}}var __decorate$15=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class NumberLiteral extends LiteralElement{doneValue(){return Number.parseFloat(this._inputEle.value)}firstUpdated(){this._inputEle?.focus()}_keydown(_){_.key==="Enter"&&this.done()}edit(){return x$1`
      <input
        type="number"
        .value=${this.value??""}
        @keydown=${this._keydown}
      />
    `}}__decorate$15([i$6("input")],NumberLiteral.prototype,"_inputEle",void 0);var __decorate$14=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class StringLiteral extends LiteralElement{doneValue(){return this._inputEle.value}firstUpdated(){this._inputEle?.focus()}_keydown(_){_.key==="Enter"&&this.done()}edit(){return x$1`
      <input .value="${this.value??""}" @keydown=${this._keydown} />
    `}}__decorate$14([i$6("input")],StringLiteral.prototype,"_inputEle",void 0);class TagLiteral extends LiteralElement{tags(){const _=this.type.data?.tags;return _||[]}showValue(){return this.tags().find(_=>_.id===this.value)?.value??"[]"}_popEdit(_=this){popFilterableSimpleMenu(_,this.tags().map(y=>({type:"action",name:y.value,select:()=>{this.onChange(y.id)}})))}}const createRenderFunction=(k,_)=>(customElements.define(k._$litStatic$,_),{render:(y,w,$)=>n$5`
      <${y} .type='${y}' .value='${w}' .onChange='${$}'></${y}>`,component:_});literalMatcher.register(tString.create(),createRenderFunction(i$4`ast-string-literal`,StringLiteral));literalMatcher.register(tNumber.create(),createRenderFunction(i$4`ast-number-literal`,NumberLiteral));literalMatcher.register(tArray(tUnknown.create()),createRenderFunction(i$4`ast-array-literal`,ArrayLiteral));literalMatcher.register(tTag.create(),createRenderFunction(i$4`ast-tag-literal`,TagLiteral));const filterMatcher=new Matcher((k,_)=>{if(k.type!=="function")return!1;const w=typesystem.subst(Object.fromEntries(k.typeVars?.map($=>[$.name,$.bound])??[]),k).args[0];return w&&typesystem.isSubtype(w,_)});filterMatcher.register(tFunction({args:[tUnknown.create()],rt:tBoolean.create()}),{name:"Is not empty",impl:k=>typeof k=="string"?!!k:k!=null});filterMatcher.register(tFunction({args:[tUnknown.create()],rt:tBoolean.create()}),{name:"Is empty",impl:k=>typeof k=="string"?!k:k==null});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Is",impl:(k,_)=>k==_});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Is not",impl:(k,_)=>k!=_});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Contains",impl:(k,_)=>typeof k=="string"&&typeof _=="string"&&k.includes(_)});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Does no contains",impl:(k,_)=>typeof k=="string"&&typeof _=="string"&&!k.includes(_)});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Starts with",impl:(k,_)=>typeof k=="string"&&typeof _=="string"&&k.startsWith(_)});filterMatcher.register(tFunction({args:[tString.create(),tString.create()],rt:tBoolean.create()}),{name:"Ends with",impl:(k,_)=>typeof k=="string"&&typeof _=="string"&&k.endsWith(_)});filterMatcher.register(tFunction({args:[tString.create(),tNumber.create()],rt:tBoolean.create()}),{name:"Characters less than",impl:(k,_)=>typeof k=="string"&&typeof _=="number"&&k.length<_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:">",impl:(k,_)=>typeof k=="number"&&typeof _=="number"&&k>_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:">=",impl:(k,_)=>typeof k=="number"&&typeof _=="number"&&k>=_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:"<",impl:(k,_)=>typeof k=="number"&&typeof _=="number"&&k<_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:"<=",impl:(k,_)=>typeof k=="number"&&typeof _=="number"&&k<=_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:"==",impl:(k,_)=>typeof k=="number"&&k==_});filterMatcher.register(tFunction({args:[tNumber.create(),tNumber.create()],rt:tBoolean.create()}),{name:"!=",impl:(k,_)=>typeof k=="number"&&k!=_});filterMatcher.register(tFunction({args:[tDate.create(),tUnion([tString.create({value:"Today"}),tString.create({value:"Yesterday"}),tString.create({value:"2 days ago"}),tString.create({value:"3 days ago"}),tString.create({value:"4 days ago"}),tString.create({value:"5 days ago"}),tString.create({value:"Last week"})])],rt:tBoolean.create()}),{name:"Is before",impl:(k,_)=>{const y=new Date;switch(_){case"Today":break;case"Yesterday":y.setDate(y.getDate()-1);break;case"2 days ago":y.setDate(y.getDate()-2);break;case"3 days ago":y.setDate(y.getDate()-3);break;case"4 days ago":y.setDate(y.getDate()-4);break;case"5 days ago":y.setDate(y.getDate()-5);break;case"Last week":y.setDate(y.getDate()-y.getDay());break}return typeof k=="number"&&k<+y}});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tTypeRef("options"),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Is inside",impl:(k,_)=>Array.isArray(_)&&_.includes(k)});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tTypeRef("options"),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Is not inside",impl:(k,_)=>Array.isArray(_)&&!_.includes(k)});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tArray(tTypeRef("options")),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Contains all",impl:(k,_)=>Array.isArray(_)&&Array.isArray(k)&&_.every(y=>k.includes(y))});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tArray(tTypeRef("options")),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Contains one of",impl:(k,_)=>Array.isArray(_)&&Array.isArray(k)&&_.some(y=>k.includes(y))});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tArray(tTypeRef("options")),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Does not contains one of",impl:(k,_)=>Array.isArray(_)&&Array.isArray(k)&&_.every(y=>!k.includes(y))});filterMatcher.register(tFunction({typeVars:[tTypeVar("options",tTag.create())],args:[tArray(tTypeRef("options")),tArray(tTypeRef("options"))],rt:tBoolean.create()}),{name:"Does not contains all",impl:(k,_)=>Array.isArray(_)&&Array.isArray(k)&&!_.every(y=>k.includes(y))});const getRefType=(k,_)=>_.type==="ref"?k.find(y=>y.id===_.name)?.type:propertyMatcher.find(y=>y.data.name===_.propertyFuncName)?.type.rt,firstFilterName=(k,_)=>{const y=getRefType(k,_);if(!y)throw new Error("can't resolve ref type");return filterMatcher.match(y)?.name},firstFilterByRef=(k,_)=>({type:"filter",left:_,function:firstFilterName(k,_),args:[]}),firstFilter=k=>{const _={type:"ref",name:k[0].id},y=firstFilterName(k,_);if(!y)throw new Error("can't match any filter");return{type:"filter",left:_,function:y,args:[]}},firstFilterInGroup=k=>({type:"group",op:"and",conditions:[firstFilter(k)]});var __decorate$13=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let FilterConditionView=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._setRef=_=>{this.setData(firstFilterByRef(this.vars,_))}}_filterLabel(){return this.data.function}_filterList(){const _=getRefType(this.vars,this.data.left);return _?filterMatcher.allMatchedData(_):[]}_selectFilter(){const _=this._filterList();popFilterableSimpleMenu(this.filterSelect,_.map(y=>({type:"action",name:y.name,select:()=>{this.setData({...this.data,function:y.name})}})))}_args(){const _=filterMatcher.find($=>$.data.name===this.data.function);if(!_)return[];const y=getRefType(this.vars,this.data.left);return y?typesystem.instance({},[y],tBoolean.create(),_.type).args.slice(1):[]}render(){const _=this.data;return x$1`
      <div style="display:flex;align-items:center;white-space: nowrap">
        <variable-ref-view
          .data="${_.left}"
          .setData="${this._setRef}"
          .vars="${this.vars}"
          style="margin-right: 4px;"
        ></variable-ref-view>
        <div style="margin-right: 4px;display:flex;align-items:center;">
          <div class="filter-select" @click="${this._selectFilter}">
            ${this._filterLabel()}
          </div>
        </div>
        <div>
          ${c$1(this._args(),(y,w)=>{const $=this.data.args[w];return renderLiteral(y,$?.value,B=>{const R=this.data.args.slice();R[w]={type:"literal",value:B},this.setData({...this.data,args:R})})})}
        </div>
      </div>
    `}};FilterConditionView.styles=i$5``;__decorate$13([n$a({attribute:!1})],FilterConditionView.prototype,"data",void 0);__decorate$13([n$a({attribute:!1})],FilterConditionView.prototype,"setData",void 0);__decorate$13([n$a({attribute:!1})],FilterConditionView.prototype,"vars",void 0);__decorate$13([i$6(".filter-select")],FilterConditionView.prototype,"filterSelect",void 0);FilterConditionView=__decorate$13([e$7("filter-condition-view")],FilterConditionView);var __decorate$12=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let FilterGroupView=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.opMap={and:"And",or:"Or"},this._setFilter=(_,y)=>{this.setData({...this.data,conditions:this.data.conditions.map((w,$)=>_===$?y:w)})},this._addNew=()=>{popAddNewFilter(this.addNew,{value:this.data,onChange:this.setData,vars:this.vars})},this._selectOp=_=>{popFilterableSimpleMenu(_.target,[{type:"action",name:"And",select:()=>{this.setData({...this.data,op:"and"})}},{type:"action",name:"Or",select:()=>{this.setData({...this.data,op:"or"})}}])}}_deleteCondition(_){const y=[...this.data.conditions];y.splice(_,1),this.setData({...this.data,conditions:y})}render(){const _=this.data;return x$1`
      <div>
        ${c$1(_.conditions,(y,w)=>{let $;return w===0?$=x$1` <div style="padding-left: 6px;">Where</div>`:w===1?$=x$1`
              <div @click="${this._selectOp}">${this.opMap[_.op]}</div>
            `:$=x$1`
              <div style="padding-left: 6px;">${this.opMap[_.op]}</div>
            `,x$1` <div
            style="display: flex;align-items:start;margin-bottom: 4px;"
          >
            <div style="margin-right: 4px;display:flex;align-items:center;">
              ${$}
            </div>
            ${y.type==="filter"?x$1`
                  <filter-condition-view
                    .setData="${B=>this._setFilter(w,B)}"
                    .vars="${this.vars}"
                    .data="${y}"
                  ></filter-condition-view>
                `:x$1`
                  <filter-group-view
                    .setData="${B=>this._setFilter(w,B)}"
                    .vars="${this.vars}"
                    .data="${y}"
                  ></filter-group-view>
                `}
            <div @click="${()=>this._deleteCondition(w)}">x</div>
          </div>`})}
        <span class="add-new" @click="${this._addNew}">Add New</span>
      </div>
    `}};FilterGroupView.styles=i$5`
    filter-group-view {
      background-color: white;
    }
  `;__decorate$12([n$a({attribute:!1})],FilterGroupView.prototype,"data",void 0);__decorate$12([n$a({attribute:!1})],FilterGroupView.prototype,"vars",void 0);__decorate$12([i$6(".add-new")],FilterGroupView.prototype,"addNew",void 0);__decorate$12([n$a({attribute:!1})],FilterGroupView.prototype,"setData",void 0);FilterGroupView=__decorate$12([e$7("filter-group-view")],FilterGroupView);const popAdvanceFilter=(k,_)=>{const y=document.createElement("div");y.style.position="absolute",y.style.zIndex="999",y.style.boxShadow="3px 3px 10px rgba(0, 0, 0, 0.1)",y.style.padding="8px",y.style.borderRadius="4px",y.style.backgroundColor="white";const w=new FilterGroupView;w.vars=_.vars,w.data=_.value,w.setData=$=>{_.onChange($),w.data=$},y.append(w),createDatabasePopup(k,y)},popAddNewFilter=(k,_)=>{popFilterableSimpleMenu(k,[{type:"action",name:"filter",select:()=>{_.onChange({..._.value,conditions:[..._.value.conditions,firstFilter(_.vars)]})}},{type:"action",name:"filter group",select:()=>{_.onChange({..._.value,conditions:[..._.value.conditions,firstFilterInGroup(_.vars)]})}}])};var __decorate$11=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$l=i$5`
  .affine-database-search-container {
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 24px;
    height: 32px;
    border-radius: 8px;
    transition: all 0.3s ease;
    overflow: hidden;
  }
  .affine-database-search-container svg {
    width: 20px;
    height: 20px;
    fill: var(--affine-icon-color);
  }

  .search-container-expand {
    overflow: visible;
    width: 138px;
    background-color: var(--affine-hover-color);
  }

  .search-input-container {
    display: flex;
    align-items: center;
  }

  .close-icon {
    display: flex;
    align-items: center;
    padding-right: 8px;
    height: 100%;
    cursor: pointer;
  }

  .close-icon .code {
    width: 31px;
    height: 18px;
    padding: 2px 6px;
    border-radius: 4px;
    background: var(--affine-white-10);
  }

  .affine-database-search-input-icon {
    position: absolute;
    left: 0;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    cursor: pointer;
    padding: 2px;
    border-radius: 4px;
    height: max-content;
  }
  .affine-database-search-input-icon:hover {
    background: var(--affine-hover-color);
  }

  .search-container-expand .affine-database-search-input-icon {
    left: 4px;
    pointer-events: none;
  }

  .affine-database-search-input {
    flex: 1;
    width: 100%;
    padding: 0 2px 0 30px;
    border: none;
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-sm);
    box-sizing: border-box;
    color: inherit;
    background: transparent;
    outline: none;
  }

  .affine-database-search-input::placeholder {
    color: var(--affine-placeholder-color);
    font-size: var(--affine-font-sm);
  }
`;let DataViewHeaderToolsSearch=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._showSearch=!1,this._onSearch=_=>{const w=_.target.value.trim();this.view.setSearch(w)},this.preventBlur=!1,this._onSearchBlur=()=>{this._searchInput.value||this.preventBlur||(this.showSearch=!1)},this._onSearchKeydown=_=>{_.key==="Escape"&&(this._searchInput.value?(this._searchInput.value="",this.view.setSearch("")):this.showSearch=!1)},this._clearSearch=()=>{this._searchInput.value="",this.view.setSearch(""),this.preventBlur=!0,setTimeout(()=>{this.preventBlur=!1})},this._clickSearch=_=>{_.stopPropagation(),this.showSearch=!0}}get showSearch(){return this._showSearch}set showSearch(_){this._showSearch=_;const y=this.closest("data-view-header-tools");y&&(y.showToolBar=_)}get readonly(){return this.view.readonly}render(){if(this.readonly)return;const _=o$3({"affine-database-search-container":!0,"search-container-expand":this.showSearch});return x$1`
      <label class="${_}" @click="${this._clickSearch}">
        <div class="affine-database-search-input-icon">
          ${DatabaseSearchIcon}
        </div>
        <input
          placeholder="Search..."
          class="affine-database-search-input"
          @input="${this._onSearch}"
          @click="${y=>y.stopPropagation()}"
          @keydown="${this._onSearchKeydown}"
          @pointerdown="${stopPropagation}"
          @blur="${this._onSearchBlur}"
        />
        <div class="has-tool-tip close-icon" @mousedown="${this._clearSearch}">
          ${DatabaseSearchClose}
          <tool-tip inert arrow tip-position="top" role="tooltip">
            <span class="code">Esc</span> to clear all
          </tool-tip>
        </div>
      </label>
    `}};DataViewHeaderToolsSearch.styles=styles$l;__decorate$11([n$a({attribute:!1})],DataViewHeaderToolsSearch.prototype,"view",void 0);__decorate$11([i$6(".affine-database-search-input")],DataViewHeaderToolsSearch.prototype,"_searchInput",void 0);__decorate$11([t$2()],DataViewHeaderToolsSearch.prototype,"_showSearch",void 0);DataViewHeaderToolsSearch=__decorate$11([e$7("data-view-header-tools-search")],DataViewHeaderToolsSearch);class ColumnRendererHelper{constructor(){this._columns=new Map}register(_){const y=this._columns;if(y.has(_.type))throw new Error("cannot register twice for "+_.type);y.set(_.type,_)}get(_){const y=this._columns.get(_);if(!y)throw new Error(`cannot find renderer of ${_}`);return y}list(){return Array.from(this._columns.values())}}const columnRenderer=new ColumnRendererHelper,createFromBaseCellRenderer=k=>createUniComponentFromWebComponent(k);class BaseDataViewManager{get rows(){return this.filteredRows(this.searchString)}constructor(_){this.dataSource=_,this.searchString="",this.slots={update:new Slot},this.dataSource.slots.update.pipe(this.slots.update)}setSearch(_){this.searchString=_,this.slots.update.emit()}filteredRows(_){return this.dataSource.rows.filter(y=>_&&!this.columns.some($=>this.cellGetStringValue(y,$)?.toLowerCase().includes(_?.toLowerCase()))?!1:this.isShow(y))}get columnManagerList(){return this.columns.map(_=>this.columnGet(_))}get readonly(){return!1}onCellUpdate(_,y,w){return this.dataSource.onCellUpdate(_,y,w)}cellGetValue(_,y){return columnManager.getColumn(this.columnGetType(y)).formatValue(this.dataSource.cellGetValue(_,y),this.columnGetData(y))}cellGetJsonValue(_,y){return columnManager.getColumn(this.columnGetType(y)).toJson(this.dataSource.cellGetValue(_,y),this.columnGetData(y))}cellGetRenderValue(_,y){return this.dataSource.cellGetRenderValue(_,y)}cellGetStringValue(_,y){return columnManager.getColumn(this.columnGetType(y)).toString(this.dataSource.cellGetValue(_,y),this.columnGetData(y))??""}cellGetExtra(_,y){return this.dataSource.cellGetExtra(_,y)}cellSetValueFromString(_,y){return columnManager.getColumn(this.columnGetType(_)).fromString(y,this.columnGetData(_))??""}cellUpdateRenderValue(_,y,w){this.dataSource.cellChangeValue(_,y,w)}cellUpdateValue(_,y,w){this.dataSource.cellChangeValue(_,y,w)}columnAdd(_,y){const w=this.dataSource.propertyAdd(_,y);return this.columnMove(w,_),w}columnDelete(_){this.dataSource.propertyDelete(_)}columnDuplicate(_){const y=this.dataSource.propertyDuplicate(_);this.columnMove(y,{before:!1,id:_})}columnGetData(_){return this.dataSource.propertyGetData(_)}columnGetDataType(_){return columnManager.getColumn(this.columnGetType(_)).dataType(this.columnGetData(_))}columnGetIdByIndex(_){return this.columns[_]}columnGetReadonly(_){return this.dataSource.propertyGetReadonly(_)}columnGetIndex(_){return this.columns.indexOf(_)}columnGetName(_){return this.dataSource.propertyGetName(_)}columnGetNextColumn(_){return this.columnGet(this.columnGetIdByIndex(this.columnGetIndex(_)+1))}columnGetPreColumn(_){return this.columnGet(this.columnGetIdByIndex(this.columnGetIndex(_)-1))}columnGetType(_){return this.dataSource.propertyGetType(_)}columnUpdateData(_,y){this.dataSource.propertyChangeData(_,y)}columnUpdateName(_,y){this.dataSource.propertyChangeName(_,y)}columnUpdateType(_,y){this.dataSource.propertyChangeType(_,y)}rowAdd(_){return this.dataSource.rowAdd(_)}rowDelete(_){this.dataSource.rowDelete(_)}captureSync(){this.dataSource.captureSync()}get allColumnConfig(){return this.dataSource.allPropertyConfig}get columnConfigManager(){return this.dataSource.columnConfigManager}getIcon(_){return columnRenderer.get(_).icon}get detailSlots(){return this.dataSource.detailSlots}}class BaseDataViewColumnManager{constructor(_,y){this.propertyId=_,this.dataViewManager=y}get index(){return this.dataViewManager.columnGetIndex(this.id)}get data(){return this.dataViewManager.columnGetData(this.id)}get hide(){return this.dataViewManager.columnGetHide(this.id)}get id(){return this.propertyId}get isFirst(){return this.dataViewManager.columnGetIndex(this.id)===0}get isLast(){return this.dataViewManager.columnGetIndex(this.id)===this.dataViewManager.columnManagerList.length-1}get name(){return this.dataViewManager.columnGetName(this.id)}get renderer(){return columnRenderer.get(this.type).cellRenderer}get detailRenderer(){return columnRenderer.get(this.type).detailCellRenderer??this.renderer}get type(){return this.dataViewManager.columnGetType(this.id)}get dataType(){return columnManager.getColumn(this.type).dataType(this.data)}getValue(_){return this.dataViewManager.cellGetRenderValue(_,this.id)}getExtra(_){return this.dataViewManager.cellGetExtra(_,this.id)}setValue(_,y){this.dataViewManager.cellUpdateRenderValue(_,this.id,y)}updateData(_){const y=this.dataViewManager.columnGetData(this.id);this.dataViewManager.columnUpdateData(this.id,{...y,..._(y)})}updateHide(_){this.dataViewManager.columnUpdateHide(this.id,_)}updateName(_){this.dataViewManager.columnUpdateName(this.id,_)}get delete(){return()=>this.dataViewManager.columnDelete(this.id)}get duplicate(){return()=>this.dataViewManager.columnDuplicate(this.id)}get updateType(){return _=>this.dataViewManager.columnUpdateType(this.id,_)}get readonly(){return this.dataViewManager.readonly||this.dataViewManager.columnGetReadonly(this.id)}captureSync(){this.dataViewManager.captureSync()}getJsonValue(_){return this.dataViewManager.cellGetJsonValue(_,this.id)}getStringValue(_){return this.dataViewManager.cellGetStringValue(_,this.id)}setValueFromString(_){const y=this.dataViewManager.cellSetValueFromString(this.id,_);return y.data&&this.dataViewManager.columnUpdateData(this.id,y.data),y.value}get icon(){if(this.type)return this.dataViewManager.getIcon(this.type)}onCellUpdate(_,y){return this.dataViewManager.onCellUpdate(_,this.id,y)}}const defaultGroupBy=(k,_,y)=>{const w=groupByMatcher.match(columnManager.getColumn(_).dataType(y))?.name;return w!=null?{type:"groupBy",columnId:k,name:w}:void 0},evalRef=(k,_)=>{if(k.type==="ref")return _[k.name];const y=evalRef(k.ref,_),w=propertyMatcher.findData($=>$.name===k.propertyFuncName);try{return w?.impl(y)}catch($){console.error($);return}},evalValue=(k,_)=>k.value,evalFilter=(k,_)=>{const y=w=>{if(w.type==="filter"){const $=evalRef(w.left,_),B=filterMatcher.findData(H=>H.name===w.function),R=w.args.map(H=>evalValue(H));try{return(B?.impl.length??0)>R.length+1?!0:B?.impl($,...R)??!0}catch(H){return console.error(H),!0}}else if(w.type==="group"){if(w.op==="and")return w.conditions.every($=>y($));if(w.op==="or")return w.conditions.some($=>y($))}return!0};return y(k)},map=(k,_)=>(y,w)=>{const $=k(y,_(w));return{unmount:$.unmount,update:B=>{$.update(_(B))},expose:$.expose}};var __decorate$10=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class BaseCellRenderer extends WithDisposable(ShadowlessElement){get readonly(){return this.column.readonly}get value(){return this.column.getValue(this.rowId)}onChange(_){this.column.setValue(this.rowId,_)}beforeEnterEditMode(){return!0}onEnterEditMode(){}onExitEditMode(){}focusCell(){return!0}blurCell(){return!0}connectedCallback(){super.connectedCallback(),this.style.width="100%",this._disposables.addFromEvent(this,"click",y=>{this.isEditing&&y.stopPropagation()}),this._disposables.addFromEvent(this,"pointerdown",y=>{this.isEditing&&y.stopPropagation()});const _=this.column.type;this._disposables.add(this.column.onCellUpdate(this.rowId,()=>{this.column.type===_&&this.requestUpdate()}))}forceUpdate(){this.requestUpdate()}}__decorate$10([n$a({attribute:!1})],BaseCellRenderer.prototype,"view",void 0);__decorate$10([n$a({attribute:!1})],BaseCellRenderer.prototype,"column",void 0);__decorate$10([n$a()],BaseCellRenderer.prototype,"rowId",void 0);__decorate$10([n$a({attribute:!1})],BaseCellRenderer.prototype,"isEditing",void 0);__decorate$10([n$a({attribute:!1})],BaseCellRenderer.prototype,"selectCurrentCell",void 0);var __decorate$$=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$k=i$5`
  data-view-header-area-text {
    width: 100%;
    display: flex;
  }

  data-view-header-area-text-editing {
    width: 100%;
    display: flex;
  }

  .data-view-header-area-rich-text {
    display: flex;
    flex-direction: column;
    justify-content: center;
    width: 100%;
    height: 100%;
    outline: none;
    word-break: break-all;
    font-size: var(--data-view-cell-text-size);
    line-height: var(--data-view-cell-text-line-height);
  }

  .data-view-header-area-rich-text v-line {
    display: flex !important;
    align-items: center;
    height: 100%;
    width: 100%;
  }

  .data-view-header-area-rich-text v-line > div {
    flex-grow: 1;
  }

  .data-view-header-area-icon {
    height: max-content;
    display: flex;
    align-items: center;
    margin-right: 8px;
    padding: 2px;
    border-radius: 4px;
    margin-top: 2px;
    background-color: var(--affine-background-secondary-color);
  }

  .data-view-header-area-icon svg {
    width: 14px;
    height: 14px;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
  }
`,addHistoryToVEditor=k=>{let _=null;k.slots.rangeUpdated.on(w=>{_=w});const y=new UndoManager(k.yText,{trackedOrigins:new Set([k.yText.doc?.clientID])});return y.on("stack-item-added",w=>{const $=_&&k.mounted?k.toVRange(_):null;w.stackItem.meta.set("v-range",$)}),y.on("stack-item-popped",w=>{const $=w.stackItem.meta.get("v-range");$&&k.setVRange($)}),y.clear(),{undoManager:y,handleKeyboardEvent:w=>{w instanceof KeyboardEvent&&(w.ctrlKey||w.metaKey)&&(w.key==="z"||w.key==="Z")&&(w.preventDefault(),w.stopPropagation(),w.shiftKey?y.canRedo()&&y.redo():y.canUndo()&&y.undo())}}};class BaseTextCell extends BaseCellRenderer{constructor(){super(...arguments),this.showIcon=!1}get titleColumn(){const _=this.view.header.titleColumn;return assertExists(_),this.view.columnGet(_)}get isRichText(){return tRichText.is(this.titleColumn.dataType)}initVirgo(_){const y=this.getYText(this.titleColumn.getValue(this.rowId)),w=new VEditor(y);return this.vEditor=w,w.setAttributeSchema(affineTextAttributes),w.setAttributeRenderer(attributeRenderer()),w.mount(_),w}initEditingMode(_){const y=addHistoryToVEditor(_);_.disposables.addFromEvent(_.rootElement,"keydown",w=>{y.handleKeyboardEvent(w)}),_.focusEnd(),this._disposables.add(_.slots.vRangeUpdated.on(([w])=>{w?this.isEditing||this.selectCurrentCell(!0):this.isEditing&&this.selectCurrentCell(!1)}))}getYText(_){if(this.isRichText&&(_ instanceof YText||_==null)){let w=_;return w||(w=new YText,this.titleColumn?.setValue(this.rowId,w)),w}const y=new Doc().getText("title");return _ instanceof YText?_:(y.insert(0,_??""),y)}onExitEditMode(){this.isRichText||this.view.cellUpdateValue(this.rowId,this.titleColumn.id,this.isRichText?this.vEditor?.yText:this.vEditor?.yText.toString())}get icon(){const _=this.view.header.iconColumn;if(_)return this.view.columnGet(_).getValue(this.rowId)}renderIcon(){if(!this.showIcon)return;const _=this.icon;if(_)return n$5` <div class="data-view-header-area-icon">${_}</div>`}render(){return n$5` ${this.renderIcon()}
      <div class="data-view-header-area-rich-text"></div>`}}BaseTextCell.styles=styles$k;__decorate$$([n$a({attribute:!1})],BaseTextCell.prototype,"showIcon",void 0);__decorate$$([i$6(".data-view-header-area-rich-text")],BaseTextCell.prototype,"richText",void 0);let HeaderAreaTextCell=class extends BaseTextCell{init(){const _=this.initVirgo(this.richText);_.setReadonly(!0),this._disposables.add({dispose:()=>{_.unmount()}})}firstUpdated(){this.init()}connectedCallback(){super.connectedCallback(),this.richText&&this.init()}};HeaderAreaTextCell=__decorate$$([e$7("data-view-header-area-text")],HeaderAreaTextCell);let HeaderAreaTextCellEditing=class extends BaseTextCell{init(){const _=this.initVirgo(this.richText);this.initEditingMode(_),this._disposables.add({dispose:()=>{_.unmount()}})}firstUpdated(){this.init()}connectedCallback(){super.connectedCallback(),this.richText&&this.init()}};HeaderAreaTextCellEditing=__decorate$$([e$7("data-view-header-area-text-editing")],HeaderAreaTextCellEditing);const headerRenderer$1={view:map(createFromBaseCellRenderer(HeaderAreaTextCell),k=>({...k,showIcon:!1})),edit:map(createFromBaseCellRenderer(HeaderAreaTextCellEditing),k=>({...k,showIcon:!1}))};class DataViewKanbanManager extends BaseDataViewManager{constructor(_,y){super(y),this.viewSource=_,this.updateView=w=>{this.syncView(),_.updateView(w)},_.updateSlot.pipe(this.slots.update)}get view(){return this.viewSource.view}get filter(){return this.view.filter}get id(){return this.view.id}get name(){return this.view.name}updateFilter(_){this.updateView(()=>({filter:_}))}updateName(_){this.updateView(()=>({name:_}))}syncView(){this.view.columns.length!==this.columns.length&&this.viewSource.updateView(_=>({columns:this.columnsWithoutFilter.map(y=>{const w=this.columnGet(y);return{id:w.id,hide:w.hide}})}))}columnGet(_){return new DataViewKanbanColumnManager(_,this)}columnMove(_,y){this.updateView(w=>{const $=w.columns.findIndex(j=>j.id===_);if($<0)return{};const B=[...w.columns],[R]=B.splice($,1),H=insertPositionToIndex(y,B);return B.splice(H,0,R),{columns:B}})}get columns(){return this.columnsWithoutFilter.filter(_=>!this.columnGetHide(_))}get detailColumns(){return this.columnsWithoutFilter.filter(_=>this.columnGetType(_)!=="title")}get columnsWithoutFilter(){const _=new Set(this.dataSource.properties),y=[];return this.view.columns.forEach(w=>{_.has(w.id)&&(y.push(w.id),_.delete(w.id))}),y.push(..._),y}isShow(_){if(this.filter.conditions.length){const y=Object.fromEntries(this.columnManagerList.map(w=>[w.id,w.getJsonValue(_)]));return evalFilter(this.filter,y)}return!0}get readonly(){return this.viewSource.readonly}checkGroup(_,y,w){return groupByMatcher.isMatched(y,w)?!0:(this.changeGroup(_),!1)}changeGroup(_){const y=this.columnGet(_);this.updateView(w=>({groupBy:defaultGroupBy(y.id,y.type,y.data)}))}get groupHelper(){const _=this.view.groupBy;if(!_)return;const y=groupByMatcher.find(B=>B.data.name===_.name);if(!y)return;const w=y.data,$=this.columnGetDataType(_.columnId);return this.checkGroup(_.columnId,y.type,$)?new GroupHelper(_,this.view.groupProperties,B=>{this.updateView(R=>({groupProperties:B}))},w,$,this):this.groupHelper}addCard(_,y){const w=this.rowAdd(_);return this.groupHelper?.addToGroup(w,y),w}get type(){return this.view.mode}get header(){return this.view.header}isInHeader(_){const y=this.view.header;return y.titleColumn===_||y.iconColumn===_||y.coverColumn===_}hasHeader(_){const y=this.view.header;return!!y.titleColumn||!!y.iconColumn||!!y.coverColumn}getHeaderTitle(_){const y=this.view.header.titleColumn;if(y)return this.columnGet(y)}getHeaderIcon(_){const y=this.view.header.iconColumn;if(y)return this.columnGet(y)}getHeaderCover(_){const y=this.view.header.coverColumn;if(y)return this.columnGet(y)}columnUpdateHide(_,y){this.updateView(w=>({columns:w.columns.map($=>$.id===_?{...$,hide:y}:$)}))}columnGetHide(_){return this.view.columns.find(y=>y.id===_)?.hide??!1}deleteView(){this.viewSource.delete()}get isDeleted(){return this.viewSource.isDeleted()}}class DataViewKanbanColumnManager extends BaseDataViewColumnManager{constructor(_,y){super(_,y),this.dataViewManager=y}get renderer(){return this.id===this.dataViewManager.header.titleColumn?headerRenderer$1:super.renderer}}class GroupHelper{constructor(_,y,w,$,B,R){this.groupBy=_,this.properties=y,this._changeProperties=w,this.viewManager=R,this.updateData=X=>{this.viewManager.columnUpdateData(this.columnId,X)},this.groupMap=Object.fromEntries($.defaultKeys(B).map(({key:X,value:ee})=>[X,{key:X,name:$.groupName(B,ee),helper:this,type:B,value:ee,rows:[]}])),this.viewManager.rows.forEach(X=>{const ee=this.viewManager.cellGetJsonValue(X,_.columnId);$.valuesGroup(ee,B).forEach(({key:ne,value:oe})=>{this.groupMap[ne]||(this.groupMap[ne]={key:ne,name:$.groupName(B,oe),helper:this,value:oe,rows:[],type:B}),this.groupMap[ne].rows.push(X)})});const H=new Set(Object.keys(this.groupMap)),j=[],q=X=>{const ee=new Set(this.groupMap[X].rows),te=this.properties.find(oe=>oe.key===X)?.manuallyCardSort??[],ne=[];for(const oe of te)ee.has(oe)&&(ee.delete(oe),ne.push(oe));ne.push(...ee),this.groupMap[X].rows=ne};for(const X of this.properties)H.has(X.key)&&(H.delete(X.key),j.push(X.key));j.push(...H),j.forEach(q),this.groups=j.map(X=>this.groupMap[X])}get dataType(){return this.viewManager.columnGetDataType(this.groupBy.columnId)}get column(){return this.viewManager.columnGet(this.groupBy.columnId)}get columnId(){return this.groupBy.columnId}get type(){return this.viewManager.columnGetType(this.columnId)}get data(){return this.viewManager.columnGetData(this.columnId)}updateValue(_,y){_.forEach(w=>{this.viewManager.cellUpdateValue(w,this.columnId,y)})}groupConfig(){return groupByMatcher.findData(_=>_.name===this.groupBy.name)}defaultGroupProperty(_){return{key:_,hide:!1,manuallyCardSort:[]}}addToGroup(_,y){const w=this.columnId,B=(this.groupConfig()?.addToGroup??(R=>R))(this.groupMap[y].value,this.viewManager.cellGetJsonValue(_,w));this.viewManager.cellUpdateValue(_,w,B)}removeFromGroup(_,y){const w=this.columnId,B=(this.groupConfig()?.removeFromGroup??(()=>{}))(this.groupMap[y].value,this.viewManager.cellGetJsonValue(_,w));this.viewManager.cellUpdateValue(_,w,B)}changeCardSort(_,y){const w=new Map(this.properties.map(B=>[B.key,B])),$=this.properties.find(B=>B.key===_)??this.defaultGroupProperty(_);this._changeProperties(this.groups.map(B=>B.key===_?{...$,manuallyCardSort:y}:w.get(B.key)??this.defaultGroupProperty(B.key)))}changeGroupSort(_){const y=new Map(this.properties.map($=>[$.key,$])),w=_.map($=>{const B=y.get($);return B||{key:$,hide:!1,manuallyCardSort:[]}});this._changeProperties(w)}moveGroupTo(_,y){const w=this.groups.map(B=>B.key);w.splice(w.findIndex(B=>B===_),1);const $=insertPositionToIndex(y,w,B=>B);w.splice($,0,_),this.changeGroupSort(w)}moveCardTo(_,y,w,$){if(y!==w){const H=this.columnId;let q=(this.groupConfig()?.removeFromGroup??(()=>{}))(this.groupMap[y].value,this.viewManager.cellGetJsonValue(_,H));q=(this.groupConfig()?.addToGroup??(ee=>ee))(this.groupMap[w].value,q),this.viewManager.cellUpdateValue(_,H,q)}const B=this.groupMap[w].rows.filter(H=>H!==_),R=insertPositionToIndex($,B,H=>H);B.splice(R,0,_),this.changeCardSort(w,B)}get addGroup(){return this.viewManager.columnConfigManager.getColumn(this.column.type).ops.addGroup}}/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ownKeys(k,_){var y=Object.keys(k);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(k);_&&(w=w.filter(function($){return Object.getOwnPropertyDescriptor(k,$).enumerable})),y.push.apply(y,w)}return y}function _objectSpread2(k){for(var _=1;_<arguments.length;_++){var y=arguments[_]!=null?arguments[_]:{};_%2?ownKeys(Object(y),!0).forEach(function(w){_defineProperty(k,w,y[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(y)):ownKeys(Object(y)).forEach(function(w){Object.defineProperty(k,w,Object.getOwnPropertyDescriptor(y,w))})}return k}function _typeof(k){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(_){return typeof _}:_typeof=function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},_typeof(k)}function _defineProperty(k,_,y){return _ in k?Object.defineProperty(k,_,{value:y,enumerable:!0,configurable:!0,writable:!0}):k[_]=y,k}function _extends(){return _extends=Object.assign||function(k){for(var _=1;_<arguments.length;_++){var y=arguments[_];for(var w in y)Object.prototype.hasOwnProperty.call(y,w)&&(k[w]=y[w])}return k},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose(k,_){if(k==null)return{};var y={},w=Object.keys(k),$,B;for(B=0;B<w.length;B++)$=w[B],!(_.indexOf($)>=0)&&(y[$]=k[$]);return y}function _objectWithoutProperties(k,_){if(k==null)return{};var y=_objectWithoutPropertiesLoose(k,_),w,$;if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(k);for($=0;$<B.length;$++)w=B[$],!(_.indexOf(w)>=0)&&Object.prototype.propertyIsEnumerable.call(k,w)&&(y[w]=k[w])}return y}var version="1.15.0";function userAgent(k){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(k)}var IE11OrLess=userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Edge=userAgent(/Edge/i),FireFox=userAgent(/firefox/i),Safari=userAgent(/safari/i)&&!userAgent(/chrome/i)&&!userAgent(/android/i),IOS=userAgent(/iP(ad|od|hone)/i),ChromeForAndroid=userAgent(/chrome/i)&&userAgent(/android/i),captureMode={capture:!1,passive:!1};function on(k,_,y){k.addEventListener(_,y,!IE11OrLess&&captureMode)}function off(k,_,y){k.removeEventListener(_,y,!IE11OrLess&&captureMode)}function matches(k,_){if(_){if(_[0]===">"&&(_=_.substring(1)),k)try{if(k.matches)return k.matches(_);if(k.msMatchesSelector)return k.msMatchesSelector(_);if(k.webkitMatchesSelector)return k.webkitMatchesSelector(_)}catch{return!1}return!1}}function getParentOrHost(k){return k.host&&k!==document&&k.host.nodeType?k.host:k.parentNode}function closest(k,_,y,w){if(k){y=y||document;do{if(_!=null&&(_[0]===">"?k.parentNode===y&&matches(k,_):matches(k,_))||w&&k===y)return k;if(k===y)break}while(k=getParentOrHost(k))}return null}var R_SPACE=/\s+/g;function toggleClass(k,_,y){if(k&&_)if(k.classList)k.classList[y?"add":"remove"](_);else{var w=(" "+k.className+" ").replace(R_SPACE," ").replace(" "+_+" "," ");k.className=(w+(y?" "+_:"")).replace(R_SPACE," ")}}function css(k,_,y){var w=k&&k.style;if(w){if(y===void 0)return document.defaultView&&document.defaultView.getComputedStyle?y=document.defaultView.getComputedStyle(k,""):k.currentStyle&&(y=k.currentStyle),_===void 0?y:y[_];!(_ in w)&&_.indexOf("webkit")===-1&&(_="-webkit-"+_),w[_]=y+(typeof y=="string"?"":"px")}}function matrix(k,_){var y="";if(typeof k=="string")y=k;else do{var w=css(k,"transform");w&&w!=="none"&&(y=w+" "+y)}while(!_&&(k=k.parentNode));var $=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return $&&new $(y)}function find(k,_,y){if(k){var w=k.getElementsByTagName(_),$=0,B=w.length;if(y)for(;$<B;$++)y(w[$],$);return w}return[]}function getWindowScrollingElement(){var k=document.scrollingElement;return k||document.documentElement}function getRect(k,_,y,w,$){if(!(!k.getBoundingClientRect&&k!==window)){var B,R,H,j,q,X,ee;if(k!==window&&k.parentNode&&k!==getWindowScrollingElement()?(B=k.getBoundingClientRect(),R=B.top,H=B.left,j=B.bottom,q=B.right,X=B.height,ee=B.width):(R=0,H=0,j=window.innerHeight,q=window.innerWidth,X=window.innerHeight,ee=window.innerWidth),(_||y)&&k!==window&&($=$||k.parentNode,!IE11OrLess))do if($&&$.getBoundingClientRect&&(css($,"transform")!=="none"||y&&css($,"position")!=="static")){var te=$.getBoundingClientRect();R-=te.top+parseInt(css($,"border-top-width")),H-=te.left+parseInt(css($,"border-left-width")),j=R+B.height,q=H+B.width;break}while($=$.parentNode);if(w&&k!==window){var ne=matrix($||k),oe=ne&&ne.a,ie=ne&&ne.d;ne&&(R/=ie,H/=oe,ee/=oe,X/=ie,j=R+X,q=H+ee)}return{top:R,left:H,bottom:j,right:q,width:ee,height:X}}}function isScrolledPast(k,_,y){for(var w=getParentAutoScrollElement(k,!0),$=getRect(k)[_];w;){var B=getRect(w)[y],R=void 0;if(y==="top"||y==="left"?R=$>=B:R=$<=B,!R)return w;if(w===getWindowScrollingElement())break;w=getParentAutoScrollElement(w,!1)}return!1}function getChild(k,_,y,w){for(var $=0,B=0,R=k.children;B<R.length;){if(R[B].style.display!=="none"&&R[B]!==Sortable.ghost&&(w||R[B]!==Sortable.dragged)&&closest(R[B],y.draggable,k,!1)){if($===_)return R[B];$++}B++}return null}function lastChild(k,_){for(var y=k.lastElementChild;y&&(y===Sortable.ghost||css(y,"display")==="none"||_&&!matches(y,_));)y=y.previousElementSibling;return y||null}function index$1(k,_){var y=0;if(!k||!k.parentNode)return-1;for(;k=k.previousElementSibling;)k.nodeName.toUpperCase()!=="TEMPLATE"&&k!==Sortable.clone&&(!_||matches(k,_))&&y++;return y}function getRelativeScrollOffset(k){var _=0,y=0,w=getWindowScrollingElement();if(k)do{var $=matrix(k),B=$.a,R=$.d;_+=k.scrollLeft*B,y+=k.scrollTop*R}while(k!==w&&(k=k.parentNode));return[_,y]}function indexOfObject(k,_){for(var y in k)if(k.hasOwnProperty(y)){for(var w in _)if(_.hasOwnProperty(w)&&_[w]===k[y][w])return Number(y)}return-1}function getParentAutoScrollElement(k,_){if(!k||!k.getBoundingClientRect)return getWindowScrollingElement();var y=k,w=!1;do if(y.clientWidth<y.scrollWidth||y.clientHeight<y.scrollHeight){var $=css(y);if(y.clientWidth<y.scrollWidth&&($.overflowX=="auto"||$.overflowX=="scroll")||y.clientHeight<y.scrollHeight&&($.overflowY=="auto"||$.overflowY=="scroll")){if(!y.getBoundingClientRect||y===document.body)return getWindowScrollingElement();if(w||_)return y;w=!0}}while(y=y.parentNode);return getWindowScrollingElement()}function extend(k,_){if(k&&_)for(var y in _)_.hasOwnProperty(y)&&(k[y]=_[y]);return k}function isRectEqual(k,_){return Math.round(k.top)===Math.round(_.top)&&Math.round(k.left)===Math.round(_.left)&&Math.round(k.height)===Math.round(_.height)&&Math.round(k.width)===Math.round(_.width)}var _throttleTimeout;function throttle(k,_){return function(){if(!_throttleTimeout){var y=arguments,w=this;y.length===1?k.call(w,y[0]):k.apply(w,y),_throttleTimeout=setTimeout(function(){_throttleTimeout=void 0},_)}}}function cancelThrottle(){clearTimeout(_throttleTimeout),_throttleTimeout=void 0}function scrollBy(k,_,y){k.scrollLeft+=_,k.scrollTop+=y}function clone(k){var _=window.Polymer,y=window.jQuery||window.Zepto;return _&&_.dom?_.dom(k).cloneNode(!0):y?y(k).clone(!0)[0]:k.cloneNode(!0)}var expando="Sortable"+new Date().getTime();function AnimationStateManager(){var k=[],_;return{captureAnimationState:function(){if(k=[],!!this.options.animation){var w=[].slice.call(this.el.children);w.forEach(function($){if(!(css($,"display")==="none"||$===Sortable.ghost)){k.push({target:$,rect:getRect($)});var B=_objectSpread2({},k[k.length-1].rect);if($.thisAnimationDuration){var R=matrix($,!0);R&&(B.top-=R.f,B.left-=R.e)}$.fromRect=B}})}},addAnimationState:function(w){k.push(w)},removeAnimationState:function(w){k.splice(indexOfObject(k,{target:w}),1)},animateAll:function(w){var $=this;if(!this.options.animation){clearTimeout(_),typeof w=="function"&&w();return}var B=!1,R=0;k.forEach(function(H){var j=0,q=H.target,X=q.fromRect,ee=getRect(q),te=q.prevFromRect,ne=q.prevToRect,oe=H.rect,ie=matrix(q,!0);ie&&(ee.top-=ie.f,ee.left-=ie.e),q.toRect=ee,q.thisAnimationDuration&&isRectEqual(te,ee)&&!isRectEqual(X,ee)&&(oe.top-ee.top)/(oe.left-ee.left)===(X.top-ee.top)/(X.left-ee.left)&&(j=calculateRealTime(oe,te,ne,$.options)),isRectEqual(ee,X)||(q.prevFromRect=X,q.prevToRect=ee,j||(j=$.options.animation),$.animate(q,oe,ee,j)),j&&(B=!0,R=Math.max(R,j),clearTimeout(q.animationResetTimer),q.animationResetTimer=setTimeout(function(){q.animationTime=0,q.prevFromRect=null,q.fromRect=null,q.prevToRect=null,q.thisAnimationDuration=null},j),q.thisAnimationDuration=j)}),clearTimeout(_),B?_=setTimeout(function(){typeof w=="function"&&w()},R):typeof w=="function"&&w(),k=[]},animate:function(w,$,B,R){if(R){css(w,"transition",""),css(w,"transform","");var H=matrix(this.el),j=H&&H.a,q=H&&H.d,X=($.left-B.left)/(j||1),ee=($.top-B.top)/(q||1);w.animatingX=!!X,w.animatingY=!!ee,css(w,"transform","translate3d("+X+"px,"+ee+"px,0)"),this.forRepaintDummy=repaint(w),css(w,"transition","transform "+R+"ms"+(this.options.easing?" "+this.options.easing:"")),css(w,"transform","translate3d(0,0,0)"),typeof w.animated=="number"&&clearTimeout(w.animated),w.animated=setTimeout(function(){css(w,"transition",""),css(w,"transform",""),w.animated=!1,w.animatingX=!1,w.animatingY=!1},R)}}}}function repaint(k){return k.offsetWidth}function calculateRealTime(k,_,y,w){return Math.sqrt(Math.pow(_.top-k.top,2)+Math.pow(_.left-k.left,2))/Math.sqrt(Math.pow(_.top-y.top,2)+Math.pow(_.left-y.left,2))*w.animation}var plugins=[],defaults={initializeByDefault:!0},PluginManager={mount:function k(_){for(var y in defaults)defaults.hasOwnProperty(y)&&!(y in _)&&(_[y]=defaults[y]);plugins.forEach(function(w){if(w.pluginName===_.pluginName)throw"Sortable: Cannot mount plugin ".concat(_.pluginName," more than once")}),plugins.push(_)},pluginEvent:function k(_,y,w){var $=this;this.eventCanceled=!1,w.cancel=function(){$.eventCanceled=!0};var B=_+"Global";plugins.forEach(function(R){y[R.pluginName]&&(y[R.pluginName][B]&&y[R.pluginName][B](_objectSpread2({sortable:y},w)),y.options[R.pluginName]&&y[R.pluginName][_]&&y[R.pluginName][_](_objectSpread2({sortable:y},w)))})},initializePlugins:function k(_,y,w,$){plugins.forEach(function(H){var j=H.pluginName;if(!(!_.options[j]&&!H.initializeByDefault)){var q=new H(_,y,_.options);q.sortable=_,q.options=_.options,_[j]=q,_extends(w,q.defaults)}});for(var B in _.options)if(_.options.hasOwnProperty(B)){var R=this.modifyOption(_,B,_.options[B]);typeof R<"u"&&(_.options[B]=R)}},getEventProperties:function k(_,y){var w={};return plugins.forEach(function($){typeof $.eventProperties=="function"&&_extends(w,$.eventProperties.call(y[$.pluginName],_))}),w},modifyOption:function k(_,y,w){var $;return plugins.forEach(function(B){_[B.pluginName]&&B.optionListeners&&typeof B.optionListeners[y]=="function"&&($=B.optionListeners[y].call(_[B.pluginName],w))}),$}};function dispatchEvent(k){var _=k.sortable,y=k.rootEl,w=k.name,$=k.targetEl,B=k.cloneEl,R=k.toEl,H=k.fromEl,j=k.oldIndex,q=k.newIndex,X=k.oldDraggableIndex,ee=k.newDraggableIndex,te=k.originalEvent,ne=k.putSortable,oe=k.extraEventProperties;if(_=_||y&&y[expando],!!_){var ie,ae=_.options,re="on"+w.charAt(0).toUpperCase()+w.substr(1);window.CustomEvent&&!IE11OrLess&&!Edge?ie=new CustomEvent(w,{bubbles:!0,cancelable:!0}):(ie=document.createEvent("Event"),ie.initEvent(w,!0,!0)),ie.to=R||y,ie.from=H||y,ie.item=$||y,ie.clone=B,ie.oldIndex=j,ie.newIndex=q,ie.oldDraggableIndex=X,ie.newDraggableIndex=ee,ie.originalEvent=te,ie.pullMode=ne?ne.lastPutMode:void 0;var se=_objectSpread2(_objectSpread2({},oe),PluginManager.getEventProperties(w,_));for(var le in se)ie[le]=se[le];y&&y.dispatchEvent(ie),ae[re]&&ae[re].call(_,ie)}}var _excluded=["evt"],pluginEvent=function k(_,y){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},$=w.evt,B=_objectWithoutProperties(w,_excluded);PluginManager.pluginEvent.bind(Sortable)(_,y,_objectSpread2({dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,dragStarted:moved,putSortable,activeSortable:Sortable.active,originalEvent:$,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex,hideGhostForTarget:_hideGhostForTarget,unhideGhostForTarget:_unhideGhostForTarget,cloneNowHidden:function(){cloneHidden=!0},cloneNowShown:function(){cloneHidden=!1},dispatchSortableEvent:function(H){_dispatchEvent({sortable:y,name:H,originalEvent:$})}},B))};function _dispatchEvent(k){dispatchEvent(_objectSpread2({putSortable,cloneEl,targetEl:dragEl,rootEl,oldIndex,oldDraggableIndex,newIndex,newDraggableIndex},k))}var dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,oldIndex,newIndex,oldDraggableIndex,newDraggableIndex,activeGroup,putSortable,awaitingDragStarted=!1,ignoreNextClick=!1,sortables=[],tapEvt,touchEvt,lastDx,lastDy,tapDistanceLeft,tapDistanceTop,moved,lastTarget,lastDirection,pastFirstInvertThresh=!1,isCircumstantialInvert=!1,targetMoveDistance,ghostRelativeParent,ghostRelativeParentInitialScroll=[],_silent=!1,savedInputChecked=[],documentExists=typeof document<"u",PositionGhostAbsolutely=IOS,CSSFloatProperty=Edge||IE11OrLess?"cssFloat":"float",supportDraggable=documentExists&&!ChromeForAndroid&&!IOS&&"draggable"in document.createElement("div"),supportCssPointerEvents=function(){if(documentExists){if(IE11OrLess)return!1;var k=document.createElement("x");return k.style.cssText="pointer-events:auto",k.style.pointerEvents==="auto"}}(),_detectDirection=function k(_,y){var w=css(_),$=parseInt(w.width)-parseInt(w.paddingLeft)-parseInt(w.paddingRight)-parseInt(w.borderLeftWidth)-parseInt(w.borderRightWidth),B=getChild(_,0,y),R=getChild(_,1,y),H=B&&css(B),j=R&&css(R),q=H&&parseInt(H.marginLeft)+parseInt(H.marginRight)+getRect(B).width,X=j&&parseInt(j.marginLeft)+parseInt(j.marginRight)+getRect(R).width;if(w.display==="flex")return w.flexDirection==="column"||w.flexDirection==="column-reverse"?"vertical":"horizontal";if(w.display==="grid")return w.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(B&&H.float&&H.float!=="none"){var ee=H.float==="left"?"left":"right";return R&&(j.clear==="both"||j.clear===ee)?"vertical":"horizontal"}return B&&(H.display==="block"||H.display==="flex"||H.display==="table"||H.display==="grid"||q>=$&&w[CSSFloatProperty]==="none"||R&&w[CSSFloatProperty]==="none"&&q+X>$)?"vertical":"horizontal"},_dragElInRowColumn=function k(_,y,w){var $=w?_.left:_.top,B=w?_.right:_.bottom,R=w?_.width:_.height,H=w?y.left:y.top,j=w?y.right:y.bottom,q=w?y.width:y.height;return $===H||B===j||$+R/2===H+q/2},_detectNearestEmptySortable=function k(_,y){var w;return sortables.some(function($){var B=$[expando].options.emptyInsertThreshold;if(!(!B||lastChild($))){var R=getRect($),H=_>=R.left-B&&_<=R.right+B,j=y>=R.top-B&&y<=R.bottom+B;if(H&&j)return w=$}}),w},_prepareGroup=function k(_){function y(B,R){return function(H,j,q,X){var ee=H.options.group.name&&j.options.group.name&&H.options.group.name===j.options.group.name;if(B==null&&(R||ee))return!0;if(B==null||B===!1)return!1;if(R&&B==="clone")return B;if(typeof B=="function")return y(B(H,j,q,X),R)(H,j,q,X);var te=(R?H:j).options.group.name;return B===!0||typeof B=="string"&&B===te||B.join&&B.indexOf(te)>-1}}var w={},$=_.group;(!$||_typeof($)!="object")&&($={name:$}),w.name=$.name,w.checkPull=y($.pull,!0),w.checkPut=y($.put),w.revertClone=$.revertClone,_.group=w},_hideGhostForTarget=function k(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","none")},_unhideGhostForTarget=function k(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","")};documentExists&&!ChromeForAndroid&&document.addEventListener("click",function(k){if(ignoreNextClick)return k.preventDefault(),k.stopPropagation&&k.stopPropagation(),k.stopImmediatePropagation&&k.stopImmediatePropagation(),ignoreNextClick=!1,!1},!0);var nearestEmptyInsertDetectEvent=function k(_){if(dragEl){_=_.touches?_.touches[0]:_;var y=_detectNearestEmptySortable(_.clientX,_.clientY);if(y){var w={};for(var $ in _)_.hasOwnProperty($)&&(w[$]=_[$]);w.target=w.rootEl=y,w.preventDefault=void 0,w.stopPropagation=void 0,y[expando]._onDragOver(w)}}},_checkOutsideTargetEl=function k(_){dragEl&&dragEl.parentNode[expando]._isOutsideThisEl(_.target)};function Sortable(k,_){if(!(k&&k.nodeType&&k.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(k));this.el=k,this.options=_=_extends({},_),k[expando]=this;var y={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(k.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _detectDirection(k,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(R,H){R.setData("Text",H.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Sortable.supportPointer!==!1&&"PointerEvent"in window&&!Safari,emptyInsertThreshold:5};PluginManager.initializePlugins(this,k,y);for(var w in y)!(w in _)&&(_[w]=y[w]);_prepareGroup(_);for(var $ in this)$.charAt(0)==="_"&&typeof this[$]=="function"&&(this[$]=this[$].bind(this));this.nativeDraggable=_.forceFallback?!1:supportDraggable,this.nativeDraggable&&(this.options.touchStartThreshold=1),_.supportPointer?on(k,"pointerdown",this._onTapStart):(on(k,"mousedown",this._onTapStart),on(k,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(k,"dragover",this),on(k,"dragenter",this)),sortables.push(this.el),_.store&&_.store.get&&this.sort(_.store.get(this)||[]),_extends(this,AnimationStateManager())}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function k(_){!this.el.contains(_)&&_!==this.el&&(lastTarget=null)},_getDirection:function k(_,y){return typeof this.options.direction=="function"?this.options.direction.call(this,_,y,dragEl):this.options.direction},_onTapStart:function k(_){if(_.cancelable){var y=this,w=this.el,$=this.options,B=$.preventOnFilter,R=_.type,H=_.touches&&_.touches[0]||_.pointerType&&_.pointerType==="touch"&&_,j=(H||_).target,q=_.target.shadowRoot&&(_.path&&_.path[0]||_.composedPath&&_.composedPath()[0])||j,X=$.filter;if(_saveInputCheckedState(w),!dragEl&&!(/mousedown|pointerdown/.test(R)&&_.button!==0||$.disabled)&&!q.isContentEditable&&!(!this.nativeDraggable&&Safari&&j&&j.tagName.toUpperCase()==="SELECT")&&(j=closest(j,$.draggable,w,!1),!(j&&j.animated)&&lastDownEl!==j)){if(oldIndex=index$1(j),oldDraggableIndex=index$1(j,$.draggable),typeof X=="function"){if(X.call(this,_,j,this)){_dispatchEvent({sortable:y,rootEl:q,name:"filter",targetEl:j,toEl:w,fromEl:w}),pluginEvent("filter",y,{evt:_}),B&&_.cancelable&&_.preventDefault();return}}else if(X&&(X=X.split(",").some(function(ee){if(ee=closest(q,ee.trim(),w,!1),ee)return _dispatchEvent({sortable:y,rootEl:ee,name:"filter",targetEl:j,fromEl:w,toEl:w}),pluginEvent("filter",y,{evt:_}),!0}),X)){B&&_.cancelable&&_.preventDefault();return}$.handle&&!closest(q,$.handle,w,!1)||this._prepareDragStart(_,H,j)}}},_prepareDragStart:function k(_,y,w){var $=this,B=$.el,R=$.options,H=B.ownerDocument,j;if(w&&!dragEl&&w.parentNode===B){var q=getRect(w);if(rootEl=B,dragEl=w,parentEl=dragEl.parentNode,nextEl=dragEl.nextSibling,lastDownEl=w,activeGroup=R.group,Sortable.dragged=dragEl,tapEvt={target:dragEl,clientX:(y||_).clientX,clientY:(y||_).clientY},tapDistanceLeft=tapEvt.clientX-q.left,tapDistanceTop=tapEvt.clientY-q.top,this._lastX=(y||_).clientX,this._lastY=(y||_).clientY,dragEl.style["will-change"]="all",j=function(){if(pluginEvent("delayEnded",$,{evt:_}),Sortable.eventCanceled){$._onDrop();return}$._disableDelayedDragEvents(),!FireFox&&$.nativeDraggable&&(dragEl.draggable=!0),$._triggerDragStart(_,y),_dispatchEvent({sortable:$,name:"choose",originalEvent:_}),toggleClass(dragEl,R.chosenClass,!0)},R.ignore.split(",").forEach(function(X){find(dragEl,X.trim(),_disableDraggable)}),on(H,"dragover",nearestEmptyInsertDetectEvent),on(H,"mousemove",nearestEmptyInsertDetectEvent),on(H,"touchmove",nearestEmptyInsertDetectEvent),on(H,"mouseup",$._onDrop),on(H,"touchend",$._onDrop),on(H,"touchcancel",$._onDrop),FireFox&&this.nativeDraggable&&(this.options.touchStartThreshold=4,dragEl.draggable=!0),pluginEvent("delayStart",this,{evt:_}),R.delay&&(!R.delayOnTouchOnly||y)&&(!this.nativeDraggable||!(Edge||IE11OrLess))){if(Sortable.eventCanceled){this._onDrop();return}on(H,"mouseup",$._disableDelayedDrag),on(H,"touchend",$._disableDelayedDrag),on(H,"touchcancel",$._disableDelayedDrag),on(H,"mousemove",$._delayedDragTouchMoveHandler),on(H,"touchmove",$._delayedDragTouchMoveHandler),R.supportPointer&&on(H,"pointermove",$._delayedDragTouchMoveHandler),$._dragStartTimer=setTimeout(j,R.delay)}else j()}},_delayedDragTouchMoveHandler:function k(_){var y=_.touches?_.touches[0]:_;Math.max(Math.abs(y.clientX-this._lastX),Math.abs(y.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function k(){dragEl&&_disableDraggable(dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function k(){var _=this.el.ownerDocument;off(_,"mouseup",this._disableDelayedDrag),off(_,"touchend",this._disableDelayedDrag),off(_,"touchcancel",this._disableDelayedDrag),off(_,"mousemove",this._delayedDragTouchMoveHandler),off(_,"touchmove",this._delayedDragTouchMoveHandler),off(_,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function k(_,y){y=y||_.pointerType=="touch"&&_,!this.nativeDraggable||y?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):y?on(document,"touchmove",this._onTouchMove):on(document,"mousemove",this._onTouchMove):(on(dragEl,"dragend",this),on(rootEl,"dragstart",this._onDragStart));try{document.selection?_nextTick(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function k(_,y){if(awaitingDragStarted=!1,rootEl&&dragEl){pluginEvent("dragStarted",this,{evt:y}),this.nativeDraggable&&on(document,"dragover",_checkOutsideTargetEl);var w=this.options;!_&&toggleClass(dragEl,w.dragClass,!1),toggleClass(dragEl,w.ghostClass,!0),Sortable.active=this,_&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:y})}else this._nulling()},_emulateDragOver:function k(){if(touchEvt){this._lastX=touchEvt.clientX,this._lastY=touchEvt.clientY,_hideGhostForTarget();for(var _=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),y=_;_&&_.shadowRoot&&(_=_.shadowRoot.elementFromPoint(touchEvt.clientX,touchEvt.clientY),_!==y);)y=_;if(dragEl.parentNode[expando]._isOutsideThisEl(_),y)do{if(y[expando]){var w=void 0;if(w=y[expando]._onDragOver({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:_,rootEl:y}),w&&!this.options.dragoverBubble)break}_=y}while(y=y.parentNode);_unhideGhostForTarget()}},_onTouchMove:function k(_){if(tapEvt){var y=this.options,w=y.fallbackTolerance,$=y.fallbackOffset,B=_.touches?_.touches[0]:_,R=ghostEl&&matrix(ghostEl,!0),H=ghostEl&&R&&R.a,j=ghostEl&&R&&R.d,q=PositionGhostAbsolutely&&ghostRelativeParent&&getRelativeScrollOffset(ghostRelativeParent),X=(B.clientX-tapEvt.clientX+$.x)/(H||1)+(q?q[0]-ghostRelativeParentInitialScroll[0]:0)/(H||1),ee=(B.clientY-tapEvt.clientY+$.y)/(j||1)+(q?q[1]-ghostRelativeParentInitialScroll[1]:0)/(j||1);if(!Sortable.active&&!awaitingDragStarted){if(w&&Math.max(Math.abs(B.clientX-this._lastX),Math.abs(B.clientY-this._lastY))<w)return;this._onDragStart(_,!0)}if(ghostEl){R?(R.e+=X-(lastDx||0),R.f+=ee-(lastDy||0)):R={a:1,b:0,c:0,d:1,e:X,f:ee};var te="matrix(".concat(R.a,",").concat(R.b,",").concat(R.c,",").concat(R.d,",").concat(R.e,",").concat(R.f,")");css(ghostEl,"webkitTransform",te),css(ghostEl,"mozTransform",te),css(ghostEl,"msTransform",te),css(ghostEl,"transform",te),lastDx=X,lastDy=ee,touchEvt=B}_.cancelable&&_.preventDefault()}},_appendGhost:function k(){if(!ghostEl){var _=this.options.fallbackOnBody?document.body:rootEl,y=getRect(dragEl,!0,PositionGhostAbsolutely,!0,_),w=this.options;if(PositionGhostAbsolutely){for(ghostRelativeParent=_;css(ghostRelativeParent,"position")==="static"&&css(ghostRelativeParent,"transform")==="none"&&ghostRelativeParent!==document;)ghostRelativeParent=ghostRelativeParent.parentNode;ghostRelativeParent!==document.body&&ghostRelativeParent!==document.documentElement?(ghostRelativeParent===document&&(ghostRelativeParent=getWindowScrollingElement()),y.top+=ghostRelativeParent.scrollTop,y.left+=ghostRelativeParent.scrollLeft):ghostRelativeParent=getWindowScrollingElement(),ghostRelativeParentInitialScroll=getRelativeScrollOffset(ghostRelativeParent)}ghostEl=dragEl.cloneNode(!0),toggleClass(ghostEl,w.ghostClass,!1),toggleClass(ghostEl,w.fallbackClass,!0),toggleClass(ghostEl,w.dragClass,!0),css(ghostEl,"transition",""),css(ghostEl,"transform",""),css(ghostEl,"box-sizing","border-box"),css(ghostEl,"margin",0),css(ghostEl,"top",y.top),css(ghostEl,"left",y.left),css(ghostEl,"width",y.width),css(ghostEl,"height",y.height),css(ghostEl,"opacity","0.8"),css(ghostEl,"position",PositionGhostAbsolutely?"absolute":"fixed"),css(ghostEl,"zIndex","100000"),css(ghostEl,"pointerEvents","none"),Sortable.ghost=ghostEl,_.appendChild(ghostEl),css(ghostEl,"transform-origin",tapDistanceLeft/parseInt(ghostEl.style.width)*100+"% "+tapDistanceTop/parseInt(ghostEl.style.height)*100+"%")}},_onDragStart:function k(_,y){var w=this,$=_.dataTransfer,B=w.options;if(pluginEvent("dragStart",this,{evt:_}),Sortable.eventCanceled){this._onDrop();return}pluginEvent("setupClone",this),Sortable.eventCanceled||(cloneEl=clone(dragEl),cloneEl.removeAttribute("id"),cloneEl.draggable=!1,cloneEl.style["will-change"]="",this._hideClone(),toggleClass(cloneEl,this.options.chosenClass,!1),Sortable.clone=cloneEl),w.cloneId=_nextTick(function(){pluginEvent("clone",w),!Sortable.eventCanceled&&(w.options.removeCloneOnHide||rootEl.insertBefore(cloneEl,dragEl),w._hideClone(),_dispatchEvent({sortable:w,name:"clone"}))}),!y&&toggleClass(dragEl,B.dragClass,!0),y?(ignoreNextClick=!0,w._loopId=setInterval(w._emulateDragOver,50)):(off(document,"mouseup",w._onDrop),off(document,"touchend",w._onDrop),off(document,"touchcancel",w._onDrop),$&&($.effectAllowed="move",B.setData&&B.setData.call(w,$,dragEl)),on(document,"drop",w),css(dragEl,"transform","translateZ(0)")),awaitingDragStarted=!0,w._dragStartId=_nextTick(w._dragStarted.bind(w,y,_)),on(document,"selectstart",w),moved=!0,Safari&&css(document.body,"user-select","none")},_onDragOver:function k(_){var y=this.el,w=_.target,$,B,R,H=this.options,j=H.group,q=Sortable.active,X=activeGroup===j,ee=H.sort,te=putSortable||q,ne,oe=this,ie=!1;if(_silent)return;function ae(Ze,Re){pluginEvent(Ze,oe,_objectSpread2({evt:_,isOwner:X,axis:ne?"vertical":"horizontal",revert:R,dragRect:$,targetRect:B,canSort:ee,fromSortable:te,target:w,completed:se,onMove:function(Me,Pe){return _onMove(rootEl,y,dragEl,$,Me,getRect(Me),_,Pe)},changed:le},Re))}function re(){ae("dragOverAnimationCapture"),oe.captureAnimationState(),oe!==te&&te.captureAnimationState()}function se(Ze){return ae("dragOverCompleted",{insertion:Ze}),Ze&&(X?q._hideClone():q._showClone(oe),oe!==te&&(toggleClass(dragEl,putSortable?putSortable.options.ghostClass:q.options.ghostClass,!1),toggleClass(dragEl,H.ghostClass,!0)),putSortable!==oe&&oe!==Sortable.active?putSortable=oe:oe===Sortable.active&&putSortable&&(putSortable=null),te===oe&&(oe._ignoreWhileAnimating=w),oe.animateAll(function(){ae("dragOverAnimationComplete"),oe._ignoreWhileAnimating=null}),oe!==te&&(te.animateAll(),te._ignoreWhileAnimating=null)),(w===dragEl&&!dragEl.animated||w===y&&!w.animated)&&(lastTarget=null),!H.dragoverBubble&&!_.rootEl&&w!==document&&(dragEl.parentNode[expando]._isOutsideThisEl(_.target),!Ze&&nearestEmptyInsertDetectEvent(_)),!H.dragoverBubble&&_.stopPropagation&&_.stopPropagation(),ie=!0}function le(){newIndex=index$1(dragEl),newDraggableIndex=index$1(dragEl,H.draggable),_dispatchEvent({sortable:oe,name:"change",toEl:y,newIndex,newDraggableIndex,originalEvent:_})}if(_.preventDefault!==void 0&&_.cancelable&&_.preventDefault(),w=closest(w,H.draggable,y,!0),ae("dragOver"),Sortable.eventCanceled)return ie;if(dragEl.contains(_.target)||w.animated&&w.animatingX&&w.animatingY||oe._ignoreWhileAnimating===w)return se(!1);if(ignoreNextClick=!1,q&&!H.disabled&&(X?ee||(R=parentEl!==rootEl):putSortable===this||(this.lastPutMode=activeGroup.checkPull(this,q,dragEl,_))&&j.checkPut(this,q,dragEl,_))){if(ne=this._getDirection(_,w)==="vertical",$=getRect(dragEl),ae("dragOverValid"),Sortable.eventCanceled)return ie;if(R)return parentEl=rootEl,re(),this._hideClone(),ae("revert"),Sortable.eventCanceled||(nextEl?rootEl.insertBefore(dragEl,nextEl):rootEl.appendChild(dragEl)),se(!0);var ue=lastChild(y,H.draggable);if(!ue||_ghostIsLast(_,ne,this)&&!ue.animated){if(ue===dragEl)return se(!1);if(ue&&y===_.target&&(w=ue),w&&(B=getRect(w)),_onMove(rootEl,y,dragEl,$,w,B,_,!!w)!==!1)return re(),ue&&ue.nextSibling?y.insertBefore(dragEl,ue.nextSibling):y.appendChild(dragEl),parentEl=y,le(),se(!0)}else if(ue&&_ghostIsFirst(_,ne,this)){var he=getChild(y,0,H,!0);if(he===dragEl)return se(!1);if(w=he,B=getRect(w),_onMove(rootEl,y,dragEl,$,w,B,_,!1)!==!1)return re(),y.insertBefore(dragEl,he),parentEl=y,le(),se(!0)}else if(w.parentNode===y){B=getRect(w);var ce=0,ge,be=dragEl.parentNode!==y,fe=!_dragElInRowColumn(dragEl.animated&&dragEl.toRect||$,w.animated&&w.toRect||B,ne),we=ne?"top":"left",Ce=isScrolledPast(w,"top","top")||isScrolledPast(dragEl,"top","top"),ve=Ce?Ce.scrollTop:void 0;lastTarget!==w&&(ge=B[we],pastFirstInvertThresh=!1,isCircumstantialInvert=!fe&&H.invertSwap||be),ce=_getSwapDirection(_,w,B,ne,fe?1:H.swapThreshold,H.invertedSwapThreshold==null?H.swapThreshold:H.invertedSwapThreshold,isCircumstantialInvert,lastTarget===w);var ke;if(ce!==0){var me=index$1(dragEl);do me-=ce,ke=parentEl.children[me];while(ke&&(css(ke,"display")==="none"||ke===ghostEl))}if(ce===0||ke===w)return se(!1);lastTarget=w,lastDirection=ce;var Ie=w.nextElementSibling,Fe=!1;Fe=ce===1;var Be=_onMove(rootEl,y,dragEl,$,w,B,_,Fe);if(Be!==!1)return(Be===1||Be===-1)&&(Fe=Be===1),_silent=!0,setTimeout(_unsilent,30),re(),Fe&&!Ie?y.appendChild(dragEl):w.parentNode.insertBefore(dragEl,Fe?Ie:w),Ce&&scrollBy(Ce,0,ve-Ce.scrollTop),parentEl=dragEl.parentNode,ge!==void 0&&!isCircumstantialInvert&&(targetMoveDistance=Math.abs(ge-getRect(w)[we])),le(),se(!0)}if(y.contains(dragEl))return se(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function k(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",nearestEmptyInsertDetectEvent),off(document,"mousemove",nearestEmptyInsertDetectEvent),off(document,"touchmove",nearestEmptyInsertDetectEvent)},_offUpEvents:function k(){var _=this.el.ownerDocument;off(_,"mouseup",this._onDrop),off(_,"touchend",this._onDrop),off(_,"pointerup",this._onDrop),off(_,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function k(_){var y=this.el,w=this.options;if(newIndex=index$1(dragEl),newDraggableIndex=index$1(dragEl,w.draggable),pluginEvent("drop",this,{evt:_}),parentEl=dragEl&&dragEl.parentNode,newIndex=index$1(dragEl),newDraggableIndex=index$1(dragEl,w.draggable),Sortable.eventCanceled){this._nulling();return}awaitingDragStarted=!1,isCircumstantialInvert=!1,pastFirstInvertThresh=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(y,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Safari&&css(document.body,"user-select",""),css(dragEl,"transform",""),_&&(moved&&(_.cancelable&&_.preventDefault(),!w.dropBubble&&_.stopPropagation()),ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl),(rootEl===parentEl||putSortable&&putSortable.lastPutMode!=="clone")&&cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),dragEl&&(this.nativeDraggable&&off(dragEl,"dragend",this),_disableDraggable(dragEl),dragEl.style["will-change"]="",moved&&!awaitingDragStarted&&toggleClass(dragEl,putSortable?putSortable.options.ghostClass:this.options.ghostClass,!1),toggleClass(dragEl,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:parentEl,newIndex:null,newDraggableIndex:null,originalEvent:_}),rootEl!==parentEl?(newIndex>=0&&(_dispatchEvent({rootEl:parentEl,name:"add",toEl:parentEl,fromEl:rootEl,originalEvent:_}),_dispatchEvent({sortable:this,name:"remove",toEl:parentEl,originalEvent:_}),_dispatchEvent({rootEl:parentEl,name:"sort",toEl:parentEl,fromEl:rootEl,originalEvent:_}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:_})),putSortable&&putSortable.save()):newIndex!==oldIndex&&newIndex>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:parentEl,originalEvent:_}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:_})),Sortable.active&&((newIndex==null||newIndex===-1)&&(newIndex=oldIndex,newDraggableIndex=oldDraggableIndex),_dispatchEvent({sortable:this,name:"end",toEl:parentEl,originalEvent:_}),this.save()))),this._nulling()},_nulling:function k(){pluginEvent("nulling",this),rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=cloneHidden=tapEvt=touchEvt=moved=newIndex=newDraggableIndex=oldIndex=oldDraggableIndex=lastTarget=lastDirection=putSortable=activeGroup=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,savedInputChecked.forEach(function(_){_.checked=!0}),savedInputChecked.length=lastDx=lastDy=0},handleEvent:function k(_){switch(_.type){case"drop":case"dragend":this._onDrop(_);break;case"dragenter":case"dragover":dragEl&&(this._onDragOver(_),_globalDragOver(_));break;case"selectstart":_.preventDefault();break}},toArray:function k(){for(var _=[],y,w=this.el.children,$=0,B=w.length,R=this.options;$<B;$++)y=w[$],closest(y,R.draggable,this.el,!1)&&_.push(y.getAttribute(R.dataIdAttr)||_generateId(y));return _},sort:function k(_,y){var w={},$=this.el;this.toArray().forEach(function(B,R){var H=$.children[R];closest(H,this.options.draggable,$,!1)&&(w[B]=H)},this),y&&this.captureAnimationState(),_.forEach(function(B){w[B]&&($.removeChild(w[B]),$.appendChild(w[B]))}),y&&this.animateAll()},save:function k(){var _=this.options.store;_&&_.set&&_.set(this)},closest:function k(_,y){return closest(_,y||this.options.draggable,this.el,!1)},option:function k(_,y){var w=this.options;if(y===void 0)return w[_];var $=PluginManager.modifyOption(this,_,y);typeof $<"u"?w[_]=$:w[_]=y,_==="group"&&_prepareGroup(w)},destroy:function k(){pluginEvent("destroy",this);var _=this.el;_[expando]=null,off(_,"mousedown",this._onTapStart),off(_,"touchstart",this._onTapStart),off(_,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(_,"dragover",this),off(_,"dragenter",this)),Array.prototype.forEach.call(_.querySelectorAll("[draggable]"),function(y){y.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),sortables.splice(sortables.indexOf(this.el),1),this.el=_=null},_hideClone:function k(){if(!cloneHidden){if(pluginEvent("hideClone",this),Sortable.eventCanceled)return;css(cloneEl,"display","none"),this.options.removeCloneOnHide&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),cloneHidden=!0}},_showClone:function k(_){if(_.lastPutMode!=="clone"){this._hideClone();return}if(cloneHidden){if(pluginEvent("showClone",this),Sortable.eventCanceled)return;dragEl.parentNode==rootEl&&!this.options.group.revertClone?rootEl.insertBefore(cloneEl,dragEl):nextEl?rootEl.insertBefore(cloneEl,nextEl):rootEl.appendChild(cloneEl),this.options.group.revertClone&&this.animate(dragEl,cloneEl),css(cloneEl,"display",""),cloneHidden=!1}}};function _globalDragOver(k){k.dataTransfer&&(k.dataTransfer.dropEffect="move"),k.cancelable&&k.preventDefault()}function _onMove(k,_,y,w,$,B,R,H){var j,q=k[expando],X=q.options.onMove,ee;return window.CustomEvent&&!IE11OrLess&&!Edge?j=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(j=document.createEvent("Event"),j.initEvent("move",!0,!0)),j.to=_,j.from=k,j.dragged=y,j.draggedRect=w,j.related=$||_,j.relatedRect=B||getRect(_),j.willInsertAfter=H,j.originalEvent=R,k.dispatchEvent(j),X&&(ee=X.call(q,j,R)),ee}function _disableDraggable(k){k.draggable=!1}function _unsilent(){_silent=!1}function _ghostIsFirst(k,_,y){var w=getRect(getChild(y.el,0,y.options,!0)),$=10;return _?k.clientX<w.left-$||k.clientY<w.top&&k.clientX<w.right:k.clientY<w.top-$||k.clientY<w.bottom&&k.clientX<w.left}function _ghostIsLast(k,_,y){var w=getRect(lastChild(y.el,y.options.draggable)),$=10;return _?k.clientX>w.right+$||k.clientX<=w.right&&k.clientY>w.bottom&&k.clientX>=w.left:k.clientX>w.right&&k.clientY>w.top||k.clientX<=w.right&&k.clientY>w.bottom+$}function _getSwapDirection(k,_,y,w,$,B,R,H){var j=w?k.clientY:k.clientX,q=w?y.height:y.width,X=w?y.top:y.left,ee=w?y.bottom:y.right,te=!1;if(!R){if(H&&targetMoveDistance<q*$){if(!pastFirstInvertThresh&&(lastDirection===1?j>X+q*B/2:j<ee-q*B/2)&&(pastFirstInvertThresh=!0),pastFirstInvertThresh)te=!0;else if(lastDirection===1?j<X+targetMoveDistance:j>ee-targetMoveDistance)return-lastDirection}else if(j>X+q*(1-$)/2&&j<ee-q*(1-$)/2)return _getInsertDirection(_)}return te=te||R,te&&(j<X+q*B/2||j>ee-q*B/2)?j>X+q/2?1:-1:0}function _getInsertDirection(k){return index$1(dragEl)<index$1(k)?1:-1}function _generateId(k){for(var _=k.tagName+k.className+k.src+k.href+k.textContent,y=_.length,w=0;y--;)w+=_.charCodeAt(y);return w.toString(36)}function _saveInputCheckedState(k){savedInputChecked.length=0;for(var _=k.getElementsByTagName("input"),y=_.length;y--;){var w=_[y];w.checked&&savedInputChecked.push(w)}}function _nextTick(k){return setTimeout(k,0)}function _cancelNextTick(k){return clearTimeout(k)}documentExists&&on(document,"touchmove",function(k){(Sortable.active||awaitingDragStarted)&&k.cancelable&&k.preventDefault()});Sortable.utils={on,off,css,find,is:function k(_,y){return!!closest(_,y,_,!1)},extend,throttle,closest,toggleClass,clone,index:index$1,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:_detectDirection,getChild};Sortable.get=function(k){return k[expando]};Sortable.mount=function(){for(var k=arguments.length,_=new Array(k),y=0;y<k;y++)_[y]=arguments[y];_[0].constructor===Array&&(_=_[0]),_.forEach(function(w){if(!w.prototype||!w.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(w));w.utils&&(Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),w.utils)),PluginManager.mount(w)})};Sortable.create=function(k,_){return new Sortable(k,_)};Sortable.version=version;var autoScrolls=[],scrollEl,scrollRootEl,scrolling=!1,lastAutoScrollX,lastAutoScrollY,touchEvt$1,pointerElemChangedInterval;function AutoScrollPlugin(){function k(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var _ in this)_.charAt(0)==="_"&&typeof this[_]=="function"&&(this[_]=this[_].bind(this))}return k.prototype={dragStarted:function(y){var w=y.originalEvent;this.sortable.nativeDraggable?on(document,"dragover",this._handleAutoScroll):this.options.supportPointer?on(document,"pointermove",this._handleFallbackAutoScroll):w.touches?on(document,"touchmove",this._handleFallbackAutoScroll):on(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(y){var w=y.originalEvent;!this.options.dragOverBubble&&!w.rootEl&&this._handleAutoScroll(w)},drop:function(){this.sortable.nativeDraggable?off(document,"dragover",this._handleAutoScroll):(off(document,"pointermove",this._handleFallbackAutoScroll),off(document,"touchmove",this._handleFallbackAutoScroll),off(document,"mousemove",this._handleFallbackAutoScroll)),clearPointerElemChangedInterval(),clearAutoScrolls(),cancelThrottle()},nulling:function(){touchEvt$1=scrollRootEl=scrollEl=scrolling=pointerElemChangedInterval=lastAutoScrollX=lastAutoScrollY=null,autoScrolls.length=0},_handleFallbackAutoScroll:function(y){this._handleAutoScroll(y,!0)},_handleAutoScroll:function(y,w){var $=this,B=(y.touches?y.touches[0]:y).clientX,R=(y.touches?y.touches[0]:y).clientY,H=document.elementFromPoint(B,R);if(touchEvt$1=y,w||this.options.forceAutoScrollFallback||Edge||IE11OrLess||Safari){autoScroll(y,this.options,H,w);var j=getParentAutoScrollElement(H,!0);scrolling&&(!pointerElemChangedInterval||B!==lastAutoScrollX||R!==lastAutoScrollY)&&(pointerElemChangedInterval&&clearPointerElemChangedInterval(),pointerElemChangedInterval=setInterval(function(){var q=getParentAutoScrollElement(document.elementFromPoint(B,R),!0);q!==j&&(j=q,clearAutoScrolls()),autoScroll(y,$.options,q,w)},10),lastAutoScrollX=B,lastAutoScrollY=R)}else{if(!this.options.bubbleScroll||getParentAutoScrollElement(H,!0)===getWindowScrollingElement()){clearAutoScrolls();return}autoScroll(y,this.options,getParentAutoScrollElement(H,!1),!1)}}},_extends(k,{pluginName:"scroll",initializeByDefault:!0})}function clearAutoScrolls(){autoScrolls.forEach(function(k){clearInterval(k.pid)}),autoScrolls=[]}function clearPointerElemChangedInterval(){clearInterval(pointerElemChangedInterval)}var autoScroll=throttle(function(k,_,y,w){if(_.scroll){var $=(k.touches?k.touches[0]:k).clientX,B=(k.touches?k.touches[0]:k).clientY,R=_.scrollSensitivity,H=_.scrollSpeed,j=getWindowScrollingElement(),q=!1,X;scrollRootEl!==y&&(scrollRootEl=y,clearAutoScrolls(),scrollEl=_.scroll,X=_.scrollFn,scrollEl===!0&&(scrollEl=getParentAutoScrollElement(y,!0)));var ee=0,te=scrollEl;do{var ne=te,oe=getRect(ne),ie=oe.top,ae=oe.bottom,re=oe.left,se=oe.right,le=oe.width,ue=oe.height,he=void 0,ce=void 0,ge=ne.scrollWidth,be=ne.scrollHeight,fe=css(ne),we=ne.scrollLeft,Ce=ne.scrollTop;ne===j?(he=le<ge&&(fe.overflowX==="auto"||fe.overflowX==="scroll"||fe.overflowX==="visible"),ce=ue<be&&(fe.overflowY==="auto"||fe.overflowY==="scroll"||fe.overflowY==="visible")):(he=le<ge&&(fe.overflowX==="auto"||fe.overflowX==="scroll"),ce=ue<be&&(fe.overflowY==="auto"||fe.overflowY==="scroll"));var ve=he&&(Math.abs(se-$)<=R&&we+le<ge)-(Math.abs(re-$)<=R&&!!we),ke=ce&&(Math.abs(ae-B)<=R&&Ce+ue<be)-(Math.abs(ie-B)<=R&&!!Ce);if(!autoScrolls[ee])for(var me=0;me<=ee;me++)autoScrolls[me]||(autoScrolls[me]={});(autoScrolls[ee].vx!=ve||autoScrolls[ee].vy!=ke||autoScrolls[ee].el!==ne)&&(autoScrolls[ee].el=ne,autoScrolls[ee].vx=ve,autoScrolls[ee].vy=ke,clearInterval(autoScrolls[ee].pid),(ve!=0||ke!=0)&&(q=!0,autoScrolls[ee].pid=setInterval(function(){w&&this.layer===0&&Sortable.active._onTouchMove(touchEvt$1);var Ie=autoScrolls[this.layer].vy?autoScrolls[this.layer].vy*H:0,Fe=autoScrolls[this.layer].vx?autoScrolls[this.layer].vx*H:0;typeof X=="function"&&X.call(Sortable.dragged.parentNode[expando],Fe,Ie,k,touchEvt$1,autoScrolls[this.layer].el)!=="continue"||scrollBy(autoScrolls[this.layer].el,Fe,Ie)}.bind({layer:ee}),24))),ee++}while(_.bubbleScroll&&te!==j&&(te=getParentAutoScrollElement(te,!1)));scrolling=q}},30),drop=function k(_){var y=_.originalEvent,w=_.putSortable,$=_.dragEl,B=_.activeSortable,R=_.dispatchSortableEvent,H=_.hideGhostForTarget,j=_.unhideGhostForTarget;if(y){var q=w||B;H();var X=y.changedTouches&&y.changedTouches.length?y.changedTouches[0]:y,ee=document.elementFromPoint(X.clientX,X.clientY);j(),q&&!q.el.contains(ee)&&(R("spill"),this.onSpill({dragEl:$,putSortable:w}))}};function Revert(){}Revert.prototype={startIndex:null,dragStart:function k(_){var y=_.oldDraggableIndex;this.startIndex=y},onSpill:function k(_){var y=_.dragEl,w=_.putSortable;this.sortable.captureAnimationState(),w&&w.captureAnimationState();var $=getChild(this.sortable.el,this.startIndex,this.options);$?this.sortable.el.insertBefore(y,$):this.sortable.el.appendChild(y),this.sortable.animateAll(),w&&w.animateAll()},drop};_extends(Revert,{pluginName:"revertOnSpill"});function Remove(){}Remove.prototype={onSpill:function k(_){var y=_.dragEl,w=_.putSortable,$=w||this.sortable;$.captureAnimationState(),y.parentNode&&y.parentNode.removeChild(y),$.animateAll()},drop};_extends(Remove,{pluginName:"removeOnSpill"});Sortable.mount(new AutoScrollPlugin);Sortable.mount(Remove,Revert);var __decorate$_=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const show=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M12.0004 5.75C8.06451 5.75 4.70095 8.20857 3.36528 11.6764C3.28512 11.8845 3.28512 12.1155 3.36527 12.3236C4.70093 15.7914 8.06451 18.25 12.0005 18.25C15.9364 18.25 19.2999 15.7914 20.6356 12.3236C20.7158 12.1155 20.7158 11.8846 20.6356 11.6764C19.3 8.2086 15.9364 5.75 12.0004 5.75ZM1.96552 11.1372C3.51675 7.10978 7.42369 4.25 12.0004 4.25C16.5772 4.25 20.4842 7.10982 22.0354 11.1373C22.2492 11.6924 22.2492 12.3077 22.0354 12.8628C20.4841 16.8902 16.5772 19.75 12.0005 19.75C7.42369 19.75 3.51672 16.8902 1.96551 12.8627C1.75171 12.3076 1.75171 11.6923 1.96552 11.1372ZM12 9.75C10.7574 9.75 9.74999 10.7574 9.74999 12C9.74999 13.2426 10.7574 14.25 12 14.25C13.2426 14.25 14.25 13.2426 14.25 12C14.25 10.7574 13.2426 9.75 12 9.75ZM8.24999 12C8.24999 9.92893 9.92893 8.25 12 8.25C14.0711 8.25 15.75 9.92893 15.75 12C15.75 14.0711 14.0711 15.75 12 15.75C9.92893 15.75 8.24999 14.0711 8.24999 12Z"
  />
</svg> `,hidden=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path d="M5 4L20 19" stroke="white" stroke-width="2" stroke-linecap="round" />
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.59938 7.54961C4.35061 7.21842 3.88046 7.1516 3.54927 7.40037C3.21808 7.64913 3.15126 8.11928 3.40002 8.45047C4.2023 9.51858 5.19943 10.4327 6.33872 11.1399L4.37596 14.084C4.1462 14.4287 4.23933 14.8943 4.58397 15.1241C4.92862 15.3538 5.39427 15.2607 5.62404 14.9161L7.62404 11.9161C7.6403 11.8917 7.65495 11.8667 7.66801 11.8412C8.77638 12.3299 9.98299 12.6369 11.25 12.7243V17.5C11.25 17.9143 11.5858 18.25 12 18.25C12.4142 18.25 12.75 17.9143 12.75 17.5V12.7243C14.0171 12.637 15.2237 12.3301 16.3322 11.8415C16.3452 11.8669 16.3598 11.8918 16.376 11.9161L18.376 14.9161C18.6057 15.2607 19.0714 15.3538 19.416 15.1241C19.7607 14.8943 19.8538 14.4287 19.624 14.084L17.6615 11.1403C18.8011 10.433 19.7985 9.51878 20.6009 8.45047C20.8497 8.11928 20.7828 7.64913 20.4516 7.40037C20.1205 7.1516 19.6503 7.21842 19.4015 7.54961C17.7127 9.79805 15.0263 11.2501 12.0005 11.2501C8.97467 11.2501 6.28823 9.79805 4.59938 7.54961Z"
  />
</svg> `;let DataViewPropertiesSettingView=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.renderColumn=_=>{const y=_.type==="title",w=_.hide?hidden:show,$=()=>{_.type!=="title"&&_.updateHide(!_.hide)},B=o$3({"property-item-op-icon":!0,disabled:y});return x$1` <div class="property-item">
      <div class="property-item-drag-bar"></div>
      <uni-lit class="property-item-icon" .uni="${_.icon}"></uni-lit>
      <div class="property-item-name">${_.name}</div>
      <div class="${B}" @click="${$}">${w}</div>
    </div>`},this.clickChangeAll=_=>{this.view.columnsWithoutFilter.forEach(y=>{this.view.columnGetType(y)!=="title"&&this.view.columnUpdateHide(y,_)})}}connectedCallback(){super.connectedCallback(),this._disposables.add(this.view.slots.update.on(()=>{this.requestUpdate()})),this._disposables.addFromEvent(this,"pointerdown",_=>{_.stopPropagation()})}firstUpdated(){const _=new Sortable(this.groupContainer,{animation:150,group:`properties-sort-${this.view.id}`,onEnd:y=>{const w=[...this.view.columnsWithoutFilter],$=y.oldIndex??-1,B=w[$];w.splice($,1);const R=w[y.newIndex??-1];this.view.columnMove(B,R?{before:!0,id:R}:"end")}});this._disposables.add({dispose:()=>_.destroy()})}itemsGroup(){return this.view.columnsWithoutFilter.map(_=>this.view.columnGet(_))}render(){const _=this.itemsGroup(),y=_.every($=>!$.hide);return x$1`
      <div class="properties-group-header">
        <div class="properties-group-title">PROPERTIES</div>
        <div class="properties-group-op" @click="${()=>this.clickChangeAll(y)}">
          ${y?"Hide All":"Show All"}
        </div>
      </div>
      <div class="properties-group">
        ${c$1(_,$=>$.id,this.renderColumn)}
      </div>
    `}};DataViewPropertiesSettingView.styles=i$5`
    data-view-properties-setting {
      position: absolute;
      background-color: var(--affine-background-primary-color);
      border-radius: 8px;
      box-shadow: 0px 0px 12px 0px rgba(66, 65, 73, 0.14),
        0px 0px 0px 0.5px #e3e3e4 inset;
      padding: 8px;
      min-width: 250px;
    }

    .properties-group-header {
      user-select: none;
      padding: 4px 12px 12px 12px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--affine-divider-color);
    }

    .properties-group-title {
      font-size: 12px;
      line-height: 20px;
      color: var(--affine-text-secondary-color);
    }

    .properties-group-op {
      padding: 4px 8px;
      font-size: 12px;
      line-height: 20px;
      font-weight: 500;
      border-radius: 4px;
      cursor: pointer;
    }

    .properties-group-op:hover {
      background-color: var(--affine-hover-color);
    }

    .properties-group {
      min-height: 40px;
    }

    .property-item {
      padding: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      cursor: pointer;
      border-radius: 4px;
    }

    .property-item:hover {
      background-color: var(--affine-hover-color);
    }

    .property-item-drag-bar {
      width: 4px;
      height: 12px;
      border-radius: 1px;
      background-color: #efeff0;
    }

    .property-item:hover .property-item-drag-bar {
      background-color: #c0bfc1;
    }

    .property-item-icon {
      display: flex;
      align-items: center;
    }

    .property-item-icon svg {
      color: var(--affine-icon-color);
      fill: var(--affine-icon-color);
      width: 20px;
      height: 20px;
    }

    .property-item-op-icon {
      display: flex;
      align-items: center;
      border-radius: 4px;
    }

    .property-item-op-icon:hover {
      background-color: var(--affine-hover-color);
    }
    .property-item-op-icon.disabled:hover {
      background-color: transparent;
    }

    .property-item-op-icon svg {
      fill: var(--affine-icon-color);
      color: var(--affine-icon-color);
      width: 20px;
      height: 20px;
    }

    .property-item-op-icon.disabled svg {
      fill: var(--affine-text-disable-color);
      color: var(--affine-text-disable-color);
    }

    .property-item-name {
      font-size: 14px;
      line-height: 22px;
      flex: 1;
    }
  `;__decorate$_([n$a({attribute:!1})],DataViewPropertiesSettingView.prototype,"view",void 0);__decorate$_([i$6(".properties-group")],DataViewPropertiesSettingView.prototype,"groupContainer",void 0);DataViewPropertiesSettingView=__decorate$_([e$7("data-view-properties-setting")],DataViewPropertiesSettingView);const popPropertiesSetting=(k,_)=>{const y=new DataViewPropertiesSettingView;y.view=_.view,createPopup(k,y,{onClose:_.onClose})};var __decorate$Z=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const viewOpIcons={properties:x$1`<svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M17.2917 4.99998C17.2917 5.34516 17.0118 5.62498 16.6667 5.62498L8.87207 5.62498C8.60002 6.58686 7.71565 7.29165 6.66667 7.29165C5.61769 7.29165 4.73332 6.58686 4.46127 5.62498L3.33334 5.62498C2.98816 5.62498 2.70834 5.34516 2.70834 4.99998C2.70834 4.6548 2.98816 4.37498 3.33334 4.37498L4.46127 4.37498C4.73332 3.4131 5.61769 2.70831 6.66667 2.70831C7.71565 2.70831 8.60002 3.4131 8.87208 4.37498L16.6667 4.37498C17.0118 4.37498 17.2917 4.6548 17.2917 4.99998ZM17.2917 9.99998C17.2917 10.3452 17.0118 10.625 16.6667 10.625L15.5387 10.625C15.2667 11.5869 14.3823 12.2916 13.3333 12.2916C12.2844 12.2916 11.4 11.5869 11.1279 10.625L3.33334 10.625C2.98816 10.625 2.70834 10.3452 2.70834 9.99998C2.70834 9.6548 2.98816 9.37498 3.33334 9.37498L11.1279 9.37498C11.4 8.4131 12.2844 7.70831 13.3333 7.70831C14.3823 7.70831 15.2667 8.4131 15.5387 9.37498L16.6667 9.37498C17.0118 9.37498 17.2917 9.6548 17.2917 9.99998ZM17.2917 15C17.2917 15.3452 17.0118 15.625 16.6667 15.625L8.87207 15.625C8.60002 16.5869 7.71565 17.2916 6.66667 17.2916C5.61769 17.2916 4.73332 16.5869 4.46127 15.625L3.33334 15.625C2.98816 15.625 2.70834 15.3452 2.70834 15C2.70834 14.6548 2.98816 14.375 3.33334 14.375L4.46127 14.375C4.73332 13.4131 5.61769 12.7083 6.66667 12.7083C7.71565 12.7083 8.60002 13.4131 8.87207 14.375L16.6667 14.375C17.0118 14.375 17.2917 14.6548 17.2917 15ZM14.375 9.99998C14.375 9.42468 13.9086 8.95831 13.3333 8.95831C12.758 8.95831 12.2917 9.42468 12.2917 9.99998C12.2917 10.5753 12.758 11.0416 13.3333 11.0416C13.9086 11.0416 14.375 10.5753 14.375 9.99998ZM7.70834 4.99998C7.70834 4.42468 7.24197 3.95831 6.66667 3.95831C6.09138 3.95831 5.62501 4.42468 5.62501 4.99998C5.62501 5.57528 6.09138 6.04165 6.66667 6.04165C7.24197 6.04165 7.70834 5.57528 7.70834 4.99998ZM7.70834 15C7.70834 14.4247 7.24197 13.9583 6.66667 13.9583C6.09138 13.9583 5.62501 14.4247 5.62501 15C5.62501 15.5753 6.09138 16.0416 6.66667 16.0416C7.24197 16.0416 7.70834 15.5753 7.70834 15Z"
      fill="currentColor"
    />
  </svg> `,filter:x$1`<svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M3.125 10C3.125 6.20304 6.20304 3.125 10 3.125C13.797 3.125 16.875 6.20304 16.875 10C16.875 13.797 13.797 16.875 10 16.875C6.20304 16.875 3.125 13.797 3.125 10ZM10 1.875C5.51269 1.875 1.875 5.51269 1.875 10C1.875 14.4873 5.51269 18.125 10 18.125C14.4873 18.125 18.125 14.4873 18.125 10C18.125 5.51269 14.4873 1.875 10 1.875ZM6.66667 7.29167C6.32149 7.29167 6.04167 7.57149 6.04167 7.91667C6.04167 8.26184 6.32149 8.54167 6.66667 8.54167H13.3333C13.6785 8.54167 13.9583 8.26184 13.9583 7.91667C13.9583 7.57149 13.6785 7.29167 13.3333 7.29167H6.66667ZM6.875 10.4167C6.875 10.0715 7.15482 9.79167 7.5 9.79167H12.5C12.8452 9.79167 13.125 10.0715 13.125 10.4167C13.125 10.7618 12.8452 11.0417 12.5 11.0417H7.5C7.15482 11.0417 6.875 10.7618 6.875 10.4167ZM9.16667 12.2917C8.82149 12.2917 8.54167 12.5715 8.54167 12.9167C8.54167 13.2618 8.82149 13.5417 9.16667 13.5417H10.8333C11.1785 13.5417 11.4583 13.2618 11.4583 12.9167C11.4583 12.5715 11.1785 12.2917 10.8333 12.2917H9.16667Z"
      fill="currentColor"
    />
  </svg> `,groupBy:x$1`<svg
    width="20"
    height="20"
    viewBox="0 0 20 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M2.29167 4.99998C2.29167 3.73433 3.31769 2.70831 4.58334 2.70831H7.50001H12.5H15.4167C16.6823 2.70831 17.7083 3.73433 17.7083 4.99998V15C17.7083 16.2656 16.6823 17.2916 15.4167 17.2916H4.58334C3.31769 17.2916 2.29167 16.2656 2.29167 15V4.99998ZM11.875 3.95831H8.12501V16.0416H11.875V3.95831ZM13.125 16.0416V3.95831H15.4167C15.992 3.95831 16.4583 4.42468 16.4583 4.99998V15C16.4583 15.5753 15.992 16.0416 15.4167 16.0416H13.125ZM4.58334 3.95831H6.87501V16.0416H4.58334C4.00804 16.0416 3.54167 15.5753 3.54167 15V4.99998C3.54167 4.42468 4.00804 3.95831 4.58334 3.95831Z"
      fill="currentColor"
    />
  </svg> `},styles$j=i$5`
  .affine-database-toolbar-item.more-action {
    padding: 2px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .affine-database-toolbar-item.more-action:hover {
    background: var(--affine-hover-color);
  }

  .affine-database-toolbar-item.more-action svg {
    width: 20px;
    height: 20px;
    fill: var(--affine-icon-color);
  }

  .more-action.active {
    background: var(--affine-hover-color);
  }
`;let DataViewHeaderToolsViewOptions=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._clickMoreAction=_=>{_.stopPropagation(),this.showToolBar(!0),popMenu(this._moreActionContainer,{options:{input:{initValue:this.view.name,onComplete:y=>{this.view.updateName(y)}},items:[{type:"action",name:"Properties",icon:viewOpIcons.properties,select:()=>{requestAnimationFrame(()=>{this.showToolBar(!0),popPropertiesSetting(this._moreActionContainer,{view:this.view,onClose:()=>this.showToolBar(!1)})})}},{type:"action",name:"Filter",hide:()=>!this.closest("affine-database")?.root.page.awarenessStore.getFlag("enable_database_filter"),icon:viewOpIcons.filter,select:()=>{}},{type:"sub-menu",name:"Group By",icon:viewOpIcons.groupBy,hide:()=>!(this.view instanceof DataViewKanbanManager),options:{input:{search:!0,placeholder:"Search"},items:this.view.columnsWithoutFilter.filter(y=>this.view.columnGet(y).type==="title"?!1:!!groupByMatcher.match(this.view.columnGet(y).dataType)).map(y=>{const w=this.view.columnGet(y);return{type:"action",name:w.name,icon:x$1`<uni-lit .uni="${w.icon}"></uni-lit>`,select:()=>{this.view.changeGroup(y)}}})}},{type:"group",name:"",children:()=>[{type:"action",name:"Delete View",icon:DeleteIcon,select:()=>{this.view.deleteView()},class:"delete-item"}]}],onClose:()=>{this.showToolBar(!1)}}})}}showToolBar(_){const y=this.closest("data-view-header-tools");y&&(y.showToolBar=_)}render(){if(!this.view.readonly)return x$1` <div
      class="affine-database-toolbar-item more-action"
      @click="${this._clickMoreAction}"
    >
      ${MoreHorizontalIcon}
    </div>`}};DataViewHeaderToolsViewOptions.styles=styles$j;__decorate$Z([n$a({attribute:!1})],DataViewHeaderToolsViewOptions.prototype,"view",void 0);__decorate$Z([i$6(".more-action")],DataViewHeaderToolsViewOptions.prototype,"_moreActionContainer",void 0);DataViewHeaderToolsViewOptions=__decorate$Z([e$7("data-view-header-tools-view-options")],DataViewHeaderToolsViewOptions);var __decorate$Y=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$i=i$5`
  .affine-database-filter-button {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    line-height: 20px;
    padding: 2px 4px;
    border-radius: 4px;
    cursor: pointer;
  }
  .affine-database-filter-button:hover {
    background-color: var(--affine-hover-color);
  }
  .affine-database-filter-button svg {
    width: 20px;
    height: 20px;
  }
`;let DataViewHeaderToolsFilter=class extends WithDisposable(ShadowlessElement){get _filter(){return this.view.filter}set _filter(_){this.view.updateFilter(_)}get _vars(){return this.view.columnManagerList.map(_=>({id:_.id,name:_.name,type:columnManager.getColumn(_.type).dataType(_.data)}))}showToolBar(_){const y=this.closest("data-view-header-tools");y&&(y.showToolBar=_)}_showFilter(_){this.showToolBar(!0);const y=()=>{popAdvanceFilter(_.target,{vars:this._vars,value:this._filter,onChange:w=>{this._filter=w}})};if(!this._filter.conditions.length){popSelectField(_.target,{vars:this._vars,onSelect:w=>{this._filter={...this._filter,conditions:[firstFilterByRef(this._vars,w)]},setTimeout(()=>{y()})}});return}y()}render(){if(this.closest("affine-database")?.root.page.awarenessStore.getFlag("enable_database_filter"))return x$1`<div
      @click="${this._showFilter}"
      class="affine-database-filter-button"
    >
      ${viewOpIcons.filter} Filter
    </div>`}};DataViewHeaderToolsFilter.styles=styles$i;__decorate$Y([n$a({attribute:!1})],DataViewHeaderToolsFilter.prototype,"view",void 0);DataViewHeaderToolsFilter=__decorate$Y([e$7("data-view-header-tools-filter")],DataViewHeaderToolsFilter);var __decorate$X=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NewRecordPreview=class extends ShadowlessElement{constructor(){super(...arguments),this.offset={x:0,y:0}}render(){return x$1`
      <style>
        affine-database-new-record-preview {
          display: flex;
          align-items: center;
          justify-content: center;
          position: fixed;
          top: 0;
          left: 0;
          height: 32px;
          width: 32px;
          border: 1px solid var(--affine-border-color);
          border-radius: 50%;
          background: var(--affine-blue-100);
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.05),
            0px 0px 0px 0.5px var(--affine-black-10);
          cursor: none;
          user-select: none;
          pointer-events: none;
          caret-color: transparent;
          z-index: 100;
        }

        affine-database-new-record-preview svg {
          width: 16px;
          height: 16px;
        }

        affine-database-new-record-preview path {
          fill: var(--affine-brand-color);
        }
      </style>
      ${PlusIcon}
    `}};__decorate$X([n$a({attribute:!1})],NewRecordPreview.prototype,"offset",void 0);NewRecordPreview=__decorate$X([e$7("affine-database-new-record-preview")],NewRecordPreview);function initAddNewRecordHandlers(k,_,y){let w=null,$=null;const B=_.closest("affine-database");if(!B)return;const R=B.querySelector(".affine-database-block-rows");if(!R)return;const H=document.querySelector("affine-drag-indicator");if(!H){const ne=document.createElement("affine-drag-indicator");document.body.appendChild(ne)}const j=ne=>{ne.stopPropagation(),assertExists(ne.dataTransfer),ne.dataTransfer.effectAllowed="move",$=new NewRecordPreview,$.style.opacity="0",ne.dataTransfer?.setDragImage($,0,0),_.appendChild($),w={rows:Array.from(R.querySelectorAll(".affine-database-block-row"))}},q=ne=>{if(!w||!$)return;$.style.opacity!=="1"&&($.style.opacity="1");const oe=ne.clientX,ie=ne.clientY;$.style.transform=`translate(${oe}px, ${ie}px)`;const ae=new Point(oe,ie),re=getClosestRow(ae,w.rows);if(assertExists(H),re){const{top:se,bottom:le}=re.element.getBoundingClientRect(),ue=re.isLast?le:se,{width:he,left:ce}=B.getBoundingClientRect();H.rect=Rect.fromLWTH(ce,he,ue,3),w.position=re.position}else H.rect=null,w.position=void 0},X=()=>{if(!w)return;const{position:ne}=w;w=null,H&&(H.rect=null),$&&($.remove(),$=null),ne&&y(ne)},ee=new DisposableGroup,te=ne=>{ne.stopPropagation()};return ee.addFromEvent(k,"pointerdown",te),ee.addFromEvent(k,"pointermove",te),ee.addFromEvent(k,"pointerup",te),ee.addFromEvent(k,"dragstart",j),ee.addFromEvent(k,"drag",q),ee.addFromEvent(k,"dragend",X),ee}function getClosestRow(k,_){const y=_.length;for(let w=0;w<y;w++){const $=_[w],{top:B,bottom:R}=$.getBoundingClientRect();if(k.y<=B+20&&k.y>=B-20)return{element:$,position:{id:$.dataset.rowId??"",before:!0},isLast:!1};if(w===y-1&&k.y>=R-20&&k.y<=R+20)return{element:$,position:{id:$.dataset.rowId??"",before:!1},isLast:!0}}return null}var __decorate$W=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$h=i$5`
  .affine-database-toolbar-item.new-record {
    margin-left: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    width: 120px;
    height: 32px;
    padding: 6px 8px;
    border-radius: 8px;
    font-size: 14px;
    background: var(--affine-white);
    box-shadow: 0px 0px 0px 0.5px rgba(0, 0, 0, 0.1);
    cursor: grab;
  }

  .new-record > tool-tip {
    max-width: 280px;
  }
  .new-record svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
  }

  .edgeless .new-record > tool-tip {
    display: none;
  }
`;let DataViewHeaderToolsAddRow=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._recordAddDisposables=new DisposableGroup,this.showToolBar=!1,this.addRow=_=>{this.viewMethod.addRow?.(_)},this._onAddNewRecord=()=>{if(this.readonly)return;const _=this.viewMethod.getSelection?.();if(!_)this.addRow("start");else if(_.type==="table"){const{rowsSelection:y,columnsSelection:w,focus:$}=_;let B=0;y&&!w||y&&w?B=y.end:!y&&!w&&$&&(B=$.rowIndex),this.addRow(B+1)}}}get readonly(){return this.view.readonly}firstUpdated(){this.readonly||this._initAddRecordHandlers()}updated(_){super.updated(_),this.readonly||this._initAddRecordHandlers()}_initAddRecordHandlers(){if(this._recordAddDisposables.dispose(),!this._newRecord)return;const _=initAddNewRecordHandlers(this._newRecord,this,this.addRow);_&&(this._recordAddDisposables=_)}render(){if(!this.readonly)return x$1` <div
      class="has-tool-tip affine-database-toolbar-item new-record"
      draggable="true"
      @click="${this._onAddNewRecord}"
    >
      ${PlusIcon}<span>New Record</span>
    </div>`}};DataViewHeaderToolsAddRow.styles=styles$h;__decorate$W([n$a({attribute:!1})],DataViewHeaderToolsAddRow.prototype,"viewMethod",void 0);__decorate$W([n$a({attribute:!1})],DataViewHeaderToolsAddRow.prototype,"view",void 0);__decorate$W([i$6(".new-record")],DataViewHeaderToolsAddRow.prototype,"_newRecord",void 0);__decorate$W([t$2()],DataViewHeaderToolsAddRow.prototype,"showToolBar",void 0);DataViewHeaderToolsAddRow=__decorate$W([e$7("data-view-header-tools-add-row")],DataViewHeaderToolsAddRow);var __decorate$V=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$g=i$5`
  .affine-database-toolbar {
    display: none;
    align-items: center;
    gap: 6px;
  }

  .toolbar-hover-container:hover .affine-database-toolbar {
    display: flex;
  }

  .show-toolbar {
    display: flex;
  }

  @media print {
    .affine-database-toolbar {
      display: none;
    }
  }
`;let DataViewHeaderTools=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.showToolBar=!1}render(){if(this.view.isDeleted)return;const _=o$3({"show-toolbar":this.showToolBar,"affine-database-toolbar":!0}),y=viewRendererManager.getView(this.view.type).tools;return x$1` <div class="${_}">
      ${c$1(y??[],w=>{const $={view:this.view,viewMethod:this.viewEle};return renderUniLit(w,$)})}
    </div>`}};DataViewHeaderTools.styles=styles$g;__decorate$V([n$a({attribute:!1})],DataViewHeaderTools.prototype,"viewEle",void 0);__decorate$V([n$a({attribute:!1})],DataViewHeaderTools.prototype,"view",void 0);__decorate$V([t$2()],DataViewHeaderTools.prototype,"showToolBar",void 0);DataViewHeaderTools=__decorate$V([e$7("data-view-header-tools")],DataViewHeaderTools);viewManager.register("table",{defaultName:"Table View",init(k,_,y){return{id:_,name:y,mode:"table",columns:[],filter:{type:"group",op:"and",conditions:[]},header:{titleColumn:k.columns.find(w=>w.type==="title")?.id,iconColumn:"type"}}}});var __decorate$U=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AffineLitIcon=class extends ShadowlessElement{render(){return x$1`${icons[this.name]}`}};AffineLitIcon.styles=i$5`
    affine-lit-icon {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    affine-lit-icon svg {
      fill: var(--affine-icon-color);
    }
  `;__decorate$U([n$a({attribute:!1})],AffineLitIcon.prototype,"name",void 0);AffineLitIcon=__decorate$U([e$7("affine-lit-icon")],AffineLitIcon);const litIcon=createUniComponentFromWebComponent(AffineLitIcon),createIcon=k=>map(litIcon,()=>({name:k})),startDrag=(k,_)=>{const y=_?.transform??(j=>j),w={data:_.onDrag(y(k)),move:j=>{w.data=_.onMove(j)}},$=()=>{window.removeEventListener("pointermove",R),window.removeEventListener("pointerup",H),window.removeEventListener("keydown",B),_.onClear()},B=j=>{j.key==="Escape"&&$()},R=j=>{j.preventDefault(),w.data=_.onMove(y(j))},H=()=>{try{_.onDrop(w.data)}finally{$()}};return window.addEventListener("pointermove",R),window.addEventListener("pointerup",H),window.addEventListener("keydown",B),w},startFrameLoop=k=>{let _=0,y=0;const w=()=>{_=requestAnimationFrame($=>{try{k($-y)}finally{y=$,w()}})};return w(),()=>{cancelAnimationFrame(_)}},DEFAULT_COLUMN_WIDTH=180,DEFAULT_COLUMN_MIN_WIDTH=100,DEFAULT_COLUMN_TITLE_HEIGHT=36,DEFAULT_ADD_BUTTON_WIDTH=40,getTableContainer=k=>{const _=k.closest(".affine-database-table-container");return assertExists(_),_};var __decorate$T=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DataViewColumnPreview=class extends WithDisposable(ShadowlessElement){render(){const _=this.tableViewManager.rows,y=this.tableViewManager.columnGetIndex(this.column.id);return n$5`
      <affine-database-header-column
        .tableViewManager="${this.tableViewManager}"
        .column="${this.column}"
      ></affine-database-header-column>
      ${c$1(_,(w,$)=>{const B=this.table.querySelector(`affine-database-cell-container[data-row-id="${w}"]`)?.clientHeight,R=o$4({height:B+"px"});return n$5` <div style="${R}">
          <affine-database-cell-container
            .column="${this.column}"
            .view="${this.tableViewManager}"
            .rowId="${w}"
            .columnId="${this.column.id}"
            .rowIndex="${$}"
            .columnIndex="${y}"
          ></affine-database-cell-container>
        </div>`})}
    `}};DataViewColumnPreview.styles=i$5`
    affine-data-view-column-preview {
      pointer-events: none;
      display: block;
      background-color: var(--affine-background-hover-color);
    }
  `;__decorate$T([n$a({attribute:!1})],DataViewColumnPreview.prototype,"tableViewManager",void 0);__decorate$T([n$a({attribute:!1})],DataViewColumnPreview.prototype,"column",void 0);__decorate$T([n$a({attribute:!1})],DataViewColumnPreview.prototype,"table",void 0);DataViewColumnPreview=__decorate$T([e$7("affine-data-view-column-preview")],DataViewColumnPreview);var __decorate$S=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},DatabaseHeaderColumn_1;let DatabaseHeaderColumn=DatabaseHeaderColumn_1=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._columnsOffset=(_,y)=>{const w=_.querySelectorAll("affine-database-header-column"),$=[],B=[];let R=$;const H=[],j=Array.from(w);for(let te=0;te<j.length;te++){const ne=j[te];if(ne===this){R=B,H.push(-1);continue}R.push({x:ne.offsetLeft+ne.offsetWidth/2,ele:ne}),H.push(ne.offsetLeft),te===j.length-1&&H.push(ne.offsetLeft+ne.offsetWidth)}$.reverse();const q=(te,ne)=>{let oe;for(let ae=0;ae<$.length;ae++){const{x:re,ele:se}=$[ae];if(re<te){if(oe)return oe;break}else oe={before:!0,id:se.column.id}}const ie=te+ne;for(const{x:ae,ele:re}of B)if(ae>ie){if(oe)return oe;break}else oe={before:!1,id:re.column.id};return oe},X=j.map(te=>({id:te.column.id})),ee=te=>H[insertPositionToIndex(te,X)];return{computeInsertInfo:(te,ne)=>{const oe=q(te,ne);return{insertPosition:oe,insertOffset:oe?ee(oe):void 0}}}},this._drag=_=>{const y=getTableContainer(this),w=y?.parentElement;assertExists(y),assertExists(w);const $=this.getBoundingClientRect(),B=$.width/this.column.width,R=w.getBoundingClientRect(),H=y.getBoundingClientRect(),j=_.x-$.left,q=$.right-_.x,X=($.left-H.left)/B,ee=(H.width-$.width)/B,{computeInsertInfo:te}=this._columnsOffset(y,B),ne=new DataViewColumnPreview;ne.tableViewManager=this.tableViewManager,ne.column=this.column,ne.table=y;const oe=createDragPreview$1(y,$.width/B,H.height/B,X,ne),ie=createDropPreview$1(y,H.height),ae=startFrameLoop(le=>{const ue=le*.4;se.data.x<R.left+j?(w.scrollLeft-=ue,se.move({x:se.data.x})):se.data.x>R.right-q&&(w.scrollLeft+=ue,se.move({x:se.data.x}))}),re=document.querySelector("html");re?.classList.toggle("affine-database-header-column-grabbing",!0);const se=startDrag(_,{onDrag:le=>({x:le.x}),onMove:({x:le})=>{const ue=getResultInRange((le-y.getBoundingClientRect().left-j)/B,0,ee),he=te(ue,$.width/B);return he.insertOffset!=null?ie.display(he.insertOffset):ie.hide(),oe.display(ue),{x:le,insertPosition:he.insertPosition}},onDrop:({insertPosition:le})=>{le&&this.tableViewManager.columnMove(this.column.id,le)},onClear:()=>{ae(),re?.classList.toggle("affine-database-header-column-grabbing",!1),ie.remove(),oe.remove()}})},this.editTitle=()=>{this._clickColumn()},this._clickColumn=()=>{this.tableViewManager.readonly||this.popMenu()},this._contextMenu=_=>{_.preventDefault(),this.popMenu(positionToVRect(_.x,_.y))},this._clickTypeIcon=_=>{this.tableViewManager.readonly||this.column.type!=="title"&&(_.stopPropagation(),popMenu(this,{options:{input:{search:!0,placeholder:"Search"},items:this.tableViewManager.allColumnConfig.filter(y=>y.type!==this.column.type).map(y=>({type:"action",name:y.name,icon:n$5` <uni-lit
                .uni="${this.tableViewManager.getIcon(y.type)}"
              ></uni-lit>`,select:()=>{this.column.updateType?.(y.type)}}))}}))}}firstUpdated(){this._disposables.add(this.tableViewManager.slots.update.on(()=>{this.requestUpdate()}))}get readonly(){return this.tableViewManager.readonly}popMenu(_){popMenu(_??this,{options:{input:{initValue:this.column.name,onComplete:y=>{this.column.updateName(y)}},items:[{type:"sub-menu",name:"Column type",icon:TextIcon,hide:()=>!this.column.updateType||this.column.type==="title",options:{input:{search:!0},items:this.tableViewManager.allColumnConfig.filter(y=>y.type!==this.column.type).map(y=>({type:"action",name:y.name,icon:n$5` <uni-lit
                      .uni="${this.tableViewManager.getIcon(y.type)}"
                    ></uni-lit>`,select:()=>{this.column.updateType?.(y.type)}}))}},{type:"action",name:"Duplicate column",icon:DatabaseDuplicate,hide:()=>!this.column.duplicate||this.column.type==="title",select:()=>{this.column.duplicate?.(),Promise.resolve().then(()=>{const y=this.nextElementSibling;y instanceof DatabaseHeaderColumn_1&&(y.editTitle(),y.scrollIntoView())})}},{type:"action",name:"Insert left column",icon:DatabaseInsertLeft,select:()=>{this.tableViewManager.columnAdd({id:this.column.id,before:!0}),Promise.resolve().then(()=>{const y=this.previousElementSibling;y instanceof DatabaseHeaderColumn_1&&(y.editTitle(),y.scrollIntoView())})}},{type:"action",name:"Insert right column",icon:DatabaseInsertRight,select:()=>{this.tableViewManager.columnAdd({id:this.column.id,before:!1}),Promise.resolve().then(()=>{const y=this.nextElementSibling;y instanceof DatabaseHeaderColumn_1&&(y.editTitle(),y.scrollIntoView())})}},{type:"action",name:"Move left",icon:DatabaseMoveLeft,hide:()=>this.column.isFirst,select:()=>{const y=this.tableViewManager.columnGetPreColumn(this.column.id)?.id;y&&this.tableViewManager.columnMove(this.column.id,{id:y,before:!0})}},{type:"action",name:"Move right",icon:DatabaseMoveRight,hide:()=>this.column.isLast,select:()=>{const y=this.tableViewManager.columnGetNextColumn(this.column.id)?.id;y&&this.tableViewManager.columnMove(this.column.id,{id:y,before:!1})}},{type:"group",name:"operation",children:()=>[{type:"action",name:"Delete column",icon:DeleteIcon,hide:()=>!this.column.delete||this.column.type==="title",select:()=>{this.column.delete?.()},class:"delete-item"}]}]}})}render(){const _=this.column,y=o$4({height:DEFAULT_COLUMN_TITLE_HEIGHT+"px"});return n$5`
      <div
        style=${y}
        class="affine-database-column-content"
        @click="${this._clickColumn}"
        @contextmenu="${this._contextMenu}"
      >
        <div class="affine-database-column-text ${_.type}">
          <div
            class="affine-database-column-type-icon"
            @click="${this._clickTypeIcon}"
          >
            <uni-lit .uni="${_.icon}"></uni-lit>
          </div>
          <div class="affine-database-column-text-content">
            <div class="affine-database-column-text-input">${_.name}</div>
          </div>
        </div>
        ${this.readonly?null:n$5` <div
              class="affine-database-column-move"
              @mousedown="${this._drag}"
            >
              ${DatabaseDragIcon}
            </div>`}
      </div>
    `}};DatabaseHeaderColumn.styles=i$5`
    .affine-database-header-column-grabbing * {
      cursor: grabbing;
    }
  `;__decorate$S([n$a({attribute:!1})],DatabaseHeaderColumn.prototype,"tableViewManager",void 0);__decorate$S([n$a({attribute:!1})],DatabaseHeaderColumn.prototype,"column",void 0);DatabaseHeaderColumn=DatabaseHeaderColumn_1=__decorate$S([e$7("affine-database-header-column")],DatabaseHeaderColumn);const createDragPreview$1=(k,_,y,w,$)=>{const B=document.createElement("div");return B.append($),B.style.backgroundColor="var(--affine-background-primary-color)",B.style.opacity="0.95",B.style.boxShadow="0px 0px 12px 0px rgba(66, 65, 73, 0.14), 0px 0px 0px 0.5px #e3e3e4 inset",B.style.position="absolute",B.style.width=`${_}px`,B.style.height=`${y}px`,B.style.left=`${w}px`,B.style.top="0px",B.style.zIndex="9",k.append(B),{display(R){B.style.left=`${Math.round(R)}px`},remove(){B.remove()}}},createDropPreview$1=(k,_)=>{const w=document.createElement("div");return w.className="database-move-column-drop-preview",w.style.position="absolute",w.style.width="4px",w.style.height=`${_}px`,w.style.display="none",w.style.top="0px",w.style.zIndex="9",w.style.backgroundColor="blue",k.append(w),{display($){w.style.display="block",w.style.left=`${$-4/2}px`},hide(){w.style.display="none"},remove(){w.remove()}}},styles$f=i$5`
  .affine-database-column-header {
    position: relative;
    display: flex;
    flex-direction: row;
    border-bottom: 1px solid var(--affine-border-color);
    box-sizing: border-box;
  }

  .affine-database-column {
    cursor: pointer;
    transform: translateX(0);
  }
  .database-cell {
    min-width: ${DEFAULT_COLUMN_MIN_WIDTH}px;
  }
  .database-cell.add-column-button {
    flex: 1;
    min-width: ${DEFAULT_ADD_BUTTON_WIDTH}px;
    min-height: 100%;
    display: flex;
    align-items: center;
  }
  .affine-database-column-content {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    height: 100%;
    padding: 8px;
    box-sizing: border-box;
  }
  .affine-database-column-content:hover,
  .affine-database-column-content.edit {
    background: var(--affine-hover-color);
  }
  .affine-database-column-content.edit .affine-database-column-text-icon {
    opacity: 1;
  }
  .affine-database-column-text {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 6px;
    /* https://stackoverflow.com/a/36247448/15443637 */
    overflow: hidden;
    color: var(--affine-text-secondary-color);
    font-size: 14px;
  }
  .affine-database-column-type-icon {
    display: flex;
    align-items: center;
    border-radius: 4px;
    padding: 2px;
  }
  .affine-database-column-type-icon svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
  }
  .affine-database-column-text-content {
    flex: 1;
    display: flex;
    align-items: center;
    overflow: hidden;
  }
  .affine-database-column-content:hover .affine-database-column-text-icon {
    opacity: 1;
  }
  .affine-database-column-text-input {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .affine-database-column-text-icon {
    display: flex;
    align-items: center;
    width: 16px;
    height: 16px;
    background: var(--affine-white);
    border: 1px solid var(--affine-border-color);
    border-radius: 4px;
    opacity: 0;
  }
  .affine-database-column-text-save-icon {
    display: flex;
    align-items: center;
    width: 16px;
    height: 16px;
    border: 1px solid transparent;
    border-radius: 4px;
    fill: var(--affine-icon-color);
  }
  .affine-database-column-text-save-icon:hover {
    background: var(--affine-white);
    border-color: var(--affine-border-color);
  }
  .affine-database-column-text-icon svg {
    fill: var(--affine-icon-color);
  }
  .affine-database-column-input {
    width: 100%;
    height: 24px;
    padding: 0;
    border: none;
    color: inherit;
    font-weight: 600;
    font-size: 14px;
    font-family: var(--affine-font-family);
    background: transparent;
  }
  .affine-database-column-input:focus {
    outline: none;
  }
  .affine-database-column-move {
    display: flex;
    align-items: center;
  }
  .affine-database-column-move svg {
    width: 10px;
    height: 14px;
    color: var(--affine-black-10);
    cursor: grab;
    opacity: 0;
  }
  .affine-database-column-content:hover svg {
    opacity: 1;
  }

  .affine-database-add-column-button {
    visibility: hidden;
    position: fixed;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 38px;
    cursor: pointer;
  }
  .header-add-column-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 100%;
    cursor: pointer;
  }

  .affine-database-column-move-preview {
    position: fixed;
    z-index: 100;
    width: 100px;
    height: 100px;
    background: var(--affine-text-emphasis-color);
  }
`;var __decorate$R=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DatabaseColumnHeader=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this._isHeaderHover=!1,this.showAddColumnButton=_=>{const y=this.closest(".data-view-root");assertExists(y);const{right:w}=y.getBoundingClientRect(),{left:$}=this._headerAddColumnButton.getBoundingClientRect();let B=!0;_&&(B=_.offsetY<=DEFAULT_COLUMN_TITLE_HEIGHT&&_.offsetY>=0),w<=$&&this._isHeaderHover&&B?this._addColumnButton.style.visibility="visible":this._addColumnButton.style.visibility="hidden"},this._onAddColumn=()=>{this.readonly||(this.tableViewManager.columnAdd("end"),requestAnimationFrame(()=>{this.editLastColumnTitle()}))},this.editLastColumnTitle=()=>{const _=this.querySelectorAll("affine-database-header-column"),y=_.item(_.length-1);y.scrollIntoView({block:"nearest",inline:"nearest"}),y.editTitle()}}get readonly(){return this.tableViewManager.readonly}firstUpdated(){if(this.readonly)return;this._disposables.add(this.tableViewManager.slots.update.on(()=>{this.requestUpdate()})),this._initHeaderMousemoveHandlers();const _=this.closest(".data-view-root");_&&this._initResizeEffect(_)}_initResizeEffect(_){const w=getDocPageByElement(this)?.viewportElement;w&&new ResizeObserver(B=>{for(const{target:R}of B)if(R===w){const{right:H}=_.getBoundingClientRect();this._addColumnButton.style.left=`${H}px`;break}}).observe(w)}_initHeaderMousemoveHandlers(){this._disposables.addFromEvent(this._headerContainer,"mouseover",_=>{this._isHeaderHover=!0,this.showAddColumnButton(_)}),this._disposables.addFromEvent(this._headerContainer,"mouseleave",_=>{this._isHeaderHover=!1,this.showAddColumnButton(_)})}render(){return n$5`
      <div class="affine-database-column-header database-row">
        ${c$1(this.tableViewManager.columnManagerList,_=>_.id,(_,y)=>{const w=o$4({width:`${_.width}px`,border:y===0?"none":void 0});return n$5` <affine-database-header-column
              style="${w}"
              data-column-id="${_.id}"
              data-column-index="${y}"
              class="affine-database-column database-cell"
              .column="${_}"
              .tableViewManager="${this.tableViewManager}"
            ></affine-database-header-column>`})}
        <div class="affine-database-column database-cell add-column-button">
          ${this.readonly?null:n$5` <div
                class="header-add-column-button"
                @click="${this._onAddColumn}"
              >
                ${DatabaseAddColumn}
              </div>`}
        </div>
        ${this.readonly?null:n$5` <div
              class="affine-database-add-column-button"
              data-test-id="affine-database-add-column-button"
              @click="${this._onAddColumn}"
            >
              ${DatabaseAddColumn}
            </div>`}
      </div>
    `}};DatabaseColumnHeader.styles=styles$f;__decorate$R([n$a({attribute:!1})],DatabaseColumnHeader.prototype,"tableViewManager",void 0);__decorate$R([i$6(".affine-database-column-header")],DatabaseColumnHeader.prototype,"_headerContainer",void 0);__decorate$R([i$6(".affine-database-add-column-button")],DatabaseColumnHeader.prototype,"_addColumnButton",void 0);__decorate$R([i$6(".header-add-column-button")],DatabaseColumnHeader.prototype,"_headerAddColumnButton",void 0);DatabaseColumnHeader=__decorate$R([e$7("affine-database-column-header")],DatabaseColumnHeader);var __decorate$Q=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const dragBarWidth=16;let ColumnWidthDragBar=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.dragLeft=0,this._bar=e$1(),this._startDrag=_=>{const y=getTableContainer(this),w=this.closest("affine-database-table"),$=w?.offsetParent,B=this._bar.value;assertExists(B),assertExists(w),assertExists($);const R=B.getBoundingClientRect(),H=R.width/dragBarWidth,j=y.getBoundingClientRect(),q=R.left+R.width/2-this.column.width*H-H,X=createWidthAdjustPreview(w,H,this.column.width,j.height/H,j.top-H,q);y.style.pointerEvents="none",startDrag(_,{onDrag:()=>({width:this.column.width}),onMove:({x:ee})=>{const te=Math.round(getResultInRange((ee-q)/H,DEFAULT_COLUMN_MIN_WIDTH,1/0));return this.dragLeft=te-this.column.width,X.display(te),{width:te}},onDrop:({width:ee})=>{this.column.updateWidth(ee)},onClear:()=>{y.style.pointerEvents="auto",this.dragLeft=0,X.remove()}})}}render(){if(this.column.dataViewManager.readonly)return;const _=o$4({left:`${this.left-dragBarWidth/2+this.dragLeft}px`,width:`${dragBarWidth}px`,"z-index":this.dragLeft?"999":void 0}),y=o$4({opacity:this.dragLeft?"1":void 0});return x$1`
      <div
        ${n$2(this._bar)}
        style=${_}
        class="column-width-drag-bar"
        @mousedown="${this._startDrag}"
      >
        <div class="preview-bar" style=${y}></div>
      </div>
    `}};ColumnWidthDragBar.styles=i$5`
    .column-width-drag-bar {
      height: 100%;
      position: absolute;
      top: 0;
      cursor: col-resize;
      display: flex;
      justify-content: center;
    }

    .preview-bar {
      width: 2px;
      height: 100%;
      background-color: blue;
      transition: 0.3s opacity;
      opacity: 0;
    }

    .column-width-drag-bar:hover .preview-bar {
      opacity: 1;
    }
  `;__decorate$Q([n$a({attribute:!1})],ColumnWidthDragBar.prototype,"left",void 0);__decorate$Q([n$a({attribute:!1})],ColumnWidthDragBar.prototype,"column",void 0);__decorate$Q([t$2()],ColumnWidthDragBar.prototype,"dragLeft",void 0);ColumnWidthDragBar=__decorate$Q([e$7("affine-database-column-width-drag-bar")],ColumnWidthDragBar);const createWidthAdjustPreview=(k,_,y,w,$,B)=>{const R=document.createElement("div");R.style.pointerEvents="none",R.style.position="absolute",R.style.width=`${y}px`,R.style.height=`${w}px`,R.style.zIndex="9",R.style.backgroundColor="rgba(0,0,0,0.3)",k.append(R);const H=R.offsetParent;assertExists(H);const j=H.getBoundingClientRect(),q=(B-j.left)/_,X=($-j.top)/_;return R.style.left=`${q}px`,R.style.top=`${X}px`,{display(ee){R.style.width=`${ee}px`},remove(){R.remove()}}};var __decorate$P=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DatabaseCellContainer=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.isEditing=!1,this._selectCurrentCell=_=>{this.selectionView&&(this.selectionView.selection={focus:{rowIndex:this.rowIndex,columnIndex:this.columnIndex},isEditing:_})},this._cell=e$1()}get selectionView(){return this.closest("affine-database-table")?.selection}get readonly(){return this.column.readonly}get table(){const _=this.closest("affine-database-table");return assertExists(_),_}get cell(){return this._cell.value}connectedCallback(){super.connectedCallback(),this._disposables.addFromEvent(this,"click",()=>{this.isEditing||this._selectCurrentCell(!this.column.readonly)})}render(){const{edit:_,view:y}=this.column.renderer,w=!this.readonly&&this.isEditing&&_!=null?_:y,$={view:this.view,column:this.column,rowId:this.rowId,isEditing:this.isEditing,selectCurrentCell:this._selectCurrentCell};return renderUniLit(w,$,{ref:this._cell,style:{display:"contents"}})}};DatabaseCellContainer.styles=i$5`
    affine-database-cell-container {
      display: flex;
      align-items: start;
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
    }

    affine-database-cell-container * {
      box-sizing: border-box;
    }

    affine-database-cell-container uni-lit > *:first-child {
      padding: 8px;
    }
  `;__decorate$P([t$2()],DatabaseCellContainer.prototype,"isEditing",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"view",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"rowId",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"rowIndex",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"columnId",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"columnIndex",void 0);__decorate$P([n$a({attribute:!1})],DatabaseCellContainer.prototype,"column",void 0);DatabaseCellContainer=__decorate$P([e$7("affine-database-cell-container")],DatabaseCellContainer);var __decorate$O=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let RecordField=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.isFocus=!1,this.editing=!1,this._cell=e$1(),this.changeEditing=_=>{const y=this.closest("affine-data-view-record-detail")?.selection;y&&(y.selection={propertyId:this.column.id,isEditing:_})},this._click=_=>{_.stopPropagation(),this.changeEditing(!0)},this._clickLeft=_=>{const y=_.currentTarget,w=this.view.detailColumns;popMenu(y,{options:{input:{initValue:this.column.name,onComplete:$=>{this.column.updateName($)}},items:[{type:"sub-menu",name:"Column type",icon:TextIcon,hide:()=>!this.column.updateType||this.column.type==="title",options:{input:{search:!0},items:this.view.allColumnConfig.filter($=>$.type!==this.column.type).map($=>({type:"action",name:$.name,icon:n$5` <uni-lit
                      .uni="${this.view.getIcon($.type)}"
                    ></uni-lit>`,select:()=>{this.column.updateType?.($.type)}}))}},{type:"action",name:"Duplicate column",icon:DatabaseDuplicate,hide:()=>!this.column.duplicate||this.column.type==="title",select:()=>{this.column.duplicate?.()}},{type:"action",name:"Move up",icon:n$5` <div
              style="transform: rotate(90deg);display:flex;align-items:center;"
            >
              ${DatabaseMoveLeft}
            </div>`,hide:()=>w.findIndex($=>$===this.column.id)===0,select:()=>{const $=w.findIndex(R=>R===this.column.id),B=w[$-1];B&&this.view.columnMove(this.column.id,{id:B,before:!0})}},{type:"action",name:"Move down",icon:n$5` <div
              style="transform: rotate(90deg);display:flex;align-items:center;"
            >
              ${DatabaseMoveRight}
            </div>`,hide:()=>w.findIndex($=>$===this.column.id)===w.length-1,select:()=>{const $=w.findIndex(R=>R===this.column.id),B=w[$+1];B&&this.view.columnMove(this.column.id,{id:B,before:!1})}},{type:"group",name:"operation",children:()=>[{type:"action",name:"Delete column",icon:DeleteIcon,hide:()=>!this.column.delete||this.column.type==="title",select:()=>{this.column.delete?.()},class:"delete-item"}]}]}})}}get cell(){return this._cell.value}render(){const _=this.column,y={view:this.view,column:this.column,rowId:this.rowId,isEditing:this.editing,selectCurrentCell:this.changeEditing},{view:w,edit:$}=this.column.renderer,B=o$3({"field-content":!0,"is-editing":this.editing,"is-focus":this.isFocus});return n$5`
      <div class="field-left" @click="${this._clickLeft}">
        <div class="icon">
          <uni-lit .uni="${this.column.icon}"></uni-lit>
        </div>
        <div class="filed-name">${_.name}</div>
      </div>
      <div @click="${this._click}" class="${B}">
        ${renderUniLit(this.editing&&$?$:w,y,{ref:this._cell,class:"kanban-cell"})}
      </div>
    `}};RecordField.styles=i$5`
    affine-data-view-record-field {
      display: flex;
      gap: 12px;
    }

    .field-left {
      padding: 4px 6px 4px 4px;
      display: flex;
      height: max-content;
      align-items: center;
      gap: 4px;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      color: var(--affine-text-secondary-color);
      width: 116px;
      border-radius: 4px;
      cursor: pointer;
    }

    .field-left:hover {
      background-color: var(--affine-hover-color);
    }

    affine-data-view-record-field .icon {
      display: flex;
      align-items: center;
      width: 16px;
      height: 16px;
    }

    affine-data-view-record-field .icon svg {
      width: 16px;
      height: 16px;
      fill: var(--affine-icon-color);
    }

    .filed-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .field-content {
      padding: 4px 6px;
      border-radius: 4px;
      flex: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      border: 1px solid transparent;
    }

    .field-content:hover {
      background-color: var(--affine-hover-color);
    }

    .field-content.is-editing {
      box-shadow: 0px 0px 0px 2px rgba(30, 150, 235, 0.3);
    }

    .field-content.is-focus {
      border: 1px solid var(--affine-primary-color);
    }
  `;__decorate$O([n$a({attribute:!1})],RecordField.prototype,"view",void 0);__decorate$O([n$a({attribute:!1})],RecordField.prototype,"column",void 0);__decorate$O([n$a({attribute:!1})],RecordField.prototype,"rowId",void 0);__decorate$O([t$2()],RecordField.prototype,"isFocus",void 0);__decorate$O([t$2()],RecordField.prototype,"editing",void 0);RecordField=__decorate$O([e$7("affine-data-view-record-field")],RecordField);const dataViewCssVariable=k=>`
  ${k}{
      --data-view-cell-text-size:14px;
      --data-view-cell-text-line-height:22px;
  }
`;var __decorate$N=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$e=i$5`
  affine-data-view-kanban-cell {
    border-radius: 4px;
    display: flex;
    align-items: center;
    padding: 4px;
    min-height: 20px;
    border: 1px solid transparent;
    box-sizing: border-box;
  }

  affine-data-view-kanban-cell:hover {
    background-color: var(--affine-hover-color);
  }

  affine-data-view-kanban-cell .icon {
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: start;
    margin-right: 12px;
    height: var(--data-view-cell-text-line-height);
  }

  affine-data-view-kanban-cell .icon svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
  }

  .kanban-cell {
    flex: 1;
    display: block;
    width: 196px;
  }
`;let KanbanCell=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.contentOnly=!1,this.isFocus=!1,this.editing=!1,this._cell=e$1(),this.selectCurrentCell=_=>{const y=this.closest("affine-data-view-kanban")?.selection;y&&(y.selection={groupKey:this.groupKey,cardId:this.cardId,focus:{columnId:this.column.id,isEditing:_}})}}get cell(){return this._cell.value}connectedCallback(){super.connectedCallback(),this._disposables.addFromEvent(this,"click",_=>{_.stopPropagation(),this.editing||this.selectCurrentCell(!this.column.readonly)})}get selection(){return this.closest("affine-data-view-kanban")?.selection}renderIcon(){if(!this.contentOnly)return n$5` <uni-lit class="icon" .uni="${this.column.icon}"></uni-lit>`}render(){const _={view:this.view,column:this.column,rowId:this.cardId,isEditing:this.editing,selectCurrentCell:this.selectCurrentCell},{view:y,edit:w}=this.column.renderer;return this.style.border=this.isFocus?"1px solid var(--affine-primary-color)":"",this.style.boxShadow=this.editing?"0px 0px 0px 2px rgba(30, 150, 235, 0.30)":"",n$5` ${this.renderIcon()}
    ${renderUniLit(this.editing&&w?w:y,_,{ref:this._cell,class:"kanban-cell"})}`}};KanbanCell.styles=styles$e;__decorate$N([n$a({attribute:!1})],KanbanCell.prototype,"contentOnly",void 0);__decorate$N([n$a({attribute:!1})],KanbanCell.prototype,"view",void 0);__decorate$N([n$a({attribute:!1})],KanbanCell.prototype,"groupKey",void 0);__decorate$N([n$a({attribute:!1})],KanbanCell.prototype,"cardId",void 0);__decorate$N([n$a({attribute:!1})],KanbanCell.prototype,"column",void 0);__decorate$N([t$2()],KanbanCell.prototype,"isFocus",void 0);__decorate$N([t$2()],KanbanCell.prototype,"editing",void 0);KanbanCell=__decorate$N([e$7("affine-data-view-kanban-cell")],KanbanCell);class DetailSelection{constructor(_){this.viewEle=_,this.onSelect=y=>{const w=this._selection;w&&this.blur(w),this._selection=y,y&&this.focus(y)}}get selection(){return this._selection}set selection(_){if(!_){this.onSelect();return}if(_.isEditing){const w=this.getFocusCellContainer(_)?.cell,$=w&&w.beforeEnterEditMode()?_.isEditing:!1;this.onSelect({propertyId:_.propertyId,isEditing:$})}else this.onSelect(_)}blur(_){const y=this.getFocusCellContainer(_);if(!y)return;y.isFocus=!1;const w=y?.cell;_.isEditing?(w?.onExitEditMode(),w?.blurCell()&&y.blur(),y.editing=!1):y.blur()}focus(_){const y=this.getFocusCellContainer(_);if(!y)return;y.isFocus=!0;const w=y?.cell;_.isEditing?(w?.onEnterEditMode(),w?.focusCell()&&y.focus(),y.editing=!0):y.focus()}getSelectCard(_){return this.viewEle.querySelector(`affine-data-view-kanban-group[data-key="${_.groupKey}"]`)?.querySelector(`affine-data-view-kanban-card[data-card-id="${_.cardId}"]`)}getFocusCellContainer(_){return this.viewEle.querySelector(`affine-data-view-record-field[data-column-id="${_.propertyId}"]`)}focusUp(){const _=this.selection;if(!_||_?.isEditing)return;const y=this.getFocusCellContainer(_)?.previousElementSibling;y instanceof RecordField&&(this.selection={propertyId:y.column.id,isEditing:!1})}focusDown(){const _=this.selection;if(!_||_?.isEditing)return;const y=this.getFocusCellContainer(_)?.nextElementSibling;y instanceof KanbanCell&&(this.selection={propertyId:y.column.id,isEditing:!1})}deleteProperty(){}focusFirstCell(){const _=this.viewEle.querySelector("affine-data-view-record-field")?.column.id;_&&(this.selection={propertyId:_,isEditing:!0})}}var __decorate$M=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$d=i$5`
  ${r$2(dataViewCssVariable("affine-data-view-record-detail"))}
  affine-data-view-record-detail {
    display: flex;
    flex-direction: column;
    padding: 0 36px;
    gap: 12px;
    height: 100%;
  }

  .add-property {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--data-view-cell-text-size);
    font-style: normal;
    font-weight: 400;
    line-height: var(--data-view-cell-text-line-height);
    color: var(--affine-text-secondary-color);
    border-radius: 4px;
    padding: 4px;
    cursor: pointer;
  }

  .add-property:hover {
    background-color: var(--affine-hover-color);
  }

  .add-property .icon {
    display: flex;
    align-items: center;
  }

  .add-property .icon svg {
    fill: var(--affine-icon-color);
    width: 20px;
    height: 20px;
  }
`;let RecordDetail=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.selection=new DetailSelection(this),this._clickAddProperty=()=>{popFilterableSimpleMenu(this.addPropertyButton,this.view.allColumnConfig.map(_=>({type:"action",name:_.name,icon:n$5` <uni-lit
            .uni="${this.view.getIcon(_.type)}"
          ></uni-lit>`,select:()=>{this.view.columnAdd("end",_.type)}})))}}connectedCallback(){super.connectedCallback(),this._disposables.add(this.view.slots.update.on(()=>{this.requestUpdate()})),this._disposables.addFromEvent(this,"click",_=>{_.stopPropagation(),this.selection.selection=void 0})}get columns(){return this.view.detailColumns.map(_=>this.view.columnGet(_))}render(){const _=this.columns;return n$5`
      ${this.renderHeader()}
      ${c$1(_,y=>y,y=>n$5` <affine-data-view-record-field
            .view="${this.view}"
            .column="${y}"
            .rowId="${this.rowId}"
            data-column-id="${y.id}"
          ></affine-data-view-record-field>`)}
      <div class="add-property" @click="${this._clickAddProperty}">
        <div class="icon">${PlusIcon}</div>
        Add Property
      </div>
    `}renderHeader(){const _=this.view.detailSlots.header;if(_){const y={view:this.view,rowId:this.rowId};return renderUniLit(_,y)}}};RecordDetail.styles=styles$d;__decorate$M([n$a({attribute:!1})],RecordDetail.prototype,"view",void 0);__decorate$M([n$a({attribute:!1})],RecordDetail.prototype,"rowId",void 0);__decorate$M([i$6(".add-property")],RecordDetail.prototype,"addPropertyButton",void 0);RecordDetail=__decorate$M([e$7("affine-data-view-record-detail")],RecordDetail);var __decorate$L=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const close=x$1`<svg
  width="20"
  height="20"
  viewBox="0 0 20 20"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.55806 4.55806C4.80214 4.31398 5.19786 4.31398 5.44194 4.55806L10 9.11612L14.5581 4.55806C14.8021 4.31398 15.1979 4.31398 15.4419 4.55806C15.686 4.80214 15.686 5.19786 15.4419 5.44194L10.8839 10L15.4419 14.5581C15.686 14.8021 15.686 15.1979 15.4419 15.4419C15.1979 15.686 14.8021 15.686 14.5581 15.4419L10 10.8839L5.44194 15.4419C5.19786 15.686 4.80214 15.686 4.55806 15.4419C4.31398 15.1979 4.31398 14.8021 4.55806 14.5581L9.11612 10L4.55806 5.44194C4.31398 5.19786 4.31398 4.80214 4.55806 4.55806Z"
    fill="currentColor"
  />
</svg> `;let SideLayoutModal=class extends ShadowlessElement{renderOps(){return x$1``}render(){return x$1`
      <div class="side-modal-header">
        <div class="header-ops">${this.renderOps()}</div>
        <div @click="${this.close}" class="close-modal header-op">${close}</div>
      </div>
      ${this.content}
    `}};SideLayoutModal.styles=i$5`
    side-layout-modal {
      display: block;
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 500px;
      background-color: var(--affine-background-primary-color);
      border-left: 0.5px solid var(--affine-border-color);
      box-shadow: -5px 0px 10px 0px rgba(0, 0, 0, 0.05);
    }

    .side-modal-header {
      margin: 12px 0;
      padding: 0 12px;
      display: flex;
      align-items: center;
      justify-content: end;
    }

    .header-ops {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-op {
      display: flex;
      align-items: center;
      padding: 2px;
      border-radius: 4px;
      cursor: pointer;
    }

    .header-op svg {
      width: 20px;
      height: 20px;
      fill: var(--affine-icon-color);
    }

    .header-op:hover {
      background-color: var(--affine-hover-color);
    }

    .close-modal {
      margin-left: 20px;
    }
  `;__decorate$L([n$a({attribute:!1})],SideLayoutModal.prototype,"content",void 0);__decorate$L([n$a({attribute:!1})],SideLayoutModal.prototype,"close",void 0);SideLayoutModal=__decorate$L([e$7("side-layout-modal")],SideLayoutModal);const popSideDetail=k=>{const _=createModal(),y=()=>{_.remove(),k.onClose?.()},w=new RecordDetail;w.view=k.view,w.rowId=k.rowId;const $=new SideLayoutModal;$.content=w,$.close=y,$.onclick=B=>{B.stopPropagation()},_.onclick=y,_.append($)},openDetail$1=(k,_)=>{const y=_.selection;_.selection=void 0,popSideDetail({view:_.tableView.view,rowId:k,onClose:()=>{_.selection=y}})},popRowMenu=(k,_,y)=>{popFilterableSimpleMenu(k,[{type:"action",name:"Expand row",icon:ExpandFullIcon,select:()=>{openDetail$1(_,y)}},{type:"group",name:"",children:()=>[{type:"action",name:"Insert before",icon:x$1` <div
            style="transform: rotate(90deg);display:flex;align-items:center;"
          >
            ${MoveLeftIcon}
          </div>`,select:()=>{y.insertRowBefore(_)}},{type:"action",name:"Insert after",icon:x$1` <div
            style="transform: rotate(90deg);display:flex;align-items:center;"
          >
            ${MoveRightIcon}
          </div>`,select:()=>{y.insertRowAfter(_)}}]},{type:"group",name:"",children:()=>[{type:"action",name:"Delete row",class:"delete-item",icon:DeleteIcon,select:()=>{y.deleteRow(_)}}]}])};var __decorate$K=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DatabaseSelectionView=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.focusRef=e$1(),this.selectionRef=e$1(),this.selectionStyleUpdateTask=0}get tableContainer(){const _=this.parentElement;return assertExists(_),_}firstUpdated(){this.bindKeyMap(),this.handleDragEvent(),this.handleSelectionChange()}handleSelectionChange(){this._disposables.add(this.tableView.selectionUpdated.on(_=>{if(!this.isValidSelection(_)){this.selection=void 0;return}const y=this._tableViewSelection;if(requestAnimationFrame(()=>{this.scrollToFocus()}),y){const w=this.getCellContainer(y.focus.rowIndex,y.focus.columnIndex);if(w){const $=w.cell;y.isEditing&&($?.onExitEditMode(),$?.blurCell(),w.isEditing=!1)}}if(this.updateSelection(_),_){const w=this.getCellContainer(_.focus.rowIndex,_.focus.columnIndex);if(w){const $=w.cell;_.isEditing&&($?.onEnterEditMode(),w.isEditing=!0,$?.focusCell())}}}))}handleDragEvent(){let _=!1;this._disposables.add(this.tableView.handleEvent("dragStart",y=>{_=!0;const w=y.get("pointerState").raw,$=w.target;if($ instanceof Element){const B=$.closest("affine-database-cell-container");if(B){const R=this.selection;if(R&&R.isEditing&&R.focus.rowIndex===B.rowIndex&&R.focus.columnIndex===B.columnIndex)return!1;this.startDrag(w,B)}return w.preventDefault(),!0}return!1})),this._disposables.add(this.tableView.handleEvent("dragMove",y=>(_&&y.get("pointerState").raw.preventDefault(),!1))),this._disposables.add(this.tableView.handleEvent("dragEnd",()=>(_=!1,!1)))}isValidSelection(_){return _?_.focus.rowIndex>this.tableView.view.rows.length-1?(this.selection=void 0,!1):_.focus.columnIndex>this.tableView.view.columns.length-1?(this.selection=void 0,!1):!0:!0}clearSelection(){this.tableView.setSelection()}get selection(){return this._tableViewSelection}set selection(_){if(!_){this.clearSelection();return}const y={..._,viewId:this.tableView.view.id,type:"table"};if(y.isEditing){const w=y.focus,B=this.getCellContainer(w.rowIndex,w.columnIndex)?.cell,R=B?B.beforeEnterEditMode():!0;this.tableView.setSelection({...y,isEditing:R})}else this.tableView.setSelection(y)}cellPosition(_,y){const w=this.rows(),$=w.item(0).querySelectorAll("affine-database-cell-container"),B=Array.from(w).map(H=>H.getBoundingClientRect().top-y),R=Array.from($).map(H=>H.getBoundingClientRect().left-_);return(H,j,q,X)=>{const[ee,te]=H<j?[H,j]:[j,H],[ne,oe]=q<X?[q,X]:[X,q],ie={start:0,end:0},ae={start:0,end:0};for(let re=0;re<B.length;re++){const se=B[re];se<ne&&(ie.start=re),se<oe&&(ie.end=re)}for(let re=0;re<R.length;re++){const se=R[re];se<ee&&(ae.start=re),se<te&&(ae.end=re)}return{row:ie,column:ae}}}startDrag(_,y){const $=this.tableContainer.getBoundingClientRect(),B=_.x-$.left,R=_.y-$.top,H=this.cellPosition($.left,$.top),j=q=>{this.selection={rowsSelection:q.row,columnsSelection:q.column,focus:{rowIndex:y.rowIndex,columnIndex:y.columnIndex},isEditing:!1}};startDrag(_,{transform:q=>({x:q.x,y:q.y}),onDrag:()=>{},onMove:({x:q,y:X})=>{const ee=q-$.left,te=X-$.top,ne=H(ee,B,te,R);return j(ne),ne},onDrop:q=>{q&&j(q)},onClear:()=>{}})}bindKeyMap(){this._disposables.add(this.tableView.bindHotkey({Backspace:()=>{const _=this.selection;if(!_)return;const y=_.rowsSelection;if(y&&!_.columnsSelection){const w=this.tableView.view.rows.filter(($,B)=>B>=y.start&&B<=y.end);this.tableView.view.rowDelete(w),this.focusTo(y.start-1,_.focus.columnIndex)}},Escape:()=>{const _=this.selection;if(!_)return!1;const y=_.rowsSelection;return _.isEditing?this.selection={..._,isEditing:!1}:y&&!_.columnsSelection?this.selection={..._,rowsSelection:void 0,columnsSelection:void 0}:this.selection={..._,rowsSelection:{start:y?.start??_.focus.rowIndex,end:y?.end??_.focus.rowIndex},columnsSelection:void 0},!0},Enter:_=>{const y=this.selection;return!y||y.isEditing?!1:(this.selection={...y,rowsSelection:void 0,columnsSelection:void 0,isEditing:!0},_.get("keyboardState").raw.preventDefault(),!0)},"Shift-Enter":()=>{const _=this.selection;if(!_||_.isEditing)return!1;const y=this.getCellContainer(_.focus.rowIndex,_.focus.columnIndex);return y&&this.insertRowAfter(y.rowId),!0},Tab:_=>{const y=this.selection;if(!y||y.isEditing)return!1;_.get("keyboardState").raw.preventDefault();const $=y.focus.columnIndex,B=y.focus.rowIndex,R=this.tableView.view.columnManagerList.length,H=this.tableView.view.rows.length;if($===R-1&&B===H-1)return!0;const j=$===R-1,q=j?0:$+1,X=j?B+1:B;return this.focusTo(X,q),!0},"Shift-Tab":_=>{const y=this.selection;if(!y||y.isEditing)return!1;_.get("keyboardState").raw.preventDefault();const $=this.tableView.view.columnManagerList.length,B=y.focus.columnIndex,R=y.focus.rowIndex;if(B===0&&R===0)return!0;const H=B===0,j=H?$-1:B-1,q=H?R-1:R;return this.focusTo(q,j),!0},ArrowLeft:_=>{const y=this.selection;if(!y||y.isEditing)return!1;const w=this.tableView.view.columnManagerList.length,$=y.focus.columnIndex-1;return this.focusTo(y.focus.rowIndex+($<0?-1:0),$<0?w-1:$),_.get("keyboardState").raw.preventDefault(),!0},ArrowRight:_=>{const y=this.selection;if(!y||y.isEditing)return!1;const w=this.tableView.view.columnManagerList.length,$=y.focus.columnIndex+1;return this.focusTo(y.focus.rowIndex+($>=w?1:0),$%w),_.get("keyboardState").raw.preventDefault(),!0},ArrowUp:_=>{const y=this.selection;return!y||y.isEditing?!1:(this.focusTo(y.focus.rowIndex-1,y.focus.columnIndex),_.get("keyboardState").raw.preventDefault(),!0)},ArrowDown:_=>{const y=this.selection;return!y||y.isEditing?!1:(this.focusTo(y.focus.rowIndex+1,y.focus.columnIndex),_.get("keyboardState").raw.preventDefault(),!0)},"Mod-a":()=>{const _=this.selection;if(_?.isEditing)return!0;if(_){const w=this.tableView.view.rows.length-1;return _.rowsSelection?.start===0&&_.rowsSelection.end===w&&!_.columnsSelection?!1:(this.selection={rowsSelection:{start:0,end:w},focus:_.focus,isEditing:!1},!0)}},"/":_=>{const y=this.selection;if(!y||y.columnsSelection||y.isEditing)return;const w=this.getCellContainer(y.focus.rowIndex,y.focus.columnIndex);w&&(_.get("keyboardState").raw.preventDefault(),popRowMenu(w,w.rowId,this))}}))}focusTo(_,y){_<0||_>=this.tableView.view.rows.length||y<0||y>=this.tableView.view.columnManagerList.length||(this.selection={isEditing:!1,focus:{rowIndex:_,columnIndex:y}},this.focusRef.value?.scrollIntoView({block:"nearest",inline:"nearest"}))}selectRange(_,y,w){this.selection={..._,rowsSelection:y,columnsSelection:w,isEditing:!1}}getCellContainer(_,y){return this.rows().item(_)?.querySelectorAll("affine-database-cell-container").item(y)}rows(){return this.tableContainer.querySelectorAll(".affine-database-block-row")}updateSelection(_){const y=()=>{this.updateSelectionStyle(_?.rowsSelection,_?.columnsSelection);const w=_?.rowsSelection&&!_?.columnsSelection;this.updateFocusSelectionStyle(_?.focus,w,_?.isEditing)};if(!_)cancelAnimationFrame(this.selectionStyleUpdateTask),y();else{const w=()=>{y(),cancelAnimationFrame(this.selectionStyleUpdateTask),this.selectionStyleUpdateTask=requestAnimationFrame(w)};w()}this._tableViewSelection=_}updateSelectionStyle(_,y){const w=this.selectionRef.value;if(!w)return;if(!_&&!y){w.style.display="none";return}const $=this.tableContainer.getBoundingClientRect(),{left:B,top:R,width:H,height:j,scale:q}=this.getRect(_?.start??0,_?.end??this.tableView.view.rows.length-1,y?.start??0,y?.end??this.tableView.view.columnManagerList.length-1);w.style.left=`${B-$.left/q}px`,w.style.top=`${R-$.top/q}px`,w.style.width=`${H}px`,w.style.height=`${j}px`,w.style.display="block";const X=_&&!y;w.style.border=X?"1px solid var(--affine-primary-color)":"unset"}updateFocusSelectionStyle(_,y,w=!1){const $=this.focusRef.value;if($)if(_&&!y){if(this.rows().length<=_.rowIndex)return;const{left:R,top:H,width:j,height:q,scale:X}=this.getRect(_.rowIndex,_.rowIndex,_.columnIndex,_.columnIndex),ee=this.tableContainer.getBoundingClientRect();$.style.left=`${R-ee.left/X}px`,$.style.top=`${H-1-ee.top/X}px`,$.style.width=`${j+1}px`,$.style.height=`${q+1}px`,$.style.borderColor="var(--affine-primary-color)",$.style.boxShadow=w?"0px 0px 0px 2px rgba(30, 150, 235, 0.30)":"unset",$.style.display="block"}else $.style.display="none"}getRect(_,y,w,$){const B=this.rows(),R=B.item(_),H=B.item(y),j=R.querySelectorAll("affine-database-cell-container"),q=j.item(w),X=j.item($),ee=q.getBoundingClientRect(),te=ee.width/q.column.width;return{top:ee.top/te,left:ee.left/te,width:(X.getBoundingClientRect().right-ee.left)/te,height:(H.getBoundingClientRect().bottom-ee.top)/te,scale:te}}selectRow(_){this.selection={rowsSelection:{start:_,end:_},focus:{rowIndex:_,columnIndex:0},isEditing:!1}}toggleRow(_){const y=this.selection;if(y){const w=y.rowsSelection;if(w&&!y.columnsSelection&&w.start===_&&w.end===_){this.selection={...y,rowsSelection:void 0};return}}this.selection={rowsSelection:{start:_,end:_},focus:{rowIndex:_,columnIndex:0},isEditing:!1}}render(){return x$1`
      <div ${n$2(this.selectionRef)} class="database-selection"></div>
      <div tabindex="0" ${n$2(this.focusRef)} class="database-focus"></div>
    `}focusFirstCell(){this.selection={focus:{rowIndex:0,columnIndex:0},isEditing:!0}}scrollToFocus(){this.focusRef.value?.scrollIntoView({block:"nearest",inline:"nearest"})}insertRowBefore(_){const y=this.tableView.view.rowAdd({before:!0,id:_});this.selection={focus:{rowIndex:this.tableView.view.rows.findIndex(w=>w===y),columnIndex:this.selection?.focus.columnIndex??0},isEditing:!1}}insertRowAfter(_){const y=this.tableView.view.rowAdd({before:!1,id:_});requestAnimationFrame(()=>{this.selection={focus:{rowIndex:this.tableView.view.rows.findIndex(w=>w===y),columnIndex:this.selection?.focus.columnIndex??0},isEditing:!0}})}deleteRow(_){const y=this.tableView.view.rows.findIndex(w=>w===_);this.tableView.view.rowDelete([_]),requestAnimationFrame(()=>{this.selection={focus:{rowIndex:y-1,columnIndex:this.selection?.focus.columnIndex??0},isEditing:!0}})}};DatabaseSelectionView.styles=i$5`
    .database-selection {
      position: absolute;
      z-index: 1;
      box-sizing: border-box;
      background: var(--affine-primary-color-04);
      pointer-events: none;
      display: none;
    }

    .database-focus {
      position: absolute;
      width: 100%;
      z-index: 1;
      box-sizing: border-box;
      border: 1px solid var(--affine-primary-color);
      border-radius: 2px;
      pointer-events: none;
      display: none;
      outline: none;
    }

    @media print {
      affine-database-selection {
        display: none;
      }
    }
  `;__decorate$K([n$a({attribute:!1})],DatabaseSelectionView.prototype,"tableView",void 0);DatabaseSelectionView=__decorate$K([e$7("affine-database-selection")],DatabaseSelectionView);var __decorate$J=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};class BaseDataView extends WithDisposable(ShadowlessElement){}__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"view",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"titleText",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"bindHotkey",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"handleEvent",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"modalMode",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"setSelection",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"selectionUpdated",void 0);__decorate$J([n$a({attribute:!1})],BaseDataView.prototype,"getFlag",void 0);function DataBaseRowContainer(k,_){return x$1`
    <style>
      .affine-database-block-rows {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
      }

      .affine-database-block-row {
        width: 100%;
        display: flex;
        flex-direction: row;
        border-bottom: 1px solid var(--affine-border-color);
        position: relative;
      }

      .affine-database-block-row.selected > .database-cell {
        background: transparent;
      }

      .database-cell {
        min-width: ${DEFAULT_COLUMN_MIN_WIDTH}px;
      }

      .row-ops {
        position: relative;
        width: 0;
        margin-top: 8px;
        height: max-content;
        visibility: hidden;
        display: flex;
        gap: 4px;
        cursor: pointer;
        justify-content: end;
      }

      .row-op:last-child {
        margin-right: 8px;
      }

      .affine-database-block-row:hover .row-ops {
        visibility: visible;
      }

      .row-op {
        display: flex;
        padding: 4px;
        border-radius: 4px;
        box-shadow: 0px 0px 4px 0px rgba(66, 65, 73, 0.14);
        background-color: var(--affine-background-primary-color);
        position: relative;
      }

      .row-op:hover:before {
        content: '';
        border-radius: 4px;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background-color: var(--affine-hover-color);
      }

      .row-op svg {
        fill: var(--affine-icon-color);
        color: var(--affine-icon-color);
        width: 16px;
        height: 16px;
      }

      /*.database-cell:last-child affine-database-cell-container {*/
      /*  border-right: none;*/
      /*}*/
    </style>
    <div class="affine-database-block-rows">
      ${c$1(k.rows,y=>y,(y,w)=>x$1`
            <div
              class="affine-database-block-row database-row"
              data-row-index="${w}"
              data-row-id="${y}"
              @contextmenu="${B=>{B.preventDefault();const H=B.target.closest("affine-database-cell-container")?.columnIndex??0;_.selection={rowsSelection:{start:w,end:w},focus:{rowIndex:w,columnIndex:H},isEditing:!1},popRowMenu(positionToVRect(B.x,B.y),y,_)}}"
            >
              ${c$1(k.columnManagerList,B=>B.id,(B,R)=>{const H=()=>{_.selection={rowsSelection:{start:w,end:w},focus:{rowIndex:w,columnIndex:R},isEditing:!1},openDetail$1(y,_)},j=q=>{const X=q.currentTarget;_.selection={rowsSelection:{start:w,end:w},focus:{rowIndex:w,columnIndex:R},isEditing:!1},popRowMenu(X,y,_)};return x$1`
                    <div>
                      <affine-database-cell-container
                        class="database-cell"
                        style=${o$4({width:`${B.width}px`,border:R===0?"none":void 0})}
                        .view="${k}"
                        .column="${B}"
                        .rowId="${y}"
                        data-row-id="${y}"
                        .rowIndex="${w}"
                        data-row-index="${w}"
                        .columnId="${B.id}"
                        data-column-id="${B.id}"
                        .columnIndex="${R}"
                        data-column-index="${R}"
                      >
                      </affine-database-cell-container>
                    </div>
                    ${B.dataViewManager.header.titleColumn===B.id&&!k.readonly?x$1` <div class="row-ops">
                          <div class="row-op" @click="${H}">
                            ${NewEditIcon}
                          </div>
                          <div class="row-op" @click="${j}">
                            ${MoreHorizontalIcon}
                          </div>
                        </div>`:""}
                  `})}
              <div class="database-cell add-column-button"></div>
            </div>
          `)}
    </div>
  `}var __decorate$I=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$c=i$5`
  affine-database-table {
    position: relative;
  }

  affine-database-table * {
    box-sizing: border-box;
  }

  .affine-database-block-title-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 44px;
    margin: 2px 0 2px;
  }

  .affine-database-block-table {
    position: relative;
    width: 100%;
    padding-bottom: 4px;
    z-index: 1;
    overflow-x: scroll;
    overflow-y: hidden;
    border-top: 1.5px solid var(--affine-border-color);
  }

  .affine-database-block-table:hover {
    padding-bottom: 0px;
  }

  .affine-database-block-table::-webkit-scrollbar {
    -webkit-appearance: none;
    display: block;
  }

  .affine-database-block-table::-webkit-scrollbar:horizontal {
    height: 4px;
  }

  .affine-database-block-table::-webkit-scrollbar-thumb {
    border-radius: 2px;
    background-color: transparent;
  }

  .affine-database-block-table:hover::-webkit-scrollbar:horizontal {
    height: 8px;
  }

  .affine-database-block-table:hover::-webkit-scrollbar-thumb {
    border-radius: 16px;
    background-color: var(--affine-black-30);
  }

  .affine-database-block-table:hover::-webkit-scrollbar-track {
    background-color: var(--affine-hover-color);
  }

  .affine-database-table-container {
    position: relative;
    width: fit-content;
    min-width: 100%;
  }

  .affine-database-block-tag-circle {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
  }

  .affine-database-block-tag {
    display: inline-flex;
    border-radius: 11px;
    align-items: center;
    padding: 0 8px;
    cursor: pointer;
  }

  .affine-database-block-footer {
    display: flex;
    width: 100%;
    height: 28px;
    position: relative;
    margin-top: -8px;
    z-index: 0;
    background-color: var(--affine-hover-color-filled);
    opacity: 0;
  }

  @media print {
    .affine-database-block-footer {
      display: none;
    }
  }

  .affine-database-block-footer:hover {
    opacity: 1;
  }

  .affine-database-block-add-row {
    display: flex;
    flex: 1;
    align-items: center;
    justify-content: center;
    gap: 4px;
    width: 100%;
    height: 100%;
    cursor: pointer;
    user-select: none;
    font-size: 14px;
  }

  .affine-database-block-add-row svg {
    width: 16px;
    height: 16px;
  }

  .database-cell {
    border-left: 1px solid var(--affine-border-color);
  }

  ${tooltipStyle}
`;let DatabaseTable=class extends BaseDataView{constructor(){super(...arguments),this._onDatabaseScroll=()=>{this._columnHeaderComponent.showAddColumnButton()},this._addRow=(_,y)=>{if(this.readonly)return;const w=typeof y=="number"?y:insertPositionToIndex(y,this.view.rows.map($=>({id:$})));_.rowAdd(y),requestAnimationFrame(()=>{this.selection.selection={focus:{rowIndex:w,columnIndex:0},isEditing:!0}})},this._renderColumnWidthDragBar=()=>{let _=0;return c$1(this.view.columnManagerList,y=>y.id,y=>(_+=y.width,n$5` <affine-database-column-width-drag-bar
          .left="${_}"
          .column="${y}"
        ></affine-database-column-width-drag-bar>`))},this.getSelection=()=>this.selection.selection}get readonly(){return this.view.readonly}connectedCallback(){super.connectedCallback(),this._disposables.add(this.view.slots.update.on(()=>{this.requestUpdate()})),!this.readonly&&requestAnimationFrame(()=>{const _=this._tableContainer.parentElement;assertExists(_),this._disposables.addFromEvent(_,"scroll",this._onDatabaseScroll)})}addRow(_){this._addRow(this.view,_)}render(){const _=DataBaseRowContainer(this.view,this.selection),y=w=>{this._addRow(this.view,w)};return n$5`
      <div class="affine-database-table">
        <div class="affine-database-block-table">
          <div class="affine-database-table-container">
            <affine-database-column-header
              .tableViewManager="${this.view}"
            ></affine-database-column-header>
            ${_} ${this._renderColumnWidthDragBar()}
            <affine-database-selection
              .tableView="${this}"
            ></affine-database-selection>
          </div>
        </div>
        ${this.readonly?null:n$5` <div class="affine-database-block-footer">
              <div
                class="affine-database-block-add-row"
                data-test-id="affine-database-add-row-button"
                role="button"
                @click="${()=>y("end")}"
              >
                ${PlusIcon}<span>New Record</span>
              </div>
            </div>`}
      </div>
    `}focusFirstCell(){this.selection.focusFirstCell()}};DatabaseTable.styles=styles$c;__decorate$I([i$6(".affine-database-table-container")],DatabaseTable.prototype,"_tableContainer",void 0);__decorate$I([i$6("affine-database-column-header")],DatabaseTable.prototype,"_columnHeaderComponent",void 0);__decorate$I([i$6("affine-database-selection")],DatabaseTable.prototype,"selection",void 0);DatabaseTable=__decorate$I([e$7("affine-database-table")],DatabaseTable);viewRendererManager.register("table",{view:createUniComponentFromWebComponent(DatabaseTable),icon:createIcon("DatabaseTableViewIcon"),tools:[createUniComponentFromWebComponent(DataViewHeaderToolsFilter),createUniComponentFromWebComponent(DataViewHeaderToolsSearch),createUniComponentFromWebComponent(DataViewHeaderToolsViewOptions),createUniComponentFromWebComponent(DataViewHeaderToolsAddRow)]});const numberColumnTypeName="number",numberPureColumnConfig=columnManager.register(numberColumnTypeName,{name:"Number",type:()=>tNumber.create(),defaultData:()=>({decimal:0}),cellToString:k=>k?.toString()??"",cellFromString:k=>{const _=k?Number(k):NaN;return{value:isNaN(_)?null:_}},cellToJson:k=>k??null});numberPureColumnConfig.registerConvert(richTextColumnTypeName,(k,_)=>({column:{},cells:_.map(y=>new Text$1(y?.toString()).yText)}));const textColumnTypeName="text",textPureColumnConfig=columnManager.register(textColumnTypeName,{name:"Plain-Text",type:()=>tString.create(),defaultData:()=>({}),cellToString:k=>k??"",cellFromString:k=>({value:k}),cellToJson:k=>k??null});viewManager.register("kanban",{defaultName:"Kanban View",init(k,_,y){const w=k.columns.filter(R=>{const H=columnManager.getColumn(R.type).dataType(R.data);return!!groupByMatcher.match(H)&&R.type!=="title"}),$=R=>[selectPureColumnConfig.type,multiSelectPureColumnConfig.type].includes(R.type)?3:[numberPureColumnConfig.type,textPureColumnConfig.type].includes(R.type)?2:1,B=w.sort((R,H)=>$(H)-$(R))[0];if(!B)throw new Error("not implement yet");return{id:_,name:y,mode:"kanban",columns:k.columns.map(R=>({id:R.id,hide:!1})),filter:{type:"group",op:"and",conditions:[]},groupBy:defaultGroupBy(B.id,B.type,B.data),header:{titleColumn:k.columns.find(R=>R.type==="title")?.id,iconColumn:"type"},groupProperties:[]}}});const openDetail=(k,_)=>{const y=_.selection;_.selection=void 0,popSideDetail({view:_.view,rowId:k,onClose:()=>{_.selection=y}})},popCardMenu=(k,_,y)=>{popFilterableSimpleMenu(k,[{type:"action",name:"Expand card",icon:ExpandFullIcon,select:()=>{openDetail(_,y)}},{type:"sub-menu",name:"Move to",icon:ArrowRightBigIcon,options:{input:{search:!0},items:y.view.groupHelper?.groups.filter(w=>w.key!==y.selection?.groupKey).map(w=>({type:"action",name:w.value!=null?w.name:"Ungroup",select:()=>{y.moveCard(_,w.key)}}))??[]}},{type:"group",name:"",children:()=>[{type:"action",name:"Insert before",icon:x$1` <div
            style="transform: rotate(90deg);display:flex;align-items:center;"
          >
            ${MoveLeftIcon}
          </div>`,select:()=>{y.insertRowBefore()}},{type:"action",name:"Insert after",icon:x$1` <div
            style="transform: rotate(90deg);display:flex;align-items:center;"
          >
            ${MoveRightIcon}
          </div>`,select:()=>{y.insertRowAfter()}}]},{type:"group",name:"",children:()=>[{type:"action",name:"Delete card",class:"delete-item",icon:DeleteIcon,select:()=>{y.deleteCard()}}]}])};var __decorate$H=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$b=i$5`
  affine-data-view-kanban-card {
    display: flex;
    position: relative;
    flex-direction: column;
    border: 1px solid var(--affine-border-color);
    box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);
    border-radius: 8px;
    transition: background-color 100ms ease-in-out;
    background-color: var(--affine-background-kanban-card-color);
  }

  affine-data-view-kanban-card:hover {
    background-color: var(--affine-hover-color);
  }

  affine-data-view-kanban-card .card-header {
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .card-header.has-divider {
    border-bottom: 0.5px solid var(--affine-border-color);
  }

  affine-data-view-kanban-card .card-header-title {
    font-size: var(--data-view-cell-text-size);
    line-height: var(--data-view-cell-text-line-height);
  }

  affine-data-view-kanban-card .card-header-icon {
    padding: 4px;
    background-color: var(--affine-background-secondary-color);
    display: flex;
    align-items: center;
    border-radius: 4px;
    width: max-content;
  }

  affine-data-view-kanban-card .card-header-icon svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
  }

  affine-data-view-kanban-card .card-body {
    display: flex;
    flex-direction: column;
    padding: 8px;
    gap: 4px;
  }

  affine-data-view-kanban-card:hover .card-ops {
    visibility: visible;
  }

  .card-ops {
    position: absolute;
    right: 8px;
    top: 8px;
    visibility: hidden;
    display: flex;
    gap: 4px;
    cursor: pointer;
  }

  .card-op {
    display: flex;
    position: relative;
    padding: 4px;
    border-radius: 4px;
    box-shadow: 0px 0px 4px 0px rgba(66, 65, 73, 0.14);
    background-color: var(--affine-background-primary-color);
  }

  .card-op:hover:before {
    content: '';
    border-radius: 4px;
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: var(--affine-hover-color);
  }

  .card-op svg {
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
    width: 16px;
    height: 16px;
  }
`;let KanbanCard=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.isFocus=!1,this.clickEdit=_=>{_.stopPropagation();const y=this.getSelection();y&&openDetail(this.cardId,y)},this.clickMore=_=>{_.stopPropagation();const y=this.getSelection(),w=_.currentTarget;y&&(y.selection={groupKey:this.groupKey,cardId:this.cardId},popCardMenu(w,this.cardId,y))},this.contextMenu=_=>{_.stopPropagation(),_.preventDefault();const y=this.getSelection();y&&(y.selection={groupKey:this.groupKey,cardId:this.cardId},popCardMenu(positionToVRect(_.x,_.y),this.cardId,y))}}connectedCallback(){super.connectedCallback(),this._disposables.add(this.view.slots.update.on(()=>{this.requestUpdate()})),!this.view.readonly&&(this._disposables.addFromEvent(this,"contextmenu",_=>{this.contextMenu(_)}),this._disposables.addFromEvent(this,"click",()=>{const _=this.getSelection(),y=_?.selection;_&&(_.selection=void 0),popSideDetail({view:this.view,rowId:this.cardId,onClose:()=>{_&&(_.selection=y)}})}))}renderTitle(){const _=this.view.getHeaderTitle(this.cardId);if(_)return n$5` <div class="card-header-title">
      <affine-data-view-kanban-cell
        .contentOnly="${!0}"
        data-column-id="${_.id}"
        .view="${this.view}"
        .groupKey="${this.groupKey}"
        .column="${_}"
        .cardId="${this.cardId}"
      ></affine-data-view-kanban-cell>
    </div>`}renderIcon(){const _=this.view.getHeaderIcon(this.cardId);if(_)return n$5` <div class="card-header-icon">
      ${_.getValue(this.cardId)}
    </div>`}renderHeader(_){if(!this.view.hasHeader(this.cardId))return"";const y=o$3({"card-header":!0,"has-divider":_.length>0});return n$5`
      <div class="${y}">${this.renderTitle()} ${this.renderIcon()}</div>
    `}renderBody(_){return _.length===0?"":n$5` <div class="card-body">
      ${c$1(_,y=>y.id,y=>this.view.isInHeader(y.id)?"":n$5` <affine-data-view-kanban-cell
            .contentOnly="${!1}"
            data-column-id="${y.id}"
            .view="${this.view}"
            .groupKey="${this.groupKey}"
            .column="${y}"
            .cardId="${this.cardId}"
          ></affine-data-view-kanban-cell>`)}
    </div>`}render(){const _=this.view.columnManagerList.filter(y=>!this.view.isInHeader(y.id));return this.style.border=this.isFocus?"1px solid var(--affine-primary-color)":"",n$5`
      ${this.renderHeader(_)} ${this.renderBody(_)}
      ${this.renderOps()}
    `}renderOps(){if(!this.view.readonly)return n$5`
      <div class="card-ops">
        <div class="card-op" @click="${this.clickEdit}">${NewEditIcon}</div>
        <div class="card-op" @click="${this.clickMore}">
          ${MoreHorizontalIcon}
        </div>
      </div>
    `}getSelection(){return this.closest("affine-data-view-kanban")?.selection}};KanbanCard.styles=styles$b;__decorate$H([n$a({attribute:!1})],KanbanCard.prototype,"view",void 0);__decorate$H([n$a({attribute:!1})],KanbanCard.prototype,"groupKey",void 0);__decorate$H([n$a({attribute:!1})],KanbanCard.prototype,"cardId",void 0);__decorate$H([t$2()],KanbanCard.prototype,"isFocus",void 0);KanbanCard=__decorate$H([e$7("affine-data-view-kanban-card")],KanbanCard);var __decorate$G=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$a=i$5`
  affine-data-view-kanban-group {
    width: 260px;
    flex-shrink: 0;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
  }

  .group-header {
    height: 32px;
    padding: 6px 4px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .group-header-title {
    overflow: hidden;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: var(--data-view-cell-text-size);
  }
  .group-header-name {
    flex: 1;
    overflow: hidden;
  }

  .group-header-icon {
    display: flex;
    align-items: center;
    margin-right: -4px;
  }

  .group-header-icon svg {
    width: 16px;
    height: 16px;
    color: var(--affine-icon-color);
    fill: var(--affine-icon-color);
  }

  .group-header-count {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    border-radius: 4px;
    background-color: var(--affine-background-secondary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--affine-text-secondary-color);
  }

  .group-header-ops {
    display: flex;
    align-items: center;
  }

  .group-header-op {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    visibility: hidden;
    transition: visibility 100ms ease-in-out;
  }

  affine-data-view-kanban-group:hover .group-header-op {
    visibility: visible;
  }

  .group-header-op:hover {
    background-color: var(--affine-hover-color);
  }

  .group-header-op svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
  }

  .group-body {
    margin-top: 4px;
    display: flex;
    flex-direction: column;
    padding: 0 4px;
    gap: 12px;
  }

  .add-card {
    display: flex;
    align-items: center;
    height: 28px;
    padding: 4px;
    border-radius: 4px;
    cursor: pointer;
    font-size: var(--data-view-cell-text-size);
    line-height: var(--data-view-cell-text-line-height);
    visibility: hidden;
    transition: visibility 100ms ease-in-out;
  }

  affine-data-view-kanban-group:hover .add-card {
    visibility: visible;
  }

  .add-card:hover {
    background-color: var(--affine-hover-color);
  }

  .sortable-ghost {
    background-color: var(--affine-hover-color);
    opacity: 0.5;
  }

  .sortable-drag {
    background-color: var(--affine-background-primary-color);
  }
`;let KanbanGroup=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.clickAddCard=()=>{const _=this.view.addCard("end",this.group.key);requestAnimationFrame(()=>{const y=this.closest("affine-data-view-kanban");y&&(y.selection.selection={groupKey:this.group.key,cardId:_,focus:{columnId:this.view.header.titleColumn||this.view.columns[0],isEditing:!0}})})},this.clickAddCardInStart=()=>{const _=this.view.addCard("start",this.group.key);requestAnimationFrame(()=>{const y=this.closest("affine-data-view-kanban");y&&(y.selection.selection={groupKey:this.group.key,cardId:_,focus:{columnId:this.view.header.titleColumn||this.view.columns[0],isEditing:!0}})})},this.clickGroupOptions=_=>{const y=_.currentTarget;popFilterableSimpleMenu(y,[{type:"action",name:"Ungroup",hide:()=>this.group.value==null,select:()=>{this.group.rows.forEach(w=>{this.group.helper.removeFromGroup(w,this.group.key)})}},{type:"action",name:"Delete Cards",select:()=>{this.view.rowDelete(this.group.rows)}}])},this.renderTitle=()=>{const _=this.group.helper.groupConfig();if(!_)return;const y={value:this.group.value,data:this.group.helper.data,updateData:this.group.helper.updateData,updateValue:w=>this.group.helper.updateValue(this.group.rows,w),readonly:this.view.readonly};return renderUniLit(_.view,y)}}renderCount(){const _=this.group.rows;if(_.length)return n$5` <div class="group-header-count">${_.length}</div>`}render(){const _=this.group.rows,y=this.group.value==null?"":n$5` <uni-lit
            class="group-header-icon"
            .uni="${this.group.helper.column.icon}"
          ></uni-lit>`;return n$5`
      <div class="group-header">
        <div class="group-header-title">
          ${y}
          <div class="group-header-name">${this.renderTitle()}</div>
          ${this.renderCount()}
        </div>
        ${this.view.readonly?A:n$5`<div class="group-header-ops">
              <div @click="${this.clickAddCardInStart}" class="group-header-op">
                ${PlusIcon}
              </div>
              <div @click="${this.clickGroupOptions}" class="group-header-op">
                ${MoreHorizontalIcon}
              </div>
            </div>`}
      </div>
      <div class="group-body">
        ${c$1(_,w=>w,w=>n$5`
              <affine-data-view-kanban-card
                data-card-id="${w}"
                .groupKey="${this.group.key}"
                .view="${this.view}"
                .cardId="${w}"
              ></affine-data-view-kanban-card>
            `)}
        ${this.view.readonly?A:n$5`<div class="add-card" @click="${this.clickAddCard}">
              <div
                style="margin-right: 4px;width: 16px;height: 16px;display:flex;align-items:center;"
              >
                ${AddCursorIcon}
              </div>
              Add
            </div>`}
      </div>
    `}};KanbanGroup.styles=styles$a;__decorate$G([n$a({attribute:!1})],KanbanGroup.prototype,"view",void 0);__decorate$G([n$a({attribute:!1})],KanbanGroup.prototype,"group",void 0);KanbanGroup=__decorate$G([e$7("affine-data-view-kanban-group")],KanbanGroup);var __decorate$F=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$9=i$5`
  affine-data-view-kanban-header {
    display: flex;
    justify-content: space-between;
    padding: 4px;
  }

  .select-group {
    border-radius: 8px;
    padding: 4px 8px;
    cursor: pointer;
  }

  .select-group:hover {
    background-color: var(--affine-hover-color);
  }
`;let KanbanHeader=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.clickGroup=_=>{popMenu(_.target,{options:{input:{search:!0},items:this.view.columnManagerList.filter(y=>y.id!==this.view.view.groupBy?.columnId).map(y=>({type:"action",name:y.name,select:()=>{this.view.changeGroup(y.id)}}))}})}}render(){return n$5`
      <div></div>
      <div>
        <div class="select-group" @click="${this.clickGroup}">Group</div>
      </div>
    `}};KanbanHeader.styles=styles$9;__decorate$F([n$a({attribute:!1})],KanbanHeader.prototype,"view",void 0);KanbanHeader=__decorate$F([e$7("affine-data-view-kanban-header")],KanbanHeader);var __decorate$E=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$8=i$5`
  affine-data-view-kanban-drag {
    background-color: var(--affine-background-primary-color);
  }
`;let KanbanDrag=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.dragStart=(_,y)=>{const w=_.getBoundingClientRect(),$=y.x-w.left,B=y.y-w.top,R=createDragPreview(_,y.x-$,y.y-B),H=createDropPreview(),j=_.closest("affine-data-view-kanban-group");startDrag(y,{onDrag:()=>({}),onMove:q=>{R.display(q.x-$,q.y-B);const ee=document.elementsFromPoint(q.x,q.y).find(te=>te instanceof KanbanGroup);if(ee){const te=getCardByPoint(ee,q.y);return H.display(ee,_,te),{drop:{key:ee.group.key,position:te?{before:!0,id:te.cardId}:"end"}}}return H.remove(),{}},onClear:()=>{R.remove(),H.remove()},onDrop:({drop:q})=>{R.remove(),H.remove(),q&&j&&j.group.helper.moveCardTo(_.cardId,j.group.key,q.key,q.position)}})}}connectedCallback(){super.connectedCallback(),!this.kanbanView.view.readonly&&this._disposables.add(this.kanbanView.handleEvent("dragStart",_=>{const y=_.get("pointerState").raw,w=y.target;if(w instanceof Element){const $=w.closest("affine-data-view-kanban-card");$&&this.dragStart($,y)}return!0}))}render(){return n$5` <div class="drag-preview"></div> `}};KanbanDrag.styles=styles$8;__decorate$E([n$a({attribute:!1})],KanbanDrag.prototype,"kanbanView",void 0);__decorate$E([i$6(".drag-preview")],KanbanDrag.prototype,"dragPreview",void 0);KanbanDrag=__decorate$E([e$7("affine-data-view-kanban-drag")],KanbanDrag);const createDragPreview=(k,_,y)=>{const w=k.style.opacity;k.style.opacity="0.5";const $=document.createElement("div"),B=new KanbanCard;return B.cardId=k.cardId,B.view=k.view,B.isFocus=!0,B.style.backgroundColor="var(--affine-background-primary-color)",$.append(B),$.style.width=`${k.getBoundingClientRect().width}px`,$.style.position="fixed",$.style.transform="rotate(-3deg)",$.style.left=`${_}px`,$.style.top=`${y}px`,$.style.zIndex="999",document.body.append($),{display(R,H){$.style.left=`${Math.round(R)}px`,$.style.top=`${Math.round(H)}px`},remove(){k.style.opacity=w,$.remove()}}},createDropPreview=()=>{const k=document.createElement("div");return k.style.height="4px",k.style.borderRadius="2px",k.style.backgroundColor="var(--affine-primary-color)",k.style.boxShadow="0px 0px 8px 0px rgba(30, 150, 235, 0.35)",{display(_,y,w){const $=w??_.querySelector(".add-card");if(assertExists($),$.previousElementSibling===y||$===y){k.remove();return}$.previousElementSibling!==k&&$.insertAdjacentElement("beforebegin",k)},remove(){k.remove()}}},getCardByPoint=(k,_)=>{const y=Array.from(k.querySelectorAll("affine-data-view-kanban-card")),$=y.map(B=>{const R=B.getBoundingClientRect();return(R.top+R.bottom)/2}).findIndex(B=>B>_);return y[$]};class KanbanHotkeys{constructor(_){this.viewEle=_}run(){return this.viewEle.bindHotkey({Escape:()=>{this.viewEle.selection.focusOut()},Enter:()=>{this.viewEle.selection.focusIn()},ArrowUp:()=>{this.viewEle.selection.focusUp()},ArrowDown:()=>{this.viewEle.selection.focusDown()},ArrowLeft:()=>{this.viewEle.selection.focusLeft()},ArrowRight:()=>{this.viewEle.selection.focusRight()},Backspace:()=>{this.viewEle.selection.deleteCard()}})}}class KanbanSelection{get view(){return this.viewEle.view}constructor(_){this.viewEle=_}run(){return this.viewEle.selectionUpdated.on(_=>{const y=this._selection;y&&this.blur(y),this._selection=_,_&&this.focus(_)})}get selection(){return this._selection}set selection(_){if(!_){this.viewEle.setSelection();return}const y={..._,viewId:this.viewEle.view.id,type:"kanban"};if(y.focus&&y.focus.isEditing){const w=y.focus,B=this.getFocusCellContainer(y)?.cell,R=B&&B.beforeEnterEditMode()?y.focus.isEditing:!1;this.viewEle.setSelection({...y,focus:{...w,isEditing:R}})}else this.viewEle.setSelection(y)}blur(_){if(!_.focus){const $=this.getSelectCard(_);$&&($.isFocus=!1);return}const y=this.getFocusCellContainer(_);if(!y)return;y.isFocus=!1;const w=y?.cell;_.focus.isEditing?(w?.onExitEditMode(),w?.blurCell()&&y.blur(),y.editing=!1):y.blur()}focus(_){if(!_.focus){const $=this.getSelectCard(_);$&&($.scrollIntoView({block:"nearest",inline:"nearest"}),$.isFocus=!0);return}const y=this.getFocusCellContainer(_);if(!y)return;y.scrollIntoView({block:"nearest",inline:"nearest"}),y.isFocus=!0;const w=y?.cell;_.focus.isEditing?(w?.onEnterEditMode(),w?.focusCell()&&y.focus(),y.editing=!0):y.focus()}getSelectCard(_){return this.viewEle.querySelector(`affine-data-view-kanban-group[data-key="${_.groupKey}"]`)?.querySelector(`affine-data-view-kanban-card[data-card-id="${_.cardId}"]`)}getFocusCellContainerByCard(_,y){return _.querySelector(`affine-data-view-kanban-cell[data-column-id="${y.columnId}"]`)}getFocusCellContainer(_){if(!_.focus)return;const y=this.getSelectCard(_);if(y)return this.getFocusCellContainerByCard(y,_.focus)}focusOut(){const _=this.selection;_&&_.focus&&(_.focus.isEditing?this.selection={..._,focus:{..._.focus,isEditing:!1}}:this.selection={..._,focus:void 0})}focusIn(){const _=this.selection;if(!(!_||_.focus?.isEditing))if(_.focus)this.selection={..._,focus:{..._.focus,isEditing:!0}};else{const w=this.getSelectCard(_)?.querySelector("affine-data-view-kanban-cell");w&&(this.selection={..._,focus:{columnId:w.column.id,isEditing:!1}})}}focusUp(){const _=this.selection;if(!(!_||_.focus?.isEditing)&&_.focus){const y=this.getFocusCellContainer(_)?.previousElementSibling;y instanceof KanbanCell&&(this.selection={..._,focus:{..._.focus,columnId:y.column.id}})}}focusDown(){const _=this.selection;if(!(!_||_.focus?.isEditing)&&_.focus){const y=this.getFocusCellContainer(_)?.nextElementSibling;y instanceof KanbanCell&&(this.selection={..._,focus:{..._.focus,columnId:y.column.id}})}}focusLeft(){}focusRight(){}deleteCard(){const _=this.selection;!_||_.focus||(this.viewEle.view.rowDelete([_.cardId]),this.selection=void 0)}focusFirstCell(){const _=this.viewEle.groupHelper?.groups[0],y=_?.rows[0],w=y&&this.viewEle.view.getHeaderTitle(y)?.id;_&&y&&w&&(this.selection={groupKey:_.key,cardId:y,focus:{columnId:w,isEditing:!0}})}insertRowBefore(){const _=this.selection;if(!_)return;const y=this.view.addCard({before:!0,id:_.cardId},_.groupKey);requestAnimationFrame(()=>{const w=this.view.header.titleColumn;this.selection={groupKey:_.groupKey,cardId:y,focus:w?{columnId:w,isEditing:!0}:void 0}})}insertRowAfter(){const _=this.selection;if(!_)return;const y=this.view.addCard({before:!1,id:_.cardId},_.groupKey);requestAnimationFrame(()=>{const w=this.view.header.titleColumn;this.selection={groupKey:_.groupKey,cardId:y,focus:w?{columnId:w,isEditing:!0}:void 0}})}moveCard(_,y){const w=this.selection;w&&(this.view.groupHelper?.moveCardTo(_,w.groupKey,y,"start"),requestAnimationFrame(()=>{this.selection={...w,groupKey:y}}))}}var __decorate$D=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$7=i$5`
  affine-data-view-kanban {
    user-select: none;
  }

  .affine-data-view-kanban-groups {
    display: flex;
    gap: 20px;
    overflow-x: auto;
  }

  .add-group-icon {
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .add-group-icon:hover {
    background-color: var(--affine-hover-color);
  }

  .add-group-icon svg {
    width: 16px;
    height: 16px;
    fill: var(--affine-icon-color);
    color: var(--affine-icon-color);
  }
`;let DataViewKanban=class extends BaseDataView{constructor(){super(...arguments),this.selection=new KanbanSelection(this),this.hotkeys=new KanbanHotkeys(this),this.renderAddGroup=()=>{const _=this.groupHelper?.addGroup;return _?n$5` <div
      style="height: 32px;width: 100px;flex-shrink:0;display:flex;align-items:center;"
      @click="${w=>{const $=w.currentTarget;popMenu($,{options:{input:{onComplete:B=>{const R=this.groupHelper?.column;R&&R.updateData(()=>_(B,R.data))}},items:[]}})}}"
    >
      <div class="add-group-icon">${AddCursorIcon}</div>
    </div>`:void 0}}connectedCallback(){super.connectedCallback(),this._disposables.add(this.view.slots.update.on(()=>{this.requestUpdate()})),this._disposables.add(this.selection.run()),this._disposables.add(this.hotkeys.run())}firstUpdated(){const _=Sortable.create(this.groups,{group:`kanban-group-drag-${this.view.id}`,handle:".group-header",draggable:"affine-data-view-kanban-group",animation:100,onEnd:y=>{if(y.item instanceof KanbanGroup){const w=Array.from(this.groups.querySelectorAll("affine-data-view-kanban-group")),$=y.newIndex!=null?w[y.newIndex-1]?.group.key:void 0;this.groupHelper?.moveGroupTo(y.item.group.key,$?{before:!1,id:$}:"start")}}});this._disposables.add({dispose:()=>{_.destroy()}})}render(){this.groupHelper=this.view.groupHelper;const _=this.groupHelper?.groups;return _?n$5`
      <div class="affine-data-view-kanban-groups">
        ${c$1(_,y=>y.key,y=>n$5` <affine-data-view-kanban-group
              data-key="${y.key}"
              .view="${this.view}"
              .group="${y}"
            ></affine-data-view-kanban-group>`)}
        ${this.renderAddGroup()}
      </div>
      <affine-data-view-kanban-drag
        .kanbanView="${this}"
      ></affine-data-view-kanban-drag>
    `:n$5``}focusFirstCell(){this.selection.focusFirstCell()}getSelection(){return this.selection.selection}};DataViewKanban.styles=styles$7;__decorate$D([i$6(".affine-data-view-kanban-groups")],DataViewKanban.prototype,"groups",void 0);DataViewKanban=__decorate$D([e$7("affine-data-view-kanban")],DataViewKanban);viewRendererManager.register("kanban",{icon:createIcon("DatabaseKanbanViewIcon"),view:createUniComponentFromWebComponent(DataViewKanban),tools:[createUniComponentFromWebComponent(DataViewHeaderToolsFilter),createUniComponentFromWebComponent(DataViewHeaderToolsSearch),createUniComponentFromWebComponent(DataViewHeaderToolsViewOptions)]});/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const i=e$8(class extends i$8{constructor(){super(...arguments),this.key=A}render(k,_){return this.key=k,_}update(k,[_,y]){return _!==this.key&&(a$2(k),this.key=_),y}}),checkboxPureColumnConfig=columnManager.register("checkbox",{name:"Checkbox",type:()=>tBoolean.create(),defaultData:()=>({}),cellToString:k=>k?"True":"False",cellFromString:k=>({value:k!=="False"}),cellToJson:k=>k??null});var __decorate$C=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let CheckboxCell=class extends BaseCellRenderer{beforeEnterEditMode(){const _=!this.value;return this.onChange(_),_&&playCheckAnimation(this._checkbox,{left:-2}),!1}render(){const _=this.value??!1,y=_?checkboxChecked():checkboxUnchecked();return x$1` <div class="affine-database-checkbox-container">
      <div class="affine-database-checkbox checkbox ${_&&"checked"}">
        ${y}
      </div>
    </div>`}};CheckboxCell.styles=i$5`
    affine-database-checkbox-cell {
      display: block;
      width: 100%;
      cursor: pointer;
    }

    .affine-database-checkbox-container {
      height: 100%;
    }

    .affine-database-checkbox {
      display: flex;
      align-items: center;
      height: var(--data-view-cell-text-line-height);
      width: 100%;
      position: relative;
    }
    .affine-database-checkbox svg {
      width: 16px;
      height: 16px;
    }
  `;__decorate$C([i$6(".affine-database-checkbox")],CheckboxCell.prototype,"_checkbox",void 0);CheckboxCell=__decorate$C([e$7("affine-database-checkbox-cell")],CheckboxCell);columnRenderer.register({type:checkboxPureColumnConfig.type,icon:createIcon("CheckBoxIcon"),cellRenderer:{view:createFromBaseCellRenderer(CheckboxCell)}});const checkboxColumnConfig=checkboxPureColumnConfig;var format$1={exports:{}},interopRequireDefault={exports:{}};(function(k){function _(y){return y&&y.__esModule?y:{default:y}}k.exports=_,k.exports.__esModule=!0,k.exports.default=k.exports})(interopRequireDefault);var interopRequireDefaultExports=interopRequireDefault.exports,isValid={exports:{}},isDate={exports:{}},requiredArgs={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w,$){if($.length<w)throw new TypeError(w+" argument"+(w>1?"s":"")+" required, but only "+$.length+" present")}k.exports=_.default})(requiredArgs,requiredArgs.exports);var requiredArgsExports=requiredArgs.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=B;var w=y(_typeofExports),$=y(requiredArgsExports);function B(R){return(0,$.default)(1,arguments),R instanceof Date||(0,w.default)(R)==="object"&&Object.prototype.toString.call(R)==="[object Date]"}k.exports=_.default})(isDate,isDate.exports);var isDateExports=isDate.exports,toDate={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=B;var w=y(_typeofExports),$=y(requiredArgsExports);function B(R){(0,$.default)(1,arguments);var H=Object.prototype.toString.call(R);return R instanceof Date||(0,w.default)(R)==="object"&&H==="[object Date]"?new Date(R.getTime()):typeof R=="number"||H==="[object Number]"?new Date(R):((typeof R=="string"||H==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}k.exports=_.default})(toDate,toDate.exports);var toDateExports=toDate.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(isDateExports),$=y(toDateExports),B=y(requiredArgsExports);function R(H){if((0,B.default)(1,arguments),!(0,w.default)(H)&&typeof H!="number")return!1;var j=(0,$.default)(H);return!isNaN(Number(j))}k.exports=_.default})(isValid,isValid.exports);var isValidExports=isValid.exports,subMilliseconds={exports:{}},addMilliseconds={exports:{}},toInteger={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w){if(w===null||w===!0||w===!1)return NaN;var $=Number(w);return isNaN($)?$:$<0?Math.ceil($):Math.floor($)}k.exports=_.default})(toInteger,toInteger.exports);var toIntegerExports=toInteger.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(toIntegerExports),$=y(toDateExports),B=y(requiredArgsExports);function R(H,j){(0,B.default)(2,arguments);var q=(0,$.default)(H).getTime(),X=(0,w.default)(j);return new Date(q+X)}k.exports=_.default})(addMilliseconds,addMilliseconds.exports);var addMillisecondsExports=addMilliseconds.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(addMillisecondsExports),$=y(requiredArgsExports),B=y(toIntegerExports);function R(H,j){(0,$.default)(2,arguments);var q=(0,B.default)(j);return(0,w.default)(H,-q)}k.exports=_.default})(subMilliseconds,subMilliseconds.exports);var subMillisecondsExports=subMilliseconds.exports,formatters={exports:{}},getUTCDayOfYear={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(toDateExports),$=y(requiredArgsExports),B=864e5;function R(H){(0,$.default)(1,arguments);var j=(0,w.default)(H),q=j.getTime();j.setUTCMonth(0,1),j.setUTCHours(0,0,0,0);var X=j.getTime(),ee=q-X;return Math.floor(ee/B)+1}k.exports=_.default})(getUTCDayOfYear,getUTCDayOfYear.exports);var getUTCDayOfYearExports=getUTCDayOfYear.exports,getUTCISOWeek={exports:{}},startOfUTCISOWeek={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=B;var w=y(toDateExports),$=y(requiredArgsExports);function B(R){(0,$.default)(1,arguments);var H=1,j=(0,w.default)(R),q=j.getUTCDay(),X=(q<H?7:0)+q-H;return j.setUTCDate(j.getUTCDate()-X),j.setUTCHours(0,0,0,0),j}k.exports=_.default})(startOfUTCISOWeek,startOfUTCISOWeek.exports);var startOfUTCISOWeekExports=startOfUTCISOWeek.exports,startOfUTCISOWeekYear={exports:{}},getUTCISOWeekYear={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(toDateExports),$=y(requiredArgsExports),B=y(startOfUTCISOWeekExports);function R(H){(0,$.default)(1,arguments);var j=(0,w.default)(H),q=j.getUTCFullYear(),X=new Date(0);X.setUTCFullYear(q+1,0,4),X.setUTCHours(0,0,0,0);var ee=(0,B.default)(X),te=new Date(0);te.setUTCFullYear(q,0,4),te.setUTCHours(0,0,0,0);var ne=(0,B.default)(te);return j.getTime()>=ee.getTime()?q+1:j.getTime()>=ne.getTime()?q:q-1}k.exports=_.default})(getUTCISOWeekYear,getUTCISOWeekYear.exports);var getUTCISOWeekYearExports=getUTCISOWeekYear.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=R;var w=y(getUTCISOWeekYearExports),$=y(startOfUTCISOWeekExports),B=y(requiredArgsExports);function R(H){(0,B.default)(1,arguments);var j=(0,w.default)(H),q=new Date(0);q.setUTCFullYear(j,0,4),q.setUTCHours(0,0,0,0);var X=(0,$.default)(q);return X}k.exports=_.default})(startOfUTCISOWeekYear,startOfUTCISOWeekYear.exports);var startOfUTCISOWeekYearExports=startOfUTCISOWeekYear.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=j;var w=y(toDateExports),$=y(startOfUTCISOWeekExports),B=y(startOfUTCISOWeekYearExports),R=y(requiredArgsExports),H=6048e5;function j(q){(0,R.default)(1,arguments);var X=(0,w.default)(q),ee=(0,$.default)(X).getTime()-(0,B.default)(X).getTime();return Math.round(ee/H)+1}k.exports=_.default})(getUTCISOWeek,getUTCISOWeek.exports);var getUTCISOWeekExports=getUTCISOWeek.exports,getUTCWeek={exports:{}},startOfUTCWeek={exports:{}},defaultOptions$1={};Object.defineProperty(defaultOptions$1,"__esModule",{value:!0});defaultOptions$1.getDefaultOptions=getDefaultOptions;defaultOptions$1.setDefaultOptions=setDefaultOptions;var defaultOptions={};function getDefaultOptions(){return defaultOptions}function setDefaultOptions(k){defaultOptions=k}(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=H;var w=y(toDateExports),$=y(requiredArgsExports),B=y(toIntegerExports),R=defaultOptions$1;function H(j,q){var X,ee,te,ne,oe,ie,ae,re;(0,$.default)(1,arguments);var se=(0,R.getDefaultOptions)(),le=(0,B.default)((X=(ee=(te=(ne=q?.weekStartsOn)!==null&&ne!==void 0?ne:q==null||(oe=q.locale)===null||oe===void 0||(ie=oe.options)===null||ie===void 0?void 0:ie.weekStartsOn)!==null&&te!==void 0?te:se.weekStartsOn)!==null&&ee!==void 0?ee:(ae=se.locale)===null||ae===void 0||(re=ae.options)===null||re===void 0?void 0:re.weekStartsOn)!==null&&X!==void 0?X:0);if(!(le>=0&&le<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var ue=(0,w.default)(j),he=ue.getUTCDay(),ce=(he<le?7:0)+he-le;return ue.setUTCDate(ue.getUTCDate()-ce),ue.setUTCHours(0,0,0,0),ue}k.exports=_.default})(startOfUTCWeek,startOfUTCWeek.exports);var startOfUTCWeekExports=startOfUTCWeek.exports,startOfUTCWeekYear={exports:{}},getUTCWeekYear={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=j;var w=y(toDateExports),$=y(requiredArgsExports),B=y(startOfUTCWeekExports),R=y(toIntegerExports),H=defaultOptions$1;function j(q,X){var ee,te,ne,oe,ie,ae,re,se;(0,$.default)(1,arguments);var le=(0,w.default)(q),ue=le.getUTCFullYear(),he=(0,H.getDefaultOptions)(),ce=(0,R.default)((ee=(te=(ne=(oe=X?.firstWeekContainsDate)!==null&&oe!==void 0?oe:X==null||(ie=X.locale)===null||ie===void 0||(ae=ie.options)===null||ae===void 0?void 0:ae.firstWeekContainsDate)!==null&&ne!==void 0?ne:he.firstWeekContainsDate)!==null&&te!==void 0?te:(re=he.locale)===null||re===void 0||(se=re.options)===null||se===void 0?void 0:se.firstWeekContainsDate)!==null&&ee!==void 0?ee:1);if(!(ce>=1&&ce<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var ge=new Date(0);ge.setUTCFullYear(ue+1,0,ce),ge.setUTCHours(0,0,0,0);var be=(0,B.default)(ge,X),fe=new Date(0);fe.setUTCFullYear(ue,0,ce),fe.setUTCHours(0,0,0,0);var we=(0,B.default)(fe,X);return le.getTime()>=be.getTime()?ue+1:le.getTime()>=we.getTime()?ue:ue-1}k.exports=_.default})(getUTCWeekYear,getUTCWeekYear.exports);var getUTCWeekYearExports=getUTCWeekYear.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=j;var w=y(getUTCWeekYearExports),$=y(requiredArgsExports),B=y(startOfUTCWeekExports),R=y(toIntegerExports),H=defaultOptions$1;function j(q,X){var ee,te,ne,oe,ie,ae,re,se;(0,$.default)(1,arguments);var le=(0,H.getDefaultOptions)(),ue=(0,R.default)((ee=(te=(ne=(oe=X?.firstWeekContainsDate)!==null&&oe!==void 0?oe:X==null||(ie=X.locale)===null||ie===void 0||(ae=ie.options)===null||ae===void 0?void 0:ae.firstWeekContainsDate)!==null&&ne!==void 0?ne:le.firstWeekContainsDate)!==null&&te!==void 0?te:(re=le.locale)===null||re===void 0||(se=re.options)===null||se===void 0?void 0:se.firstWeekContainsDate)!==null&&ee!==void 0?ee:1),he=(0,w.default)(q,X),ce=new Date(0);ce.setUTCFullYear(he,0,ue),ce.setUTCHours(0,0,0,0);var ge=(0,B.default)(ce,X);return ge}k.exports=_.default})(startOfUTCWeekYear,startOfUTCWeekYear.exports);var startOfUTCWeekYearExports=startOfUTCWeekYear.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=j;var w=y(toDateExports),$=y(startOfUTCWeekExports),B=y(startOfUTCWeekYearExports),R=y(requiredArgsExports),H=6048e5;function j(q,X){(0,R.default)(1,arguments);var ee=(0,w.default)(q),te=(0,$.default)(ee,X).getTime()-(0,B.default)(ee,X).getTime();return Math.round(te/H)+1}k.exports=_.default})(getUTCWeek,getUTCWeek.exports);var getUTCWeekExports=getUTCWeek.exports,addLeadingZeros={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w,$){for(var B=w<0?"-":"",R=Math.abs(w).toString();R.length<$;)R="0"+R;return B+R}k.exports=_.default})(addLeadingZeros,addLeadingZeros.exports);var addLeadingZerosExports=addLeadingZeros.exports,lightFormatters={exports:{}};(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(addLeadingZerosExports),$={y:function(H,j){var q=H.getUTCFullYear(),X=q>0?q:1-q;return(0,w.default)(j==="yy"?X%100:X,j.length)},M:function(H,j){var q=H.getUTCMonth();return j==="M"?String(q+1):(0,w.default)(q+1,2)},d:function(H,j){return(0,w.default)(H.getUTCDate(),j.length)},a:function(H,j){var q=H.getUTCHours()/12>=1?"pm":"am";switch(j){case"a":case"aa":return q.toUpperCase();case"aaa":return q;case"aaaaa":return q[0];case"aaaa":default:return q==="am"?"a.m.":"p.m."}},h:function(H,j){return(0,w.default)(H.getUTCHours()%12||12,j.length)},H:function(H,j){return(0,w.default)(H.getUTCHours(),j.length)},m:function(H,j){return(0,w.default)(H.getUTCMinutes(),j.length)},s:function(H,j){return(0,w.default)(H.getUTCSeconds(),j.length)},S:function(H,j){var q=j.length,X=H.getUTCMilliseconds(),ee=Math.floor(X*Math.pow(10,q-3));return(0,w.default)(ee,j.length)}},B=$;_.default=B,k.exports=_.default})(lightFormatters,lightFormatters.exports);var lightFormattersExports=lightFormatters.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(getUTCDayOfYearExports),$=y(getUTCISOWeekExports),B=y(getUTCISOWeekYearExports),R=y(getUTCWeekExports),H=y(getUTCWeekYearExports),j=y(addLeadingZerosExports),q=y(lightFormattersExports),X={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ee={G:function(re,se,le){var ue=re.getUTCFullYear()>0?1:0;switch(se){case"G":case"GG":case"GGG":return le.era(ue,{width:"abbreviated"});case"GGGGG":return le.era(ue,{width:"narrow"});case"GGGG":default:return le.era(ue,{width:"wide"})}},y:function(re,se,le){if(se==="yo"){var ue=re.getUTCFullYear(),he=ue>0?ue:1-ue;return le.ordinalNumber(he,{unit:"year"})}return q.default.y(re,se)},Y:function(re,se,le,ue){var he=(0,H.default)(re,ue),ce=he>0?he:1-he;if(se==="YY"){var ge=ce%100;return(0,j.default)(ge,2)}return se==="Yo"?le.ordinalNumber(ce,{unit:"year"}):(0,j.default)(ce,se.length)},R:function(re,se){var le=(0,B.default)(re);return(0,j.default)(le,se.length)},u:function(re,se){var le=re.getUTCFullYear();return(0,j.default)(le,se.length)},Q:function(re,se,le){var ue=Math.ceil((re.getUTCMonth()+1)/3);switch(se){case"Q":return String(ue);case"QQ":return(0,j.default)(ue,2);case"Qo":return le.ordinalNumber(ue,{unit:"quarter"});case"QQQ":return le.quarter(ue,{width:"abbreviated",context:"formatting"});case"QQQQQ":return le.quarter(ue,{width:"narrow",context:"formatting"});case"QQQQ":default:return le.quarter(ue,{width:"wide",context:"formatting"})}},q:function(re,se,le){var ue=Math.ceil((re.getUTCMonth()+1)/3);switch(se){case"q":return String(ue);case"qq":return(0,j.default)(ue,2);case"qo":return le.ordinalNumber(ue,{unit:"quarter"});case"qqq":return le.quarter(ue,{width:"abbreviated",context:"standalone"});case"qqqqq":return le.quarter(ue,{width:"narrow",context:"standalone"});case"qqqq":default:return le.quarter(ue,{width:"wide",context:"standalone"})}},M:function(re,se,le){var ue=re.getUTCMonth();switch(se){case"M":case"MM":return q.default.M(re,se);case"Mo":return le.ordinalNumber(ue+1,{unit:"month"});case"MMM":return le.month(ue,{width:"abbreviated",context:"formatting"});case"MMMMM":return le.month(ue,{width:"narrow",context:"formatting"});case"MMMM":default:return le.month(ue,{width:"wide",context:"formatting"})}},L:function(re,se,le){var ue=re.getUTCMonth();switch(se){case"L":return String(ue+1);case"LL":return(0,j.default)(ue+1,2);case"Lo":return le.ordinalNumber(ue+1,{unit:"month"});case"LLL":return le.month(ue,{width:"abbreviated",context:"standalone"});case"LLLLL":return le.month(ue,{width:"narrow",context:"standalone"});case"LLLL":default:return le.month(ue,{width:"wide",context:"standalone"})}},w:function(re,se,le,ue){var he=(0,R.default)(re,ue);return se==="wo"?le.ordinalNumber(he,{unit:"week"}):(0,j.default)(he,se.length)},I:function(re,se,le){var ue=(0,$.default)(re);return se==="Io"?le.ordinalNumber(ue,{unit:"week"}):(0,j.default)(ue,se.length)},d:function(re,se,le){return se==="do"?le.ordinalNumber(re.getUTCDate(),{unit:"date"}):q.default.d(re,se)},D:function(re,se,le){var ue=(0,w.default)(re);return se==="Do"?le.ordinalNumber(ue,{unit:"dayOfYear"}):(0,j.default)(ue,se.length)},E:function(re,se,le){var ue=re.getUTCDay();switch(se){case"E":case"EE":case"EEE":return le.day(ue,{width:"abbreviated",context:"formatting"});case"EEEEE":return le.day(ue,{width:"narrow",context:"formatting"});case"EEEEEE":return le.day(ue,{width:"short",context:"formatting"});case"EEEE":default:return le.day(ue,{width:"wide",context:"formatting"})}},e:function(re,se,le,ue){var he=re.getUTCDay(),ce=(he-ue.weekStartsOn+8)%7||7;switch(se){case"e":return String(ce);case"ee":return(0,j.default)(ce,2);case"eo":return le.ordinalNumber(ce,{unit:"day"});case"eee":return le.day(he,{width:"abbreviated",context:"formatting"});case"eeeee":return le.day(he,{width:"narrow",context:"formatting"});case"eeeeee":return le.day(he,{width:"short",context:"formatting"});case"eeee":default:return le.day(he,{width:"wide",context:"formatting"})}},c:function(re,se,le,ue){var he=re.getUTCDay(),ce=(he-ue.weekStartsOn+8)%7||7;switch(se){case"c":return String(ce);case"cc":return(0,j.default)(ce,se.length);case"co":return le.ordinalNumber(ce,{unit:"day"});case"ccc":return le.day(he,{width:"abbreviated",context:"standalone"});case"ccccc":return le.day(he,{width:"narrow",context:"standalone"});case"cccccc":return le.day(he,{width:"short",context:"standalone"});case"cccc":default:return le.day(he,{width:"wide",context:"standalone"})}},i:function(re,se,le){var ue=re.getUTCDay(),he=ue===0?7:ue;switch(se){case"i":return String(he);case"ii":return(0,j.default)(he,se.length);case"io":return le.ordinalNumber(he,{unit:"day"});case"iii":return le.day(ue,{width:"abbreviated",context:"formatting"});case"iiiii":return le.day(ue,{width:"narrow",context:"formatting"});case"iiiiii":return le.day(ue,{width:"short",context:"formatting"});case"iiii":default:return le.day(ue,{width:"wide",context:"formatting"})}},a:function(re,se,le){var ue=re.getUTCHours(),he=ue/12>=1?"pm":"am";switch(se){case"a":case"aa":return le.dayPeriod(he,{width:"abbreviated",context:"formatting"});case"aaa":return le.dayPeriod(he,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return le.dayPeriod(he,{width:"narrow",context:"formatting"});case"aaaa":default:return le.dayPeriod(he,{width:"wide",context:"formatting"})}},b:function(re,se,le){var ue=re.getUTCHours(),he;switch(ue===12?he=X.noon:ue===0?he=X.midnight:he=ue/12>=1?"pm":"am",se){case"b":case"bb":return le.dayPeriod(he,{width:"abbreviated",context:"formatting"});case"bbb":return le.dayPeriod(he,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return le.dayPeriod(he,{width:"narrow",context:"formatting"});case"bbbb":default:return le.dayPeriod(he,{width:"wide",context:"formatting"})}},B:function(re,se,le){var ue=re.getUTCHours(),he;switch(ue>=17?he=X.evening:ue>=12?he=X.afternoon:ue>=4?he=X.morning:he=X.night,se){case"B":case"BB":case"BBB":return le.dayPeriod(he,{width:"abbreviated",context:"formatting"});case"BBBBB":return le.dayPeriod(he,{width:"narrow",context:"formatting"});case"BBBB":default:return le.dayPeriod(he,{width:"wide",context:"formatting"})}},h:function(re,se,le){if(se==="ho"){var ue=re.getUTCHours()%12;return ue===0&&(ue=12),le.ordinalNumber(ue,{unit:"hour"})}return q.default.h(re,se)},H:function(re,se,le){return se==="Ho"?le.ordinalNumber(re.getUTCHours(),{unit:"hour"}):q.default.H(re,se)},K:function(re,se,le){var ue=re.getUTCHours()%12;return se==="Ko"?le.ordinalNumber(ue,{unit:"hour"}):(0,j.default)(ue,se.length)},k:function(re,se,le){var ue=re.getUTCHours();return ue===0&&(ue=24),se==="ko"?le.ordinalNumber(ue,{unit:"hour"}):(0,j.default)(ue,se.length)},m:function(re,se,le){return se==="mo"?le.ordinalNumber(re.getUTCMinutes(),{unit:"minute"}):q.default.m(re,se)},s:function(re,se,le){return se==="so"?le.ordinalNumber(re.getUTCSeconds(),{unit:"second"}):q.default.s(re,se)},S:function(re,se){return q.default.S(re,se)},X:function(re,se,le,ue){var he=ue._originalDate||re,ce=he.getTimezoneOffset();if(ce===0)return"Z";switch(se){case"X":return ne(ce);case"XXXX":case"XX":return oe(ce);case"XXXXX":case"XXX":default:return oe(ce,":")}},x:function(re,se,le,ue){var he=ue._originalDate||re,ce=he.getTimezoneOffset();switch(se){case"x":return ne(ce);case"xxxx":case"xx":return oe(ce);case"xxxxx":case"xxx":default:return oe(ce,":")}},O:function(re,se,le,ue){var he=ue._originalDate||re,ce=he.getTimezoneOffset();switch(se){case"O":case"OO":case"OOO":return"GMT"+te(ce,":");case"OOOO":default:return"GMT"+oe(ce,":")}},z:function(re,se,le,ue){var he=ue._originalDate||re,ce=he.getTimezoneOffset();switch(se){case"z":case"zz":case"zzz":return"GMT"+te(ce,":");case"zzzz":default:return"GMT"+oe(ce,":")}},t:function(re,se,le,ue){var he=ue._originalDate||re,ce=Math.floor(he.getTime()/1e3);return(0,j.default)(ce,se.length)},T:function(re,se,le,ue){var he=ue._originalDate||re,ce=he.getTime();return(0,j.default)(ce,se.length)}};function te(ae,re){var se=ae>0?"-":"+",le=Math.abs(ae),ue=Math.floor(le/60),he=le%60;if(he===0)return se+String(ue);var ce=re||"";return se+String(ue)+ce+(0,j.default)(he,2)}function ne(ae,re){if(ae%60===0){var se=ae>0?"-":"+";return se+(0,j.default)(Math.abs(ae)/60,2)}return oe(ae,re)}function oe(ae,re){var se=re||"",le=ae>0?"-":"+",ue=Math.abs(ae),he=(0,j.default)(Math.floor(ue/60),2),ce=(0,j.default)(ue%60,2);return le+he+se+ce}var ie=ee;_.default=ie,k.exports=_.default})(formatters,formatters.exports);var formattersExports=formatters.exports,longFormatters={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var y=function(j,q){switch(j){case"P":return q.date({width:"short"});case"PP":return q.date({width:"medium"});case"PPP":return q.date({width:"long"});case"PPPP":default:return q.date({width:"full"})}},w=function(j,q){switch(j){case"p":return q.time({width:"short"});case"pp":return q.time({width:"medium"});case"ppp":return q.time({width:"long"});case"pppp":default:return q.time({width:"full"})}},$=function(j,q){var X=j.match(/(P+)(p+)?/)||[],ee=X[1],te=X[2];if(!te)return y(j,q);var ne;switch(ee){case"P":ne=q.dateTime({width:"short"});break;case"PP":ne=q.dateTime({width:"medium"});break;case"PPP":ne=q.dateTime({width:"long"});break;case"PPPP":default:ne=q.dateTime({width:"full"});break}return ne.replace("{{date}}",y(ee,q)).replace("{{time}}",w(te,q))},B={p:w,P:$},R=B;_.default=R,k.exports=_.default})(longFormatters,longFormatters.exports);var longFormattersExports=longFormatters.exports,getTimezoneOffsetInMilliseconds={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w){var $=new Date(Date.UTC(w.getFullYear(),w.getMonth(),w.getDate(),w.getHours(),w.getMinutes(),w.getSeconds(),w.getMilliseconds()));return $.setUTCFullYear(w.getFullYear()),w.getTime()-$.getTime()}k.exports=_.default})(getTimezoneOffsetInMilliseconds,getTimezoneOffsetInMilliseconds.exports);var getTimezoneOffsetInMillisecondsExports=getTimezoneOffsetInMilliseconds.exports,protectedTokens={};Object.defineProperty(protectedTokens,"__esModule",{value:!0});protectedTokens.isProtectedDayOfYearToken=isProtectedDayOfYearToken;protectedTokens.isProtectedWeekYearToken=isProtectedWeekYearToken;protectedTokens.throwProtectedError=throwProtectedError;var protectedDayOfYearTokens=["D","DD"],protectedWeekYearTokens=["YY","YYYY"];function isProtectedDayOfYearToken(k){return protectedDayOfYearTokens.indexOf(k)!==-1}function isProtectedWeekYearToken(k){return protectedWeekYearTokens.indexOf(k)!==-1}function throwProtectedError(k,_,y){if(k==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(_,"`) for formatting years to the input `").concat(y,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(k==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(_,"`) for formatting years to the input `").concat(y,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(k==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(_,"`) for formatting days of the month to the input `").concat(y,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(k==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(_,"`) for formatting days of the month to the input `").concat(y,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var defaultLocale={exports:{}},enUS={exports:{}},formatDistance={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var y={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},w=function(R,H,j){var q,X=y[R];return typeof X=="string"?q=X:H===1?q=X.one:q=X.other.replace("{{count}}",H.toString()),j!=null&&j.addSuffix?j.comparison&&j.comparison>0?"in "+q:q+" ago":q},$=w;_.default=$,k.exports=_.default})(formatDistance,formatDistance.exports);var formatDistanceExports=formatDistance.exports,formatLong={exports:{}},buildFormatLongFn={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w){return function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=$.width?String($.width):w.defaultWidth,R=w.formats[B]||w.formats[w.defaultWidth];return R}}k.exports=_.default})(buildFormatLongFn,buildFormatLongFn.exports);var buildFormatLongFnExports=buildFormatLongFn.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(buildFormatLongFnExports),$={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},B={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},R={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},H={date:(0,w.default)({formats:$,defaultWidth:"full"}),time:(0,w.default)({formats:B,defaultWidth:"full"}),dateTime:(0,w.default)({formats:R,defaultWidth:"full"})},j=H;_.default=j,k.exports=_.default})(formatLong,formatLong.exports);var formatLongExports=formatLong.exports,formatRelative={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var y={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},w=function(R,H,j,q){return y[R]},$=w;_.default=$,k.exports=_.default})(formatRelative,formatRelative.exports);var formatRelativeExports=formatRelative.exports,localize={exports:{}},buildLocalizeFn={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w){return function($,B){var R=B!=null&&B.context?String(B.context):"standalone",H;if(R==="formatting"&&w.formattingValues){var j=w.defaultFormattingWidth||w.defaultWidth,q=B!=null&&B.width?String(B.width):j;H=w.formattingValues[q]||w.formattingValues[j]}else{var X=w.defaultWidth,ee=B!=null&&B.width?String(B.width):w.defaultWidth;H=w.values[ee]||w.values[X]}var te=w.argumentCallback?w.argumentCallback($):$;return H[te]}}k.exports=_.default})(buildLocalizeFn,buildLocalizeFn.exports);var buildLocalizeFnExports=buildLocalizeFn.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(buildLocalizeFnExports),$={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},B={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},R={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},H={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},j={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},q={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},X=function(oe,ie){var ae=Number(oe),re=ae%100;if(re>20||re<10)switch(re%10){case 1:return ae+"st";case 2:return ae+"nd";case 3:return ae+"rd"}return ae+"th"},ee={ordinalNumber:X,era:(0,w.default)({values:$,defaultWidth:"wide"}),quarter:(0,w.default)({values:B,defaultWidth:"wide",argumentCallback:function(oe){return oe-1}}),month:(0,w.default)({values:R,defaultWidth:"wide"}),day:(0,w.default)({values:H,defaultWidth:"wide"}),dayPeriod:(0,w.default)({values:j,defaultWidth:"wide",formattingValues:q,defaultFormattingWidth:"wide"})},te=ee;_.default=te,k.exports=_.default})(localize,localize.exports);var localizeExports=localize.exports,match={exports:{}},buildMatchFn={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(B){return function(R){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=H.width,q=j&&B.matchPatterns[j]||B.matchPatterns[B.defaultMatchWidth],X=R.match(q);if(!X)return null;var ee=X[0],te=j&&B.parsePatterns[j]||B.parsePatterns[B.defaultParseWidth],ne=Array.isArray(te)?$(te,function(ae){return ae.test(ee)}):w(te,function(ae){return ae.test(ee)}),oe;oe=B.valueCallback?B.valueCallback(ne):ne,oe=H.valueCallback?H.valueCallback(oe):oe;var ie=R.slice(ee.length);return{value:oe,rest:ie}}}function w(B,R){for(var H in B)if(B.hasOwnProperty(H)&&R(B[H]))return H}function $(B,R){for(var H=0;H<B.length;H++)if(R(B[H]))return H}k.exports=_.default})(buildMatchFn,buildMatchFn.exports);var buildMatchFnExports=buildMatchFn.exports,buildMatchPatternFn={exports:{}};(function(k,_){Object.defineProperty(_,"__esModule",{value:!0}),_.default=y;function y(w){return function($){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=$.match(w.matchPattern);if(!R)return null;var H=R[0],j=$.match(w.parsePattern);if(!j)return null;var q=w.valueCallback?w.valueCallback(j[0]):j[0];q=B.valueCallback?B.valueCallback(q):q;var X=$.slice(H.length);return{value:q,rest:X}}}k.exports=_.default})(buildMatchPatternFn,buildMatchPatternFn.exports);var buildMatchPatternFnExports=buildMatchPatternFn.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(buildMatchFnExports),$=y(buildMatchPatternFnExports),B=/^(\d+)(th|st|nd|rd)?/i,R=/\d+/i,H={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},j={any:[/^b/i,/^(a|c)/i]},q={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},X={any:[/1/i,/2/i,/3/i,/4/i]},ee={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},te={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ne={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},oe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ie={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ae={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},re={ordinalNumber:(0,$.default)({matchPattern:B,parsePattern:R,valueCallback:function(ue){return parseInt(ue,10)}}),era:(0,w.default)({matchPatterns:H,defaultMatchWidth:"wide",parsePatterns:j,defaultParseWidth:"any"}),quarter:(0,w.default)({matchPatterns:q,defaultMatchWidth:"wide",parsePatterns:X,defaultParseWidth:"any",valueCallback:function(ue){return ue+1}}),month:(0,w.default)({matchPatterns:ee,defaultMatchWidth:"wide",parsePatterns:te,defaultParseWidth:"any"}),day:(0,w.default)({matchPatterns:ne,defaultMatchWidth:"wide",parsePatterns:oe,defaultParseWidth:"any"}),dayPeriod:(0,w.default)({matchPatterns:ie,defaultMatchWidth:"any",parsePatterns:ae,defaultParseWidth:"any"})},se=re;_.default=se,k.exports=_.default})(match,match.exports);var matchExports=match.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(formatDistanceExports),$=y(formatLongExports),B=y(formatRelativeExports),R=y(localizeExports),H=y(matchExports),j={code:"en-US",formatDistance:w.default,formatLong:$.default,formatRelative:B.default,localize:R.default,match:H.default,options:{weekStartsOn:0,firstWeekContainsDate:1}},q=j;_.default=q,k.exports=_.default})(enUS,enUS.exports);var enUSExports=enUS.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=void 0;var w=y(enUSExports),$=w.default;_.default=$,k.exports=_.default})(defaultLocale,defaultLocale.exports);var defaultLocaleExports=defaultLocale.exports;(function(k,_){var y=interopRequireDefaultExports.default;Object.defineProperty(_,"__esModule",{value:!0}),_.default=le;var w=y(isValidExports),$=y(subMillisecondsExports),B=y(toDateExports),R=y(formattersExports),H=y(longFormattersExports),j=y(getTimezoneOffsetInMillisecondsExports),q=protectedTokens,X=y(toIntegerExports),ee=y(requiredArgsExports),te=defaultOptions$1,ne=y(defaultLocaleExports),oe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ie=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ae=/^'([^]*?)'?$/,re=/''/g,se=/[a-zA-Z]/;function le(he,ce,ge){var be,fe,we,Ce,ve,ke,me,Ie,Fe,Be,Ze,Re,qe,Me,Pe,Qe,je,Ue;(0,ee.default)(2,arguments);var tt=String(ce),Ve=(0,te.getDefaultOptions)(),nt=(be=(fe=ge?.locale)!==null&&fe!==void 0?fe:Ve.locale)!==null&&be!==void 0?be:ne.default,et=(0,X.default)((we=(Ce=(ve=(ke=ge?.firstWeekContainsDate)!==null&&ke!==void 0?ke:ge==null||(me=ge.locale)===null||me===void 0||(Ie=me.options)===null||Ie===void 0?void 0:Ie.firstWeekContainsDate)!==null&&ve!==void 0?ve:Ve.firstWeekContainsDate)!==null&&Ce!==void 0?Ce:(Fe=Ve.locale)===null||Fe===void 0||(Be=Fe.options)===null||Be===void 0?void 0:Be.firstWeekContainsDate)!==null&&we!==void 0?we:1);if(!(et>=1&&et<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var st=(0,X.default)((Ze=(Re=(qe=(Me=ge?.weekStartsOn)!==null&&Me!==void 0?Me:ge==null||(Pe=ge.locale)===null||Pe===void 0||(Qe=Pe.options)===null||Qe===void 0?void 0:Qe.weekStartsOn)!==null&&qe!==void 0?qe:Ve.weekStartsOn)!==null&&Re!==void 0?Re:(je=Ve.locale)===null||je===void 0||(Ue=je.options)===null||Ue===void 0?void 0:Ue.weekStartsOn)!==null&&Ze!==void 0?Ze:0);if(!(st>=0&&st<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!nt.localize)throw new RangeError("locale must contain localize property");if(!nt.formatLong)throw new RangeError("locale must contain formatLong property");var at=(0,B.default)(he);if(!(0,w.default)(at))throw new RangeError("Invalid time value");var ct=(0,j.default)(at),lt=(0,$.default)(at,ct),_e={firstWeekContainsDate:et,weekStartsOn:st,locale:nt,_originalDate:at},We=tt.match(ie).map(function(Ne){var $e=Ne[0];if($e==="p"||$e==="P"){var Te=H.default[$e];return Te(Ne,nt.formatLong)}return Ne}).join("").match(oe).map(function(Ne){if(Ne==="''")return"'";var $e=Ne[0];if($e==="'")return ue(Ne);var Te=R.default[$e];if(Te)return!(ge!=null&&ge.useAdditionalWeekYearTokens)&&(0,q.isProtectedWeekYearToken)(Ne)&&(0,q.throwProtectedError)(Ne,ce,String(he)),!(ge!=null&&ge.useAdditionalDayOfYearTokens)&&(0,q.isProtectedDayOfYearToken)(Ne)&&(0,q.throwProtectedError)(Ne,ce,String(he)),Te(lt,Ne,nt.localize,_e);if($e.match(se))throw new RangeError("Format string contains an unescaped latin alphabet character `"+$e+"`");return Ne}).join("");return We}function ue(he){var ce=he.match(ae);return ce?ce[1].replace(re,"'"):he}k.exports=_.default})(format$1,format$1.exports);var formatExports=format$1.exports;const format=getDefaultExportFromCjs(formatExports),datePureColumnConfig=columnManager.register("date",{name:"Date",type:()=>tDate.create(),defaultData:()=>({}),cellToString:k=>k?.toString()??"",cellFromString:k=>({value:!isNaN(Date.parse(k))?+new Date(k):null}),cellToJson:k=>k??null});var __decorate$B=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DateCell=class extends BaseCellRenderer{render(){const _=this.value?format(new Date(this.value),"yyyy/MM/dd"):"";return x$1` <div class="affine-database-date date">${_}</div>`}};DateCell.styles=i$5`
    affine-database-date-cell {
      width: 100%;
    }

    .affine-database-date {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0;
      border: none;
      font-family: var(--affine-font-family);
      color: var(--affine-text-primary-color);
      font-weight: 400;
      background-color: transparent;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      height: var(--data-view-cell-text-line-height);
    }
  `;DateCell=__decorate$B([e$7("affine-database-date-cell")],DateCell);let DateCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this._setValue=(_=this._inputEle.value)=>{if(_===""){this.onChange(void 0),this._inputEle.value="";return}const y=new Date(_),w=format(y,"yyyy-MM-dd");this.onChange(y.getTime()),this._inputEle.value=`${w??""}`},this._onFocus=()=>{this._inputEle.showPicker()}}onExitEditMode(){this._setValue()}firstUpdated(){this._inputEle.focus()}render(){const _=this.value?format(this.value,"yyyy-MM-dd"):"";return x$1`<input
      type="date"
      class="affine-database-date date"
      .value="${_}"
      @focus=${this._onFocus}
    />`}};DateCellEditing.styles=i$5`
    affine-database-date-cell-editing {
      width: 100%;
      cursor: text;
    }

    .affine-database-date:focus {
      outline: none;
    }
  `;__decorate$B([i$6("input")],DateCellEditing.prototype,"_inputEle",void 0);DateCellEditing=__decorate$B([e$7("affine-database-date-cell-editing")],DateCellEditing);columnRenderer.register({type:datePureColumnConfig.type,icon:createIcon("DateTime"),cellRenderer:{view:createFromBaseCellRenderer(DateCell),edit:createFromBaseCellRenderer(DateCellEditing)}});const dateColumnConfig=datePureColumnConfig,ImageColumnTypeName="image";columnManager.register(ImageColumnTypeName,{name:"image",type:()=>tImage.create(),defaultData:()=>({}),cellToString:k=>k??"",cellFromString:k=>({value:k}),cellToJson:k=>k??null});var __decorate$A=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let TextCell=class extends BaseCellRenderer{render(){return x$1`<img src=${this.value??""}></img>`}};TextCell.styles=i$5`
    affine-database-image-cell {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
    }
    affine-database-image-cell img {
      width: 20px;
      height: 20px;
    }
  `;TextCell=__decorate$A([e$7("affine-database-image-cell")],TextCell);columnRenderer.register({type:ImageColumnTypeName,icon:createIcon("ImageIcon"),cellRenderer:{view:createFromBaseCellRenderer(TextCell)}});var __decorate$z=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LinkNode=class extends ShadowlessElement{render(){return isValidUrl(this.link)?x$1`<a
      class="link-node"
      href=${this.link}
      rel="noopener noreferrer"
      target="_blank"
      ><span class="link-node-text">${this.link}</span></a
    >`:x$1`<span class="normal-text">${this.link}</span>`}};LinkNode.styles=i$5`
    .link-node {
      word-break: break-all;
      color: var(--affine-link-color);
      fill: var(--affine-link-color);
      cursor: pointer;
      font-weight: normal;
      font-style: normal;
      text-decoration: none;
    }
  `;__decorate$z([n$a({attribute:!1})],LinkNode.prototype,"link",void 0);LinkNode=__decorate$z([e$7("affine-database-link-node")],LinkNode);const linkPureColumnConfig=columnManager.register("link",{name:"Link",type:()=>tString.create(),defaultData:()=>({}),cellToString:k=>k?.toString()??"",cellFromString:k=>({value:k}),cellToJson:k=>k??null});var __decorate$y=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LinkCell=class extends BaseCellRenderer{constructor(){super(...arguments),this._onClick=_=>{_.stopPropagation();const y=this.value??"";if(!y||!isValidUrl(y)){this.selectCurrentCell(!0);return}if(isValidUrl(y)){const $=_.target.querySelector(".link-node");$&&(_.preventDefault(),$.click());return}},this._onEdit=_=>{_.stopPropagation(),this.selectCurrentCell(!0)}}render(){const _=this.value??"";return n$5`
      <div class="affine-database-link" @click="${this._onClick}">
        <affine-database-link-node
          .link="${_}"
        ></affine-database-link-node>
        <div class="affine-database-link-icon" @click="${this._onEdit}">
          ${PenIcon}
        </div>
      </div>
    `}};LinkCell.styles=i$5`
    affine-database-link-cell {
      width: 100%;
      user-select: none;
      cursor: pointer;
    }

    affine-database-link-cell:hover .affine-database-link-icon {
      visibility: visible;
    }

    .affine-database-link {
      display: flex;
      position: relative;
      align-items: center;
      width: 100%;
      height: 100%;
      outline: none;
      overflow: hidden;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      word-break: break-all;
    }

    affine-database-link-node {
      flex: 1;
      word-break: break-all;
    }

    .affine-database-link-icon {
      position: absolute;
      right: 0;
      display: flex;
      align-items: center;
      visibility: hidden;
      cursor: pointer;
      background: var(--affine-background-primary-color);
      border-radius: 4px;
    }
    .affine-database-link-icon:hover {
      background: var(--affine-hover-color);
    }

    .affine-database-link-icon svg {
      width: 16px;
      height: 16px;
      fill: var(--affine-icon-color);
    }
  `;LinkCell=__decorate$y([e$7("affine-database-link-cell")],LinkCell);let LinkCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this._focusEnd=()=>{const _=this._container.value.length;this._container.focus(),this._container.setSelectionRange(_,_)},this._setValue=(_=this._container.value)=>{let y=_;isValidUrl(_)&&(y=normalizeUrl(_)),this.onChange(y),this._container.value=y},this._onKeydown=_=>{_.key==="Enter"&&(this._setValue(),setTimeout(()=>{this.selectCurrentCell(!1)}))}}firstUpdated(){this._focusEnd()}onExitEditMode(){this._setValue()}render(){const _=this.value??"";return n$5`<input
      class="affine-database-link-editing link"
      .value=${_}
      @keydown=${this._onKeydown}
    />`}};LinkCellEditing.styles=i$5`
    affine-database-link-cell-editing {
      width: 100%;
      cursor: text;
    }

    .affine-database-link-editing {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0;
      border: none;
      font-family: var(--affine-font-family);
      color: var(--affine-text-primary-color);
      font-weight: 400;
      background-color: transparent;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      word-break: break-all;
    }

    .affine-database-link-editing:focus {
      outline: none;
    }
  `;__decorate$y([i$6(".affine-database-link-editing")],LinkCellEditing.prototype,"_container",void 0);LinkCellEditing=__decorate$y([e$7("affine-database-link-cell-editing")],LinkCellEditing);columnRenderer.register({type:linkPureColumnConfig.type,icon:createIcon("LinkIcon"),cellRenderer:{view:createFromBaseCellRenderer(LinkCell),edit:createFromBaseCellRenderer(LinkCellEditing)}});const linkColumnConfig=linkPureColumnConfig;var __decorate$x=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let MultiSelectCell=class extends BaseCellRenderer{render(){return n$5`
      <affine-multi-tag-view
        .value="${this.value??[]}"
        .options="${this.column.data.options}"
      ></affine-multi-tag-view>
    `}};MultiSelectCell=__decorate$x([e$7("affine-database-multi-select-cell")],MultiSelectCell);let MultiSelectCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this._onChange=_=>{this.onChange(_)},this._editComplete=()=>{this.selectCurrentCell(!1)},this._onOptionsChange=_=>{this.column.updateData(y=>({...y,options:_}))},this.popTagSelect=()=>{this._disposables.add({dispose:popTagSelect(this,{options:this._options,onOptionsChange:this._onOptionsChange,value:this._value,onChange:this._onChange,onComplete:this._editComplete,minWidth:400})})}}get _options(){return this.column.data.options}get _value(){return this.value??[]}firstUpdated(){this.popTagSelect()}render(){return n$5`
      <affine-multi-tag-view
        .value="${this._value}"
        .options="${this._options}"
      ></affine-multi-tag-view>
    `}};MultiSelectCellEditing=__decorate$x([e$7("affine-database-multi-select-cell-editing")],MultiSelectCellEditing);columnRenderer.register({type:multiSelectPureColumnConfig.type,icon:createIcon("DatabaseMultiSelect"),cellRenderer:{view:createFromBaseCellRenderer(MultiSelectCell),edit:createFromBaseCellRenderer(MultiSelectCellEditing)}});const multiSelectColumnConfig=multiSelectPureColumnConfig;var __decorate$w=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let NumberCell=class extends BaseCellRenderer{render(){return x$1` <div class="affine-database-number number">
      ${this.value??""}
    </div>`}};NumberCell.styles=i$5`
    affine-database-number-cell {
      display: block;
      width: 100%;
    }

    .affine-database-number {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0;
      border: none;
      font-family: var(--affine-font-family);
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      color: var(--affine-text-primary-color);
      font-weight: 400;
      background-color: transparent;
    }
  `;NumberCell=__decorate$w([e$7("affine-database-number-cell")],NumberCell);let NumberCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this.focusEnd=()=>{const _=this._inputEle.value.length;this._inputEle.focus(),this._inputEle.setSelectionRange(_,_)},this._setValue=(_=this._inputEle.value)=>{if(!_){this.onChange(void 0);return}const y=Number.parseFloat(_);if(Object.is(y,NaN)){this._inputEle.value=`${this.value??""}`;return}this._inputEle.value=`${this.value??""}`,this.onChange(y)},this._keydown=_=>{_.key==="Enter"&&requestAnimationFrame(()=>{this.selectCurrentCell(!1)})}}onExitEditMode(){this._setValue()}firstUpdated(){requestAnimationFrame(()=>{this.focusEnd()})}_blur(){this.selectCurrentCell(!1)}_focus(){this.isEditing||this.selectCurrentCell(!0)}render(){const _=`${this.value??""}`;return x$1`<input
      .value="${_}"
      @keydown="${this._keydown}"
      @blur="${this._blur}"
      @focus="${this._focus}"
      class="affine-database-number number"
    />`}};NumberCellEditing.styles=i$5`
    affine-database-number-cell-editing {
      display: block;
      width: 100%;
      cursor: text;
    }

    .affine-database-number {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0;
      border: none;
      font-family: var(--affine-font-family);
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      color: var(--affine-text-primary-color);
      font-weight: 400;
      background-color: transparent;
    }

    .affine-database-number:focus {
      outline: none;
    }
  `;__decorate$w([i$6("input")],NumberCellEditing.prototype,"_inputEle",void 0);NumberCellEditing=__decorate$w([e$7("affine-database-number-cell-editing")],NumberCellEditing);columnRenderer.register({type:numberPureColumnConfig.type,icon:createIcon("DatabaseNumber"),cellRenderer:{view:createFromBaseCellRenderer(NumberCell),edit:createFromBaseCellRenderer(NumberCellEditing)}});const numberColumnConfig=numberPureColumnConfig,progressColumnTypeName="progress",progressPureColumnConfig=columnManager.register(progressColumnTypeName,{name:"Progress",type:()=>tNumber.create(),defaultData:()=>({}),cellToString:k=>k?.toString()??"",cellFromString:k=>{const _=k?Number(k):NaN;return{value:isNaN(_)?null:_}},cellToJson:k=>k??null});progressPureColumnConfig.registerConvert(richTextColumnTypeName,(k,_)=>({column:{},cells:_.map(y=>new Text$1(y?.toString()).yText)}));var __decorate$v=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const styles$6=i$5`
  affine-database-progress-cell-editing {
    display: block;
    width: 100%;
    padding: 0 4px;
  }

  affine-database-progress-cell {
    display: block;
    width: 100%;
    padding: 0 4px;
  }

  .affine-database-progress {
    display: flex;
    align-items: center;
    height: var(--data-view-cell-text-line-height);
    gap: 4px;
  }

  .affine-database-progress-bar {
    position: relative;
    width: 104px;
  }

  .affine-database-progress-bg {
    overflow: hidden;
    width: 100%;
    height: 10px;
    border-radius: 22px;
  }

  .affine-database-progress-fg {
    height: 100%;
  }

  .affine-database-progress-drag-handle {
    position: absolute;
    top: 0;
    left: 0;
    transform: translate(0px, -1px);
    width: 6px;
    height: 12px;
    border-radius: 2px;
    opacity: 1;
    cursor: ew-resize;
    background: var(--affine-primary-color);
    transition: opacity 0.2s ease-in-out;
  }

  .progress-number {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 18px;
    width: 25px;
    color: var(--affine-text-secondary-color);
    font-size: 14px;
  }
`,progressColors={empty:"var(--affine-black-10)",processing:"var(--affine-processing-color)",success:"var(--affine-success-color)"};let ProgressCell=class extends BaseCellRenderer{_bgClick(_){this.column.readonly||this.onChange(Math.round(_.offsetX*100/_.currentTarget.offsetWidth))}render(){const _=this.value??0;let y=progressColors.processing;_===100&&(y=progressColors.success);const w=o$4({width:`${_}%`,backgroundColor:y}),$=o$4({backgroundColor:_===0?progressColors.empty:"var(--affine-hover-color)"});return x$1` <div class="affine-database-progress">
      <div class="affine-database-progress-bar">
        <div
          class="affine-database-progress-bg"
          @click="${this._bgClick}"
          style=${$}
        >
          <div class="affine-database-progress-fg" style=${w}></div>
        </div>
      </div>
      <div class="progress-number progress">${_}</div>
    </div>`}};ProgressCell.styles=styles$6;ProgressCell=__decorate$v([e$7("affine-database-progress-cell")],ProgressCell);let ProgressCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this.startDrag=_=>{const y=this._progressBg.getBoundingClientRect(),w=y.left,$=y.right,B=R=>{this.tempValue=Math.round((Math.min($,Math.max(w,R))-w)/($-w)*100)};startDrag(_,{onDrag:({x:R})=>{B(R)},onMove:({x:R})=>{B(R)},onDrop:()=>{},onClear:()=>{}})}}onExitEditMode(){this.onChange(this._value)}get _value(){return this.tempValue??this.value??0}_onChange(_){this.tempValue=_}firstUpdated(){const _=this._disposables;_.addFromEvent(this._progressBg,"pointerdown",this.startDrag),_.addFromEvent(window,"keydown",y=>{if(y.key==="ArrowDown"){this._onChange(Math.max(0,this._value-1));return}if(y.key==="ArrowUp"){this._onChange(Math.min(100,this._value+1));return}})}render(){const _=this._value;let y=progressColors.processing;_===100&&(y=progressColors.success);const w=o$4({width:`${_}%`,backgroundColor:y}),$=o$4({backgroundColor:_===0?progressColors.empty:"var(--affine-hover-color)"}),B=o$4({left:`calc(${_}% - 3px)`});return x$1` <div class="affine-database-progress">
      <div class="affine-database-progress-bar">
        <div class="affine-database-progress-bg" style=${$}>
          <div class="affine-database-progress-fg" style=${w}></div>
          <div
            class="affine-database-progress-drag-handle"
            style=${B}
          ></div>
        </div>
      </div>
      <div class="progress-number progress">${_}</div>
    </div>`}};ProgressCellEditing.styles=styles$6;__decorate$v([t$2()],ProgressCellEditing.prototype,"tempValue",void 0);__decorate$v([i$6(".affine-database-progress-bg")],ProgressCellEditing.prototype,"_progressBg",void 0);ProgressCellEditing=__decorate$v([e$7("affine-database-progress-cell-editing")],ProgressCellEditing);columnRenderer.register({type:progressPureColumnConfig.type,icon:createIcon("DatabaseProgress"),cellRenderer:{view:createFromBaseCellRenderer(ProgressCell),edit:createFromBaseCellRenderer(ProgressCellEditing)}});const progressColumnConfig=progressPureColumnConfig;var __decorate$u=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function toggleStyle(k,_){const y=k.getVRange();if(!y)return;const w=k.rootElement;if(!w)return;const $=k.getDeltasByVRange(y);let B={};for(const[H]of $){const j=H.attributes;j&&(B={...j})}const R=Object.fromEntries(Object.entries(_).map(([H,j])=>typeof j=="boolean"&&j===B[H]?[H,!j]:[H,j]));k.formatText(y,R,{mode:"merge"}),w.blur(),k.syncVRange()}let RichTextCell=class extends BaseCellRenderer{constructor(){super(...arguments),this.vEditor=null,this._initYText=_=>{const y=new YText(_);return this.onChange(y),y}}init(){const _=this._onInitVEditor();this.column.captureSync(),this.disposables.add({dispose:()=>{_.unmount()}})}firstUpdated(){this.init()}connectedCallback(){super.connectedCallback(),this._container&&this.init()}_onInitVEditor(){let _;this.value?typeof this.value=="string"?_=this._initYText(this.value):_=this.value:_=this._initYText();const y=new VEditor(_);return this.vEditor=y,y.mount(this._container),y.setReadonly(!0),y}render(){return n$5` <div class="affine-database-rich-text virgo-editor"></div>`}};RichTextCell.styles=i$5`
    affine-database-rich-text-cell {
      display: flex;
      align-items: center;
      width: 100%;
      user-select: none;
    }

    .affine-database-rich-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 100%;
      height: 100%;
      outline: none;
      font-size: var(--data-view-cell-text-size);
      line-height: var(--data-view-cell-text-line-height);
      word-break: break-all;
    }

    .affine-database-rich-text v-line {
      display: flex !important;
      align-items: center;
      height: 100%;
      width: 100%;
    }

    .affine-database-rich-text v-line > div {
      flex-grow: 1;
    }
  `;__decorate$u([i$6(".affine-database-rich-text")],RichTextCell.prototype,"_container",void 0);RichTextCell=__decorate$u([e$7("affine-database-rich-text-cell")],RichTextCell);let RichTextCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this.vEditor=null,this._initYText=_=>{const y=new YText(_);return this.onChange(y),y},this._handleKeyDown=_=>{if(_.key!=="Escape"){if(_.key==="Tab"){_.preventDefault();return}_.stopPropagation()}if(!this.vEditor)return;if(_.key==="Enter"){_.shiftKey?this._onSoftEnter():(this.selectCurrentCell(!1),this._container.blur()),_.preventDefault();return}const y=this.vEditor;switch(_.key){case"B":case"b":(_.metaKey||_.ctrlKey)&&(_.preventDefault(),toggleStyle(this.vEditor,{bold:!0}));break;case"I":case"i":(_.metaKey||_.ctrlKey)&&(_.preventDefault(),toggleStyle(this.vEditor,{italic:!0}));break;case"U":case"u":(_.metaKey||_.ctrlKey)&&(_.preventDefault(),toggleStyle(this.vEditor,{underline:!0}));break;case"S":case"s":(_.metaKey||_.ctrlKey)&&_.shiftKey&&(_.preventDefault(),toggleStyle(y,{strike:!0}));break;case"E":case"e":(_.metaKey||_.ctrlKey)&&_.shiftKey&&(_.preventDefault(),toggleStyle(y,{code:!0}));break}},this._onSoftEnter=()=>{if(this.value&&this.vEditor){const _=this.vEditor.getVRange();assertExists(_),this.column.captureSync(),new Text$1(this.vEditor.yText).replace(_.index,length,`
`),this.vEditor.setVRange({index:_.index+1,length:0})}}}init(){const _=this._onInitVEditor();this.vEditor=_,this.column.captureSync(),this.disposables.add({dispose:()=>{_.unmount()}})}firstUpdated(){this.init()}connectedCallback(){super.connectedCallback(),this._container&&this.init()}_onInitVEditor(){let _;this.value?typeof this.value=="string"?_=this._initYText(this.value):_=this.value:_=this._initYText();const y=new VEditor(_);y.mount(this._container);const w=addHistoryToVEditor(y);return y.disposables.addFromEvent(this._container,"keydown",$=>{w.handleKeyboardEvent($),this._handleKeyDown($)}),y.focusEnd(),y.setReadonly(this.readonly),this._disposables.add(y.slots.vRangeUpdated.on(([$])=>{$?this.isEditing||this.selectCurrentCell(!0):this.selectCurrentCell(!1)})),y}render(){return n$5`<div class="affine-database-rich-text virgo-editor"></div>`}};RichTextCellEditing.styles=i$5`
    affine-database-rich-text-cell-editing {
      display: flex;
      align-items: center;
      width: 100%;
      cursor: text;
    }

    .affine-database-rich-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 100%;
      height: 100%;
      outline: none;
    }

    .affine-database-rich-text v-line {
      display: flex !important;
      align-items: center;
      height: 100%;
      width: 100%;
    }

    .affine-database-rich-text v-line > div {
      flex-grow: 1;
    }
  `;__decorate$u([i$6(".affine-database-rich-text")],RichTextCellEditing.prototype,"_container",void 0);RichTextCellEditing=__decorate$u([e$7("affine-database-rich-text-cell-editing")],RichTextCellEditing);columnRenderer.register({type:richTextColumnTypeName,icon:createIcon("TextIcon"),cellRenderer:{view:createFromBaseCellRenderer(RichTextCell),edit:createFromBaseCellRenderer(RichTextCellEditing)}});const richTextColumnConfig=richTextPureColumnConfig;var __decorate$t=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let SelectCell=class extends BaseCellRenderer{render(){const _=this.value?[this.value]:[];return n$5`
      <affine-multi-tag-view
        .value="${_}"
        .options="${this.column.data.options}"
      ></affine-multi-tag-view>
    `}};SelectCell=__decorate$t([e$7("affine-database-select-cell")],SelectCell);let SelectCellEditing=class extends BaseCellRenderer{constructor(){super(...arguments),this._onChange=([_])=>{this.onChange(_)},this._editComplete=()=>{this.selectCurrentCell(!1)},this._onOptionsChange=_=>{this.column.updateData(y=>({...y,options:_}))},this.popTagSelect=()=>{this._disposables.add({dispose:popTagSelect(this,{mode:"single",options:this._options,onOptionsChange:this._onOptionsChange,value:this._value,onChange:this._onChange,onComplete:this._editComplete,minWidth:400})})}}get _options(){return this.column.data.options}get _value(){const _=this.value;return _?[_]:[]}firstUpdated(){this.popTagSelect()}render(){return n$5`
      <affine-multi-tag-view
        .value="${this._value}"
        .options="${this._options}"
      ></affine-multi-tag-view>
    `}};SelectCellEditing=__decorate$t([e$7("affine-database-select-cell-editing")],SelectCellEditing);columnRenderer.register({type:selectPureColumnConfig.type,icon:createIcon("DatabaseSelect"),cellRenderer:{view:createFromBaseCellRenderer(SelectCell),edit:createFromBaseCellRenderer(SelectCellEditing)}});const selectColumnConfig=selectPureColumnConfig;var __decorate$s=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let TitleDetailCell=class extends BaseCellRenderer{connectedCallback(){super.connectedCallback(),this._disposables.addFromEvent(this,"keydown",_=>{if(_.key==="Enter"&&!_.shiftKey){_.stopPropagation(),_.preventDefault();return}},!0)}extra(){return this.column.getExtra(this.rowId)}render(){return this.extra().result}};TitleDetailCell.styles=i$5``;TitleDetailCell=__decorate$s([e$7("data-view-title-detail-cell")],TitleDetailCell);columnRenderer.register({type:titleColumnTypeName,icon:createIcon("TitleIcon"),cellRenderer:{view:createFromBaseCellRenderer(RichTextCell),edit:createFromBaseCellRenderer(RichTextCellEditing)}});class BaseDataSource{constructor(){this.columnConfigManager=columnManager}cellChangeRenderValue(_,y,w){this.cellChangeValue(_,y,w)}cellGetRenderValue(_,y){return this.cellGetValue(_,y)}cellGetExtra(_,y){return undefinedType}propertyGetReadonly(_){return!1}propertyGetDefaultWidth(_){return DEFAULT_COLUMN_WIDTH}onCellUpdate(_,y,w){return{dispose:()=>{}}}captureSync(){}get detailSlots(){return{}}}const bulleted=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.29999 7.5C4.85227 7.5 5.29999 7.05228 5.29999 6.5C5.29999 5.94772 4.85227 5.5 4.29999 5.5C3.7477 5.5 3.29999 5.94772 3.29999 6.5C3.29999 7.05228 3.7477 7.5 4.29999 7.5ZM8.33335 5.75073C7.91914 5.75071 7.58334 6.08648 7.58331 6.50069C7.58329 6.9149 7.91906 7.25071 8.33327 7.25073L20.2499 7.2514C20.6641 7.25142 20.9999 6.91565 21 6.50144C21 6.08722 20.6642 5.75142 20.25 5.7514L8.33335 5.75073ZM8.33336 11.2508C7.91914 11.2508 7.58334 11.5865 7.58331 12.0007C7.58329 12.415 7.91905 12.7508 8.33327 12.7508L20.25 12.7515C20.6642 12.7515 21 12.4158 21 12.0015C21 11.5873 20.6643 11.2515 20.2501 11.2515L8.33336 11.2508ZM8.33336 16.7508C7.91914 16.7508 7.58334 17.0865 7.58331 17.5007C7.58329 17.915 7.91905 18.2508 8.33327 18.2508L20.25 18.2515C20.6642 18.2515 21 17.9158 21 17.5016C21 17.0873 20.6643 16.7515 20.25 16.7515L8.33336 16.7508ZM5.29999 12C5.29999 12.5523 4.85227 13 4.29999 13C3.7477 13 3.29999 12.5523 3.29999 12C3.29999 11.4477 3.7477 11 4.29999 11C4.85227 11 5.29999 11.4477 5.29999 12ZM4.29999 18.5C4.85227 18.5 5.29999 18.0523 5.29999 17.5C5.29999 16.9477 4.85227 16.5 4.29999 16.5C3.7477 16.5 3.29999 16.9477 3.29999 17.5C3.29999 18.0523 3.7477 18.5 4.29999 18.5Z"
    fill="currentColor"
  />
</svg> `,numbered=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.1287 5.76205C4.18101 5.74447 4.22813 5.71723 4.27846 5.68228L4.53386 5.50534V7.63997C4.53386 7.82761 4.59717 7.9904 4.71548 8.10631C4.83355 8.222 4.99776 8.28258 5.18421 8.28258C5.37066 8.28258 5.53488 8.222 5.65295 8.10631C5.77126 7.9904 5.83457 7.82761 5.83457 7.63997V4.93384C5.83457 4.72505 5.76932 4.54353 5.6384 4.41417C5.50756 4.2849 5.32242 4.21887 5.10409 4.21887C4.88258 4.21887 4.6705 4.24086 4.42948 4.40154L3.75168 4.85427C3.57975 4.97094 3.5 5.12628 3.5 5.31379C3.5 5.58698 3.70304 5.7858 3.96426 5.7858C4.02312 5.7858 4.07561 5.7799 4.1287 5.76205ZM9.40567 5.6015C8.98147 5.60148 8.63757 5.94534 8.63755 6.36953C8.63752 6.79373 8.98138 7.13762 9.40557 7.13765L19.7319 7.13827C20.1561 7.1383 20.5 6.79444 20.5 6.37024C20.5 5.94605 20.1562 5.60215 19.732 5.60213L9.40567 5.6015ZM9.40567 11.234C8.98147 11.234 8.63757 11.5779 8.63755 12.0021C8.63752 12.4263 8.98138 12.7702 9.40557 12.7702L19.7319 12.7708C20.1561 12.7708 20.5 12.427 20.5 12.0028C20.5 11.5786 20.1562 11.2347 19.732 11.2347L9.40567 11.234ZM9.40567 16.8666C8.98147 16.8666 8.63757 17.2104 8.63755 17.6346C8.63752 18.0588 8.98138 18.4027 9.40557 18.4027L19.7319 18.4033C20.1561 18.4034 20.5 18.0595 20.5 17.6353C20.5 17.2111 20.1562 16.8672 19.732 16.8672L9.40567 16.8666ZM6.62426 11.114C6.63609 11.048 6.6419 10.9782 6.6419 10.9031C6.6419 10.2259 6.06294 9.7684 5.15573 9.7684C4.5044 9.7684 3.97971 10.045 3.78328 10.4895C3.77042 10.5192 3.76022 10.5492 3.75251 10.5798C3.76022 10.5492 3.77044 10.5191 3.78331 10.4894C3.97974 10.0449 4.50442 9.7683 5.15575 9.7683C6.06297 9.7683 6.64193 10.2258 6.64193 10.903C6.64193 10.9782 6.6361 11.048 6.62426 11.114ZM5.12474 12.7537L5.12471 12.7537V12.7744H6.30848C6.58246 12.7744 6.73753 12.9372 6.73753 13.1879C6.73753 13.2197 6.73493 13.2502 6.72981 13.2792C6.73495 13.2502 6.73756 13.2196 6.73756 13.1878C6.73756 12.9371 6.58248 12.7743 6.30851 12.7743H5.12474V12.7537ZM3.73998 12.9913C3.77464 12.8518 3.86616 12.7304 4.02368 12.5985L5.04978 11.7197C5.38832 11.4292 5.53086 11.2672 5.57304 11.0983C5.5309 11.2672 5.38836 11.4293 5.04976 11.7198L4.02365 12.5986C3.86617 12.7305 3.77466 12.8519 3.73998 12.9913ZM4.50342 11.1816C4.59839 11.1252 4.67754 11.0396 4.75422 10.9274C4.81979 10.8327 4.87897 10.7719 4.93846 10.7343C4.99601 10.6979 5.05933 10.6797 5.14025 10.6797C5.25266 10.6797 5.33878 10.7139 5.39544 10.7645C5.45119 10.8143 5.48498 10.8855 5.48498 10.9753C5.48498 11.1448 5.40603 11.2791 4.9831 11.642L3.95747 12.5204C3.73832 12.704 3.62145 12.8851 3.62145 13.1283C3.62145 13.2841 3.66578 13.4314 3.77329 13.5397C3.88112 13.6484 4.03847 13.7037 4.23562 13.7037H6.30851C6.46671 13.7037 6.60202 13.6548 6.69803 13.5592C6.79392 13.4637 6.83997 13.3323 6.83997 13.1878C6.83997 13.0412 6.79418 12.9093 6.6977 12.8141C6.60129 12.719 6.46582 12.6718 6.30851 12.6718H5.37617L5.87155 12.2443C6.15942 11.9949 6.3783 11.7967 6.52349 11.5947C6.67287 11.3868 6.74434 11.1753 6.74434 10.903C6.74434 10.5321 6.58449 10.2187 6.30157 10.0006C6.02097 9.78425 5.62548 9.66589 5.15575 9.66589C4.48013 9.66589 3.90785 9.95417 3.68934 10.4487C3.64978 10.54 3.63179 10.6341 3.63179 10.7324C3.63179 10.8869 3.68238 11.0223 3.78385 11.1187C3.8847 11.2145 4.02467 11.2613 4.18393 11.2613C4.30216 11.2613 4.40667 11.2391 4.50342 11.1816ZM3.67138 16.0785C3.82347 15.664 4.34013 15.2247 5.22801 15.2247C5.68517 15.2247 6.09277 15.3214 6.38781 15.5143C6.68486 15.7085 6.86644 15.9999 6.86644 16.3799C6.86644 16.8627 6.55828 17.1838 6.17395 17.3212C6.40817 17.3704 6.60427 17.4641 6.75036 17.5998C6.93436 17.7707 7.035 18.0045 7.035 18.2873C7.035 18.6915 6.86059 19.0236 6.54548 19.2529C6.23205 19.4811 5.78277 19.6055 5.23363 19.6055C4.27385 19.6055 3.73928 19.1473 3.59258 18.7372C3.56511 18.6608 3.55307 18.5763 3.55307 18.5092C3.55307 18.3499 3.60652 18.216 3.70785 18.1223C3.80872 18.0289 3.95152 17.9805 4.12117 17.9805C4.23774 17.9805 4.33814 17.9997 4.42613 18.0439C4.51436 18.0882 4.58653 18.1558 4.64935 18.247C4.72378 18.3559 4.79404 18.4374 4.8851 18.4925C4.97546 18.5471 5.09131 18.5788 5.26173 18.5788C5.53989 18.5788 5.7218 18.414 5.7218 18.2002C5.7218 18.0706 5.67315 17.9761 5.58111 17.9118C5.48617 17.8455 5.33953 17.8076 5.13812 17.8076H5.11003C4.96167 17.8076 4.84264 17.7662 4.76061 17.6859C4.67849 17.6054 4.64024 17.4925 4.64024 17.3631C4.64024 17.2388 4.6788 17.1269 4.76042 17.0461C4.84209 16.9653 4.96094 16.9214 5.11003 16.9214H5.13812C5.3156 16.9214 5.449 16.8827 5.53665 16.8186C5.62237 16.7559 5.66843 16.6661 5.66843 16.5512C5.66843 16.4399 5.62767 16.3529 5.5564 16.293C5.48412 16.2322 5.37547 16.1951 5.23363 16.1951C5.1199 16.1951 5.02579 16.2182 4.94752 16.2628C4.86935 16.3074 4.80383 16.3753 4.74999 16.4698C4.68013 16.5935 4.60457 16.683 4.50858 16.7408C4.41232 16.7988 4.30106 16.8216 4.16612 16.8216C3.99313 16.8216 3.85731 16.7706 3.76471 16.6781C3.67224 16.5856 3.62892 16.4576 3.62892 16.3153C3.62892 16.2303 3.64147 16.1623 3.67138 16.0785Z"
    fill="currentColor"
  />
</svg> `,todo=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H18C18.6904 4.75 19.25 5.30964 19.25 6V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6ZM16.5303 9.53033C16.8232 9.23744 16.8232 8.76256 16.5303 8.46967C16.2374 8.17678 15.7626 8.17678 15.4697 8.46967L10.5 13.4393L9.03033 11.9697C8.73744 11.6768 8.26256 11.6768 7.96967 11.9697C7.67678 12.2626 7.67678 12.7374 7.96967 13.0303L9.96967 15.0303C10.2626 15.3232 10.7374 15.3232 11.0303 15.0303L16.5303 9.53033Z"
    fill="currentColor"
  />
</svg> `,toggle=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M6 3.25C4.48122 3.25 3.25 4.48122 3.25 6V18C3.25 19.5188 4.48122 20.75 6 20.75H18C19.5188 20.75 20.75 19.5188 20.75 18V6C20.75 4.48122 19.5188 3.25 18 3.25H6ZM4.75 6C4.75 5.30964 5.30964 4.75 6 4.75H18C18.6904 4.75 19.25 5.30964 19.25 6V18C19.25 18.6904 18.6904 19.25 18 19.25H6C5.30964 19.25 4.75 18.6904 4.75 18V6ZM16.5303 9.53033C16.8232 9.23744 16.8232 8.76256 16.5303 8.46967C16.2374 8.17678 15.7626 8.17678 15.4697 8.46967L10.5 13.4393L9.03033 11.9697C8.73744 11.6768 8.26256 11.6768 7.96967 11.9697C7.67678 12.2626 7.67678 12.7374 7.96967 13.0303L9.96967 15.0303C10.2626 15.3232 10.7374 15.3232 11.0303 15.0303L16.5303 9.53033Z"
    fill="currentColor"
  />
</svg> `,text=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M3.25 4C3.25 3.58579 3.58579 3.25 4 3.25H20C20.4142 3.25 20.75 3.58579 20.75 4V6.66667C20.75 7.08088 20.4142 7.41667 20 7.41667C19.5858 7.41667 19.25 7.08088 19.25 6.66667V4.75H12.75V19.25H16C16.4142 19.25 16.75 19.5858 16.75 20C16.75 20.4142 16.4142 20.75 16 20.75H8C7.58579 20.75 7.25 20.4142 7.25 20C7.25 19.5858 7.58579 19.25 8 19.25H11.25V4.75H4.75V6.66667C4.75 7.08088 4.41421 7.41667 4 7.41667C3.58579 7.41667 3.25 7.08088 3.25 6.66667V4Z"
    fill="currentColor"
  />
</svg> `,quote=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M5 10.9655V11.0953V15.0608C5 15.6262 5.45838 16.0846 6.02382 16.0846H10.119C10.6845 16.0846 11.1429 15.6262 11.1429 15.0608V10.9655C11.1429 10.4001 10.6845 9.9417 10.119 9.9417H6.70422C7.17415 8.66255 8.40313 7.75 9.84524 7.75V6.25C7.24961 6.25 5.13069 8.29105 5.00582 10.8557C5.00197 10.8918 5 10.9284 5 10.9655ZM13 10.9655V11.0953V15.0608C13 15.6262 13.4584 16.0846 14.0238 16.0846H18.119C18.6845 16.0846 19.1429 15.6262 19.1429 15.0608V10.9655C19.1429 10.4001 18.6845 9.9417 18.119 9.9417H14.7042C15.1741 8.66255 16.4031 7.75 17.8452 7.75V6.25C15.2496 6.25 13.1307 8.29105 13.0058 10.8557C13.002 10.8918 13 10.9284 13 10.9655Z"
    fill="currentColor"
  />
</svg> `,h1=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.9256 6.5784V17.4764C17.9256 18.078 18.2564 18.4389 18.7878 18.4389C19.3292 18.4389 19.65 18.088 19.65 17.4764V5.72621C19.65 5.04445 19.1988 4.57324 18.5572 4.57324C18.1662 4.57324 17.8153 4.72363 17.1836 5.19484L15.1584 6.69871C14.7574 6.98946 14.5669 7.26016 14.5669 7.55091C14.5669 7.93189 14.8677 8.24269 15.2386 8.24269C15.4592 8.24269 15.6697 8.16248 15.9605 7.95194L17.8453 6.5784H17.9256ZM4.41998 4.90259C4.84523 4.90259 5.18996 5.24732 5.18996 5.67257V11.0239H11.3584V5.67257C11.3584 5.24732 11.7031 4.90259 12.1284 4.90259C12.5536 4.90259 12.8983 5.24732 12.8983 5.67257V11.7939V17.9153C12.8983 18.3405 12.5536 18.6853 12.1284 18.6853C11.7031 18.6853 11.3584 18.3405 11.3584 17.9153V12.5639H5.18996V17.9153C5.18996 18.3405 4.84523 18.6853 4.41998 18.6853C3.99473 18.6853 3.64999 18.3405 3.64999 17.9153V5.67257C3.64999 5.24732 3.99473 4.90259 4.41998 4.90259Z"
    fill="currentColor"
  />
</svg> `,h2=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M14.1588 15.9996C13.5966 16.6381 13.4346 16.9049 13.4346 17.2479C13.4346 17.8006 13.873 18.1342 14.5686 18.1342H20.8578C21.3819 18.1342 21.6869 17.8578 21.6869 17.4099C21.6869 16.9525 21.3629 16.6762 20.8578 16.6762H15.5691V16.5618L19.0949 12.531C20.8102 10.5775 21.2962 9.67223 21.2962 8.43344C21.2962 6.33702 19.6476 4.85046 17.3035 4.85046C14.7878 4.85046 13.2154 6.54666 13.2154 8.16662C13.2154 8.6812 13.5204 9.03378 13.9873 9.03378C14.378 9.03378 14.6448 8.77649 14.7782 8.27144C15.0641 7.03265 15.9694 6.2989 17.1986 6.2989C18.6471 6.2989 19.6095 7.19464 19.6095 8.53826C19.6095 9.434 19.1998 10.2345 18.123 11.4637L14.1588 15.9996ZM3.41871 5.36361C3.82289 5.36361 4.15055 5.69127 4.15055 6.09545V11.1818H10.0134V6.09545C10.0134 5.69127 10.341 5.36361 10.7452 5.36361C11.1494 5.36361 11.4771 5.69127 11.4771 6.09545V11.9136V17.7317C11.4771 18.1359 11.1494 18.4636 10.7452 18.4636C10.341 18.4636 10.0134 18.1359 10.0134 17.7317V12.6454H4.15055V17.7317C4.15055 18.1359 3.82289 18.4636 3.41871 18.4636C3.01452 18.4636 2.68687 18.1359 2.68687 17.7317V6.09545C2.68687 5.69127 3.01452 5.36361 3.41871 5.36361Z"
    fill="currentColor"
  />
</svg> `,h3=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M4.04957 5.85587C4.04957 5.44177 3.71388 5.10608 3.29979 5.10608C2.88569 5.10608 2.55 5.44177 2.55 5.85587V17.7775C2.55 18.1916 2.88569 18.5273 3.29979 18.5273C3.71388 18.5273 4.04957 18.1916 4.04957 17.7775V12.5665H10.0562V17.7775C10.0562 18.1916 10.3919 18.5273 10.806 18.5273C11.2201 18.5273 11.5558 18.1916 11.5558 17.7775V11.8167V5.85587C11.5558 5.44177 11.2201 5.10608 10.806 5.10608C10.3919 5.10608 10.0562 5.44177 10.0562 5.85587V11.0669H4.04957V5.85587ZM13.5289 15.0901C13.1108 15.0901 12.8162 15.3942 12.8162 15.8218C12.8162 17.2759 14.6124 18.7585 17.0643 18.7585C19.7063 18.7585 21.55 17.1999 21.55 14.976C21.55 13.3414 20.324 11.9349 18.7179 11.7543V11.6592C20.0389 11.4312 21.1128 10.0626 21.1128 8.62759C21.1128 6.65084 19.4212 5.2348 17.0453 5.2348C14.7074 5.2348 13.1203 6.66034 13.1203 8.1334C13.1203 8.60859 13.4054 8.92221 13.8426 8.92221C14.2132 8.92221 14.4508 8.72263 14.6409 8.19993C15.021 7.22106 15.8763 6.66034 17.0073 6.66034C18.4613 6.66034 19.4402 7.53468 19.4402 8.83667C19.4402 10.1387 18.4328 11.0795 17.0453 11.0795H15.9239C15.4677 11.0795 15.1636 11.3741 15.1636 11.7923C15.1636 12.201 15.4867 12.5146 15.9239 12.5146H17.1118C18.7654 12.5146 19.8774 13.4934 19.8774 14.9475C19.8774 16.4016 18.7939 17.3329 17.0928 17.3329C15.8003 17.3329 14.8119 16.7627 14.3177 15.7458C14.0707 15.2611 13.8616 15.0901 13.5289 15.0901Z"
    fill="currentColor"
  />
</svg> `,h4=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M18.7933 15.7548V17.6864C18.7933 18.2383 19.0787 18.5523 19.583 18.5523C20.0968 18.5523 20.3823 18.2383 20.3823 17.6864V15.7548H21.3719C21.9143 15.7548 22.2188 15.4884 22.2188 15.0317C22.2188 14.5654 21.9047 14.299 21.3719 14.299H20.3823V6.69626C20.3823 5.81134 19.897 5.31654 19.0311 5.31654C18.3746 5.31654 17.9369 5.602 17.3755 6.42983C15.2155 9.66503 14.3591 11.0352 12.9984 13.4426C12.6654 14.0516 12.5512 14.3846 12.5512 14.7367C12.5512 15.3647 13.046 15.7548 13.7882 15.7548H18.7933ZM18.7933 14.299H14.1498V14.2038C15.3963 12.0439 17.09 9.32248 18.7076 6.93414H18.7933V14.299ZM2.94953 5.70536C3.35312 5.70536 3.6803 6.03254 3.6803 6.43613V11.515H9.53462V6.43613C9.53462 6.03254 9.86179 5.70536 10.2654 5.70536C10.669 5.70536 10.9962 6.03254 10.9962 6.43613V12.2458V18.0555C10.9962 18.459 10.669 18.7862 10.2654 18.7862C9.86179 18.7862 9.53462 18.459 9.53462 18.0555V12.9766H3.6803V18.0555C3.6803 18.459 3.35312 18.7862 2.94953 18.7862C2.54593 18.7862 2.21875 18.459 2.21875 18.0555V6.43613C2.21875 6.03254 2.54593 5.70536 2.94953 5.70536Z"
    fill="currentColor"
  />
</svg> `,h5=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M13.6153 15.0526C13.2062 15.0526 12.9366 15.3687 12.9366 15.8335C12.9366 17.135 14.4705 18.6316 16.9246 18.6316C19.5182 18.6316 21.3682 16.8096 21.3682 14.2439C21.3682 11.8362 19.7042 10.1443 17.343 10.1443C16.2739 10.1443 15.1863 10.5905 14.768 11.2134H14.675L15.0283 7.0766H20.0388C20.5873 7.0766 20.8941 6.8256 20.8941 6.37939C20.8941 5.92388 20.578 5.6543 20.0388 5.6543H14.8237C14.0243 5.6543 13.6246 5.97966 13.5688 6.66757L13.1598 11.8734C13.1133 12.5892 13.3829 13.0075 13.9127 13.0075C14.2102 13.0075 14.3961 12.8959 15.0747 12.2638C15.6139 11.7804 16.2553 11.5387 16.9804 11.5387C18.5886 11.5387 19.7321 12.6914 19.7321 14.3275C19.7321 16.038 18.5515 17.2279 16.8596 17.2279C15.7441 17.2279 14.8888 16.6887 14.3775 15.6941C14.1358 15.22 13.9313 15.0526 13.6153 15.0526ZM3.08209 5.90389C3.47639 5.90389 3.79603 6.22353 3.79603 6.61783V11.5797H9.51545V6.61783C9.51545 6.22353 9.83509 5.90389 10.2294 5.90389C10.6237 5.90389 10.9433 6.22353 10.9433 6.61783V12.2936V17.9695C10.9433 18.3638 10.6237 18.6834 10.2294 18.6834C9.83509 18.6834 9.51545 18.3638 9.51545 17.9695V13.0076H3.79603V17.9695C3.79603 18.3638 3.47639 18.6834 3.08209 18.6834C2.6878 18.6834 2.36816 18.3638 2.36816 17.9695V6.61783C2.36816 6.22353 2.6878 5.90389 3.08209 5.90389Z"
    fill="currentColor"
  />
</svg> `,h6=x$1`<svg
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M17.6502 5.51672C14.5518 5.51672 12.8253 8.00853 12.8253 12.4975C12.8253 14.4294 13.1426 15.8759 13.7865 16.9025C14.5518 18.1064 15.8117 18.7597 17.3889 18.7597C19.9834 18.7597 21.7379 17.0145 21.7379 14.448C21.7379 12.0122 20.0767 10.3043 17.7062 10.3043C16.2503 10.3043 14.9158 11.107 14.4865 12.2455H14.4118C14.4398 8.75514 15.5411 6.92595 17.6222 6.92595C18.4528 6.92595 19.1528 7.22459 19.8247 7.8872C20.1607 8.21385 20.3567 8.3165 20.618 8.3165C21.0193 8.3165 21.3086 8.01786 21.3086 7.61656C21.3086 7.18726 20.9353 6.67397 20.3193 6.27266C19.6101 5.78737 18.6488 5.51672 17.6502 5.51672ZM17.4542 17.3598C15.8024 17.3598 14.6451 16.1746 14.6451 14.504C14.6451 12.8521 15.7744 11.6949 17.3889 11.6949C19.0501 11.6949 20.1327 12.8148 20.1327 14.5134C20.1327 16.2306 19.0594 17.3598 17.4542 17.3598ZM3.45463 5.99129C3.85047 5.99129 4.17137 6.31218 4.17137 6.70803V11.6894H9.91326V6.70803C9.91326 6.31218 10.2342 5.99129 10.63 5.99129C11.0259 5.99129 11.3467 6.31218 11.3467 6.70803V12.4061V18.1043C11.3467 18.5001 11.0259 18.821 10.63 18.821C10.2342 18.821 9.91326 18.5001 9.91326 18.1043V13.1229H4.17137V18.1043C4.17137 18.5001 3.85047 18.821 3.45463 18.821C3.05878 18.821 2.73788 18.5001 2.73788 18.1043V6.70803C2.73788 6.31218 3.05878 5.99129 3.45463 5.99129Z"
    fill="currentColor"
  />
</svg> `,getIcon=k=>{if(k.flavour==="affine:paragraph"){const _=k.type;return{text,quote,h1,h2,h3,h4,h5,h6}[_]}return k.flavour==="affine:list"?{bulleted,numbered,todo,toggle}[k.type??"bulleted"]??x$1``:x$1``};var __decorate$r=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let BlockRenderer=class extends WithDisposable(ShadowlessElement){get model(){return this.root?.page.getBlockById(this.rowId)}connectedCallback(){super.connectedCallback(),this.root=this.closest("block-suite-root")??void 0,this._disposables.addFromEvent(this,"keydown",_=>{if(_.key==="Enter"&&!_.shiftKey){_.stopPropagation(),_.preventDefault();return}if(_.key==="Backspace"&&!_.shiftKey&&!_.metaKey&&this.model?.text?.length===0){_.stopPropagation(),_.preventDefault();return}},!0)}renderIcon(){const _=this.view.header.iconColumn;if(_)return x$1` <div class="database-block-detail-header-icon">
      ${this.view.cellGetValue(this.rowId,_)}
    </div>`}render(){const _=this.model;if(_)return x$1` ${this.root?.renderModel(_)} ${this.renderIcon()} `}};BlockRenderer.styles=i$5`
    database-datasource-block-renderer {
      padding-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 4px;
      border-bottom: 1px solid var(--affine-border-color);
      font-size: var(--affine-font-base);
      line-height: var(--affine-line-height);
    }

    database-datasource-block-renderer .tips-placeholder {
      display: none;
    }

    .database-block-detail-header-icon {
      width: 20px;
      height: 20px;
      padding: 2px;
      border-radius: 4px;
      background-color: var(--affine-background-secondary-color);
    }

    .database-block-detail-header-icon svg {
      width: 16px;
      height: 16px;
    }
  `;__decorate$r([n$a({attribute:!1})],BlockRenderer.prototype,"view",void 0);__decorate$r([n$a({attribute:!1})],BlockRenderer.prototype,"rowId",void 0);BlockRenderer=__decorate$r([e$7("database-datasource-block-renderer")],BlockRenderer);class DatabaseBlockDatasource extends BaseDataSource{get page(){return this._model.page}constructor(_,y){super(),this.root=_,this._batch=0,this.slots={update:new Slot},this._model=_.page.workspace.getPage(y.pageId)?.getBlockById(y.blockId),this._model.childrenUpdated.pipe(this.slots.update)}get rows(){return this._model.children.map(_=>_.id)}get properties(){return[...this._model.columns.map(_=>_.id)]}_runCapture(){this._batch||(this._batch=requestAnimationFrame(()=>{this.page.captureSync(),this._batch=0}))}cellChangeValue(_,y,w){this._runCapture();const $=this.propertyGetType(y);if($==="title"&&typeof w=="string"){const B=this.getModelById(_)?.text;B&&B.replace(0,B.length,w),this.slots.update.emit();return}else if($==="rich-text"&&typeof w=="string"){const R=this._model.getCell(_,y)?.value;if(R){const H=new Text$1(R);H.replace(0,H.length,w)}return}this._model.columns.find(B=>B.id===y)&&(this._model.updateCell(_,{columnId:y,value:w}),this._model.applyColumnUpdate())}cellGetValue(_,y){if(y==="type"){const $=this.getModelById(_);return $?getIcon($):void 0}if(this.propertyGetType(y)==="title"){const $=this.getModelById(_);return $?$.text?.yText:void 0}return this._model.getCell(_,y)?.value}cellGetExtra(_,y){if(this.propertyGetType(y)==="title"){const w=this.getModelById(_);if(w)return{result:this.root.renderModel(w),model:w}}return super.cellGetExtra(_,y)}getModelById(_){return this._model.children[this._model.childMap.get(_)??-1]}cellGetRenderValue(_,y){return this.cellGetValue(_,y)}newColumnName(){let _=1;for(;this._model.columns.find(y=>y.name===`Column ${_}`);)_++;return`Column ${_}`}propertyAdd(_,y){return this.page.captureSync(),this._model.addColumn(_,columnManager.getColumn(y??multiSelectPureColumnConfig.type).create(this.newColumnName()))}propertyChangeData(_,y){this.page.captureSync(),this._model.updateColumn(_,()=>({data:y})),this._model.applyColumnUpdate()}propertyChangeName(_,y){this.page.captureSync(),this._model.updateColumn(_,()=>({name:y})),this._model.applyColumnUpdate()}propertyChangeType(_,y){const w=this.propertyGetType(_),$=this.propertyGetData(_),B=this.rows,R=B.map(q=>this.cellGetValue(q,_)),H=columnManager.getColumn(w)?.convertCell(y,$,R)??{column:columnManager.getColumn(y).defaultData(),cells:R.map(()=>{})};this.page.captureSync(),this._model.updateColumn(_,()=>({type:y,data:H.column}));const j={};R.forEach((q,X)=>{(q!=null||H.cells[X]!=null)&&(j[B[X]]=H.cells[X])}),this._model.updateCells(_,j),this._model.applyColumnUpdate()}propertyDelete(_){this.page.captureSync();const y=this._model.findColumnIndex(_);y<0||(this.page.transact(()=>{this._model.columns.splice(y,1)}),this._model.applyColumnUpdate())}propertyGetData(_){return this._model.columns.find(y=>y.id===_)?.data??{}}propertyGetReadonly(_){return _==="type"}propertyGetName(_){return _==="type"?"Block Type":this._model.columns.find(y=>y.id===_)?.name??""}propertyGetType(_){return _==="type"?"image":this._model.columns.find(y=>y.id===_)?.type??""}propertyDuplicate(_){this.page.captureSync();const y=this._model.getColumn(_);assertExists(y);const{id:w,...$}=y,B={...$},R=this._model.addColumn({before:!1,id:_},B);return this._model.copyCellsByColumn(w,R),this._model.applyColumnUpdate(),R}rowAdd(_){this.page.captureSync();const y=typeof _=="number"?_:insertPositionToIndex(_,this._model.children);return this.page.addBlock("affine:paragraph",{},this._model.id,y)}rowDelete(_){this.page.captureSync(),this.page.updateBlock(this._model,{children:this._model.children.filter(y=>!_.includes(y.id))})}captureSync(){this.page.captureSync()}propertyGetDefaultWidth(_){return this.propertyGetType(_)==="title"?260:super.propertyGetDefaultWidth(_)}onCellUpdate(_,y,w){return this.propertyGetType(y)==="title"?(this.getModelById(_)?.text?.yText.observe(w),{dispose:()=>{this.getModelById(_)?.text?.yText.unobserve(w)}}):this._model.propsUpdated.on(w)}get allPropertyConfig(){return[dateColumnConfig,numberColumnConfig,progressColumnConfig,selectColumnConfig,multiSelectColumnConfig,richTextColumnConfig,linkColumnConfig,checkboxColumnConfig]}get detailSlots(){return{...super.detailSlots,header:createUniComponentFromWebComponent(BlockRenderer)}}}class DatabaseSelection extends BaseSelection{constructor({path:_,viewSelection:y}){super({path:_}),this.viewSelection=y}get viewId(){return this.viewSelection.viewId}getSelection(_){return this.viewSelection.type===_?this.viewSelection:void 0}equals(_){return _ instanceof DatabaseSelection?this.blockId===_.blockId:!1}toJSON(){return{type:"database",path:this.path,viewSelection:this.viewSelection}}static fromJSON(_){return new DatabaseSelection({path:_.path,viewSelection:_.viewSelection})}}DatabaseSelection.type="database";DatabaseSelection.group="note";class KanbanViewClipboard{init(){}}class TableViewClipboard{constructor(_,y){this._root=_,this._disposables=new DisposableGroup,this._onCopy=async w=>{const $=w.get("clipboardState").raw,R=getDatabaseSelection(this._root)?.getSelection("table");if(!R)return;const H=this._view.value,j=this._model,{isEditing:q,focus:X}=R;if(q){const le=j.columns[X.columnIndex],ue=H.selection.getCellContainer(X.rowIndex,X.columnIndex);if(!($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement)){const he=cellToStringMap[le.type]?.(ue)??"",ce=new ClipboardItem$1(CLIPBOARD_MIMETYPE.TEXT,he),ge=hasNativeSelection()?getCurrentNativeRange():null;performNativeCopy$1([ce]),ge&&resetNativeSelection(ge)}return!0}const ee=getCopyedValuesFromSelection(R,j,H),te=JSON.stringify(ee),ne=setHTMLStringForSelection(te,CLIPBOARD_MIMETYPE.BLOCKSUITE_DATABASE),oe=new ClipboardItem$1(CLIPBOARD_MIMETYPE.BLOCKSUITE_DATABASE,ne),ae=copyCellsValue(R,j,H).map(le=>le.join("	")).join(`
`),re=new ClipboardItem$1(CLIPBOARD_MIMETYPE.TEXT,ae),se=hasNativeSelection()?getCurrentNativeRange():null;return performNativeCopy$1([re,oe]),se&&resetNativeSelection(se),!0},this._onPaste=w=>{const $=w.get("clipboardState").raw,B=this._view.value,R=this._model,H=this._data,q=getDatabaseSelection(this._root)?.getSelection("table");if(q){const{isEditing:X,focus:{rowIndex:ee,columnIndex:te}}=q;if(X){const he=R.columns[te];if(he.type!=="number"&&he.type!=="title"){const ce=$.clipboardData?.getData(CLIPBOARD_MIMETYPE.TEXT);if(!ce)return!0;const ge=B.selection.getCellContainer(ee,te),be=ge?.dataset.rowId,fe=ge?.dataset.columnId;assertExists(be),assertExists(fe),he.type==="rich-text"?pasteToRichText(ge,ce):H.cellUpdateValue(be,fe,ce)}return!0}const ne=$.clipboardData?.getData(CLIPBOARD_MIMETYPE.BLOCKSUITE_DATABASE);if(!ne)return!0;const oe=getSelectionFromHTMLString(CLIPBOARD_MIMETYPE.BLOCKSUITE_DATABASE,ne);if(!oe)return!0;const ie=JSON.parse(oe),ae=getTargetRangeFromSelection(q,R);let re=ae.row.start,se=ae.column.start,le=ae.row.length,ue=ae.column.length;ae.anchor&&(re=q.focus.rowIndex,se=q.focus.columnIndex,le=ie.length,ue=ie[0].length),pasteToCells(R,H,B,ie,re,se,le,ue)}return!0},this._path=y.path,this._model=y.model,this._view=y.view,this._data=y.data}init(){const{uiEventDispatcher:_}=this._root;this._disposables.add(_.add("copy",y=>getDatabaseSelection(this._root)?.getSelection("table")?(this._onCopy(y),!0):!1,{path:this._path})),this._disposables.add(_.add("paste",this._onPaste,{path:this._path}))}}function getDatabaseSelection(k){return k.selectionManager.value.find(y=>y.is("database"))}function getColumnValue(k){const _=k?.dataset.rowId;return assertExists(_),k?.column.getStringValue(_)??""}function setHTMLStringForSelection(k,_){return`<database style="display: none" data-type="${_}" data-clipboard="${k.replace(/"/g,"&quot;")}"></database>`}function getSelectionFromHTMLString(k,_){return new DOMParser().parseFromString(_,"text/html").querySelector(`database[data-type="${k}"]`)?.getAttribute("data-clipboard")}function copyCellsValue(k,_,y){const{rowsSelection:w,columnsSelection:$,focus:B}=k,R=[];if(w&&!$){const{start:H,end:j}=w,q=_.columns.findIndex(X=>X.type==="title");for(let X=H;X<=j;X++){const ee=y.selection.getCellContainer(X,q),te=cellToStringMap.title?.(ee)??"";R.push([te])}}else if(w&&$)for(let H=w.start;H<=w.end;H++){const j=[];for(let q=$.start;q<=$.end;q++){const X=_.columns[q],ee=y.selection.getCellContainer(H,q),te=cellToStringMap[X.type]?.(ee)??"";j.push(te)}R.push(j)}else if(!w&&!$&&B){const H=_.columns[B.columnIndex],j=y.selection.getCellContainer(B.rowIndex,B.columnIndex),q=cellToStringMap[H.type]?.(j)??"";R.push([q])}return R}function getCopyedValuesFromSelection(k,_,y){const{rowsSelection:w,columnsSelection:$,focus:B}=k,R=[];if(w&&!$){const{start:H,end:j}=w;for(let q=H;q<=j;q++){const X=[];for(let ee=0;ee<_.columns.length;ee++){const te=_.columns[ee],ne=y.selection.getCellContainer(q,ee),oe=cellToStringMap[te.type]?.(ne);X.push({type:te.type,value:oe})}R.push(X)}}else if(w&&$)for(let H=w.start;H<=w.end;H++){const j=[];for(let q=$.start;q<=$.end;q++){const X=_.columns[q],ee=y.selection.getCellContainer(H,q),te=cellToStringMap[X.type]?.(ee);j.push({type:X.type,value:te})}R.push(j)}else if(!w&&!$&&B){const H=y.selection.getCellContainer(B.rowIndex,B.columnIndex),j=_.columns[B.columnIndex],q=cellToStringMap[j.type]?.(H);R.push([{type:j.type,value:q}])}return R}function getTargetRangeFromSelection(k,_){const{rowsSelection:y,columnsSelection:w,focus:$}=k;let B={row:{start:0,end:0,length:0},column:{start:0,end:0,length:0}};return y&&!w?(B={row:{start:y.start,end:y.end,length:y.end-y.start+1},column:{start:0,end:_.columns.length-1,length:_.columns.length}},y.start===y.end&&(B.anchor=!0)):y&&w?B={row:{start:y.start,end:y.end,length:y.end-y.start+1},column:{start:w.start,end:w.end,length:w.end-w.start+1}}:!y&&!w&&$&&(B={anchor:!0,row:{start:$.rowIndex,end:$.rowIndex,length:1},column:{start:$.columnIndex,end:$.columnIndex,length:1}}),B}function pasteToRichText(k,_){const y=k?.querySelector("affine-database-rich-text-cell-editing"),w=y?.vEditor?.getVRange(),$=y?.vEditor?.yText;if($){const B=new Text$1($),R=w?.index??$.length;B.insert(_,R),y?.vEditor?.setVRange({index:R+_.length,length:0})}}function pasteToCells(k,_,y,w,$,B,R,H){const j=w,q=j.length,X=j[0].length;k.page.captureSync();for(let ee=0;ee<R;ee++)for(let te=0;te<H;te++){const ne=$+ee,oe=B+te,ie=ee%q,ae=te%X,re=j[ie][ae],se=y.selection.getCellContainer(ne,oe),le=se?.dataset.rowId,ue=se?.dataset.columnId;if(le&&ue){const he=se?.column.setValueFromString(re.value);_.cellUpdateValue(le,ue,he)}}}const cellToStringMap={"rich-text":k=>{const _=k?.querySelector("affine-database-rich-text-cell-editing"),y=getColumnValue(k),w=_?.vEditor?.getVRange();if(w){const $=w.index,B=w.index+w.length;return y?.slice($,B)??""}return y??""},title:k=>{const _=k?.querySelector("data-view-header-area-text-editing"),y=getColumnValue(k),w=_?.vEditor?.getVRange();if(w){const $=w.index,B=w.index+w.length;return y?.slice($,B)??""}return y??""},date:k=>getColumnValue(k),number:k=>getColumnValue(k),select:k=>getColumnValue(k),"multi-select":k=>getColumnValue(k),progress:k=>getColumnValue(k),link:k=>getColumnValue(k),checkbox:k=>getColumnValue(k)},headerRenderer={view:map(createFromBaseCellRenderer(HeaderAreaTextCell),k=>({...k,showIcon:!0})),edit:map(createFromBaseCellRenderer(HeaderAreaTextCellEditing),k=>({...k,showIcon:!0}))};class DataViewTableManager extends BaseDataViewManager{get type(){return this.view.mode}constructor(_,y){super(y),this.viewSource=_,this.updateView=w=>{this.syncView(),_.updateView(w)},_.updateSlot.pipe(this.slots.update)}get view(){return this.viewSource.view}get filter(){return this.view.filter}get id(){return this.view.id}get name(){return this.view.name}updateFilter(_){this.updateView(()=>({filter:_}))}updateName(_){this.updateView(()=>({name:_}))}syncView(){this.view.columns.length!==this.columns.length&&this.viewSource.updateView(_=>({columns:this.columnsWithoutFilter.map(y=>{const w=this.columnGet(y);return{id:w.id,hide:w.hide,width:w.width}})}))}columnGet(_){return new DataViewTableColumnManager(_,this)}columnGetWidth(_){return this.view.columns.find(y=>y.id===_)?.width??this.dataSource.propertyGetDefaultWidth(_)}columnMove(_,y){this.updateView(w=>{const $=w.columns.findIndex(j=>j.id===_);if($<0)return{};const B=[...w.columns],[R]=B.splice($,1),H=insertPositionToIndex(y,B);return B.splice(H,0,R),{columns:B}})}columnUpdateWidth(_,y){this.updateView(w=>({columns:w.columns.map($=>$.id===_?{...$,width:y}:$)}))}get columns(){return this.columnsWithoutFilter.filter(_=>!this.columnGetHide(_))}get detailColumns(){return this.columnsWithoutFilter.filter(_=>this.columnGetType(_)!=="title")}get columnsWithoutFilter(){const _=new Set(this.dataSource.properties),y=[];return this.view.columns.forEach(w=>{_.has(w.id)&&(y.push(w.id),_.delete(w.id))}),y.push(..._),y}get readonly(){return this.viewSource.readonly}isShow(_){if(this.filter.conditions.length){const y=Object.fromEntries(this.columnManagerList.map(w=>[w.id,w.getJsonValue(_)]));return evalFilter(this.filter,y)}return!0}columnUpdateHide(_,y){this.updateView(w=>({columns:w.columns.map($=>$.id===_?{...$,hide:y}:$)}))}columnGetHide(_){return this.view.columns.find(y=>y.id===_)?.hide??!1}deleteView(){this.viewSource.delete()}get isDeleted(){return this.viewSource.isDeleted()}get header(){return this.view.header??{titleColumn:this.columnsWithoutFilter.find(_=>this.columnGetType(_)==="title"),iconColumn:"type"}}isInHeader(_){return Object.values(this.header).some(y=>y===_)}hasHeader(_){return Object.values(this.header).some(y=>this.cellGetValue(_,y))}}class DataViewTableColumnManager extends BaseDataViewColumnManager{constructor(_,y){super(_,y),this.dataViewManager=y}get width(){return this.dataViewManager.columnGetWidth(this.id)}updateWidth(_){this.dataViewManager.columnUpdateWidth(this.id,_)}get renderer(){return this.id===this.dataViewManager.header.titleColumn?headerRenderer:super.renderer}}var __decorate$q=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DatabaseBlockComponent=class extends BlockElement{constructor(){super(...arguments),this._view=e$1(),this._setViewId=_=>{this.currentView!==_&&(this.service?.selectionManager.setGroup("note",[]),requestAnimationFrame(()=>{this.currentView=_,requestAnimationFrame(()=>{this.requestUpdate()})}))},this.viewMap={},this.getViewDataById=_=>this.model.views.find(y=>y.id===_),this.focusFirstCell=()=>{this._view.value?.focusFirstCell()},this.renderViews=()=>n$5` <data-view-header-views
      style="flex:1"
      .currentView="${this.currentView}"
      .setViewId="${this._setViewId}"
      .model="${this.model}"
    ></data-view-header-views>`,this.renderTitle=()=>{const _=()=>this._view.value?.addRow?.("start");return n$5` <affine-database-title
      .titleText="${this.model.title}"
      .readonly="${this.model.page.readonly}"
      .onPressEnterKey="${_}"
    ></affine-database-title>`},this.renderReference=()=>n$5` <div></div>`,this.renderTools=_=>{if(!(!_||!this._view.value))return n$5` <data-view-header-tools
      .viewEle="${this._view.value}"
      .view="${_}"
    ></data-view-header-tools>`}}connectedCallback(){super.connectedCallback(),this._disposables.add(this.root.selectionManager.slots.changed.on(_=>{const y=_.find(w=>PathFinder.equals(w.path,this.path)?w instanceof DatabaseSelection:!1);Object.entries(this.viewMap).forEach(([w,$])=>{if(!y||y.viewId!==w){$.selectionUpdated.emit(void 0);return}$.selectionUpdated.emit(y?.viewSelection)})})),this._disposables.add(this.model.propsUpdated.on(()=>{this.model.views.forEach(_=>{this.viewMap[_.id]?.viewUpdated.emit()})})),this.handleEvent("selectionChange",()=>!!this.service?.selectionManager.value.find(y=>PathFinder.equals(y.path,this.path))),requestAnimationFrame(()=>{this.requestUpdate()})}firstUpdated(){requestAnimationFrame(()=>{this.requestUpdate()})}get dataSource(){return this._dataSource||(this._dataSource=new DatabaseBlockDatasource(this.root,{type:"database-block",pageId:this.root.page.id,blockId:this.model.id})),this._dataSource}viewSource(_,y){const w=this.getViewDataById,$=this.model;return{get readonly(){return $.page.readonly},get view(){const B=w(_);if(!B)throw new Error(`view ${_} not found`);return B},updateView:B=>{this.model.updateView(_,B)},delete:()=>{this.model.deleteView(_),this.model.applyColumnUpdate()},isDeleted:()=>!w(_),updateSlot:y}}getView(_){if(!this.viewMap[_]){const y=new Slot,w=new{table:DataViewTableManager,kanban:DataViewKanbanManager}[this.getViewDataById(_)?.mode??"table"](this.viewSource(_,y),this.dataSource);this.viewMap[_]={view:w,viewUpdated:y,selectionUpdated:new Slot,setSelection:B=>{if(!B){this.root.selectionManager.setGroup("note",[]);return}const R=this.root.selectionManager.getInstance("database",{path:this.path,viewSelection:B});this.root.selectionManager.setGroup("note",[R])},handleEvent:(B,R)=>({dispose:this.root.uiEventDispatcher.add(B,H=>{if(this.currentView===_)return R(H)},{path:this.path})}),bindHotkey:B=>({dispose:this.root.uiEventDispatcher.bindHotkey(Object.fromEntries(Object.entries(B).map(([R,H])=>[R,j=>{if(this.currentView===_)return H(j)}])),{path:this.path})})},new{table:TableViewClipboard,kanban:KanbanViewClipboard}[this.getViewDataById(_)?.mode??"table"](this.root,{path:this.path,model:this.model,view:this._view,data:w}).init()}return this.viewMap[_]}renderView(_){if(!_)return;const y={titleText:this.model.title,selectionUpdated:_.selectionUpdated,setSelection:_.setSelection,bindHotkey:_.bindHotkey,handleEvent:_.handleEvent,view:_.view,modalMode:this.modalMode,getFlag:this.page.awarenessStore.getFlag.bind(this.page.awarenessStore)};return i(_.view.id,renderUniLit(viewRendererManager.getView(_.view.type).view,y,{ref:this._view}))}render(){const _=this.model.views.map(w=>this.getView(w.id)).find(w=>w.view.id===this.currentView);if(!_&&this.model.views.length!==0){this.currentView=this.model.views[0].id;return}const y=o$3({"toolbar-hover-container":!0,"data-view-root":!0,"database-block-selected":this.selected?.type==="block"});return n$5`
      <div class="${y}">
        <div
          style="margin-bottom: 16px;display:flex;flex-direction: column;gap: 8px"
        >
          <div style="display:flex;align-items:center;gap:12px;padding: 0 6px;">
            ${this.renderTitle()} ${this.renderReference()}
          </div>
          <div
            style="display:flex;align-items:center;justify-content: space-between;gap: 12px"
          >
            ${this.renderViews()} ${this.renderTools(_?.view)}
          </div>
        </div>
        ${this.renderView(_)}
      </div>
    `}};DatabaseBlockComponent.styles=i$5`
    ${r$2(dataViewCssVariable("affine-database"))}
    affine-database {
      display: block;
      border-radius: 8px;
      background-color: var(--affine-background-primary-color);
      padding: 8px;
      margin: 8px -8px -8px;
    }

    .database-block-selected {
      background-color: var(--affine-hover-color);
      border-radius: 4px;
    }
  `;__decorate$q([n$a({attribute:!1})],DatabaseBlockComponent.prototype,"modalMode",void 0);__decorate$q([t$2()],DatabaseBlockComponent.prototype,"currentView",void 0);DatabaseBlockComponent=__decorate$q([e$7("affine-database")],DatabaseBlockComponent);function extractCssVariables(k){const _=window.getComputedStyle(k);return VARIABLES.reduce((w,$)=>{const B=_.getPropertyValue($).trim();return w[$]=B,$==="--affine-palette-transparent"&&!B&&(w[$]="#00000000"),w},{})}class ThemeObserver extends Slot{constructor(){super(...arguments),this._mode="",this._cssVariables=null}get cssVariables(){return this._cssVariables}observer(_){this._observer?.disconnect(),this._cssVariables=extractCssVariables(_),this._observer=new MutationObserver(()=>{const y=_.getAttribute("data-theme");this._mode!==y&&(this._cssVariables=extractCssVariables(_),this.emit(this._cssVariables))}),this._observer.observe(_,{attributes:!0,attributeFilter:["data-theme"]})}dispose(){super.dispose(),this._observer?.disconnect()}}const renameStyles=i$5`
  .affine-attachment-rename-container {
    position: relative;
    display: flex;
    align-items: center;
    gap: 12px;
    width: 340px;

    font-family: var(--affine-font-family);
    color: var(--affine-text-primary-color);
    border-radius: 8px;
    padding: 12px;
    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    z-index: var(--affine-z-index-popover);
  }

  .affine-attachment-rename-input-wrapper {
    flex: 1;
    display: flex;
    align-items: center;
    padding: 4px 10px;
    gap: 8px;

    border-radius: 8px;
    border: var(--affine-border-color) solid 1px;
  }

  .affine-attachment-rename-input-wrapper input {
    width: 100%;
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
  }

  .affine-attachment-rename-extension {
    font-size: var(--affine-font-xs);
    color: var(--affine-text-secondary-color);
  }

  .affine-attachment-rename-overlay-mask {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: var(--affine-z-index-popover);
  }
`,moreMenuStyles=i$5`
  .affine-attachment-options-more {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--affine-text-primary-color);

    border-radius: 8px;
    padding: 8px;
    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
  }

  .affine-attachment-options-more icon-button {
    display: flex;
    align-items: center;
    padding: 8px;
    gap: 8px;
  }

  .affine-attachment-options-more icon-button:hover.danger {
    background: var(--affine-background-error-color);
    fill: var(--affine-error-color);
    color: var(--affine-error-color);
  }
`,styles$5=i$5`
  .affine-attachment-options {
    display: flex;
    align-items: center;
    padding: 8px;
    gap: 8px;
    border-radius: 8px;
    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    z-index: var(--affine-z-index-popover);
  }

  /* hover guardian */
  .affine-attachment-options::before {
    position: absolute;
    content: ' ';
    left: 0;
    top: 0;
    transform: translateY(-100%);
    width: 100%;
    height: 4px;
  }
  .affine-attachment-options::after {
    position: absolute;
    content: ' ';
    left: 0;
    bottom: 0;
    transform: translateY(100%);
    width: 100%;
    height: 4px;
  }

  .affine-attachment-options .divider {
    width: 1px;
    height: 24px;
    background-color: var(--affine-border-color);
  }

  .affine-attachment-options > div[hidden],
  icon-button[hidden] {
    display: none;
  }

  ${tooltipStyle}
`,MoreMenu=({ref:k,model:_,abortController:y})=>{const w=_.page.readonly;return x$1`<style>
      ${moreMenuStyles}
    </style>
    <div ${n$2(k)} class="affine-attachment-options-more">
      <icon-button
        width="126px"
        height="32px"
        text="Download"
        @click="${()=>downloadAttachment(_)}"
      >
        ${DownloadIcon}
      </icon-button>
      <icon-button
        width="126px"
        height="32px"
        text="Duplicate"
        ?disabled=${w}
        @click="${()=>{const $={flavour:"affine:attachment",...cloneAttachmentProperties(_)};_.page.addSiblingBlocks(_,[$])}}"
      >
        ${DuplicateIcon}
      </icon-button>
      <icon-button
        width="126px"
        height="32px"
        text="Delete"
        class="danger"
        ?disabled=${w}
        @click="${()=>{_.page.deleteBlock(_),y.abort()}}"
      >
        ${DeleteIcon}
      </icon-button>
    </div>`},RenameModal=({model:k,abortController:_})=>{const y=e$1(),w=k.name,$=w.slice(0,w.lastIndexOf(".")),B=w.slice(w.lastIndexOf(".")),R=B.length<=7&&w.length>B.length;let H=R?$:w;const j=R?B:"",q=()=>{const te=H+j;if(!te){toast("File name cannot be empty");return}k.page.updateBlock(k,{name:te}),_.abort()},X=te=>{H=te.target.value},ee=te=>{te.stopPropagation(),te.key==="Enter"&&!te.isComposing&&(te.preventDefault(),q())};return x$1`
    <style>
      ${renameStyles}
    </style>
    <div
      class="affine-attachment-rename-overlay-mask"
      @click="${()=>_.abort()}"
    ></div>
    <div ${n$2(y)} class="affine-attachment-rename-container">
      <div class="affine-attachment-rename-input-wrapper">
        <input
          autofocus
          type="text"
          .value=${H}
          @input=${X}
          @keydown=${ee}
        />
        <span class="affine-attachment-rename-extension">${j}</span>
      </div>
      <icon-button class="affine-confirm-button" @click=${q}
        >${ConfirmIcon}</icon-button
      >
    </div>
  `};function AttachmentOptionsTemplate({anchor:k,model:_,showCaption:y,abortController:w}){const{onHover:$,onHoverLeave:B}=createDelayHoverSignal(w);k.addEventListener("mouseover",$),k.addEventListener("mouseleave",B),w.signal.addEventListener("abort",()=>{k.removeEventListener("mouseover",$),k.removeEventListener("mouseleave",B)});const R=e$1(),H=!_.type?.startsWith("image/"),j=_.page.readonly;let q=null;return x$1`<style>
      ${styles$5}
    </style>

    <div
      ${n$2(R)}
      class="affine-attachment-options"
      @pointerdown=${stopPropagation}
      @mouseover=${$}
      @mouseleave=${B}
    >
      <icon-button class="has-tool-tip" size="24px" disabled ?hidden=${!0}>
        ${ViewIcon}
        <tool-tip inert tip-position="top" role="tooltip">Preview</tool-tip>
      </icon-button>
      <div class="divider" ?hidden=${!0}></div>

      <icon-button
        class="has-tool-tip"
        size="24px"
        ?disabled=${j}
        ?hidden=${!0}
      >
        ${LinkIcon}
        <tool-tip inert tip-position="top" role="tooltip"
          >Turn into Link view</tool-tip
        >
      </icon-button>
      <icon-button
        class="has-tool-tip"
        size="24px"
        ?disabled=${j}
        ?hidden=${H}
        @click="${()=>{turnIntoEmbedView(_),w.abort()}}"
      >
        ${EmbedWebIcon}
        <tool-tip inert tip-position="top" role="tooltip"
          >Turn into Embed view</tool-tip
        >
      </icon-button>
      <div class="divider" ?hidden=${H}></div>

      <icon-button
        class="has-tool-tip"
        size="24px"
        ?disabled=${j}
        @click="${()=>{w.abort();const X=new AbortController;createLitPortal({template:RenameModal({model:_,abortController:X}),computePosition:{referenceElement:k,placement:"top-end",middleware:[flip(),offset$1(4)]},abortController:X})}}"
      >
        ${EditIcon}
        <tool-tip inert tip-position="top" role="tooltip">Rename</tool-tip>
      </icon-button>
      <icon-button
        class="has-tool-tip"
        size="24px"
        ?disabled=${j}
        @click=${()=>{y()}}
      >
        ${CaptionIcon}
        <tool-tip inert tip-position="top" role="tooltip">Caption</tool-tip>
      </icon-button>
      <div class="divider"></div>
      <icon-button
        size="24px"
        class="has-tool-tip more-button"
        @click=${()=>{if(q){q.abort(),q=null;return}q=new AbortController;const X=R.value;assertExists(X),createLitPortal({container:X,template:MoreMenu({model:_,abortController:w}),abortController:q,computePosition:{referenceElement:X,placement:"top-end",middleware:[flip(),offset$1(4)]}})}}
      >
        ${MoreIcon}
        <tool-tip inert role="tooltip">More</tool-tip>
      </icon-button>
    </div>`}const styles$4=i$5`
  .affine-attachment-container {
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 16px 24px;
    margin-top: calc(var(--affine-paragraph-space) + 8px);

    border-radius: 12px;
    border: 3px solid var(--affine-background-overlay-panel-color);
    background: var(--affine-card-background-blue);
    box-shadow: var(--affine-shadow-1);
    cursor: pointer;
  }

  .affine-attachment-name {
    display: flex;
    align-items: center;
    gap: 8px;

    color: var(--affine-text-primary-color);
    font-size: var(--affine-font-sm);
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
    fill: var(--affine-icon-color);
    user-select: none;
  }

  .affine-attachment-desc {
    color: var(--affine-text-secondary-color);
    font-size: var(--affine-font-xs);
    user-select: none;
  }

  .affine-attachment-banner {
    position: absolute;
    display: flex;
    right: 24px;
    bottom: 0;
  }

  .affine-attachment-loading {
    display: flex;
    align-items: center;
    gap: 8px;

    color: var(--affine-placeholder-color);
    font-size: var(--affine-font-sm);
    font-weight: 600;
    fill: var(--affine-icon-color);
    user-select: none;
  }

  .affine-attachment-caption {
    width: 100%;
    font-size: var(--affine-font-sm);
    outline: none;
    border: 0;
    font-family: inherit;
    text-align: center;
    color: var(--affine-icon-color);
    background: var(--affine-background-primary-color);
  }
  .affine-attachment-caption::placeholder {
    color: var(--affine-placeholder-color);
  }
`,LoadingIcon=x$1`<svg
  width="16"
  height="16"
  viewBox="0 0 16 16"
  xmlns="http://www.w3.org/2000/svg"
>
  <style xmlns="http://www.w3.org/2000/svg">
    .spinner {
      transform-origin: center;
      animation: spinner_animate 0.75s infinite linear;
    }
    @keyframes spinner_animate {
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
  <path
    d="M14.6666 7.99992C14.6666 11.6818 11.6818 14.6666 7.99992 14.6666C4.31802 14.6666 1.33325 11.6818 1.33325 7.99992C1.33325 4.31802 4.31802 1.33325 7.99992 1.33325C11.6818 1.33325 14.6666 4.31802 14.6666 7.99992ZM3.30003 7.99992C3.30003 10.5956 5.40424 12.6998 7.99992 12.6998C10.5956 12.6998 12.6998 10.5956 12.6998 7.99992C12.6998 5.40424 10.5956 3.30003 7.99992 3.30003C5.40424 3.30003 3.30003 5.40424 3.30003 7.99992Z"
    fill-opacity="0.1"
  />
  <path
    d="M13.6833 7.99992C14.2263 7.99992 14.674 7.55732 14.5942 7.02014C14.5142 6.48171 14.3684 5.95388 14.1591 5.4487C13.8241 4.63986 13.333 3.90493 12.714 3.28587C12.0949 2.66682 11.36 2.17575 10.5511 1.84072C10.046 1.63147 9.51812 1.48564 8.9797 1.40564C8.44251 1.32583 7.99992 1.77351 7.99992 2.31659C7.99992 2.85967 8.44486 3.28962 8.9761 3.40241C9.25681 3.46201 9.53214 3.54734 9.79853 3.65768C10.3688 3.89388 10.8869 4.24008 11.3233 4.67652C11.7598 5.11295 12.106 5.63108 12.3422 6.20131C12.4525 6.4677 12.5378 6.74303 12.5974 7.02374C12.7102 7.55498 13.1402 7.99992 13.6833 7.99992Z"
    fill="#1E96EB"
    class="spinner"
  />
</svg>`,AttachmentBannerLight=x$1`<svg
  width="90"
  height="67"
  viewBox="0 0 90 67"
  xmlns="http://www.w3.org/2000/svg"
>
  <g filter="url(#filter0_d_2804_28633)">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M55.8256 13.2652C56.0233 11.8523 55.0434 10.546 53.6371 10.3475L20.5338 5.67357C18.4243 5.37573 16.4739 6.85229 16.1774 8.97157L6.51483 78.0428C6.21836 80.162 7.68812 82.1215 9.79763 82.4193L69.6381 90.8683C71.7476 91.1662 73.6981 89.6896 73.9945 87.5703L79.8994 45.3601C80.0971 43.9473 79.1172 42.641 77.7109 42.4424L59.8861 39.9257C55.6671 39.33 52.7276 35.4111 53.3205 31.1725L55.8256 13.2652ZM26.8035 44.3852C26.9517 43.3256 27.9269 42.5873 28.9817 42.7363L60.8117 47.2304C61.8665 47.3793 62.6014 48.359 62.4531 49.4187C62.3049 50.4783 61.3297 51.2166 60.2749 51.0677L28.4449 46.5735C27.3901 46.4246 26.6552 45.4449 26.8035 44.3852ZM27.4607 53.6086C26.406 53.4596 25.4308 54.1979 25.2825 55.2576C25.1343 56.3172 25.8692 57.2969 26.9239 57.4459L58.754 61.94C59.8087 62.0889 60.7839 61.3506 60.9322 60.291C61.0804 59.2314 60.3455 58.2516 59.2908 58.1027L27.4607 53.6086Z"
      fill="url(#paint0_linear_2804_28633)"
      shape-rendering="crispEdges"
    />
    <path
      d="M62.3244 14.341C61.4678 13.199 59.6644 13.6675 59.4663 15.0836L57.1401 31.7118C56.8436 33.8311 58.3134 35.7906 60.4229 36.0884L76.9745 38.4254C78.384 38.6244 79.3295 37.012 78.4728 35.87L62.3244 14.341Z"
      fill="url(#paint1_linear_2804_28633)"
      shape-rendering="crispEdges"
    />
  </g>
  <defs>
    <filter
      id="filter0_d_2804_28633"
      x="1.47681"
      y="0.635498"
      width="83.448"
      height="95.271"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="2.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.08 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_2804_28633"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_2804_28633"
        result="shape"
      />
    </filter>
    <linearGradient
      id="paint0_linear_2804_28633"
      x1="50.4541"
      y1="9.89806"
      x2="39.6202"
      y2="86.63"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0.2" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_2804_28633"
      x1="50.4541"
      y1="9.89806"
      x2="39.6202"
      y2="86.63"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0.2" />
    </linearGradient>
  </defs>
</svg>`,AttachmentBannerDark=x$1`<svg
  xmlns="http://www.w3.org/2000/svg"
  width="91"
  height="67"
  viewBox="0 0 91 67"
  fill="none"
>
  <g filter="url(#filter0_d_5306_36117)">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M56.6675 13.2652C56.866 11.8523 55.8816 10.546 54.4688 10.3475L21.2123 5.67357C19.093 5.37573 17.1335 6.85229 16.8357 8.97157L7.12838 78.0428C6.83054 80.162 8.3071 82.1215 10.4264 82.4193L70.5439 90.8683C72.6632 91.1662 74.6226 89.6896 74.9205 87.5703L80.8527 45.3601C81.0513 43.9473 80.0669 42.641 78.6541 42.4424L60.7467 39.9257C56.5082 39.33 53.555 35.4111 54.1507 31.1725L56.6675 13.2652ZM27.511 44.3852C27.6599 43.3256 28.6396 42.5873 29.6993 42.7363L61.6767 47.2304C62.7363 47.3793 63.4746 48.359 63.3257 49.4187C63.1767 50.4783 62.197 51.2166 61.1374 51.0677L29.16 46.5735C28.1003 46.4246 27.362 45.4449 27.511 44.3852ZM28.1712 53.6086C27.1116 53.4597 26.1319 54.1979 25.983 55.2576C25.834 56.3172 26.5723 57.2969 27.632 57.4459L59.6094 61.94C60.669 62.0889 61.6487 61.3506 61.7976 60.291C61.9466 59.2314 61.2083 58.2516 60.1487 58.1027L28.1712 53.6086Z"
      fill="url(#paint0_linear_5306_36117)"
      fill-opacity="0.16"
      shape-rendering="crispEdges"
    />
    <path
      d="M63.1963 14.341C62.3357 13.199 60.524 13.6675 60.325 15.0836L57.988 31.7118C57.6902 33.8311 59.1667 35.7906 61.286 36.0884L77.9143 38.4254C79.3303 38.6244 80.2801 37.012 79.4195 35.87L63.1963 14.341Z"
      fill="url(#paint1_linear_5306_36117)"
      fill-opacity="0.16"
      shape-rendering="crispEdges"
    />
  </g>
  <defs>
    <filter
      id="filter0_d_5306_36117"
      x="2.09021"
      y="0.635498"
      width="83.788"
      height="95.271"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="2.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.08 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_5306_36117"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_5306_36117"
        result="shape"
      />
    </filter>
    <linearGradient
      id="paint0_linear_5306_36117"
      x1="51.271"
      y1="9.89806"
      x2="40.4851"
      y2="86.6438"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="white" />
      <stop offset="1" stop-color="#777777" stop-opacity="0" />
    </linearGradient>
    <linearGradient
      id="paint1_linear_5306_36117"
      x1="51.271"
      y1="9.89806"
      x2="40.4851"
      y2="86.6438"
      gradientUnits="userSpaceOnUse"
    >
      <stop stop-color="white" />
      <stop offset="1" stop-color="#777777" stop-opacity="0" />
    </linearGradient>
  </defs>
</svg>`,AttachmentBanner=()=>queryCurrentMode()==="dark"?AttachmentBannerDark:AttachmentBannerLight,ErrorBannerLight=x$1`<svg
  xmlns="http://www.w3.org/2000/svg"
  width="90"
  height="67"
  viewBox="0 0 90 67"
  fill="none"
>
  <g filter="url(#filter0_d_5306_36148)">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M41.2256 8.42193L48.7032 23.7281L34.7987 39.9427L37.6963 43.7936L29.2604 42.602C28.2056 42.453 27.2304 43.1913 27.0821 44.2509C26.9338 45.3105 27.6686 46.2903 28.7233 46.4393L40.991 48.1721L44.5772 52.9381L43.1938 55.6573L27.7387 53.4743C26.684 53.3253 25.7087 54.0635 25.5604 55.1231C25.4121 56.1828 26.147 57.1625 27.2017 57.3115L41.3365 59.3081L36.1886 69.4269L39.6425 86.4606L10.0739 82.284C7.96442 81.986 6.49478 80.0264 6.79138 77.9072L16.4581 8.83657C16.7547 6.71732 18.7052 5.24087 20.8147 5.53884L41.2256 8.42193ZM53.9296 28.6836L41.7299 40.9218L43.7473 44.6484L61.0901 47.0981C62.1449 47.2471 62.8797 48.2268 62.7314 49.2865C62.5831 50.3461 61.6078 51.0843 60.5531 50.9353L46.0411 48.8855L48.5379 53.4976L47.0729 56.2053L59.5685 57.9703C60.6233 58.1193 61.3581 59.0991 61.2098 60.1587C61.0615 61.2183 60.0862 61.9565 59.0315 61.8076L45.1059 59.8405L39.6542 69.9165L40.7424 86.616L69.9139 90.7365C72.0234 91.0345 73.9739 89.5581 74.2705 87.4388L80.178 45.229C80.3757 43.8161 79.3959 42.5098 77.9896 42.3111L60.1649 39.7933C55.9459 39.1974 53.0067 35.2783 53.5999 31.0398L53.9296 28.6836ZM59.7466 14.9512C59.9448 13.5352 61.7482 13.0667 62.6048 14.2088L78.7519 35.7387C79.6085 36.8808 78.663 38.4931 77.2534 38.294L60.702 35.9561C58.5925 35.6581 57.1228 33.6986 57.4194 31.5793L59.7466 14.9512Z"
      fill="#E6E6E6"
    />
  </g>
  <defs>
    <filter
      id="filter0_d_5306_36148"
      x="1.7533"
      y="0.500732"
      width="83.4501"
      height="95.2739"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="2.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.08 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_5306_36148"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_5306_36148"
        result="shape"
      />
    </filter>
  </defs>
</svg>`,ErrorBannerDark=x$1`<svg
  xmlns="http://www.w3.org/2000/svg"
  width="90"
  height="67"
  viewBox="0 0 90 67"
  fill="none"
>
  <g filter="url(#filter0_d_5306_36172)">
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M41.2257 8.42193L48.7033 23.7281L34.7988 39.9427L37.6964 43.7936L29.2604 42.602C28.2057 42.453 27.2304 43.1913 27.0821 44.2509C26.9338 45.3105 27.6686 46.2903 28.7234 46.4393L40.991 48.1721L44.5773 52.9381L43.1939 55.6573L27.7388 53.4743C26.6841 53.3253 25.7088 54.0635 25.5605 55.1231C25.4122 56.1828 26.147 57.1625 27.2018 57.3115L41.3366 59.3081L36.1886 69.4269L39.6425 86.4606L10.074 82.284C7.96449 81.986 6.49485 80.0264 6.79145 77.9072L16.4582 8.83657C16.7548 6.71732 18.7053 5.24087 20.8148 5.53884L41.2257 8.42193ZM53.9297 28.6836L41.73 40.9218L43.7474 44.6484L61.0902 47.0981C62.1449 47.2471 62.8798 48.2268 62.7315 49.2865C62.5832 50.3461 61.6079 51.0843 60.5532 50.9353L46.0412 48.8855L48.538 53.4976L47.0729 56.2053L59.5686 57.9703C60.6233 58.1193 61.3581 59.0991 61.2098 60.1587C61.0615 61.2183 60.0863 61.9565 59.0315 61.8076L45.106 59.8405L39.6542 69.9165L40.7424 86.616L69.9139 90.7365C72.0234 91.0345 73.974 89.5581 74.2706 87.4388L80.178 45.229C80.3758 43.8161 79.396 42.5098 77.9897 42.3111L60.165 39.7933C55.946 39.1974 53.0067 35.2783 53.5999 31.0398L53.9297 28.6836ZM59.7467 14.9512C59.9449 13.5352 61.7483 13.0667 62.6048 14.2088L78.752 35.7387C79.6085 36.8808 78.663 38.4931 77.2535 38.294L60.702 35.9561C58.5925 35.6581 57.1229 33.6986 57.4195 31.5793L59.7467 14.9512Z"
      fill="#181818"
      fill-opacity="0.8"
      shape-rendering="crispEdges"
    />
  </g>
  <defs>
    <filter
      id="filter0_d_5306_36172"
      x="1.75342"
      y="0.500732"
      width="83.45"
      height="95.2739"
      filterUnits="userSpaceOnUse"
      color-interpolation-filters="sRGB"
    >
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix
        in="SourceAlpha"
        type="matrix"
        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
        result="hardAlpha"
      />
      <feOffset />
      <feGaussianBlur stdDeviation="2.5" />
      <feComposite in2="hardAlpha" operator="out" />
      <feColorMatrix
        type="matrix"
        values="0 0 0 0 0.258824 0 0 0 0 0.254902 0 0 0 0 0.286275 0 0 0 0.08 0"
      />
      <feBlend
        mode="normal"
        in2="BackgroundImageFix"
        result="effect1_dropShadow_5306_36172"
      />
      <feBlend
        mode="normal"
        in="SourceGraphic"
        in2="effect1_dropShadow_5306_36172"
        result="shape"
      />
    </filter>
  </defs>
</svg>`,ErrorBanner=()=>queryCurrentMode()==="dark"?ErrorBannerDark:ErrorBannerLight;var __decorate$p=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AttachmentBlockComponent=class extends BlockElement{constructor(){super(...arguments),this._showCaption=!1,this._error=!1,this._optionsPortal=null,this._onHover=()=>{if(this._optionsPortal?.isConnected)return;const _=new AbortController;this._optionsPortal=createLitPortal({template:AttachmentOptionsTemplate({anchor:this,model:this.model,showCaption:()=>{this._showCaption=!0,requestAnimationFrame(()=>{this._captionInput.focus()})},abortController:_}),computePosition:{referenceElement:this,placement:"top-end",middleware:[flip(),offset$1(4)],autoUpdate:!0},abortController:_})}}connectedCallback(){super.connectedCallback(),this.model.caption&&(this._showCaption=!0),this._checkAttachment()}willUpdate(_){_.has("sourceId")&&this._checkAttachment(),super.willUpdate(_)}async _checkAttachment(){const _=this.page.blobs,y=this.model.sourceId;y&&(await hasBlob(_,y)||(this._error=!0))}_focusAttachment(){const _=this.root.selectionManager,y=_.getInstance("block",{path:this.path});_.setGroup("note",[y])}async _downloadAttachment(){downloadAttachment(this.model)}_onBlur(){this.model.caption||(this._showCaption=!1)}_onInput(_){const y=_.target.value;this.model.page.updateBlock(this.model,{caption:y})}_attachmentTail(_){return x$1`
      <div class="affine-attachment-banner">
        ${_?ErrorBanner():AttachmentBanner()}
      </div>
      ${this.selected?.is("block")?x$1`<affine-block-selection
            .borderRadius=${12}
            .borderWidth=${3}
          ></affine-block-selection>`:null}
    `}render(){const _=this.model.loadingKey&&isAttachmentLoading(this.model.loadingKey),y=!_&&(this._error||!this.model.sourceId);return _?x$1`<div
        class="affine-attachment-container"
        @click=${this._focusAttachment}
      >
        <div class="affine-attachment-loading">${LoadingIcon}Loading...</div>
        <div class="affine-attachment-desc">
          ${humanFileSize(this.model.size)}
        </div>
        ${this._attachmentTail(y)}
      </div>`:y?x$1`<div
        class="affine-attachment-container"
        @click=${this._focusAttachment}
      >
        <div class="affine-attachment-name">
          ${AttachmentIcon16}${this.model.name}
        </div>
        <div class="affine-attachment-desc">Unable to upload</div>
        ${this._attachmentTail(y)}
      </div>`:x$1`<div
        class="affine-attachment-container"
        @mouseover=${this._onHover}
        @click=${this._focusAttachment}
        @dblclick=${this._downloadAttachment}
      >
        <div class="affine-attachment-name">
          ${AttachmentIcon16}${this.model.name}
        </div>
        <div class="affine-attachment-desc">
          ${humanFileSize(this.model.size)}
        </div>
        ${this._attachmentTail(y)}
      </div>
      <input
        ?hidden=${!this._showCaption}
        .disabled=${this.model.page.readonly}
        class="affine-attachment-caption"
        placeholder="Write a caption"
        value=${this.model.caption??""}
        @input=${this._onInput}
        @blur=${this._onBlur}
        @pointerdown=${stopPropagation}
      />`}};AttachmentBlockComponent.styles=styles$4;__decorate$p([t$2()],AttachmentBlockComponent.prototype,"_showCaption",void 0);__decorate$p([i$6("input.affine-attachment-caption")],AttachmentBlockComponent.prototype,"_captionInput",void 0);__decorate$p([t$2()],AttachmentBlockComponent.prototype,"_error",void 0);AttachmentBlockComponent=__decorate$p([e$7("affine-attachment")],AttachmentBlockComponent);var __decorate$o=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const bookmarkModalStyles=x$1`
  <style>
    .bookmark-modal {
      font-family: var(--affine-font-family);
    }
    .bookmark-modal-container {
      position: fixed;
      width: 100vw;
      height: 100vh;
      display: flex;
    }
    .bookmark-modal-mask {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      z-index: 1;
    }
    .bookmark-modal-wrapper {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      z-index: 2;

      width: 360px;
      height: 260px;
      background: var(--affine-background-primary-color);
      box-shadow: var(--affine-menu-shadow);
      border-radius: var(--affine-popover-radius);
      padding: 36px 40px 24px;
    }
    .bookmark-modal-close-button {
      position: absolute;
      right: 20px;
      top: 12px;
    }
    .bookmark-modal-title {
      font-size: var(--affine-font-h-6);
      font-weight: 600;
    }
    .bookmark-modal-desc {
      font-size: var(--affine-font-base);
      margin-top: 20px;
      caret-color: var(--affine-primary-color);
      margin-bottom: 15px;
    }
    .bookmark-input-wrapper {
      margin-top: 20px;
      display: flex;
      align-items: center;
    }
    .bookmark-input-wrapper label {
      font-size: var(--affine-font-base);
      color: var(--affine-text-secondary-color);
      margin-right: 15px;
    }
    .bookmark-input {
      width: 100%;
      height: 32px;
      font-size: var(--affine-font-base);
      caret-color: var(--affine-primary-color);
      transition: border-color 0.15s;
      line-height: 22px;
      padding: 8px 12px;
      color: var(--affine-text-primary-color);
      border: 1px solid;
      border-color: var(--affine-border-color);
      background-color: var(--affine-white);
      border-radius: 10px;
      outline: medium;
    }
    .bookmark-input:focus {
      border-color: var(--affine-primary-color);
    }

    .bookmark-input::placeholder {
      color: var(--affine-placeholder-color);
      font-size: var(--affine-font-base);
    }

    .bookmark-modal-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 40px;
    }
    .bookmark-confirm-button {
      padding: 4px 20px;
      height: 32px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: var(--affine-font-base);
      background: var(--affine-primary-color);
      color: var(--affine-white);
      border-color: var(--affine-primary-color);
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
`;let BookmarkEditModal=class extends WithDisposable(s$2){constructor(){super(...arguments),this._modalKeyboardListener=_=>{_.key==="Enter"&&this._onConfirm(),_.key==="Escape"&&this.onCancel?.()}}get id(){return`bookmark-modal-${this.model.id.split(":")[0]}`}connectedCallback(){super.connectedCallback(),document.addEventListener("keydown",this._modalKeyboardListener),requestAnimationFrame(()=>{const _=document.querySelector(`#${this.id} input.title`);_.focus(),_.setSelectionRange(0,_.value.length)})}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this._modalKeyboardListener)}_onConfirm(){const _=document.querySelector(`#${this.id} input.title`),y=document.querySelector(`#${this.id} input.description`);this.model.page.updateBlock(this.model,{bookmarkTitle:_.value,description:y.value}),this.onConfirm?.()}render(){const _=x$1`${bookmarkModalStyles}
      <div class="bookmark-modal" id="${this.id}">
        <div
          class="bookmark-modal-mask"
          @click=${()=>{this.onCancel?.()}}
        ></div>
        <div class="bookmark-modal-wrapper">
          <icon-button
            width="32px"
            height="32px"
            class="bookmark-modal-close-button"
            @click=${()=>{this.onCancel?.()}}
            >${CloseIcon}</icon-button
          >

          <div class="bookmark-modal-title">Edit</div>
          <div class="bookmark-input-wrapper">
            <label for="${this.id}-title">Title</label>
            <input
              type="text"
              class="bookmark-input title"
              placeholder="Title"
              value=${this.model.bookmarkTitle||"Bookmark"}
              tabindex="1"
              id="${this.id}-title"
            />
          </div>
          <div class="bookmark-input-wrapper">
            <label for="${this.id}-description">URL</label>
            <input
              type="text"
              class="bookmark-input description"
              placeholder="Description"
              value=${this.model.description||this.model.url}
              tabindex="2"
              id="${this.id}-description"
            />
          </div>

          <div class="bookmark-modal-footer">
            <div
              class="bookmark-confirm-button"
              tabindex="3"
              @click=${()=>{this._onConfirm()}}
            >
              Save
            </div>
          </div>
        </div>
      </div>`;return x$1`<blocksuite-portal .template=${_}></blocksuite-portal>`}};__decorate$o([n$a({attribute:!1})],BookmarkEditModal.prototype,"model",void 0);__decorate$o([n$a({attribute:!1})],BookmarkEditModal.prototype,"onCancel",void 0);__decorate$o([n$a({attribute:!1})],BookmarkEditModal.prototype,"onConfirm",void 0);BookmarkEditModal=__decorate$o([e$7("bookmark-edit-modal")],BookmarkEditModal);var __decorate$n=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let BookmarkCreateModal=class extends WithDisposable(s$2){constructor(){super(...arguments),this._modalKeyboardListener=_=>{_.key==="Enter"&&this._onConfirm(),_.key==="Escape"&&this.onCancel?.()}}get id(){return"bookmark-create-modal"}connectedCallback(){super.connectedCallback(),requestAnimationFrame(()=>{document.querySelector(`#${this.id} input.link`).focus()}),document.addEventListener("keydown",this._modalKeyboardListener)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this._modalKeyboardListener)}_onConfirm(){const _=document.querySelector(`#${this.id} input.link`);if(!_.value){toast("Bookmark url can not be empty");return}this.onConfirm?.({url:_.value})}render(){const _=x$1`${bookmarkModalStyles}
      <div class="bookmark-modal" id="${this.id}">
        <div
          class="bookmark-modal-mask"
          @click=${()=>{this.onCancel?.()}}
        ></div>
        <div class="bookmark-modal-wrapper" style="width:480px">
          <icon-button
            width="32px"
            height="32px"
            class="bookmark-modal-close-button"
            @click=${()=>{this.onCancel?.()}}
            >${CloseIcon}</icon-button
          >

          <div class="bookmark-modal-title">Bookmark</div>
          <div class="bookmark-modal-desc">
            Create a Bookmark that previews a link in card view.
          </div>
          <input
            tabindex="1"
            type="text"
            class="bookmark-input link"
            placeholder="Input in https://..."
          />

          <div class="bookmark-modal-footer">
            <div
              tabindex="2"
              class="bookmark-confirm-button"
              @click=${()=>this._onConfirm()}
            >
              Confirm
            </div>
          </div>
        </div>
      </div>`;return x$1`<blocksuite-portal .template=${_}></blocksuite-portal>`}};__decorate$n([n$a({attribute:!1})],BookmarkCreateModal.prototype,"onCancel",void 0);__decorate$n([n$a({attribute:!1})],BookmarkCreateModal.prototype,"onConfirm",void 0);BookmarkCreateModal=__decorate$n([e$7("bookmark-create-modal")],BookmarkCreateModal);async function getBookmarkInitialProps(){const k=new BookmarkCreateModal;return new Promise(_=>{k.onCancel=()=>{_(null),document.body.removeChild(k)},k.onConfirm=({url:y})=>{_(y),document.body.removeChild(k)},document.body.appendChild(k)})}var __decorate$m=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const operations=[{type:"copy",icon:CopyIcon,label:"Copy",action:async(k,_)=>{await copyBlocks([k]),toast("Copied link to clipboard"),_?.("copy")}},{type:"duplicate",icon:DuplicateIcon,label:"Duplicate",action:(k,_)=>{const{page:y}=k,w=y.getParent(k),$=w?.children.indexOf(k),B=cloneBookmarkProperties(k);y.addBlock("affine:bookmark",B,w,$),_?.("duplicate")}},{type:"reload",icon:RefreshIcon,label:"Reload",action:(k,_)=>{reloadBookmarkBlock(k,getBlockElementByModel(k),!0),_?.("reload")}},{type:"delete",icon:DeleteIcon,label:"Delete",action:(k,_)=>{k.page.deleteBlock(k),_?.("delete")}}];let BookmarkOperationMenu=class extends WithDisposable(s$2){connectedCallback(){super.connectedCallback()}render(){const _=c$1(operations,({type:y})=>y,({type:y,icon:w,label:$,action:B,divider:R})=>x$1`<icon-button
            width="126px"
            height="32px"
            class="menu-item ${y}"
            @click=${()=>{B(this.model,this.onSelected,this)}}
          >
            ${w} ${$}
          </icon-button>
          ${R?x$1`<div class="divider"></div>`:A} `);return x$1`<div class="bookmark-operation-menu">${_}</div> `}};BookmarkOperationMenu.styles=i$5`
    .bookmark-operation-menu {
      border-radius: 8px;
      padding: 8px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
    }
    .menu-item {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      fill: var(--affine-icon-color);
      color: var(--affine-text-primary-color);
    }
    .menu-item:hover {
      background: var(--affine-hover-color);
    }
    .menu-item:hover.delete {
      background: var(--affine-background-error-color);
      fill: var(--affine-error-color);
      color: var(--affine-error-color);
    }
    .menu-item svg {
      margin: 0 8px;
    }
  `;__decorate$m([n$a({attribute:!1})],BookmarkOperationMenu.prototype,"model",void 0);__decorate$m([n$a({attribute:!1})],BookmarkOperationMenu.prototype,"onSelected",void 0);BookmarkOperationMenu=__decorate$m([e$7("bookmark-operation-menu")],BookmarkOperationMenu);var __decorate$l=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const config=[{type:"link",icon:LinkIcon,tooltip:"Turn into Link view",action:(k,_)=>{const{page:y}=k,w=y.getParent(k),$=w?.children.indexOf(k),B=new YText,R=k.bookmarkTitle||k.caption||k.url;B.insert(0,R),B.format(0,R.length,{link:k.url});const H=new y.Text(B);y.addBlock("affine:paragraph",{text:H},w,$),k.page.deleteBlock(k),_?.("link")},divider:!0},{type:"edit",icon:EditIcon,tooltip:"Edit",action:(k,_)=>{_?.("edit")}},{type:"caption",icon:CaptionIcon,tooltip:"Add Caption",action:(k,_)=>{_?.("caption")},divider:!0}];let BookmarkToolbar=class extends WithDisposable(s$2){constructor(){super(...arguments),this._moreMenuAbortController=null}connectedCallback(){super.connectedCallback();const{onHover:_,onHoverLeave:y}=createDelayHoverSignal(this.abortController);this.disposables.addFromEvent(this,"mouseover",_),this.disposables.addFromEvent(this,"mouseleave",y),this.disposables.addFromEvent(this.root,"mouseover",_),this.disposables.addFromEvent(this.root,"mouseleave",y)}_toggleMenu(){if(this._moreMenuAbortController){this._moreMenuAbortController.abort(),this._moreMenuAbortController=null;return}this._moreMenuAbortController=new AbortController;const _=new BookmarkOperationMenu;_.model=this.model,_.onSelected=this.onSelected,createLitPortal({template:_,container:this.bookmarkBarElement,computePosition:{referenceElement:this.bookmarkBarElement,placement:"top-end",middleware:[flip(),offset$1(4)]},abortController:this._moreMenuAbortController})}render(){const _=c$1(config,({type:y})=>y,({type:y,icon:w,tooltip:$,action:B,divider:R})=>x$1`<icon-button
            size="24px"
            class="bookmark-toolbar-button has-tool-tip ${y}"
            @click=${()=>{B(this.model,this.onSelected,this)}}
          >
            ${w}
            <tool-tip inert role="tooltip">${$}</tool-tip>
          </icon-button>
          ${R?x$1`<div class="divider"></div>`:A} `);return x$1`
      <div class="bookmark-bar">
        ${_}

        <div class="more-button-wrapper">
          <icon-button
            size="24px"
            class="has-tool-tip more-button"
            @click=${()=>{this._toggleMenu()}}
          >
            ${MoreIcon}
            <tool-tip inert role="tooltip">More</tool-tip>
          </icon-button>
        </div>
      </div>
    `}};BookmarkToolbar.styles=i$5`
    ${tooltipStyle}
    .bookmark-bar {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      padding: 8px;
      gap: 8px;
      height: 40px;

      border-radius: 8px;
      background: var(--affine-background-overlay-panel-color);
      box-shadow: var(--affine-shadow-2);
      z-index: var(--affine-z-index-popover);
      user-select: none;
    }
    .divider {
      width: 1px;
      height: 24px;
      background-color: var(--affine-border-color);
    }
  `;__decorate$l([n$a({attribute:!1})],BookmarkToolbar.prototype,"model",void 0);__decorate$l([n$a({attribute:!1})],BookmarkToolbar.prototype,"onSelected",void 0);__decorate$l([n$a({attribute:!1})],BookmarkToolbar.prototype,"root",void 0);__decorate$l([n$a({attribute:!1})],BookmarkToolbar.prototype,"abortController",void 0);__decorate$l([i$6(".bookmark-bar")],BookmarkToolbar.prototype,"bookmarkBarElement",void 0);__decorate$l([i$6(".more-button-wrapper")],BookmarkToolbar.prototype,"moreButton",void 0);BookmarkToolbar=__decorate$l([e$7("bookmark-toolbar")],BookmarkToolbar);var __decorate$k=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let Loader$1=class extends s$2{constructor(){super(...arguments),this.size="50px",this.color="blue"}firstUpdated(){this.updateComplete.then(()=>{const{size:_,color:y}=this;this.style.setProperty("--loader-size",typeof _=="string"?_:`${_}px`),this.style.setProperty("--loader-color",y)})}render(){return x$1`<div class="bookmark-loader-wrapper">
      <svg class="bookmark-loader" x="0px" y="0px" viewBox="0 0 150 150">
        <circle class="bookmark-loader-block" cx="75" cy="75" r="60" />
      </svg>
    </div>`}};Loader$1.styles=i$5`
    .bookmark-loader-wrapper {
      display: flex;
      width: var(--loader-size);
      height: var(--loader-size);
    }
    .bookmark-loader {
      width: var(--loader-size);
      animation: loading 3s linear infinite;
    }
    .bookmark-loader-block {
      animation: loading-circle 2s linear infinite;
      stroke-dashoffset: 0;
      stroke-dasharray: 300;
      stroke-width: 15;
      stroke-miterlimit: 10;
      stroke-linecap: round;
      stroke: var(--loader-color);
      fill: transparent;
    }

    @keyframes loading {
      0% {
        transform: rotate(0);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    @keyframes loading-circle {
      0% {
        stroke-dashoffset: 0;
      }
      100% {
        stroke-dashoffset: -600;
      }
    }
  `;__decorate$k([n$a({attribute:!1})],Loader$1.prototype,"size",void 0);__decorate$k([n$a({attribute:!1})],Loader$1.prototype,"color",void 0);Loader$1=__decorate$k([e$7("bookmark-loader")],Loader$1);const LoadingBanner=x$1`
  <svg
    width="140"
    height="96"
    viewBox="0 0 140 96"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_4257_88403)">
      <g opacity="0.4">
        <g clip-path="url(#clip1_4257_88403)">
          <g clip-path="url(#clip2_4257_88403)">
            <g opacity="0.8" filter="url(#filter0_f_4257_88403)">
              <ellipse
                cx="45.5713"
                cy="61.2938"
                rx="45.5713"
                ry="61.2938"
                transform="matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)"
                fill="#C0BFC1"
              />
            </g>
            <g opacity="0.8" filter="url(#filter1_f_4257_88403)">
              <ellipse
                cx="49.6555"
                cy="50.1114"
                rx="49.6555"
                ry="50.1114"
                transform="matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)"
                fill="#C0BFC1"
              />
            </g>
            <g opacity="0.8" filter="url(#filter2_f_4257_88403)">
              <path
                d="M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z"
                fill="#C0BFC1"
              />
            </g>
            <path
              d="M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z"
              fill="url(#paint0_linear_4257_88403)"
            />
            <path
              d="M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z"
              fill="url(#paint1_linear_4257_88403)"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M15.2358 72.0343C15.3511 71.2139 16.1096 70.6424 16.93 70.7576L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1321C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0343Z"
              fill="white"
              fill-opacity="0.4"
            />
          </g>
        </g>
      </g>
    </g>
    <defs>
      <filter
        id="filter0_f_4257_88403"
        x="-14.1589"
        y="-38.4709"
        width="172.444"
        height="136.638"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4257_88403"
        />
      </filter>
      <filter
        id="filter1_f_4257_88403"
        x="-45.8333"
        y="-40.3932"
        width="155.805"
        height="139.072"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4257_88403"
        />
      </filter>
      <filter
        id="filter2_f_4257_88403"
        x="8.68726"
        y="-25.6425"
        width="166.468"
        height="142.859"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4257_88403"
        />
      </filter>
      <linearGradient
        id="paint0_linear_4257_88403"
        x1="102.492"
        y1="40.3698"
        x2="96.2289"
        y2="84.9319"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.578125" stop-color="white" />
        <stop offset="1" stop-color="white" stop-opacity="0" />
      </linearGradient>
      <linearGradient
        id="paint1_linear_4257_88403"
        x1="102.492"
        y1="40.3698"
        x2="96.2289"
        y2="84.9319"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.578125" stop-color="white" />
        <stop offset="1" stop-color="white" stop-opacity="0" />
      </linearGradient>
      <clipPath id="clip0_4257_88403">
        <rect width="140" height="96" fill="white" />
      </clipPath>
      <clipPath id="clip1_4257_88403">
        <rect
          x="11.7563"
          y="3.38196"
          width="130"
          height="88"
          rx="4"
          transform="rotate(8 11.7563 3.38196)"
          fill="white"
        />
      </clipPath>
      <clipPath id="clip2_4257_88403">
        <rect
          width="130"
          height="88"
          fill="white"
          transform="translate(11.7563 3.38196) rotate(8)"
        />
      </clipPath>
    </defs>
  </svg>
`,DarkLoadingBanner=x$1`
  <svg
    width="140"
    height="96"
    viewBox="0 0 140 96"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clip-path="url(#clip0_4391_90250)">
      <g opacity="0.4">
        <g clip-path="url(#clip1_4391_90250)">
          <g clip-path="url(#clip2_4391_90250)">
            <g opacity="0.8" filter="url(#filter0_f_4391_90250)">
              <ellipse
                cx="45.5713"
                cy="61.2938"
                rx="45.5713"
                ry="61.2938"
                transform="matrix(-0.275152 -0.961401 0.994111 -0.108365 23.6692 80.3025)"
                fill="#3E3E3F"
              />
            </g>
            <g opacity="0.8" filter="url(#filter1_f_4391_90250)">
              <ellipse
                cx="49.6555"
                cy="50.1114"
                rx="49.6555"
                ry="50.1114"
                transform="matrix(-0.517539 -0.855659 0.945307 -0.326182 10.3975 87.9766)"
                fill="#3E3E3F"
              />
            </g>
            <g opacity="0.8" filter="url(#filter2_f_4391_90250)">
              <path
                d="M141.154 3.03247C167.539 22.8936 134.54 99.5878 124.212 92.7915C117.912 88.6456 113.733 60.4772 94.173 45.9086C81.6691 36.5955 56.6586 38.5939 41.1056 37.1878C1.22291 33.5821 114.548 -16.9943 141.154 3.03247Z"
                fill="#3E3E3F"
              />
            </g>
            <path
              d="M78.5971 45.1263C77.9794 49.5216 81.121 53.5957 85.6131 54.2271C90.1053 54.8584 94.2481 51.808 94.8658 47.4128C95.4835 43.0175 92.342 38.9434 87.8498 38.312C83.3577 37.6807 79.2149 40.7311 78.5971 45.1263Z"
              fill="url(#paint0_linear_4391_90250)"
            />
            <path
              d="M120.378 78.3637L119.989 81.1303C119.731 82.9654 119.562 84.15 119.36 85.0413C119.166 85.8959 118.999 86.1992 118.895 86.3451C118.499 86.9002 117.932 87.3171 117.277 87.5363C117.105 87.5938 116.76 87.6677 115.867 87.6141C114.934 87.5582 113.723 87.3905 111.847 87.1268L80.6109 82.7369C78.735 82.4733 77.524 82.3006 76.6125 82.0973C75.7385 81.9024 75.4276 81.7365 75.278 81.6337C74.7087 81.2424 74.2794 80.6856 74.0516 80.0428C73.9917 79.8739 73.9142 79.5361 73.9635 78.6612C74.0149 77.7488 74.1789 76.5635 74.4369 74.7283L75.6584 66.0369C75.8058 65.9369 75.9505 65.8411 76.0924 65.7498C77.1899 65.0437 78.3629 64.4423 79.7464 64.1873C81.8083 63.8072 83.9443 64.0829 85.8427 64.9742C87.1166 65.5723 88.0991 66.452 88.9822 67.4137C89.5619 68.0451 90.1807 68.8058 90.8604 69.6691L94.5285 66.9912C95.9295 65.9684 97.1371 65.0867 98.1922 64.4415C99.3051 63.761 100.491 63.1868 101.879 62.9626C103.947 62.6286 106.075 62.9506 107.951 63.8817C109.21 64.5065 110.172 65.4058 111.033 66.385C111.033 66.385 117.277 74.3919 120.378 78.3637Z"
              fill="url(#paint1_linear_4391_90250)"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M18.0193 52.2289C18.1346 51.4086 18.8931 50.837 19.7134 50.9523L67.2463 57.6326C68.0667 57.7479 68.6382 58.5064 68.5229 59.3268C68.4076 60.1471 67.6491 60.7187 66.8288 60.6034L19.2959 53.9231C18.4755 53.8078 17.904 53.0493 18.0193 52.2289Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M21.5681 26.9771C21.7218 25.8833 22.7332 25.1212 23.827 25.2749L47.5934 28.6151C48.6872 28.7688 49.4493 29.7801 49.2956 30.874C49.1419 31.9678 48.1305 32.7299 47.0367 32.5762L23.2703 29.236C22.1765 29.0823 21.4144 28.0709 21.5681 26.9771Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M19.55 41.336C19.6653 40.5156 20.4238 39.9441 21.2442 40.0593L68.7771 46.7397C69.5974 46.8549 70.169 47.6135 70.0537 48.4338C69.9384 49.2542 69.1799 49.8258 68.3595 49.7105L20.8267 43.0301C20.0063 42.9149 19.4347 42.1564 19.55 41.336Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M16.4883 63.1219C16.6036 62.3015 17.3621 61.7299 18.1824 61.8452L65.7153 68.5255C66.5357 68.6408 67.1072 69.3993 66.9919 70.2197C66.8766 71.0401 66.1181 71.6116 65.2978 71.4963L17.7649 64.816C16.9445 64.7007 16.373 63.9422 16.4883 63.1219Z"
              fill="white"
              fill-opacity="0.8"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M15.2358 72.0344C15.3511 71.214 16.1096 70.6424 16.93 70.7577L64.4628 77.438C65.2832 77.5533 65.8548 78.3118 65.7395 79.1322C65.6242 79.9525 64.8657 80.5241 64.0453 80.4088L16.5125 73.7285C15.6921 73.6132 15.1205 72.8547 15.2358 72.0344Z"
              fill="white"
              fill-opacity="0.4"
            />
          </g>
        </g>
      </g>
    </g>
    <defs>
      <filter
        id="filter0_f_4391_90250"
        x="-14.1589"
        y="-38.4709"
        width="172.444"
        height="136.638"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4391_90250"
        />
      </filter>
      <filter
        id="filter1_f_4391_90250"
        x="-45.8333"
        y="-40.3932"
        width="155.805"
        height="139.072"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4391_90250"
        />
      </filter>
      <filter
        id="filter2_f_4391_90250"
        x="8.68726"
        y="-25.6425"
        width="166.468"
        height="142.859"
        filterUnits="userSpaceOnUse"
        color-interpolation-filters="sRGB"
      >
        <feFlood flood-opacity="0" result="BackgroundImageFix" />
        <feBlend
          mode="normal"
          in="SourceGraphic"
          in2="BackgroundImageFix"
          result="shape"
        />
        <feGaussianBlur
          stdDeviation="12"
          result="effect1_foregroundBlur_4391_90250"
        />
      </filter>
      <linearGradient
        id="paint0_linear_4391_90250"
        x1="102.492"
        y1="40.3698"
        x2="96.2289"
        y2="84.9319"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.578125" stop-color="white" />
        <stop offset="1" stop-color="white" stop-opacity="0" />
      </linearGradient>
      <linearGradient
        id="paint1_linear_4391_90250"
        x1="102.492"
        y1="40.3698"
        x2="96.2289"
        y2="84.9319"
        gradientUnits="userSpaceOnUse"
      >
        <stop offset="0.578125" stop-color="white" />
        <stop offset="1" stop-color="white" stop-opacity="0" />
      </linearGradient>
      <clipPath id="clip0_4391_90250">
        <rect width="140" height="96" fill="white" />
      </clipPath>
      <clipPath id="clip1_4391_90250">
        <rect
          x="11.7563"
          y="3.38196"
          width="130"
          height="88"
          rx="4"
          transform="rotate(8 11.7563 3.38196)"
          fill="white"
        />
      </clipPath>
      <clipPath id="clip2_4391_90250">
        <rect
          width="130"
          height="88"
          fill="white"
          transform="translate(11.7563 3.38196) rotate(8)"
        />
      </clipPath>
    </defs>
  </svg>
`;var __decorate$j=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let BookmarkBlockComponent=class extends BlockElement{constructor(){super(...arguments),this.slots={openInitialModal:new Slot},this._showCreateModal=!1,this._showEditModal=!1,this._isLoading=!1,this._isIconError=!1,this._isImageError=!1,this._onToolbarSelected=_=>{_==="caption"&&(this._input.classList.add("caption-show"),requestAnimationFrame(()=>{this._input.focus()})),_==="edit"&&(this._showEditModal=!0),_==="reload"&&(this._isImageError=!1,this._isIconError=!1),this._optionsAbortController?.abort()}}set loading(_){this._isLoading=_}get loading(){return this._isLoading}firstUpdated(){this.model.propsUpdated.on(()=>this.requestUpdate()),this.updateComplete.then(()=>{this._caption=this.model?.caption??"",this._caption&&this._input.classList.add("caption-show")})}connectedCallback(){super.connectedCallback(),reloadBookmarkBlock(this.model,this),this.slots.openInitialModal.on(()=>{this._showCreateModal=!0})}_onInputChange(){this._caption=this._input.value,this.model.page.updateBlock(this.model,{caption:this._caption})}_onInputBlur(){this._caption||this._input.classList.remove("caption-show")}_onHover(){this._optionsAbortController||(this._optionsAbortController=new AbortController,this._optionsAbortController.signal.addEventListener("abort",()=>{this._optionsAbortController=void 0}),createLitPortal({template:x$1`<bookmark-toolbar
        .model=${this.model}
        .onSelected=${this._onToolbarSelected}
        .root=${this}
        .abortController=${this._optionsAbortController}
      ></bookmark-toolbar>`,computePosition:{referenceElement:this,placement:"top-end",middleware:[flip(),offset$1(4)],autoUpdate:!0},abortController:this._optionsAbortController}))}_onCardClick(){const _=this.root.selectionManager,y=_.getInstance("block",{path:this.path});_.setGroup("note",[y])}_onCardDbClick(){let _=this.model.url;_.match(/^[a-zA-Z]+:\/\//)||(_="https://"+_),window.open(_,"_blank")}_onIconError(){this._isIconError=!0}_onImageError(){this._isImageError=!0}render(){const{url:_,bookmarkTitle:y,description:w,icon:$,image:B}=this.model,R=queryCurrentMode(),H=this._showCreateModal?x$1`<bookmark-create-modal
          .model=${this.model}
          .onCancel=${()=>{this._showCreateModal=!1}}
          .onConfirm=${()=>{reloadBookmarkBlock(this.model,this,!0),this._showCreateModal=!1}}
        ></bookmark-create-modal>`:A,j=this._showEditModal?x$1`<bookmark-edit-modal
          .model=${this.model}
          .onCancel=${()=>{this._showEditModal=!1}}
          .onConfirm=${()=>{this._showEditModal=!1}}
        ></bookmark-edit-modal>`:A,q=this._isLoading?x$1`<div
          class="affine-bookmark-loading ${R==="light"?"":"dark"}"
        >
          <div class="affine-bookmark-title">
            <bookmark-loader
              .size=${"15px"}
              .color=${"var(--affine-primary-color)"}
            ></bookmark-loader>
            <div class="affine-bookmark-title-content">Loading...</div>
          </div>
          <div class="affine-bookmark-banner">
            ${R==="light"?LoadingBanner:DarkLoadingBanner}
          </div>
        </div>`:A,X=x$1`<div
      class="affine-bookmark-link"
      @click=${this._onCardClick}
      @dblclick=${this._onCardDbClick}
    >
      <div class="affine-bookmark-content-wrapper">
        <div class="affine-bookmark-title">
          <div class="affine-bookmark-icon">
            ${$&&!this._isIconError?x$1`<img
                  src="${$}"
                  alt="icon"
                  @error="${this._onIconError}"
                />`:WebIcon16}
          </div>
          <div class="affine-bookmark-title-content">
            ${y||"Bookmark"}
          </div>
        </div>

        <div class="affine-bookmark-description">${w||_}</div>
        <div class="affine-bookmark-url">${_}</div>
      </div>
      <div class="affine-bookmark-banner ${B?"shadow":""}">
        ${B&&!this._isImageError?x$1`<img
              src="${B}"
              alt="image"
              @error="${this._onImageError}"
            />`:DefaultBanner}
      </div>
    </div>`;return _?x$1`
      ${j}
      <div
        class="affine-bookmark-block-container"
        @mouseover="${this._onHover}"
      >
        ${this._isLoading?q:X}
        <input
          .disabled=${this.model.page.readonly}
          placeholder="Write a caption"
          class="affine-bookmark-caption"
          value=${this._caption}
          @input=${this._onInputChange}
          @blur=${this._onInputBlur}
          @pointerdown=${stopPropagation}
        />
        ${this.selected?.is("block")?x$1`<affine-block-selection></affine-block-selection>`:null}
      </div>
    `:H}};BookmarkBlockComponent.styles=i$5`
    .affine-bookmark-block-container {
      width: 100%;
      margin-top: 18px;
      margin-bottom: 18px;
      position: relative;
    }
    .affine-bookmark-link {
      height: 112px;
      box-shadow: var(--affine-shadow-1);
      background: var(--affine-card-background-blue);
      border: 3px solid var(--affine-background-secondary-color);
      border-radius: 12px;
      padding: 16px 24px;
      display: flex;
      cursor: pointer;
      text-decoration: none;
      color: var(--affine-text-primary-color);
      overflow: hidden;
      line-height: calc(1em + 4px);
      position: relative;
    }
    .affine-bookmark-banner {
      width: 140px;
      height: 93px;
      margin-left: 20px;
      border-radius: 8px 8px 0 0;
      overflow: hidden;
      flex-shrink: 0;
    }
    .affine-bookmark-banner.shadow {
      box-shadow: var(--affine-shadow-1);
    }

    .affine-bookmark-banner img,
    .affine-bookmark-banner svg {
      width: 140px;
      height: 93px;
      object-fit: cover;
    }
    .affine-bookmark-content-wrapper {
      flex-grow: 1;
      overflow: hidden;
    }
    .affine-bookmark-title {
      height: 18px;
      display: flex;
      align-items: center;
      font-size: var(--affine-font-sm);
      font-weight: 600;
    }
    .affine-bookmark-title-content {
      flex-grow: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-left: 8px;
    }
    .affine-bookmark-icon {
      display: flex;
      align-items: center;
      width: 18px;
      height: 18px;
      color: var(--affine-text-secondary-color);
      fill: var(--affine-text-secondary-color);
      flex-shrink: 0;
    }
    .affine-bookmark-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .affine-bookmark-description {
      height: 32px;
      line-height: 16px;
      margin-top: 4px;
      font-size: var(--affine-font-xs);

      display: -webkit-box;
      word-break: break-all;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .affine-bookmark-url {
      font-size: var(--affine-font-xs);
      color: var(--affine-text-secondary-color);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-top: 2px;
    }
    .affine-bookmark-caption {
      width: 100%;
      font-size: var(--affine-font-sm);
      outline: none;
      border: 0;
      font-family: inherit;
      text-align: center;
      color: var(--affine-icon-color);
      display: none;
      background: var(--affine-background-primary-color);
    }
    .affine-bookmark-caption::placeholder {
      color: var(--affine-placeholder-color);
    }
    .affine-bookmark-caption.caption-show {
      display: inline-block;
    }
    .affine-bookmark-loading {
      width: 100%;
      height: 112px;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      box-shadow: var(--affine-shadow-1);
      background: var(--affine-hover-color);
      border: 3px solid var(--affine-background-secondary-color);
      color: var(--affine-placeholder-color);
      border-radius: 12px;
    }
  `;__decorate$j([i$6("input.affine-bookmark-caption")],BookmarkBlockComponent.prototype,"_input",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_showCreateModal",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_showEditModal",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_caption",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_isLoading",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_isIconError",void 0);__decorate$j([t$2()],BookmarkBlockComponent.prototype,"_isImageError",void 0);BookmarkBlockComponent=__decorate$j([e$7("affine-bookmark")],BookmarkBlockComponent);function CodeOptionTemplate({anchor:k,model:_,wrap:y,abortController:w,onClickWrap:$}){const R=_.page.readonly,{onHover:H,onHoverLeave:j}=createDelayHoverSignal(w);return k.addEventListener("mouseover",H),k.addEventListener("mouseleave",j),w.signal.addEventListener("abort",()=>{k.removeEventListener("mouseover",H),k.removeEventListener("mouseleave",j)}),x$1`
    <style>
      .affine-codeblock-option {
        box-shadow: var(--affine-shadow-2);
        padding: 4px;
        border-radius: 8px;
        z-index: var(--affine-z-index-popover);
        background: var(--affine-background-overlay-panel-color);
      }
      .delete-code-button:hover {
        background: var(--affine-background-error-color);
        color: var(--affine-error-color);
      }
      ${tooltipStyle}
    </style>

    <div
      class="affine-codeblock-option"
      @mouseover=${H}
      @mouseleave=${j}
    >
      <icon-button
        size="32px"
        class="has-tool-tip"
        data-testid="copy-button"
        @click=${()=>copyCode(_)}
      >
        ${CopyIcon}
        <tool-tip inert tip-position="right" role="tooltip"
          >Copy to Clipboard</tool-tip
        >
      </icon-button>
      <icon-button
        size="32px"
        class="has-tool-tip"
        data-testid="wrap-button"
        ?active=${y}
        @click=${$}
      >
        ${y?CancelWrapIcon:WrapIcon}
        <tool-tip inert tip-position="right" role="tooltip"
          >${y?"Cancel wrap":"Wrap code"}</tool-tip
        >
      </icon-button>
      ${R?A:x$1`<icon-button
            size="32px"
            data-testid="delete-button"
            class="has-tool-tip delete-code-button"
            @click=${()=>{R||_.page.deleteBlock(_)}}
          >
            ${DeleteIcon}
            <tool-tip inert tip-position="right" role="tooltip"
              >Delete</tool-tip
            >
          </icon-button>`}
    </div>
  `}var __decorate$i=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LangList=class extends s$2{constructor(){super(...arguments),this._filterText="",this._currentSelectedIndex=0,this._clickAwayListener=_=>{this.renderRoot.parentElement?.contains(_.target)||this.onClose?.()}}static get styles(){return i$5`
      :host {
        height: 100%;
        display: flex;
        flex-direction: column;
        background: var(--affine-background-overlay-panel-color);
        color: var(--affine-text-primary-color);
        border-radius: 12px;
        z-index: var(--affine-z-index-popover);
      }

      .lang-list-container {
        box-sizing: border-box;
        display: flex;
        height: 100%;
        flex-direction: column;
        box-shadow: var(--affine-menu-shadow);
        border-radius: 8px;
        padding: 12px 8px;
      }

      .lang-list-button-container {
        flex: 1;
        overflow: scroll;
        height: 424px;
        padding-top: 5px;
        padding-left: 4px;
        padding-right: 4px;
      }

      ${scrollbarStyle(".lang-list-button-container")}

      .lang-item {
        display: flex;
        justify-content: flex-start;
        padding-left: 12px;
        margin-bottom: 5px;
      }

      .input-wrapper {
        display: flex;
        margin-top: 8px;
        margin-left: 4px;
        border: 1px solid var(--affine-border-color);
        border-radius: 8px;
        padding: 4px 10px;
        gap: 4px;
      }

      #filter-input {
        flex: 1;
        align-items: center;
        height: 20px;
        width: 140px;
        border-radius: 8px;
        padding-top: 2px;
        border: none;
        font-family: var(--affine-font-family);
        font-size: var(--affine-font-sm);
        box-sizing: border-box;
        color: inherit;
        background: var(--affine-background-overlay-panel-color);
      }

      #filter-input:focus {
        outline: none;
      }

      #filter-input::placeholder {
        color: var(--affine-placeholder-color);
        font-size: var(--affine-font-sm);
      }

      .search-icon {
        display: flex;
        align-items: center;
        color: var(--affine-icon-color);
      }
    `}async connectedCallback(){super.connectedCallback(),setTimeout(()=>document.addEventListener("click",this._clickAwayListener)),setTimeout(()=>{this.filterInput?.focus()},0)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this._clickAwayListener)}_onLanguageClicked(_){this.onSelectLanguage?.(_)}render(){const _=this.placement?.startsWith("top"),y=[PLAIN_TEXT_REGISTRATION,...languages].filter($=>this._filterText?$.id.startsWith(this._filterText.toLowerCase())||$.aliases?.some(B=>B.startsWith(this._filterText.toLowerCase())):!0).sort(($,B)=>getLanguagePriority($.id,this.currentLanguageId===$.id)-getLanguagePriority(B.id,this.currentLanguageId===B.id));return x$1`
      <div
        class="lang-list-container"
        style="${_?"flex-direction: column-reverse;":""}"
      >
        <div class="input-wrapper">
          <div class="search-icon">${SearchIcon}</div>
          <input
            id="filter-input"
            type="text"
            placeholder="Search"
            @input="${()=>{this._filterText=this.filterInput?.value,this._currentSelectedIndex=0}}"
            @keydown="${$=>{if($.key==="ArrowDown")$.preventDefault(),this._currentSelectedIndex=(this._currentSelectedIndex+1)%y.length;else if($.key==="ArrowUp")$.preventDefault(),this._currentSelectedIndex=(this._currentSelectedIndex+y.length-1)%y.length;else if($.key==="Enter"){if($.preventDefault(),this._currentSelectedIndex===-1||this._currentSelectedIndex>=y.length)return;this._onLanguageClicked(y[this._currentSelectedIndex])}}}"
          />
        </div>
        <div class="lang-list-button-container">
          ${y.map(($,B)=>x$1`
              <icon-button
                width="100%"
                height="32px"
                @click="${()=>this._onLanguageClicked($)}"
                class="lang-item"
                ?hover=${B===this._currentSelectedIndex}
              >
                ${$.displayName??$.id}
              </icon-button>
            `)}
        </div>
      </div>
    `}};__decorate$i([n$a({attribute:!1})],LangList.prototype,"currentLanguageId",void 0);__decorate$i([n$a({attribute:!1})],LangList.prototype,"onClose",void 0);__decorate$i([n$a({attribute:!1})],LangList.prototype,"onSelectLanguage",void 0);__decorate$i([n$a({attribute:!1})],LangList.prototype,"placement",void 0);__decorate$i([t$2()],LangList.prototype,"_filterText",void 0);__decorate$i([t$2()],LangList.prototype,"_currentSelectedIndex",void 0);__decorate$i([i$6("#filter-input")],LangList.prototype,"filterInput",void 0);LangList=__decorate$i([e$7("lang-list")],LangList);const getCodeLineRenderer=k=>_=>x$1`<affine-code-line
    .delta=${_}
    .highlightOptionsGetter=${k}
  ></affine-code-line>`;var __decorate$h=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let CodeBlockComponent=class extends BlockElement{constructor(){super(...arguments),this._wrap=!1,this._optionsPortal=null,this.textSchema={attributesSchema:z.object({}),textRenderer:()=>getCodeLineRenderer(()=>({lang:this.model.language.toLowerCase(),highlighter:this._highlighter}))},this._richTextResizeObserver=new ResizeObserver(()=>{this._updateLineNumbers()}),this._perviousLanguage=PLAIN_TEXT_REGISTRATION,this._highlighter=null}get _showLangList(){return!!this._langListAbortController}get readonly(){return this.model.page.readonly}async _startHighlight(_){if(this._highlighter){this._highlighter.getLoadedLanguages().includes(_.id)||this._highlighter.loadLanguage(_).then(()=>{const j=this.querySelector("rich-text")?.vEditor;j&&j.requestUpdate()});return}const y=queryCurrentMode();this._highlighter=await getHighlighter({theme:y==="dark"?DARK_THEME:LIGHT_THEME,themes:[LIGHT_THEME,DARK_THEME],langs:[_],paths:{wasm:"https://cdn.jsdelivr.net/npm/shiki/dist",themes:"https://cdn.jsdelivr.net/",languages:"https://cdn.jsdelivr.net/npm/shiki/languages"}});const w=this.querySelector("rich-text");assertExists(w);const $=w.vEditor;assertExists($);const B=$.getVRange();$.requestUpdate(),B&&$.setVRange(B)}get vEditor(){const _=this.querySelector("[data-virgo-root]");if(!_)throw new Error("Virgo root not found");return _.virgoEditor}connectedCallback(){super.connectedCallback(),getService$1("affine:code").setHighlightOptionsGetter(()=>({lang:this._perviousLanguage.id,highlighter:this._highlighter})),this._disposables.add(this.model.propsUpdated.on(()=>this.requestUpdate())),this._disposables.add(this.model.childrenUpdated.on(()=>this.requestUpdate())),this._disposables.add(listenToThemeChange(this,async()=>{if(!this._highlighter)return;const R=this.querySelector("rich-text")?.vEditor;R&&setTimeout(()=>{R.requestUpdate()})})),this._observePosition(),bindContainerHotkey(this);const _=this.root.selectionManager,y="  ",w=`
`,$=(B,R,H=0,j=B.length)=>{const q=[];let X=H;for(;X<j;){const ee=B.indexOf(R,X);if(ee===-1||ee>j)break;q.push(ee),X=ee+1}return q};this.bindHotKey({Backspace:()=>{const B=_.find("text");if(!B)return;const R=B.from;if(R.index===0&&R.length===0)return _.update(H=>H.filter(j=>!j.is("text")).concat(_.getInstance("block",{path:this.path}))),!0},Tab:B=>{const H=B.get("keyboardState").raw,q=this.vEditor.getVRange();if(q){H.stopPropagation(),H.preventDefault();const X=this.vEditor.yText.toString(),ee=X.lastIndexOf(w,q.index-1),te=$(X,w,q.index,q.index+q.length).map(ne=>ne+1).reverse();return ee!==-1?te.push(ee+1):te.push(0),te.forEach(ne=>{this.vEditor.insertText({index:ne,length:0},y)}),this.vEditor.setVRange({index:q.index+2,length:q.length+(te.length-1)*y.length}),!0}},"Shift-Tab":B=>{const H=B.get("keyboardState").raw,q=this.vEditor.getVRange();if(q){H.stopPropagation(),H.preventDefault();const X=this.vEditor.yText.toString(),ee=X.lastIndexOf(w,q.index-1);let te=$(X,w,q.index,q.index+q.length).map(ne=>ne+1).reverse();return ee!==-1?te.push(ee+1):te.push(0),te=te.filter(ne=>X.slice(ne,ne+2)===y),te.forEach(ne=>{this.vEditor.deleteText({index:ne,length:2})}),te.length>0&&this.vEditor.setVRange({index:q.index-(te[te.length-1]<q.index?2:0),length:q.length-(te.length-1)*y.length}),!0}}})}disconnectedCallback(){super.disconnectedCallback(),this._richTextResizeObserver.disconnect()}updated(){if(this.model.language!==this._perviousLanguage.id){const y=getStandardLanguage(this.model.language);this._perviousLanguage=y??PLAIN_TEXT_REGISTRATION,y?this._startHighlight(y):this._highlighter=null;const $=this.querySelector("rich-text")?.vEditor;$&&$.requestUpdate()}const _=this.querySelector("rich-text");assertExists(_),this._richTextResizeObserver.disconnect(),this._richTextResizeObserver.observe(_)}_onClickWrapBtn(){const _=this.querySelector(".affine-code-block-container");assertExists(_),this._wrap=_.classList.toggle("wrap")}_observePosition(){this._disposables.addFromEvent(this,"mouseenter",()=>{if(this._optionsPortal?.isConnected)return;const _=new AbortController;this._optionsPortal=createLitPortal({template:({updatePortal:y})=>CodeOptionTemplate({anchor:this,model:this.model,wrap:this._wrap,onClickWrap:()=>{this._onClickWrapBtn(),y()},abortController:_}),computePosition:{referenceElement:this,placement:"right-start",middleware:[offset$1({mainAxis:12,crossAxis:10}),shift({crossAxis:!0,padding:{top:PAGE_HEADER_HEIGHT+12,bottom:12,right:12}})],autoUpdate:!0},abortController:_})})}_onClickLangBtn(){if(this.readonly||this._langListAbortController)return;const _=new AbortController;this._langListAbortController=_,_.signal.addEventListener("abort",()=>{this._langListAbortController=void 0}),createLitPortal({template:({positionSlot:y})=>{const w=new LangList;return w.currentLanguageId=this._perviousLanguage.id,w.onSelectLanguage=$=>{getService$1("affine:code").setLang(this.model,$?$.id:null),_.abort()},w.onClose=()=>_.abort(),y.on(({placement:$})=>{w.placement=$}),w},computePosition:{referenceElement:this._langButton,placement:"bottom-start",middleware:[offset$1(4),flip(),size({padding:12,apply({availableHeight:y,elements:w}){Object.assign(w.floating.style,{height:"100%",maxHeight:`${y}px`})}})],autoUpdate:!0},abortController:_})}_curLanguageButtonTemplate(){const _=getStandardLanguage(this.model.language)??PLAIN_TEXT_REGISTRATION,y=_.displayName??_.id;return x$1`<div
      class="lang-list-wrapper"
      style="${this._showLangList?"visibility: visible;":""}"
    >
      <icon-button
        class="lang-button"
        data-testid="lang-button"
        width="auto"
        height="24px"
        ?hover=${this._showLangList}
        ?disabled=${this.readonly}
        @click=${this._onClickLangBtn}
      >
        ${y} ${this.readonly?A:ArrowDownIcon}
      </icon-button>
    </div>`}_updateLineNumbers(){const _=this.querySelector("#line-numbers");assertExists(_);const y=this._wrap?generateLineNumberRender():lineNumberRender;D(c$1(Array.from(this.querySelectorAll("v-line")),y),_)}render(){return x$1`<div class="affine-code-block-container">
      ${this._curLanguageButtonTemplate()}
      <div class="rich-text-container">
        <div id="line-numbers"></div>
        <rich-text
          .yText=${this.model.text.yText}
          .undoManager=${this.model.page.history}
          .textSchema=${this.textSchema}
          .readonly=${this.model.page.readonly}
        >
        </rich-text>
      </div>
      ${this.content}
      ${this.selected?.is("block")?x$1`<affine-block-selection></affine-block-selection>`:null}
    </div>`}};CodeBlockComponent.styles=i$5`
    code-block {
      position: relative;
      z-index: 1;
    }

    .affine-code-block-container {
      font-size: var(--affine-font-sm);
      line-height: var(--affine-line-height);
      position: relative;
      padding: 32px 0px 12px 0px;
      background: var(--affine-background-code-block);
      border-radius: 10px;
      margin-top: 24px;
      margin-bottom: 24px;
    }

    /* hover area */
    .affine-code-block-container::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 50px;
      height: 100%;
      transform: translateX(100%);
    }

    /* hover area */
    .affine-code-block-container::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 50px;
      height: 100%;
      transform: translateX(100%);
    }

    .affine-code-block-container .virgo-editor {
      font-family: var(--affine-font-code-family);
      font-variant-ligatures: none;
    }

    .affine-code-block-container .lang-list-wrapper {
      position: absolute;
      font-size: var(--affine-font-sm);
      line-height: var(--affine-line-height);
      top: 12px;
      left: 12px;
    }

    .affine-code-block-container > .lang-list-wrapper {
      visibility: hidden;
    }
    .affine-code-block-container:hover > .lang-list-wrapper {
      visibility: visible;
    }

    .affine-code-block-container > .lang-list-wrapper > .lang-button {
      display: flex;
      justify-content: flex-start;
      padding: 0 8px;
    }

    .affine-code-block-container rich-text {
      /* to make sure the resize observer can be triggered as expected */
      display: block;
      position: relative;
      width: 90%;
      overflow-x: auto;
      overflow-y: hidden;
      padding-bottom: 20px;
    }

    .affine-code-block-container .rich-text-container {
      position: relative;
      border-radius: 4px;
      padding: 4px 12px 4px 60px;
    }

    #line-numbers {
      position: absolute;
      text-align: right;
      left: 20px;
      line-height: var(--affine-line-height);
      color: var(--affine-text-secondary-color);
    }

    .affine-code-block-container .virgo-editor {
      width: 90%;
      margin: 0;
    }

    .affine-code-block-container affine-code-line span v-text {
      display: inline;
    }

    .affine-code-block-container affine-code-line span {
      white-space: pre;
    }

    .affine-code-block-container.wrap #line-numbers {
      top: calc(var(--affine-line-height) + 4px);
    }

    .affine-code-block-container.wrap #line-numbers > div {
      margin-top: calc(
        var(--top, 0) / var(--affine-zoom, 1) - var(--affine-line-height)
      );
    }

    .affine-code-block-container.wrap v-line > div {
      display: block;
    }

    .affine-code-block-container.wrap affine-code-line span {
      white-space: break-spaces;
    }

    .affine-code-block-container .virgo-editor::-webkit-scrollbar {
      display: none;
    }

    .code-block-option {
      box-shadow: var(--affine-shadow-2);
      border-radius: 8px;
      list-style: none;
      padding: 4px;
      width: 40px;
      background-color: var(--affine-background-overlay-panel-color);
      margin: 0;
    }

    ${tooltipStyle}
  `;__decorate$h([t$2()],CodeBlockComponent.prototype,"_wrap",void 0);__decorate$h([i$6(".lang-button")],CodeBlockComponent.prototype,"_langButton",void 0);__decorate$h([t$2()],CodeBlockComponent.prototype,"_langListAbortController",void 0);CodeBlockComponent=__decorate$h([e$7("affine-code")],CodeBlockComponent);function generateLineNumberRender(k=0){return function(y,w){const $={"--top":`${k}px`};return k=y.getBoundingClientRect().height,x$1`<div style=${o$4($)}>${w+1}</div>`}}function lineNumberRender(k,_){return x$1`<div>${_+1}</div>`}var __decorate$g=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let BlockSelection=class extends s$2{constructor(){super(...arguments),this.borderRadius=5,this.borderWidth=0}connectedCallback(){super.connectedCallback(),this.style.borderRadius=`${this.borderRadius}px`,this.borderWidth!==0&&(this.style.boxSizing="content-box",this.style.transform=`translate(-${this.borderWidth}px, -${this.borderWidth}px)`),this.style.borderWidth=`${this.borderWidth}px`}};BlockSelection.styles=i$5`
    :host {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-color: var(--affine-hover-color);
      border-color: transparent;
      border-style: solid;
    }
  `;__decorate$g([n$a({attribute:!1})],BlockSelection.prototype,"borderRadius",void 0);__decorate$g([n$a({attribute:!1})],BlockSelection.prototype,"borderWidth",void 0);BlockSelection=__decorate$g([e$7("affine-block-selection")],BlockSelection);class FileDropManager{constructor(_){this._point=null,this._result=null,this._handlers=[],this.onDragOver=y=>{if(y.preventDefault(),(y.dataTransfer?.effectAllowed??"none")!=="all")return;const{clientX:$,clientY:B}=y,R=new Point($,B),H=getClosestBlockElementByPoint(R.clone());let j=null,q=null;if(H){const X=getModelByBlockElement(H);j=calcDropTarget(R,X,H,[],1,"affine:image"),j&&(q=j.rect)}this._result=j,this._indicator.rect=q},this.onDrop=async y=>{y.preventDefault();const w=y.dataTransfer?.files;if(!w||!w.length){this._result=null,this._indicator.rect=null;return}const{clientX:$,clientY:B}=y;this._point=new Point($,B);const R=[],H=w.length;let j=0;for(;j<H;j++){const q=w[j],X=this.findFileHandler(q);if(!X){console.warn(`This ${q.type} is not currently supported.`);continue}const ee=await X(q);ee&&R.push(ee)}this._onDropEnd(this._point,R,this._result),this._point=null,this._result=null,this._indicator.rect=null},this._editor=_,this._indicator=document.querySelector("affine-drag-indicator"),this._indicator||(this._indicator=document.createElement("affine-drag-indicator"),document.body.appendChild(this._indicator))}_onDropEnd(_,y,w){const $=y.length;if(!$)return;const{page:B,mode:R}=this._editor,H=B.root;assertExists(H);const j=R==="page";let q=w?.type||"none",X=w?.modelState.model||null;if(q==="none"&&j&&(q="after",!X)){const ie=H.children[H.children.length-1];if(!matchFlavours(ie,["affine:note"]))throw new Error("The last block is not a note block.");X=ie.lastItem()}q==="database"&&(q="after");let ee,te;if(B.captureSync(),q!=="none"&&X){const ie=B.getParent(X);assertExists(ie);const ae=B.addSiblingBlocks(X,y,q);te=ae[ae.length-1],j&&asyncFocusRichText(B,te);return}if(j)return;const ne=getBlockElementByModel(H);assertExists(ne);let oe=0;for(;oe<$;oe++){const ie=y[oe];ie.flavour==="affine:image"&&(ee=ne.addImage(ie,_).noteId)}!ee||!te||ne.setSelection(ee,!0,te,_)}findFileHandler(_){return this._handlers.find(w=>w.matcher(_))?.handler}register(_){this._handlers=this._handlers.filter(({name:y})=>y!==_.name),this._handlers.push(_)}}var __decorate$f=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let Loader=class extends s$2{constructor(){super(),this.hostModel=null,this.radius="8px",this.width="150px"}connectedCallback(){super.connectedCallback(),this.hostModel&&(this.setAttribute(BLOCK_ID_ATTR,this.hostModel.id),this.setAttribute(BLOCK_SERVICE_LOADING_ATTR,"true"));const _=this.width;this.style.setProperty("--loader-width",typeof _=="string"?_:`${_}px`)}render(){return x$1`
      <div class="load-container">
        <div class="load load1"></div>
        <div class="load load2"></div>
        <div class="load"></div>
      </div>
    `}};Loader.styles=i$5`
    .load-container {
      margin: 10px auto;
      width: var(--loader-width);
      text-align: center;
    }

    .load-container .load {
      width: 8px;
      height: 8px;
      background-color: var(--affine-text-primary-color);

      border-radius: 100%;
      display: inline-block;
      -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
      animation: bouncedelay 1.4s infinite ease-in-out;
      /* Prevent first note from flickering when animation starts */
      -webkit-animation-fill-mode: both;
      animation-fill-mode: both;
    }
    .load-container .load1 {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }
    .load-container .load2 {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }

    @-webkit-keyframes bouncedelay {
      0%,
      80%,
      100% {
        -webkit-transform: scale(0.625);
      }
      40% {
        -webkit-transform: scale(1);
      }
    }

    @keyframes bouncedelay {
      0%,
      80%,
      100% {
        transform: scale(0);
        -webkit-transform: scale(0.625);
      }
      40% {
        transform: scale(1);
        -webkit-transform: scale(1);
      }
    }
  `;__decorate$f([n$a({attribute:!1})],Loader.prototype,"hostModel",void 0);__decorate$f([n$a({attribute:!1})],Loader.prototype,"radius",void 0);__decorate$f([n$a({attribute:!1})],Loader.prototype,"width",void 0);Loader=__decorate$f([e$7("loader-element")],Loader);var jszip_min$1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(k,_){(function(y){k.exports=y()})(function(){return function y(w,$,B){function R(q,X){if(!$[q]){if(!w[q]){var ee=typeof commonjsRequire=="function"&&commonjsRequire;if(!X&&ee)return ee(q,!0);if(H)return H(q,!0);var te=new Error("Cannot find module '"+q+"'");throw te.code="MODULE_NOT_FOUND",te}var ne=$[q]={exports:{}};w[q][0].call(ne.exports,function(oe){var ie=w[q][1][oe];return R(ie||oe)},ne,ne.exports,y,w,$,B)}return $[q].exports}for(var H=typeof commonjsRequire=="function"&&commonjsRequire,j=0;j<B.length;j++)R(B[j]);return R}({1:[function(y,w,$){var B=y("./utils"),R=y("./support"),H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";$.encode=function(j){for(var q,X,ee,te,ne,oe,ie,ae=[],re=0,se=j.length,le=se,ue=B.getTypeOf(j)!=="string";re<j.length;)le=se-re,ee=ue?(q=j[re++],X=re<se?j[re++]:0,re<se?j[re++]:0):(q=j.charCodeAt(re++),X=re<se?j.charCodeAt(re++):0,re<se?j.charCodeAt(re++):0),te=q>>2,ne=(3&q)<<4|X>>4,oe=1<le?(15&X)<<2|ee>>6:64,ie=2<le?63&ee:64,ae.push(H.charAt(te)+H.charAt(ne)+H.charAt(oe)+H.charAt(ie));return ae.join("")},$.decode=function(j){var q,X,ee,te,ne,oe,ie=0,ae=0,re="data:";if(j.substr(0,re.length)===re)throw new Error("Invalid base64 input, it looks like a data url.");var se,le=3*(j=j.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(j.charAt(j.length-1)===H.charAt(64)&&le--,j.charAt(j.length-2)===H.charAt(64)&&le--,le%1!=0)throw new Error("Invalid base64 input, bad content length.");for(se=R.uint8array?new Uint8Array(0|le):new Array(0|le);ie<j.length;)q=H.indexOf(j.charAt(ie++))<<2|(te=H.indexOf(j.charAt(ie++)))>>4,X=(15&te)<<4|(ne=H.indexOf(j.charAt(ie++)))>>2,ee=(3&ne)<<6|(oe=H.indexOf(j.charAt(ie++))),se[ae++]=q,ne!==64&&(se[ae++]=X),oe!==64&&(se[ae++]=ee);return se}},{"./support":30,"./utils":32}],2:[function(y,w,$){var B=y("./external"),R=y("./stream/DataWorker"),H=y("./stream/Crc32Probe"),j=y("./stream/DataLengthProbe");function q(X,ee,te,ne,oe){this.compressedSize=X,this.uncompressedSize=ee,this.crc32=te,this.compression=ne,this.compressedContent=oe}q.prototype={getContentWorker:function(){var X=new R(B.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new j("data_length")),ee=this;return X.on("end",function(){if(this.streamInfo.data_length!==ee.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),X},getCompressedWorker:function(){return new R(B.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},q.createWorkerFrom=function(X,ee,te){return X.pipe(new H).pipe(new j("uncompressedSize")).pipe(ee.compressWorker(te)).pipe(new j("compressedSize")).withStreamInfo("compression",ee)},w.exports=q},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(y,w,$){var B=y("./stream/GenericWorker");$.STORE={magic:"\0\0",compressWorker:function(){return new B("STORE compression")},uncompressWorker:function(){return new B("STORE decompression")}},$.DEFLATE=y("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(y,w,$){var B=y("./utils"),R=function(){for(var H,j=[],q=0;q<256;q++){H=q;for(var X=0;X<8;X++)H=1&H?3988292384^H>>>1:H>>>1;j[q]=H}return j}();w.exports=function(H,j){return H!==void 0&&H.length?B.getTypeOf(H)!=="string"?function(q,X,ee,te){var ne=R,oe=te+ee;q^=-1;for(var ie=te;ie<oe;ie++)q=q>>>8^ne[255&(q^X[ie])];return-1^q}(0|j,H,H.length,0):function(q,X,ee,te){var ne=R,oe=te+ee;q^=-1;for(var ie=te;ie<oe;ie++)q=q>>>8^ne[255&(q^X.charCodeAt(ie))];return-1^q}(0|j,H,H.length,0):0}},{"./utils":32}],5:[function(y,w,$){$.base64=!1,$.binary=!1,$.dir=!1,$.createFolders=!0,$.date=null,$.compression=null,$.compressionOptions=null,$.comment=null,$.unixPermissions=null,$.dosPermissions=null},{}],6:[function(y,w,$){var B=null;B=typeof Promise<"u"?Promise:y("lie"),w.exports={Promise:B}},{lie:37}],7:[function(y,w,$){var B=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",R=y("pako"),H=y("./utils"),j=y("./stream/GenericWorker"),q=B?"uint8array":"array";function X(ee,te){j.call(this,"FlateWorker/"+ee),this._pako=null,this._pakoAction=ee,this._pakoOptions=te,this.meta={}}$.magic="\b\0",H.inherits(X,j),X.prototype.processChunk=function(ee){this.meta=ee.meta,this._pako===null&&this._createPako(),this._pako.push(H.transformTo(q,ee.data),!1)},X.prototype.flush=function(){j.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},X.prototype.cleanUp=function(){j.prototype.cleanUp.call(this),this._pako=null},X.prototype._createPako=function(){this._pako=new R[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var ee=this;this._pako.onData=function(te){ee.push({data:te,meta:ee.meta})}},$.compressWorker=function(ee){return new X("Deflate",ee)},$.uncompressWorker=function(){return new X("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(y,w,$){function B(ne,oe){var ie,ae="";for(ie=0;ie<oe;ie++)ae+=String.fromCharCode(255&ne),ne>>>=8;return ae}function R(ne,oe,ie,ae,re,se){var le,ue,he=ne.file,ce=ne.compression,ge=se!==q.utf8encode,be=H.transformTo("string",se(he.name)),fe=H.transformTo("string",q.utf8encode(he.name)),we=he.comment,Ce=H.transformTo("string",se(we)),ve=H.transformTo("string",q.utf8encode(we)),ke=fe.length!==he.name.length,me=ve.length!==we.length,Ie="",Fe="",Be="",Ze=he.dir,Re=he.date,qe={crc32:0,compressedSize:0,uncompressedSize:0};oe&&!ie||(qe.crc32=ne.crc32,qe.compressedSize=ne.compressedSize,qe.uncompressedSize=ne.uncompressedSize);var Me=0;oe&&(Me|=8),ge||!ke&&!me||(Me|=2048);var Pe=0,Qe=0;Ze&&(Pe|=16),re==="UNIX"?(Qe=798,Pe|=function(Ue,tt){var Ve=Ue;return Ue||(Ve=tt?16893:33204),(65535&Ve)<<16}(he.unixPermissions,Ze)):(Qe=20,Pe|=function(Ue){return 63&(Ue||0)}(he.dosPermissions)),le=Re.getUTCHours(),le<<=6,le|=Re.getUTCMinutes(),le<<=5,le|=Re.getUTCSeconds()/2,ue=Re.getUTCFullYear()-1980,ue<<=4,ue|=Re.getUTCMonth()+1,ue<<=5,ue|=Re.getUTCDate(),ke&&(Fe=B(1,1)+B(X(be),4)+fe,Ie+="up"+B(Fe.length,2)+Fe),me&&(Be=B(1,1)+B(X(Ce),4)+ve,Ie+="uc"+B(Be.length,2)+Be);var je="";return je+=`
\0`,je+=B(Me,2),je+=ce.magic,je+=B(le,2),je+=B(ue,2),je+=B(qe.crc32,4),je+=B(qe.compressedSize,4),je+=B(qe.uncompressedSize,4),je+=B(be.length,2),je+=B(Ie.length,2),{fileRecord:ee.LOCAL_FILE_HEADER+je+be+Ie,dirRecord:ee.CENTRAL_FILE_HEADER+B(Qe,2)+je+B(Ce.length,2)+"\0\0\0\0"+B(Pe,4)+B(ae,4)+be+Ie+Ce}}var H=y("../utils"),j=y("../stream/GenericWorker"),q=y("../utf8"),X=y("../crc32"),ee=y("../signature");function te(ne,oe,ie,ae){j.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=oe,this.zipPlatform=ie,this.encodeFileName=ae,this.streamFiles=ne,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}H.inherits(te,j),te.prototype.push=function(ne){var oe=ne.meta.percent||0,ie=this.entriesCount,ae=this._sources.length;this.accumulate?this.contentBuffer.push(ne):(this.bytesWritten+=ne.data.length,j.prototype.push.call(this,{data:ne.data,meta:{currentFile:this.currentFile,percent:ie?(oe+100*(ie-ae-1))/ie:100}}))},te.prototype.openedSource=function(ne){this.currentSourceOffset=this.bytesWritten,this.currentFile=ne.file.name;var oe=this.streamFiles&&!ne.file.dir;if(oe){var ie=R(ne,oe,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:ie.fileRecord,meta:{percent:0}})}else this.accumulate=!0},te.prototype.closedSource=function(ne){this.accumulate=!1;var oe=this.streamFiles&&!ne.file.dir,ie=R(ne,oe,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(ie.dirRecord),oe)this.push({data:function(ae){return ee.DATA_DESCRIPTOR+B(ae.crc32,4)+B(ae.compressedSize,4)+B(ae.uncompressedSize,4)}(ne),meta:{percent:100}});else for(this.push({data:ie.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},te.prototype.flush=function(){for(var ne=this.bytesWritten,oe=0;oe<this.dirRecords.length;oe++)this.push({data:this.dirRecords[oe],meta:{percent:100}});var ie=this.bytesWritten-ne,ae=function(re,se,le,ue,he){var ce=H.transformTo("string",he(ue));return ee.CENTRAL_DIRECTORY_END+"\0\0\0\0"+B(re,2)+B(re,2)+B(se,4)+B(le,4)+B(ce.length,2)+ce}(this.dirRecords.length,ie,ne,this.zipComment,this.encodeFileName);this.push({data:ae,meta:{percent:100}})},te.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},te.prototype.registerPrevious=function(ne){this._sources.push(ne);var oe=this;return ne.on("data",function(ie){oe.processChunk(ie)}),ne.on("end",function(){oe.closedSource(oe.previous.streamInfo),oe._sources.length?oe.prepareNextSource():oe.end()}),ne.on("error",function(ie){oe.error(ie)}),this},te.prototype.resume=function(){return!!j.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},te.prototype.error=function(ne){var oe=this._sources;if(!j.prototype.error.call(this,ne))return!1;for(var ie=0;ie<oe.length;ie++)try{oe[ie].error(ne)}catch{}return!0},te.prototype.lock=function(){j.prototype.lock.call(this);for(var ne=this._sources,oe=0;oe<ne.length;oe++)ne[oe].lock()},w.exports=te},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(y,w,$){var B=y("../compressions"),R=y("./ZipFileWorker");$.generateWorker=function(H,j,q){var X=new R(j.streamFiles,q,j.platform,j.encodeFileName),ee=0;try{H.forEach(function(te,ne){ee++;var oe=function(se,le){var ue=se||le,he=B[ue];if(!he)throw new Error(ue+" is not a valid compression method !");return he}(ne.options.compression,j.compression),ie=ne.options.compressionOptions||j.compressionOptions||{},ae=ne.dir,re=ne.date;ne._compressWorker(oe,ie).withStreamInfo("file",{name:te,dir:ae,date:re,comment:ne.comment||"",unixPermissions:ne.unixPermissions,dosPermissions:ne.dosPermissions}).pipe(X)}),X.entriesCount=ee}catch(te){X.error(te)}return X}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(y,w,$){function B(){if(!(this instanceof B))return new B;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var R=new B;for(var H in this)typeof this[H]!="function"&&(R[H]=this[H]);return R}}(B.prototype=y("./object")).loadAsync=y("./load"),B.support=y("./support"),B.defaults=y("./defaults"),B.version="3.10.1",B.loadAsync=function(R,H){return new B().loadAsync(R,H)},B.external=y("./external"),w.exports=B},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(y,w,$){var B=y("./utils"),R=y("./external"),H=y("./utf8"),j=y("./zipEntries"),q=y("./stream/Crc32Probe"),X=y("./nodejsUtils");function ee(te){return new R.Promise(function(ne,oe){var ie=te.decompressed.getContentWorker().pipe(new q);ie.on("error",function(ae){oe(ae)}).on("end",function(){ie.streamInfo.crc32!==te.decompressed.crc32?oe(new Error("Corrupted zip : CRC32 mismatch")):ne()}).resume()})}w.exports=function(te,ne){var oe=this;return ne=B.extend(ne||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:H.utf8decode}),X.isNode&&X.isStream(te)?R.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):B.prepareContent("the loaded zip file",te,!0,ne.optimizedBinaryString,ne.base64).then(function(ie){var ae=new j(ne);return ae.load(ie),ae}).then(function(ie){var ae=[R.Promise.resolve(ie)],re=ie.files;if(ne.checkCRC32)for(var se=0;se<re.length;se++)ae.push(ee(re[se]));return R.Promise.all(ae)}).then(function(ie){for(var ae=ie.shift(),re=ae.files,se=0;se<re.length;se++){var le=re[se],ue=le.fileNameStr,he=B.resolve(le.fileNameStr);oe.file(he,le.decompressed,{binary:!0,optimizedBinaryString:!0,date:le.date,dir:le.dir,comment:le.fileCommentStr.length?le.fileCommentStr:null,unixPermissions:le.unixPermissions,dosPermissions:le.dosPermissions,createFolders:ne.createFolders}),le.dir||(oe.file(he).unsafeOriginalName=ue)}return ae.zipComment.length&&(oe.comment=ae.zipComment),oe})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(y,w,$){var B=y("../utils"),R=y("../stream/GenericWorker");function H(j,q){R.call(this,"Nodejs stream input adapter for "+j),this._upstreamEnded=!1,this._bindStream(q)}B.inherits(H,R),H.prototype._bindStream=function(j){var q=this;(this._stream=j).pause(),j.on("data",function(X){q.push({data:X,meta:{percent:0}})}).on("error",function(X){q.isPaused?this.generatedError=X:q.error(X)}).on("end",function(){q.isPaused?q._upstreamEnded=!0:q.end()})},H.prototype.pause=function(){return!!R.prototype.pause.call(this)&&(this._stream.pause(),!0)},H.prototype.resume=function(){return!!R.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},w.exports=H},{"../stream/GenericWorker":28,"../utils":32}],13:[function(y,w,$){var B=y("readable-stream").Readable;function R(H,j,q){B.call(this,j),this._helper=H;var X=this;H.on("data",function(ee,te){X.push(ee)||X._helper.pause(),q&&q(te)}).on("error",function(ee){X.emit("error",ee)}).on("end",function(){X.push(null)})}y("../utils").inherits(R,B),R.prototype._read=function(){this._helper.resume()},w.exports=R},{"../utils":32,"readable-stream":16}],14:[function(y,w,$){w.exports={isNode:typeof Buffer<"u",newBufferFrom:function(B,R){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(B,R);if(typeof B=="number")throw new Error('The "data" argument must not be a number');return new Buffer(B,R)},allocBuffer:function(B){if(Buffer.alloc)return Buffer.alloc(B);var R=new Buffer(B);return R.fill(0),R},isBuffer:function(B){return Buffer.isBuffer(B)},isStream:function(B){return B&&typeof B.on=="function"&&typeof B.pause=="function"&&typeof B.resume=="function"}}},{}],15:[function(y,w,$){function B(he,ce,ge){var be,fe=H.getTypeOf(ce),we=H.extend(ge||{},X);we.date=we.date||new Date,we.compression!==null&&(we.compression=we.compression.toUpperCase()),typeof we.unixPermissions=="string"&&(we.unixPermissions=parseInt(we.unixPermissions,8)),we.unixPermissions&&16384&we.unixPermissions&&(we.dir=!0),we.dosPermissions&&16&we.dosPermissions&&(we.dir=!0),we.dir&&(he=re(he)),we.createFolders&&(be=ae(he))&&se.call(this,be,!0);var Ce=fe==="string"&&we.binary===!1&&we.base64===!1;ge&&ge.binary!==void 0||(we.binary=!Ce),(ce instanceof ee&&ce.uncompressedSize===0||we.dir||!ce||ce.length===0)&&(we.base64=!1,we.binary=!0,ce="",we.compression="STORE",fe="string");var ve=null;ve=ce instanceof ee||ce instanceof j?ce:oe.isNode&&oe.isStream(ce)?new ie(he,ce):H.prepareContent(he,ce,we.binary,we.optimizedBinaryString,we.base64);var ke=new te(he,ve,we);this.files[he]=ke}var R=y("./utf8"),H=y("./utils"),j=y("./stream/GenericWorker"),q=y("./stream/StreamHelper"),X=y("./defaults"),ee=y("./compressedObject"),te=y("./zipObject"),ne=y("./generate"),oe=y("./nodejsUtils"),ie=y("./nodejs/NodejsStreamInputAdapter"),ae=function(he){he.slice(-1)==="/"&&(he=he.substring(0,he.length-1));var ce=he.lastIndexOf("/");return 0<ce?he.substring(0,ce):""},re=function(he){return he.slice(-1)!=="/"&&(he+="/"),he},se=function(he,ce){return ce=ce!==void 0?ce:X.createFolders,he=re(he),this.files[he]||B.call(this,he,null,{dir:!0,createFolders:ce}),this.files[he]};function le(he){return Object.prototype.toString.call(he)==="[object RegExp]"}var ue={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(he){var ce,ge,be;for(ce in this.files)be=this.files[ce],(ge=ce.slice(this.root.length,ce.length))&&ce.slice(0,this.root.length)===this.root&&he(ge,be)},filter:function(he){var ce=[];return this.forEach(function(ge,be){he(ge,be)&&ce.push(be)}),ce},file:function(he,ce,ge){if(arguments.length!==1)return he=this.root+he,B.call(this,he,ce,ge),this;if(le(he)){var be=he;return this.filter(function(we,Ce){return!Ce.dir&&be.test(we)})}var fe=this.files[this.root+he];return fe&&!fe.dir?fe:null},folder:function(he){if(!he)return this;if(le(he))return this.filter(function(fe,we){return we.dir&&he.test(fe)});var ce=this.root+he,ge=se.call(this,ce),be=this.clone();return be.root=ge.name,be},remove:function(he){he=this.root+he;var ce=this.files[he];if(ce||(he.slice(-1)!=="/"&&(he+="/"),ce=this.files[he]),ce&&!ce.dir)delete this.files[he];else for(var ge=this.filter(function(fe,we){return we.name.slice(0,he.length)===he}),be=0;be<ge.length;be++)delete this.files[ge[be].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(he){var ce,ge={};try{if((ge=H.extend(he||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:R.utf8encode})).type=ge.type.toLowerCase(),ge.compression=ge.compression.toUpperCase(),ge.type==="binarystring"&&(ge.type="string"),!ge.type)throw new Error("No output type specified.");H.checkSupport(ge.type),ge.platform!=="darwin"&&ge.platform!=="freebsd"&&ge.platform!=="linux"&&ge.platform!=="sunos"||(ge.platform="UNIX"),ge.platform==="win32"&&(ge.platform="DOS");var be=ge.comment||this.comment||"";ce=ne.generateWorker(this,ge,be)}catch(fe){(ce=new j("error")).error(fe)}return new q(ce,ge.type||"string",ge.mimeType)},generateAsync:function(he,ce){return this.generateInternalStream(he).accumulate(ce)},generateNodeStream:function(he,ce){return(he=he||{}).type||(he.type="nodebuffer"),this.generateInternalStream(he).toNodejsStream(ce)}};w.exports=ue},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(y,w,$){w.exports=y("stream")},{stream:void 0}],17:[function(y,w,$){var B=y("./DataReader");function R(H){B.call(this,H);for(var j=0;j<this.data.length;j++)H[j]=255&H[j]}y("../utils").inherits(R,B),R.prototype.byteAt=function(H){return this.data[this.zero+H]},R.prototype.lastIndexOfSignature=function(H){for(var j=H.charCodeAt(0),q=H.charCodeAt(1),X=H.charCodeAt(2),ee=H.charCodeAt(3),te=this.length-4;0<=te;--te)if(this.data[te]===j&&this.data[te+1]===q&&this.data[te+2]===X&&this.data[te+3]===ee)return te-this.zero;return-1},R.prototype.readAndCheckSignature=function(H){var j=H.charCodeAt(0),q=H.charCodeAt(1),X=H.charCodeAt(2),ee=H.charCodeAt(3),te=this.readData(4);return j===te[0]&&q===te[1]&&X===te[2]&&ee===te[3]},R.prototype.readData=function(H){if(this.checkOffset(H),H===0)return[];var j=this.data.slice(this.zero+this.index,this.zero+this.index+H);return this.index+=H,j},w.exports=R},{"../utils":32,"./DataReader":18}],18:[function(y,w,$){var B=y("../utils");function R(H){this.data=H,this.length=H.length,this.index=0,this.zero=0}R.prototype={checkOffset:function(H){this.checkIndex(this.index+H)},checkIndex:function(H){if(this.length<this.zero+H||H<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+H+"). Corrupted zip ?")},setIndex:function(H){this.checkIndex(H),this.index=H},skip:function(H){this.setIndex(this.index+H)},byteAt:function(){},readInt:function(H){var j,q=0;for(this.checkOffset(H),j=this.index+H-1;j>=this.index;j--)q=(q<<8)+this.byteAt(j);return this.index+=H,q},readString:function(H){return B.transformTo("string",this.readData(H))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var H=this.readInt(4);return new Date(Date.UTC(1980+(H>>25&127),(H>>21&15)-1,H>>16&31,H>>11&31,H>>5&63,(31&H)<<1))}},w.exports=R},{"../utils":32}],19:[function(y,w,$){var B=y("./Uint8ArrayReader");function R(H){B.call(this,H)}y("../utils").inherits(R,B),R.prototype.readData=function(H){this.checkOffset(H);var j=this.data.slice(this.zero+this.index,this.zero+this.index+H);return this.index+=H,j},w.exports=R},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(y,w,$){var B=y("./DataReader");function R(H){B.call(this,H)}y("../utils").inherits(R,B),R.prototype.byteAt=function(H){return this.data.charCodeAt(this.zero+H)},R.prototype.lastIndexOfSignature=function(H){return this.data.lastIndexOf(H)-this.zero},R.prototype.readAndCheckSignature=function(H){return H===this.readData(4)},R.prototype.readData=function(H){this.checkOffset(H);var j=this.data.slice(this.zero+this.index,this.zero+this.index+H);return this.index+=H,j},w.exports=R},{"../utils":32,"./DataReader":18}],21:[function(y,w,$){var B=y("./ArrayReader");function R(H){B.call(this,H)}y("../utils").inherits(R,B),R.prototype.readData=function(H){if(this.checkOffset(H),H===0)return new Uint8Array(0);var j=this.data.subarray(this.zero+this.index,this.zero+this.index+H);return this.index+=H,j},w.exports=R},{"../utils":32,"./ArrayReader":17}],22:[function(y,w,$){var B=y("../utils"),R=y("../support"),H=y("./ArrayReader"),j=y("./StringReader"),q=y("./NodeBufferReader"),X=y("./Uint8ArrayReader");w.exports=function(ee){var te=B.getTypeOf(ee);return B.checkSupport(te),te!=="string"||R.uint8array?te==="nodebuffer"?new q(ee):R.uint8array?new X(B.transformTo("uint8array",ee)):new H(B.transformTo("array",ee)):new j(ee)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(y,w,$){$.LOCAL_FILE_HEADER="PK",$.CENTRAL_FILE_HEADER="PK",$.CENTRAL_DIRECTORY_END="PK",$.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",$.ZIP64_CENTRAL_DIRECTORY_END="PK",$.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(y,w,$){var B=y("./GenericWorker"),R=y("../utils");function H(j){B.call(this,"ConvertWorker to "+j),this.destType=j}R.inherits(H,B),H.prototype.processChunk=function(j){this.push({data:R.transformTo(this.destType,j.data),meta:j.meta})},w.exports=H},{"../utils":32,"./GenericWorker":28}],25:[function(y,w,$){var B=y("./GenericWorker"),R=y("../crc32");function H(){B.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}y("../utils").inherits(H,B),H.prototype.processChunk=function(j){this.streamInfo.crc32=R(j.data,this.streamInfo.crc32||0),this.push(j)},w.exports=H},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(y,w,$){var B=y("../utils"),R=y("./GenericWorker");function H(j){R.call(this,"DataLengthProbe for "+j),this.propName=j,this.withStreamInfo(j,0)}B.inherits(H,R),H.prototype.processChunk=function(j){if(j){var q=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=q+j.data.length}R.prototype.processChunk.call(this,j)},w.exports=H},{"../utils":32,"./GenericWorker":28}],27:[function(y,w,$){var B=y("../utils"),R=y("./GenericWorker");function H(j){R.call(this,"DataWorker");var q=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,j.then(function(X){q.dataIsReady=!0,q.data=X,q.max=X&&X.length||0,q.type=B.getTypeOf(X),q.isPaused||q._tickAndRepeat()},function(X){q.error(X)})}B.inherits(H,R),H.prototype.cleanUp=function(){R.prototype.cleanUp.call(this),this.data=null},H.prototype.resume=function(){return!!R.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,B.delay(this._tickAndRepeat,[],this)),!0)},H.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(B.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},H.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var j=null,q=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":j=this.data.substring(this.index,q);break;case"uint8array":j=this.data.subarray(this.index,q);break;case"array":case"nodebuffer":j=this.data.slice(this.index,q)}return this.index=q,this.push({data:j,meta:{percent:this.max?this.index/this.max*100:0}})},w.exports=H},{"../utils":32,"./GenericWorker":28}],28:[function(y,w,$){function B(R){this.name=R||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}B.prototype={push:function(R){this.emit("data",R)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(R){this.emit("error",R)}return!0},error:function(R){return!this.isFinished&&(this.isPaused?this.generatedError=R:(this.isFinished=!0,this.emit("error",R),this.previous&&this.previous.error(R),this.cleanUp()),!0)},on:function(R,H){return this._listeners[R].push(H),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(R,H){if(this._listeners[R])for(var j=0;j<this._listeners[R].length;j++)this._listeners[R][j].call(this,H)},pipe:function(R){return R.registerPrevious(this)},registerPrevious:function(R){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=R.streamInfo,this.mergeStreamInfo(),this.previous=R;var H=this;return R.on("data",function(j){H.processChunk(j)}),R.on("end",function(){H.end()}),R.on("error",function(j){H.error(j)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var R=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),R=!0),this.previous&&this.previous.resume(),!R},flush:function(){},processChunk:function(R){this.push(R)},withStreamInfo:function(R,H){return this.extraStreamInfo[R]=H,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var R in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,R)&&(this.streamInfo[R]=this.extraStreamInfo[R])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var R="Worker "+this.name;return this.previous?this.previous+" -> "+R:R}},w.exports=B},{}],29:[function(y,w,$){var B=y("../utils"),R=y("./ConvertWorker"),H=y("./GenericWorker"),j=y("../base64"),q=y("../support"),X=y("../external"),ee=null;if(q.nodestream)try{ee=y("../nodejs/NodejsStreamOutputAdapter")}catch{}function te(oe,ie){return new X.Promise(function(ae,re){var se=[],le=oe._internalType,ue=oe._outputType,he=oe._mimeType;oe.on("data",function(ce,ge){se.push(ce),ie&&ie(ge)}).on("error",function(ce){se=[],re(ce)}).on("end",function(){try{var ce=function(ge,be,fe){switch(ge){case"blob":return B.newBlob(B.transformTo("arraybuffer",be),fe);case"base64":return j.encode(be);default:return B.transformTo(ge,be)}}(ue,function(ge,be){var fe,we=0,Ce=null,ve=0;for(fe=0;fe<be.length;fe++)ve+=be[fe].length;switch(ge){case"string":return be.join("");case"array":return Array.prototype.concat.apply([],be);case"uint8array":for(Ce=new Uint8Array(ve),fe=0;fe<be.length;fe++)Ce.set(be[fe],we),we+=be[fe].length;return Ce;case"nodebuffer":return Buffer.concat(be);default:throw new Error("concat : unsupported type '"+ge+"'")}}(le,se),he);ae(ce)}catch(ge){re(ge)}se=[]}).resume()})}function ne(oe,ie,ae){var re=ie;switch(ie){case"blob":case"arraybuffer":re="uint8array";break;case"base64":re="string"}try{this._internalType=re,this._outputType=ie,this._mimeType=ae,B.checkSupport(re),this._worker=oe.pipe(new R(re)),oe.lock()}catch(se){this._worker=new H("error"),this._worker.error(se)}}ne.prototype={accumulate:function(oe){return te(this,oe)},on:function(oe,ie){var ae=this;return oe==="data"?this._worker.on(oe,function(re){ie.call(ae,re.data,re.meta)}):this._worker.on(oe,function(){B.delay(ie,arguments,ae)}),this},resume:function(){return B.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(oe){if(B.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new ee(this,{objectMode:this._outputType!=="nodebuffer"},oe)}},w.exports=ne},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(y,w,$){if($.base64=!0,$.array=!0,$.string=!0,$.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",$.nodebuffer=typeof Buffer<"u",$.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")$.blob=!1;else{var B=new ArrayBuffer(0);try{$.blob=new Blob([B],{type:"application/zip"}).size===0}catch{try{var R=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);R.append(B),$.blob=R.getBlob("application/zip").size===0}catch{$.blob=!1}}}try{$.nodestream=!!y("readable-stream").Readable}catch{$.nodestream=!1}},{"readable-stream":16}],31:[function(y,w,$){for(var B=y("./utils"),R=y("./support"),H=y("./nodejsUtils"),j=y("./stream/GenericWorker"),q=new Array(256),X=0;X<256;X++)q[X]=252<=X?6:248<=X?5:240<=X?4:224<=X?3:192<=X?2:1;q[254]=q[254]=1;function ee(){j.call(this,"utf-8 decode"),this.leftOver=null}function te(){j.call(this,"utf-8 encode")}$.utf8encode=function(ne){return R.nodebuffer?H.newBufferFrom(ne,"utf-8"):function(oe){var ie,ae,re,se,le,ue=oe.length,he=0;for(se=0;se<ue;se++)(64512&(ae=oe.charCodeAt(se)))==55296&&se+1<ue&&(64512&(re=oe.charCodeAt(se+1)))==56320&&(ae=65536+(ae-55296<<10)+(re-56320),se++),he+=ae<128?1:ae<2048?2:ae<65536?3:4;for(ie=R.uint8array?new Uint8Array(he):new Array(he),se=le=0;le<he;se++)(64512&(ae=oe.charCodeAt(se)))==55296&&se+1<ue&&(64512&(re=oe.charCodeAt(se+1)))==56320&&(ae=65536+(ae-55296<<10)+(re-56320),se++),ae<128?ie[le++]=ae:(ae<2048?ie[le++]=192|ae>>>6:(ae<65536?ie[le++]=224|ae>>>12:(ie[le++]=240|ae>>>18,ie[le++]=128|ae>>>12&63),ie[le++]=128|ae>>>6&63),ie[le++]=128|63&ae);return ie}(ne)},$.utf8decode=function(ne){return R.nodebuffer?B.transformTo("nodebuffer",ne).toString("utf-8"):function(oe){var ie,ae,re,se,le=oe.length,ue=new Array(2*le);for(ie=ae=0;ie<le;)if((re=oe[ie++])<128)ue[ae++]=re;else if(4<(se=q[re]))ue[ae++]=65533,ie+=se-1;else{for(re&=se===2?31:se===3?15:7;1<se&&ie<le;)re=re<<6|63&oe[ie++],se--;1<se?ue[ae++]=65533:re<65536?ue[ae++]=re:(re-=65536,ue[ae++]=55296|re>>10&1023,ue[ae++]=56320|1023&re)}return ue.length!==ae&&(ue.subarray?ue=ue.subarray(0,ae):ue.length=ae),B.applyFromCharCode(ue)}(ne=B.transformTo(R.uint8array?"uint8array":"array",ne))},B.inherits(ee,j),ee.prototype.processChunk=function(ne){var oe=B.transformTo(R.uint8array?"uint8array":"array",ne.data);if(this.leftOver&&this.leftOver.length){if(R.uint8array){var ie=oe;(oe=new Uint8Array(ie.length+this.leftOver.length)).set(this.leftOver,0),oe.set(ie,this.leftOver.length)}else oe=this.leftOver.concat(oe);this.leftOver=null}var ae=function(se,le){var ue;for((le=le||se.length)>se.length&&(le=se.length),ue=le-1;0<=ue&&(192&se[ue])==128;)ue--;return ue<0||ue===0?le:ue+q[se[ue]]>le?ue:le}(oe),re=oe;ae!==oe.length&&(R.uint8array?(re=oe.subarray(0,ae),this.leftOver=oe.subarray(ae,oe.length)):(re=oe.slice(0,ae),this.leftOver=oe.slice(ae,oe.length))),this.push({data:$.utf8decode(re),meta:ne.meta})},ee.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:$.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},$.Utf8DecodeWorker=ee,B.inherits(te,j),te.prototype.processChunk=function(ne){this.push({data:$.utf8encode(ne.data),meta:ne.meta})},$.Utf8EncodeWorker=te},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(y,w,$){var B=y("./support"),R=y("./base64"),H=y("./nodejsUtils"),j=y("./external");function q(ie){return ie}function X(ie,ae){for(var re=0;re<ie.length;++re)ae[re]=255&ie.charCodeAt(re);return ae}y("setimmediate"),$.newBlob=function(ie,ae){$.checkSupport("blob");try{return new Blob([ie],{type:ae})}catch{try{var re=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return re.append(ie),re.getBlob(ae)}catch{throw new Error("Bug : can't construct the Blob.")}}};var ee={stringifyByChunk:function(ie,ae,re){var se=[],le=0,ue=ie.length;if(ue<=re)return String.fromCharCode.apply(null,ie);for(;le<ue;)ae==="array"||ae==="nodebuffer"?se.push(String.fromCharCode.apply(null,ie.slice(le,Math.min(le+re,ue)))):se.push(String.fromCharCode.apply(null,ie.subarray(le,Math.min(le+re,ue)))),le+=re;return se.join("")},stringifyByChar:function(ie){for(var ae="",re=0;re<ie.length;re++)ae+=String.fromCharCode(ie[re]);return ae},applyCanBeUsed:{uint8array:function(){try{return B.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return B.nodebuffer&&String.fromCharCode.apply(null,H.allocBuffer(1)).length===1}catch{return!1}}()}};function te(ie){var ae=65536,re=$.getTypeOf(ie),se=!0;if(re==="uint8array"?se=ee.applyCanBeUsed.uint8array:re==="nodebuffer"&&(se=ee.applyCanBeUsed.nodebuffer),se)for(;1<ae;)try{return ee.stringifyByChunk(ie,re,ae)}catch{ae=Math.floor(ae/2)}return ee.stringifyByChar(ie)}function ne(ie,ae){for(var re=0;re<ie.length;re++)ae[re]=ie[re];return ae}$.applyFromCharCode=te;var oe={};oe.string={string:q,array:function(ie){return X(ie,new Array(ie.length))},arraybuffer:function(ie){return oe.string.uint8array(ie).buffer},uint8array:function(ie){return X(ie,new Uint8Array(ie.length))},nodebuffer:function(ie){return X(ie,H.allocBuffer(ie.length))}},oe.array={string:te,array:q,arraybuffer:function(ie){return new Uint8Array(ie).buffer},uint8array:function(ie){return new Uint8Array(ie)},nodebuffer:function(ie){return H.newBufferFrom(ie)}},oe.arraybuffer={string:function(ie){return te(new Uint8Array(ie))},array:function(ie){return ne(new Uint8Array(ie),new Array(ie.byteLength))},arraybuffer:q,uint8array:function(ie){return new Uint8Array(ie)},nodebuffer:function(ie){return H.newBufferFrom(new Uint8Array(ie))}},oe.uint8array={string:te,array:function(ie){return ne(ie,new Array(ie.length))},arraybuffer:function(ie){return ie.buffer},uint8array:q,nodebuffer:function(ie){return H.newBufferFrom(ie)}},oe.nodebuffer={string:te,array:function(ie){return ne(ie,new Array(ie.length))},arraybuffer:function(ie){return oe.nodebuffer.uint8array(ie).buffer},uint8array:function(ie){return ne(ie,new Uint8Array(ie.length))},nodebuffer:q},$.transformTo=function(ie,ae){if(ae=ae||"",!ie)return ae;$.checkSupport(ie);var re=$.getTypeOf(ae);return oe[re][ie](ae)},$.resolve=function(ie){for(var ae=ie.split("/"),re=[],se=0;se<ae.length;se++){var le=ae[se];le==="."||le===""&&se!==0&&se!==ae.length-1||(le===".."?re.pop():re.push(le))}return re.join("/")},$.getTypeOf=function(ie){return typeof ie=="string"?"string":Object.prototype.toString.call(ie)==="[object Array]"?"array":B.nodebuffer&&H.isBuffer(ie)?"nodebuffer":B.uint8array&&ie instanceof Uint8Array?"uint8array":B.arraybuffer&&ie instanceof ArrayBuffer?"arraybuffer":void 0},$.checkSupport=function(ie){if(!B[ie.toLowerCase()])throw new Error(ie+" is not supported by this platform")},$.MAX_VALUE_16BITS=65535,$.MAX_VALUE_32BITS=-1,$.pretty=function(ie){var ae,re,se="";for(re=0;re<(ie||"").length;re++)se+="\\x"+((ae=ie.charCodeAt(re))<16?"0":"")+ae.toString(16).toUpperCase();return se},$.delay=function(ie,ae,re){setImmediate(function(){ie.apply(re||null,ae||[])})},$.inherits=function(ie,ae){function re(){}re.prototype=ae.prototype,ie.prototype=new re},$.extend=function(){var ie,ae,re={};for(ie=0;ie<arguments.length;ie++)for(ae in arguments[ie])Object.prototype.hasOwnProperty.call(arguments[ie],ae)&&re[ae]===void 0&&(re[ae]=arguments[ie][ae]);return re},$.prepareContent=function(ie,ae,re,se,le){return j.Promise.resolve(ae).then(function(ue){return B.blob&&(ue instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ue))!==-1)&&typeof FileReader<"u"?new j.Promise(function(he,ce){var ge=new FileReader;ge.onload=function(be){he(be.target.result)},ge.onerror=function(be){ce(be.target.error)},ge.readAsArrayBuffer(ue)}):ue}).then(function(ue){var he=$.getTypeOf(ue);return he?(he==="arraybuffer"?ue=$.transformTo("uint8array",ue):he==="string"&&(le?ue=R.decode(ue):re&&se!==!0&&(ue=function(ce){return X(ce,B.uint8array?new Uint8Array(ce.length):new Array(ce.length))}(ue))),ue):j.Promise.reject(new Error("Can't read the data of '"+ie+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(y,w,$){var B=y("./reader/readerFor"),R=y("./utils"),H=y("./signature"),j=y("./zipEntry"),q=y("./support");function X(ee){this.files=[],this.loadOptions=ee}X.prototype={checkSignature:function(ee){if(!this.reader.readAndCheckSignature(ee)){this.reader.index-=4;var te=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+R.pretty(te)+", expected "+R.pretty(ee)+")")}},isSignature:function(ee,te){var ne=this.reader.index;this.reader.setIndex(ee);var oe=this.reader.readString(4)===te;return this.reader.setIndex(ne),oe},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var ee=this.reader.readData(this.zipCommentLength),te=q.uint8array?"uint8array":"array",ne=R.transformTo(te,ee);this.zipComment=this.loadOptions.decodeFileName(ne)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var ee,te,ne,oe=this.zip64EndOfCentralSize-44;0<oe;)ee=this.reader.readInt(2),te=this.reader.readInt(4),ne=this.reader.readData(te),this.zip64ExtensibleData[ee]={id:ee,length:te,value:ne}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var ee,te;for(ee=0;ee<this.files.length;ee++)te=this.files[ee],this.reader.setIndex(te.localHeaderOffset),this.checkSignature(H.LOCAL_FILE_HEADER),te.readLocalPart(this.reader),te.handleUTF8(),te.processAttributes()},readCentralDir:function(){var ee;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(H.CENTRAL_FILE_HEADER);)(ee=new j({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(ee);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var ee=this.reader.lastIndexOfSignature(H.CENTRAL_DIRECTORY_END);if(ee<0)throw this.isSignature(0,H.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(ee);var te=ee;if(this.checkSignature(H.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===R.MAX_VALUE_16BITS||this.diskWithCentralDirStart===R.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===R.MAX_VALUE_16BITS||this.centralDirRecords===R.MAX_VALUE_16BITS||this.centralDirSize===R.MAX_VALUE_32BITS||this.centralDirOffset===R.MAX_VALUE_32BITS){if(this.zip64=!0,(ee=this.reader.lastIndexOfSignature(H.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(ee),this.checkSignature(H.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,H.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(H.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(H.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var ne=this.centralDirOffset+this.centralDirSize;this.zip64&&(ne+=20,ne+=12+this.zip64EndOfCentralSize);var oe=te-ne;if(0<oe)this.isSignature(te,H.CENTRAL_FILE_HEADER)||(this.reader.zero=oe);else if(oe<0)throw new Error("Corrupted zip: missing "+Math.abs(oe)+" bytes.")},prepareReader:function(ee){this.reader=B(ee)},load:function(ee){this.prepareReader(ee),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},w.exports=X},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(y,w,$){var B=y("./reader/readerFor"),R=y("./utils"),H=y("./compressedObject"),j=y("./crc32"),q=y("./utf8"),X=y("./compressions"),ee=y("./support");function te(ne,oe){this.options=ne,this.loadOptions=oe}te.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(ne){var oe,ie;if(ne.skip(22),this.fileNameLength=ne.readInt(2),ie=ne.readInt(2),this.fileName=ne.readData(this.fileNameLength),ne.skip(ie),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((oe=function(ae){for(var re in X)if(Object.prototype.hasOwnProperty.call(X,re)&&X[re].magic===ae)return X[re];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+R.pretty(this.compressionMethod)+" unknown (inner file : "+R.transformTo("string",this.fileName)+")");this.decompressed=new H(this.compressedSize,this.uncompressedSize,this.crc32,oe,ne.readData(this.compressedSize))},readCentralPart:function(ne){this.versionMadeBy=ne.readInt(2),ne.skip(2),this.bitFlag=ne.readInt(2),this.compressionMethod=ne.readString(2),this.date=ne.readDate(),this.crc32=ne.readInt(4),this.compressedSize=ne.readInt(4),this.uncompressedSize=ne.readInt(4);var oe=ne.readInt(2);if(this.extraFieldsLength=ne.readInt(2),this.fileCommentLength=ne.readInt(2),this.diskNumberStart=ne.readInt(2),this.internalFileAttributes=ne.readInt(2),this.externalFileAttributes=ne.readInt(4),this.localHeaderOffset=ne.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");ne.skip(oe),this.readExtraFields(ne),this.parseZIP64ExtraField(ne),this.fileComment=ne.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var ne=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),ne==0&&(this.dosPermissions=63&this.externalFileAttributes),ne==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var ne=B(this.extraFields[1].value);this.uncompressedSize===R.MAX_VALUE_32BITS&&(this.uncompressedSize=ne.readInt(8)),this.compressedSize===R.MAX_VALUE_32BITS&&(this.compressedSize=ne.readInt(8)),this.localHeaderOffset===R.MAX_VALUE_32BITS&&(this.localHeaderOffset=ne.readInt(8)),this.diskNumberStart===R.MAX_VALUE_32BITS&&(this.diskNumberStart=ne.readInt(4))}},readExtraFields:function(ne){var oe,ie,ae,re=ne.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});ne.index+4<re;)oe=ne.readInt(2),ie=ne.readInt(2),ae=ne.readData(ie),this.extraFields[oe]={id:oe,length:ie,value:ae};ne.setIndex(re)},handleUTF8:function(){var ne=ee.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=q.utf8decode(this.fileName),this.fileCommentStr=q.utf8decode(this.fileComment);else{var oe=this.findExtraFieldUnicodePath();if(oe!==null)this.fileNameStr=oe;else{var ie=R.transformTo(ne,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(ie)}var ae=this.findExtraFieldUnicodeComment();if(ae!==null)this.fileCommentStr=ae;else{var re=R.transformTo(ne,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(re)}}},findExtraFieldUnicodePath:function(){var ne=this.extraFields[28789];if(ne){var oe=B(ne.value);return oe.readInt(1)!==1||j(this.fileName)!==oe.readInt(4)?null:q.utf8decode(oe.readData(ne.length-5))}return null},findExtraFieldUnicodeComment:function(){var ne=this.extraFields[25461];if(ne){var oe=B(ne.value);return oe.readInt(1)!==1||j(this.fileComment)!==oe.readInt(4)?null:q.utf8decode(oe.readData(ne.length-5))}return null}},w.exports=te},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(y,w,$){function B(oe,ie,ae){this.name=oe,this.dir=ae.dir,this.date=ae.date,this.comment=ae.comment,this.unixPermissions=ae.unixPermissions,this.dosPermissions=ae.dosPermissions,this._data=ie,this._dataBinary=ae.binary,this.options={compression:ae.compression,compressionOptions:ae.compressionOptions}}var R=y("./stream/StreamHelper"),H=y("./stream/DataWorker"),j=y("./utf8"),q=y("./compressedObject"),X=y("./stream/GenericWorker");B.prototype={internalStream:function(oe){var ie=null,ae="string";try{if(!oe)throw new Error("No output type specified.");var re=(ae=oe.toLowerCase())==="string"||ae==="text";ae!=="binarystring"&&ae!=="text"||(ae="string"),ie=this._decompressWorker();var se=!this._dataBinary;se&&!re&&(ie=ie.pipe(new j.Utf8EncodeWorker)),!se&&re&&(ie=ie.pipe(new j.Utf8DecodeWorker))}catch(le){(ie=new X("error")).error(le)}return new R(ie,ae,"")},async:function(oe,ie){return this.internalStream(oe).accumulate(ie)},nodeStream:function(oe,ie){return this.internalStream(oe||"nodebuffer").toNodejsStream(ie)},_compressWorker:function(oe,ie){if(this._data instanceof q&&this._data.compression.magic===oe.magic)return this._data.getCompressedWorker();var ae=this._decompressWorker();return this._dataBinary||(ae=ae.pipe(new j.Utf8EncodeWorker)),q.createWorkerFrom(ae,oe,ie)},_decompressWorker:function(){return this._data instanceof q?this._data.getContentWorker():this._data instanceof X?this._data:new H(this._data)}};for(var ee=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],te=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},ne=0;ne<ee.length;ne++)B.prototype[ee[ne]]=te;w.exports=B},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(y,w,$){(function(B){var R,H,j=B.MutationObserver||B.WebKitMutationObserver;if(j){var q=0,X=new j(oe),ee=B.document.createTextNode("");X.observe(ee,{characterData:!0}),R=function(){ee.data=q=++q%2}}else if(B.setImmediate||B.MessageChannel===void 0)R="document"in B&&"onreadystatechange"in B.document.createElement("script")?function(){var ie=B.document.createElement("script");ie.onreadystatechange=function(){oe(),ie.onreadystatechange=null,ie.parentNode.removeChild(ie),ie=null},B.document.documentElement.appendChild(ie)}:function(){setTimeout(oe,0)};else{var te=new B.MessageChannel;te.port1.onmessage=oe,R=function(){te.port2.postMessage(0)}}var ne=[];function oe(){var ie,ae;H=!0;for(var re=ne.length;re;){for(ae=ne,ne=[],ie=-1;++ie<re;)ae[ie]();re=ne.length}H=!1}w.exports=function(ie){ne.push(ie)!==1||H||R()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(y,w,$){var B=y("immediate");function R(){}var H={},j=["REJECTED"],q=["FULFILLED"],X=["PENDING"];function ee(re){if(typeof re!="function")throw new TypeError("resolver must be a function");this.state=X,this.queue=[],this.outcome=void 0,re!==R&&ie(this,re)}function te(re,se,le){this.promise=re,typeof se=="function"&&(this.onFulfilled=se,this.callFulfilled=this.otherCallFulfilled),typeof le=="function"&&(this.onRejected=le,this.callRejected=this.otherCallRejected)}function ne(re,se,le){B(function(){var ue;try{ue=se(le)}catch(he){return H.reject(re,he)}ue===re?H.reject(re,new TypeError("Cannot resolve promise with itself")):H.resolve(re,ue)})}function oe(re){var se=re&&re.then;if(re&&(typeof re=="object"||typeof re=="function")&&typeof se=="function")return function(){se.apply(re,arguments)}}function ie(re,se){var le=!1;function ue(ge){le||(le=!0,H.reject(re,ge))}function he(ge){le||(le=!0,H.resolve(re,ge))}var ce=ae(function(){se(he,ue)});ce.status==="error"&&ue(ce.value)}function ae(re,se){var le={};try{le.value=re(se),le.status="success"}catch(ue){le.status="error",le.value=ue}return le}(w.exports=ee).prototype.finally=function(re){if(typeof re!="function")return this;var se=this.constructor;return this.then(function(le){return se.resolve(re()).then(function(){return le})},function(le){return se.resolve(re()).then(function(){throw le})})},ee.prototype.catch=function(re){return this.then(null,re)},ee.prototype.then=function(re,se){if(typeof re!="function"&&this.state===q||typeof se!="function"&&this.state===j)return this;var le=new this.constructor(R);return this.state!==X?ne(le,this.state===q?re:se,this.outcome):this.queue.push(new te(le,re,se)),le},te.prototype.callFulfilled=function(re){H.resolve(this.promise,re)},te.prototype.otherCallFulfilled=function(re){ne(this.promise,this.onFulfilled,re)},te.prototype.callRejected=function(re){H.reject(this.promise,re)},te.prototype.otherCallRejected=function(re){ne(this.promise,this.onRejected,re)},H.resolve=function(re,se){var le=ae(oe,se);if(le.status==="error")return H.reject(re,le.value);var ue=le.value;if(ue)ie(re,ue);else{re.state=q,re.outcome=se;for(var he=-1,ce=re.queue.length;++he<ce;)re.queue[he].callFulfilled(se)}return re},H.reject=function(re,se){re.state=j,re.outcome=se;for(var le=-1,ue=re.queue.length;++le<ue;)re.queue[le].callRejected(se);return re},ee.resolve=function(re){return re instanceof this?re:H.resolve(new this(R),re)},ee.reject=function(re){var se=new this(R);return H.reject(se,re)},ee.all=function(re){var se=this;if(Object.prototype.toString.call(re)!=="[object Array]")return this.reject(new TypeError("must be an array"));var le=re.length,ue=!1;if(!le)return this.resolve([]);for(var he=new Array(le),ce=0,ge=-1,be=new this(R);++ge<le;)fe(re[ge],ge);return be;function fe(we,Ce){se.resolve(we).then(function(ve){he[Ce]=ve,++ce!==le||ue||(ue=!0,H.resolve(be,he))},function(ve){ue||(ue=!0,H.reject(be,ve))})}},ee.race=function(re){var se=this;if(Object.prototype.toString.call(re)!=="[object Array]")return this.reject(new TypeError("must be an array"));var le=re.length,ue=!1;if(!le)return this.resolve([]);for(var he=-1,ce=new this(R);++he<le;)ge=re[he],se.resolve(ge).then(function(be){ue||(ue=!0,H.resolve(ce,be))},function(be){ue||(ue=!0,H.reject(ce,be))});var ge;return ce}},{immediate:36}],38:[function(y,w,$){var B={};(0,y("./lib/utils/common").assign)(B,y("./lib/deflate"),y("./lib/inflate"),y("./lib/zlib/constants")),w.exports=B},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(y,w,$){var B=y("./zlib/deflate"),R=y("./utils/common"),H=y("./utils/strings"),j=y("./zlib/messages"),q=y("./zlib/zstream"),X=Object.prototype.toString,ee=0,te=-1,ne=0,oe=8;function ie(re){if(!(this instanceof ie))return new ie(re);this.options=R.assign({level:te,method:oe,chunkSize:16384,windowBits:15,memLevel:8,strategy:ne,to:""},re||{});var se=this.options;se.raw&&0<se.windowBits?se.windowBits=-se.windowBits:se.gzip&&0<se.windowBits&&se.windowBits<16&&(se.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q,this.strm.avail_out=0;var le=B.deflateInit2(this.strm,se.level,se.method,se.windowBits,se.memLevel,se.strategy);if(le!==ee)throw new Error(j[le]);if(se.header&&B.deflateSetHeader(this.strm,se.header),se.dictionary){var ue;if(ue=typeof se.dictionary=="string"?H.string2buf(se.dictionary):X.call(se.dictionary)==="[object ArrayBuffer]"?new Uint8Array(se.dictionary):se.dictionary,(le=B.deflateSetDictionary(this.strm,ue))!==ee)throw new Error(j[le]);this._dict_set=!0}}function ae(re,se){var le=new ie(se);if(le.push(re,!0),le.err)throw le.msg||j[le.err];return le.result}ie.prototype.push=function(re,se){var le,ue,he=this.strm,ce=this.options.chunkSize;if(this.ended)return!1;ue=se===~~se?se:se===!0?4:0,typeof re=="string"?he.input=H.string2buf(re):X.call(re)==="[object ArrayBuffer]"?he.input=new Uint8Array(re):he.input=re,he.next_in=0,he.avail_in=he.input.length;do{if(he.avail_out===0&&(he.output=new R.Buf8(ce),he.next_out=0,he.avail_out=ce),(le=B.deflate(he,ue))!==1&&le!==ee)return this.onEnd(le),!(this.ended=!0);he.avail_out!==0&&(he.avail_in!==0||ue!==4&&ue!==2)||(this.options.to==="string"?this.onData(H.buf2binstring(R.shrinkBuf(he.output,he.next_out))):this.onData(R.shrinkBuf(he.output,he.next_out)))}while((0<he.avail_in||he.avail_out===0)&&le!==1);return ue===4?(le=B.deflateEnd(this.strm),this.onEnd(le),this.ended=!0,le===ee):ue!==2||(this.onEnd(ee),!(he.avail_out=0))},ie.prototype.onData=function(re){this.chunks.push(re)},ie.prototype.onEnd=function(re){re===ee&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=re,this.msg=this.strm.msg},$.Deflate=ie,$.deflate=ae,$.deflateRaw=function(re,se){return(se=se||{}).raw=!0,ae(re,se)},$.gzip=function(re,se){return(se=se||{}).gzip=!0,ae(re,se)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(y,w,$){var B=y("./zlib/inflate"),R=y("./utils/common"),H=y("./utils/strings"),j=y("./zlib/constants"),q=y("./zlib/messages"),X=y("./zlib/zstream"),ee=y("./zlib/gzheader"),te=Object.prototype.toString;function ne(ie){if(!(this instanceof ne))return new ne(ie);this.options=R.assign({chunkSize:16384,windowBits:0,to:""},ie||{});var ae=this.options;ae.raw&&0<=ae.windowBits&&ae.windowBits<16&&(ae.windowBits=-ae.windowBits,ae.windowBits===0&&(ae.windowBits=-15)),!(0<=ae.windowBits&&ae.windowBits<16)||ie&&ie.windowBits||(ae.windowBits+=32),15<ae.windowBits&&ae.windowBits<48&&!(15&ae.windowBits)&&(ae.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;var re=B.inflateInit2(this.strm,ae.windowBits);if(re!==j.Z_OK)throw new Error(q[re]);this.header=new ee,B.inflateGetHeader(this.strm,this.header)}function oe(ie,ae){var re=new ne(ae);if(re.push(ie,!0),re.err)throw re.msg||q[re.err];return re.result}ne.prototype.push=function(ie,ae){var re,se,le,ue,he,ce,ge=this.strm,be=this.options.chunkSize,fe=this.options.dictionary,we=!1;if(this.ended)return!1;se=ae===~~ae?ae:ae===!0?j.Z_FINISH:j.Z_NO_FLUSH,typeof ie=="string"?ge.input=H.binstring2buf(ie):te.call(ie)==="[object ArrayBuffer]"?ge.input=new Uint8Array(ie):ge.input=ie,ge.next_in=0,ge.avail_in=ge.input.length;do{if(ge.avail_out===0&&(ge.output=new R.Buf8(be),ge.next_out=0,ge.avail_out=be),(re=B.inflate(ge,j.Z_NO_FLUSH))===j.Z_NEED_DICT&&fe&&(ce=typeof fe=="string"?H.string2buf(fe):te.call(fe)==="[object ArrayBuffer]"?new Uint8Array(fe):fe,re=B.inflateSetDictionary(this.strm,ce)),re===j.Z_BUF_ERROR&&we===!0&&(re=j.Z_OK,we=!1),re!==j.Z_STREAM_END&&re!==j.Z_OK)return this.onEnd(re),!(this.ended=!0);ge.next_out&&(ge.avail_out!==0&&re!==j.Z_STREAM_END&&(ge.avail_in!==0||se!==j.Z_FINISH&&se!==j.Z_SYNC_FLUSH)||(this.options.to==="string"?(le=H.utf8border(ge.output,ge.next_out),ue=ge.next_out-le,he=H.buf2string(ge.output,le),ge.next_out=ue,ge.avail_out=be-ue,ue&&R.arraySet(ge.output,ge.output,le,ue,0),this.onData(he)):this.onData(R.shrinkBuf(ge.output,ge.next_out)))),ge.avail_in===0&&ge.avail_out===0&&(we=!0)}while((0<ge.avail_in||ge.avail_out===0)&&re!==j.Z_STREAM_END);return re===j.Z_STREAM_END&&(se=j.Z_FINISH),se===j.Z_FINISH?(re=B.inflateEnd(this.strm),this.onEnd(re),this.ended=!0,re===j.Z_OK):se!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),!(ge.avail_out=0))},ne.prototype.onData=function(ie){this.chunks.push(ie)},ne.prototype.onEnd=function(ie){ie===j.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=R.flattenChunks(this.chunks)),this.chunks=[],this.err=ie,this.msg=this.strm.msg},$.Inflate=ne,$.inflate=oe,$.inflateRaw=function(ie,ae){return(ae=ae||{}).raw=!0,oe(ie,ae)},$.ungzip=oe},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(y,w,$){var B=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";$.assign=function(j){for(var q=Array.prototype.slice.call(arguments,1);q.length;){var X=q.shift();if(X){if(typeof X!="object")throw new TypeError(X+"must be non-object");for(var ee in X)X.hasOwnProperty(ee)&&(j[ee]=X[ee])}}return j},$.shrinkBuf=function(j,q){return j.length===q?j:j.subarray?j.subarray(0,q):(j.length=q,j)};var R={arraySet:function(j,q,X,ee,te){if(q.subarray&&j.subarray)j.set(q.subarray(X,X+ee),te);else for(var ne=0;ne<ee;ne++)j[te+ne]=q[X+ne]},flattenChunks:function(j){var q,X,ee,te,ne,oe;for(q=ee=0,X=j.length;q<X;q++)ee+=j[q].length;for(oe=new Uint8Array(ee),q=te=0,X=j.length;q<X;q++)ne=j[q],oe.set(ne,te),te+=ne.length;return oe}},H={arraySet:function(j,q,X,ee,te){for(var ne=0;ne<ee;ne++)j[te+ne]=q[X+ne]},flattenChunks:function(j){return[].concat.apply([],j)}};$.setTyped=function(j){j?($.Buf8=Uint8Array,$.Buf16=Uint16Array,$.Buf32=Int32Array,$.assign($,R)):($.Buf8=Array,$.Buf16=Array,$.Buf32=Array,$.assign($,H))},$.setTyped(B)},{}],42:[function(y,w,$){var B=y("./common"),R=!0,H=!0;try{String.fromCharCode.apply(null,[0])}catch{R=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{H=!1}for(var j=new B.Buf8(256),q=0;q<256;q++)j[q]=252<=q?6:248<=q?5:240<=q?4:224<=q?3:192<=q?2:1;function X(ee,te){if(te<65537&&(ee.subarray&&H||!ee.subarray&&R))return String.fromCharCode.apply(null,B.shrinkBuf(ee,te));for(var ne="",oe=0;oe<te;oe++)ne+=String.fromCharCode(ee[oe]);return ne}j[254]=j[254]=1,$.string2buf=function(ee){var te,ne,oe,ie,ae,re=ee.length,se=0;for(ie=0;ie<re;ie++)(64512&(ne=ee.charCodeAt(ie)))==55296&&ie+1<re&&(64512&(oe=ee.charCodeAt(ie+1)))==56320&&(ne=65536+(ne-55296<<10)+(oe-56320),ie++),se+=ne<128?1:ne<2048?2:ne<65536?3:4;for(te=new B.Buf8(se),ie=ae=0;ae<se;ie++)(64512&(ne=ee.charCodeAt(ie)))==55296&&ie+1<re&&(64512&(oe=ee.charCodeAt(ie+1)))==56320&&(ne=65536+(ne-55296<<10)+(oe-56320),ie++),ne<128?te[ae++]=ne:(ne<2048?te[ae++]=192|ne>>>6:(ne<65536?te[ae++]=224|ne>>>12:(te[ae++]=240|ne>>>18,te[ae++]=128|ne>>>12&63),te[ae++]=128|ne>>>6&63),te[ae++]=128|63&ne);return te},$.buf2binstring=function(ee){return X(ee,ee.length)},$.binstring2buf=function(ee){for(var te=new B.Buf8(ee.length),ne=0,oe=te.length;ne<oe;ne++)te[ne]=ee.charCodeAt(ne);return te},$.buf2string=function(ee,te){var ne,oe,ie,ae,re=te||ee.length,se=new Array(2*re);for(ne=oe=0;ne<re;)if((ie=ee[ne++])<128)se[oe++]=ie;else if(4<(ae=j[ie]))se[oe++]=65533,ne+=ae-1;else{for(ie&=ae===2?31:ae===3?15:7;1<ae&&ne<re;)ie=ie<<6|63&ee[ne++],ae--;1<ae?se[oe++]=65533:ie<65536?se[oe++]=ie:(ie-=65536,se[oe++]=55296|ie>>10&1023,se[oe++]=56320|1023&ie)}return X(se,oe)},$.utf8border=function(ee,te){var ne;for((te=te||ee.length)>ee.length&&(te=ee.length),ne=te-1;0<=ne&&(192&ee[ne])==128;)ne--;return ne<0||ne===0?te:ne+j[ee[ne]]>te?ne:te}},{"./common":41}],43:[function(y,w,$){w.exports=function(B,R,H,j){for(var q=65535&B|0,X=B>>>16&65535|0,ee=0;H!==0;){for(H-=ee=2e3<H?2e3:H;X=X+(q=q+R[j++]|0)|0,--ee;);q%=65521,X%=65521}return q|X<<16|0}},{}],44:[function(y,w,$){w.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(y,w,$){var B=function(){for(var R,H=[],j=0;j<256;j++){R=j;for(var q=0;q<8;q++)R=1&R?3988292384^R>>>1:R>>>1;H[j]=R}return H}();w.exports=function(R,H,j,q){var X=B,ee=q+j;R^=-1;for(var te=q;te<ee;te++)R=R>>>8^X[255&(R^H[te])];return-1^R}},{}],46:[function(y,w,$){var B,R=y("../utils/common"),H=y("./trees"),j=y("./adler32"),q=y("./crc32"),X=y("./messages"),ee=0,te=4,ne=0,oe=-2,ie=-1,ae=4,re=2,se=8,le=9,ue=286,he=30,ce=19,ge=2*ue+1,be=15,fe=3,we=258,Ce=we+fe+1,ve=42,ke=113,me=1,Ie=2,Fe=3,Be=4;function Ze(_e,We){return _e.msg=X[We],We}function Re(_e){return(_e<<1)-(4<_e?9:0)}function qe(_e){for(var We=_e.length;0<=--We;)_e[We]=0}function Me(_e){var We=_e.state,Ne=We.pending;Ne>_e.avail_out&&(Ne=_e.avail_out),Ne!==0&&(R.arraySet(_e.output,We.pending_buf,We.pending_out,Ne,_e.next_out),_e.next_out+=Ne,We.pending_out+=Ne,_e.total_out+=Ne,_e.avail_out-=Ne,We.pending-=Ne,We.pending===0&&(We.pending_out=0))}function Pe(_e,We){H._tr_flush_block(_e,0<=_e.block_start?_e.block_start:-1,_e.strstart-_e.block_start,We),_e.block_start=_e.strstart,Me(_e.strm)}function Qe(_e,We){_e.pending_buf[_e.pending++]=We}function je(_e,We){_e.pending_buf[_e.pending++]=We>>>8&255,_e.pending_buf[_e.pending++]=255&We}function Ue(_e,We){var Ne,$e,Te=_e.max_chain_length,De=_e.strstart,Ge=_e.prev_length,Ke=_e.nice_match,Ae=_e.strstart>_e.w_size-Ce?_e.strstart-(_e.w_size-Ce):0,Oe=_e.window,Ye=_e.w_mask,Je=_e.prev,rt=_e.strstart+we,xe=Oe[De+Ge-1],de=Oe[De+Ge];_e.prev_length>=_e.good_match&&(Te>>=2),Ke>_e.lookahead&&(Ke=_e.lookahead);do if(Oe[(Ne=We)+Ge]===de&&Oe[Ne+Ge-1]===xe&&Oe[Ne]===Oe[De]&&Oe[++Ne]===Oe[De+1]){De+=2,Ne++;do;while(Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&Oe[++De]===Oe[++Ne]&&De<rt);if($e=we-(rt-De),De=rt-we,Ge<$e){if(_e.match_start=We,Ke<=(Ge=$e))break;xe=Oe[De+Ge-1],de=Oe[De+Ge]}}while((We=Je[We&Ye])>Ae&&--Te!=0);return Ge<=_e.lookahead?Ge:_e.lookahead}function tt(_e){var We,Ne,$e,Te,De,Ge,Ke,Ae,Oe,Ye,Je=_e.w_size;do{if(Te=_e.window_size-_e.lookahead-_e.strstart,_e.strstart>=Je+(Je-Ce)){for(R.arraySet(_e.window,_e.window,Je,Je,0),_e.match_start-=Je,_e.strstart-=Je,_e.block_start-=Je,We=Ne=_e.hash_size;$e=_e.head[--We],_e.head[We]=Je<=$e?$e-Je:0,--Ne;);for(We=Ne=Je;$e=_e.prev[--We],_e.prev[We]=Je<=$e?$e-Je:0,--Ne;);Te+=Je}if(_e.strm.avail_in===0)break;if(Ge=_e.strm,Ke=_e.window,Ae=_e.strstart+_e.lookahead,Oe=Te,Ye=void 0,Ye=Ge.avail_in,Oe<Ye&&(Ye=Oe),Ne=Ye===0?0:(Ge.avail_in-=Ye,R.arraySet(Ke,Ge.input,Ge.next_in,Ye,Ae),Ge.state.wrap===1?Ge.adler=j(Ge.adler,Ke,Ye,Ae):Ge.state.wrap===2&&(Ge.adler=q(Ge.adler,Ke,Ye,Ae)),Ge.next_in+=Ye,Ge.total_in+=Ye,Ye),_e.lookahead+=Ne,_e.lookahead+_e.insert>=fe)for(De=_e.strstart-_e.insert,_e.ins_h=_e.window[De],_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[De+1])&_e.hash_mask;_e.insert&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[De+fe-1])&_e.hash_mask,_e.prev[De&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=De,De++,_e.insert--,!(_e.lookahead+_e.insert<fe)););}while(_e.lookahead<Ce&&_e.strm.avail_in!==0)}function Ve(_e,We){for(var Ne,$e;;){if(_e.lookahead<Ce){if(tt(_e),_e.lookahead<Ce&&We===ee)return me;if(_e.lookahead===0)break}if(Ne=0,_e.lookahead>=fe&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+fe-1])&_e.hash_mask,Ne=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),Ne!==0&&_e.strstart-Ne<=_e.w_size-Ce&&(_e.match_length=Ue(_e,Ne)),_e.match_length>=fe)if($e=H._tr_tally(_e,_e.strstart-_e.match_start,_e.match_length-fe),_e.lookahead-=_e.match_length,_e.match_length<=_e.max_lazy_match&&_e.lookahead>=fe){for(_e.match_length--;_e.strstart++,_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+fe-1])&_e.hash_mask,Ne=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart,--_e.match_length!=0;);_e.strstart++}else _e.strstart+=_e.match_length,_e.match_length=0,_e.ins_h=_e.window[_e.strstart],_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+1])&_e.hash_mask;else $e=H._tr_tally(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++;if($e&&(Pe(_e,!1),_e.strm.avail_out===0))return me}return _e.insert=_e.strstart<fe-1?_e.strstart:fe-1,We===te?(Pe(_e,!0),_e.strm.avail_out===0?Fe:Be):_e.last_lit&&(Pe(_e,!1),_e.strm.avail_out===0)?me:Ie}function nt(_e,We){for(var Ne,$e,Te;;){if(_e.lookahead<Ce){if(tt(_e),_e.lookahead<Ce&&We===ee)return me;if(_e.lookahead===0)break}if(Ne=0,_e.lookahead>=fe&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+fe-1])&_e.hash_mask,Ne=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),_e.prev_length=_e.match_length,_e.prev_match=_e.match_start,_e.match_length=fe-1,Ne!==0&&_e.prev_length<_e.max_lazy_match&&_e.strstart-Ne<=_e.w_size-Ce&&(_e.match_length=Ue(_e,Ne),_e.match_length<=5&&(_e.strategy===1||_e.match_length===fe&&4096<_e.strstart-_e.match_start)&&(_e.match_length=fe-1)),_e.prev_length>=fe&&_e.match_length<=_e.prev_length){for(Te=_e.strstart+_e.lookahead-fe,$e=H._tr_tally(_e,_e.strstart-1-_e.prev_match,_e.prev_length-fe),_e.lookahead-=_e.prev_length-1,_e.prev_length-=2;++_e.strstart<=Te&&(_e.ins_h=(_e.ins_h<<_e.hash_shift^_e.window[_e.strstart+fe-1])&_e.hash_mask,Ne=_e.prev[_e.strstart&_e.w_mask]=_e.head[_e.ins_h],_e.head[_e.ins_h]=_e.strstart),--_e.prev_length!=0;);if(_e.match_available=0,_e.match_length=fe-1,_e.strstart++,$e&&(Pe(_e,!1),_e.strm.avail_out===0))return me}else if(_e.match_available){if(($e=H._tr_tally(_e,0,_e.window[_e.strstart-1]))&&Pe(_e,!1),_e.strstart++,_e.lookahead--,_e.strm.avail_out===0)return me}else _e.match_available=1,_e.strstart++,_e.lookahead--}return _e.match_available&&($e=H._tr_tally(_e,0,_e.window[_e.strstart-1]),_e.match_available=0),_e.insert=_e.strstart<fe-1?_e.strstart:fe-1,We===te?(Pe(_e,!0),_e.strm.avail_out===0?Fe:Be):_e.last_lit&&(Pe(_e,!1),_e.strm.avail_out===0)?me:Ie}function et(_e,We,Ne,$e,Te){this.good_length=_e,this.max_lazy=We,this.nice_length=Ne,this.max_chain=$e,this.func=Te}function st(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=se,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new R.Buf16(2*ge),this.dyn_dtree=new R.Buf16(2*(2*he+1)),this.bl_tree=new R.Buf16(2*(2*ce+1)),qe(this.dyn_ltree),qe(this.dyn_dtree),qe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new R.Buf16(be+1),this.heap=new R.Buf16(2*ue+1),qe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new R.Buf16(2*ue+1),qe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function at(_e){var We;return _e&&_e.state?(_e.total_in=_e.total_out=0,_e.data_type=re,(We=_e.state).pending=0,We.pending_out=0,We.wrap<0&&(We.wrap=-We.wrap),We.status=We.wrap?ve:ke,_e.adler=We.wrap===2?0:1,We.last_flush=ee,H._tr_init(We),ne):Ze(_e,oe)}function ct(_e){var We=at(_e);return We===ne&&function(Ne){Ne.window_size=2*Ne.w_size,qe(Ne.head),Ne.max_lazy_match=B[Ne.level].max_lazy,Ne.good_match=B[Ne.level].good_length,Ne.nice_match=B[Ne.level].nice_length,Ne.max_chain_length=B[Ne.level].max_chain,Ne.strstart=0,Ne.block_start=0,Ne.lookahead=0,Ne.insert=0,Ne.match_length=Ne.prev_length=fe-1,Ne.match_available=0,Ne.ins_h=0}(_e.state),We}function lt(_e,We,Ne,$e,Te,De){if(!_e)return oe;var Ge=1;if(We===ie&&(We=6),$e<0?(Ge=0,$e=-$e):15<$e&&(Ge=2,$e-=16),Te<1||le<Te||Ne!==se||$e<8||15<$e||We<0||9<We||De<0||ae<De)return Ze(_e,oe);$e===8&&($e=9);var Ke=new st;return(_e.state=Ke).strm=_e,Ke.wrap=Ge,Ke.gzhead=null,Ke.w_bits=$e,Ke.w_size=1<<Ke.w_bits,Ke.w_mask=Ke.w_size-1,Ke.hash_bits=Te+7,Ke.hash_size=1<<Ke.hash_bits,Ke.hash_mask=Ke.hash_size-1,Ke.hash_shift=~~((Ke.hash_bits+fe-1)/fe),Ke.window=new R.Buf8(2*Ke.w_size),Ke.head=new R.Buf16(Ke.hash_size),Ke.prev=new R.Buf16(Ke.w_size),Ke.lit_bufsize=1<<Te+6,Ke.pending_buf_size=4*Ke.lit_bufsize,Ke.pending_buf=new R.Buf8(Ke.pending_buf_size),Ke.d_buf=1*Ke.lit_bufsize,Ke.l_buf=3*Ke.lit_bufsize,Ke.level=We,Ke.strategy=De,Ke.method=Ne,ct(_e)}B=[new et(0,0,0,0,function(_e,We){var Ne=65535;for(Ne>_e.pending_buf_size-5&&(Ne=_e.pending_buf_size-5);;){if(_e.lookahead<=1){if(tt(_e),_e.lookahead===0&&We===ee)return me;if(_e.lookahead===0)break}_e.strstart+=_e.lookahead,_e.lookahead=0;var $e=_e.block_start+Ne;if((_e.strstart===0||_e.strstart>=$e)&&(_e.lookahead=_e.strstart-$e,_e.strstart=$e,Pe(_e,!1),_e.strm.avail_out===0)||_e.strstart-_e.block_start>=_e.w_size-Ce&&(Pe(_e,!1),_e.strm.avail_out===0))return me}return _e.insert=0,We===te?(Pe(_e,!0),_e.strm.avail_out===0?Fe:Be):(_e.strstart>_e.block_start&&(Pe(_e,!1),_e.strm.avail_out),me)}),new et(4,4,8,4,Ve),new et(4,5,16,8,Ve),new et(4,6,32,32,Ve),new et(4,4,16,16,nt),new et(8,16,32,32,nt),new et(8,16,128,128,nt),new et(8,32,128,256,nt),new et(32,128,258,1024,nt),new et(32,258,258,4096,nt)],$.deflateInit=function(_e,We){return lt(_e,We,se,15,8,0)},$.deflateInit2=lt,$.deflateReset=ct,$.deflateResetKeep=at,$.deflateSetHeader=function(_e,We){return _e&&_e.state?_e.state.wrap!==2?oe:(_e.state.gzhead=We,ne):oe},$.deflate=function(_e,We){var Ne,$e,Te,De;if(!_e||!_e.state||5<We||We<0)return _e?Ze(_e,oe):oe;if($e=_e.state,!_e.output||!_e.input&&_e.avail_in!==0||$e.status===666&&We!==te)return Ze(_e,_e.avail_out===0?-5:oe);if($e.strm=_e,Ne=$e.last_flush,$e.last_flush=We,$e.status===ve)if($e.wrap===2)_e.adler=0,Qe($e,31),Qe($e,139),Qe($e,8),$e.gzhead?(Qe($e,($e.gzhead.text?1:0)+($e.gzhead.hcrc?2:0)+($e.gzhead.extra?4:0)+($e.gzhead.name?8:0)+($e.gzhead.comment?16:0)),Qe($e,255&$e.gzhead.time),Qe($e,$e.gzhead.time>>8&255),Qe($e,$e.gzhead.time>>16&255),Qe($e,$e.gzhead.time>>24&255),Qe($e,$e.level===9?2:2<=$e.strategy||$e.level<2?4:0),Qe($e,255&$e.gzhead.os),$e.gzhead.extra&&$e.gzhead.extra.length&&(Qe($e,255&$e.gzhead.extra.length),Qe($e,$e.gzhead.extra.length>>8&255)),$e.gzhead.hcrc&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending,0)),$e.gzindex=0,$e.status=69):(Qe($e,0),Qe($e,0),Qe($e,0),Qe($e,0),Qe($e,0),Qe($e,$e.level===9?2:2<=$e.strategy||$e.level<2?4:0),Qe($e,3),$e.status=ke);else{var Ge=se+($e.w_bits-8<<4)<<8;Ge|=(2<=$e.strategy||$e.level<2?0:$e.level<6?1:$e.level===6?2:3)<<6,$e.strstart!==0&&(Ge|=32),Ge+=31-Ge%31,$e.status=ke,je($e,Ge),$e.strstart!==0&&(je($e,_e.adler>>>16),je($e,65535&_e.adler)),_e.adler=1}if($e.status===69)if($e.gzhead.extra){for(Te=$e.pending;$e.gzindex<(65535&$e.gzhead.extra.length)&&($e.pending!==$e.pending_buf_size||($e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),Me(_e),Te=$e.pending,$e.pending!==$e.pending_buf_size));)Qe($e,255&$e.gzhead.extra[$e.gzindex]),$e.gzindex++;$e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),$e.gzindex===$e.gzhead.extra.length&&($e.gzindex=0,$e.status=73)}else $e.status=73;if($e.status===73)if($e.gzhead.name){Te=$e.pending;do{if($e.pending===$e.pending_buf_size&&($e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),Me(_e),Te=$e.pending,$e.pending===$e.pending_buf_size)){De=1;break}De=$e.gzindex<$e.gzhead.name.length?255&$e.gzhead.name.charCodeAt($e.gzindex++):0,Qe($e,De)}while(De!==0);$e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),De===0&&($e.gzindex=0,$e.status=91)}else $e.status=91;if($e.status===91)if($e.gzhead.comment){Te=$e.pending;do{if($e.pending===$e.pending_buf_size&&($e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),Me(_e),Te=$e.pending,$e.pending===$e.pending_buf_size)){De=1;break}De=$e.gzindex<$e.gzhead.comment.length?255&$e.gzhead.comment.charCodeAt($e.gzindex++):0,Qe($e,De)}while(De!==0);$e.gzhead.hcrc&&$e.pending>Te&&(_e.adler=q(_e.adler,$e.pending_buf,$e.pending-Te,Te)),De===0&&($e.status=103)}else $e.status=103;if($e.status===103&&($e.gzhead.hcrc?($e.pending+2>$e.pending_buf_size&&Me(_e),$e.pending+2<=$e.pending_buf_size&&(Qe($e,255&_e.adler),Qe($e,_e.adler>>8&255),_e.adler=0,$e.status=ke)):$e.status=ke),$e.pending!==0){if(Me(_e),_e.avail_out===0)return $e.last_flush=-1,ne}else if(_e.avail_in===0&&Re(We)<=Re(Ne)&&We!==te)return Ze(_e,-5);if($e.status===666&&_e.avail_in!==0)return Ze(_e,-5);if(_e.avail_in!==0||$e.lookahead!==0||We!==ee&&$e.status!==666){var Ke=$e.strategy===2?function(Ae,Oe){for(var Ye;;){if(Ae.lookahead===0&&(tt(Ae),Ae.lookahead===0)){if(Oe===ee)return me;break}if(Ae.match_length=0,Ye=H._tr_tally(Ae,0,Ae.window[Ae.strstart]),Ae.lookahead--,Ae.strstart++,Ye&&(Pe(Ae,!1),Ae.strm.avail_out===0))return me}return Ae.insert=0,Oe===te?(Pe(Ae,!0),Ae.strm.avail_out===0?Fe:Be):Ae.last_lit&&(Pe(Ae,!1),Ae.strm.avail_out===0)?me:Ie}($e,We):$e.strategy===3?function(Ae,Oe){for(var Ye,Je,rt,xe,de=Ae.window;;){if(Ae.lookahead<=we){if(tt(Ae),Ae.lookahead<=we&&Oe===ee)return me;if(Ae.lookahead===0)break}if(Ae.match_length=0,Ae.lookahead>=fe&&0<Ae.strstart&&(Je=de[rt=Ae.strstart-1])===de[++rt]&&Je===de[++rt]&&Je===de[++rt]){xe=Ae.strstart+we;do;while(Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&Je===de[++rt]&&rt<xe);Ae.match_length=we-(xe-rt),Ae.match_length>Ae.lookahead&&(Ae.match_length=Ae.lookahead)}if(Ae.match_length>=fe?(Ye=H._tr_tally(Ae,1,Ae.match_length-fe),Ae.lookahead-=Ae.match_length,Ae.strstart+=Ae.match_length,Ae.match_length=0):(Ye=H._tr_tally(Ae,0,Ae.window[Ae.strstart]),Ae.lookahead--,Ae.strstart++),Ye&&(Pe(Ae,!1),Ae.strm.avail_out===0))return me}return Ae.insert=0,Oe===te?(Pe(Ae,!0),Ae.strm.avail_out===0?Fe:Be):Ae.last_lit&&(Pe(Ae,!1),Ae.strm.avail_out===0)?me:Ie}($e,We):B[$e.level].func($e,We);if(Ke!==Fe&&Ke!==Be||($e.status=666),Ke===me||Ke===Fe)return _e.avail_out===0&&($e.last_flush=-1),ne;if(Ke===Ie&&(We===1?H._tr_align($e):We!==5&&(H._tr_stored_block($e,0,0,!1),We===3&&(qe($e.head),$e.lookahead===0&&($e.strstart=0,$e.block_start=0,$e.insert=0))),Me(_e),_e.avail_out===0))return $e.last_flush=-1,ne}return We!==te?ne:$e.wrap<=0?1:($e.wrap===2?(Qe($e,255&_e.adler),Qe($e,_e.adler>>8&255),Qe($e,_e.adler>>16&255),Qe($e,_e.adler>>24&255),Qe($e,255&_e.total_in),Qe($e,_e.total_in>>8&255),Qe($e,_e.total_in>>16&255),Qe($e,_e.total_in>>24&255)):(je($e,_e.adler>>>16),je($e,65535&_e.adler)),Me(_e),0<$e.wrap&&($e.wrap=-$e.wrap),$e.pending!==0?ne:1)},$.deflateEnd=function(_e){var We;return _e&&_e.state?(We=_e.state.status)!==ve&&We!==69&&We!==73&&We!==91&&We!==103&&We!==ke&&We!==666?Ze(_e,oe):(_e.state=null,We===ke?Ze(_e,-3):ne):oe},$.deflateSetDictionary=function(_e,We){var Ne,$e,Te,De,Ge,Ke,Ae,Oe,Ye=We.length;if(!_e||!_e.state||(De=(Ne=_e.state).wrap)===2||De===1&&Ne.status!==ve||Ne.lookahead)return oe;for(De===1&&(_e.adler=j(_e.adler,We,Ye,0)),Ne.wrap=0,Ye>=Ne.w_size&&(De===0&&(qe(Ne.head),Ne.strstart=0,Ne.block_start=0,Ne.insert=0),Oe=new R.Buf8(Ne.w_size),R.arraySet(Oe,We,Ye-Ne.w_size,Ne.w_size,0),We=Oe,Ye=Ne.w_size),Ge=_e.avail_in,Ke=_e.next_in,Ae=_e.input,_e.avail_in=Ye,_e.next_in=0,_e.input=We,tt(Ne);Ne.lookahead>=fe;){for($e=Ne.strstart,Te=Ne.lookahead-(fe-1);Ne.ins_h=(Ne.ins_h<<Ne.hash_shift^Ne.window[$e+fe-1])&Ne.hash_mask,Ne.prev[$e&Ne.w_mask]=Ne.head[Ne.ins_h],Ne.head[Ne.ins_h]=$e,$e++,--Te;);Ne.strstart=$e,Ne.lookahead=fe-1,tt(Ne)}return Ne.strstart+=Ne.lookahead,Ne.block_start=Ne.strstart,Ne.insert=Ne.lookahead,Ne.lookahead=0,Ne.match_length=Ne.prev_length=fe-1,Ne.match_available=0,_e.next_in=Ke,_e.input=Ae,_e.avail_in=Ge,Ne.wrap=De,ne},$.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(y,w,$){w.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(y,w,$){w.exports=function(B,R){var H,j,q,X,ee,te,ne,oe,ie,ae,re,se,le,ue,he,ce,ge,be,fe,we,Ce,ve,ke,me,Ie;H=B.state,j=B.next_in,me=B.input,q=j+(B.avail_in-5),X=B.next_out,Ie=B.output,ee=X-(R-B.avail_out),te=X+(B.avail_out-257),ne=H.dmax,oe=H.wsize,ie=H.whave,ae=H.wnext,re=H.window,se=H.hold,le=H.bits,ue=H.lencode,he=H.distcode,ce=(1<<H.lenbits)-1,ge=(1<<H.distbits)-1;e:do{le<15&&(se+=me[j++]<<le,le+=8,se+=me[j++]<<le,le+=8),be=ue[se&ce];t:for(;;){if(se>>>=fe=be>>>24,le-=fe,(fe=be>>>16&255)===0)Ie[X++]=65535&be;else{if(!(16&fe)){if(!(64&fe)){be=ue[(65535&be)+(se&(1<<fe)-1)];continue t}if(32&fe){H.mode=12;break e}B.msg="invalid literal/length code",H.mode=30;break e}we=65535&be,(fe&=15)&&(le<fe&&(se+=me[j++]<<le,le+=8),we+=se&(1<<fe)-1,se>>>=fe,le-=fe),le<15&&(se+=me[j++]<<le,le+=8,se+=me[j++]<<le,le+=8),be=he[se&ge];n:for(;;){if(se>>>=fe=be>>>24,le-=fe,!(16&(fe=be>>>16&255))){if(!(64&fe)){be=he[(65535&be)+(se&(1<<fe)-1)];continue n}B.msg="invalid distance code",H.mode=30;break e}if(Ce=65535&be,le<(fe&=15)&&(se+=me[j++]<<le,(le+=8)<fe&&(se+=me[j++]<<le,le+=8)),ne<(Ce+=se&(1<<fe)-1)){B.msg="invalid distance too far back",H.mode=30;break e}if(se>>>=fe,le-=fe,(fe=X-ee)<Ce){if(ie<(fe=Ce-fe)&&H.sane){B.msg="invalid distance too far back",H.mode=30;break e}if(ke=re,(ve=0)===ae){if(ve+=oe-fe,fe<we){for(we-=fe;Ie[X++]=re[ve++],--fe;);ve=X-Ce,ke=Ie}}else if(ae<fe){if(ve+=oe+ae-fe,(fe-=ae)<we){for(we-=fe;Ie[X++]=re[ve++],--fe;);if(ve=0,ae<we){for(we-=fe=ae;Ie[X++]=re[ve++],--fe;);ve=X-Ce,ke=Ie}}}else if(ve+=ae-fe,fe<we){for(we-=fe;Ie[X++]=re[ve++],--fe;);ve=X-Ce,ke=Ie}for(;2<we;)Ie[X++]=ke[ve++],Ie[X++]=ke[ve++],Ie[X++]=ke[ve++],we-=3;we&&(Ie[X++]=ke[ve++],1<we&&(Ie[X++]=ke[ve++]))}else{for(ve=X-Ce;Ie[X++]=Ie[ve++],Ie[X++]=Ie[ve++],Ie[X++]=Ie[ve++],2<(we-=3););we&&(Ie[X++]=Ie[ve++],1<we&&(Ie[X++]=Ie[ve++]))}break}}break}}while(j<q&&X<te);j-=we=le>>3,se&=(1<<(le-=we<<3))-1,B.next_in=j,B.next_out=X,B.avail_in=j<q?q-j+5:5-(j-q),B.avail_out=X<te?te-X+257:257-(X-te),H.hold=se,H.bits=le}},{}],49:[function(y,w,$){var B=y("../utils/common"),R=y("./adler32"),H=y("./crc32"),j=y("./inffast"),q=y("./inftrees"),X=1,ee=2,te=0,ne=-2,oe=1,ie=852,ae=592;function re(ve){return(ve>>>24&255)+(ve>>>8&65280)+((65280&ve)<<8)+((255&ve)<<24)}function se(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new B.Buf16(320),this.work=new B.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function le(ve){var ke;return ve&&ve.state?(ke=ve.state,ve.total_in=ve.total_out=ke.total=0,ve.msg="",ke.wrap&&(ve.adler=1&ke.wrap),ke.mode=oe,ke.last=0,ke.havedict=0,ke.dmax=32768,ke.head=null,ke.hold=0,ke.bits=0,ke.lencode=ke.lendyn=new B.Buf32(ie),ke.distcode=ke.distdyn=new B.Buf32(ae),ke.sane=1,ke.back=-1,te):ne}function ue(ve){var ke;return ve&&ve.state?((ke=ve.state).wsize=0,ke.whave=0,ke.wnext=0,le(ve)):ne}function he(ve,ke){var me,Ie;return ve&&ve.state?(Ie=ve.state,ke<0?(me=0,ke=-ke):(me=1+(ke>>4),ke<48&&(ke&=15)),ke&&(ke<8||15<ke)?ne:(Ie.window!==null&&Ie.wbits!==ke&&(Ie.window=null),Ie.wrap=me,Ie.wbits=ke,ue(ve))):ne}function ce(ve,ke){var me,Ie;return ve?(Ie=new se,(ve.state=Ie).window=null,(me=he(ve,ke))!==te&&(ve.state=null),me):ne}var ge,be,fe=!0;function we(ve){if(fe){var ke;for(ge=new B.Buf32(512),be=new B.Buf32(32),ke=0;ke<144;)ve.lens[ke++]=8;for(;ke<256;)ve.lens[ke++]=9;for(;ke<280;)ve.lens[ke++]=7;for(;ke<288;)ve.lens[ke++]=8;for(q(X,ve.lens,0,288,ge,0,ve.work,{bits:9}),ke=0;ke<32;)ve.lens[ke++]=5;q(ee,ve.lens,0,32,be,0,ve.work,{bits:5}),fe=!1}ve.lencode=ge,ve.lenbits=9,ve.distcode=be,ve.distbits=5}function Ce(ve,ke,me,Ie){var Fe,Be=ve.state;return Be.window===null&&(Be.wsize=1<<Be.wbits,Be.wnext=0,Be.whave=0,Be.window=new B.Buf8(Be.wsize)),Ie>=Be.wsize?(B.arraySet(Be.window,ke,me-Be.wsize,Be.wsize,0),Be.wnext=0,Be.whave=Be.wsize):(Ie<(Fe=Be.wsize-Be.wnext)&&(Fe=Ie),B.arraySet(Be.window,ke,me-Ie,Fe,Be.wnext),(Ie-=Fe)?(B.arraySet(Be.window,ke,me-Ie,Ie,0),Be.wnext=Ie,Be.whave=Be.wsize):(Be.wnext+=Fe,Be.wnext===Be.wsize&&(Be.wnext=0),Be.whave<Be.wsize&&(Be.whave+=Fe))),0}$.inflateReset=ue,$.inflateReset2=he,$.inflateResetKeep=le,$.inflateInit=function(ve){return ce(ve,15)},$.inflateInit2=ce,$.inflate=function(ve,ke){var me,Ie,Fe,Be,Ze,Re,qe,Me,Pe,Qe,je,Ue,tt,Ve,nt,et,st,at,ct,lt,_e,We,Ne,$e,Te=0,De=new B.Buf8(4),Ge=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ve||!ve.state||!ve.output||!ve.input&&ve.avail_in!==0)return ne;(me=ve.state).mode===12&&(me.mode=13),Ze=ve.next_out,Fe=ve.output,qe=ve.avail_out,Be=ve.next_in,Ie=ve.input,Re=ve.avail_in,Me=me.hold,Pe=me.bits,Qe=Re,je=qe,We=te;e:for(;;)switch(me.mode){case oe:if(me.wrap===0){me.mode=13;break}for(;Pe<16;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(2&me.wrap&&Me===35615){De[me.check=0]=255&Me,De[1]=Me>>>8&255,me.check=H(me.check,De,2,0),Pe=Me=0,me.mode=2;break}if(me.flags=0,me.head&&(me.head.done=!1),!(1&me.wrap)||(((255&Me)<<8)+(Me>>8))%31){ve.msg="incorrect header check",me.mode=30;break}if((15&Me)!=8){ve.msg="unknown compression method",me.mode=30;break}if(Pe-=4,_e=8+(15&(Me>>>=4)),me.wbits===0)me.wbits=_e;else if(_e>me.wbits){ve.msg="invalid window size",me.mode=30;break}me.dmax=1<<_e,ve.adler=me.check=1,me.mode=512&Me?10:12,Pe=Me=0;break;case 2:for(;Pe<16;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(me.flags=Me,(255&me.flags)!=8){ve.msg="unknown compression method",me.mode=30;break}if(57344&me.flags){ve.msg="unknown header flags set",me.mode=30;break}me.head&&(me.head.text=Me>>8&1),512&me.flags&&(De[0]=255&Me,De[1]=Me>>>8&255,me.check=H(me.check,De,2,0)),Pe=Me=0,me.mode=3;case 3:for(;Pe<32;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.head&&(me.head.time=Me),512&me.flags&&(De[0]=255&Me,De[1]=Me>>>8&255,De[2]=Me>>>16&255,De[3]=Me>>>24&255,me.check=H(me.check,De,4,0)),Pe=Me=0,me.mode=4;case 4:for(;Pe<16;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.head&&(me.head.xflags=255&Me,me.head.os=Me>>8),512&me.flags&&(De[0]=255&Me,De[1]=Me>>>8&255,me.check=H(me.check,De,2,0)),Pe=Me=0,me.mode=5;case 5:if(1024&me.flags){for(;Pe<16;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.length=Me,me.head&&(me.head.extra_len=Me),512&me.flags&&(De[0]=255&Me,De[1]=Me>>>8&255,me.check=H(me.check,De,2,0)),Pe=Me=0}else me.head&&(me.head.extra=null);me.mode=6;case 6:if(1024&me.flags&&(Re<(Ue=me.length)&&(Ue=Re),Ue&&(me.head&&(_e=me.head.extra_len-me.length,me.head.extra||(me.head.extra=new Array(me.head.extra_len)),B.arraySet(me.head.extra,Ie,Be,Ue,_e)),512&me.flags&&(me.check=H(me.check,Ie,Ue,Be)),Re-=Ue,Be+=Ue,me.length-=Ue),me.length))break e;me.length=0,me.mode=7;case 7:if(2048&me.flags){if(Re===0)break e;for(Ue=0;_e=Ie[Be+Ue++],me.head&&_e&&me.length<65536&&(me.head.name+=String.fromCharCode(_e)),_e&&Ue<Re;);if(512&me.flags&&(me.check=H(me.check,Ie,Ue,Be)),Re-=Ue,Be+=Ue,_e)break e}else me.head&&(me.head.name=null);me.length=0,me.mode=8;case 8:if(4096&me.flags){if(Re===0)break e;for(Ue=0;_e=Ie[Be+Ue++],me.head&&_e&&me.length<65536&&(me.head.comment+=String.fromCharCode(_e)),_e&&Ue<Re;);if(512&me.flags&&(me.check=H(me.check,Ie,Ue,Be)),Re-=Ue,Be+=Ue,_e)break e}else me.head&&(me.head.comment=null);me.mode=9;case 9:if(512&me.flags){for(;Pe<16;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(Me!==(65535&me.check)){ve.msg="header crc mismatch",me.mode=30;break}Pe=Me=0}me.head&&(me.head.hcrc=me.flags>>9&1,me.head.done=!0),ve.adler=me.check=0,me.mode=12;break;case 10:for(;Pe<32;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}ve.adler=me.check=re(Me),Pe=Me=0,me.mode=11;case 11:if(me.havedict===0)return ve.next_out=Ze,ve.avail_out=qe,ve.next_in=Be,ve.avail_in=Re,me.hold=Me,me.bits=Pe,2;ve.adler=me.check=1,me.mode=12;case 12:if(ke===5||ke===6)break e;case 13:if(me.last){Me>>>=7&Pe,Pe-=7&Pe,me.mode=27;break}for(;Pe<3;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}switch(me.last=1&Me,Pe-=1,3&(Me>>>=1)){case 0:me.mode=14;break;case 1:if(we(me),me.mode=20,ke!==6)break;Me>>>=2,Pe-=2;break e;case 2:me.mode=17;break;case 3:ve.msg="invalid block type",me.mode=30}Me>>>=2,Pe-=2;break;case 14:for(Me>>>=7&Pe,Pe-=7&Pe;Pe<32;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if((65535&Me)!=(Me>>>16^65535)){ve.msg="invalid stored block lengths",me.mode=30;break}if(me.length=65535&Me,Pe=Me=0,me.mode=15,ke===6)break e;case 15:me.mode=16;case 16:if(Ue=me.length){if(Re<Ue&&(Ue=Re),qe<Ue&&(Ue=qe),Ue===0)break e;B.arraySet(Fe,Ie,Be,Ue,Ze),Re-=Ue,Be+=Ue,qe-=Ue,Ze+=Ue,me.length-=Ue;break}me.mode=12;break;case 17:for(;Pe<14;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(me.nlen=257+(31&Me),Me>>>=5,Pe-=5,me.ndist=1+(31&Me),Me>>>=5,Pe-=5,me.ncode=4+(15&Me),Me>>>=4,Pe-=4,286<me.nlen||30<me.ndist){ve.msg="too many length or distance symbols",me.mode=30;break}me.have=0,me.mode=18;case 18:for(;me.have<me.ncode;){for(;Pe<3;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.lens[Ge[me.have++]]=7&Me,Me>>>=3,Pe-=3}for(;me.have<19;)me.lens[Ge[me.have++]]=0;if(me.lencode=me.lendyn,me.lenbits=7,Ne={bits:me.lenbits},We=q(0,me.lens,0,19,me.lencode,0,me.work,Ne),me.lenbits=Ne.bits,We){ve.msg="invalid code lengths set",me.mode=30;break}me.have=0,me.mode=19;case 19:for(;me.have<me.nlen+me.ndist;){for(;et=(Te=me.lencode[Me&(1<<me.lenbits)-1])>>>16&255,st=65535&Te,!((nt=Te>>>24)<=Pe);){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(st<16)Me>>>=nt,Pe-=nt,me.lens[me.have++]=st;else{if(st===16){for($e=nt+2;Pe<$e;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(Me>>>=nt,Pe-=nt,me.have===0){ve.msg="invalid bit length repeat",me.mode=30;break}_e=me.lens[me.have-1],Ue=3+(3&Me),Me>>>=2,Pe-=2}else if(st===17){for($e=nt+3;Pe<$e;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}Pe-=nt,_e=0,Ue=3+(7&(Me>>>=nt)),Me>>>=3,Pe-=3}else{for($e=nt+7;Pe<$e;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}Pe-=nt,_e=0,Ue=11+(127&(Me>>>=nt)),Me>>>=7,Pe-=7}if(me.have+Ue>me.nlen+me.ndist){ve.msg="invalid bit length repeat",me.mode=30;break}for(;Ue--;)me.lens[me.have++]=_e}}if(me.mode===30)break;if(me.lens[256]===0){ve.msg="invalid code -- missing end-of-block",me.mode=30;break}if(me.lenbits=9,Ne={bits:me.lenbits},We=q(X,me.lens,0,me.nlen,me.lencode,0,me.work,Ne),me.lenbits=Ne.bits,We){ve.msg="invalid literal/lengths set",me.mode=30;break}if(me.distbits=6,me.distcode=me.distdyn,Ne={bits:me.distbits},We=q(ee,me.lens,me.nlen,me.ndist,me.distcode,0,me.work,Ne),me.distbits=Ne.bits,We){ve.msg="invalid distances set",me.mode=30;break}if(me.mode=20,ke===6)break e;case 20:me.mode=21;case 21:if(6<=Re&&258<=qe){ve.next_out=Ze,ve.avail_out=qe,ve.next_in=Be,ve.avail_in=Re,me.hold=Me,me.bits=Pe,j(ve,je),Ze=ve.next_out,Fe=ve.output,qe=ve.avail_out,Be=ve.next_in,Ie=ve.input,Re=ve.avail_in,Me=me.hold,Pe=me.bits,me.mode===12&&(me.back=-1);break}for(me.back=0;et=(Te=me.lencode[Me&(1<<me.lenbits)-1])>>>16&255,st=65535&Te,!((nt=Te>>>24)<=Pe);){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(et&&!(240&et)){for(at=nt,ct=et,lt=st;et=(Te=me.lencode[lt+((Me&(1<<at+ct)-1)>>at)])>>>16&255,st=65535&Te,!(at+(nt=Te>>>24)<=Pe);){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}Me>>>=at,Pe-=at,me.back+=at}if(Me>>>=nt,Pe-=nt,me.back+=nt,me.length=st,et===0){me.mode=26;break}if(32&et){me.back=-1,me.mode=12;break}if(64&et){ve.msg="invalid literal/length code",me.mode=30;break}me.extra=15&et,me.mode=22;case 22:if(me.extra){for($e=me.extra;Pe<$e;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.length+=Me&(1<<me.extra)-1,Me>>>=me.extra,Pe-=me.extra,me.back+=me.extra}me.was=me.length,me.mode=23;case 23:for(;et=(Te=me.distcode[Me&(1<<me.distbits)-1])>>>16&255,st=65535&Te,!((nt=Te>>>24)<=Pe);){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(!(240&et)){for(at=nt,ct=et,lt=st;et=(Te=me.distcode[lt+((Me&(1<<at+ct)-1)>>at)])>>>16&255,st=65535&Te,!(at+(nt=Te>>>24)<=Pe);){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}Me>>>=at,Pe-=at,me.back+=at}if(Me>>>=nt,Pe-=nt,me.back+=nt,64&et){ve.msg="invalid distance code",me.mode=30;break}me.offset=st,me.extra=15&et,me.mode=24;case 24:if(me.extra){for($e=me.extra;Pe<$e;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}me.offset+=Me&(1<<me.extra)-1,Me>>>=me.extra,Pe-=me.extra,me.back+=me.extra}if(me.offset>me.dmax){ve.msg="invalid distance too far back",me.mode=30;break}me.mode=25;case 25:if(qe===0)break e;if(Ue=je-qe,me.offset>Ue){if((Ue=me.offset-Ue)>me.whave&&me.sane){ve.msg="invalid distance too far back",me.mode=30;break}tt=Ue>me.wnext?(Ue-=me.wnext,me.wsize-Ue):me.wnext-Ue,Ue>me.length&&(Ue=me.length),Ve=me.window}else Ve=Fe,tt=Ze-me.offset,Ue=me.length;for(qe<Ue&&(Ue=qe),qe-=Ue,me.length-=Ue;Fe[Ze++]=Ve[tt++],--Ue;);me.length===0&&(me.mode=21);break;case 26:if(qe===0)break e;Fe[Ze++]=me.length,qe--,me.mode=21;break;case 27:if(me.wrap){for(;Pe<32;){if(Re===0)break e;Re--,Me|=Ie[Be++]<<Pe,Pe+=8}if(je-=qe,ve.total_out+=je,me.total+=je,je&&(ve.adler=me.check=me.flags?H(me.check,Fe,je,Ze-je):R(me.check,Fe,je,Ze-je)),je=qe,(me.flags?Me:re(Me))!==me.check){ve.msg="incorrect data check",me.mode=30;break}Pe=Me=0}me.mode=28;case 28:if(me.wrap&&me.flags){for(;Pe<32;){if(Re===0)break e;Re--,Me+=Ie[Be++]<<Pe,Pe+=8}if(Me!==(4294967295&me.total)){ve.msg="incorrect length check",me.mode=30;break}Pe=Me=0}me.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;case 32:default:return ne}return ve.next_out=Ze,ve.avail_out=qe,ve.next_in=Be,ve.avail_in=Re,me.hold=Me,me.bits=Pe,(me.wsize||je!==ve.avail_out&&me.mode<30&&(me.mode<27||ke!==4))&&Ce(ve,ve.output,ve.next_out,je-ve.avail_out)?(me.mode=31,-4):(Qe-=ve.avail_in,je-=ve.avail_out,ve.total_in+=Qe,ve.total_out+=je,me.total+=je,me.wrap&&je&&(ve.adler=me.check=me.flags?H(me.check,Fe,je,ve.next_out-je):R(me.check,Fe,je,ve.next_out-je)),ve.data_type=me.bits+(me.last?64:0)+(me.mode===12?128:0)+(me.mode===20||me.mode===15?256:0),(Qe==0&&je===0||ke===4)&&We===te&&(We=-5),We)},$.inflateEnd=function(ve){if(!ve||!ve.state)return ne;var ke=ve.state;return ke.window&&(ke.window=null),ve.state=null,te},$.inflateGetHeader=function(ve,ke){var me;return ve&&ve.state&&2&(me=ve.state).wrap?((me.head=ke).done=!1,te):ne},$.inflateSetDictionary=function(ve,ke){var me,Ie=ke.length;return ve&&ve.state?(me=ve.state).wrap!==0&&me.mode!==11?ne:me.mode===11&&R(1,ke,Ie,0)!==me.check?-3:Ce(ve,ke,Ie,Ie)?(me.mode=31,-4):(me.havedict=1,te):ne},$.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(y,w,$){var B=y("../utils/common"),R=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],H=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],q=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];w.exports=function(X,ee,te,ne,oe,ie,ae,re){var se,le,ue,he,ce,ge,be,fe,we,Ce=re.bits,ve=0,ke=0,me=0,Ie=0,Fe=0,Be=0,Ze=0,Re=0,qe=0,Me=0,Pe=null,Qe=0,je=new B.Buf16(16),Ue=new B.Buf16(16),tt=null,Ve=0;for(ve=0;ve<=15;ve++)je[ve]=0;for(ke=0;ke<ne;ke++)je[ee[te+ke]]++;for(Fe=Ce,Ie=15;1<=Ie&&je[Ie]===0;Ie--);if(Ie<Fe&&(Fe=Ie),Ie===0)return oe[ie++]=20971520,oe[ie++]=20971520,re.bits=1,0;for(me=1;me<Ie&&je[me]===0;me++);for(Fe<me&&(Fe=me),ve=Re=1;ve<=15;ve++)if(Re<<=1,(Re-=je[ve])<0)return-1;if(0<Re&&(X===0||Ie!==1))return-1;for(Ue[1]=0,ve=1;ve<15;ve++)Ue[ve+1]=Ue[ve]+je[ve];for(ke=0;ke<ne;ke++)ee[te+ke]!==0&&(ae[Ue[ee[te+ke]]++]=ke);if(ge=X===0?(Pe=tt=ae,19):X===1?(Pe=R,Qe-=257,tt=H,Ve-=257,256):(Pe=j,tt=q,-1),ve=me,ce=ie,Ze=ke=Me=0,ue=-1,he=(qe=1<<(Be=Fe))-1,X===1&&852<qe||X===2&&592<qe)return 1;for(;;){for(be=ve-Ze,we=ae[ke]<ge?(fe=0,ae[ke]):ae[ke]>ge?(fe=tt[Ve+ae[ke]],Pe[Qe+ae[ke]]):(fe=96,0),se=1<<ve-Ze,me=le=1<<Be;oe[ce+(Me>>Ze)+(le-=se)]=be<<24|fe<<16|we|0,le!==0;);for(se=1<<ve-1;Me&se;)se>>=1;if(se!==0?(Me&=se-1,Me+=se):Me=0,ke++,--je[ve]==0){if(ve===Ie)break;ve=ee[te+ae[ke]]}if(Fe<ve&&(Me&he)!==ue){for(Ze===0&&(Ze=Fe),ce+=me,Re=1<<(Be=ve-Ze);Be+Ze<Ie&&!((Re-=je[Be+Ze])<=0);)Be++,Re<<=1;if(qe+=1<<Be,X===1&&852<qe||X===2&&592<qe)return 1;oe[ue=Me&he]=Fe<<24|Be<<16|ce-ie|0}}return Me!==0&&(oe[ce+Me]=ve-Ze<<24|64<<16|0),re.bits=Fe,0}},{"../utils/common":41}],51:[function(y,w,$){w.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(y,w,$){var B=y("../utils/common"),R=0,H=1;function j(Te){for(var De=Te.length;0<=--De;)Te[De]=0}var q=0,X=29,ee=256,te=ee+1+X,ne=30,oe=19,ie=2*te+1,ae=15,re=16,se=7,le=256,ue=16,he=17,ce=18,ge=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],be=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],fe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],we=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ce=new Array(2*(te+2));j(Ce);var ve=new Array(2*ne);j(ve);var ke=new Array(512);j(ke);var me=new Array(256);j(me);var Ie=new Array(X);j(Ie);var Fe,Be,Ze,Re=new Array(ne);function qe(Te,De,Ge,Ke,Ae){this.static_tree=Te,this.extra_bits=De,this.extra_base=Ge,this.elems=Ke,this.max_length=Ae,this.has_stree=Te&&Te.length}function Me(Te,De){this.dyn_tree=Te,this.max_code=0,this.stat_desc=De}function Pe(Te){return Te<256?ke[Te]:ke[256+(Te>>>7)]}function Qe(Te,De){Te.pending_buf[Te.pending++]=255&De,Te.pending_buf[Te.pending++]=De>>>8&255}function je(Te,De,Ge){Te.bi_valid>re-Ge?(Te.bi_buf|=De<<Te.bi_valid&65535,Qe(Te,Te.bi_buf),Te.bi_buf=De>>re-Te.bi_valid,Te.bi_valid+=Ge-re):(Te.bi_buf|=De<<Te.bi_valid&65535,Te.bi_valid+=Ge)}function Ue(Te,De,Ge){je(Te,Ge[2*De],Ge[2*De+1])}function tt(Te,De){for(var Ge=0;Ge|=1&Te,Te>>>=1,Ge<<=1,0<--De;);return Ge>>>1}function Ve(Te,De,Ge){var Ke,Ae,Oe=new Array(ae+1),Ye=0;for(Ke=1;Ke<=ae;Ke++)Oe[Ke]=Ye=Ye+Ge[Ke-1]<<1;for(Ae=0;Ae<=De;Ae++){var Je=Te[2*Ae+1];Je!==0&&(Te[2*Ae]=tt(Oe[Je]++,Je))}}function nt(Te){var De;for(De=0;De<te;De++)Te.dyn_ltree[2*De]=0;for(De=0;De<ne;De++)Te.dyn_dtree[2*De]=0;for(De=0;De<oe;De++)Te.bl_tree[2*De]=0;Te.dyn_ltree[2*le]=1,Te.opt_len=Te.static_len=0,Te.last_lit=Te.matches=0}function et(Te){8<Te.bi_valid?Qe(Te,Te.bi_buf):0<Te.bi_valid&&(Te.pending_buf[Te.pending++]=Te.bi_buf),Te.bi_buf=0,Te.bi_valid=0}function st(Te,De,Ge,Ke){var Ae=2*De,Oe=2*Ge;return Te[Ae]<Te[Oe]||Te[Ae]===Te[Oe]&&Ke[De]<=Ke[Ge]}function at(Te,De,Ge){for(var Ke=Te.heap[Ge],Ae=Ge<<1;Ae<=Te.heap_len&&(Ae<Te.heap_len&&st(De,Te.heap[Ae+1],Te.heap[Ae],Te.depth)&&Ae++,!st(De,Ke,Te.heap[Ae],Te.depth));)Te.heap[Ge]=Te.heap[Ae],Ge=Ae,Ae<<=1;Te.heap[Ge]=Ke}function ct(Te,De,Ge){var Ke,Ae,Oe,Ye,Je=0;if(Te.last_lit!==0)for(;Ke=Te.pending_buf[Te.d_buf+2*Je]<<8|Te.pending_buf[Te.d_buf+2*Je+1],Ae=Te.pending_buf[Te.l_buf+Je],Je++,Ke===0?Ue(Te,Ae,De):(Ue(Te,(Oe=me[Ae])+ee+1,De),(Ye=ge[Oe])!==0&&je(Te,Ae-=Ie[Oe],Ye),Ue(Te,Oe=Pe(--Ke),Ge),(Ye=be[Oe])!==0&&je(Te,Ke-=Re[Oe],Ye)),Je<Te.last_lit;);Ue(Te,le,De)}function lt(Te,De){var Ge,Ke,Ae,Oe=De.dyn_tree,Ye=De.stat_desc.static_tree,Je=De.stat_desc.has_stree,rt=De.stat_desc.elems,xe=-1;for(Te.heap_len=0,Te.heap_max=ie,Ge=0;Ge<rt;Ge++)Oe[2*Ge]!==0?(Te.heap[++Te.heap_len]=xe=Ge,Te.depth[Ge]=0):Oe[2*Ge+1]=0;for(;Te.heap_len<2;)Oe[2*(Ae=Te.heap[++Te.heap_len]=xe<2?++xe:0)]=1,Te.depth[Ae]=0,Te.opt_len--,Je&&(Te.static_len-=Ye[2*Ae+1]);for(De.max_code=xe,Ge=Te.heap_len>>1;1<=Ge;Ge--)at(Te,Oe,Ge);for(Ae=rt;Ge=Te.heap[1],Te.heap[1]=Te.heap[Te.heap_len--],at(Te,Oe,1),Ke=Te.heap[1],Te.heap[--Te.heap_max]=Ge,Te.heap[--Te.heap_max]=Ke,Oe[2*Ae]=Oe[2*Ge]+Oe[2*Ke],Te.depth[Ae]=(Te.depth[Ge]>=Te.depth[Ke]?Te.depth[Ge]:Te.depth[Ke])+1,Oe[2*Ge+1]=Oe[2*Ke+1]=Ae,Te.heap[1]=Ae++,at(Te,Oe,1),2<=Te.heap_len;);Te.heap[--Te.heap_max]=Te.heap[1],function(de,pe){var Se,Le,ye,Ee,He,ze,Xe=pe.dyn_tree,ot=pe.max_code,it=pe.stat_desc.static_tree,dt=pe.stat_desc.has_stree,ht=pe.stat_desc.extra_bits,pt=pe.stat_desc.extra_base,ut=pe.stat_desc.max_length,ft=0;for(Ee=0;Ee<=ae;Ee++)de.bl_count[Ee]=0;for(Xe[2*de.heap[de.heap_max]+1]=0,Se=de.heap_max+1;Se<ie;Se++)ut<(Ee=Xe[2*Xe[2*(Le=de.heap[Se])+1]+1]+1)&&(Ee=ut,ft++),Xe[2*Le+1]=Ee,ot<Le||(de.bl_count[Ee]++,He=0,pt<=Le&&(He=ht[Le-pt]),ze=Xe[2*Le],de.opt_len+=ze*(Ee+He),dt&&(de.static_len+=ze*(it[2*Le+1]+He)));if(ft!==0){do{for(Ee=ut-1;de.bl_count[Ee]===0;)Ee--;de.bl_count[Ee]--,de.bl_count[Ee+1]+=2,de.bl_count[ut]--,ft-=2}while(0<ft);for(Ee=ut;Ee!==0;Ee--)for(Le=de.bl_count[Ee];Le!==0;)ot<(ye=de.heap[--Se])||(Xe[2*ye+1]!==Ee&&(de.opt_len+=(Ee-Xe[2*ye+1])*Xe[2*ye],Xe[2*ye+1]=Ee),Le--)}}(Te,De),Ve(Oe,xe,Te.bl_count)}function _e(Te,De,Ge){var Ke,Ae,Oe=-1,Ye=De[1],Je=0,rt=7,xe=4;for(Ye===0&&(rt=138,xe=3),De[2*(Ge+1)+1]=65535,Ke=0;Ke<=Ge;Ke++)Ae=Ye,Ye=De[2*(Ke+1)+1],++Je<rt&&Ae===Ye||(Je<xe?Te.bl_tree[2*Ae]+=Je:Ae!==0?(Ae!==Oe&&Te.bl_tree[2*Ae]++,Te.bl_tree[2*ue]++):Je<=10?Te.bl_tree[2*he]++:Te.bl_tree[2*ce]++,Oe=Ae,xe=(Je=0)===Ye?(rt=138,3):Ae===Ye?(rt=6,3):(rt=7,4))}function We(Te,De,Ge){var Ke,Ae,Oe=-1,Ye=De[1],Je=0,rt=7,xe=4;for(Ye===0&&(rt=138,xe=3),Ke=0;Ke<=Ge;Ke++)if(Ae=Ye,Ye=De[2*(Ke+1)+1],!(++Je<rt&&Ae===Ye)){if(Je<xe)for(;Ue(Te,Ae,Te.bl_tree),--Je!=0;);else Ae!==0?(Ae!==Oe&&(Ue(Te,Ae,Te.bl_tree),Je--),Ue(Te,ue,Te.bl_tree),je(Te,Je-3,2)):Je<=10?(Ue(Te,he,Te.bl_tree),je(Te,Je-3,3)):(Ue(Te,ce,Te.bl_tree),je(Te,Je-11,7));Oe=Ae,xe=(Je=0)===Ye?(rt=138,3):Ae===Ye?(rt=6,3):(rt=7,4)}}j(Re);var Ne=!1;function $e(Te,De,Ge,Ke){je(Te,(q<<1)+(Ke?1:0),3),function(Ae,Oe,Ye,Je){et(Ae),Je&&(Qe(Ae,Ye),Qe(Ae,~Ye)),B.arraySet(Ae.pending_buf,Ae.window,Oe,Ye,Ae.pending),Ae.pending+=Ye}(Te,De,Ge,!0)}$._tr_init=function(Te){Ne||(function(){var De,Ge,Ke,Ae,Oe,Ye=new Array(ae+1);for(Ae=Ke=0;Ae<X-1;Ae++)for(Ie[Ae]=Ke,De=0;De<1<<ge[Ae];De++)me[Ke++]=Ae;for(me[Ke-1]=Ae,Ae=Oe=0;Ae<16;Ae++)for(Re[Ae]=Oe,De=0;De<1<<be[Ae];De++)ke[Oe++]=Ae;for(Oe>>=7;Ae<ne;Ae++)for(Re[Ae]=Oe<<7,De=0;De<1<<be[Ae]-7;De++)ke[256+Oe++]=Ae;for(Ge=0;Ge<=ae;Ge++)Ye[Ge]=0;for(De=0;De<=143;)Ce[2*De+1]=8,De++,Ye[8]++;for(;De<=255;)Ce[2*De+1]=9,De++,Ye[9]++;for(;De<=279;)Ce[2*De+1]=7,De++,Ye[7]++;for(;De<=287;)Ce[2*De+1]=8,De++,Ye[8]++;for(Ve(Ce,te+1,Ye),De=0;De<ne;De++)ve[2*De+1]=5,ve[2*De]=tt(De,5);Fe=new qe(Ce,ge,ee+1,te,ae),Be=new qe(ve,be,0,ne,ae),Ze=new qe(new Array(0),fe,0,oe,se)}(),Ne=!0),Te.l_desc=new Me(Te.dyn_ltree,Fe),Te.d_desc=new Me(Te.dyn_dtree,Be),Te.bl_desc=new Me(Te.bl_tree,Ze),Te.bi_buf=0,Te.bi_valid=0,nt(Te)},$._tr_stored_block=$e,$._tr_flush_block=function(Te,De,Ge,Ke){var Ae,Oe,Ye=0;0<Te.level?(Te.strm.data_type===2&&(Te.strm.data_type=function(Je){var rt,xe=4093624447;for(rt=0;rt<=31;rt++,xe>>>=1)if(1&xe&&Je.dyn_ltree[2*rt]!==0)return R;if(Je.dyn_ltree[18]!==0||Je.dyn_ltree[20]!==0||Je.dyn_ltree[26]!==0)return H;for(rt=32;rt<ee;rt++)if(Je.dyn_ltree[2*rt]!==0)return H;return R}(Te)),lt(Te,Te.l_desc),lt(Te,Te.d_desc),Ye=function(Je){var rt;for(_e(Je,Je.dyn_ltree,Je.l_desc.max_code),_e(Je,Je.dyn_dtree,Je.d_desc.max_code),lt(Je,Je.bl_desc),rt=oe-1;3<=rt&&Je.bl_tree[2*we[rt]+1]===0;rt--);return Je.opt_len+=3*(rt+1)+5+5+4,rt}(Te),Ae=Te.opt_len+3+7>>>3,(Oe=Te.static_len+3+7>>>3)<=Ae&&(Ae=Oe)):Ae=Oe=Ge+5,Ge+4<=Ae&&De!==-1?$e(Te,De,Ge,Ke):Te.strategy===4||Oe===Ae?(je(Te,2+(Ke?1:0),3),ct(Te,Ce,ve)):(je(Te,4+(Ke?1:0),3),function(Je,rt,xe,de){var pe;for(je(Je,rt-257,5),je(Je,xe-1,5),je(Je,de-4,4),pe=0;pe<de;pe++)je(Je,Je.bl_tree[2*we[pe]+1],3);We(Je,Je.dyn_ltree,rt-1),We(Je,Je.dyn_dtree,xe-1)}(Te,Te.l_desc.max_code+1,Te.d_desc.max_code+1,Ye+1),ct(Te,Te.dyn_ltree,Te.dyn_dtree)),nt(Te),Ke&&et(Te)},$._tr_tally=function(Te,De,Ge){return Te.pending_buf[Te.d_buf+2*Te.last_lit]=De>>>8&255,Te.pending_buf[Te.d_buf+2*Te.last_lit+1]=255&De,Te.pending_buf[Te.l_buf+Te.last_lit]=255&Ge,Te.last_lit++,De===0?Te.dyn_ltree[2*Ge]++:(Te.matches++,De--,Te.dyn_ltree[2*(me[Ge]+ee+1)]++,Te.dyn_dtree[2*Pe(De)]++),Te.last_lit===Te.lit_bufsize-1},$._tr_align=function(Te){je(Te,2,3),Ue(Te,le,Ce),function(De){De.bi_valid===16?(Qe(De,De.bi_buf),De.bi_buf=0,De.bi_valid=0):8<=De.bi_valid&&(De.pending_buf[De.pending++]=255&De.bi_buf,De.bi_buf>>=8,De.bi_valid-=8)}(Te)}},{"../utils/common":41}],53:[function(y,w,$){w.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(y,w,$){(function(B){(function(R,H){if(!R.setImmediate){var j,q,X,ee,te=1,ne={},oe=!1,ie=R.document,ae=Object.getPrototypeOf&&Object.getPrototypeOf(R);ae=ae&&ae.setTimeout?ae:R,j={}.toString.call(R.process)==="[object process]"?function(ue){process.nextTick(function(){se(ue)})}:function(){if(R.postMessage&&!R.importScripts){var ue=!0,he=R.onmessage;return R.onmessage=function(){ue=!1},R.postMessage("","*"),R.onmessage=he,ue}}()?(ee="setImmediate$"+Math.random()+"$",R.addEventListener?R.addEventListener("message",le,!1):R.attachEvent("onmessage",le),function(ue){R.postMessage(ee+ue,"*")}):R.MessageChannel?((X=new MessageChannel).port1.onmessage=function(ue){se(ue.data)},function(ue){X.port2.postMessage(ue)}):ie&&"onreadystatechange"in ie.createElement("script")?(q=ie.documentElement,function(ue){var he=ie.createElement("script");he.onreadystatechange=function(){se(ue),he.onreadystatechange=null,q.removeChild(he),he=null},q.appendChild(he)}):function(ue){setTimeout(se,0,ue)},ae.setImmediate=function(ue){typeof ue!="function"&&(ue=new Function(""+ue));for(var he=new Array(arguments.length-1),ce=0;ce<he.length;ce++)he[ce]=arguments[ce+1];var ge={callback:ue,args:he};return ne[te]=ge,j(te),te++},ae.clearImmediate=re}function re(ue){delete ne[ue]}function se(ue){if(oe)setTimeout(se,0,ue);else{var he=ne[ue];if(he){oe=!0;try{(function(ce){var ge=ce.callback,be=ce.args;switch(be.length){case 0:ge();break;case 1:ge(be[0]);break;case 2:ge(be[0],be[1]);break;case 3:ge(be[0],be[1],be[2]);break;default:ge.apply(H,be)}})(he)}finally{re(ue),oe=!1}}}}function le(ue){ue.source===R&&typeof ue.data=="string"&&ue.data.indexOf(ee)===0&&se(+ue.data.slice(ee.length))}})(typeof self>"u"?B===void 0?this:B:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jszip_min$1);var jszip_minExports=jszip_min$1.exports;const JSZip=getDefaultExportFromCjs(jszip_minExports),jszip_min=_mergeNamespaces({__proto__:null,default:JSZip},[jszip_minExports]),styles$3=i$5`
  .container {
    position: absolute;
    width: 480px;
    left: calc(50% - 480px / 2);
    top: calc(50% - 270px / 2);
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-base);
    line-height: var(--affine-line-height);
    padding: 12px 40px 36px;
    gap: 20px;
    display: flex;
    flex-direction: column;
    background: var(--affine-background-primary-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 16px;
    z-index: var(--affine-z-index-popover);
  }

  .container[hidden] {
    display: none;
  }

  header {
    cursor: move;
    user-select: none;
    font-size: var(--affine-font-h-6);
    font-weight: 600;
  }

  a {
    white-space: nowrap;
    word-break: break-word;
    color: var(--affine-link-color);
    fill: var(--affine-link-color);
    text-decoration: none;
    cursor: pointer;
  }

  header icon-button {
    margin-left: auto;
    position: relative;
    left: 24px;
  }

  .button-container {
    display: flex;
    justify-content: space-between;
  }

  .button-container icon-button {
    padding: 8px 12px;
    justify-content: flex-start;
    gap: 12px;
    width: 190px;
    height: 40px;
    box-shadow: var(--affine-shadow-1);
    border-radius: 10px;
  }

  .footer {
    display: flex;
    align-items: center;
    color: var(--affine-text-secondary-color);
  }

  .loading-header {
    display: flex;
    align-items: center;
  }

  .has-tool-tip {
    display: flex;
    margin-left: auto;
  }

  .overlay-mask {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: var(--affine-z-index-popover);
  }

  ${tooltipStyle}
`;var __decorate$e=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const SHOW_LOADING_SIZE=1024*200;async function importMarkDown(k,_){const y=await createPage(k),w=y.root?.id;return assertExists(w,`Failed to import markdown, page root not found! pageId: ${y.id}`),await new ContentParser(y).importMarkdown(_,w),[y.id]}async function importHtml(k,_){const y=await createPage(k),w=y.root?.id;return assertExists(w,`Failed to import HTML, page root not found! pageId: ${y.id}`),await new ContentParser(y).importHtml(_,w),[y.id]}function joinWebPaths(...k){const y=k.join("/").replace(/\/+/g,"/").split("/").filter(Boolean),w=[];return y.forEach($=>{$!=="."&&($===".."?w.pop():w.push($))}),w.join("/")}async function importNotion(k,_){const y=[];let w=!1;const $=async R=>{const j=await new JSZip().loadAsync(R),q=new Map,X=Object.keys(j.files),ee=[];for(let ne=0;ne<X.length;ne++){const oe=X[ne];if(oe.startsWith("__MACOSX/"))continue;const ie=oe.lastIndexOf("/"),ae=oe.substring(ie+1);if(ae.endsWith(".html")||ae.endsWith(".md")){if(oe.endsWith("/index.html")){w=!0;continue}if(ie!==-1){const re=await j.files[oe].async("text"),le=new DOMParser().parseFromString(re,"text/html").querySelector(".page-body");if(le&&le.children.length==0)continue}q.set(oe,k.idGenerator())}if(ne===0&&ae.endsWith(".csv")&&q.set(oe,k.idGenerator()),ae.endsWith(".zip")){const re=await j.file(ae)?.async("blob");re&&ee.push(...await $(re))}}const te=Array.from(q.keys()).map(async ne=>{const oe=await createPage(k,{id:q.get(ne)});if(!oe)return;const ie=ne.lastIndexOf("/"),ae=ne.substring(0,ie)||"",re=ne.substring(ie+1);if(re.endsWith(".html")||re.endsWith(".md")||re.endsWith(".csv")){const se=re.endsWith(".html"),le=oe.root?.id,ue=async ve=>{const ke=joinWebPaths(ae,decodeURI(ve));return await j.file(ke)?.async("blob")||new Blob},he=(ve,ke)=>{if(ke.link){const me=ke.link,Ie=joinWebPaths(ae,decodeURI(me)),Fe=q.get(Ie);Fe&&(ke.reference={pageId:Fe,type:"LinkedPage"},delete ke.link)}},ce=async(ve,ke,me,Ie)=>{const Be=(await j.file(ve)?.async("string")||"").substring(0,ke.join(": ").length+me.join("").length+100);for(let Ze=0;Ze<me.length;Ze++)if(Ze===Ie){if(!Be.includes(me[Ze]))return!1}else{const Re=ke[Ze].name.replace(/[^\x20-\x7E]/g,"");if(me[Ze]!==""&&!Be.includes(Re+": "+me[Ze])||me[Ze]===""&&Be.includes(Re+": "))return!1}return!0},ge=async(ve,ke,me)=>{const Ie=[];if(!ke[me])return Ie;const Fe=X.filter(Be=>Be.includes(ke[me]+" ")&&(Be.endsWith(".html")||Be.endsWith(".md")));for(let Be=0;Be<Fe.length;Be++){const Ze=Fe[Be];await ce(Ze,ve,ke,me)&&q.has(Ze)&&Ie.push(q.get(Ze)??"")}return Ie},be=async(ve,ke)=>{const me=await j.file(ve)?.async("string")??"";let Ie=[],Fe=1;const Be=[],Ze=[];me?.split(/\r\n|\r|\n/).forEach((je,Ue)=>{const tt=je.split(/,\s*(?=(?:(?:[^"]*"){2})*[^"]*$)/);for(let Ve=0;Ve<tt.length;Ve++)tt[Ve]=tt[Ve].replace(/^"|"$/g,"");Ue===0?Be.push(...tt):Ze.push(tt)});const Re=Be.map(je=>columnManager.getColumn(richTextPureColumnConfig.type).createWithId(""+Fe++,je));if(Ze.length>0){let je=Ze[0].length;for(let tt=1;tt<Ze.length;tt++)je=Math.max(je,Ze[tt].length);const Ue=je-Re.length;for(let tt=0;tt<Ue;tt++)Re.push(columnManager.getColumn(richTextPureColumnConfig.type).createWithId(""+Fe++,""))}if(Re.length===0||Ze.length===0)return[];let qe=0;for(let je=0;je<Ze.length;je++){const Ue=Ze[je];let tt=0,Ve=0,nt=[];for(let et=0;et<Ue.length&&(nt=await ge(Re,Ue,et),!(nt.length>0&&(Ve=et,tt++,tt>1)));et++);if(tt===1&&(qe=Ve,nt.length===1))break}qe=qe<Re.length?qe:0,Re[qe].type="title";for(let je=0;je<Ze.length;je++){if(qe>=Ze[je].length)continue;const Ue=await ge(Re,Ze[je],qe);Ue.length>0&&(Ze[je][qe]=`@AffineReference:(${Ue[0]})`)}const Me=Fe++,Pe={},Qe=[];return Ze.forEach(je=>{const Ue=je[qe],Ve=/@AffineReference:\((.*)\)/g.exec(Ue);if(Ve){const et=Ve[1];Qe.push({flavour:"affine:paragraph",type:"text",text:[{insert:REFERENCE_NODE,attributes:{reference:{type:"Subpage",pageId:et}}}],children:[]})}else Qe.push({flavour:"affine:paragraph",type:"text",text:[{insert:Ue}],children:[]});const nt=""+Fe++;Pe[nt]={},je.forEach((et,st)=>{Pe[nt][Re[st].id]={columnId:Re[st].id,value:et}})}),Ie=[{flavour:"affine:database",databaseProps:{id:""+Me,title:ke||"Database",rowIds:Object.keys(Pe),cells:Pe,columns:Re,views:[{id:oe.generateId(),name:"Table View",mode:"table",columns:[],header:{titleColumn:Re[qe].id,iconColumn:"type"},filter:{type:"group",op:"and",conditions:[]}}]},children:Qe}],Ie},fe=async ve=>{if(ve.tagName==="A"&&ve.getAttribute("href")?.endsWith(".csv")){const ke=ve.getAttribute("href")||"",me=joinWebPaths(ae,decodeURI(ke));return await be(me,ve.textContent||"")}return null},we=async ve=>{if(ve.tagName==="TABLE"){const ke=[];return ve.querySelectorAll(".cell-title").forEach(me=>{const Ie=me.querySelector("a"),Fe=Ie?.getAttribute("href")||"";if(Fe.startsWith("http://")||Fe.startsWith("https://")){ke.push({flavour:"affine:paragraph",type:"text",text:[{insert:me?.textContent||""}],children:[]});return}const Be=q.get(decodeURI(Fe));Be?ke.push({flavour:"affine:paragraph",type:"text",text:[{insert:REFERENCE_NODE,attributes:{reference:{type:"Subpage",pageId:Be}}}],children:[]}):ke.push({flavour:"affine:paragraph",type:"text",text:[{insert:Ie?.textContent||""}],children:[]})}),ke}return null},Ce=new ContentParser(oe,{fetchFileHandler:ue,textStyleHandler:he,tableParseHandler:fe,tableTitleColumnHandler:we});if(le)if(y.push(oe.id),re.endsWith(".csv")){const ve=re.lastIndexOf(" "),ke=ve===-1?"":re.substring(0,ve),Ie=await be(ne,ke==="Undefined"?"":ke);Ie&&await Ce.importBlocks(Ie,le)}else if(se){const ve=await j.file(ne)?.async("string")??"";await Ce.importHtml(ve,le)}else{const ve=await j.file(ne)?.async("string")??"";await Ce.importMarkdown(ve,le)}}});return ee.push(...te),ee},B=await $(_);return await Promise.all(B.flat()),{pageIds:y,isWorkspaceFile:w}}let ImportPage=class extends WithDisposable(s$2){constructor(_,y,w=new AbortController){super(),this.workspace=_,this.onSuccess=y,this.abortController=w,this._loading=!1,this.x=0,this.y=0,this._startX=0,this._startY=0,this._loading=!1,this.x=0,this.y=0,this._startX=0,this._startY=0,this._onMouseMove=this._onMouseMove.bind(this)}updated(_){(_.has("x")||_.has("y"))&&(this.containerEl.style.transform=`translate(${this.x}px, ${this.y}px)`)}_onMouseDown(_){this._startX=_.clientX-this.x,this._startY=_.clientY-this.y,window.addEventListener("mousemove",this._onMouseMove)}_onMouseUp(){window.removeEventListener("mousemove",this._onMouseMove)}_onMouseMove(_){this.x=_.clientX-this._startX,this.y=_.clientY-this._startY}_onCloseClick(_){_.stopPropagation(),this.abortController.abort()}_onImportSuccess(_,y=!1){this.onSuccess?.(_,y)}async _importMarkDown(){const _=await openFileOrFiles({acceptType:"Markdown"});if(!_)return;const y=await _.text(),w=_.size>SHOW_LOADING_SIZE;w?(this.hidden=!1,this._loading=!0):this.abortController.abort();const $=await importMarkDown(this.workspace,y);w&&this.abortController.abort(),this._onImportSuccess($)}async _importHtml(){const _=await openFileOrFiles({acceptType:"Html"});if(!_)return;const y=await _.text(),w=_.size>SHOW_LOADING_SIZE;w?(this.hidden=!1,this._loading=!0):this.abortController.abort();const $=await importHtml(this.workspace,y);w&&this.abortController.abort(),this._onImportSuccess($)}async _importNotion(){const _=await openFileOrFiles({acceptType:"Zip"});if(!_)return;let y=0;const $=await new JSZip().loadAsync(_),B=Object.values($.files);for(const q of B){if(q.dir)continue;const X=await q.async("uint8array");y+=X.length}const R=y>SHOW_LOADING_SIZE;R?(this.hidden=!1,this._loading=!0):this.abortController.abort();const{pageIds:H,isWorkspaceFile:j}=await importNotion(this.workspace,_);R&&this.abortController.abort(),this._onImportSuccess(H,j)}_openLearnImportLink(_){_.stopPropagation(),window.open("https://affine.pro/blog/import-your-data-from-notion-into-affine","_blank")}render(){return this._loading?x$1`
        <div class="overlay-mask"></div>
        <div class="container">
          <header
            class="loading-header"
            @mousedown="${this._onMouseDown}"
            @mouseup="${this._onMouseUp}"
          >
            <div>Import</div>
            <loader-element width="50px"></loader-element>
          </header>
          <div>
            Importing the file may take some time. It depends on document size
            and complexity.
          </div>
        </div>
      `:x$1`
      <div
        class="overlay-mask"
        @click="${()=>this.abortController.abort()}"
      ></div>
      <div class="container">
        <header @mousedown="${this._onMouseDown}" @mouseup="${this._onMouseUp}">
          <icon-button height="28px" @click="${this._onCloseClick}">
            ${CloseIcon}
          </icon-button>
          <div>Import</div>
        </header>
        <div>
          AFFiNE will gradually support more file formats for import.
          <a
            href="https://community.affine.pro/c/feature-requests/import-export"
            target="_blank"
            >Provide feedback.</a
          >
        </div>
        <div class="button-container">
          <icon-button
            class="button-item"
            text="Markdown"
            @click="${this._importMarkDown}"
          >
            ${ExportToMarkdownIcon}
          </icon-button>
          <icon-button
            class="button-item"
            text="HTML"
            @click="${this._importHtml}"
          >
            ${ExportToHTMLIcon}
          </icon-button>
        </div>
        <div class="button-container">
          <icon-button
            class="button-item"
            text="Notion"
            @click="${this._importNotion}"
          >
            ${NotionIcon}
            <div
              slot="suffix"
              class="has-tool-tip"
              @click="${this._openLearnImportLink}"
            >
              ${HelpIcon}
              <tool-tip inert arrow tip-position="top" role="tooltip">
                Learn how to Import your Notion pages into AFFiNE.
              </tool-tip>
            </div>
          </icon-button>
          <icon-button class="button-item" text="Coming soon..." disabled>
            ${NewIcon}
          </icon-button>
        </div>
        <!-- <div class="footer">
        <div>Migrate from other versions of AFFiNE?</div>
      </div> -->
      </div>
    `}};ImportPage.styles=styles$3;__decorate$e([t$2()],ImportPage.prototype,"_loading",void 0);__decorate$e([t$2()],ImportPage.prototype,"x",void 0);__decorate$e([t$2()],ImportPage.prototype,"y",void 0);__decorate$e([t$2()],ImportPage.prototype,"_startX",void 0);__decorate$e([t$2()],ImportPage.prototype,"_startY",void 0);__decorate$e([i$6(".container")],ImportPage.prototype,"containerEl",void 0);ImportPage=__decorate$e([e$7("import-page")],ImportPage);function showImportModal({workspace:k,onSuccess:_,container:y=document.body,abortController:w=new AbortController}){const $=new ImportPage(k,_,w);return y.appendChild($),w.signal.addEventListener("abort",()=>$.remove()),$}var __decorate$d=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let MenuDivider=class extends s$2{constructor(){super(...arguments),this.vertical=!1}render(){return x$1`<div
      class="divider ${this.vertical?"vertical":"horizontal"}"
    ></div>`}};MenuDivider.styles=i$5`
    :host {
      display: inline-block;
    }

    .divider {
      background-color: var(--affine-border-color);
    }

    .divider.vertical {
      width: 1px;
      height: 100%;
      margin: 0 7px;
    }

    .divider.horizontal {
      width: 100%;
      height: 1px;
      margin: 7px 0;
    }
  `;__decorate$d([n$a({attribute:!1})],MenuDivider.prototype,"vertical",void 0);MenuDivider=__decorate$d([e$7("menu-divider")],MenuDivider);var __decorate$c=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let AffineSelectedBlocks=class extends WithDisposable(s$2){constructor(){super(...arguments),this.offset={x:0,y:0},this.state={rects:[],grab:!1}}_onPointerUp({clientX:_,clientY:y,shiftKey:w}){this.removeAttribute("data-grab"),document.dispatchEvent(new PointerEvent("pointerup",{bubbles:!0,clientX:_,clientY:y,shiftKey:w}))}connectedCallback(){super.connectedCallback(),this._disposables.addFromEvent(this,"pointerup",this._onPointerUp)}willUpdate(){const{rects:[_],grab:y}=this.state;if(_){const{x:w,y:$}=this.offset,{left:B,top:R}=_;this.style.transform=`translate(${B+w}px, ${R+$}px)`}this.toggleAttribute("data-grab",!!(_&&y))}render(){const{rects:_}=this.state,y=_[0];if(y){const{x:w,y:$}=y;return c$1(_,({width:B,height:R,left:H,top:j})=>x$1`<div
          style=${o$4({width:`${B}px`,height:`${R}px`,transform:`translate(${H-w}px, ${j-$}px)`})}
        ></div>`)}return A}};AffineSelectedBlocks.styles=i$5`
    :host {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
    }

    :host([data-grab]) {
      pointer-events: auto;
    }

    :host([data-grab]:hover) {
      cursor: grab;
    }

    :host > div {
      position: absolute;
      top: 0;
      left: 0;
      border-radius: 4px;
      background: var(--affine-hover-color);
    }
  `;__decorate$c([n$a({attribute:!1})],AffineSelectedBlocks.prototype,"mouseRoot",void 0);__decorate$c([n$a({attribute:!1})],AffineSelectedBlocks.prototype,"offset",void 0);__decorate$c([n$a({attribute:!1})],AffineSelectedBlocks.prototype,"state",void 0);AffineSelectedBlocks=__decorate$c([e$7("affine-selected-blocks")],AffineSelectedBlocks);class AllPageDatasource extends BaseDataSource{get rows(){return Array.from(this.workspace.pages.keys())}get properties(){return Object.keys(this.propertiesMap)}constructor(_,y){super(),this.propertiesMap={title:{type:textPureColumnConfig.type,getValue:w=>w.meta.title,setValue:(w,$)=>{w.meta.title=`${$??""}`}},tags:{type:multiSelectPureColumnConfig.type,getValue:w=>w.meta.tags,setValue:(w,$)=>{w.meta.tags=$},getData:()=>({options:this.workspace.meta.properties.tags?.options??[]}),changeData:w=>{this.workspace.meta.setProperties({...this.workspace.meta.properties,tags:w})}},createDate:{type:numberPureColumnConfig.type,getValue:w=>w.meta.createDate}},this.slots={update:new Slot},this.allPropertyConfig=[],this.workspace=_.page.workspace,_.page.workspace.meta.pageMetasUpdated.pipe(this.slots.update)}cellChangeValue(_,y,w){const $=this.workspace.getPage(_);assertExists($),this.propertiesMap[y]?.setValue?.($,w)}cellGetRenderValue(_,y){return this.cellGetValue(_,y)}cellGetValue(_,y){const w=this.workspace.getPage(_);return assertExists(w),this.propertiesMap[y]?.getValue(w)}propertyAdd(_){throw new Error("not support")}propertyChangeData(_,y){this.propertiesMap[_]?.changeData?.(y)}propertyChangeName(_,y){}propertyChangeType(_,y){}propertyDelete(_){}propertyDuplicate(_){throw new Error("not support")}propertyGetData(_){return this.propertiesMap[_]?.getData?.()??{}}propertyGetName(_){return _}propertyGetType(_){return this.propertiesMap[_].type}rowAdd(_){return this.workspace.createPage().id}rowDelete(_){_.forEach(y=>this.workspace.removePage(y))}}class TagsDatasource extends BaseDataSource{get rows(){return this.tags.map(_=>_.id)}get properties(){return Object.keys(this.propertiesMap)}constructor(_,y){super(),this.propertiesMap={value:{type:textPureColumnConfig.type,getValue:w=>w.value,setValue:(w,$)=>{this.changeTag({...w,value:`${$??""}`})}},color:{type:selectPureColumnConfig.type,getValue:w=>w.color,setValue:(w,$)=>{this.changeTag({...w,color:`${$??""}`})},getData:()=>({options:selectOptionColors.map(w=>({id:w.color,value:w.name,color:w.color}))})},parent:{type:selectPureColumnConfig.type,getData:()=>({options:this.meta.properties.tags?.options??[]}),getValue:w=>w.parentId,setValue:(w,$)=>{this.changeTag({...w,parentId:`${$??""}`})}}},this.slots={update:new Slot},this.changeTags=w=>{this.meta.setProperties({...this.meta.properties,tags:{options:w}})},this.changeTag=w=>{this.changeTags(this.tags.map($=>$.id===w.id?w:$))},this.allPropertyConfig=[],this.meta=_.page.workspace.meta,_.page.workspace.meta.pageMetasUpdated.pipe(this.slots.update)}cellChangeValue(_,y,w){const $=this.tags.find(B=>B.id===_);$&&this.propertiesMap[y]?.setValue?.($,w)}cellGetRenderValue(_,y){return this.cellGetValue(_,y)}cellGetValue(_,y){const w=this.tags.find($=>$.id===_);return assertExists(w),this.propertiesMap[y]?.getValue(w)}propertyAdd(_){throw new Error("not support")}propertyChangeData(_,y){this.propertiesMap[_]?.changeData?.(y)}propertyChangeName(_,y){}propertyChangeType(_,y){}propertyDelete(_){}propertyDuplicate(_){throw new Error("not support")}propertyGetData(_){return this.propertiesMap[_]?.getData?.()??{}}propertyGetName(_){return _}propertyGetType(_){return this.propertiesMap[_].type}rowAdd(_){const y=nanoid();return this.changeTags([...this.tags,{id:y,value:"",color:getTagColor()}]),y}rowDelete(_){this.changeTags(this.tags.filter(y=>!_.includes(y.id)))}get tags(){return this.meta.properties.tags?.options??[]}}const datasourceMap={"database-block":{title:(k,_)=>k.page.workspace.getPage(_.pageId)?.getBlockById(_.blockId)?.title.toString()??"",constructor:DatabaseBlockDatasource},"all-pages":{title:(k,_)=>"All Pages",constructor:AllPageDatasource},tags:{title:(k,_)=>"Tags",constructor:TagsDatasource}},createDatasource=(k,_)=>new datasourceMap[_.type].constructor(k,_),getDatasourceTitle=(k,_)=>datasourceMap[_.type].title(k,_);var __decorate$b=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DataViewBlockComponent=class extends BlockElement{constructor(){super(...arguments),this._setViewId=_=>{this.currentView=_},this.viewMap={},this.getViewDataById=_=>this.model.views.find(y=>y.id===_),this.allDatabaseBlockDatasourceConfig=()=>{const _=[];return this.page.workspace.pages.forEach(y=>{const w=$=>{$&&($.flavour===DatabaseBlockSchema.model.flavour&&_.push({type:"database-block",pageId:y.id,blockId:$.id}),$.children.forEach(w))};w(y.root??void 0)}),_},this.datasourceList=()=>[...this.allDatabaseBlockDatasourceConfig(),{type:"all-pages"},{type:"tags"}]}connectedCallback(){super.connectedCallback(),this.model.propsUpdated.on(()=>this.requestUpdate()),this.currentView=this.model.views[0].id}viewSource(_){const y=this.getViewDataById,w=()=>this.model.page.readonly;return{get readonly(){return w()},get view(){const $=y(_);if(!$)throw new Error(`view ${_} not found`);return $},updateView:$=>{this.model.updateView(_,$)},delete:()=>{this.model.deleteView(_)},isDeleted:()=>!y(_),updateSlot:this.model.propsUpdated}}getView(_){if(!this.viewMap[_]){const y=this.model.views.find(w=>w.id===_);assertExists(y),assertExists(y.dataSource),this.viewMap[_]=new DataViewTableManager(this.viewSource(_),createDatasource(this.root,y.dataSource))}return this.viewMap[_]}render(){const _=this.model.views,y=_.find(R=>R.id===this.currentView)??_[0],w=i$4`affine-database-${o$5(y.mode)}`,$=this.root.page.awarenessStore.getFlag("enable_database_filter")?n$5` <database-view-header
          .currentView="${y.id}"
          .setViewId="${this._setViewId}"
          .model="${this.model}"
        ></database-view-header>`:"";if(!y.dataSource)return n$5`
        <div class="toolbar-hover-container">
          ${$}
          <div>
            select datasource
            ${c$1(this.datasourceList(),R=>{const H=getDatasourceTitle(this.root,R);return n$5` <div @click="${()=>{this.model.updateView(y.id,()=>({dataSource:R}))}}">${H}</div> `})}
          </div>
        </div>
      `;const B=this.getView(y.id);return n$5`
      <div class='toolbar-hover-container data-view-root'>
        ${$}
        <${w}
          .titleText='${new Text$1(getDatasourceTitle(this.root,y.dataSource))}'
          .root='${this.root}'
          .tableViewManager='${B}'
          .modalMode='${this.modalMode}'
          class='affine-block-element'
        ></${w}>
      </div>
    `}};__decorate$b([n$a({attribute:!1})],DataViewBlockComponent.prototype,"modalMode",void 0);__decorate$b([t$2()],DataViewBlockComponent.prototype,"currentView",void 0);DataViewBlockComponent=__decorate$b([e$7("affine-data-view")],DataViewBlockComponent);class DatabaseService extends BlockService{mounted(){super.mounted(),this.selectionManager.register(DatabaseSelection),this.handleEvent("selectionChange",()=>!0)}}class EdgelessPageService extends BlockService{unmounted(){super.unmounted(),this.selectionManager.set([])}}const ActionItems=k=>actionConfig.filter(({showWhen:_})=>_(k)).map(({id:_,name:y,icon:w,action:$,enabledWhen:B,disabledToolTip:R})=>{const H=B(k),j=H?x$1`<tool-tip inert role="tooltip">${y}</tool-tip>`:x$1`<tool-tip tip-position="top" inert role="tooltip"
            >${R}</tool-tip
          >`;return x$1`<icon-button
        size="32px"
        class="has-tool-tip"
        data-testid=${_}
        ?disabled=${!H}
        @click=${()=>H&&$(k)}
      >
        ${w}${j}
      </icon-button>`}),colors=["pink","orange","yellow","green","teal","blue","purple","grey"],backgroundConfig=[{name:"Default Background",color:null,hotkey:null},...colors.map(k=>({name:`${k[0].toUpperCase()}${k.slice(1)} Background`,color:`var(--affine-text-highlight-${k})`,hotkey:null}))];let lastUsedColor=null;const updateBackground=(k,_=null)=>{lastUsedColor=_;const y=k.selection.find("text");if(!y){const w=k.selection.filter("block");for(const $ of w){const B=k.root.viewStore.viewFromPath("block",$.path);B&&B.model.text&&B.model.text.format(0,B.model.text.length,{background:_})}return}formatByTextSelection(k,y,"background",_)},BackgroundPanel=k=>x$1`<div class="background-highlight-panel">
    ${backgroundConfig.map(({name:_,color:y})=>x$1`<icon-button
        width="100%"
        height="32px"
        style="padding-left: 4px; justify-content: flex-start; gap: 8px;"
        text="${_}"
        data-testid="${y??"unset"}"
        @click="${()=>{updateBackground(k.pageElement,y),k.requestUpdate()}}"
      >
        <span
          style="color: ${y??"rgba(0,0,0,0)"}; display: flex; align-items: center;"
        >
          ${TextBackgroundDuotoneIcon}
        </span>
      </icon-button>`)}
  </div>`,BackgroundButton=k=>{const _=k.pageElement;if(!isPageComponent(_))throw new Error("Background highlight button host is not a page component");if(!noneInlineUnsupportedBlockSelected(_))return A;const y=BackgroundPanel(k);return x$1`<div
    @mouseleave=${()=>{const B=k.shadowRoot?.querySelector(".background-highlight-panel");assertExists(B),B.style.display="none"}}
    @mouseenter=${()=>{const B=k.shadowRoot?.querySelector(".background-button"),R=k.shadowRoot?.querySelector(".background-highlight-panel");assertExists(B),assertExists(R),R.style.display="block",computePosition(B,R,{placement:"top",middleware:[flip(),shift({padding:6})]}).then(({x:H,y:j})=>{R.style.left=`${H}px`,R.style.top=`${j}px`})}}
    class="background-button"
  >
    <icon-button
      class="background-highlight-icon"
      style="color: ${lastUsedColor??"rgba(0,0,0,0)"}"
      data-last-used="${lastUsedColor??"unset"}"
      width="52px"
      height="32px"
      @click="${()=>updateBackground(_,lastUsedColor)}"
    >
      ${HighLightDuotoneIcon} ${ArrowDownIcon}</icon-button
    >
    ${y}
  </div>`},InlineItems=k=>{const _=k.pageElement;if(!isPageComponent(_))throw new Error("the pageElement of formatBar is not a PageComponent");if(!noneInlineUnsupportedBlockSelected(_))return A;let y="text",w={};const $=_.selection.find("text"),B=_.selection.filter("block");if(!($&&!$.isCollapsed()||B.length>0))return[];$?(w=getCombinedFormatInTextSelection(_,$),y="text"):(w=getCombinedFormatInBlockSelections(_,B),y="block");const R=BackgroundButton(k);return x$1`${inlineFormatConfig.filter(({showWhen:H})=>H(_)).map(({id:H,name:j,icon:q,action:X,activeWhen:ee})=>x$1`<icon-button
          size="32px"
          class="has-tool-tip"
          data-testid=${H}
          ?active=${ee(w)}
          @click=${()=>{X({blockElement:_,type:y,format:w}),k.requestUpdate()}}
        >
          ${q}
          <tool-tip inert role="tooltip">${j}</tool-tip>
        </icon-button>`)}
    <div class="divider"></div>
    ${R}
    <div class="divider"></div>`},updateParagraphType=(k,_,y)=>{if(k.length===0)throw new Error("No models to update!");const{flavour:w,type:$}=paragraphConfig[0],B=k.every(j=>j.flavour===_&&j.model.type===y)?w:_,R=k.every(j=>j.flavour===_&&j.model.type===y)?$:y,H=updateBlockElementType(k,B,R);if(B==="affine:code"){if(H.length!==1)throw new Error("Failed to reset selection! New model length isn't 1 when convert to code block");const j=H[0];onModelElementUpdated(j,()=>{const q=getBlockElementByModel(j);assertExists(q),q.root.selectionManager.set([new TextSelection({from:{path:q.path,index:0,length:j.text?.length??0},to:null})])})}},ParagraphPanel=({page:k,selectedBlockElements:_})=>x$1`<div class="paragraph-panel">
    ${paragraphConfig.filter(({flavour:y})=>y!=="affine:divider").filter(({flavour:y})=>k.schema.flavourSchemaMap.has(y)).map(({flavour:y,type:w,name:$,icon:B})=>x$1`<icon-button
          width="100%"
          height="32px"
          style="padding-left: 12px; justify-content: flex-start; gap: 8px;"
          text="${$}"
          data-testid="${y}/${w}"
          @click="${()=>updateParagraphType(_,y,w)}"
        >
          ${B}
        </icon-button>`)}
  </div>`,ParagraphButton=({formatBar:k,page:_,selectedBlockElements:y})=>{const w=y.length<1?paragraphConfig[0].icon:paragraphConfig.find(({flavour:j,type:q})=>y[0].flavour===j&&y[0].model.type===q)?.icon??paragraphConfig[0].icon,$=k.pageElement;if(!isPageComponent($))throw new Error("paragraph button host is not a page component");const B=ParagraphPanel({selectedBlockElements:y,page:_});return x$1`<div
    @mouseenter=${()=>{const j=k.shadowRoot?.querySelector(".paragraph-button"),q=k.shadowRoot?.querySelector(".paragraph-panel");assertExists(j),assertExists(q),q.style.display="block",computePosition(j,q,{placement:"top-start",middleware:[flip(),shift({padding:6})]}).then(({x:X,y:ee})=>{q.style.left=`${X}px`,q.style.top=`${ee}px`})}}
    @mouseleave=${()=>{const j=k.shadowRoot?.querySelector(".paragraph-panel");assertExists(j),j.style.display="none"}}
    class="paragraph-button"
  >
    <icon-button class="paragraph-button-icon" width="52px" height="32px">
      ${w} ${ArrowDownIcon}</icon-button
    >
    ${B}
  </div>`},paragraphButtonStyle=i$5`
  .paragraph-button-icon > svg:nth-child(2) {
    transition-duration: 0.3s;
  }
  .paragraph-button-icon:is(:hover, :focus-visible, :active)
    > svg:nth-child(2) {
    transform: rotate(180deg);
  }

  .paragraph-panel {
    display: none;

    font-size: var(--affine-font-sm);
    box-sizing: border-box;
    position: absolute;
    min-width: 173px;
    padding: 8px 4px;
    overflow-y: auto;

    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 8px;
    z-index: var(--affine-z-index-popover);
  }

  .background-highlight-icon > svg:nth-child(2) {
    transition-duration: 0.3s;
  }
  .background-highlight-icon:is(:hover, :focus-visible, :active)
    > svg:nth-child(2) {
    transform: rotate(180deg);
  }

  .background-highlight-panel {
    display: none;

    font-size: var(--affine-font-sm);
    box-sizing: border-box;
    position: absolute;
    min-width: 178px;
    padding: 8px 8px;
    overflow-y: auto;

    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 8px;
    z-index: var(--affine-z-index-popover);
  }
`,formatBarStyle=i$5`
  .affine-format-bar-widget {
    box-sizing: border-box;
    position: absolute;
    display: flex;
    align-items: center;
    padding: 4px 8px;
    gap: 4px;
    height: 40px;
    width: max-content;

    border-radius: 8px;
    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    z-index: var(--affine-z-index-popover);
    user-select: none;
  }

  .divider {
    width: 1px;
    height: 24px;
    background-color: var(--affine-border-color);
  }

  ${paragraphButtonStyle}
  ${tooltipStyle}
`;var __decorate$a=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},AffineFormatBarWidget_1;const AFFINE_FORMAT_BAR_WIDGET_TAG="affine-format-bar-widget";let AffineFormatBarWidget=AffineFormatBarWidget_1=class extends WidgetElement{constructor(){super(...arguments),this._customElements=[],this._dragging=!1,this._displayType="none",this._selectedBlockElements=[],this._abortController=new AbortController,this._placement="top",this._floatDisposables=null}get _selectionManager(){return this.root.selectionManager}get _formatBarElement(){const _=this.shadowRoot;return assertExists(_),_.querySelector(`.${AFFINE_FORMAT_BAR_WIDGET_TAG}`)}get _rangeManager(){return this.root.rangeManager}_reset(){this._displayType="none",this._selectedBlockElements=[]}_shouldDisplay(){return!this.page.awarenessStore.isReadonly(this.page)&&this._displayType!=="none"&&this._selectedBlockElements.length>0&&!this._dragging}connectedCallback(){super.connectedCallback(),this._abortController=new AbortController;const _=this.pageElement;assertExists(_);const y=_.widgets;if(Object.hasOwn(y,AFFINE_FORMAT_BAR_WIDGET_TAG)){if(!isPageComponent(_))throw new Error(`format bar not support pageElement: ${_.constructor.name} but its widgets has format bar`);this._disposables.add(this.root.uiEventDispatcher.add("dragStart",()=>{this._dragging=!0,this.requestUpdate()})),this._disposables.add(this.root.uiEventDispatcher.add("dragEnd",()=>{this._dragging=!1,this.requestUpdate()})),this._disposables.add(this.root.uiEventDispatcher.add("pointerUp",w=>{if(this._displayType==="text"){if(this._rangeManager){const $=w.get("pointerState"),B=this._rangeManager.value;assertExists(B);const R=B.getBoundingClientRect();$.y<R.top+R.height/2?this._placement="top":this._placement="bottom"}}else if(this._displayType==="block"){const $=w.get("pointerState"),B=this._selectedBlockElements[0];if(!B)return;const R=B.getBoundingClientRect();$.y<R.bottom?this._placement="top":this._placement="bottom"}})),this._disposables.add(this._selectionManager.slots.changed.on(async()=>{await this.updateComplete;const w=_.selection.find("text"),$=_.selection.filter("block");w?w.isCollapsed()?this._reset():(this._displayType="text",assertExists(_.root.rangeManager),this._selectedBlockElements=getSelectedContentBlockElements(_,["text"])):$.length>0?(this._displayType="block",this._selectedBlockElements=$.map(B=>{const R=B.path;return this.pageElement.root.viewStore.viewFromPath("block",R)}).filter(B=>!!B)):this._reset(),this.requestUpdate()}))}}updated(){if(this._shouldDisplay()){this._customElements.length===0&&AffineFormatBarWidget_1.customElements.size!==0&&(this._customElements=Array.from(AffineFormatBarWidget_1.customElements).map(y=>y(this)),this.customItemsContainer.append(...this._customElements),this._disposables.add(()=>{this._customElements.forEach(y=>{y.remove()}),this._customElements=[],this.customItemsContainer.replaceChildren()})),this._floatDisposables=new DisposableGroup;const _=this._formatBarElement;if(assertExists(_,"format quick bar should exist"),this._displayType==="text"){assertExists(this._rangeManager,"range controller should exist");const y=this._rangeManager.value;assertExists(y);const w={getBoundingClientRect:()=>y.getBoundingClientRect(),getClientRects:()=>y.getClientRects()};this._floatDisposables.add(autoUpdate(w,_,()=>{computePosition(w,_,{placement:this._placement,middleware:[offset$1(10),inline$1(),shift({padding:6})]}).then(({x:$,y:B})=>{_.style.top=`${B}px`,_.style.left=`${$}px`})},{animationFrame:!0}))}else if(this._displayType==="block"){let w=this._selectedBlockElements[0].getBoundingClientRect();this._selectedBlockElements.forEach(B=>{const R=B.getBoundingClientRect();R.top<w.top&&(w=new DOMRect(w.left,R.top,w.width,w.bottom)),R.bottom>w.bottom&&(w=new DOMRect(w.left,w.top,w.width,R.bottom)),R.left<w.left&&(w=new DOMRect(R.left,w.top,w.right,w.bottom)),R.right>w.right&&(w=new DOMRect(w.left,w.top,R.right,w.bottom))});const $={getBoundingClientRect:()=>w,getClientRects:()=>this._selectedBlockElements.map(B=>B.getBoundingClientRect())};this._floatDisposables.add(autoUpdate($,_,()=>{computePosition($,_,{placement:this._placement,middleware:[offset$1(10),inline$1(),shift({padding:6})]}).then(({x:B,y:R})=>{_.style.top=`${R}px`,_.style.left=`${B}px`})},{animationFrame:!0}))}}else this._floatDisposables&&this._floatDisposables.dispose()}disconnectedCallback(){super.disconnectedCallback(),this._abortController.abort(),this._reset()}render(){if(!this._shouldDisplay())return A;const _=this.pageElement;if(assertExists(_),!isPageComponent(_))throw new Error("format bar should be hosted by page component");const y=this._selectedBlockElements,w=this.page,$=ParagraphButton({formatBar:this,selectedBlockElements:y,page:w}),B=ActionItems(_),R=InlineItems(this);return x$1`<div
      class=${AFFINE_FORMAT_BAR_WIDGET_TAG}
      @pointerdown=${stopPropagation}
    >
      <div class="custom-items"></div>
      ${this._customElements.length>0?x$1`<div class="divider"></div>`:A}
      ${$}
      <div class="divider"></div>
      ${R} ${B}
    </div>`}};AffineFormatBarWidget.styles=formatBarStyle;AffineFormatBarWidget.customElements=new Set;__decorate$a([i$6(".custom-items")],AffineFormatBarWidget.prototype,"customItemsContainer",void 0);AffineFormatBarWidget=AffineFormatBarWidget_1=__decorate$a([e$7(AFFINE_FORMAT_BAR_WIDGET_TAG)],AffineFormatBarWidget);var __decorate$9=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};const AFFINE_REMOTE_SELECTION_WIDGET_TAG="affine-remote-selection-widget";function addAlpha(k,_){const y=Math.round(Math.min(Math.max(_,0),1)*255);return k+y.toString(16).toUpperCase()}function randomColor(){return`#${Math.floor(Math.random()*16777215).toString(16)}`}function selectionStyle(k,_){return o$4({position:"absolute",width:`${k.width}px`,height:`${k.height}px`,top:`${k.top}px`,left:`${k.left}px`,backgroundColor:_,pointerEvent:"none"})}function cursorStyle(k,_){return o$4({position:"absolute",width:`${k.width}px`,height:`${k.height}px`,top:`${k.top}px`,left:`${k.left}px`,backgroundColor:_,pointerEvent:"none"})}let AffineRemoteSelectionWidget=class extends WidgetElement{constructor(){super(...arguments),this._remoteSelections=[],this._colorMap=new Map,this._resizeObserver=new ResizeObserver(()=>{this.requestUpdate()}),this._abortController=new AbortController}get _selectionManager(){return this.root.selectionManager}get _container(){return this.offsetParent}get _containerRect(){return this.offsetParent?.getBoundingClientRect()}connectedCallback(){super.connectedCallback(),this._disposables.add(this._selectionManager.slots.remoteChanged.on(_=>{const y=this.page.awarenessStore.getStates();this._remoteSelections=Object.entries(_).map(([w,$])=>({id:parseInt(w),selections:$,user:y.get(parseInt(w))?.user})),this.requestUpdate()})),this.handleEvent("wheel",()=>{this.requestUpdate()})}disconnectedCallback(){super.disconnectedCallback(),this._resizeObserver.disconnect(),this._abortController.abort()}_getSelectionRect(_){if(!isPageComponent(this.pageElement))throw new Error("remote selection widget must be used in page component");const y=_.find(R=>R instanceof TextSelection),w=_.filter(R=>R instanceof BlockSelection$1),$=this._container,B=this._containerRect;if(y){const R=this.root.rangeManager;assertExists(R);const H=R.textSelectionToRange(y);if(H)return Array.from(H.getClientRects()).map(q=>({width:q.width,height:q.height,top:q.top-(B?.top??0)+($?.scrollTop??0),left:q.left-(B?.left??0)+($?.scrollLeft??0)})).filter(q=>q.width>1&&q.height>0||y.to===null)}else if(w.length>0)return w.flatMap(R=>{const H=this.root.viewStore.viewFromPath("block",R.path);if(H){const j=H.getBoundingClientRect();return{width:j.width,height:j.height,top:j.top-(B?.top??0)+($?.scrollTop??0),left:j.left-(B?.left??0)+($?.scrollLeft??0)}}return[]});return[]}_getCursorRect(_){if(!isPageComponent(this.pageElement))throw new Error("remote selection widget must be used in page component");const y=this.root.rangeManager;assertExists(y);const w=y.pointToRange({path:_.to?_.to.path:_.from.path,index:_.to?_.to.index+_.to.length:_.from.index+_.from.length,length:0});if(!w)return null;const $=this._container,B=this._containerRect,R=Array.from(w.getClientRects());if(R.length===1){const H=R[0];return{width:2,height:H.height+4,top:H.top-2-(B?.top??0)+($?.scrollTop??0),left:H.left-(B?.left??0)+($?.scrollLeft??0)}}return null}render(){if(this._remoteSelections.length===0)return this._colorMap.clear(),A;const _=new Set,y=this._remoteSelections.flatMap(({selections:w,id:$,user:B})=>_.has($)?[]:(_.add($),{id:$,textSelection:w.find(R=>R instanceof TextSelection),rects:this._getSelectionRect(w),user:B}));return x$1`<div>
      ${y.flatMap(w=>{w.user&&this._colorMap.set(w.id,w.user.color),this._colorMap.has(w.id)||this._colorMap.set(w.id,randomColor());const $=this._colorMap.get(w.id),B=w.textSelection?this._getCursorRect(w.textSelection):null;return w.rects.map(R=>x$1`
              <div style="${selectionStyle(R,addAlpha($,.5))}"></div>
            `).concat([x$1`
              <div
                style="${B?cursorStyle(B,$):o$4({display:"none"})}"
              >
                <div
                  style="${o$4({position:"relative",height:"100%"})}"
                >
                  <div
                    style="${o$4({position:"absolute",bottom:`${B?.height}px`,padding:"2px","background-color":$,color:"white",whiteSpace:"nowrap"})}"
                  >
                    ${w.user?.name}
                  </div>
                </div>
              </div>
            `])})}
    </div>`}};AffineRemoteSelectionWidget=__decorate$9([e$7(AFFINE_REMOTE_SELECTION_WIDGET_TAG)],AffineRemoteSelectionWidget);const pageBlockSpec={schema:PageBlockSchema,view:{component:i$4`affine-doc-page`,widgets:{slashMenu:i$4`affine-slash-menu-widget`,linkedPage:i$4`affine-linked-page-widget`,draggingArea:i$4`affine-doc-dragging-area-widget`,dragHandle:i$4`affine-drag-handle-widget`,[AFFINE_FORMAT_BAR_WIDGET_TAG]:i$4`${o$5(AFFINE_FORMAT_BAR_WIDGET_TAG)}`,[AFFINE_DATABASE_CONVERT_WIDGET_TAG]:i$4`${o$5(AFFINE_DATABASE_CONVERT_WIDGET_TAG)}`,[AFFINE_REMOTE_SELECTION_WIDGET_TAG]:i$4`${o$5(AFFINE_REMOTE_SELECTION_WIDGET_TAG)}`}}},edgelessBlockSpec={schema:PageBlockSchema,service:EdgelessPageService,view:{component:i$4`affine-edgeless-page`,widgets:{slashMenu:i$4`affine-slash-menu-widget`,linkedPage:i$4`affine-linked-page-widget`,dragHandle:i$4`affine-drag-handle-widget`,[AFFINE_FORMAT_BAR_WIDGET_TAG]:i$4`${o$5(AFFINE_FORMAT_BAR_WIDGET_TAG)}`,[AFFINE_DATABASE_CONVERT_WIDGET_TAG]:i$4`${o$5(AFFINE_DATABASE_CONVERT_WIDGET_TAG)}`,[AFFINE_REMOTE_SELECTION_WIDGET_TAG]:i$4`${o$5(AFFINE_REMOTE_SELECTION_WIDGET_TAG)}`}}},pagePreset=[pageBlockSpec,{schema:SurfaceBlockSchema,view:{component:i$4`affine-surface`}},{schema:ListBlockSchema,view:{component:i$4`affine-list`}},{schema:NoteBlockSchema,view:{component:i$4`affine-note`}},{schema:DatabaseBlockSchema,service:DatabaseService,view:{component:i$4`affine-database`}},{schema:DataViewBlockSchema,view:{component:i$4`affine-data-view`}},{schema:DividerBlockSchema,view:{component:i$4`affine-divider`}},{schema:CodeBlockSchema,view:{component:i$4`affine-code`}},{schema:ImageBlockSchema,service:ImageService,view:{component:i$4`affine-image`}},{schema:ParagraphBlockSchema,view:{component:i$4`affine-paragraph`}},{schema:BookmarkBlockSchema,view:{component:i$4`affine-bookmark`}},{schema:AttachmentBlockSchema,view:{component:i$4`affine-attachment`}}],edgelessPreset=[edgelessBlockSpec,{schema:SurfaceBlockSchema,view:{component:i$4`affine-surface`}},{schema:ListBlockSchema,view:{component:i$4`affine-list`}},{schema:NoteBlockSchema,view:{component:i$4`affine-note`}},{schema:DatabaseBlockSchema,view:{component:i$4`affine-database`}},{schema:DataViewBlockSchema,view:{component:i$4`affine-data-view`}},{schema:DividerBlockSchema,view:{component:i$4`affine-divider`}},{schema:CodeBlockSchema,view:{component:i$4`affine-code`}},{schema:ImageBlockSchema,service:ImageService,view:{component:i$4`affine-image`}},{schema:ParagraphBlockSchema,view:{component:i$4`affine-paragraph`}},{schema:BookmarkBlockSchema,view:{component:i$4`affine-bookmark`}},{schema:AttachmentBlockSchema,view:{component:i$4`affine-attachment`}}];var __decorate$8=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},DocDraggingAreaWidget_1;function rectIntersects(k,_){return k.left<_.left+_.width&&k.left+k.width>_.left&&k.top<_.top+_.height&&k.top+k.height>_.top}function rectIncludes(k,_){return k.left<=_.left&&k.left+k.width>=_.left+_.width&&k.top<=_.top&&k.top+k.height>=_.top+_.height}function isBlankArea(k){const{cursor:_}=window.getComputedStyle(k.raw.target);return _!=="text"}let DocDraggingAreaWidget=DocDraggingAreaWidget_1=class extends WidgetElement{constructor(){super(...arguments),this.rect=null,this._rafID=0,this._dragging=!1,this._offset={top:0,left:0}}get _allBlocksRect(){const _=this._viewportElement,w=(()=>{const B=[];return this.root.viewStore.walkThrough(R=>{const H=R.view;if(!(H instanceof BlockElement))return!0;H.model.role!=="root"&&!DocDraggingAreaWidget_1.excludeFlavours.includes(H.model.flavour)&&B.push(H)}),B})(),$=this.root.getBoundingClientRect();return w.map(B=>{const R=B.getBoundingClientRect();return{id:B.model.id,path:B.path,rect:{left:R.left+_.scrollLeft-$.left,top:R.top+_.scrollTop-$.top,width:R.width,height:R.height}}})}get _viewportElement(){const _=this.pageElement;return assertExists(_),_.viewportElement}_selectBlocksByRect(_){const y=this._allBlocksRect.filter(({rect:w})=>rectIntersects(w,_)&&!rectIncludes(w,_)).map(w=>this.root.selectionManager.getInstance("block",{path:w.path}));this.root.selectionManager.setGroup("note",y)}_clearRaf(){this._rafID&&(cancelAnimationFrame(this._rafID),this._rafID=0)}connectedCallback(){super.connectedCallback(),this.handleEvent("dragStart",_=>{const y=_.get("pointerState"),{button:w}=y.raw;if(w===0&&isBlankArea(y)){this._dragging=!0;const $=this._viewportElement;return this._offset={left:$.scrollLeft,top:$.scrollTop},!0}},{global:!0}),this.handleEvent("dragMove",_=>{if(this._clearRaf(),!this._dragging)return;_.get("defaultState").event.preventDefault();const y=()=>{const w=_.get("pointerState"),{x:$,y:B}=w,{scrollTop:R,scrollLeft:H}=this._viewportElement,{x:j,y:q}=w.start,X=Math.min(this._offset.left+j,H+$),ee=Math.min(this._offset.top+q,R+B),te=Math.max(this._offset.left+j,H+$),ne=Math.max(this._offset.top+q,R+B),oe={left:X,top:ee,width:te-X,height:ne-ee};if(this.rect=oe,this._selectBlocksByRect(oe),!autoScroll$1(this._viewportElement,B)){this._clearRaf();return}this._rafID=requestAnimationFrame(y)};return this._rafID=requestAnimationFrame(y),!0},{global:!0}),this.handleEvent("dragEnd",()=>{this._clearRaf(),this._dragging=!1,this.rect=null,this._offset={top:0,left:0}},{global:!0}),this.handleEvent("pointerMove",_=>{this._dragging&&_.get("pointerState").raw.preventDefault()},{global:!0})}render(){const _=this.rect;if(!_)return A;const y={left:_.left+"px",top:_.top+"px",width:_.width+"px",height:_.height+"px"};return x$1`
      <style>
        .affine-page-dragging-area {
          position: absolute;
          background: var(--affine-hover-color);
          z-index: 1;
          pointer-events: none;
        }
      </style>
      <div class="affine-page-dragging-area" style=${o$4(y)}></div>
    `}};DocDraggingAreaWidget.excludeFlavours=["affine:note","affine:surface"];__decorate$8([t$2()],DocDraggingAreaWidget.prototype,"rect",void 0);DocDraggingAreaWidget=DocDraggingAreaWidget_1=__decorate$8([e$7("affine-doc-dragging-area-widget")],DocDraggingAreaWidget);const DEFAULT_DRAG_HANDLE_CONTAINER_HEIGHT=24,DRAG_HANDLE_OFFSET_LEFT=2,DRAG_HANDLE_GRABBER_HEIGHT=12,DRAG_HANDLE_GRABBER_WIDTH=4,DRAG_HANDLE_GRABBER_BORDER_RADIUS=4,NOTE_CONTAINER_PADDING=24,DRAG_HOVER_RECT_PADDING=4,HOVER_DRAG_HANDLE_GRABBER_WIDTH=2;var __decorate$7=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DragPreview=class extends ShadowlessElement{render(){return x$1`<style>
      affine-drag-preview {
        --x: 0px;
        --y: 0px;
        height: auto;
        display: block;
        position: absolute;
        box-sizing: border-box;
        font-family: var(--affine-font-family);
        font-size: var(--affine-font-base);
        line-height: var(--affine-line-height);
        color: var(--affine-text-primary-color);
        font-weight: 400;
        top: 0;
        left: 0;
        opacity: 0.843;
        cursor: none;
        user-select: none;
        pointer-events: none;
        caret-color: transparent;
        transform-origin: 0 0;
        z-index: 2;
      }

      affine-drag-preview > .affine-block-element {
        pointer-events: none;
        background-color: transparent;
      }

      affine-drag-preview > .affine-block-element:first-child > *:first-child {
        margin-top: 0;
      }

      affine-drag-preview.grabbing {
        cursor: grabbing;
        pointer-events: auto;
      }

      affine-drag-preview.grabbing:after {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        width: 24px;
        height: 24px;
        transform: translate(var(--x), var(--y));
      }
    </style>`}};DragPreview=__decorate$7([e$7("affine-drag-preview")],DragPreview);const DRAG_HANDLE_WIDTH=16,styles$2=i$5`
  .affine-drag-handle-widget {
    display: flex;
  }
  .affine-drag-handle-container {
    top: 0;
    left: 0;
    position: fixed;
    display: flex;
    justify-content: center;
    width: ${DRAG_HANDLE_WIDTH}px;
    min-height: 12px;
    pointer-events: auto;
    user-select: none;
    transition: transform 0.25s ease, height 0.25s ease;
  }
  .affine-drag-handle-grabber {
    width: 4px;
    height: 12px;
    border-radius: 1px;
    background: var(--affine-placeholder-color);
    transition: height 0.25s ease, width 0.25s ease;
  }
  .affine-drag-handle-container:hover {
    cursor: grab;
  }
  @media print {
    .affine-drag-handle-widget {
      display: none;
    }
  }
  .affine-drag-indicator {
    position: fixed;
    top: 0;
    left: 0;
    background: var(--affine-primary-color);
    transition-property: width, height, transform;
    transition-duration: 100ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-delay: 0s;
    transform-origin: 0 0;
    pointer-events: none;
    z-index: 2;
  }
  .affine-drag-hover-rect {
    position: fixed;
    top: 0;
    left: 0;
    border-radius: 6px;
    background: var(--affine-hover-color);
    pointer-events: none;
    z-index: 2;
    animation: expand 0.25s forwards;
  }
  @keyframes expand {
    0% {
      width: 0;
      height: 0;
    }
  }
`,heightMap={text:23,h1:40,h2:36,h3:32,h4:32,h5:28,h6:26,quote:46,list:32,database:28,image:28,divider:36},getDragHandleContainerHeight=k=>{const _=k.flavour,y=_.indexOf(":");let w=_.slice(y+1);return w==="paragraph"&&k.type&&(w=k.type),heightMap[w]??DEFAULT_DRAG_HANDLE_CONTAINER_HEIGHT},containChildBlock=(k,_)=>k.some(y=>{const{path:w}=y;return w.length>_.length?!1:w.join("|")===_.slice(0,-1).join("|")}),containBlock=(k,_)=>k.some(y=>y===_),insideDatabaseTable=k=>!!k.closest(".affine-database-block-table"),captureEventTarget=k=>k instanceof Element||k instanceof Node?k instanceof Element?k:k.parentElement:null,getNoteId=k=>{let _=k;for(;_&&_.flavour!=="affine:note";)_=_.parentBlockElement;return _.model.id},includeTextSelection=k=>k.some(_=>_.type==="text"),getBlockIdFromPath=k=>k[k.length-1];var __decorate$6=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let DragHandleWidget=class extends WidgetElement{constructor(){super(...arguments),this._indicatorRect=null,this._dragHoverRect=null,this._hoveredBlockId="",this._hoveredBlockPath=null,this._lastHoveredBlockPath=null,this._hoverDragHandle=!1,this._dragHandlePointerDown=!1,this._dropBlockId="",this._dropBefore=!1,this._scale=1,this._draggingElements=[],this._dragging=!1,this._dragPreviewOffsetY=0,this._dragPreview=null,this._rafID=0,this._canEditing=_=>{if(isPageMode(this.page))return!0;const y=this._pageBlockElement,w=_.path[_.path.length-1];return y.selectionManager.editing&&y.selectionManager.state.elements[0]===w},this._getClosestNoteBlock=_=>{const y="affine-note";return findClosestBlockElement(this._pageBlockElement,_,y)},this._getContainerOffsetPoint=_=>{const y=_.point.x+_.containerOffset.x,w=_.point.y+_.containerOffset.y;return new Point(y,w)},this._outOfNoteBlock=(_,y)=>{const w=_.getBoundingClientRect(),$=NOTE_CONTAINER_PADDING*this._scale;return w?isPageMode(this.page)?y.y<w.top||y.y>w.bottom||y.x>w.right+$:y.y<w.top||y.y>w.bottom||y.x<w.left-$||y.x>w.right+$:!0},this._updateIndicator=_=>{const y=_.get("pointerState"),w=this._getContainerOffsetPoint(y),$=this._getClosestBlockElementByPoint(w);if(!$){this._dropBlockId="",this._indicatorRect=null;return}const B=$.getAttribute(this.root.blockIdAttr),R=$.path;if(assertExists(B),assertExists(R),containBlock(this._selectedBlocks.map(te=>te.blockId),B)||containChildBlock(this._selectedBlocks,R)){this._dropBlockId="";return}this._dropBlockId=B;let H=null,j=null;const q=getModelByBlockElement($);if(matchFlavours(q,["affine:database"])){this._indicatorRect=H,this._dropBlockId="";return}const ee=calcDropTarget(w,q,$,this._draggingElements,this._scale);if(ee&&(H=ee.rect,j=ee.modelState.element,this._dropBefore=ee.type==="before"),j){const te=j.getAttribute(this.root.blockIdAttr);te&&(this._dropBlockId=te)}this._indicatorRect=H},this._pointerMoveOnBlock=_=>{const y=_.get("pointerState"),w=this._getContainerOffsetPoint(y),$=this._getClosestBlockElementByPoint(w);if(!$){this._hoveredBlockId="",this._hoveredBlockPath=null;return}const B=$.getAttribute(this.root.blockIdAttr),R=$.path;if(assertExists(B),assertExists(R),this._hoveredBlockId=B,this._hoveredBlockPath=R,insideDatabaseTable($)||this.page.readonly){this._hide();return}(!this._lastHoveredBlockPath||this._hoveredBlockPath.join("|")!==this._lastHoveredBlockPath?.join("|")||this._dragHandleContainer.style.display==="none")&&!this._hoverDragHandle&&(this._show($),this._lastHoveredBlockPath=this._hoveredBlockPath)},this._pointerMoveHandler=_=>{const y=_.get("pointerState"),{target:w}=y.raw,$=captureEventTarget(w);if(!$||this._dragging||$.closest(".affine-drag-handle-container"))return;const B=this._getContainerOffsetPoint(y),R=this._getClosestNoteBlock(B);if(!R||!this._canEditing(R)||this._outOfNoteBlock(R,B)){this._hide();return}return this._pointerMoveOnBlock(_),!0},this._clickHandler=_=>{const y=_.get("pointerState"),{target:w}=y.raw,$=captureEventTarget(w);if(!$||!$.closest("affine-drag-handle-widget")||!this._hoveredBlockId||!this._hoveredBlockPath)return;const{selectionManager:B}=this.root,R=this._selectedBlocks;if(R.length>0&&!includeTextSelection(R)&&R[0].blockId===this._hoveredBlockId){B.clear(["block"]),this._dragHoverRect=null,this._showDragHandleOnHoverBlock(this._hoveredBlockPath);return}const H=this.root.viewStore.viewFromPath("block",this._hoveredBlockPath);return assertExists(H),R.length>1&&this._show(H),this._setSelectedBlocks([H]),!0},this._dragStartHandler=_=>{const w=_.get("pointerState").raw,{target:$,button:B}=w,H=!!captureEventTarget($)?.closest("affine-drag-handle-widget");if(B!==0||!H||!this._hoveredBlockId||!this._hoveredBlockPath)return;const j=this.root.viewStore.viewFromPath("block",this._hoveredBlockPath);if(!j)return;let q=this._selectedBlocks;if(q.length>0&&includeTextSelection(q)){const te=document.getSelection();if(te&&te.rangeCount>0){const ne=te.getRangeAt(0),oe=this._rangeManager.getSelectedBlockElementsByRange(ne,{match:ie=>ie.model.role==="content",mode:"highest"});this._setSelectedBlocks(oe),q=this._selectedBlocks}}if(q.length===0||!containBlock(q.map(te=>te.blockId),this._hoveredBlockId)){const te=this.root.viewStore.viewFromPath("block",this._hoveredBlockPath);assertExists(te),this._setSelectedBlocks([te])}const X=this._selectedBlocks.map(te=>this.root.viewStore.viewFromPath("block",te.path)).filter(te=>!!te),ee=getBlockElementsExcludeSubtrees(X);return this._createDragPreview(ee,j),this._draggingElements=ee,this._dragging=!0,this._hide(),!0},this._dragMoveHandler=_=>{if(this._clearRaf(),!this._dragging||this._draggingElements.length===0)return;_.get("defaultState").event.preventDefault();const y=()=>{const w=_.get("pointerState"),$=this._getContainerOffsetPoint(w),B=this._getClosestNoteBlock($);!B||this._outOfNoteBlock(B,$)?(this._dropBlockId="",this._indicatorRect=null):this._updateIndicator(_);const R=new Point(w.point.x,w.point.y);if(this._dragPreview&&this._updateDragPreviewPosition(this._dragPreview,R),this._pageBlockElement instanceof DocPageBlockComponent){if(!autoScroll$1(this._pageBlockElement.viewportElement,w.y)){this._clearRaf();return}this._rafID=requestAnimationFrame(y)}else this._clearRaf()};return this._rafID=requestAnimationFrame(y),!0},this._dragEndHandler=()=>{if(this._clearRaf(),this._removeDragPreview(),!this._dragging||this._draggingElements.length===0){this._hide(!0);return}const _=this._dropBlockId,y=this._dropBefore,w=this._draggingElements;if(this._hide(!0),!_||containBlock(this._selectedBlocks.map(H=>H.blockId),_))return;const $=getBlockElementsExcludeSubtrees(w).map(H=>getModelByBlockElement(H)).filter(H=>!!H),B=this.page.getBlockById(_),R=this.page.getParent(_);return B&&R&&$.length>0&&this.page.moveBlocks($,R,B,y),setTimeout(()=>{assertExists(R);const H=getBlockElementByModel(R);if(H){const j=$.map(X=>H.path.concat(X.id)).map(X=>this.root.viewStore.viewFromPath("block",X));if(!j)return;const q=getNoteId(H);this._setSelectedBlocks(j,q)}},0),!0},this._wheelHandler=_=>(this._hide(),(!this._dragging||this._draggingElements.length===0)&&!this._dragHandlePointerDown?void 0:(_.get("defaultState").event.preventDefault(),!0)),this._pointerOutHandler=_=>{const y=_.get("pointerState");y.raw.preventDefault();const{target:w}=y.raw,$=captureEventTarget(w);if(!$)return;const{relatedTarget:B}=y.raw,R=captureEventTarget(B),H=$.classList.contains("affine-doc-viewport"),j=!!R?.closest(".affine-doc-viewport"),q=!!R?.closest("affine-drag-handle-widget");H&&!q&&!j&&this._hide()}}get _selectedBlocks(){return this.root.selectionManager.value.filter(_=>_.type!=="surface")}_getBlockElementFromViewStore(_){return this.root.viewStore.viewFromPath("block",_)}_hide(_=!1){this._dragHandleContainer&&(this._dragHandleContainer.style.display="none",_&&this._reset())}_reset(){this._dragging=!1,this._indicatorRect=null,this._dragHoverRect=null,this._hoveredBlockId="",this._hoveredBlockPath=null,this._lastHoveredBlockPath=null,this._hoverDragHandle=!1,this._dragHandlePointerDown=!1,this._draggingElements=[],this._dropBlockId="",this._dropBefore=!1,this._dragPreviewOffsetY=0,this._rafID=0}_clearRaf(){this._rafID&&(cancelAnimationFrame(this._rafID),this._rafID=0)}_resetDragHandleGrabber(){this._dragHandleGrabber.style.height=`${DRAG_HANDLE_GRABBER_HEIGHT*this._scale}px`,this._dragHandleGrabber.style.width=`${DRAG_HANDLE_GRABBER_WIDTH*this._scale}px`,this._dragHandleGrabber.style.borderRadius=`${DRAG_HANDLE_GRABBER_BORDER_RADIUS*this._scale}px`}_show(_){let{left:y,top:w}=_.getBoundingClientRect();const $=getComputedStyle(_),B=parseInt($.paddingTop)*this._scale,R=parseInt($.paddingLeft)*this._scale;y+=R,w+=B;const H=getDragHandleContainerHeight(_.model);if(!this._dragHandleContainer||!this._dragHandleGrabber)return;this._dragHandleContainer.style.display="flex",this._dragHandleContainer.style.transform="",this._dragHandleContainer.style.height=`${H*this._scale}px`;const j=(H-DRAG_HANDLE_GRABBER_HEIGHT)/2*this._scale;this._dragHandleContainer.style.padding=`${j}px 0`,this._dragHandleContainer.style.width=`${DRAG_HANDLE_WIDTH*this._scale}px`;const q=y-(DRAG_HANDLE_WIDTH+DRAG_HANDLE_OFFSET_LEFT)*this._scale,X=w;this._dragHandleContainer.style.left=`${q}px`,this._dragHandleContainer.style.top=`${X}px`,this._resetDragHandleGrabber()}_showDragHandleOnHoverBlock(_){const y=this._getBlockElementFromViewStore(_);assertExists(y),this._show(y)}_getDraggingAreaRect(_){if(!this._hoveredBlockPath)return;const y=this._selectedBlocks;let{left:w,top:$,right:B,bottom:R}=_.getBoundingClientRect();if(y.length>0&&includeTextSelection(y)){const H=document.getSelection();if(H&&H.rangeCount>0){const j=H.getRangeAt(0),q=this._rangeManager.getSelectedBlockElementsByRange(j,{match:X=>X.model.role==="content",mode:"highest"});containBlock(q.map(X=>getBlockIdFromPath(X.path)),getBlockIdFromPath(this._hoveredBlockPath))&&q.forEach(X=>{w=Math.min(w,X.getBoundingClientRect().left),$=Math.min($,X.getBoundingClientRect().top),B=Math.max(B,X.getBoundingClientRect().right),R=Math.max(R,X.getBoundingClientRect().bottom)})}}else containBlock(y.map(H=>H.blockId),getBlockIdFromPath(this._hoveredBlockPath))&&this._selectedBlocks.forEach(H=>{const j=this.root.viewStore.viewFromPath("block",H.path);j&&(w=Math.min(w,j.getBoundingClientRect().left),$=Math.min($,j.getBoundingClientRect().top),B=Math.max(B,j.getBoundingClientRect().right),R=Math.max(R,j.getBoundingClientRect().bottom))});return w-=(DRAG_HANDLE_WIDTH+DRAG_HANDLE_OFFSET_LEFT)*this._scale,$-=DRAG_HOVER_RECT_PADDING*this._scale,B+=DRAG_HOVER_RECT_PADDING*this._scale,R+=DRAG_HOVER_RECT_PADDING*this._scale,new Rect(w,$,B,R)}_setSelectedBlocks(_,y){const{selectionManager:w}=this.root,$=_.map(B=>w.getInstance("block",{path:B.path}));if(isEdgelessPage(this._pageBlockElement)){const B=y||getNoteId(_[0]),R=w.getInstance("surface",[B],!0);$.push(R)}w.set($)}get _pageBlockElement(){const _=this.pageElement,y=(isPageMode(this.page),_);return assertExists(y),y}get _rangeManager(){return assertExists(this.root.rangeManager),this.root.rangeManager}_getClosestBlockElementByPoint(_){const y="affine-note",w=findClosestBlockElement(this._pageBlockElement,_,y);if(!w)return null;const $=Rect.fromDOM(w),B=getClosestBlockElementByPoint(_,{container:w,rect:$}),R=".affine-note-block-container > .affine-block-children-container > [data-block-id]";return B||findClosestBlockElement(w,_.clone(),R)}_calculatePreviewOffsetY(_,y){let w=0;for(let $=0;$<_.length&&_[$].path.join("|")!==y.path.join("|");$++)w+=_[$].getBoundingClientRect().height;return w}_createDragPreview(_,y){this._dragPreview||(this._dragPreview=new DragPreview);const w=document.createDocumentFragment();_.forEach(q=>{const X=document.createElement("div");X.classList.add("affine-block-element"),D(q.render(),X),X.querySelector(".selected")?.classList.remove("selected"),w.appendChild(X)});const{left:$,top:B,width:R}=y.getBoundingClientRect();this._dragPreviewOffsetY=this._calculatePreviewOffsetY(_,y);const H=$,j=B-this._dragPreviewOffsetY;this._dragPreview.style.width=`${R/this._scale}px`,this._dragPreview.style.transform=`translate(${H}px, ${j}px) scale(${this._scale})`,this._dragPreview.classList.add("grabbing"),this._dragPreview.style.display="block",this._dragPreview.appendChild(w),this._pageBlockElement.appendChild(this._dragPreview)}_removeDragPreview(){this._dragPreview&&(this._dragPreview.remove(),this._dragPreview=null)}_removeHoverRect(){this._dragHoverRect=null,this._dragHandlePointerDown=!1}_updateDragPreviewPosition(_,y){const w=y.x,$=y.y-this._dragPreviewOffsetY;_.style.transform=`translate(${w}px, ${$}px) scale(${this._scale})`}firstUpdated(){this._hide(!0),this._disposables.addFromEvent(this._dragHandleContainer,"pointerenter",()=>{if(!this._hoveredBlockPath||!this._dragHandleGrabber)return;const _=this._getBlockElementFromViewStore(this._hoveredBlockPath);if(!_)return;const y=this._getDraggingAreaRect(_);if(!y)return;const w=y.height-16,$=y.top+8,B=this._dragHandleContainer.getBoundingClientRect().top,R=parseInt(this._dragHandleContainer.style.paddingTop)??0,H=$-B-R;this._dragHandleContainer.style.transform=`translateY(${H}px)`,this._dragHandleContainer.style.height=`${w}px`,this._dragHandleGrabber.style.height="100%",this._dragHandleGrabber.style.width=`${HOVER_DRAG_HANDLE_GRABBER_WIDTH*this._scale}px`,this._dragHandleGrabber.style.borderRadius=`${DRAG_HANDLE_GRABBER_BORDER_RADIUS*this._scale}px`,this._hoverDragHandle=!0}),this._disposables.addFromEvent(this._dragHandleContainer,"pointerdown",()=>{if(!this._hoveredBlockPath||!this._dragHandleGrabber)return;const _=this._getBlockElementFromViewStore(this._hoveredBlockPath);_&&(this._dragHandlePointerDown=!0,setTimeout(()=>{this._dragHandlePointerDown&&(this._dragHoverRect=this._getDraggingAreaRect(_)??null)},100))}),this._disposables.addFromEvent(this._dragHandleContainer,"pointerup",()=>{this._dragHandlePointerDown&&this._removeHoverRect()}),this._disposables.addFromEvent(this._dragHandleContainer,"pointerleave",()=>{if(this._dragHandlePointerDown&&this._removeHoverRect(),this._hoverDragHandle=!1,!this._hoveredBlockPath)return;const _=this._getBlockElementFromViewStore(this._hoveredBlockPath);_&&(this._dragging||this._show(_))})}connectedCallback(){if(super.connectedCallback(),this.handleEvent("pointerMove",this._pointerMoveHandler),this.handleEvent("click",this._clickHandler),this.handleEvent("dragStart",this._dragStartHandler),this.handleEvent("dragMove",this._dragMoveHandler),this.handleEvent("dragEnd",this._dragEndHandler),this.handleEvent("wheel",this._wheelHandler),this.handleEvent("pointerOut",this._pointerOutHandler),this.handleEvent("beforeInput",()=>this._hide()),isEdgelessPage(this._pageBlockElement)){const _=this._pageBlockElement;this._disposables.add(_.slots.edgelessToolUpdated.on(y=>{y.type!=="default"&&this._hide()})),this._disposables.add(_.slots.viewportUpdated.on(()=>{this._hide(),this._scale=_.surface.viewport.zoom}))}}disconnectedCallback(){this._hide(!0),this._removeDragPreview(),super.disconnectedCallback()}render(){const _=o$4(this._indicatorRect?{width:`${this._indicatorRect.width}px`,height:`${this._indicatorRect.height}px`,transform:`translate(${this._indicatorRect.left}px, ${this._indicatorRect.top}px)`}:{display:"none"}),y=o$4(this._dragHoverRect?{width:`${this._dragHoverRect.width}px`,height:`${this._dragHoverRect.height}px`,top:`${this._dragHoverRect.top}px`,left:`${this._dragHoverRect.left}px`}:{display:"none"});return x$1`
      <div class="affine-drag-handle-widget">
        <div class="affine-drag-handle-container">
          <div class="affine-drag-handle-grabber"></div>
        </div>
        <div class="affine-drag-indicator" style=${_}></div>
        <div class="affine-drag-hover-rect" style=${y}></div>
      </div>
    `}};DragHandleWidget.styles=styles$2;__decorate$6([i$6(".affine-drag-handle-container")],DragHandleWidget.prototype,"_dragHandleContainer",void 0);__decorate$6([i$6(".affine-drag-handle-grabber")],DragHandleWidget.prototype,"_dragHandleGrabber",void 0);__decorate$6([t$2()],DragHandleWidget.prototype,"_indicatorRect",void 0);__decorate$6([t$2()],DragHandleWidget.prototype,"_dragHoverRect",void 0);DragHandleWidget=__decorate$6([e$7("affine-drag-handle-widget")],DragHandleWidget);const DEFAULT_PAGE_NAME="Untitled",DISPLAY_NAME_LENGTH=8;function insertLinkedNode({model:k,pageId:_}){const y=getVirgoByModel(k);assertExists(y,"Editor not found");const w=y.getVRange();assertExists(w),y.insertText(w,REFERENCE_NODE,{reference:{type:"LinkedPage",pageId:_}}),y.setVRange({index:w.index+1,length:0})}const getMenus=({query:k,page:_,model:y,pageMetas:w})=>{const $=k||DEFAULT_PAGE_NAME,B=$.slice(0,DISPLAY_NAME_LENGTH)+($.length>DISPLAY_NAME_LENGTH?"..":"");return[{name:"Link to Page",styles:"overflow-y: scroll; max-height: 224px;",items:w.filter(({id:H})=>H!==_.id).filter(({title:H})=>isFuzzyMatch(H,k)).map(H=>({key:H.id,name:H.title||DEFAULT_PAGE_NAME,icon:PageIcon,action:()=>insertLinkedNode({model:y,pageId:H.id})}))},{name:"New page",items:[{key:"create",name:`Create "${B}" page`,icon:NewPageIcon,action:async()=>{const H=k,j=await createPage(_.workspace,{title:H});insertLinkedNode({model:y,pageId:j.id})}},{key:"import",name:"Import",icon:ImportIcon,action:()=>{const H=j=>{if(toast(`Successfully imported ${j.length} Page${j.length>1?"s":""}.`),j.length===0)return;const q=j[0];insertLinkedNode({model:y,pageId:q})};showImportModal({workspace:_.workspace,onSuccess:H})}}]}]},styles$1=i$5`
  :host {
    position: absolute;
  }

  .linked-page-popover {
    position: fixed;
    left: 0;
    top: 0;
    box-sizing: border-box;
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-base);
    padding: 12px 8px;
    display: flex;
    flex-direction: column;

    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 12px;
    z-index: var(--affine-z-index-popover);
  }

  .linked-page-popover icon-button {
    padding: 8px;
    justify-content: flex-start;
    gap: 8px;
  }

  .linked-page-popover .group-title {
    color: var(--affine-text-secondary-color);
    margin: 8px 12px;
  }

  .linked-page-popover .divider {
    margin: 6px 12px;
    height: 1px;
    background: var(--affine-border-color);
  }

  ${scrollbarStyle(".linked-page-popover .group")}
`;var __decorate$5=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let LinkedPagePopover=class extends WithDisposable(s$2){get _flattenActionList(){return this._actionGroup.map(_=>_.items.map(y=>({...y,groupName:_.name}))).flat()}_updateActionList(){this._actionGroup=this.options.getMenus({query:this._query,page:this._page,model:this.model,pageMetas:this._page.workspace.meta.pageMetas})}get _page(){return this.model.page}constructor(_,y=new AbortController){super(),this.model=_,this.abortController=y,this._position=null,this._query="",this._activatedItemIndex=0,this._actionGroup=[]}connectedCallback(){super.connectedCallback();const _=getRichTextByModel(this.model);assertExists(_,"RichText not found"),this._updateActionList(),this._disposables.add(this.model.page.workspace.slots.pagesUpdated.on(()=>{this._updateActionList()})),this._disposables.addFromEvent(this,"mousedown",y=>{y.preventDefault()}),createKeydownObserver({target:_,onUpdateQuery:y=>{this._query=y,this._activatedItemIndex=0,this._updateActionList()},abortController:this.abortController,onMove:y=>{const w=this._flattenActionList.length;this._activatedItemIndex=(w+this._activatedItemIndex+y)%w;const $=this._flattenActionList[this._activatedItemIndex],B=this.shadowRoot;if(!B){console.warn("Failed to find the shadow root!",this);return}const R=B.querySelector(`icon-button[data-id="${$.key}"]`);if(!R){console.warn("Failed to find the active item!",$);return}R.scrollIntoView({block:"nearest"})},onConfirm:()=>{this.abortController.abort(),cleanSpecifiedTail(this.model,this.triggerKey+this._query),this._flattenActionList[this._activatedItemIndex].action()},onEsc:()=>{this.abortController.abort()}})}updatePosition(_){this._position=_}render(){const y=this._position?o$4({transform:`translate(${this._position.x}, ${this._position.y})`,maxHeight:`${Math.min(this._position.height,396)}px`}):o$4({visibility:"hidden"});let w=0;return x$1`<div class="linked-page-popover" style="${y}">
      ${this._actionGroup.filter($=>$.items.length).map(($,B)=>x$1`
            <div class="divider" ?hidden=${B===0}></div>
            <div class="group-title">${$.name}</div>
            <div class="group" style=${$.styles??""}>
              ${$.items.map(({key:R,name:H,icon:j,action:q})=>{w++;const X=w-1;return x$1`<icon-button
                  width="280px"
                  height="32px"
                  data-id=${R}
                  text=${H}
                  ?hover=${this._activatedItemIndex===X}
                  @click=${()=>{this.abortController.abort(),cleanSpecifiedTail(this.model,this.triggerKey+this._query),q()}}
                  @mousemove=${()=>{this._activatedItemIndex=X}}
                  >${j}</icon-button
                >`})}
            </div>
          `)}
    </div>`}};LinkedPagePopover.styles=styles$1;__decorate$5([n$a({attribute:!1})],LinkedPagePopover.prototype,"options",void 0);__decorate$5([n$a({attribute:!1})],LinkedPagePopover.prototype,"triggerKey",void 0);__decorate$5([t$2()],LinkedPagePopover.prototype,"_position",void 0);__decorate$5([t$2()],LinkedPagePopover.prototype,"_query",void 0);__decorate$5([t$2()],LinkedPagePopover.prototype,"_activatedItemIndex",void 0);__decorate$5([i$6(".linked-page-popover")],LinkedPagePopover.prototype,"linkedPageElement",void 0);LinkedPagePopover=__decorate$5([e$7("affine-linked-page-popover")],LinkedPagePopover);var __decorate$4=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},LinkedPageWidget_1;function showLinkedPagePopover({model:k,range:_,container:y=document.body,abortController:w=new AbortController,options:$,triggerKey:B}){const R=new DisposableGroup;w.signal.addEventListener("abort",()=>R.dispose());const H=new LinkedPagePopover(k,w);H.options=$,H.triggerKey=B,y.appendChild(H),R.add(()=>H.remove());const j=throttle$1(()=>{const X=H.linkedPageElement;assertExists(X,"You should render the linked page node even if no position");const ee=getPopperPosition(X,_);H.updatePosition(ee)},10);R.addFromEvent(window,"resize",j);const q=getViewportElement(k.page);return q&&R.addFromEvent(q,"scroll",j,{passive:!0}),setTimeout(j),R.addFromEvent(window,"mousedown",X=>{X.target!==H&&w.abort()}),H}let LinkedPageWidget=LinkedPageWidget_1=class extends WidgetElement{constructor(){super(...arguments),this.options=LinkedPageWidget_1.DEFAULT_OPTIONS,this._onKeyDown=_=>{if(!this.root.page.awarenessStore.getFlag("enable_linked_page"))return;const $=_.get("keyboardState").raw;if(isControlledKeyboardEvent($)||$.key.length!==1)return;const B=this.root.selectionManager.value.find(oe=>oe.is("text"));if(!B)return;const R=this.root.page.getBlockById(B.blockId);if(!R||matchFlavours(R,this.options.ignoreBlockTypes))return;const H=getVirgoByModel(R);if(!H)return;const j=H.getVRange();if(!j||j.length>0)return;const[q,X]=H.getTextPoint(j.index),ee=q.textContent?q.textContent.slice(0,X):"",te=this.options.triggerKeys.find(oe=>(ee+$.key).endsWith(oe));if(!te)return;const ne=this.options.triggerKeys[0];H.slots.rangeUpdated.once(()=>{if(this.options.convertTriggerKey&&ne!==te){const oe=j.index-(te.length-1);H.deleteText({index:oe,length:te.length}),H.insertText({index:oe,length:0},ne),H.setVRange({index:oe+ne.length,length:0}),H.slots.rangeUpdated.once(()=>{this.showLinkedPage(R,ne)});return}this.showLinkedPage(R,te)})}}connectedCallback(){super.connectedCallback(),this.handleEvent("keyDown",this._onKeyDown)}showLinkedPage(_,y){const w=getCurrentNativeRange();showLinkedPagePopover({model:_,range:w,options:this.options,triggerKey:y})}};LinkedPageWidget.DEFAULT_OPTIONS={triggerKeys:["@","[[","【【"],ignoreBlockTypes:["affine:code"],convertTriggerKey:!0,getMenus};LinkedPageWidget=LinkedPageWidget_1=__decorate$4([e$7("affine-linked-page-widget")],LinkedPageWidget);function collectGroupNames(k){return k.reduce((_,y)=>((!_.length||_[_.length-1]!==y.groupName)&&_.push(y.groupName),_),[])}function insertContent(k,_,y){if(!k.text)throw new Error("Can't insert text! Text not found");const w=getVirgoByModel(k);if(!w)throw new Error("Can't insert text! vEditor not found");const $=w.getVRange(),B=$?$.index:k.text.length;k.text.insert(_,B,y),w.setVRange({index:B+_.length,length:0})}function formatDate(k){const _=k.getFullYear(),y=(k.getMonth()+1).toString().padStart(2,"0"),w=k.getDate().toString().padStart(2,"0");return`${_}-${y}-${w}`}function insideDatabase(k){return isInsideBlockByFlavour(k.page,k,"affine:database")}function withRemoveEmptyLine(k){return async _=>{await k(_);const{model:y}=_;y.text?.length||y.page.deleteBlock(y)}}const menuGroups=[{name:"Text",items:[...paragraphConfig.filter(k=>k.flavour!=="affine:list").map(({name:k,icon:_,flavour:y,type:w})=>({name:k,icon:_,showWhen:$=>$.page.schema.flavourSchemaMap.has(y)?["Quote","Code Block","Divider"].includes(k)?!insideDatabase($):!0:!1,action:({pageElement:$})=>{const B=getSelectedContentBlockElements($,["text","block"]),R=updateBlockElementType(B,y,w);if(y==="affine:code"){if(R.length!==1)throw new Error("Failed to reset selection! New model length isn't 1");const H=R[0];onModelTextUpdated(H,j=>{const q=j.vEditor;assertExists(q),q.focusEnd()})}}}))]},{name:"Style",items:inlineFormatConfig.filter(k=>!["Link","Code"].includes(k.name)).map(({name:k,icon:_,id:y})=>({name:k,icon:_,action:({model:w})=>{if(!w.text)return;const $=w.text.length;if(!$){const B=getVirgoByModel(w);assertExists(B,"Can't set style mark! vEditor not found"),B.setMarks({[y]:!0}),clearMarksOnDiscontinuousInput(B);return}w.text.format(0,$,{[y]:!0})}}))},{name:"List",items:paragraphConfig.filter(k=>k.flavour==="affine:list").map(({name:k,icon:_,flavour:y,type:w})=>({name:k,icon:_,showWhen:$=>!!$.page.schema.flavourSchemaMap.has(y),action:({pageElement:$})=>{const B=getSelectedContentBlockElements($,["text","block"]);updateBlockElementType(B,y,w)}}))},{name:"Pages",items:[{name:"New Page",icon:NewPageIcon,showWhen:k=>!!k.page.awarenessStore.getFlag("enable_linked_page"),action:async({pageElement:k,model:_})=>{const y=await createPage(k.page.workspace);insertContent(_,REFERENCE_NODE,{reference:{type:"LinkedPage",pageId:y.id}})}},{name:"Link Page",alias:["dual link"],icon:DualLinkIcon,showWhen:k=>{if(!k.page.awarenessStore.getFlag("enable_linked_page"))return!1;const _=getPageBlock(k);assertExists(_);const y=_.widgetElements.linkedPage;return y?"showLinkedPage"in y?!0:(console.warn('You may not have correctly implemented the linkedPage widget! "showLinkedPage(model)" method not found on widget'),!1):!1},action:({model:k})=>{const _="@";insertContent(k,_);const w=getPageBlock(k)?.widgetElements.linkedPage;assertExists(w);const $=w;setTimeout(()=>{$.showLinkedPage(k,_)})}}]},{name:"Content & Media",items:[{name:"Image",icon:ImageIcon20,showWhen:k=>!(!k.page.schema.flavourSchemaMap.has("affine:image")||insideDatabase(k)),action:withRemoveEmptyLine(async({pageElement:k,model:_})=>{if(!k.page.getParent(_))return;const w=(await uploadImageFromLocal(k.page.blobs)).map(({sourceId:$})=>({flavour:"affine:image",sourceId:$}));k.page.addSiblingBlocks(_,w)})},{name:"Bookmark",icon:BookmarkIcon,showWhen:k=>k.page.awarenessStore.getFlag("enable_bookmark_operation")?!insideDatabase(k):!1,action:withRemoveEmptyLine(async({pageElement:k,model:_})=>{if(!k.page.getParent(_))return;const w=await getBookmarkInitialProps();if(!w)return;const $={flavour:"affine:bookmark",url:w};k.page.addSiblingBlocks(_,[$])})},{name:"File",icon:AttachmentIcon,alias:["attachment"],showWhen:k=>!k.page.awarenessStore.getFlag("enable_attachment_block")||!k.page.schema.flavourSchemaMap.has("affine:attachment")?!1:!insideDatabase(k),action:withRemoveEmptyLine(async({pageElement:k,model:_})=>{if(!k.page.getParent(_))return;const $=await openFileOrFiles();$&&await appendAttachmentBlock($,_)})}]},{name:"Date & Time",items:[{name:"Today",icon:TodayIcon,action:({model:k})=>{insertContent(k,formatDate(new Date))}},{name:"Tomorrow",icon:TomorrowIcon,action:({model:k})=>{const _=new Date;_.setDate(_.getDate()+1),insertContent(k,formatDate(_))}},{name:"Yesterday",icon:YesterdayIcon,action:({model:k})=>{const _=new Date;_.setDate(_.getDate()-1),insertContent(k,formatDate(_))}},{name:"Now",icon:NowIcon,action:({model:k})=>{const _=new Date;let y=_.getHours();const w=_.getMinutes().toString().padStart(2,"0"),$=y>=12?"pm":"am";y=y%12,y=y||12;const B=y+":"+w+" "+$;insertContent(k,B)}}]},{name:"Database",items:[{name:"Table View",alias:["database"],icon:DatabaseTableViewIcon20,showWhen:k=>!(!k.page.awarenessStore.getFlag("enable_database")||!k.page.schema.flavourSchemaMap.has("affine:database")||insideDatabase(k)),action:withRemoveEmptyLine(async({pageElement:k,model:_})=>{const y=k.page.getParent(_);assertExists(y);const w=y.children.indexOf(_),$=k.page.addBlock("affine:database",{},k.page.getParent(_),w+1);(await getServiceOrRegister("affine:database")).initDatabaseBlock(k.page,_,$,"table",!1)})},{name:"Kanban View",alias:["database"],disabled:!1,icon:DatabaseKanbanViewIcon20,showWhen:k=>!(!k.page.awarenessStore.getFlag("enable_database")||!k.page.schema.flavourSchemaMap.has("affine:database")||insideDatabase(k)),action:withRemoveEmptyLine(async({model:k,pageElement:_})=>{const y=_.page.getParent(k);assertExists(y);const w=y.children.indexOf(k),$=_.page.addBlock("affine:database",{},_.page.getParent(k),w+1);(await getServiceOrRegister("affine:database")).initDatabaseBlock(_.page,k,$,"kanban",!1)})}]},{name:"Actions",items:[{name:"Move Up",icon:ArrowUpBigIcon,action:async({pageElement:k,model:_})=>{const y=k.page,w=getPreviousBlock(_);if(!w)return;const $=y.getParent(w);$&&y.moveBlocks([_],$,w,!0)}},{name:"Move Down",icon:ArrowDownBigIcon,action:async({pageElement:k,model:_})=>{const y=k.page,w=getNextBlock$1(_);if(!w)return;const $=y.getParent(w);$&&y.moveBlocks([_],$,w,!1)}},{name:"Copy",icon:CopyIcon,action:async({model:k})=>{const _=getCurrentNativeRange();await copyBlock(k),resetNativeSelection(_),toast("Copied to clipboard")}},{name:"Duplicate",icon:DuplicateIcon,action:({pageElement:k,model:_})=>{if(!_.text||!(_.text instanceof Text$1))throw new Error("Can't duplicate a block without text");const y=k.page.getParent(_);if(!y)throw new Error("Failed to duplicate block! Parent not found");const w=y.children.indexOf(_);k.page.addBlock(_.flavour,{type:_.type,text:k.page.Text.fromDelta(_.text.toDelta()),checked:_.checked},k.page.getParent(_),w)}},{name:"Delete",alias:["remove"],icon:DeleteIcon,action:({pageElement:k,model:_})=>{k.page.deleteBlock(_,{bringChildrenTo:"parent"})}}]}],styles=i$5`
  .overlay-mask {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: var(--affine-z-index-popover);
  }

  .slash-menu-container {
    z-index: var(--affine-z-index-popover);
    user-select: none;
  }

  .slash-menu {
    position: fixed;
    left: 0;
    top: 0;
    box-sizing: border-box;
    font-size: var(--affine-font-base);
    padding: 12px 0;
    display: flex;

    background: var(--affine-background-overlay-panel-color);
    box-shadow: var(--affine-shadow-2);
    border-radius: 12px;
    z-index: var(--affine-z-index-popover);
    /* transition: max-height 0.2s ease-in-out; */
  }

  .slash-category {
    position: relative;
    overflow: hidden;
    box-sizing: border-box;
    width: 150px;
    max-width: 150px;
    display: flex;
    flex-direction: column;
    color: var(--affine-text-secondary-color);
    gap: 5px;
    margin-bottom: 20px;
    /* transition: max-width 0.2s ease-in-out; */
  }
  .slash-category::before {
    content: '';
    position: absolute;
    top: 10px;
    right: 0;
    height: 100%;
    width: 1px;
    background-color: var(--affine-border-color);
  }

  .slash-category-hide {
    max-width: 0;
    padding: 0;
    margin: 0;
    height: 0;
  }

  .slash-category-name {
    font-family: var(--affine-font-family);
    font-size: var(--affine-font-sm);
    white-space: nowrap;
    cursor: pointer;
    padding: 4px 20px;
  }

  .slash-active-category {
    position: relative;
    box-sizing: border-box;
    color: var(--affine-primary-color);
  }

  .slash-active-category::after {
    content: '';
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 1px;
    height: 12px;
    background: linear-gradient(
      180deg,
      var(--affine-text-emphasis-color) 0%,
      var(--affine-palette-purple) 100%
    );
    border-radius: 1px;
  }

  .slash-item-container {
    box-sizing: border-box;
    overflow-y: auto;
    padding: 0 8px;
    width: 200px;
  }

  ${scrollbarStyle(".slash-item-container")}

  .slash-item-divider {
    border-top: 1px dashed var(--affine-border-color);
    margin: 8px 0;
  }
  .slash-item.Delete:hover {
    background: var(--affine-background-error-color);
    color: var(--affine-error-color);
    fill: var(--affine-error-color);
  }
`;var __decorate$3=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let SlashMenu=class extends WithDisposable(s$2){constructor(){super(...arguments),this._leftPanelActivated=!1,this._activatedItemIndex=0,this._filterItems=[],this._hide=!1,this._position=null,this.abortController=new AbortController,this._searchString="",this._onClickAway=()=>{this._hide&&this.abortController.abort()}}connectedCallback(){super.connectedCallback(),this._disposables.addFromEvent(window,"mousedown",this._onClickAway),this._disposables.addFromEvent(this,"mousedown",y=>{y.preventDefault()}),this._filterItems=this._updateItem("");const _=getRichTextByModel(this.model);if(!_){console.warn("Slash Menu may not work properly! No rich text found for model",this.model);return}createKeydownObserver({target:_,abortController:this.abortController,interceptor:(y,w)=>{if(y.key==="/")return;if(this._hide&&y.key!=="Backspace"){this.abortController.abort();return}if(y.key===" "){this._hide=!0,w();return}this._hide&&(this._hide=!1);const $=isControlledKeyboardEvent(y),B=y.shiftKey;if(y.key==="ArrowLeft"&&!$&&!B){if(y.stopPropagation(),y.preventDefault(),this._searchString.length)return;this._leftPanelActivated=!0;return}if(y.key==="ArrowRight"&&!$&&!B){y.stopPropagation(),y.preventDefault(),this._leftPanelActivated=!1;return}w()},onUpdateQuery:y=>{const w=this._updateItem(y);this._filterItems=w,w.length||(this._hide=!0)},onMove:y=>{const w=this._filterItems.length;if(this._leftPanelActivated){const B=collectGroupNames(this._filterItems),R=B.findIndex(j=>j===this._filterItems[this._activatedItemIndex].groupName),H=B[(R+y+B.length)%B.length];this._handleClickCategory(H);return}let $=w;do this._activatedItemIndex=(this._activatedItemIndex+y+w)%w;while(this._filterItems[this._activatedItemIndex].disabled&&$--);this._scrollToItem(this._filterItems[this._activatedItemIndex],!1)},onConfirm:()=>{this._handleClickItem(this._activatedItemIndex)},onEsc:()=>{this.abortController.abort()}})}updatePosition(_){this._position=_}_updateItem(_){this._searchString=_,this._activatedItemIndex=0,this._leftPanelActivated&&(this._leftPanelActivated=!1);const y=this._searchString.toLowerCase();let w=this.options.menus.map($=>$.items.map(B=>({...B,groupName:$.name}))).flat();return w=w.filter(({showWhen:$=()=>!0})=>$(this.model)),y?w.filter(({name:$,alias:B=[]})=>[$,...B].some(R=>isFuzzyMatch(R,y))):w}_scrollToItem(_,y=!0){const w=this.shadowRoot;if(!w)return;const $=w.querySelector(`icon-button[text="${_.name}"]`);if($){if(y){$.scrollIntoView(!0);return}$.scrollIntoView({block:"nearest"})}}_handleClickItem(_){if(this._leftPanelActivated||_<0||_>=this._filterItems.length)return;cleanSpecifiedTail(this.model,this.triggerKey+this._searchString),this.abortController.abort();const{action:y}=this._filterItems[_];y({pageElement:this.pageElement,model:this.model})}_handleClickCategory(_){const y=this._filterItems.find(w=>w.groupName===_);y&&(this._scrollToItem(y),this._activatedItemIndex=this._filterItems.findIndex(w=>w.name===y.name))}_categoryTemplate(){const _=!this._searchString.length,y=this._filterItems[this._activatedItemIndex]?.groupName,w=collectGroupNames(this._filterItems);return x$1`<div
      class="slash-category ${_?"":"slash-category-hide"}"
    >
      ${w.map($=>x$1`<div
            class="slash-category-name ${y===$?"slash-active-category":""}"
            @click=${()=>this._handleClickCategory($)}
          >
            ${$}
          </div>`)}
    </div>`}render(){if(this._hide)return A;const _=408,y=344,w=!this._searchString.length,$=this._position?o$4({transform:`translate(${this._position.x}, ${this._position.y})`,maxHeight:`${Math.min(this._position.height,w?_:y)}px`}):o$4({visibility:"hidden"}),B=this._filterItems.map(({name:R,icon:H,suffix:j,disabled:q=!1,groupName:X},ee)=>{const te=ee!==0&&this._filterItems[ee-1].groupName!==X;return x$1`<div
            class="slash-item-divider"
            ?hidden=${!te||!!this._searchString.length}
          ></div>
          <icon-button
            class="slash-item ${R}"
            ?disabled=${q}
            width="100%"
            height="32px"
            style="padding-left: 12px; justify-content: flex-start; gap: 8px;"
            ?hover=${!q&&!this._leftPanelActivated&&this._activatedItemIndex===ee}
            text="${R}"
            data-testid="${R}"
            @mousemove=${()=>{this._leftPanelActivated=!1,this._activatedItemIndex=ee}}
            @click=${()=>{this._handleClickItem(ee)}}
          >
            ${H}
            <div slot="suffix">${j}</div>
          </icon-button>`});return x$1`<div class="slash-menu-container">
      <div
        class="overlay-mask"
        @click="${()=>this.abortController.abort()}"
      ></div>
      <div class="slash-menu" style="${$}">
        ${this._categoryTemplate()}
        <div class="slash-item-container">${B}</div>
      </div>
    </div>`}};SlashMenu.styles=styles;__decorate$3([n$a({attribute:!1})],SlashMenu.prototype,"pageElement",void 0);__decorate$3([n$a({attribute:!1})],SlashMenu.prototype,"model",void 0);__decorate$3([n$a({attribute:!1})],SlashMenu.prototype,"options",void 0);__decorate$3([n$a({attribute:!1})],SlashMenu.prototype,"triggerKey",void 0);__decorate$3([i$6(".slash-menu")],SlashMenu.prototype,"slashMenuElement",void 0);__decorate$3([t$2()],SlashMenu.prototype,"_leftPanelActivated",void 0);__decorate$3([t$2()],SlashMenu.prototype,"_activatedItemIndex",void 0);__decorate$3([t$2()],SlashMenu.prototype,"_filterItems",void 0);__decorate$3([t$2()],SlashMenu.prototype,"_hide",void 0);__decorate$3([t$2()],SlashMenu.prototype,"_position",void 0);SlashMenu=__decorate$3([e$7("affine-slash-menu")],SlashMenu);var __decorate$2=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B},SlashMenuWidget_1;let globalAbortController=new AbortController;function showSlashMenu({pageElement:k,model:_,range:y,container:w=document.body,abortController:$=new AbortController,options:B,triggerKey:R}){globalAbortController.abort(),globalAbortController=$;const H=new DisposableGroup;$.signal.addEventListener("abort",()=>H.dispose());const j=new SlashMenu;H.add(()=>j.remove()),j.model=_,j.abortController=$,j.options=B,j.pageElement=k,j.triggerKey=R;const q=throttle$1(()=>{const X=j.slashMenuElement;assertExists(X,"You should render the slash menu node even if no position");const ee=getPopperPosition(X,y);j.updatePosition(ee)},10);return H.addFromEvent(window,"resize",q),w.appendChild(j),setTimeout(q),j}let SlashMenuWidget=SlashMenuWidget_1=class extends WidgetElement{constructor(){super(...arguments),this.options=SlashMenuWidget_1.DEFAULT_OPTIONS,this._onKeyDown=_=>{if(!this.root.page.awarenessStore.getFlag("enable_slash_menu"))return;const $=_.get("keyboardState").raw,B=this.options.isTriggerKey($);if(B===!1)return;const R=this.root.selectionManager.value.find(q=>q.is("text"));if(!R)return;const H=this.root.page.getBlockById(R.blockId);if(!H||matchFlavours(H,["affine:code"]))return;const j=getVirgoByModel(H);j&&j.slots.rangeUpdated.once(()=>{const q=this.pageElement;if(!isPageComponent(q))throw new Error("SlashMenuWidget should be used in PageBlock");requestAnimationFrame(()=>{const X=getCurrentNativeRange();showSlashMenu({pageElement:q,model:H,range:X,triggerKey:B,options:this.options})})})}}connectedCallback(){super.connectedCallback(),this.handleEvent("keyDown",this._onKeyDown)}};SlashMenuWidget.DEFAULT_OPTIONS={isTriggerKey:k=>{const _=["/","、"];if(k.key==="Process"&&k.code==="Slash")return"/";if(isControlledKeyboardEvent(k)||k.key.length!==1)return!1;const y=_.find(w=>w===k.key);return y||!1},menus:menuGroups};SlashMenuWidget=SlashMenuWidget_1=__decorate$2([e$7("affine-slash-menu-widget")],SlashMenuWidget);const env$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},importIdentifier$1="__ $BLOCKSUITE_BLOCKS$ __";env$1[importIdentifier$1]===!0&&console.error("@blocksuite/blocks was already imported. This breaks constructor checks and will lead to issues!");if(typeof window>"u")throw new Error("Seems like you are importing @blocksuite/blocks in SSR mode. Which is not supported for now.");env$1[importIdentifier$1]=!0;const checkEditorElementActive=()=>document.activeElement?.closest("editor-container")!=null,createBlockHub=(k,_)=>new BlockHub({mouseRoot:k,enableDatabase:!!_.awarenessStore.getFlag("enable_database"),onClickCard:async w=>{const $=k.page,B=[];if(w.flavour==="affine:database"&&!$.awarenessStore.getFlag("enable_database")){console.warn("database block is not enabled");return}if(w.flavour==="affine:image"&&w.type==="image")B.push(...(await uploadImageFromLocal($.blobs)).map(({sourceId:q})=>({flavour:"affine:image",sourceId:q})));else if(w.flavour==="affine:bookmark"){const q=await getBookmarkInitialProps();q&&B.push({flavour:"affine:bookmark",url:q})}else B.push(w);const H=$.root?.children.findLast(q=>q.flavour==="affine:note")??$.addBlock("affine:note",{},$.root?.id);let j;B.forEach(q=>{j=$.addBlock(q.flavour??"affine:paragraph",q,H)}),j&&asyncFocusRichText($,j)},onDrop:async(w,$,B,R)=>{const H=k.page,j=w.dataTransfer;assertExists(j);const q=j.getData("affine/block-hub"),X=[],ee=JSON.parse(q),te=ee.flavour==="affine:database";if(te&&!H.awarenessStore.getFlag("enable_database")){console.warn("database block is not enabled");return}if(ee.flavour==="affine:image"&&ee.type==="image")X.push(...(await uploadImageFromLocal(H.blobs)).map(({sourceId:re})=>({flavour:"affine:image",sourceId:re})));else if(ee.flavour==="affine:bookmark"){const re=await getBookmarkInitialProps();re&&X.push({flavour:"affine:bookmark",url:re})}else X.push(ee);if(!X.length)return;let ne,oe;if(B&&R!=="none"){const{model:re}=B;if(H.captureSync(),R==="database")oe=H.addBlocks(X,re)[0],ne=re.id;else{const se=H.getParent(re);assertExists(se),oe=H.addSiblingBlocks(re,X,R)[0],ne=se.id}te&&(await getServiceOrRegister(ee.flavour)).initDatabaseBlock(H,re,oe,"table")}if(k.mode==="page"){oe&&asyncFocusRichText(H,oe);return}const ie=getEdgelessPage(H);assertExists(ie);let ae;if(oe&&ne){const re=getClosestNoteBlockElementById(ne,ie);assertExists(re),ae=re.model.id}else{const re=ie.addNewNote(X,$,te?{width:752}:void 0);ae=re.noteId,oe=re.ids[0];const se=H.getBlockById(oe);assertExists(se),te&&(await getServiceOrRegister(ee.flavour)).initDatabaseBlock(H,se,se.id,"table")}ie.setSelection(ae,!0,oe,$)},onDragStart:()=>{if(k.mode==="page"){const w=k.querySelector("affine-doc-page");assertExists(w)}},getAllowedBlocks:()=>{if(k.mode==="page"){const w=k.querySelector("affine-doc-page");return assertExists(w),getAllowSelectedBlocks(w.model)}else{const w=k.querySelector("affine-edgeless-page");return assertExists(w),getAllowSelectedBlocks(w.model)}},getHoveringNoteState:w=>{const $={scale:1};if(k.mode==="page"){const B=k.querySelector("affine-doc-page");assertExists(B);const R=Rect.fromDOMRect(B.pageBlockContainer.getBoundingClientRect());R.height-=PAGE_BLOCK_PADDING_BOTTOM,$.rect=R}else{const B=k.querySelector("affine-edgeless-page");assertExists(B),$.scale=B.surface.viewport.zoom;const R=getHoveringNote(w);R&&($.rect=Rect.fromDOM(R),$.container=R)}return $},page:_});var __decorate$1=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};function forwardSlot(k,_){Object.entries(k).forEach(([y,w])=>{const $=_[y];$&&w.pipe($)})}let EditorContainer=class extends WithDisposable(ShadowlessElement){constructor(){super(...arguments),this.mode="page",this.pagePreset=pagePreset,this.edgelessPreset=edgelessPreset,this.autofocus=!1,this.themeObserver=new ThemeObserver,this.fileDropManager=new FileDropManager(this),this.slots={pageLinkClicked:new Slot,pageModeSwitched:new Slot,tagClicked:new Slot}}get model(){return this.page.root}connectedCallback(){super.connectedCallback();const _=y=>{if(y.altKey&&y.metaKey&&y.code==="KeyC"&&y.preventDefault(),y.code!=="Escape"||!this.model)return;this.mode;const $=getSelection();!$||$.isCollapsed||!checkEditorElementActive()||$.removeAllRanges()};if(IS_FIREFOX?this._disposables.addFromEvent(document.body,"keydown",_):this._disposables.addFromEvent(window,"keydown",_),!this.page)throw new Error("Missing page for EditorContainer!");this._disposables.add(this.page.slots.rootAdded.on(()=>{this.requestUpdate("page")})),this._disposables.addFromEvent(this,"dragover",this.fileDropManager.onDragOver),this._disposables.addFromEvent(this,"drop",this.fileDropManager.onDrop),this.themeObserver.observer(document.documentElement),this._disposables.add(this.themeObserver)}disconnectedCallback(){super.disconnectedCallback()}firstUpdated(){getServiceOrRegister("affine:code"),this.mode==="page"&&setTimeout(()=>{this.autofocus&&this._defaultPageBlock?.titleVEditor.focusEnd()}),this.fileDropManager.register({name:"Image",matcher:_=>_.type.startsWith("image"),handler:async _=>{const w=await this.page.blobs.set(_),$=this.mode==="edgeless"?await readImageSize(_):{};return{flavour:"affine:image",sourceId:w,...$}}}),this.page.awarenessStore.getFlag("enable_attachment_block")&&this.fileDropManager.register({name:"Attachment",matcher:_=>_.size>1e7?(console.warn("You can only upload files less than 10M."),!1):!0,handler:async _=>{const w=await this.page.blobs.set(_);return{flavour:"affine:attachment",name:_.name,size:_.size,type:_.type,sourceId:w}}})}updated(_){_.has("mode")&&(this.slots.pageModeSwitched.emit(this.mode),this.mode==="page"&&this._saveViewportLocalRecord()),!(!_.has("page")&&!_.has("mode"))&&requestAnimationFrame(()=>{this._defaultPageBlock&&forwardSlot(this._defaultPageBlock.slots,this.slots),this._edgelessPageBlock&&forwardSlot(this._edgelessPageBlock.slots,this.slots)})}async createBlockHub(){return await this.updateComplete,this.page.root||await new Promise(_=>this.page.slots.rootAdded.once(_)),createBlockHub(this,this.page)}_saveViewportLocalRecord(){const _=this.querySelector("affine-edgeless-page");if(_){const{viewport:y}=_.surface;sessionStorage.setItem("blocksuite:"+this.page.id+":edgelessViewport",JSON.stringify({...y.center,zoom:y.zoom}))}}createContentParser(){return new ContentParser(this.page)}render(){if(!this.model)return null;const _=i(this.model.id,x$1`<block-suite-root
        .page=${this.page}
        .blocks=${this.mode==="page"?this.pagePreset:this.edgelessPreset}
      ></block-suite-root>`);return x$1`
      <style>
        editor-container * {
          box-sizing: border-box;
        }
        editor-container,
        .affine-editor-container {
          display: block;
          height: 100%;
          position: relative;
          overflow: hidden;
          font-family: var(--affine-font-family);
          background: var(--affine-background-primary-color);
        }
        @media print {
          editor-container,
          .affine-editor-container {
            height: auto;
          }
        }
      </style>
      ${_}
    `}};__decorate$1([n$a({attribute:!1})],EditorContainer.prototype,"page",void 0);__decorate$1([n$a({attribute:!1})],EditorContainer.prototype,"mode",void 0);__decorate$1([n$a({attribute:!1})],EditorContainer.prototype,"pagePreset",void 0);__decorate$1([n$a({attribute:!1})],EditorContainer.prototype,"edgelessPreset",void 0);__decorate$1([n$a({attribute:!1})],EditorContainer.prototype,"autofocus",void 0);__decorate$1([i$6("affine-doc-page")],EditorContainer.prototype,"_defaultPageBlock",void 0);__decorate$1([i$6("affine-edgeless-page")],EditorContainer.prototype,"_edgelessPageBlock",void 0);EditorContainer=__decorate$1([e$7("editor-container")],EditorContainer);var __decorate=globalThis&&globalThis.__decorate||function(k,_,y,w){var $=arguments.length,B=$<3?_:w===null?w=Object.getOwnPropertyDescriptor(_,y):w,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(k,_,y,w);else for(var H=k.length-1;H>=0;H--)(R=k[H])&&(B=($<3?R(B):$>3?R(_,y,B):R(_,y))||B);return $>3&&B&&Object.defineProperty(_,y,B),B};let SimpleAffineEditor=class extends s$2{constructor(){super();const _=new Schema;_.register(AffineSchemas).register(__unstableSchemas),this.workspace=new Workspace({id:"test",schema:_}),this.page=this.workspace.createPage({id:"page0"}),this.page.waitForLoaded().then(()=>{const y=this.page.addBlock("affine:page"),w=this.page.addBlock("affine:note",{},y);this.page.addBlock("affine:paragraph",{},w)})}connectedCallback(){const _=new EditorContainer;_.page=this.page,this.appendChild(_)}disconnectedCallback(){this.removeChild(this.children[0])}};SimpleAffineEditor=__decorate([e$7("simple-affine-editor")],SimpleAffineEditor);const env=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},importIdentifier="__ $BLOCKSUITE_EDITOR$ __";env[importIdentifier]===!0&&console.error("@blocksuite/editor was already imported. This breaks constructor checks and will lead to issues!");if(typeof window>"u")throw new Error("Seems like you are importing @blocksuite/editor in SSR mode. Which is not supported for now.");env[importIdentifier]=!0;const index=Object.freeze(Object.defineProperty({__proto__:null,get EditorContainer(){return EditorContainer},get SimpleAffineEditor(){return SimpleAffineEditor},checkEditorElementActive,createBlockHub},Symbol.toStringTag,{value:"Module"}));export{SimpleAffineEditor as S,getService$1 as a,buffer as b,index as c,getServiceOrRegister as g,ieee754 as i,registerService as r};
