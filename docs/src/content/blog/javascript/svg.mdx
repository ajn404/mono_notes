---
title:  svg速查
author: ajn404
pubDatetime: 2023-09-07T02:43:53Z
postSlug: svg
featured: false
draft: false
tags:
  - svg
description:
  "svg some features"
---

## tags


- [animateTransform](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/animateTransform)

<svg
  width="120"
  height="120"
  viewBox="0 0 120 120"
  style="fill:#996611"
  version="1.1">
  <polygon points="60,30 90,90 30,90">
    <animateTransform
      attributeName="transform"
      attributeType="XML"
      type="rotate"
      from="0 60 70"
      to="360 60 70"
      dur="10s"
      repeatCount="indefinite" />
  </polygon>
</svg>


```html
<animateTransform
      attributeName="transform"
      attributeType="XML"
      type="rotate"
      from="0 60 70"
      to="360 60 70"
      dur="10s"
      repeatCount="indefinite" />
```


## attribute
- [transform](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/transform)

<svg
  viewBox="-40 0 150 100"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <g
    fill="grey"
    transform="rotate(-10 50 100)
                translate(-36 45.5)
                skewX(40)
                scale(1.2 0.5)">
    <path
      id="heart"
      d="M 10,30 A 20,20 0,0,1 50,30 A 20,20 0,0,1 90,30 Q 90,60 50,90 Q 10,60 10,30 z" />
  </g>
</svg>

## 效果

- 简单投影
```html
<svg height="120" width="120">
  <defs>
    <filter id="f1" x="0" y="0" width="200%" height="200%">
      <feOffset result="offOut" in="SourceGraphic" dx="20" dy="20"></feOffset>
      <feBlend in="SourceGraphic" in2="offOut" mode="normal"></feBlend>
    </filter>
  </defs>
  <rect width="90" height="90" stroke="green" stroke-width="3" fill="yellow" filter="url(#f1)"></rect>
</svg>
```
<svg height="120" width="120">
  <defs>
    <filter id="f1" x="0" y="0" width="200%" height="200%">
      <feOffset result="offOut" in="SourceGraphic" dx="20" dy="20"></feOffset>
      <feBlend in="SourceGraphic" in2="offOut" mode="normal"></feBlend>
    </filter>
  </defs>
  <rect width="90" height="90" stroke="green" stroke-width="3" fill="yellow" filter="url(#f1)"></rect>
</svg>
> [blend-mode](https://developer.mozilla.org/zh-CN/docs/Web/CSS/blend-mode)

<div class="border-10 w-full h-[20px] bg-gradient-to-r from-cyan-500 to-blue-500"/>

> peaks.js 音乐可视化[bbc demo](https://waveform.prototyping.bbc.co.uk/)

> [npm peaks.js](https://www.npmjs.com/package/peaks.js)

import Peaks from '@components/little/peaks.tsx'

<Peaks client:load/>



- 自定义audio

<details>

```tsx
import React, {
    useRef,
    useLayoutEffect,
    useState,
    useEffect,
    MouseEvent,
} from 'react';
// import './Audio.css';
import uniqueId from 'lodash.uniqueid';



function transTime(value: number) {
    var time = '';
    var h = parseInt(`${value / 3600}`);
    value %= 3600;
    var m = parseInt(`${value / 60}`);
    var s = parseInt(`${value % 60}`);
    if (h > 0) {
        time = formatTime(h + ':' + m + ':' + s);
    } else {
        time = formatTime(m + ':' + s);
    }

    return time;
}

function formatTime(value: string) {
    var time = '';
    var s = value.split(':');
    var i = 0;
    for (; i < s.length - 1; i++) {
        time += s[i].length === 1 ? '0' + s[i] : s[i];
        time += ':';
    }
    time += s[i].length === 1 ? '0' + s[i] : s[i];

    return time;
}

export const Audio: React.FC<any> = props => {
    const { src, width = '80%', height = '30px' } = props;

    const audioRef = useRef<HTMLAudioElement>(null);
    const barBgRef = useRef<HTMLDivElement>(null);
    const barRef = useRef<HTMLDivElement>(null);
    const dotRef = useRef<HTMLSpanElement>(null);
    const uidRef = useRef<string>(uniqueId());

    const [toggle, setToggle] = useState<boolean>(true);
    const [progress, setProgress] = useState<number>(0);
    const [duration, setDuration] = useState<string>('00 : 00');
    const [currentTime, setCurrentTime] = useState<string>('00:00');

    useLayoutEffect(() => {
        if (audioRef.current && src) {
            audioRef.current.addEventListener('play', (e: Event) => {

                const pid = (e.target as HTMLAudioElement).getAttribute('pid');
                const audios = document.querySelectorAll('audio');
                console.log(audios);

                console.log('pid', pid);
                audios.forEach((element, index) => {
                    if (element.getAttribute('pid') === pid) return;
                    element.pause();
                });
            });

            audioRef.current.addEventListener('loadedmetadata', e => {
                const duration = transTime(
                    (e.target as HTMLAudioElement).duration as number,
                );
                setDuration(duration);
            });
            audioRef.current.addEventListener('play', _res => {
                setToggle(false);
            });
            audioRef.current.addEventListener('pause', () => {
                setToggle(true);
            });
            audioRef.current.addEventListener('timeupdate', e => {
                let value =
                    (e.target as HTMLAudioElement).currentTime /
                    (audioRef.current as HTMLAudioElement).duration;
                setProgress(value * 100);
                setCurrentTime(transTime((e.target as HTMLAudioElement).currentTime));
                // console.log('timeupdate res', res.target.currentTime);
            });
        }
        return () => { };
    }, [src]);

    useEffect(() => {
        if (dotRef.current && src) {
            const position = {
                oriOffestLeft: 0, // 移动开始时进度条的点距离进度条的偏移值
                oriX: 0, // 移动开始时的x坐标
                maxLeft: 0, // 向左最大可拖动距离
                maxRight: 0, // 向右最大可拖动距离
            };
            let flag = false; // 标记是否拖动开始

            // 按下
            const down = (event: TouchEvent | MouseEvent) => {
                if (!audioRef.current?.paused || audioRef.current.currentTime !== 0) {
                    flag = true;
                    position.oriOffestLeft = dotRef.current?.offsetLeft ?? 0; // 初始位置
                    position.oriX = position.oriX =
                        event instanceof TouchEvent
                            ? event.touches[0].clientX
                            : event.clientX; // 要同时适配mousedown和touchstart事件
                    position.maxLeft = position.oriOffestLeft; // 向左最大可拖动距离
                    position.maxRight =
                        barBgRef.current?.offsetWidth ?? 0 - position.oriOffestLeft; // 向右边最大可拖动距离

                    if (event && event.preventDefault) {
                        event.preventDefault();
                    } else {
                        (event as TouchEvent).returnValue = false;
                    }

                    // 禁止事件冒泡
                    if (event && event.stopPropagation) {
                        event.stopPropagation();
                    }
                }
            };
            // 移动
            const move = (event: TouchEvent | MouseEvent) => {
                if (flag && barBgRef.current) {
                    let clientX =
                        event instanceof TouchEvent
                            ? event.touches[0].clientX
                            : event.clientX; // 要同时适配mousemove和touchmove事件

                    let length = clientX - position.oriX;
                    if (length > position.maxRight) {
                        length = position.maxRight;
                    } else if (length < -position.maxLeft) {
                        length = -position.maxLeft;
                    }
                    // let pgsWidth = barBgRef.current?.offsetWidth;
                    let pgsWidth = parseFloat(
                        window.getComputedStyle(barBgRef.current).width.replace('px', ''),
                    );
                    let rate = (position.oriOffestLeft + length) / pgsWidth;

                    console.log('===', position.oriOffestLeft, length);

                    console.log(
                        '偏移总长比例',
                        (audioRef.current as HTMLAudioElement).duration * rate,
                        rate,
                    );
                    (audioRef.current as HTMLAudioElement).currentTime =
                        (audioRef.current as HTMLAudioElement).duration * rate;
                }
            };
            // 结束
            const end = () => {
                flag = false;
            };

            // 鼠标按下时
            dotRef.current.addEventListener('mousedown', down as any, false);
            dotRef.current.addEventListener('touchstart', down, false);

            // 开始拖动
            document.addEventListener('mousemove', move as any, false);
            document.addEventListener('touchmove', move, false);

            // 拖动结束
            document.addEventListener('mouseup', end, false);
            barBgRef.current?.addEventListener('touchend', end, false);
        }
    }, [src]);

    const handlePaly = () => {
        if (toggle && src) {
            audioRef.current?.play();
            return;
        }
        audioRef.current?.pause();
        return;
    };

    return (
        <>
            <audio
                //@ts-ignore
                pid={uidRef.current}
                controls={false}
                src={src}
                preload='metadata'
                ref={audioRef}>
                您的浏览器不支持 audio 标签
            </audio>
            <div className='audio-container' style={{ width, height }}>
                <div className='audio-toggle' onClick={handlePaly}>
                    {toggle && src ? '>' : '||'}
                </div>
                <div className='audio-progress-bar-bg h-[20px]' ref={barBgRef}>
                    <span
                        ref={dotRef}
                        className='progressDot'
                        style={{ left: `${progress - 2}%` }}></span>
                    <div
                        ref={barRef}
                        className='audio-progress-bar h-full bg-[#e0e0e0]'
                        style={{
                            width: `${progress}%`,
                        }}></div>
                </div>
                <div className='audio-time'>
                    {currentTime}/{duration}
                </div>
            </div>
        </>
    );
};
export default Audio;
```

</details>

- 颜色变换(高斯模糊)
> feGaussianBlur/feColorMatrix/feOffset/feBlend 

<svg height="140" width="140">
  <defs>
    <filter id="f4" x="0" y="0" width="200%" height="200%">
      <feOffset result="offOut" in="SourceGraphic" dx="20" dy="20"></feOffset>
      <feColorMatrix 
      result="matrixOut" 
      in="offOut" 
      type="matrix" 
      values="      0.2 0 0 0       
                    0 0 0.2 0 0      
                    0 0 0 0.2 0       
                    0 0 0 0 1 0">
      </feColorMatrix>
      <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="10"></feGaussianBlur>
      <feBlend in="SourceGraphic" in2="blurOut" mode="normal"></feBlend>
    </filter>
  </defs>
  <rect width="90" height="90" stroke="green" stroke-width="3" fill="#8855ee" filter="url(#f4)"></rect>
</svg>

- svg实现线性渐变

import CustomerSvg from '@components/d3/svg.tsx'

<CustomerSvg type='linear' client:load/>

```tsx
<svg height="150" width="400">
                <defs>
                    <linearGradient id="grad1" x1={x1 + '%'} y1={y1 + '%'} x2={x2 + '%'} y2={y2 + '%'}>
                        <stop offset="0%" style={{ stopColor: "rgb(255,255,0)", stopOpacity: 1 }}></stop>
                        <stop offset="100%" style={{ stopColor: "rgb(255,0,0)", stopOpacity: 1 }}></stop>
                    </linearGradient>
                </defs>
                <ellipse cx="200" cy="70" rx="85" ry="55" fill="url(#grad1)"></ellipse>
            </svg>
```



## 链接

- [mdn svg](https://developer.mozilla.org/zh-CN/docs/Web/SVG)
